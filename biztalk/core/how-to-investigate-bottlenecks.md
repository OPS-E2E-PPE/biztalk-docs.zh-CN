---
title: 如何调查瓶颈 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 7ca22d07-d5fe-4dfb-8b52-3be3a95b0d6f
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 643c64401cc5d8f68d407efc37020391b9467a6b
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65384888"
---
# <a name="how-to-investigate-bottlenecks"></a><span data-ttu-id="e25b5-102">如何调查瓶颈</span><span class="sxs-lookup"><span data-stu-id="e25b5-102">How to Investigate Bottlenecks</span></span>
<span data-ttu-id="e25b5-103">本主题介绍如何调查瓶颈的建议的过程。</span><span class="sxs-lookup"><span data-stu-id="e25b5-103">This topic describes a recommended process for how to investigate bottlenecks.</span></span>  
  
## <a name="what-is-the-source-of-the-problem"></a><span data-ttu-id="e25b5-104">问题的根源是什么？</span><span class="sxs-lookup"><span data-stu-id="e25b5-104">What is the Source of the Problem?</span></span>  
 <span data-ttu-id="e25b5-105">问题的原因可能是硬件或软件相关。</span><span class="sxs-lookup"><span data-stu-id="e25b5-105">The source of the problem could be hardware or software related.</span></span> <span data-ttu-id="e25b5-106">在资源利用不足则通常表示瓶颈的某个位置在系统中。</span><span class="sxs-lookup"><span data-stu-id="e25b5-106">When resources are underutilized it is usually an indication of a bottleneck somewhere in the system.</span></span> <span data-ttu-id="e25b5-107">由于硬件限制或由于和 / 或软件配置效率低下，可能会导致瓶颈。</span><span class="sxs-lookup"><span data-stu-id="e25b5-107">Bottlenecks can be caused either due to hardware limitations or due to inefficient software configurations or both.</span></span>  
  
 <span data-ttu-id="e25b5-108">确定瓶颈是一个渐进的过程，因此缓解一个问题可能会导致下一个发现。</span><span class="sxs-lookup"><span data-stu-id="e25b5-108">Identifying bottlenecks is an incremental process whereby alleviating one bottleneck can lead to the discovery of the next one.</span></span> <span data-ttu-id="e25b5-109">本主题的目标是科学地确定和缓解这些瓶颈。</span><span class="sxs-lookup"><span data-stu-id="e25b5-109">The science of identifying and alleviating these bottlenecks is the objective of this topic.</span></span> <span data-ttu-id="e25b5-110">很可能以峰值的时间短时间内执行的系统。</span><span class="sxs-lookup"><span data-stu-id="e25b5-110">It is possible for a system to perform at peaks for short periods of time.</span></span> <span data-ttu-id="e25b5-111">但是，为了可承受吞吐量只能作为其执行速度最慢的组件快速处理系统。</span><span class="sxs-lookup"><span data-stu-id="e25b5-111">However, for sustainable throughput a system can only process as fast as its slowest performing component.</span></span>  
  
## <a name="using-a-serial-approach"></a><span data-ttu-id="e25b5-112">使用连续方法</span><span class="sxs-lookup"><span data-stu-id="e25b5-112">Using a Serial Approach</span></span>  
 <span data-ttu-id="e25b5-113">瓶颈可位于此终结点 （进入/退出） 的系统或某个位置中的中间 （业务流程/数据库）。</span><span class="sxs-lookup"><span data-stu-id="e25b5-113">Bottlenecks can occur at the endpoints (entry/exit) of the system or somewhere in the middle (orchestration/database).</span></span> <span data-ttu-id="e25b5-114">瓶颈位置后可以执行结构化的方法来标识源。</span><span class="sxs-lookup"><span data-stu-id="e25b5-114">After the location of the bottleneck has been isolated a structured approach can be undertaken to identify the source.</span></span> <span data-ttu-id="e25b5-115">已缓解瓶颈后务必测量性能以确保，新的瓶颈不中引入了其他位置在系统的其他行。</span><span class="sxs-lookup"><span data-stu-id="e25b5-115">After the bottlenecks have been alleviated it is essential to measure performance again to ensure that a new bottleneck has not been introduced elsewhere in the system further down the line.</span></span>  
  
 <span data-ttu-id="e25b5-116">确定并解决瓶颈的过程应按串行方式，一次只有一个参数应进行变化，然后对性能进行测量以验证这一单个变化的影响。</span><span class="sxs-lookup"><span data-stu-id="e25b5-116">The process of identifying and fixing bottlenecks should be done in a serial manner whereby only one parameter at a time should be varied and then performance measured to verify the impact of that single change.</span></span> <span data-ttu-id="e25b5-117">一次变化多个参数可能会掩盖更改的效果。</span><span class="sxs-lookup"><span data-stu-id="e25b5-117">Varying more than one parameter at a time could conceal the effect of the change.</span></span>  
  
 <span data-ttu-id="e25b5-118">例如，但是更改参数 1 可能会提高性能，更改参数 1 更改了参数 2 一起使用可能有不利影响，从而抵消更改参数 1，因此导致正负零效果的优势。</span><span class="sxs-lookup"><span data-stu-id="e25b5-118">For example, changing parameter 1 could improve performance however, changing parameter 2 in conjunction with changing parameter 1 could have a detrimental effect negating the benefits of changing parameter 1 thus leading to a net zero effect.</span></span> <span data-ttu-id="e25b5-119">但是，这会导致效果的改变参数 1 假负和假阳性上改变参数 2 的效果。</span><span class="sxs-lookup"><span data-stu-id="e25b5-119">However, this results in a false negative on the effect of varying parameter 1 and a false positive on the effect of varying parameter 2.</span></span>  
  
## <a name="testing-consistency"></a><span data-ttu-id="e25b5-120">测试一致性</span><span class="sxs-lookup"><span data-stu-id="e25b5-120">Testing Consistency</span></span>  
 <span data-ttu-id="e25b5-121">更改设置后测量性能特征，则必须以验证更改的效果。</span><span class="sxs-lookup"><span data-stu-id="e25b5-121">Measuring performance characteristics after changing settings is imperative to validate the effect of the change.</span></span>  
  
-   <span data-ttu-id="e25b5-122">硬件：请务必的使用一致的硬件，因为改变硬件可以显示不一致的行为生成误导性的结果; 例如不使用便携式计算机。</span><span class="sxs-lookup"><span data-stu-id="e25b5-122">Hardware: It is important to use consistent hardware as varying the hardware can display inconsistent behavior producing misleading results e.g. do not use a laptop.</span></span>  
  
-   <span data-ttu-id="e25b5-123">测试运行持续时间：也很重要的固定的最短期限以确保结果是真正可持续而不仅是峰值性能进行测量。</span><span class="sxs-lookup"><span data-stu-id="e25b5-123">Test Run Duration: It is also important to measure performance for a fixed minimum period to ensure that the results are indeed sustainable and not simply peaks.</span></span> <span data-ttu-id="e25b5-124">运行时间较长的测试的另一个原因是确保，系统已进行过初始热启动/突增期间其中填充所有缓存、 数据库表已达到预期的计数和限制提供足够时间来限流和调整预定义的阈值，则会命中后的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="e25b5-124">Another reason to run tests for longer periods is to ensure that the system has gone through the initial warm/ramp up period where all caches are populated, database tables have reached expected counts and throttling is given sufficient time to kick in and regulate throughput once predefined thresholds are hit.</span></span> <span data-ttu-id="e25b5-125">此方法将有助于发现最佳可承受吞吐量。</span><span class="sxs-lookup"><span data-stu-id="e25b5-125">This approach will help discover optimal sustainable throughput.</span></span>  
  
-   <span data-ttu-id="e25b5-126">测试参数：它还是命令性不改变测试参数从测试运行。</span><span class="sxs-lookup"><span data-stu-id="e25b5-126">Test Parameters: It is also imperative to not vary test parameters from test run to test run.</span></span> <span data-ttu-id="e25b5-127">例如，改变映射复杂性和/或文档大小可能产生不同的吞吐量和延迟结果。</span><span class="sxs-lookup"><span data-stu-id="e25b5-127">For example, varying map complexity and/or document sizes can produce different throughput and latency results.</span></span>  
  
-   <span data-ttu-id="e25b5-128">干净的状态：测试完成后务必清理所有状态，然后再运行下一个测试都运行。</span><span class="sxs-lookup"><span data-stu-id="e25b5-128">Clean State: Once a test is complete it is important to cleanup all state before running the next test run.</span></span> <span data-ttu-id="e25b5-129">例如，历史数据可能会影响运行时吞吐量在数据库中的累积。</span><span class="sxs-lookup"><span data-stu-id="e25b5-129">For example, historical data can buildup in the database impacting runtime throughput.</span></span> <span data-ttu-id="e25b5-130">回收服务实例有助于释放缓存的资源，例如内存、 数据库连接和线程。</span><span class="sxs-lookup"><span data-stu-id="e25b5-130">Recycling the service instances help to release cached resources like memory, database connections and threads.</span></span>  
  
## <a name="expectations-throughput-versus-latency"></a><span data-ttu-id="e25b5-131">期望：吞吐量与延迟时间</span><span class="sxs-lookup"><span data-stu-id="e25b5-131">Expectations: Throughput versus Latency</span></span>  
 <span data-ttu-id="e25b5-132">有理由需要一定的吞吐量和/或从已部署系统的滞后时间。</span><span class="sxs-lookup"><span data-stu-id="e25b5-132">It is reasonable to expect a certain amount of throughput and/or latency from the deployed system.</span></span> <span data-ttu-id="e25b5-133">正在尝试吞吐量很高和较低的延迟是得陇望蜀了两个不同的方向。</span><span class="sxs-lookup"><span data-stu-id="e25b5-133">Attempting to have both high throughput & low latency is like pulling in two different directions.</span></span> <span data-ttu-id="e25b5-134">但是是现实期望获得最佳吞吐量的合理的滞后时间的。</span><span class="sxs-lookup"><span data-stu-id="e25b5-134">However it is realistic to expect optimal throughput with reasonable latency.</span></span> <span data-ttu-id="e25b5-135">随着吞吐量提高增加的压力 （更高的 CPU 占用率、 更多的磁盘 IO 争用、 内存压力、 更高版本的锁争用） 放置在可以对延迟时间产生负面影响的系统上。</span><span class="sxs-lookup"><span data-stu-id="e25b5-135">As throughput improves increased stress (higher CPU consumption, higher disk-IO contention, memory pressure, greater lock contention) is placed on the system which can have a negative impact on latency.</span></span> <span data-ttu-id="e25b5-136">若要发现最佳系统容量，则必须找到并缓解所有瓶颈。</span><span class="sxs-lookup"><span data-stu-id="e25b5-136">To discover optimal capacity of a system it is imperative to identify and alleviate any and all bottlenecks.</span></span>  
  
 <span data-ttu-id="e25b5-137">通过在未清除的数据库中驻留的旧数据 （已完成的实例） 可能会导致瓶颈。当发生这种情况可能会降低性能。</span><span class="sxs-lookup"><span data-stu-id="e25b5-137">Bottlenecks can be caused by legacy data (completed instances) residing in the database not cleaned out. When this occurs performance can degrade.</span></span> <span data-ttu-id="e25b5-138">让系统足够时间来排出可以帮助缓解此问题。</span><span class="sxs-lookup"><span data-stu-id="e25b5-138">Giving the system sufficient time to drain can help alleviate the problem.</span></span> <span data-ttu-id="e25b5-139">但是，发现导致积压累积并帮助缓解这一问题非常重要。</span><span class="sxs-lookup"><span data-stu-id="e25b5-139">However, discovering the cause of the backlog buildup and helping alleviate the issue is important.</span></span>  
  
 <span data-ttu-id="e25b5-140">若要发现积压的原因，务必要分析历史数据和监视性能监视器计数器 （为了发现使用模式和诊断积压的根源）。</span><span class="sxs-lookup"><span data-stu-id="e25b5-140">To discover the cause of the backlog, it is important to analyze historical data, monitor Performance Monitor counters (to discover usage patterns, and diagnose the source of the backlog).</span></span> <span data-ttu-id="e25b5-141">这是其中以批处理方式在夜间处理大量数据的常见情况。</span><span class="sxs-lookup"><span data-stu-id="e25b5-141">This is a common situation where large volumes of data are processed in a batched manner on a nightly basis.</span></span> <span data-ttu-id="e25b5-142">发现的系统，并且能够从积压中恢复的容量可有助于评估处理过载情况以及缓冲区的空间量的硬件要求，以容纳系统为处理不可预见的峰值吞吐量.</span><span class="sxs-lookup"><span data-stu-id="e25b5-142">Discovering the capacity of the system and its ability to recover from a backlog can be useful in estimating hardware requirements for handling overdrive scenarios and the amount of buffer room to accommodate within a system to handle unforeseen spikes in throughput.</span></span>  
  
 <span data-ttu-id="e25b5-143">优化系统以最佳可承受吞吐量要求用户深入了解正在部署的应用程序、 优点和缺点的特定方案的系统和使用情况模式。</span><span class="sxs-lookup"><span data-stu-id="e25b5-143">Tuning the system for optimal sustainable throughput requires an in depth understanding of the application being deployed, the strengths and weaknesses of the system and usage patterns of the specific scenario.</span></span> <span data-ttu-id="e25b5-144">将在生产环境中使用发现瓶颈和预测最佳可承受吞吐量颇有自信地是通过符合什么的拓扑结构进行彻底的测试的唯一方法。</span><span class="sxs-lookup"><span data-stu-id="e25b5-144">The only way to discover bottlenecks and predict optimal sustainable throughput with certainty is through thorough testing on a topology that closely matches what will be used in production.</span></span>  
  
 <span data-ttu-id="e25b5-145">本部分中的其他主题将指导您完成定义该拓扑的过程，并提供有关如何缓解瓶颈和从第一个位置中避免瓶颈的指南。</span><span class="sxs-lookup"><span data-stu-id="e25b5-145">Other topics in this section guides you through the process of defining that topology, and provides guidance on how to alleviate bottlenecks and hopefully help to avoid bottlenecks in the first place.</span></span>  
  
## <a name="scaling"></a><span data-ttu-id="e25b5-146">缩放</span><span class="sxs-lookup"><span data-stu-id="e25b5-146">Scaling</span></span>  
 <span data-ttu-id="e25b5-147">瓶颈可能已部署的拓扑的各个阶段。</span><span class="sxs-lookup"><span data-stu-id="e25b5-147">Bottlenecks can occur at various stages of the deployed topology.</span></span> <span data-ttu-id="e25b5-148">可以通过升级硬件得以一些瓶颈。</span><span class="sxs-lookup"><span data-stu-id="e25b5-148">Some bottlenecks can be addressed by upgrading hardware.</span></span> <span data-ttu-id="e25b5-149">向上扩展 （更多 CPU、 内存或缓存） 或向外扩展 （更多服务器），则可以升级硬件。</span><span class="sxs-lookup"><span data-stu-id="e25b5-149">Hardware can be upgraded either by scaling-up (more CPU’s, memory or cache) or by scaling-out (additional servers).</span></span> <span data-ttu-id="e25b5-150">增加/扩大的决定取决于遇到的瓶颈类型和要配置的应用程序。</span><span class="sxs-lookup"><span data-stu-id="e25b5-150">The decision to scale up/out depends on the type of bottleneck encountered and the application being configured.</span></span> <span data-ttu-id="e25b5-151">以下信息有助于指导如何更改硬件部署拓扑基于遇到的瓶颈。</span><span class="sxs-lookup"><span data-stu-id="e25b5-151">The following will help with guidance on how to change hardware deployment topologies based on bottlenecks encountered.</span></span> <span data-ttu-id="e25b5-152">应用程序需要将从头开始构建，才能利用扩展/横向扩展。例如：</span><span class="sxs-lookup"><span data-stu-id="e25b5-152">An application needs to be built from the ground up to be capable of taking advantage of scaling up/out. For example:</span></span>  
  
-   <span data-ttu-id="e25b5-153">向上扩展的其他服务器 CPU 的和/或内存可能无法帮助缓解此问题，如果应用程序序列化和依赖于单个执行线程。</span><span class="sxs-lookup"><span data-stu-id="e25b5-153">Scaling up a server with additional CPU’s and/or memory may not help alleviate the problem if the application is serialized and dependent on a single thread of execution.</span></span>  
  
-   <span data-ttu-id="e25b5-154">如果其他服务器只需添加无法扩展的公共资源争用，向外扩展与其他服务器系统用处不大。</span><span class="sxs-lookup"><span data-stu-id="e25b5-154">Scaling out a system with additional servers may not help if the additional servers simply add contention on a common resource that cannot be scaled.</span></span> <span data-ttu-id="e25b5-155">但是，向外扩展提供了其他权益。</span><span class="sxs-lookup"><span data-stu-id="e25b5-155">However, scaling-out provides additional benefits.</span></span> <span data-ttu-id="e25b5-156">部署两个双处理器服务器，而不是一个四处理器服务器有助于提供冗余的服务器，起到双重作用的缩放以处理增加的吞吐量，并提供高度可用拓扑结构。</span><span class="sxs-lookup"><span data-stu-id="e25b5-156">Deploying two dual-proc servers instead of one quad-proc server helps provide a redundant server that serves the dual purpose of scaling to handle additional throughput and provides a highly available topology.</span></span>