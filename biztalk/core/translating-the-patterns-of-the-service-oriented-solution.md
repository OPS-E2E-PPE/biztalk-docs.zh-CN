---
title: 转换的服务的模式面向解决方案 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- patterns [service solutions], translating patterns to orchestration shapes
- artifacts, patterns
- orchestrations, patterns
- patterns [process management solutions], connections
- patterns [service solutions], orchestration boundaries
- patterns [process management solutions], translating patterns to orchestrations
- orchestrations, boundaries
- patterns [service solutions], translating patterns to artifacts
ms.assetid: ff17cc41-2a7b-4304-b5bd-96b1174cea7f
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 95285c93bdb290adbee988305dbcd365e4e729a6
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22279997"
---
# <a name="translating-the-patterns-of-the-service-oriented-solution"></a><span data-ttu-id="deb02-102">转换的服务的模式面向解决方案</span><span class="sxs-lookup"><span data-stu-id="deb02-102">Translating the Patterns of the Service Oriented Solution</span></span>
<span data-ttu-id="deb02-103">本部分将介绍该解决方案如何将模式关系图转换为 BizTalk Server 项目。</span><span class="sxs-lookup"><span data-stu-id="deb02-103">This section describes how the solution translates the pattern diagram into BizTalk Server artifacts.</span></span>  
  
 <span data-ttu-id="deb02-104">![服务 &#45; 面向的解决方案模式](../core/media/service-oriented-solution-patterns.gif "Service_Oriented_Solution_Patterns")</span><span class="sxs-lookup"><span data-stu-id="deb02-104">![Service&#45;Oriented Solution Patterns](../core/media/service-oriented-solution-patterns.gif "Service_Oriented_Solution_Patterns")</span></span>  
  
## <a name="connections-and-completeness-conditions"></a><span data-ttu-id="deb02-105">连接和完整性条件</span><span class="sxs-lookup"><span data-stu-id="deb02-105">Connections and Completeness Conditions</span></span>  
 <span data-ttu-id="deb02-106">几乎可以从任何位置开始将模式转换为 BizTalk Server 组件。</span><span class="sxs-lookup"><span data-stu-id="deb02-106">We can pretty much start anywhere with translating the patterns into BizTalk Server components.</span></span> <span data-ttu-id="deb02-107">但是，组件之间的连接实际上是组件的基础结构，因此从连接位置开始比较合适。</span><span class="sxs-lookup"><span data-stu-id="deb02-107">However, the connections among the components are, in effect, the infrastructure for the components so that it seems a good place to start.</span></span> <span data-ttu-id="deb02-108">此外，对于聚合模式，需要考虑什么将通知该模式其已具有所需的所有信息。</span><span class="sxs-lookup"><span data-stu-id="deb02-108">Also, in the case of the aggregator pattern, we need to think about what will tell it that it has all of the information it needs.</span></span> <span data-ttu-id="deb02-109">这会影响与其他组件的连接及其设计。</span><span class="sxs-lookup"><span data-stu-id="deb02-109">This affects both its connections to other components as well as its design.</span></span>  
  
 <span data-ttu-id="deb02-110">解决方案需要提供便捷、一致的使用方式。</span><span class="sxs-lookup"><span data-stu-id="deb02-110">The solution needs to provide a convenient and consistent way of being used.</span></span> <span data-ttu-id="deb02-111">服务界面将指定其他应用程序如何使用它。</span><span class="sxs-lookup"><span data-stu-id="deb02-111">The service interface specifies how other applications can use it.</span></span> <span data-ttu-id="deb02-112">由于解决方案需要与使用 IBM WebSphere MQ 的旧版应用程序进行通信，因此 IBM WebSphere MQ 应该是服务界面的一部分。</span><span class="sxs-lookup"><span data-stu-id="deb02-112">Because the solution needs to communicate with a legacy application using IBM WebSphere MQ, IBM WebSphere MQ needs to be part of the service interface.</span></span> <span data-ttu-id="deb02-113">但是，对于较新的应用程序，Web Services 界面是个明显的选择。</span><span class="sxs-lookup"><span data-stu-id="deb02-113">However, for newer applications, a Web service interface seems an obvious choice.</span></span> <span data-ttu-id="deb02-114">Web Services 界面为其他应用程序使用该服务提供了最大的灵活性。</span><span class="sxs-lookup"><span data-stu-id="deb02-114">A Web service interface provides maximum flexibility for other applications using the service.</span></span> <span data-ttu-id="deb02-115">这里，可以利用 BizTalk Server 的灵活性使用双服务界面。</span><span class="sxs-lookup"><span data-stu-id="deb02-115">Here, we can use the flexibility of BizTalk Server to have a dual service interface.</span></span> <span data-ttu-id="deb02-116">有关公开作为 Web 服务的业务流程的信息，请参阅[如何映射到 Web 服务的业务流程](../core/how-to-map-orchestrations-to-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="deb02-116">For information about exposing orchestrations as Web services, see [How to Map Orchestrations to Web Services](../core/how-to-map-orchestrations-to-web-services.md).</span></span>  
  
 <span data-ttu-id="deb02-117">其他连接包括：服务界面和收件人列表之间的连接，收件人列表和后端应用程序之间的连接，后端应用程序、聚合和服务界面之间的连接。</span><span class="sxs-lookup"><span data-stu-id="deb02-117">The other connections are those between the service interface and the recipient list, between the recipient list and the back-end applications, and among the back-end applications, aggregator, and the service interface.</span></span>  
  
 <span data-ttu-id="deb02-118">如果到收件人列表的连接是同步的，则解决方案不需要使用相关来确保到达收件人列表的所有消息均已发送和接收。</span><span class="sxs-lookup"><span data-stu-id="deb02-118">If the connection to the recipient list is synchronous, the solution does not need to use correlations to ensure all messages to the recipient list are sent and received.</span></span> <span data-ttu-id="deb02-119">出于相同原因，可以同步后端应用程序和聚合之间的连接。</span><span class="sxs-lookup"><span data-stu-id="deb02-119">The connections between the back-end applications and the aggregator can be synchronous for the same reasons.</span></span> <span data-ttu-id="deb02-120">聚合需要来自所有三个后端应用程序的响应来完成查询响应。</span><span class="sxs-lookup"><span data-stu-id="deb02-120">The aggregator needs the responses from all three of the back-end applications to complete the query response.</span></span> <span data-ttu-id="deb02-121">响应时间应较短，以便同步连接适当并简化解决方案。</span><span class="sxs-lookup"><span data-stu-id="deb02-121">Response times should be short so that synchronous connections are appropriate and simplify the solution.</span></span>  
  
 <span data-ttu-id="deb02-122">在聚合模式中通常有一个完整性条件。</span><span class="sxs-lookup"><span data-stu-id="deb02-122">In the aggregator pattern, there is usually a completeness condition.</span></span> <span data-ttu-id="deb02-123">如果存在多个后端服务器并且响应时间较慢，则完整性条件可以是（例如）：在给定时间段内至少接收一个响应。</span><span class="sxs-lookup"><span data-stu-id="deb02-123">In cases where there are multiple back-end servers and response times are slow, the completeness condition might be, for example, receiving at least one response in a given time period.</span></span> <span data-ttu-id="deb02-124">此面向服务的解决方案需要所有三个响应，以便构造最终消息。</span><span class="sxs-lookup"><span data-stu-id="deb02-124">This service-oriented solution requires all three responses in order to construct the final message.</span></span> <span data-ttu-id="deb02-125">因此，完整性条件在这里是接收所有三个响应。</span><span class="sxs-lookup"><span data-stu-id="deb02-125">Thus, here, the completeness condition is receiving all three responses.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="deb02-126">在接收时通过 IBM WebSphere MQ 请求，解决方案通过复制将添加相关标识符**MQMD_MsgId**值赋给**MQMD_CorrelId**的响应消息。</span><span class="sxs-lookup"><span data-stu-id="deb02-126">When receiving requests through IBM WebSphere MQ, the solution adds a correlation identifier by copying the **MQMD_MsgId** value to the **MQMD_CorrelId** of the response message.</span></span> <span data-ttu-id="deb02-127">这是在请求-答复中使用 MQSeries 适配器以避免可能争用条件的标准方法的一部分。</span><span class="sxs-lookup"><span data-stu-id="deb02-127">This is part of the standard way of using the MQSeries adapter in request-reply to avoid a possible race condition.</span></span> <span data-ttu-id="deb02-128">有关详细信息，请参阅[关联消息使用请求-答复](../core/correlating-messages-using-request-reply.md)。</span><span class="sxs-lookup"><span data-stu-id="deb02-128">For more information, see [Correlating Messages Using Request-Reply](../core/correlating-messages-using-request-reply.md).</span></span>  
  
## <a name="determining-orchestration-boundaries"></a><span data-ttu-id="deb02-129">确定业务流程边界</span><span class="sxs-lookup"><span data-stu-id="deb02-129">Determining Orchestration Boundaries</span></span>  
 <span data-ttu-id="deb02-130">解决方案必须允许来自 IBM WebSphere MQ 队列以及通过 Web Services 界面的请求。</span><span class="sxs-lookup"><span data-stu-id="deb02-130">The solution must allow for requests from an IBM WebSphere MQ queue as well as through the Web service interface.</span></span> <span data-ttu-id="deb02-131">将服务界面放置在一个业务流程中，将 IBM WebSphere MQ 输入放置在另一个业务流程中，将处理块放置在第三个业务流程中，以确保外部通信与处理相互独立。</span><span class="sxs-lookup"><span data-stu-id="deb02-131">Putting the service interface into one orchestration, the IBM WebSphere MQ input into another, and the bulk of the processing into a third keeps the external communication separated from the processing.</span></span>  
  
## <a name="translating-the-components-into-orchestration-shapes"></a><span data-ttu-id="deb02-132">将组件转换为业务流程形状</span><span class="sxs-lookup"><span data-stu-id="deb02-132">Translating the Components into Orchestration Shapes</span></span>  
 <span data-ttu-id="deb02-133">在最终解决方案中转换为形状的模式在单个业务流程中。</span><span class="sxs-lookup"><span data-stu-id="deb02-133">The patterns to translate into shapes will, in the final solution, be in a single orchestration.</span></span> <span data-ttu-id="deb02-134">在 BizTalk Server 中创建基于内容的路由器有多种方法，包括创建 MessageBox 订阅。</span><span class="sxs-lookup"><span data-stu-id="deb02-134">There are numerous ways to create a content-based router in BizTalk Server, including creating MessageBox subscriptions.</span></span> <span data-ttu-id="deb02-135">在解决方案中，路由使用 MessageBox 订阅。</span><span class="sxs-lookup"><span data-stu-id="deb02-135">In the solution, the routing uses MessageBox subscriptions.</span></span> <span data-ttu-id="deb02-136">表达式形状将评估消息是否包括所需字段的值。</span><span class="sxs-lookup"><span data-stu-id="deb02-136">An expression shape evaluates whether or not the message includes values for the required fields.</span></span> <span data-ttu-id="deb02-137">决策形状评估表达式形状中设置的变量并选择通过业务流程的路径。</span><span class="sxs-lookup"><span data-stu-id="deb02-137">A decision shape evaluates the variable set in the expression shape and selects the path through the orchestration.</span></span>  
  
 <span data-ttu-id="deb02-138">**CustomerService**业务流程使用并行形状来将消息发送到后端应用程序并同时接收响应。</span><span class="sxs-lookup"><span data-stu-id="deb02-138">The **CustomerService** orchestration uses the parallel shape to send messages to the backend applications and receive responses simultaneously.</span></span> <span data-ttu-id="deb02-139">它不必等到一个应用程序完成就可以开始下一个请求。</span><span class="sxs-lookup"><span data-stu-id="deb02-139">It does not have to wait on one application finishing before making the next request.</span></span> <span data-ttu-id="deb02-140">如果应用程序的数目经常变化，或者到应用程序的连接不可靠，则该业务流程需要以不同方式转换模式。</span><span class="sxs-lookup"><span data-stu-id="deb02-140">If the number of applications were to change frequently, or if the connections to the applications were unreliable, then the orchestration would need to translate the pattern differently.</span></span>  
  
 <span data-ttu-id="deb02-141">在解决方案中，聚合必须合并来自三个响应消息的各个元素。</span><span class="sxs-lookup"><span data-stu-id="deb02-141">In the solution the aggregator must combine elements from three response messages.</span></span> <span data-ttu-id="deb02-142">使用并行形状以确保与后端系统的通信是并行的。</span><span class="sxs-lookup"><span data-stu-id="deb02-142">Using the parallel shape ensures that the communication with the back-end systems is parallel.</span></span> <span data-ttu-id="deb02-143">此外，由于形状直到接收到所有响应或超时之后才会终止，因此聚合始终知道何时可以继续操作。</span><span class="sxs-lookup"><span data-stu-id="deb02-143">And, because the shape does not terminate until it receives all responses or a timeout, the aggregator will always know when it can proceed.</span></span> <span data-ttu-id="deb02-144">业务流程使用转换形状将来自三个后端响应消息以及原始请求消息的元素映射到响应消息中的元素。</span><span class="sxs-lookup"><span data-stu-id="deb02-144">The orchestration uses a transform shape that maps elements from the three backend response messages and the original request message to elements in the response message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="deb02-145">与后端系统的通信也可能超时。你可以通过将设置的超时期**接收**中调整**作用域**形状和设置**超时**作用域的属性。</span><span class="sxs-lookup"><span data-stu-id="deb02-145">The communications with the back-end systems may also time out. You can set the time-out period by enclosing the **Receive** shape in a **Scope** shape and setting the **Timeout** property of the scope.</span></span>  
  
 <span data-ttu-id="deb02-146">业务流程形状的完整列表，请参阅[Orchestration 形状](../core/orchestration-shapes.md)。</span><span class="sxs-lookup"><span data-stu-id="deb02-146">For a complete list of orchestration shapes, see [Orchestration Shapes](../core/orchestration-shapes.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="deb02-147">另请参阅</span><span class="sxs-lookup"><span data-stu-id="deb02-147">See Also</span></span>  
 <span data-ttu-id="deb02-148">[在服务中的模式面向解决方案](../core/patterns-in-the-service-oriented-solution.md) </span><span class="sxs-lookup"><span data-stu-id="deb02-148">[Patterns in the Service Oriented Solution](../core/patterns-in-the-service-oriented-solution.md) </span></span>  
 [<span data-ttu-id="deb02-149">服务组件面向解决方案</span><span class="sxs-lookup"><span data-stu-id="deb02-149">Components of the Service Oriented Solution</span></span>](../core/components-of-the-service-oriented-solution.md)