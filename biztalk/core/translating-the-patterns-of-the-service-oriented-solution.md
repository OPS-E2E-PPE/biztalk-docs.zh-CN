---
title: 将服务的模式转换面向解决方案 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- patterns [service solutions], translating patterns to orchestration shapes
- artifacts, patterns
- orchestrations, patterns
- patterns [process management solutions], connections
- patterns [service solutions], orchestration boundaries
- patterns [process management solutions], translating patterns to orchestrations
- orchestrations, boundaries
- patterns [service solutions], translating patterns to artifacts
ms.assetid: ff17cc41-2a7b-4304-b5bd-96b1174cea7f
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 71d95653dbfcbf3937509ceedfe0ff304c602a8b
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65243085"
---
# <a name="translating-the-patterns-of-the-service-oriented-solution"></a><span data-ttu-id="6e2a8-102">将服务的模式转换面向解决方案</span><span class="sxs-lookup"><span data-stu-id="6e2a8-102">Translating the Patterns of the Service Oriented Solution</span></span>
<span data-ttu-id="6e2a8-103">本部分介绍如何在解决方案模式关系图将转换为 BizTalk Server 项目。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-103">This section describes how the solution translates the pattern diagram into BizTalk Server artifacts.</span></span>  
  
 <span data-ttu-id="6e2a8-104">![服务&#45;面向解决方案模式](../core/media/service-oriented-solution-patterns.gif "Service_Oriented_Solution_Patterns")</span><span class="sxs-lookup"><span data-stu-id="6e2a8-104">![Service&#45;Oriented Solution Patterns](../core/media/service-oriented-solution-patterns.gif "Service_Oriented_Solution_Patterns")</span></span>  
  
## <a name="connections-and-completeness-conditions"></a><span data-ttu-id="6e2a8-105">连接和完整性条件</span><span class="sxs-lookup"><span data-stu-id="6e2a8-105">Connections and Completeness Conditions</span></span>  
 <span data-ttu-id="6e2a8-106">我们几乎可以从任何位置开始将模式转换为 BizTalk Server 组件。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-106">We can pretty much start anywhere with translating the patterns into BizTalk Server components.</span></span> <span data-ttu-id="6e2a8-107">但是，各组件之间的连接是，实际上，组件的基础结构，因此启动的好时机。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-107">However, the connections among the components are, in effect, the infrastructure for the components so that it seems a good place to start.</span></span> <span data-ttu-id="6e2a8-108">此外，对于聚合模式中，我们需要考虑什么将通知它具有所有所需的信息。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-108">Also, in the case of the aggregator pattern, we need to think about what will tell it that it has all of the information it needs.</span></span> <span data-ttu-id="6e2a8-109">这会影响这两个连接到其他组件，以及它的设计。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-109">This affects both its connections to other components as well as its design.</span></span>  
  
 <span data-ttu-id="6e2a8-110">该解决方案需要提供一种方便的使用的一致方式。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-110">The solution needs to provide a convenient and consistent way of being used.</span></span> <span data-ttu-id="6e2a8-111">服务接口指定其他应用程序可以使用它。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-111">The service interface specifies how other applications can use it.</span></span> <span data-ttu-id="6e2a8-112">由于解决方案需要与使用 IBM WebSphere MQ 的旧版应用程序进行通信，IBM WebSphere MQ 必须是服务接口的一部分。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-112">Because the solution needs to communicate with a legacy application using IBM WebSphere MQ, IBM WebSphere MQ needs to be part of the service interface.</span></span> <span data-ttu-id="6e2a8-113">但是，对于更高版本的应用程序，Web 服务界面看起来显而易见的选择。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-113">However, for newer applications, a Web service interface seems an obvious choice.</span></span> <span data-ttu-id="6e2a8-114">Web 服务接口提供了其他应用程序使用该服务的最大的灵活性。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-114">A Web service interface provides maximum flexibility for other applications using the service.</span></span> <span data-ttu-id="6e2a8-115">在这里，我们可以使用 BizTalk Server 的灵活性以具有双服务界面。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-115">Here, we can use the flexibility of BizTalk Server to have a dual service interface.</span></span> <span data-ttu-id="6e2a8-116">有关将业务流程作为 Web 服务公开的信息，请参阅[如何映射到 Web 服务的业务流程](../core/how-to-map-orchestrations-to-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-116">For information about exposing orchestrations as Web services, see [How to Map Orchestrations to Web Services](../core/how-to-map-orchestrations-to-web-services.md).</span></span>  
  
 <span data-ttu-id="6e2a8-117">其他连接包括： 服务界面和收件人列表，收件人列表和后端应用程序之间以及在后端应用程序、 聚合和服务接口之间。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-117">The other connections are those between the service interface and the recipient list, between the recipient list and the back-end applications, and among the back-end applications, aggregator, and the service interface.</span></span>  
  
 <span data-ttu-id="6e2a8-118">如果到收件人列表的连接是同步的则不需要使用相关来确保发送和接收到收件人列表的所有消息解决方案。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-118">If the connection to the recipient list is synchronous, the solution does not need to use correlations to ensure all messages to the recipient list are sent and received.</span></span> <span data-ttu-id="6e2a8-119">出于相同原因，可以同步后端应用程序和聚合器之间的连接。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-119">The connections between the back-end applications and the aggregator can be synchronous for the same reasons.</span></span> <span data-ttu-id="6e2a8-120">聚合需要来自所有这三个后端应用程序，以完成查询响应的响应。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-120">The aggregator needs the responses from all three of the back-end applications to complete the query response.</span></span> <span data-ttu-id="6e2a8-121">响应时间应较短，以便同步连接适当并简化此解决方案。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-121">Response times should be short so that synchronous connections are appropriate and simplify the solution.</span></span>  
  
 <span data-ttu-id="6e2a8-122">在聚合器模式下，通常会有一个完整性条件。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-122">In the aggregator pattern, there is usually a completeness condition.</span></span> <span data-ttu-id="6e2a8-123">在其中有多个后端服务器和响应时间较慢的情况下，完整性条件可能，例如，收到至少一个响应在给定的时间段内。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-123">In cases where there are multiple back-end servers and response times are slow, the completeness condition might be, for example, receiving at least one response in a given time period.</span></span> <span data-ttu-id="6e2a8-124">此面向服务的解决方案需要所有三个响应才能构造最终消息。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-124">This service-oriented solution requires all three responses in order to construct the final message.</span></span> <span data-ttu-id="6e2a8-125">因此，在这里，完整性条件接收所有三个响应。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-125">Thus, here, the completeness condition is receiving all three responses.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6e2a8-126">该解决方案时接收的请求通过 IBM WebSphere MQ，通过复制来添加相关标识符**MQMD_MsgId**值设置为**MQMD_CorrelId**的响应消息。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-126">When receiving requests through IBM WebSphere MQ, the solution adds a correlation identifier by copying the **MQMD_MsgId** value to the **MQMD_CorrelId** of the response message.</span></span> <span data-ttu-id="6e2a8-127">这是在请求-答复中使用 MQSeries 适配器以避免可能出现争用情况的标准方法的一部分。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-127">This is part of the standard way of using the MQSeries adapter in request-reply to avoid a possible race condition.</span></span> <span data-ttu-id="6e2a8-128">有关详细信息，请参阅[关联的消息使用请求-答复](../core/correlating-messages-using-request-reply.md)。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-128">For more information, see [Correlating Messages Using Request-Reply](../core/correlating-messages-using-request-reply.md).</span></span>  
  
## <a name="determining-orchestration-boundaries"></a><span data-ttu-id="6e2a8-129">确定业务流程边界</span><span class="sxs-lookup"><span data-stu-id="6e2a8-129">Determining Orchestration Boundaries</span></span>  
 <span data-ttu-id="6e2a8-130">该解决方案必须允许的请求通过 IBM WebSphere MQ 队列以及 Web 服务接口。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-130">The solution must allow for requests from an IBM WebSphere MQ queue as well as through the Web service interface.</span></span> <span data-ttu-id="6e2a8-131">将服务接口放入一个业务流程、 IBM WebSphere MQ 输入放置另一个，并处理到第三个大容量保留的外部通信分开处理。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-131">Putting the service interface into one orchestration, the IBM WebSphere MQ input into another, and the bulk of the processing into a third keeps the external communication separated from the processing.</span></span>  
  
## <a name="translating-the-components-into-orchestration-shapes"></a><span data-ttu-id="6e2a8-132">将组件转换为业务流程形状</span><span class="sxs-lookup"><span data-stu-id="6e2a8-132">Translating the Components into Orchestration Shapes</span></span>  
 <span data-ttu-id="6e2a8-133">若要转换为形状的模式，在最终的解决方案中，将在单个业务流程中。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-133">The patterns to translate into shapes will, in the final solution, be in a single orchestration.</span></span> <span data-ttu-id="6e2a8-134">有很多方法可以在 BizTalk Server，包括创建 MessageBox 订阅中创建基于内容的路由器。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-134">There are numerous ways to create a content-based router in BizTalk Server, including creating MessageBox subscriptions.</span></span> <span data-ttu-id="6e2a8-135">在解决方案中，路由使用 MessageBox 订阅。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-135">In the solution, the routing uses MessageBox subscriptions.</span></span> <span data-ttu-id="6e2a8-136">表达式形状将评估该消息包含为必填字段的值。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-136">An expression shape evaluates whether or not the message includes values for the required fields.</span></span> <span data-ttu-id="6e2a8-137">决策形状评估表达式形状中设置的变量，并选择通过业务流程的路径。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-137">A decision shape evaluates the variable set in the expression shape and selects the path through the orchestration.</span></span>  
  
 <span data-ttu-id="6e2a8-138">**CustomerService**业务流程使用并行形状将消息发送到后端应用程序，同时接收响应。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-138">The **CustomerService** orchestration uses the parallel shape to send messages to the backend applications and receive responses simultaneously.</span></span> <span data-ttu-id="6e2a8-139">它不必等到一个应用程序完成就可以开始下一个请求。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-139">It does not have to wait on one application finishing before making the next request.</span></span> <span data-ttu-id="6e2a8-140">如果应用程序数量要经常发生更改，或连接到应用程序就不可靠，然后业务流程将需要以不同方式转换模式。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-140">If the number of applications were to change frequently, or if the connections to the applications were unreliable, then the orchestration would need to translate the pattern differently.</span></span>  
  
 <span data-ttu-id="6e2a8-141">在解决方案中聚合函数必须将三个响应消息中的元素结合起来。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-141">In the solution the aggregator must combine elements from three response messages.</span></span> <span data-ttu-id="6e2a8-142">使用并行形状可确保与后端系统的通信是并行。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-142">Using the parallel shape ensures that the communication with the back-end systems is parallel.</span></span> <span data-ttu-id="6e2a8-143">并且，由于不会终止形状，直到收到所有响应或超时，因此聚合始终知道时则会继续运行。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-143">And, because the shape does not terminate until it receives all responses or a timeout, the aggregator will always know when it can proceed.</span></span> <span data-ttu-id="6e2a8-144">该业务流程使用转换形状将映射到响应消息中的元素从三个后端响应消息和原始请求消息的元素。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-144">The orchestration uses a transform shape that maps elements from the three backend response messages and the original request message to elements in the response message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6e2a8-145">与后端系统的通信也可能超时。可以通过包含设置的超时期限**接收**形状中**作用域**形状和设置**超时**作用域的属性。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-145">The communications with the back-end systems may also time out. You can set the time-out period by enclosing the **Receive** shape in a **Scope** shape and setting the **Timeout** property of the scope.</span></span>  
  
 <span data-ttu-id="6e2a8-146">业务流程形状的完整列表，请参阅[业务流程形状](../core/orchestration-shapes.md)。</span><span class="sxs-lookup"><span data-stu-id="6e2a8-146">For a complete list of orchestration shapes, see [Orchestration Shapes](../core/orchestration-shapes.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6e2a8-147">请参阅</span><span class="sxs-lookup"><span data-stu-id="6e2a8-147">See Also</span></span>  
 <span data-ttu-id="6e2a8-148">[面向解决方案在服务中的模式](../core/patterns-in-the-service-oriented-solution.md) </span><span class="sxs-lookup"><span data-stu-id="6e2a8-148">[Patterns in the Service Oriented Solution](../core/patterns-in-the-service-oriented-solution.md) </span></span>  
 [<span data-ttu-id="6e2a8-149">面向服务的解决方案的组件</span><span class="sxs-lookup"><span data-stu-id="6e2a8-149">Components of the Service Oriented Solution</span></span>](../core/components-of-the-service-oriented-solution.md)