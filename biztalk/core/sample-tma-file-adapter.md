---
title: 示例 TMA： 文件适配器 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- architecture, examples
- DFD, File adapters
- File adapters, TMA
- examples, File adapters
- security examples [TMA], File adapters
ms.assetid: bcb862c0-fe02-4335-8b59-242d28049e3f
caps.latest.revision: 17
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e8422ae5d3829efc036c85f90fca80ca8f976289
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36982846"
---
# <a name="sample-tma-file-adapter"></a><span data-ttu-id="f4056-102">示例 TMA： 文件适配器</span><span class="sxs-lookup"><span data-stu-id="f4056-102">Sample TMA: File Adapter</span></span>
<span data-ttu-id="f4056-103">本主题对示例结构的文件适配器方案进行威胁模型分析 (TMA)。</span><span class="sxs-lookup"><span data-stu-id="f4056-103">This topic presents the threat model analysis (TMA) for the File adapter scenario for the sample architecture.</span></span> <span data-ttu-id="f4056-104">下图显示了文件适配器方案的示例结构：</span><span class="sxs-lookup"><span data-stu-id="f4056-104">The following figure shows the sample architecture for the File adapter scenario.</span></span>  
  
 <span data-ttu-id="f4056-105">**图 1 示例文件适配器方案的体系结构**</span><span class="sxs-lookup"><span data-stu-id="f4056-105">**Figure 1 Sample architecture for the File adapter scenario**</span></span>  
  
 <span data-ttu-id="f4056-106">![示例文件适配器的体系结构](../core/media/tdi-sec-refarch-file.gif "TDI_Sec_RefArch_File")</span><span class="sxs-lookup"><span data-stu-id="f4056-106">![Sample architecture for File adapter](../core/media/tdi-sec-refarch-file.gif "TDI_Sec_RefArch_File")</span></span>  
  
## <a name="step-1-collect-background-information-file-adapter-scenario"></a><span data-ttu-id="f4056-107">步骤 1.</span><span class="sxs-lookup"><span data-stu-id="f4056-107">Step 1.</span></span> <span data-ttu-id="f4056-108">收集背景信息 （文件适配器方案）</span><span class="sxs-lookup"><span data-stu-id="f4056-108">Collect Background Information (File Adapter Scenario)</span></span>  
 <span data-ttu-id="f4056-109">本部分提供了示例结构的文件适配器方案的数据流关系图 (DFD)。</span><span class="sxs-lookup"><span data-stu-id="f4056-109">This section provides the data flow diagram (DFD) for the File adapter scenario for the sample architecture.</span></span>  
  
 <span data-ttu-id="f4056-110">所有其他背景信息是相同的所有使用方案，以及前面所述[示例方案的背景信息](../core/background-information-for-sample-scenarios.md)。</span><span class="sxs-lookup"><span data-stu-id="f4056-110">All the other background information is the same for all our usage scenarios, and is described previously in [Background Information for Sample Scenarios](../core/background-information-for-sample-scenarios.md).</span></span>  
  
### <a name="data-flow-diagram"></a><span data-ttu-id="f4056-111">数据流关系图</span><span class="sxs-lookup"><span data-stu-id="f4056-111">Data Flow Diagram</span></span>  
 <span data-ttu-id="f4056-112">下图显示了使用文件适配器时示例结构的 DFD：</span><span class="sxs-lookup"><span data-stu-id="f4056-112">The following figure shows the DFD for the sample architecture when you use the File adapter.</span></span>  
  
 <span data-ttu-id="f4056-113">**图 2 DFD 的示例结构的文件适配器方案**</span><span class="sxs-lookup"><span data-stu-id="f4056-113">**Figure 2 DFD for the sample architecture of the File adapter scenario**</span></span>  
  
 <span data-ttu-id="f4056-114">![DFD 的示例体系结构](../core/media/tdi-sec-refarch-dfd-file.gif "TDI_Sec_RefArch_DFD_FILE_")</span><span class="sxs-lookup"><span data-stu-id="f4056-114">![Sample architecture for DFD](../core/media/tdi-sec-refarch-dfd-file.gif "TDI_Sec_RefArch_DFD_FILE_")</span></span>  
  
 <span data-ttu-id="f4056-115">数据流如下所述：</span><span class="sxs-lookup"><span data-stu-id="f4056-115">The data flow is as follows:</span></span>  
  
1.  <span data-ttu-id="f4056-116">合作伙伴将一条消息 （通过防火墙 1) 放在 intranet 外围网络中的文件服务器中。</span><span class="sxs-lookup"><span data-stu-id="f4056-116">A partner puts a message (through Firewall 1) in the File server in the intranet perimeter network.</span></span>  
  
2.  <span data-ttu-id="f4056-117">进程内主机实例的文件接收适配器定期轮询新消息 （通过防火墙 2) 的文件服务器。</span><span class="sxs-lookup"><span data-stu-id="f4056-117">An instance of an in-process host for the File receive adapter regularly polls the File server for new messages (through Firewall 2).</span></span> <span data-ttu-id="f4056-118">会在有新消息后，它将检索消息、 进行初始处理，并将该消息放在 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="f4056-118">After it finds a new message, it retrieves the message, does any initial processing, and puts the message in the MessageBox database.</span></span>  
  
3.  <span data-ttu-id="f4056-119">已订阅该消息的处理主机实例将从 MessageBox 数据库中提取该消息并对其进行所需的任何其他处理，然后将该消息放回 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="f4056-119">An instance of the processing host that has a subscription to the message picks it up from the MessageBox database, does any additional processing, and puts the message back in the MessageBox database.</span></span>  
  
4.  <span data-ttu-id="f4056-120">发送适配器提取该消息具有文件的进程内主机实例将从 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="f4056-120">An instance of the in-process host that has a File send adapter picks up the message from the MessageBox database.</span></span> <span data-ttu-id="f4056-121">该消息完成所有最终处理，发送管道中，通过防火墙 2 然后到文件服务器发送。</span><span class="sxs-lookup"><span data-stu-id="f4056-121">The message goes through any final processing in the send pipeline, and is then sent through Firewall 2 to the File server.</span></span>  
  
5.  <span data-ttu-id="f4056-122">合作伙伴将提取来自文件服务器的消息。</span><span class="sxs-lookup"><span data-stu-id="f4056-122">The partner picks up the message from the File server.</span></span>  
  
## <a name="step-2-create-and-analyze-the-threat-model-file-adapter-scenario"></a><span data-ttu-id="f4056-123">步骤 2.</span><span class="sxs-lookup"><span data-stu-id="f4056-123">Step 2.</span></span> <span data-ttu-id="f4056-124">创建和分析威胁模型 （文件适配器方案）</span><span class="sxs-lookup"><span data-stu-id="f4056-124">Create and Analyze the Threat Model (File Adapter Scenario)</span></span>  
 <span data-ttu-id="f4056-125">本部分提供对示例结构的文件适配器方案执行的 TMA 的结果。</span><span class="sxs-lookup"><span data-stu-id="f4056-125">This section provides the results of the TMA we did for the File adapter scenario for the sample architecture.</span></span>  
  
- <span data-ttu-id="f4056-126">**确定入口点、 信任边界和数据流-** 请参阅之前在"收集背景信息文件适配器方案的"和"适用于所有方案的背景信息。"中介绍的背景信息</span><span class="sxs-lookup"><span data-stu-id="f4056-126">**Identify Entry Points, Trust Boundaries, and Flow of Data -** See background information described earlier in "Collect Background Information for File Adapter Scenario" and "Background Information for all Scenarios."</span></span>  
  
- <span data-ttu-id="f4056-127">**创建的威胁的列表**我们使用以下分类 DFD 中的所有条目来识别潜在威胁的方案： **S**poofing 标识，请**T**ampering使用数据时， **R**表示拒绝，**我**表示信息泄露**D**表示拒绝服务，以及**E**表示特权提升。</span><span class="sxs-lookup"><span data-stu-id="f4056-127">**Create a List of the Identified Threats -** We used the following categorization for all entries in the DFD to identify potential threats to the scenario: **S**poofing identify, **T**ampering with data, **R**epudiation, **I**nformation disclosure, **D**enial of service, and **E**levation of privileges.</span></span> <span data-ttu-id="f4056-128">下表列出了使用文件适配器发送和接收消息与 BizTalk Server 时的各威胁分类。</span><span class="sxs-lookup"><span data-stu-id="f4056-128">The following table lists the threats we identified when you use the File adapter to send and receive messages to and from BizTalk Server.</span></span>  
  
  <span data-ttu-id="f4056-129">**表 1 列表标识的威胁**</span><span class="sxs-lookup"><span data-stu-id="f4056-129">**Table 1 List of identifies threats**</span></span>  
  
|<span data-ttu-id="f4056-130">威胁</span><span class="sxs-lookup"><span data-stu-id="f4056-130">Threat</span></span>|<span data-ttu-id="f4056-131">Description</span><span class="sxs-lookup"><span data-stu-id="f4056-131">Description</span></span>|<span data-ttu-id="f4056-132">资产</span><span class="sxs-lookup"><span data-stu-id="f4056-132">Asset</span></span>|<span data-ttu-id="f4056-133">影响</span><span class="sxs-lookup"><span data-stu-id="f4056-133">Impact</span></span>|  
|------------|-----------------|-----------|------------|  
|<span data-ttu-id="f4056-134">未经授权的用户可以从文件放置文件夹中检索消息</span><span class="sxs-lookup"><span data-stu-id="f4056-134">Unauthorized user can retrieve messages from file drop folder</span></span>|<span data-ttu-id="f4056-135">如果你尚未设置加强的任意访问列表 (Dacl) 的文件夹，文件适配器使用，未经授权的用户可以在该文件中存放消息接收位置，或提取从文件发送位置的消息。</span><span class="sxs-lookup"><span data-stu-id="f4056-135">If you have not set strong discretionary access lists (DACLs) for the folders that the File adapter uses, an unauthorized user can drop messages in the file receive location, or pick up messages from the file send location.</span></span>|<span data-ttu-id="f4056-136">邮件正文</span><span class="sxs-lookup"><span data-stu-id="f4056-136">Message body</span></span>|<span data-ttu-id="f4056-137">篡改数据</span><span class="sxs-lookup"><span data-stu-id="f4056-137">Tampering with data</span></span><br /><br /> <span data-ttu-id="f4056-138">信息泄漏</span><span class="sxs-lookup"><span data-stu-id="f4056-138">Information disclosure</span></span>|  
|<span data-ttu-id="f4056-139">未经授权的用户可将消息提交给 BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="f4056-139">Unauthorized user can submit messages to BizTalk Server</span></span>|<span data-ttu-id="f4056-140">如果用户从其 BizTalk Server 将提取的消息的 file 文件夹具有写权限，未经授权的用户可以将消息提交给 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="f4056-140">If a user has write permissions to the file folder from which BizTalk Server picks up messages, an unauthorized user can submit messages to BizTalk Server.</span></span>|<span data-ttu-id="f4056-141">邮件正文</span><span class="sxs-lookup"><span data-stu-id="f4056-141">Message body</span></span>|<span data-ttu-id="f4056-142">拒绝服务</span><span class="sxs-lookup"><span data-stu-id="f4056-142">Denial of service</span></span><br /><br /> <span data-ttu-id="f4056-143">特权提升</span><span class="sxs-lookup"><span data-stu-id="f4056-143">Elevation of privileges</span></span>|  
  
## <a name="step-3-review-threats-file-adapter-scenario"></a><span data-ttu-id="f4056-144">步骤 3.</span><span class="sxs-lookup"><span data-stu-id="f4056-144">Step 3.</span></span> <span data-ttu-id="f4056-145">查看威胁 （文件适配器方案）</span><span class="sxs-lookup"><span data-stu-id="f4056-145">Review Threats (File Adapter Scenario)</span></span>  
 <span data-ttu-id="f4056-146">本部分提供有关文件适配器方案的示例体系结构的各威胁分类的风险分析的结果。</span><span class="sxs-lookup"><span data-stu-id="f4056-146">This section provides the results of the risk analysis we did for threats we identified for the File adapter scenario for the sample architecture.</span></span> <span data-ttu-id="f4056-147">在主要威胁模型会议后，我们对威胁进行，并使用以下影响类别来划分每种威胁的风险： **D**潜在，损害**R**再现， **E**xploitability， **A**可用户并**D**iscoverability。</span><span class="sxs-lookup"><span data-stu-id="f4056-147">After the main threat model meeting, we reviewed the threats and used the following impact categories to identify the risk for each threat: **D**amage potential, **R**eproducibility, **E**xploitability, **A**ffected users, and **D**iscoverability.</span></span>  
  
 <span data-ttu-id="f4056-148">下表列出了使用文件适配器发送和接收消息与 BizTalk Server 时的各威胁分类的风险等级。</span><span class="sxs-lookup"><span data-stu-id="f4056-148">The following table lists the risk ratings for the threats we identified when you use the File adapter to send and receive messages to and from BizTalk Server.</span></span>  
  
 <span data-ttu-id="f4056-149">**表 2 威胁分类的风险等级**</span><span class="sxs-lookup"><span data-stu-id="f4056-149">**Table 2 Risk ratings for identified threats**</span></span>  
  
|<span data-ttu-id="f4056-150">威胁</span><span class="sxs-lookup"><span data-stu-id="f4056-150">Threat</span></span>|<span data-ttu-id="f4056-151">影响</span><span class="sxs-lookup"><span data-stu-id="f4056-151">Impact</span></span>|<span data-ttu-id="f4056-152">潜在损害</span><span class="sxs-lookup"><span data-stu-id="f4056-152">Damage potential</span></span>|<span data-ttu-id="f4056-153">可再现性</span><span class="sxs-lookup"><span data-stu-id="f4056-153">Reproducibility</span></span>|<span data-ttu-id="f4056-154">可利用性</span><span class="sxs-lookup"><span data-stu-id="f4056-154">Exploitability</span></span>|<span data-ttu-id="f4056-155">受影响的用户</span><span class="sxs-lookup"><span data-stu-id="f4056-155">Affected users</span></span>|<span data-ttu-id="f4056-156">可发现性</span><span class="sxs-lookup"><span data-stu-id="f4056-156">Discoverability</span></span>|<span data-ttu-id="f4056-157">风险度</span><span class="sxs-lookup"><span data-stu-id="f4056-157">Risk exposure</span></span>|  
|------------|------------|----------------------|---------------------|--------------------|--------------------|---------------------|-------------------|  
|<span data-ttu-id="f4056-158">未经授权的用户可以从文件放置文件夹中检索消息</span><span class="sxs-lookup"><span data-stu-id="f4056-158">Unauthorized user can retrieve messages from file drop folder</span></span>|<span data-ttu-id="f4056-159">篡改数据</span><span class="sxs-lookup"><span data-stu-id="f4056-159">Tampering with data</span></span><br /><br /> <span data-ttu-id="f4056-160">信息泄漏</span><span class="sxs-lookup"><span data-stu-id="f4056-160">Information disclosure</span></span>|<span data-ttu-id="f4056-161">4</span><span class="sxs-lookup"><span data-stu-id="f4056-161">4</span></span>|<span data-ttu-id="f4056-162">7</span><span class="sxs-lookup"><span data-stu-id="f4056-162">7</span></span>|<span data-ttu-id="f4056-163">5</span><span class="sxs-lookup"><span data-stu-id="f4056-163">5</span></span>|<span data-ttu-id="f4056-164">4</span><span class="sxs-lookup"><span data-stu-id="f4056-164">4</span></span>|<span data-ttu-id="f4056-165">6</span><span class="sxs-lookup"><span data-stu-id="f4056-165">6</span></span>|<span data-ttu-id="f4056-166">5.2</span><span class="sxs-lookup"><span data-stu-id="f4056-166">5.2</span></span>|  
|<span data-ttu-id="f4056-167">未经授权的用户可将消息提交给 BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="f4056-167">Unauthorized user can submit messages to BizTalk Server</span></span>|<span data-ttu-id="f4056-168">拒绝服务</span><span class="sxs-lookup"><span data-stu-id="f4056-168">Denial of service</span></span><br /><br /> <span data-ttu-id="f4056-169">特权提升</span><span class="sxs-lookup"><span data-stu-id="f4056-169">Elevation of privileges</span></span>|<span data-ttu-id="f4056-170">4</span><span class="sxs-lookup"><span data-stu-id="f4056-170">4</span></span>|<span data-ttu-id="f4056-171">7</span><span class="sxs-lookup"><span data-stu-id="f4056-171">7</span></span>|<span data-ttu-id="f4056-172">5</span><span class="sxs-lookup"><span data-stu-id="f4056-172">5</span></span>|<span data-ttu-id="f4056-173">4</span><span class="sxs-lookup"><span data-stu-id="f4056-173">4</span></span>|<span data-ttu-id="f4056-174">5</span><span class="sxs-lookup"><span data-stu-id="f4056-174">5</span></span>|<span data-ttu-id="f4056-175">5.2</span><span class="sxs-lookup"><span data-stu-id="f4056-175">5.2</span></span>|  
  
## <a name="step-4-identify-mitigation-techniques-file-adapter-scenario"></a><span data-ttu-id="f4056-176">步骤 4.</span><span class="sxs-lookup"><span data-stu-id="f4056-176">Step 4.</span></span> <span data-ttu-id="f4056-177">确定缓解措施 （文件适配器方案）</span><span class="sxs-lookup"><span data-stu-id="f4056-177">Identify Mitigation Techniques (File Adapter Scenario)</span></span>  
 <span data-ttu-id="f4056-178">本部分介绍对示例结构的文件适配器方案的各威胁分类的一些缓解措施。</span><span class="sxs-lookup"><span data-stu-id="f4056-178">This section presents some mitigation techniques for the threats we identified for the File adapter scenario for the sample architecture.</span></span>  
  
 <span data-ttu-id="f4056-179">下表列出了缓解措施时使用文件适配器发送和接收消息与 BizTalk Server 的各威胁分类。</span><span class="sxs-lookup"><span data-stu-id="f4056-179">The following table lists mitigation techniques and technologies for the threats we identified when you use the File adapter to send and receive messages to and from BizTalk Server.</span></span>  
  
 <span data-ttu-id="f4056-180">**表 3 缓解措施和技术**</span><span class="sxs-lookup"><span data-stu-id="f4056-180">**Table 3 Mitigation techniques and technologies**</span></span>  
  
|<span data-ttu-id="f4056-181">威胁</span><span class="sxs-lookup"><span data-stu-id="f4056-181">Threat</span></span>|<span data-ttu-id="f4056-182">影响</span><span class="sxs-lookup"><span data-stu-id="f4056-182">Impact</span></span>|<span data-ttu-id="f4056-183">风险度</span><span class="sxs-lookup"><span data-stu-id="f4056-183">Risk exposure</span></span>|<span data-ttu-id="f4056-184">缓解措施</span><span class="sxs-lookup"><span data-stu-id="f4056-184">Mitigation techniques and technologies</span></span>|  
|------------|------------|-------------------|--------------------------------------------|  
|<span data-ttu-id="f4056-185">未经授权的用户可以从文件放置文件夹中检索消息</span><span class="sxs-lookup"><span data-stu-id="f4056-185">Unauthorized user can retrieve messages from file drop folder</span></span>|<span data-ttu-id="f4056-186">篡改数据</span><span class="sxs-lookup"><span data-stu-id="f4056-186">Tampering with data</span></span><br /><br /> <span data-ttu-id="f4056-187">信息泄漏</span><span class="sxs-lookup"><span data-stu-id="f4056-187">Information disclosure</span></span>|<span data-ttu-id="f4056-188">5.2</span><span class="sxs-lookup"><span data-stu-id="f4056-188">5.2</span></span>|<span data-ttu-id="f4056-189">对于从该 BizTalk Server 将提取的消息的文件夹，使用加强的任意访问列表 (DACL)，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f4056-189">For the folder from which BizTalk Server picks up messages, use a strong discretionary access list (DACL) as follows:</span></span><br /><br /> <span data-ttu-id="f4056-190">-对于运行接收适配器的主机的主机实例的服务帐户，设置读取、 写入、 删除文件，和删除子文件夹和文件权限从中文件接收位置提取消息的目录。</span><span class="sxs-lookup"><span data-stu-id="f4056-190">-   For the service account for the host instance for the host that runs the receive adapter, set read, write, delete files, and delete subfolders and files permissions to the directory from which the file receive location picks up messages.</span></span><br /><span data-ttu-id="f4056-191">-对于外部用户或应用程序将文件放入此文件夹中，将设置写入权限。</span><span class="sxs-lookup"><span data-stu-id="f4056-191">-   For the external user or application that drops files to this folder, set write permissions.</span></span><br /><span data-ttu-id="f4056-192">-对于 BizTalk Administrators 组中，设置完全控制。</span><span class="sxs-lookup"><span data-stu-id="f4056-192">-   For the BizTalk Administrators group, set full control.</span></span><br /><br /> <span data-ttu-id="f4056-193">对于到 BizTalk Server 将删除消息的文件夹，使用强 DACL，如下所示：</span><span class="sxs-lookup"><span data-stu-id="f4056-193">For the folder to which BizTalk Server drops messages, use a strong DACL as follows:</span></span><br /><br /> <span data-ttu-id="f4056-194">-对于运行发送适配器的主机的主机实例的服务帐户，将设置写入权限。</span><span class="sxs-lookup"><span data-stu-id="f4056-194">-   For the service account for the host instance for the host that runs the send adapter, set write permissions.</span></span><br /><span data-ttu-id="f4056-195">-对于外部用户或应用程序将文件放入此文件夹中，设置的读取权限。</span><span class="sxs-lookup"><span data-stu-id="f4056-195">-   For the external user or application that drops files to this folder, set read permissions.</span></span><br /><span data-ttu-id="f4056-196">-对于 BizTalk Administrators 组中，设置完全控制。</span><span class="sxs-lookup"><span data-stu-id="f4056-196">-   For the BizTalk Administrators group, set full control.</span></span>|  
|<span data-ttu-id="f4056-197">未经授权的用户可将消息提交给 BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="f4056-197">Unauthorized user can submit messages to BizTalk Server</span></span>|<span data-ttu-id="f4056-198">拒绝服务</span><span class="sxs-lookup"><span data-stu-id="f4056-198">Denial of service</span></span><br /><br /> <span data-ttu-id="f4056-199">特权提升</span><span class="sxs-lookup"><span data-stu-id="f4056-199">Elevation of privileges</span></span>|<span data-ttu-id="f4056-200">5.2</span><span class="sxs-lookup"><span data-stu-id="f4056-200">5.2</span></span>|<span data-ttu-id="f4056-201">加强的 Dacl 中设置接收位置的存放目录如先前所述。</span><span class="sxs-lookup"><span data-stu-id="f4056-201">Set strong DACLs in the receive location drop directories as indicated earlier.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="f4056-202">请参阅</span><span class="sxs-lookup"><span data-stu-id="f4056-202">See Also</span></span>  
 <span data-ttu-id="f4056-203">[威胁模型分析](../core/threat-model-analysis.md) </span><span class="sxs-lookup"><span data-stu-id="f4056-203">[Threat Model Analysis](../core/threat-model-analysis.md) </span></span>  
 <span data-ttu-id="f4056-204">[威胁模型分析的示例方案](../core/sample-scenarios-for-threat-model-analysis.md) </span><span class="sxs-lookup"><span data-stu-id="f4056-204">[Sample Scenarios for Threat Model Analysis](../core/sample-scenarios-for-threat-model-analysis.md) </span></span>  
 [<span data-ttu-id="f4056-205">中小型公司的示例体系结构</span><span class="sxs-lookup"><span data-stu-id="f4056-205">Sample Architectures for Small & Medium-Sized Companies</span></span>](../core/sample-architectures-for-small-medium-sized-companies.md)