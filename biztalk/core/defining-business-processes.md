---
title: 定义业务流程 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e5e0fdfe-e298-4f32-a7c5-d081b926a206
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 098001041c47b096ab2c2079d4f830e96ed1e19f
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65352398"
---
# <a name="defining-business-processes"></a><span data-ttu-id="4065a-102">定义业务流程</span><span class="sxs-lookup"><span data-stu-id="4065a-102">Defining Business Processes</span></span>
<span data-ttu-id="4065a-103">交换不同系统之间的消息是解决问题的必要组成部分，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]地址。</span><span class="sxs-lookup"><span data-stu-id="4065a-103">The exchange of messages between different systems is a necessary part of solving the problems that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] addresses.</span></span> <span data-ttu-id="4065a-104">但是，真正的目标是定义和执行的应用程序的业务流程。</span><span class="sxs-lookup"><span data-stu-id="4065a-104">The real goal, however, is to define and execute business processes based on the applications.</span></span> <span data-ttu-id="4065a-105">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]引擎使用业务流程来定义这些业务流程的逻辑。</span><span class="sxs-lookup"><span data-stu-id="4065a-105">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine uses orchestrations to define the logic of these business processes.</span></span> <span data-ttu-id="4065a-106">若要创建和评估业务规则组，它使用业务规则引擎。</span><span class="sxs-lookup"><span data-stu-id="4065a-106">To create and evaluate groups of business rules, it uses the Business Rule Engine.</span></span> <span data-ttu-id="4065a-107">本部分介绍业务流程和业务规则引擎。</span><span class="sxs-lookup"><span data-stu-id="4065a-107">This section describes both orchestrations and the Business Rule Engine.</span></span>  
  
## <a name="using-orchestrations"></a><span data-ttu-id="4065a-108">使用业务流程</span><span class="sxs-lookup"><span data-stu-id="4065a-108">Using Orchestrations</span></span>  
 <span data-ttu-id="4065a-109">可以直接在 Microsoft Visual Basic 或 Microsoft Visual C# 等语言中实现自动化的业务流程的逻辑。</span><span class="sxs-lookup"><span data-stu-id="4065a-109">The logic of an automated business process can be implemented directly in a language such as Microsoft Visual Basic or Microsoft Visual C#.</span></span> <span data-ttu-id="4065a-110">尚未在创建、 维护和管理复杂的业务流程的传统编程语言很难。</span><span class="sxs-lookup"><span data-stu-id="4065a-110">Yet creating, maintaining, and managing complex business processes in conventional programming languages can be challenging.</span></span> <span data-ttu-id="4065a-111">与其早期版本不同[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]采用不同的方法。</span><span class="sxs-lookup"><span data-stu-id="4065a-111">Unlike its predecessors, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] takes a different approach.</span></span> <span data-ttu-id="4065a-112">这样，业务经理或开发人员以图形方式定义业务流程。</span><span class="sxs-lookup"><span data-stu-id="4065a-112">It enables business managers or developers to define a business process graphically.</span></span> <span data-ttu-id="4065a-113">执行此操作可构建直接在编程语言中，业务流程相比速度更快，它还使过程易于理解、 阐释和更改。</span><span class="sxs-lookup"><span data-stu-id="4065a-113">Doing this can be faster than building the process directly in a programming language, and it also makes the process easier to understand, explain, and change.</span></span> <span data-ttu-id="4065a-114">以这种方式构建的业务流程还可以更轻松地监视业务活动监视 (BAM) 技术利用了这一事实。</span><span class="sxs-lookup"><span data-stu-id="4065a-114">Business processes built in this fashion can also be monitored more easily, a fact that is exploited by the Business Activity Monitoring (BAM) technology.</span></span>  
  
 <span data-ttu-id="4065a-115">开发人员创建业务流程依赖于三个主要工具： 用于创建 XML 架构，BizTalk 映射器，用于定义这些架构与指定的业务逻辑的业务流程设计器之间的转换在 BizTalk 编辑器处理。</span><span class="sxs-lookup"><span data-stu-id="4065a-115">For a developer, creating an orchestration relies on three primary tools: the BizTalk Editor for creating XML schemas, the BizTalk Mapper for defining translations between those schemas, and the Orchestration Designer for specifying the logic of business processes.</span></span> <span data-ttu-id="4065a-116">所有这些工具都托管在[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]，为开发人员提供了一致的环境。</span><span class="sxs-lookup"><span data-stu-id="4065a-116">All of these tools are hosted inside [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], providing a consistent environment for developers.</span></span> <span data-ttu-id="4065a-117">此部分介绍了这其中每个工具功能以及它们如何协同工作。</span><span class="sxs-lookup"><span data-stu-id="4065a-117">This section describes what each of these tools does and how they work together.</span></span>  
  
### <a name="creating-schemas-the-biztalk-editor"></a><span data-ttu-id="4065a-118">创建架构：在 BizTalk 编辑器</span><span class="sxs-lookup"><span data-stu-id="4065a-118">Creating Schemas: The BizTalk Editor</span></span>  
 <span data-ttu-id="4065a-119">业务流程处理 XML 文档，其中每个符合特定 XML 架构。</span><span class="sxs-lookup"><span data-stu-id="4065a-119">Orchestrations work with XML documents, each of which conforms to some XML schema.</span></span> <span data-ttu-id="4065a-120">在 BizTalk 编辑器开发人员可以定义这些架构，实质上是定义的结构和类型的文档的信息，请使用 XML 架构定义语言 (XSD)。</span><span class="sxs-lookup"><span data-stu-id="4065a-120">The BizTalk Editor enables developers to define these schemas, which essentially define the structure and types of a document’s information, using the XML Schema Definition language (XSD).</span></span>  
  
 <span data-ttu-id="4065a-121">创建没有一些工具支持的原始 XSD 架构并不简单。</span><span class="sxs-lookup"><span data-stu-id="4065a-121">Creating raw XSD schemas without some tool support is not simple.</span></span> <span data-ttu-id="4065a-122">若要使这一必需步骤更易上手，BizTalk 编辑器使用户 — 可能是开发人员 — 通过在图形化层次结构中定义它的元素生成一个架构。</span><span class="sxs-lookup"><span data-stu-id="4065a-122">To make this necessary step more approachable, the BizTalk Editor enables users—probably developers—to build a schema by defining its elements in a graphical hierarchy.</span></span> <span data-ttu-id="4065a-123">此外可以从文件或可访问 Web 服务导入现有的架构。</span><span class="sxs-lookup"><span data-stu-id="4065a-123">Existing schemas can also be imported from either files or accessible Web services.</span></span> <span data-ttu-id="4065a-124">何种方式获得，但架构用作的基础 BizTalk 映射。</span><span class="sxs-lookup"><span data-stu-id="4065a-124">However they’re acquired, schemas are used as the basis for BizTalk maps.</span></span>  
  
### <a name="mapping-between-schemas-the-biztalk-mapper"></a><span data-ttu-id="4065a-125">架构之间的映射：BizTalk 映射器</span><span class="sxs-lookup"><span data-stu-id="4065a-125">Mapping Between Schemas: The BizTalk Mapper</span></span>  
 <span data-ttu-id="4065a-126">通常实现业务流程的业务流程接收一些文档，并发送其他人。</span><span class="sxs-lookup"><span data-stu-id="4065a-126">An orchestration implementing a business process typically receives some documents and sends others.</span></span> <span data-ttu-id="4065a-127">通常情况下，接收到文档中的信息的一部分被传输到发送的文档，可能是以某种方式转换。</span><span class="sxs-lookup"><span data-stu-id="4065a-127">Often, part of the information in the received documents is transferred to the sent documents, perhaps transformed in some way.</span></span> <span data-ttu-id="4065a-128">例如，订单执行流程可能会接收订单某些数目的项，然后发回消息，指出顺序被拒绝，出于某种原因。</span><span class="sxs-lookup"><span data-stu-id="4065a-128">For example, an order fulfillment process might receive an order for some number of items, then send back a message indicating that the order was declined for some reason.</span></span> <span data-ttu-id="4065a-129">信息的顺序，例如请求标识符和数量排序，可以从复制中收到的订单消息的字段到拒绝消息中的字段。</span><span class="sxs-lookup"><span data-stu-id="4065a-129">Information from the order, such as a request identifier and the quantity ordered, might be copied from fields in the received order message into fields in the rejection message.</span></span> <span data-ttu-id="4065a-130">BizTalk 映射器可以用于定义的转换，称为映射到另一个文档中。</span><span class="sxs-lookup"><span data-stu-id="4065a-130">The BizTalk Mapper can be used to define a transformation, called a map, from one document to the other.</span></span>  
  
 <span data-ttu-id="4065a-131">![架构之间的映射](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span><span class="sxs-lookup"><span data-stu-id="4065a-131">![Mapping Between Schemas](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span></span>  
  
 <span data-ttu-id="4065a-132">该图中所示，为每个映射表示为定义这些架构中元素之间的关系的两个 XML 架构间的图形化相关。</span><span class="sxs-lookup"><span data-stu-id="4065a-132">As the figure above shows, each map is expressed as a graphical correlation between two XML schemas that defines a relationship between elements in those schemas.</span></span> <span data-ttu-id="4065a-133">World Wide Web 联合会 (W3C) 已定义为一种标准的方式来表达这些类型的 XML 架构间转换的可扩展样式表语言转换 (XSLT)，并因此在将映射[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]作为 XSLT 转换实现。</span><span class="sxs-lookup"><span data-stu-id="4065a-133">The World Wide Web Consortium (W3C) has defined the Extensible Stylesheet Language Transformation (XSLT) as a standard way to express these kinds of transformations between XML schemas, and so maps in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are implemented as XSLT transformations.</span></span>  
  
 <span data-ttu-id="4065a-134">映射中定义的转换可以非常简单，如将复制到另一个文档中未更改的值。</span><span class="sxs-lookup"><span data-stu-id="4065a-134">The transformation defined in a map can be simple, such as copying values unchanged from one document to another.</span></span> <span data-ttu-id="4065a-135">使用的链接，BizTalk 映射器中显示为一条连接源架构中的相应元素与目标架构中的对应项表示此类的直接数据副本。</span><span class="sxs-lookup"><span data-stu-id="4065a-135">Direct data copies like this are expressed using a link, which is shown in the BizTalk Mapper as a line connecting the appropriate elements in the source schema with their counterparts in the destination schema.</span></span> <span data-ttu-id="4065a-136">更复杂的转换也可使用 functoid。</span><span class="sxs-lookup"><span data-stu-id="4065a-136">More complex transformations are also possible using functoids.</span></span> <span data-ttu-id="4065a-137">Functoid 为一组可执行代码，可以定义 XML 架构之间的任意复杂映射，如上所示，BizTalk 映射器表示它为连接要转换的元素在行框。</span><span class="sxs-lookup"><span data-stu-id="4065a-137">A functoid is a chunk of executable code that can define arbitrarily complex mappings between XML schemas, and as shown above, the BizTalk Mapper represents it as a box on the line connecting the elements being transformed.</span></span> <span data-ttu-id="4065a-138">上述某些转换相当常见，因为[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]包含许多内置 functoid。</span><span class="sxs-lookup"><span data-stu-id="4065a-138">Because some of those transformations are fairly common, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] includes a number of built-in functoids.</span></span> <span data-ttu-id="4065a-139">这些内置 functoid 分为类别，包括以下各项：</span><span class="sxs-lookup"><span data-stu-id="4065a-139">These built-in functoids are grouped into categories, which include the following:</span></span>  
  
- <span data-ttu-id="4065a-140">数学 functoid 用于执行如添加、 相乘，并将源文档中的字段的值以及将结果存储在目标文档中的字段中的操作。</span><span class="sxs-lookup"><span data-stu-id="4065a-140">Mathematical functoids that perform operations such as adding, multiplying, and dividing the values of fields in the source document and storing the result in a field in the target document.</span></span>  
  
- <span data-ttu-id="4065a-141">转换 functoid 将数值转换为其 ASCII 等效项，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="4065a-141">Conversion functoids that convert a numeric value to its ASCII equivalent and vice-versa.</span></span>  
  
- <span data-ttu-id="4065a-142">判断 functoid 可用于确定元素或属性是否应基于源文档中的指定值之间的逻辑比较目标文档中创建。</span><span class="sxs-lookup"><span data-stu-id="4065a-142">Logical functoids that can be used to determine whether an element or attribute should be created in the target document based on a logical comparison between specified values in the source document.</span></span> <span data-ttu-id="4065a-143">这些值可以比较相等，大于比/更少，且以其他方式。</span><span class="sxs-lookup"><span data-stu-id="4065a-143">Those values can be compared for equality, greater than/less than, and in other ways.</span></span>  
  
- <span data-ttu-id="4065a-144">累计 functoid 计算平均值、 总和或其他源文档中的各字段的值，然后将结果存储在目标文档中的单个字段中。</span><span class="sxs-lookup"><span data-stu-id="4065a-144">Cumulative functoids that compute averages, sums, or other values from various fields in the source document, then store the result in a single field in the target document.</span></span>  
  
- <span data-ttu-id="4065a-145">数据库 functoid，可以访问存储在数据库中的信息。</span><span class="sxs-lookup"><span data-stu-id="4065a-145">Database functoids that can access information stored in a database.</span></span>  
  
  <span data-ttu-id="4065a-146">还有可能直接在 XSLT 或使用创建自定义 functoid。Visual C# 和 Visual Basic 等 NET 启用语言。</span><span class="sxs-lookup"><span data-stu-id="4065a-146">It is also possible to create custom functoids directly in XSLT or using .NET-enabled languages like Visual C# and Visual Basic.</span></span> <span data-ttu-id="4065a-147">Functoid 也可以组合在序列中，级联到另一个输入一个输出。</span><span class="sxs-lookup"><span data-stu-id="4065a-147">Functoids can also be combined in sequences, cascading the output of one into the input of another.</span></span>  
  
  <span data-ttu-id="4065a-148">有一种跨具有不同架构的文档定义文档的 XML 架构，以及映射信息的一种机制方法至关重要。</span><span class="sxs-lookup"><span data-stu-id="4065a-148">It is essential that you have a way to define a document’s XML schema, as well as a mechanism for mapping information across documents with different schemas.</span></span> <span data-ttu-id="4065a-149">BizTalk 编辑器和 BizTalk 映射器解决这两个问题。</span><span class="sxs-lookup"><span data-stu-id="4065a-149">The BizTalk Editor and BizTalk Mapper address these two problems.</span></span> <span data-ttu-id="4065a-150">但是，定义架构和映射是仅过程的一部分。</span><span class="sxs-lookup"><span data-stu-id="4065a-150">Yet defining schemas and maps is only part of the process.</span></span> <span data-ttu-id="4065a-151">您还必须指定将使用的架构和调用映射的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="4065a-151">You must also specify the business logic that will use the schemas and invoke the maps.</span></span>  
  
### <a name="defining-business-logic-the-orchestration-designer"></a><span data-ttu-id="4065a-152">定义业务逻辑：业务流程设计器</span><span class="sxs-lookup"><span data-stu-id="4065a-152">Defining Business Logic: The Orchestration Designer</span></span>  
 <span data-ttu-id="4065a-153">业务流程是一组共同满足某些有用的业务需求的操作。</span><span class="sxs-lookup"><span data-stu-id="4065a-153">A business process is a set of actions that together meet some useful business need.</span></span> <span data-ttu-id="4065a-154">使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，开发人员可以使用业务流程设计器以图形方式定义这些操作。</span><span class="sxs-lookup"><span data-stu-id="4065a-154">With [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], a developer can use the Orchestration Designer to define these actions graphically.</span></span> <span data-ttu-id="4065a-155">而不是表示某些编程语言中的步骤，开发人员可以通过将连接在一起一系列形状按逻辑方式创建业务流程。</span><span class="sxs-lookup"><span data-stu-id="4065a-155">Instead of expressing the steps in some programming language, a developer can create an orchestration by connecting together a series of shapes in a logical way.</span></span> <span data-ttu-id="4065a-156">业务流程设计器中可用的形状包括：</span><span class="sxs-lookup"><span data-stu-id="4065a-156">The shapes available in the Orchestration Designer include:</span></span>  
  
- <span data-ttu-id="4065a-157">接收形状，供业务流程接收消息。</span><span class="sxs-lookup"><span data-stu-id="4065a-157">The Receive shape, which allows the orchestration to receive messages.</span></span> <span data-ttu-id="4065a-158">接收形状可以定义将接收的消息类型的筛选器，并且它还可以配置为新消息到达时启动业务流程的新实例。</span><span class="sxs-lookup"><span data-stu-id="4065a-158">A Receive shape can have a filter that defines the types of messages that will be received, and it can also be configured to start a new instance of an orchestration when a new message arrives.</span></span>  
  
- <span data-ttu-id="4065a-159">发送形状，供业务流程发送消息。</span><span class="sxs-lookup"><span data-stu-id="4065a-159">The Send shape, which allows the orchestration to send messages.</span></span>  
  
- <span data-ttu-id="4065a-160">端口形状，用于定义消息的传输方式。</span><span class="sxs-lookup"><span data-stu-id="4065a-160">The Port shape, which defines how messages are transmitted.</span></span> <span data-ttu-id="4065a-161">端口形状的每个实例连接到发送或接收形状。</span><span class="sxs-lookup"><span data-stu-id="4065a-161">Each instance of a Port shape is connected to either a Send or Receive shape.</span></span> <span data-ttu-id="4065a-162">每个端口还具有的类型，用于定义以下内容类型的消息端口可接收;方向，如发送或接收;并确定如何发送或接收的例如一条消息，一个绑定指定特定的 URL 和其他信息。</span><span class="sxs-lookup"><span data-stu-id="4065a-162">Each port also has a type, which defines things such as the kinds of messages the port can receive; a direction, such as send or receive; and a binding, which determines how a message is sent or received by, for example, specifying a particular URL and other information.</span></span>  
  
- <span data-ttu-id="4065a-163">判定形状，表示允许业务流程执行不同任务根据布尔条件-if-then-else 语句。</span><span class="sxs-lookup"><span data-stu-id="4065a-163">The Decide shape, which represents an if-then-else statement that allows an orchestration to perform different tasks based on Boolean conditions.</span></span> <span data-ttu-id="4065a-164">表达式编辑器中，一部分的业务流程设计器中，可以用于指定此类条件语句。</span><span class="sxs-lookup"><span data-stu-id="4065a-164">An Expression Editor, part of the Orchestration Designer, can be used to specify this conditional statement.</span></span>  
  
- <span data-ttu-id="4065a-165">循环形状，它控制的重复执行操作，在特定条件为 true。</span><span class="sxs-lookup"><span data-stu-id="4065a-165">The Loop shape, which controls the repeated performing of an action while some condition is true.</span></span>  
  
- <span data-ttu-id="4065a-166">构造消息形状，用于生成一条消息。</span><span class="sxs-lookup"><span data-stu-id="4065a-166">The Construct Message shape, which allows building a message.</span></span>  
  
- <span data-ttu-id="4065a-167">转换形状，用于将信息从一个文档到另一个，并将其转换通过调用定义的 BizTalk 映射器映射。</span><span class="sxs-lookup"><span data-stu-id="4065a-167">The Transform shape, which allows the transfer of information from one document to another, and transforming it by invoking maps defined with the BizTalk Mapper.</span></span>  
  
- <span data-ttu-id="4065a-168">并行操作形状，它允许开发人员指定并行，而不是序列中应执行多个操作。</span><span class="sxs-lookup"><span data-stu-id="4065a-168">The Parallel Actions shape, which allows a developer to specify that multiple operations should be performed in parallel rather than in sequence.</span></span> <span data-ttu-id="4065a-169">所有的并行操作完成之前，不执行跟随此形状。</span><span class="sxs-lookup"><span data-stu-id="4065a-169">The shape that follows this one is not executed until all of the parallel actions have completed.</span></span>  
  
- <span data-ttu-id="4065a-170">作用域形状，用于为事务的操作的分组以及定义错误处理的异常处理程序。</span><span class="sxs-lookup"><span data-stu-id="4065a-170">The Scope shape, which allows the grouping of operations into transactions and defining exception handlers for error handling.</span></span> <span data-ttu-id="4065a-171">支持传统原子事务和长时间运行的事务。</span><span class="sxs-lookup"><span data-stu-id="4065a-171">Both traditional atomic transactions and long-running transactions are supported.</span></span> <span data-ttu-id="4065a-172">与不同的原子事务、 长时间运行的事务依赖补偿逻辑而不是非回滚来处理意外的事件。</span><span class="sxs-lookup"><span data-stu-id="4065a-172">Unlike atomic transactions, long-running transactions rely on compensating logic rather than rollback to handle unexpected events.</span></span>  
  
- <span data-ttu-id="4065a-173">消息赋值形状，用于将值分配到业务流程变量。</span><span class="sxs-lookup"><span data-stu-id="4065a-173">The Message Assignment shape, which allows assigning values to orchestration variables.</span></span> <span data-ttu-id="4065a-174">可以使用这些变量来存储使用的业务流程，如字符串或要创建的消息的状态信息。</span><span class="sxs-lookup"><span data-stu-id="4065a-174">These variables can be used to store state information used by the orchestration, such as a message being created or a character string.</span></span>  
  
  <span data-ttu-id="4065a-175">下图显示了在业务流程设计器中创建业务流程使用几个这些形状。</span><span class="sxs-lookup"><span data-stu-id="4065a-175">The figure below shows an orchestration created in the Orchestration Designer using a few of these shapes.</span></span> <span data-ttu-id="4065a-176">在此简单示例中，收到一条消息、 决定根据对该消息的内容和结果执行的两个路径之一。</span><span class="sxs-lookup"><span data-stu-id="4065a-176">In this simple example, a message is received, a decision is made based on the content of that message, and one of two paths is executed as a result of that decision.</span></span> <span data-ttu-id="4065a-177">解决实际问题的业务流程可以是复杂得多比这一点;若要使这些更复杂的关系图更轻松地使用，业务流程设计器包括放大和缩小功能。开发人员可以查看只有他们当前感兴趣的业务流程的那些部分。</span><span class="sxs-lookup"><span data-stu-id="4065a-177">Orchestrations that solve real problems can be significantly more complex than this; to make these more complex diagrams easier to work with, the Orchestration Designer includes the ability to zoom in and out. Developers can view only those parts of an orchestration that they are currently interested in.</span></span>  
  
  <span data-ttu-id="4065a-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span><span class="sxs-lookup"><span data-stu-id="4065a-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span></span>  
  
  <span data-ttu-id="4065a-179">开发人员定义了业务流程后，组形状和它们之间的关系将转换为 Microsoft 中间语言 (MSIL) 使用由.NET Framework 公共语言运行时 (CLR)。</span><span class="sxs-lookup"><span data-stu-id="4065a-179">After a developer has defined an orchestration, the group of shapes and relations between them is converted into the Microsoft Intermediate Language (MSIL) used by the .NET Framework’s Common Language Runtime (CLR).</span></span> <span data-ttu-id="4065a-180">从根本上讲，BizTalk Server 开发人员定义的形状的组将成为只是一个标准。启用 NET 的程序集。</span><span class="sxs-lookup"><span data-stu-id="4065a-180">Ultimately, the group of shapes defined by a BizTalk Server developer becomes just a standard .NET-enabled assembly.</span></span> <span data-ttu-id="4065a-181">此外可以将显式代码添加到业务流程在必要时，通过调用 COM 或.NET 对象中，在形状内。</span><span class="sxs-lookup"><span data-stu-id="4065a-181">You can also add explicit code to an orchestration when necessary by calling a COM or .NET object from inside a shape.</span></span>  
  
### <a name="the-role-of-web-services"></a><span data-ttu-id="4065a-182">Web 服务的角色</span><span class="sxs-lookup"><span data-stu-id="4065a-182">The Role of Web Services</span></span>  
 <span data-ttu-id="4065a-183">Web 服务允许应用程序交换使用 SOAP、 XML 文档，并对集成平台有很大的影响。</span><span class="sxs-lookup"><span data-stu-id="4065a-183">Web services allow applications to exchange XML documents using SOAP, and have had a significant impact on integration platforms.</span></span> <span data-ttu-id="4065a-184">若要访问外部 Web 服务，业务流程的创建者可以使用中的添加 Web 引用选项[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]以及 Web Services 适配器来直接调用操作。</span><span class="sxs-lookup"><span data-stu-id="4065a-184">To access an external Web service, an orchestration’s creator can use the Add Web Reference option in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] along with the Web Services adapter to directly invoke operations.</span></span> <span data-ttu-id="4065a-185">同样，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]提供了可生成 ASP.NET Web 服务项目，将一个或多个业务流程的操作为 SOAP 可调用 Web 服务公开的 Web Services 发布向导。</span><span class="sxs-lookup"><span data-stu-id="4065a-185">Similarly, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] provides a Web Services Publishing wizard that can generate an ASP.NET Web service project exposing one or more of an orchestration’s operations as SOAP-callable Web services.</span></span> <span data-ttu-id="4065a-186">这两个选项允许开发人员能够同时访问从业务流程中的现有 Web 服务并公开为 Web 服务与其他业务流程的业务流程的功能。</span><span class="sxs-lookup"><span data-stu-id="4065a-186">These two options allow developers to both access existing Web services from within a business process and expose an orchestration’s functionality as a Web service to other business processes.</span></span>  
  
- <span data-ttu-id="4065a-187">Web 服务的出现还会影响业务流程的定义。</span><span class="sxs-lookup"><span data-stu-id="4065a-187">The rise of Web services also has an impact on how business processes are defined.</span></span> <span data-ttu-id="4065a-188">例如，考虑这种情况，两个组织使用 Web 服务进行交互。</span><span class="sxs-lookup"><span data-stu-id="4065a-188">For example, think about the case where two organizations interact using Web services.</span></span> <span data-ttu-id="4065a-189">若要有效地进行交互操作，可能会有所了解对方使用的业务流程的交互对所需的每个参与方。</span><span class="sxs-lookup"><span data-stu-id="4065a-189">To interoperate effectively, it might be necessary for each party to the interaction to know something about the business process the other is using.</span></span> <span data-ttu-id="4065a-190">如果这两个组织都使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，这不是大问题; 可以使用贸易合作伙伴管理技术等工具来分发这些信息。</span><span class="sxs-lookup"><span data-stu-id="4065a-190">If both organizations use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], this isn’t a big problem; tools such as the Trading Partner Management technology can be used to distribute this knowledge.</span></span> <span data-ttu-id="4065a-191">但如果它们使用不同的产品？</span><span class="sxs-lookup"><span data-stu-id="4065a-191">But what if they use different products?</span></span> <span data-ttu-id="4065a-192">这种情况下，最好有办法以非供应商特定的方式描述业务流程的方面。</span><span class="sxs-lookup"><span data-stu-id="4065a-192">For cases like this, it is useful to have a way to describe aspects of business processes in a non-vendor specific way.</span></span>  
  
  <span data-ttu-id="4065a-193">为此，Microsoft、 IBM 和其他人已创建业务流程执行语言 (BPEL)。</span><span class="sxs-lookup"><span data-stu-id="4065a-193">To allow this, Microsoft, IBM, and others have created the Business Process Execution Language (BPEL).</span></span> <span data-ttu-id="4065a-194">使用业务流程设计器定义的业务流程可以导出为 bpel 格式，和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]还可以导入用 BPEL 定义。</span><span class="sxs-lookup"><span data-stu-id="4065a-194">A business process defined using the Orchestration Designer can be exported to BPEL, and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] can also import processes defined in BPEL.</span></span> <span data-ttu-id="4065a-195">用于描述和共享业务流程的外部可见部分语言时，BPEL 更着重于解决此问题，而非在跨平台执行整个业务流程。</span><span class="sxs-lookup"><span data-stu-id="4065a-195">While the language is useful for describing and sharing externally visible parts of a business process, BPEL is focused more on solving this problem than on cross-platform execution of complete business processes.</span></span> <span data-ttu-id="4065a-196">也很重要若要了解 BPEL 完全基于 Web 服务，而[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]和其他支持此语言的产品提供的详细信息。</span><span class="sxs-lookup"><span data-stu-id="4065a-196">It’s also important to understand that BPEL is built entirely on Web services, while [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and other products that support this language provide more.</span></span> <span data-ttu-id="4065a-197">例如，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]支持不同的 XML 架构之间的映射、 调用本地对象和 BPEL 中未提供其他功能中的方法。</span><span class="sxs-lookup"><span data-stu-id="4065a-197">For example, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] supports mapping between different XML schemas, calling methods in local objects, and other features that aren’t available in BPEL.</span></span> <span data-ttu-id="4065a-198">有关这些和其他原因，BPEL 并不是一种用于定义业务流程的完整语言。</span><span class="sxs-lookup"><span data-stu-id="4065a-198">For these and other reasons, BPEL isn’t a complete language for defining business processes.</span></span> <span data-ttu-id="4065a-199">并假定 BPEL 是仍在进行标准化的进步的结构化信息标准组织 (OASIS) 过程中，很难看作完全成熟的技术。</span><span class="sxs-lookup"><span data-stu-id="4065a-199">And given that BPEL is still in the process of being standardized by the Organization for the Advancement of Structured Information Standards (OASIS), it’s hard to view it today as a fully mature technology.</span></span>  
  
- <span data-ttu-id="4065a-200">业务流程是 BizTalk Server 中创建业务流程的基本机制。</span><span class="sxs-lookup"><span data-stu-id="4065a-200">Orchestrations are the fundamental mechanism for creating business processes in BizTalk Server.</span></span> <span data-ttu-id="4065a-201">业务流程的某些方面往往会更改次数多过其他，但是。</span><span class="sxs-lookup"><span data-stu-id="4065a-201">Some aspects of an orchestration tend to change more often than others, however.</span></span> <span data-ttu-id="4065a-202">具体而言，业务流程中嵌入的决策 — 业务规则 — 通常是其最容易发生变化。</span><span class="sxs-lookup"><span data-stu-id="4065a-202">In particular, the decisions embedded in a business process—the business rules—are commonly its most volatile aspect.</span></span> <span data-ttu-id="4065a-203">管理器的支出限制为 100,000 美元的奖金过去一周，但升迁，这最多 500,000 美元或从 100 个单位的慢速付费客户的最大允许的订单减少至仅有 10。</span><span class="sxs-lookup"><span data-stu-id="4065a-203">A manager’s spending limit was $100,000 last week, but her promotion bumps this up to $500,000, or a slow-paying customer’s maximum allowed order decreases from 100 units to only 10.</span></span> <span data-ttu-id="4065a-204">您可以指定和更新这些规则使用业务规则引擎。</span><span class="sxs-lookup"><span data-stu-id="4065a-204">You can specify and update these rules using the  Business Rule Engine.</span></span>  
  
## <a name="using-the-business-rule-engine"></a><span data-ttu-id="4065a-205">使用业务规则引擎</span><span class="sxs-lookup"><span data-stu-id="4065a-205">Using the Business Rule Engine</span></span>  
 <span data-ttu-id="4065a-206">业务流程设计器中，以及在 BizTalk 编辑器和 BizTalk 映射器中，提供一种有效的方式来定义业务流程和它使用的规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-206">The Orchestration Designer, together with the BizTalk Editor and the BizTalk Mapper, provide an effective way to define a business process and the rules it uses.</span></span> <span data-ttu-id="4065a-207">它可能很有用，但是，能够轻松地定义和更改业务规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-207">It can be useful, however, to have an easier way to define and change business rules.</span></span> <span data-ttu-id="4065a-208">为此，BizTalk Server 提供业务规则引擎 (BRE)。</span><span class="sxs-lookup"><span data-stu-id="4065a-208">To allow this, BizTalk Server provides the Business Rule Engine (BRE).</span></span> <span data-ttu-id="4065a-209">开发人员经常会使用 BRE，但更多面向业务的用户可以创建和修改业务规则使用名为业务规则编辑器的工具集。</span><span class="sxs-lookup"><span data-stu-id="4065a-209">Developers will most often use the BRE, but more business-oriented users can create and modify sets of business rules using a tool called the Business Rule Composer.</span></span>  
  
 <span data-ttu-id="4065a-210">BRE 可的一个情况是业务的一种复杂规则必须进行评估设置。</span><span class="sxs-lookup"><span data-stu-id="4065a-210">One situation in which the BRE is useful is when a complex set of business rules must be evaluated.</span></span> <span data-ttu-id="4065a-211">例如，在决定是否发放贷款时，可能需要通过大量的基于客户的信用额度历史记录、 收入和其他因素的规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-211">Deciding whether to grant a loan, for example, might entail working through a large set of rules based on the customer’s credit history, income, and other factors.</span></span> <span data-ttu-id="4065a-212">同样，确定是否向申请人销售人寿保险取决于许多因素，包括申请人的年龄、 性别和运行状况。</span><span class="sxs-lookup"><span data-stu-id="4065a-212">Similarly, determining whether to sell life insurance to an applicant depends on a number of things, including the applicant’s age, gender, and health.</span></span> <span data-ttu-id="4065a-213">表示所有这些规则作为使用条件语句，说，业务流程的判定形状可能是有可能，但是会非常复杂，来实现。</span><span class="sxs-lookup"><span data-stu-id="4065a-213">Expressing all of these rules as conditional statements using, say, an orchestration’s Decide shape might be possible, but would be fairly complex to implement.</span></span> <span data-ttu-id="4065a-214">这些规则密集型流程，BRE 可使开发人员的生活更简单。</span><span class="sxs-lookup"><span data-stu-id="4065a-214">For rule-intensive processes like these, the BRE can make a developer’s life simpler.</span></span>  
  
 <span data-ttu-id="4065a-215">使用 BRE，开发人员可以快速并轻松地根据需要更改规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-215">Using the BRE, developers can quickly and easily change rules as needed.</span></span> <span data-ttu-id="4065a-216">要了解原因，考虑一下所需更改业务流程中实现的业务规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-216">To see why, think about what’s required to change a business rule that’s implemented within an orchestration.</span></span> <span data-ttu-id="4065a-217">开发人员必须首先打开中的业务流程[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]，修改相应的形状 （和可能是调用.NET 或 COM 对象它们），然后生成并部署修改后的程序集。</span><span class="sxs-lookup"><span data-stu-id="4065a-217">A developer must first open the orchestration in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], modify the appropriate shapes (and perhaps the .NET or COM objects they invoke), and then build and deploy the modified assembly.</span></span> <span data-ttu-id="4065a-218">另外，还需要停止并重新启动包含此业务流程的 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="4065a-218">Doing this also requires stopping and restarting the BizTalk application that includes this orchestration.</span></span> <span data-ttu-id="4065a-219">如果改为使用 BRE 实现此业务规则，它可以无需重新编译或重新启动任何修改。</span><span class="sxs-lookup"><span data-stu-id="4065a-219">If instead this business rule is implemented using the BRE, it can be modified without recompiling or restarting anything.</span></span> <span data-ttu-id="4065a-220">所有需要的只是使用业务规则编辑器来更改所需的规则，然后重新部署新的规则集。</span><span class="sxs-lookup"><span data-stu-id="4065a-220">All that’s needed is to use the Business Rule Composer to change the desired rule, then redeploy the new set of rules.</span></span> <span data-ttu-id="4065a-221">此更改将立即生效。</span><span class="sxs-lookup"><span data-stu-id="4065a-221">The change takes effect immediately.</span></span> <span data-ttu-id="4065a-222">和业务流程通常创建和维护由开发人员，业务规则用于读取，在某些情况下可以进行修改而无需涉及到更多技术人员的业务分析师。</span><span class="sxs-lookup"><span data-stu-id="4065a-222">And while orchestrations are typically created and maintained by developers, business rules are readable enough that in some cases they can be modified by business analysts without the need to involve more technical people.</span></span>  
  
 <span data-ttu-id="4065a-223">通过使用业务规则编辑器来指定这些规则定义用于词汇通常开始的一组业务规则的创建者。</span><span class="sxs-lookup"><span data-stu-id="4065a-223">The creator of a set of business rules typically begins by using the Business Rule Composer to define a vocabulary for use in specifying those rules.</span></span> <span data-ttu-id="4065a-224">词汇中的每一项提供了一些信息的用户友好名称。</span><span class="sxs-lookup"><span data-stu-id="4065a-224">Each term in the vocabulary provides a user-friendly name for some information.</span></span> <span data-ttu-id="4065a-225">例如，词汇表可能会定义诸如 Number Shipped 或 Maximum Quantity of Items 或 Approval Limit 之类的术语。</span><span class="sxs-lookup"><span data-stu-id="4065a-225">For example, a vocabulary might define terms such as Number Shipped or Maximum Quantity of Items or Approval Limit.</span></span> <span data-ttu-id="4065a-226">每个这些术语可设置为常数或映射到特定元素或属性，在某些 XML 架构 （并且因此将传入消息中），或者针对一些数据库的 SQL 查询的结果或甚至到.NET 对象中的值映射。</span><span class="sxs-lookup"><span data-stu-id="4065a-226">Each of these terms can be set to a constant or be mapped to a particular element or attribute in some XML schema (and thus in an incoming message) or to the result of a SQL query against some database or even to a value in a .NET object.</span></span>  
  
 <span data-ttu-id="4065a-227">定义词汇后，可以使用业务规则编辑器来创建使用此词汇表的业务策略。</span><span class="sxs-lookup"><span data-stu-id="4065a-227">After a vocabulary has been defined, the Business Rule Composer can be used to create business policies that use this vocabulary.</span></span> <span data-ttu-id="4065a-228">每个策略可以包含一个或多个业务规则。</span><span class="sxs-lookup"><span data-stu-id="4065a-228">Each policy can contain one or more business rules.</span></span> <span data-ttu-id="4065a-229">规则使用在某个词汇表以及逻辑运算符，例如大于、 小于、 等于，和其他定义的术语来定义业务流程的运行方式。</span><span class="sxs-lookup"><span data-stu-id="4065a-229">A rule uses the terms defined in some vocabulary together with logical operators such as Greater Than, Less Than, Is Equal To, and others to define how a business process operates.</span></span> <span data-ttu-id="4065a-230">业务规则可以定义在收到的 XML 文档中包含的值应如何影响所发送 XML 文档中创建的值或这些收到的值应影响哪些值用一个数据库，以及其他内容。</span><span class="sxs-lookup"><span data-stu-id="4065a-230">A business rule can define how values contained in a received XML document should affect the values created in an XML document that’s sent, or how those received values should affect what value is written in a database, or other things.</span></span>  
  
 <span data-ttu-id="4065a-231">若要执行的业务策略，业务流程使用调用规则形状。</span><span class="sxs-lookup"><span data-stu-id="4065a-231">To execute a business policy, an orchestration uses a CallRules shape.</span></span> <span data-ttu-id="4065a-232">此形状将创建 BRE 的实例，指定要执行，然后传入此策略所需，如接收 XML 文档的信息的策略。</span><span class="sxs-lookup"><span data-stu-id="4065a-232">This shape creates an instance of the BRE, specifies which policy to execute, then passes in the information this policy needs, such as a received XML document.</span></span> <span data-ttu-id="4065a-233">此外可以使用以编程方式调用 BRE。基于网络的对象模型中，这使它在不使用的应用程序中调用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="4065a-233">The BRE can also be invoked programmatically using a .NET-based object model, which allows it to be called from applications that don’t use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="4065a-234">这意味着该 Windows 窗体应用程序、 公开 Web services 的软件，和任何其他.NET Framework 上构建可以使用 BRE 只要它可帮助解决的问题。</span><span class="sxs-lookup"><span data-stu-id="4065a-234">This means that Windows Forms applications, software exposing Web services, and anything else built on the .NET Framework can potentially use the BRE whenever it helps solve the problem at hand.</span></span>  
  
 <span data-ttu-id="4065a-235">词汇和业务规则可以是复杂得多 — 和强大得多 — 比此处所述的简单示例。</span><span class="sxs-lookup"><span data-stu-id="4065a-235">Both vocabularies and business rules can be much more complicated—and much more powerful—than the simple examples described here.</span></span> <span data-ttu-id="4065a-236">但定义词汇表、 然后定义使用该词汇表的规则集的核心理念是业务规则引擎的核心。</span><span class="sxs-lookup"><span data-stu-id="4065a-236">But the core idea of defining a vocabulary, then defining sets of rules that use that vocabulary is the heart of the Business Rule Engine.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4065a-237">请参阅</span><span class="sxs-lookup"><span data-stu-id="4065a-237">See Also</span></span>  
 [<span data-ttu-id="4065a-238">BizTalk Server 消息引擎</span><span class="sxs-lookup"><span data-stu-id="4065a-238">The BizTalk Server Messaging Engine</span></span>](../core/the-biztalk-server-messaging-engine.md)