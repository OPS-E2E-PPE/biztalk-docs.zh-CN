---
title: 定义业务流程 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e5e0fdfe-e298-4f32-a7c5-d081b926a206
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 50d4d884f60e53fbad465d2b22948a6df6b69256
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37002206"
---
# <a name="defining-business-processes"></a><span data-ttu-id="66989-102">定义业务流程</span><span class="sxs-lookup"><span data-stu-id="66989-102">Defining Business Processes</span></span>
<span data-ttu-id="66989-103">解决 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 所涉及的问题时需要在不同系统间交换消息。</span><span class="sxs-lookup"><span data-stu-id="66989-103">The exchange of messages between different systems is a necessary part of solving the problems that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] addresses.</span></span> <span data-ttu-id="66989-104">不过，交换消息的实际目的是根据应用程序定义和执行业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-104">The real goal, however, is to define and execute business processes based on the applications.</span></span> <span data-ttu-id="66989-105">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 引擎使用业务流程来定义这些业务程序的逻辑。</span><span class="sxs-lookup"><span data-stu-id="66989-105">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine uses orchestrations to define the logic of these business processes.</span></span> <span data-ttu-id="66989-106">另外，它还使用业务规则引擎来创建和评估业务规则组。</span><span class="sxs-lookup"><span data-stu-id="66989-106">To create and evaluate groups of business rules, it uses the Business Rule Engine.</span></span> <span data-ttu-id="66989-107">本部分介绍业务流程和业务规则引擎。</span><span class="sxs-lookup"><span data-stu-id="66989-107">This section describes both orchestrations and the Business Rule Engine.</span></span>  
  
## <a name="using-orchestrations"></a><span data-ttu-id="66989-108">使用业务流程</span><span class="sxs-lookup"><span data-stu-id="66989-108">Using Orchestrations</span></span>  
 <span data-ttu-id="66989-109">自动化业务流程的逻辑可以通过语言（如 Microsoft Visual Basic 或 Microsoft Visual C#）直接实现。</span><span class="sxs-lookup"><span data-stu-id="66989-109">The logic of an automated business process can be implemented directly in a language such as Microsoft Visual Basic or Microsoft Visual C#.</span></span> <span data-ttu-id="66989-110">然而，使用传统编程语言创建、维护和管理复杂的业务流程可能会非常困难。</span><span class="sxs-lookup"><span data-stu-id="66989-110">Yet creating, maintaining, and managing complex business processes in conventional programming languages can be challenging.</span></span> <span data-ttu-id="66989-111">与其早期版本不同，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 采用一种不同的方法。</span><span class="sxs-lookup"><span data-stu-id="66989-111">Unlike its predecessors, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] takes a different approach.</span></span> <span data-ttu-id="66989-112">使用此版本的 BizTalk Server，业务经理或开发人员可以按图形方式定义业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-112">It enables business managers or developers to define a business process graphically.</span></span> <span data-ttu-id="66989-113">与使用编程语言直接构建业务流程相比，这种方法更快，并且使业务流程更易于理解、阐释和更改。</span><span class="sxs-lookup"><span data-stu-id="66989-113">Doing this can be faster than building the process directly in a programming language, and it also makes the process easier to understand, explain, and change.</span></span> <span data-ttu-id="66989-114">另外，使用这种方法构建的业务流程也更易于监视，这正是业务活动监视 (BAM) 功能所需的。</span><span class="sxs-lookup"><span data-stu-id="66989-114">Business processes built in this fashion can also be monitored more easily, a fact that is exploited by the Business Activity Monitoring (BAM) technology.</span></span>  
  
 <span data-ttu-id="66989-115">开发人员创建业务流程依赖于三个主要工具： 用于创建 XML 架构，BizTalk 映射器，用于定义这些架构与指定的业务逻辑的业务流程设计器之间的转换在 BizTalk 编辑器处理。</span><span class="sxs-lookup"><span data-stu-id="66989-115">For a developer, creating an orchestration relies on three primary tools: the BizTalk Editor for creating XML schemas, the BizTalk Mapper for defining translations between those schemas, and the Orchestration Designer for specifying the logic of business processes.</span></span> <span data-ttu-id="66989-116">所有这些工具均以 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 为宿主，从而为开发人员提供了一致的环境。</span><span class="sxs-lookup"><span data-stu-id="66989-116">All of these tools are hosted inside [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], providing a consistent environment for developers.</span></span> <span data-ttu-id="66989-117">本部分介绍了这其中的每种工具的功能以及这些工具协同工作的方式。</span><span class="sxs-lookup"><span data-stu-id="66989-117">This section describes what each of these tools does and how they work together.</span></span>  
  
### <a name="creating-schemas-the-biztalk-editor"></a><span data-ttu-id="66989-118">创建架构： BizTalk 编辑器</span><span class="sxs-lookup"><span data-stu-id="66989-118">Creating Schemas: The BizTalk Editor</span></span>  
 <span data-ttu-id="66989-119">业务流程处理的各种 XML 文档均遵循某种 XML 架构。</span><span class="sxs-lookup"><span data-stu-id="66989-119">Orchestrations work with XML documents, each of which conforms to some XML schema.</span></span> <span data-ttu-id="66989-120">通过 BizTalk 编辑器，开发人员可以使用 XML 架构定义语言 (XSD) 来定义这些架构，这些架构主要定义文档信息的结构和类型。</span><span class="sxs-lookup"><span data-stu-id="66989-120">The BizTalk Editor enables developers to define these schemas, which essentially define the structure and types of a document’s information, using the XML Schema Definition language (XSD).</span></span>  
  
 <span data-ttu-id="66989-121">不借助某些工具，从头创建 XSD 架构将会非常困难。</span><span class="sxs-lookup"><span data-stu-id="66989-121">Creating raw XSD schemas without some tool support is not simple.</span></span> <span data-ttu-id="66989-122">为了更方便地完成这一必需步骤，可以使用 BizTalk 编辑器，这样用户（可能是开发人员）就可以通过在图形化层次结构中定义架构元素来生成架构。</span><span class="sxs-lookup"><span data-stu-id="66989-122">To make this necessary step more approachable, the BizTalk Editor enables users—probably developers—to build a schema by defining its elements in a graphical hierarchy.</span></span> <span data-ttu-id="66989-123">也可以从文件或可访问的 Web Services 中导入现有架构。</span><span class="sxs-lookup"><span data-stu-id="66989-123">Existing schemas can also be imported from either files or accessible Web services.</span></span> <span data-ttu-id="66989-124">不管以何种方式获得，这些架构都将用作 BizTalk 映射的基础。</span><span class="sxs-lookup"><span data-stu-id="66989-124">However they’re acquired, schemas are used as the basis for BizTalk maps.</span></span>  
  
### <a name="mapping-between-schemas-the-biztalk-mapper"></a><span data-ttu-id="66989-125">架构之间的映射： BizTalk 映射器</span><span class="sxs-lookup"><span data-stu-id="66989-125">Mapping Between Schemas: The BizTalk Mapper</span></span>  
 <span data-ttu-id="66989-126">实现业务流程的业务流程往往会接收一些文档并发送其他文档。</span><span class="sxs-lookup"><span data-stu-id="66989-126">An orchestration implementing a business process typically receives some documents and sends others.</span></span> <span data-ttu-id="66989-127">通常，会将接收到的文档中的部分信息传输到已发送的文档（可能进行某种方式的转换）。</span><span class="sxs-lookup"><span data-stu-id="66989-127">Often, part of the information in the received documents is transferred to the sent documents, perhaps transformed in some way.</span></span> <span data-ttu-id="66989-128">例如，订单履行流程可能会收到一份要求购买一定数量货品的订单，然后送回一条消息，指出已由于某种原因而拒绝该订单。</span><span class="sxs-lookup"><span data-stu-id="66989-128">For example, an order fulfillment process might receive an order for some number of items, then send back a message indicating that the order was declined for some reason.</span></span> <span data-ttu-id="66989-129">可能会将该订单中的信息（例如，请求标识符和订货量）从所收到的订单消息的某些字段复制到拒绝消息的相应字段中。</span><span class="sxs-lookup"><span data-stu-id="66989-129">Information from the order, such as a request identifier and the quantity ordered, might be copied from fields in the received order message into fields in the rejection message.</span></span> <span data-ttu-id="66989-130">使用 BizTalk 映射器可以定义从一个文档到另一个文档的转换（称为映射）。</span><span class="sxs-lookup"><span data-stu-id="66989-130">The BizTalk Mapper can be used to define a transformation, called a map, from one document to the other.</span></span>  
  
 <span data-ttu-id="66989-131">![架构之间的映射](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span><span class="sxs-lookup"><span data-stu-id="66989-131">![Mapping Between Schemas](../core/media/understandingbts-2010-mapper.gif "UnderstandingBTS_2010_Mapper")</span></span>  
  
 <span data-ttu-id="66989-132">如上图所示，每个映射以两个 XML 架构间的图形化相关形式表示，从而定义这两个架构中元素之间的关系。</span><span class="sxs-lookup"><span data-stu-id="66989-132">As the figure above shows, each map is expressed as a graphical correlation between two XML schemas that defines a relationship between elements in those schemas.</span></span> <span data-ttu-id="66989-133">万维网联合会 (W3C) 已将可扩展样式表语言转换 (XSLT) 规定为表示 XML 架构间的此类转换的标准方法，因此 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中的映射将以 XSLT 转换的方式实现。</span><span class="sxs-lookup"><span data-stu-id="66989-133">The World Wide Web Consortium (W3C) has defined the Extensible Stylesheet Language Transformation (XSLT) as a standard way to express these kinds of transformations between XML schemas, and so maps in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are implemented as XSLT transformations.</span></span>  
  
 <span data-ttu-id="66989-134">映射中定义的转换可能非常简单，例如，将值从一个文档原封不动地复制到另一个文档。</span><span class="sxs-lookup"><span data-stu-id="66989-134">The transformation defined in a map can be simple, such as copying values unchanged from one document to another.</span></span> <span data-ttu-id="66989-135">使用的链接，BizTalk 映射器中显示为一条连接源架构中的相应元素与目标架构中的对应项表示此类的直接数据副本。</span><span class="sxs-lookup"><span data-stu-id="66989-135">Direct data copies like this are expressed using a link, which is shown in the BizTalk Mapper as a line connecting the appropriate elements in the source schema with their counterparts in the destination schema.</span></span> <span data-ttu-id="66989-136">使用 functoid 还可以实现更复杂的转换。</span><span class="sxs-lookup"><span data-stu-id="66989-136">More complex transformations are also possible using functoids.</span></span> <span data-ttu-id="66989-137">Functoid 为一组可执行代码，可用于定义 XML 架构之间的任意复杂映射，如上所示，BizTalk 映射器将 functoid 表示为连接要转换的元素的线上的方框。</span><span class="sxs-lookup"><span data-stu-id="66989-137">A functoid is a chunk of executable code that can define arbitrarily complex mappings between XML schemas, and as shown above, the BizTalk Mapper represents it as a box on the line connecting the elements being transformed.</span></span> <span data-ttu-id="66989-138">由于上述某些转换相当常见，所以 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中包含了许多内置 functoid。</span><span class="sxs-lookup"><span data-stu-id="66989-138">Because some of those transformations are fairly common, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] includes a number of built-in functoids.</span></span> <span data-ttu-id="66989-139">这些内置 functoid 分为以下类别：</span><span class="sxs-lookup"><span data-stu-id="66989-139">These built-in functoids are grouped into categories, which include the following:</span></span>  
  
- <span data-ttu-id="66989-140">“数学”functoid，可以对源文档中各字段的值执行加、乘和除等运算，然后将结果存储在目标文档的某个字段中。</span><span class="sxs-lookup"><span data-stu-id="66989-140">Mathematical functoids that perform operations such as adding, multiplying, and dividing the values of fields in the source document and storing the result in a field in the target document.</span></span>  
  
- <span data-ttu-id="66989-141">“转换”functoid，可以将数值转换为其对应的 ASCII 码，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="66989-141">Conversion functoids that convert a numeric value to its ASCII equivalent and vice-versa.</span></span>  
  
- <span data-ttu-id="66989-142">“逻辑”functoid，可用于根据源文档中指定值之间的逻辑比较，确定是否应该在目标文档中创建某个元素或属性。</span><span class="sxs-lookup"><span data-stu-id="66989-142">Logical functoids that can be used to determine whether an element or attribute should be created in the target document based on a logical comparison between specified values in the source document.</span></span> <span data-ttu-id="66989-143">可以对这些值的相等性、大小关系以及其他方面进行比较。</span><span class="sxs-lookup"><span data-stu-id="66989-143">Those values can be compared for equality, greater than/less than, and in other ways.</span></span>  
  
- <span data-ttu-id="66989-144">“累计”functoid，可用于计算源文档中各字段的值的平均值、总和或其他值，然后将结果存储在目标文档的单个字段中。</span><span class="sxs-lookup"><span data-stu-id="66989-144">Cumulative functoids that compute averages, sums, or other values from various fields in the source document, then store the result in a single field in the target document.</span></span>  
  
- <span data-ttu-id="66989-145">“数据库”functoid，可用于访问存储在数据库中的信息。</span><span class="sxs-lookup"><span data-stu-id="66989-145">Database functoids that can access information stored in a database.</span></span>  
  
  <span data-ttu-id="66989-146">也可以直接以 XSLT 或使用启用 .NET 的语言（例如 Visual C# 和 Visual Basic）创建自定义 functoid。</span><span class="sxs-lookup"><span data-stu-id="66989-146">It is also possible to create custom functoids directly in XSLT or using .NET-enabled languages like Visual C# and Visual Basic.</span></span> <span data-ttu-id="66989-147">还可以按顺序组合 functoid，将一个 functoid 的输出与另一个 functoid 的输入级联。</span><span class="sxs-lookup"><span data-stu-id="66989-147">Functoids can also be combined in sequences, cascading the output of one into the input of another.</span></span>  
  
  <span data-ttu-id="66989-148">定义文档的 XML 架构以及在不同架构的文档间映射信息都非常重要。</span><span class="sxs-lookup"><span data-stu-id="66989-148">It is essential that you have a way to define a document’s XML schema, as well as a mechanism for mapping information across documents with different schemas.</span></span> <span data-ttu-id="66989-149">BizTalk 编辑器和 BizTalk 映射器可解决这两个问题。</span><span class="sxs-lookup"><span data-stu-id="66989-149">The BizTalk Editor and BizTalk Mapper address these two problems.</span></span> <span data-ttu-id="66989-150">但是，定义架构和映射只是流程的一部分。</span><span class="sxs-lookup"><span data-stu-id="66989-150">Yet defining schemas and maps is only part of the process.</span></span> <span data-ttu-id="66989-151">你还必须指定将使用架构和调用映射的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="66989-151">You must also specify the business logic that will use the schemas and invoke the maps.</span></span>  
  
### <a name="defining-business-logic-the-orchestration-designer"></a><span data-ttu-id="66989-152">定义业务逻辑： 业务流程设计器</span><span class="sxs-lookup"><span data-stu-id="66989-152">Defining Business Logic: The Orchestration Designer</span></span>  
 <span data-ttu-id="66989-153">业务流程指一组操作，这些操作共同满足某些有用的业务需求。</span><span class="sxs-lookup"><span data-stu-id="66989-153">A business process is a set of actions that together meet some useful business need.</span></span> <span data-ttu-id="66989-154">使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，开发人员可以使用业务流程设计器以图形方式定义这些操作。</span><span class="sxs-lookup"><span data-stu-id="66989-154">With [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], a developer can use the Orchestration Designer to define these actions graphically.</span></span> <span data-ttu-id="66989-155">开发人员可以通过将一系列形状按逻辑方式连接在一起来创建业务流程，而无需使用某种编程语言来表示这些步骤。</span><span class="sxs-lookup"><span data-stu-id="66989-155">Instead of expressing the steps in some programming language, a developer can create an orchestration by connecting together a series of shapes in a logical way.</span></span> <span data-ttu-id="66989-156">业务流程设计器中可用的形状包括：</span><span class="sxs-lookup"><span data-stu-id="66989-156">The shapes available in the Orchestration Designer include:</span></span>  
  
- <span data-ttu-id="66989-157">接收形状，供业务流程接收消息。</span><span class="sxs-lookup"><span data-stu-id="66989-157">The Receive shape, which allows the orchestration to receive messages.</span></span> <span data-ttu-id="66989-158">接收形状可具有定义接收消息类型的筛选器，还可配置为在新消息到达时启动业务流程的新实例。</span><span class="sxs-lookup"><span data-stu-id="66989-158">A Receive shape can have a filter that defines the types of messages that will be received, and it can also be configured to start a new instance of an orchestration when a new message arrives.</span></span>  
  
- <span data-ttu-id="66989-159">发送形状，供业务流程发送消息。</span><span class="sxs-lookup"><span data-stu-id="66989-159">The Send shape, which allows the orchestration to send messages.</span></span>  
  
- <span data-ttu-id="66989-160">端口形状，用于定义消息的传输方式。</span><span class="sxs-lookup"><span data-stu-id="66989-160">The Port shape, which defines how messages are transmitted.</span></span> <span data-ttu-id="66989-161">端口形状的每个实例均连接到发送形状或接收形状。</span><span class="sxs-lookup"><span data-stu-id="66989-161">Each instance of a Port shape is connected to either a Send or Receive shape.</span></span> <span data-ttu-id="66989-162">每个端口还具有特定的类型，用于定义以下内容：端口可接收消息的类型；方向（例如，发送或接收）；以及绑定（确定如何发送或接收消息，例如，指定特定的 URL 和其他信息）。</span><span class="sxs-lookup"><span data-stu-id="66989-162">Each port also has a type, which defines things such as the kinds of messages the port can receive; a direction, such as send or receive; and a binding, which determines how a message is sent or received by, for example, specifying a particular URL and other information.</span></span>  
  
- <span data-ttu-id="66989-163">判定形状，表示 if-then-else 语句，使用此语句，业务流程可根据布尔条件执行不同的任务。</span><span class="sxs-lookup"><span data-stu-id="66989-163">The Decide shape, which represents an if-then-else statement that allows an orchestration to perform different tasks based on Boolean conditions.</span></span> <span data-ttu-id="66989-164">表达式编辑器是业务流程设计器的一部分，可用于指定此类条件语句。</span><span class="sxs-lookup"><span data-stu-id="66989-164">An Expression Editor, part of the Orchestration Designer, can be used to specify this conditional statement.</span></span>  
  
- <span data-ttu-id="66989-165">循环形状，在特定条件为 True 的情况下控制操作的重复执行。</span><span class="sxs-lookup"><span data-stu-id="66989-165">The Loop shape, which controls the repeated performing of an action while some condition is true.</span></span>  
  
- <span data-ttu-id="66989-166">构造消息形状，用于构造消息。</span><span class="sxs-lookup"><span data-stu-id="66989-166">The Construct Message shape, which allows building a message.</span></span>  
  
- <span data-ttu-id="66989-167">转换形状，用于将信息从一个文档传输到另一个文档，并通过调用由 BizTalk 映射器定义的映射对其进行转换。</span><span class="sxs-lookup"><span data-stu-id="66989-167">The Transform shape, which allows the transfer of information from one document to another, and transforming it by invoking maps defined with the BizTalk Mapper.</span></span>  
  
- <span data-ttu-id="66989-168">并行操作形状，供开发人员用于指定应并行执行而不是按序执行的多个操作。</span><span class="sxs-lookup"><span data-stu-id="66989-168">The Parallel Actions shape, which allows a developer to specify that multiple operations should be performed in parallel rather than in sequence.</span></span> <span data-ttu-id="66989-169">直到所有的并行操作执行完后才会执行此形状后面的形状。</span><span class="sxs-lookup"><span data-stu-id="66989-169">The shape that follows this one is not executed until all of the parallel actions have completed.</span></span>  
  
- <span data-ttu-id="66989-170">作用域形状，用于将操作分组到不同的事务中以及定义用于错误处理的异常处理程序。</span><span class="sxs-lookup"><span data-stu-id="66989-170">The Scope shape, which allows the grouping of operations into transactions and defining exception handlers for error handling.</span></span> <span data-ttu-id="66989-171">该形状支持传统原子事务和长期事务。</span><span class="sxs-lookup"><span data-stu-id="66989-171">Both traditional atomic transactions and long-running transactions are supported.</span></span> <span data-ttu-id="66989-172">与原子事务不同，长期事务依赖补偿逻辑而非回滚来处理意外事件。</span><span class="sxs-lookup"><span data-stu-id="66989-172">Unlike atomic transactions, long-running transactions rely on compensating logic rather than rollback to handle unexpected events.</span></span>  
  
- <span data-ttu-id="66989-173">消息赋值形状，用于向业务流程变量赋值。</span><span class="sxs-lookup"><span data-stu-id="66989-173">The Message Assignment shape, which allows assigning values to orchestration variables.</span></span> <span data-ttu-id="66989-174">这些变量可用于存储业务流程使用的状态信息，例如要创建的消息或字符串。</span><span class="sxs-lookup"><span data-stu-id="66989-174">These variables can be used to store state information used by the orchestration, such as a message being created or a character string.</span></span>  
  
  <span data-ttu-id="66989-175">下图显示了使用这其中部分形状在业务流程设计器中创建的一个业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-175">The figure below shows an orchestration created in the Orchestration Designer using a few of these shapes.</span></span> <span data-ttu-id="66989-176">在这个简单的示例中，接收到消息后将根据消息的内容做出判定，然后根据判定结果执行两条路径之一。</span><span class="sxs-lookup"><span data-stu-id="66989-176">In this simple example, a message is received, a decision is made based on the content of that message, and one of two paths is executed as a result of that decision.</span></span> <span data-ttu-id="66989-177">但是，解决实际问题的业务流程可能比此示例要复杂得多；为了更方便地处理这些更加复杂的图形，业务流程设计器还提供了放大和缩小功能。这样，开发人员就可以只查看业务流程中他们所关注的部分。</span><span class="sxs-lookup"><span data-stu-id="66989-177">Orchestrations that solve real problems can be significantly more complex than this; to make these more complex diagrams easier to work with, the Orchestration Designer includes the ability to zoom in and out. Developers can view only those parts of an orchestration that they are currently interested in.</span></span>  
  
  <span data-ttu-id="66989-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span><span class="sxs-lookup"><span data-stu-id="66989-178">![](../core/media/understandingbts-08-orchestration.gif "UnderstandingBTS_08_Orchestration")</span></span>  
  
  <span data-ttu-id="66989-179">在开发人员定义了业务流程后，形状组以及这些形状间的关系将转换为 .NET Framework 的公共语言运行时 (CLR) 使用的 Microsoft 中间语言 (MSIL)。</span><span class="sxs-lookup"><span data-stu-id="66989-179">After a developer has defined an orchestration, the group of shapes and relations between them is converted into the Microsoft Intermediate Language (MSIL) used by the .NET Framework’s Common Language Runtime (CLR).</span></span> <span data-ttu-id="66989-180">最后，这组由 BizTalk Server 开发人员定义的形状将成为标准的启用 .NET 的程序集。</span><span class="sxs-lookup"><span data-stu-id="66989-180">Ultimately, the group of shapes defined by a BizTalk Server developer becomes just a standard .NET-enabled assembly.</span></span> <span data-ttu-id="66989-181">必要时，你还可以通过从形状内调用 COM 或 .NET 对象向业务流程添加显式代码。</span><span class="sxs-lookup"><span data-stu-id="66989-181">You can also add explicit code to an orchestration when necessary by calling a COM or .NET object from inside a shape.</span></span>  
  
### <a name="the-role-of-web-services"></a><span data-ttu-id="66989-182">Web Services 的角色</span><span class="sxs-lookup"><span data-stu-id="66989-182">The Role of Web Services</span></span>  
 <span data-ttu-id="66989-183">Web Services 允许应用程序使用 SOAP 交换 XML 文档，对集成平台有很大的影响。</span><span class="sxs-lookup"><span data-stu-id="66989-183">Web services allow applications to exchange XML documents using SOAP, and have had a significant impact on integration platforms.</span></span> <span data-ttu-id="66989-184">若要访问外部 Web Services，业务流程的创建者可以使用 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 中的“添加 Web 引用”选项以及 Web Services 适配器来直接调用操作。</span><span class="sxs-lookup"><span data-stu-id="66989-184">To access an external Web service, an orchestration’s creator can use the Add Web Reference option in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] along with the Web Services adapter to directly invoke operations.</span></span> <span data-ttu-id="66989-185">同样，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 也提供了一个 Web Services 发布向导。使用该向导可生成 ASP.NET Web services 项目，将一个或多个业务流程的操作公开为 SOAP 可调用的 Web Services。</span><span class="sxs-lookup"><span data-stu-id="66989-185">Similarly, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] provides a Web Services Publishing wizard that can generate an ASP.NET Web service project exposing one or more of an orchestration’s operations as SOAP-callable Web services.</span></span> <span data-ttu-id="66989-186">通过上述两种方法，开发人员可以从业务流程中访问现有 Web Services，也可以将业务流程的功能作为 Web Services 公开给其他业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-186">These two options allow developers to both access existing Web services from within a business process and expose an orchestration’s functionality as a Web service to other business processes.</span></span>  
  
- <span data-ttu-id="66989-187">此外，Web Services 的出现还影响了业务流程的定义方式。</span><span class="sxs-lookup"><span data-stu-id="66989-187">The rise of Web services also has an impact on how business processes are defined.</span></span> <span data-ttu-id="66989-188">例如，假定两个组织要使用 Web Services 进行交互。</span><span class="sxs-lookup"><span data-stu-id="66989-188">For example, think about the case where two organizations interact using Web services.</span></span> <span data-ttu-id="66989-189">为了高效地进行互操作，交互双方都应了解对方使用的业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-189">To interoperate effectively, it might be necessary for each party to the interaction to know something about the business process the other is using.</span></span> <span data-ttu-id="66989-190">如果双方组织都使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，则将非常简单，他们可以使用诸如贸易伙伴管理等工具来分享这些信息。</span><span class="sxs-lookup"><span data-stu-id="66989-190">If both organizations use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], this isn’t a big problem; tools such as the Trading Partner Management technology can be used to distribute this knowledge.</span></span> <span data-ttu-id="66989-191">但如果他们使用不同的产品，又该如何呢？</span><span class="sxs-lookup"><span data-stu-id="66989-191">But what if they use different products?</span></span> <span data-ttu-id="66989-192">对于此类情况，如果能够以非供应商特定的方式对业务流程的方方面面进行说明，则会非常有用。</span><span class="sxs-lookup"><span data-stu-id="66989-192">For cases like this, it is useful to have a way to describe aspects of business processes in a non-vendor specific way.</span></span>  
  
  <span data-ttu-id="66989-193">为实现这一目标，Microsoft、IBM 和其他供应商创建了业务处理执行语言 (BPEL)。</span><span class="sxs-lookup"><span data-stu-id="66989-193">To allow this, Microsoft, IBM, and others have created the Business Process Execution Language (BPEL).</span></span> <span data-ttu-id="66989-194">使用业务流程设计器定义的业务程序可以导出为 BPEL 格式，并且 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 也可以导入用 BPEL 定义的程序。</span><span class="sxs-lookup"><span data-stu-id="66989-194">A business process defined using the Orchestration Designer can be exported to BPEL, and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] can also import processes defined in BPEL.</span></span> <span data-ttu-id="66989-195">虽然 BPEL 对描述和共享业务流程的外部可见部分非常有用，但该语言更着重于解决上述问题，而非跨平台执行整个业务流程。</span><span class="sxs-lookup"><span data-stu-id="66989-195">While the language is useful for describing and sharing externally visible parts of a business process, BPEL is focused more on solving this problem than on cross-platform execution of complete business processes.</span></span> <span data-ttu-id="66989-196">需要了解的重要一点是，BPEL 完全建立于 Web services 基础之上，而 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 和其他支持此语言的产品可提供更多的功能。</span><span class="sxs-lookup"><span data-stu-id="66989-196">It’s also important to understand that BPEL is built entirely on Web services, while [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and other products that support this language provide more.</span></span> <span data-ttu-id="66989-197">例如，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 支持在不同 XML 架构间进行映射、调用本地对象中的方法，以及 BPEL 中所不具有的其他功能。</span><span class="sxs-lookup"><span data-stu-id="66989-197">For example, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] supports mapping between different XML schemas, calling methods in local objects, and other features that aren’t available in BPEL.</span></span> <span data-ttu-id="66989-198">由于这样和那样的原因，BPEL 并不是一种可用于定义业务流程的完善语言。</span><span class="sxs-lookup"><span data-stu-id="66989-198">For these and other reasons, BPEL isn’t a complete language for defining business processes.</span></span> <span data-ttu-id="66989-199">另外，由于结构化信息标准发展组织 (OASIS) 仍然在对 BPEL 进行标准化，因此很难将该语言看作完全成熟的技术。</span><span class="sxs-lookup"><span data-stu-id="66989-199">And given that BPEL is still in the process of being standardized by the Organization for the Advancement of Structured Information Standards (OASIS), it’s hard to view it today as a fully mature technology.</span></span>  
  
- <span data-ttu-id="66989-200">业务流程是在 BizTalk Server 中创建业务流程的基础。</span><span class="sxs-lookup"><span data-stu-id="66989-200">Orchestrations are the fundamental mechanism for creating business processes in BizTalk Server.</span></span> <span data-ttu-id="66989-201">但是，业务流程的某些方面可能比其他方面更易变动。</span><span class="sxs-lookup"><span data-stu-id="66989-201">Some aspects of an orchestration tend to change more often than others, however.</span></span> <span data-ttu-id="66989-202">特别是，嵌入到业务流程中的决策（业务规则）最容易发生变化。</span><span class="sxs-lookup"><span data-stu-id="66989-202">In particular, the decisions embedded in a business process—the business rules—are commonly its most volatile aspect.</span></span> <span data-ttu-id="66989-203">管理器的支出限制为 100,000 美元的奖金过去一周，但升迁，这最多 500,000 美元或从 100 个单位的慢速付费客户的最大允许的订单减少至仅有 10。</span><span class="sxs-lookup"><span data-stu-id="66989-203">A manager’s spending limit was $100,000 last week, but her promotion bumps this up to $500,000, or a slow-paying customer’s maximum allowed order decreases from 100 units to only 10.</span></span> <span data-ttu-id="66989-204">您可以指定和更新这些规则使用业务规则引擎。</span><span class="sxs-lookup"><span data-stu-id="66989-204">You can specify and update these rules using the  Business Rule Engine.</span></span>  
  
## <a name="using-the-business-rule-engine"></a><span data-ttu-id="66989-205">使用业务规则引擎</span><span class="sxs-lookup"><span data-stu-id="66989-205">Using the Business Rule Engine</span></span>  
 <span data-ttu-id="66989-206">将业务流程设计器与 BizTalk 编辑器和 BizTalk 映射器结合使用，可有效地定义业务流程及其使用的规则。</span><span class="sxs-lookup"><span data-stu-id="66989-206">The Orchestration Designer, together with the BizTalk Editor and the BizTalk Mapper, provide an effective way to define a business process and the rules it uses.</span></span> <span data-ttu-id="66989-207">不过，如果能够更方便地定义和更改业务规则，则会更为有用。</span><span class="sxs-lookup"><span data-stu-id="66989-207">It can be useful, however, to have an easier way to define and change business rules.</span></span> <span data-ttu-id="66989-208">为实现这一目的，BizTalk Server 提供了业务规则引擎 (BRE)。</span><span class="sxs-lookup"><span data-stu-id="66989-208">To allow this, BizTalk Server provides the Business Rule Engine (BRE).</span></span> <span data-ttu-id="66989-209">开发人员经常会使用 BRE，但与业务更为相关的用户可以使用一种称为业务规则编辑器的工具来创建和修改业务规则集。</span><span class="sxs-lookup"><span data-stu-id="66989-209">Developers will most often use the BRE, but more business-oriented users can create and modify sets of business rules using a tool called the Business Rule Composer.</span></span>  
  
 <span data-ttu-id="66989-210">在必须评估复杂的业务规则集时，使用 BRE 会非常有用。</span><span class="sxs-lookup"><span data-stu-id="66989-210">One situation in which the BRE is useful is when a complex set of business rules must be evaluated.</span></span> <span data-ttu-id="66989-211">例如，在决定是否发放贷款时，可能需要根据客户的信用历史记录、收入和其他因素来处理大型规则集。</span><span class="sxs-lookup"><span data-stu-id="66989-211">Deciding whether to grant a loan, for example, might entail working through a large set of rules based on the customer’s credit history, income, and other factors.</span></span> <span data-ttu-id="66989-212">同样，决定是否向申请人销售人寿保险也取决于多方面的因素，包括申请人的年龄、性别和健康状况等。</span><span class="sxs-lookup"><span data-stu-id="66989-212">Similarly, determining whether to sell life insurance to an applicant depends on a number of things, including the applicant’s age, gender, and health.</span></span> <span data-ttu-id="66989-213">也许可以用条件语句（例如使用业务流程的判定形状）来表示所有这些规则，但会非常复杂，难于实现。</span><span class="sxs-lookup"><span data-stu-id="66989-213">Expressing all of these rules as conditional statements using, say, an orchestration’s Decide shape might be possible, but would be fairly complex to implement.</span></span> <span data-ttu-id="66989-214">对于此类规则密集型流程，使用 BRE 可为开发人员提供便利。</span><span class="sxs-lookup"><span data-stu-id="66989-214">For rule-intensive processes like these, the BRE can make a developer’s life simpler.</span></span>  
  
 <span data-ttu-id="66989-215">使用 BRE，开发人员可以根据需要便捷地更改规则。</span><span class="sxs-lookup"><span data-stu-id="66989-215">Using the BRE, developers can quickly and easily change rules as needed.</span></span> <span data-ttu-id="66989-216">若要明白其中原因，则需了解更改业务流程中实现的业务规则所需执行的操作。</span><span class="sxs-lookup"><span data-stu-id="66989-216">To see why, think about what’s required to change a business rule that’s implemented within an orchestration.</span></span> <span data-ttu-id="66989-217">首先，开发人员必须在 [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] 中打开业务流程，修改相应的形状（可能是这些形状调用的 .NET 或 COM 对象），然后生成并部署已修改的程序集。</span><span class="sxs-lookup"><span data-stu-id="66989-217">A developer must first open the orchestration in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], modify the appropriate shapes (and perhaps the .NET or COM objects they invoke), and then build and deploy the modified assembly.</span></span> <span data-ttu-id="66989-218">另外，还需要停止并重新启动包含此业务流程的 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="66989-218">Doing this also requires stopping and restarting the BizTalk application that includes this orchestration.</span></span> <span data-ttu-id="66989-219">但是，如果使用 BRE 实现此业务规则，则无需重新编译任何内容或重新启动任何应用程序即可对其进行修改。</span><span class="sxs-lookup"><span data-stu-id="66989-219">If instead this business rule is implemented using the BRE, it can be modified without recompiling or restarting anything.</span></span> <span data-ttu-id="66989-220">所有执行的操作仅仅是使用业务规则编辑器来更改所需规则，然后重新部署新的规则集。</span><span class="sxs-lookup"><span data-stu-id="66989-220">All that’s needed is to use the Business Rule Composer to change the desired rule, then redeploy the new set of rules.</span></span> <span data-ttu-id="66989-221">所做的更改会立即生效。</span><span class="sxs-lookup"><span data-stu-id="66989-221">The change takes effect immediately.</span></span> <span data-ttu-id="66989-222">虽然业务流程通常是由开发人员创建和维护的，但业务规则很容易理解，因此有时业务分析员可以自行修改这些规则，而无需求助其他技术人员。</span><span class="sxs-lookup"><span data-stu-id="66989-222">And while orchestrations are typically created and maintained by developers, business rules are readable enough that in some cases they can be modified by business analysts without the need to involve more technical people.</span></span>  
  
 <span data-ttu-id="66989-223">业务规则集的创建者一开始通常是使用业务规则编辑器来定义用于指定这些规则的词汇表。</span><span class="sxs-lookup"><span data-stu-id="66989-223">The creator of a set of business rules typically begins by using the Business Rule Composer to define a vocabulary for use in specifying those rules.</span></span> <span data-ttu-id="66989-224">词汇表中的每个术语为特定的信息提供了用户友好的名称。</span><span class="sxs-lookup"><span data-stu-id="66989-224">Each term in the vocabulary provides a user-friendly name for some information.</span></span> <span data-ttu-id="66989-225">例如，词汇表可能会定义诸如“Number Shipped”、“Maximum Quantity of Items”或“Approval Limit”之类的术语。</span><span class="sxs-lookup"><span data-stu-id="66989-225">For example, a vocabulary might define terms such as Number Shipped or Maximum Quantity of Items or Approval Limit.</span></span> <span data-ttu-id="66989-226">其中每个术语都可以设置为常数或映射到特定 XML 架构（以及相应的传入消息）中的特定元素或属性，或映射到对某个数据库进行的 SQL 查询的结果，甚至还可映射到 .NET 对象中的值。</span><span class="sxs-lookup"><span data-stu-id="66989-226">Each of these terms can be set to a constant or be mapped to a particular element or attribute in some XML schema (and thus in an incoming message) or to the result of a SQL query against some database or even to a value in a .NET object.</span></span>  
  
 <span data-ttu-id="66989-227">在定义词汇表后，即可将业务规则编辑器用于创建使用此词汇表的业务策略。</span><span class="sxs-lookup"><span data-stu-id="66989-227">After a vocabulary has been defined, the Business Rule Composer can be used to create business policies that use this vocabulary.</span></span> <span data-ttu-id="66989-228">每个策略均包含一个或多个业务规则。</span><span class="sxs-lookup"><span data-stu-id="66989-228">Each policy can contain one or more business rules.</span></span> <span data-ttu-id="66989-229">规则使用在某个词汇表中定义的术语以及逻辑运算符（例如大于、小于、等于）和其他功能来定义业务流程的运行方式。</span><span class="sxs-lookup"><span data-stu-id="66989-229">A rule uses the terms defined in some vocabulary together with logical operators such as Greater Than, Less Than, Is Equal To, and others to define how a business process operates.</span></span> <span data-ttu-id="66989-230">业务规则可以定义所接收 XML 文档中包含的值应如何影响所发送 XML 文档中创建的值，这些收到的值应如何影响写入到数据库中的值，以及其他内容。</span><span class="sxs-lookup"><span data-stu-id="66989-230">A business rule can define how values contained in a received XML document should affect the values created in an XML document that’s sent, or how those received values should affect what value is written in a database, or other things.</span></span>  
  
 <span data-ttu-id="66989-231">业务流程使用调用规则形状执行业务策略。</span><span class="sxs-lookup"><span data-stu-id="66989-231">To execute a business policy, an orchestration uses a CallRules shape.</span></span> <span data-ttu-id="66989-232">此形状将创建 BRE 的实例，指定要执行的策略，然后传入此策略所需的信息（例如，所收到的 XML 文档）。</span><span class="sxs-lookup"><span data-stu-id="66989-232">This shape creates an instance of the BRE, specifies which policy to execute, then passes in the information this policy needs, such as a received XML document.</span></span> <span data-ttu-id="66989-233">也可使用基于 .NET 的对象模型以编程方式调用 BRE，这样就可以通过不使用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 引擎的应用程序调用 BRE。</span><span class="sxs-lookup"><span data-stu-id="66989-233">The BRE can also be invoked programmatically using a .NET-based object model, which allows it to be called from applications that don’t use [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="66989-234">这意味着只要 BRE 有助于解决当前问题，Windows 窗体应用程序、公开 Web Services 的软件以及其他建立在 .NET Framework 基础之上的任何组件都可以使用 BRE。</span><span class="sxs-lookup"><span data-stu-id="66989-234">This means that Windows Forms applications, software exposing Web services, and anything else built on the .NET Framework can potentially use the BRE whenever it helps solve the problem at hand.</span></span>  
  
 <span data-ttu-id="66989-235">因此，与上述简单示例相比，实际应用中的词汇表和业务规则会更为复杂，当然功能也更为强大。</span><span class="sxs-lookup"><span data-stu-id="66989-235">Both vocabularies and business rules can be much more complicated—and much more powerful—than the simple examples described here.</span></span> <span data-ttu-id="66989-236">不过，首先定义词汇表、然后定义使用该词汇表的规则集这一核心思路始终是业务规则引擎的根本原则。</span><span class="sxs-lookup"><span data-stu-id="66989-236">But the core idea of defining a vocabulary, then defining sets of rules that use that vocabulary is the heart of the Business Rule Engine.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="66989-237">请参阅</span><span class="sxs-lookup"><span data-stu-id="66989-237">See Also</span></span>  
 [<span data-ttu-id="66989-238">BizTalk Server 消息引擎</span><span class="sxs-lookup"><span data-stu-id="66989-238">The BizTalk Server Messaging Engine</span></span>](../core/the-biztalk-server-messaging-engine.md)