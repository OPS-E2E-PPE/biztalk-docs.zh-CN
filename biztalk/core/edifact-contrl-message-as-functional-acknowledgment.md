---
title: 作为功能确认的 EDIFACT CONTRL 消息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 7d3c2be0-0993-4b2d-b6c3-286020117078
caps.latest.revision: 14
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 7c4667b51fa0e649d78078ba0d05fda383de69bd
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65389138"
---
# <a name="edifact-contrl-message-as-functional-acknowledgment"></a>作为功能确认的 EDIFACT CONTRL 消息
如果您已选择生成功能确认在业务配置文件设置或贸易合作伙伴协议 （或如果两个业务配置文件之间不定义任何协议的后备协议），，或在消息中的 UNB9 字段设置为"1"，将 CONTRL将生成消息作为功能确认 (ACK)。 此确认会报告交换的检查语法的结果。  
  
 CONTRL 功能确认包括以下段：  
  
- UNH 消息标头 （必需）  
  
- UCI 段，用于标识交换主题，指示交换回执的状态，并包含对收到的交换 （必需） 的 UNA、 UNB 和 UNZ 段的引用。 UCI 段具有 1; 最大出现次数因此，它报告在一个控制段中遇到的第一个错误。  
  
- UCF 段，用于标识组段 （由 UNG 标头和 UNE 尾部封装） 并指示任何错误 （如果存在 UNG 段，则为必需） 的性质  
  
- UCM 段，用于标识消息段 （由 UNH 标头和 UNT 尾部封装） 并指示任何错误 （必需） 的性质  
  
- UCS 段，用于标识事务集并指示任何错误 （必需） 的性质  
  
- UCD 段，用于标识错误复合数据元素或组件数据元素并指示错误 （条件） 的性质  
  
- UNT 消息尾部 （必需）。  
  
  如果收到的 CONTRL 功能确认仅包含 UNH、 UCI 和 UNT 段，EDIReceive 管道将处理确认作为 CONTRL 回执 （技术） 确认。  
  
  在报表级别 （即 UCI、 UCF、 UCM、 UCS 和 UCD 段） 段的每个实例可以报告一个错误。  
  
> [!NOTE]
>  CONTRL 消息包含几个必需的数据元素，将复制从收到的交换。 如果交换中的数据元素缺失或在语法上无效，无法生成语法上有效的 CONTRL 消息。 然后必须通过除 CONTRL 消息以外的某种方式报告错误。  
> 
> [!NOTE]
>  在 BizTalk Server 中，仅包含一个或多个 CONTRL 消息的已接收交换的响应中发送 CONTRL 消息 （确认回执、 接受或拒绝）。 在[!INCLUDE[bts2010R2](../includes/bts2010r2-md.md)]，仅包含一个或多个 CONTRL 消息的已接收交换的响应中发送任何 CONTRL 消息 （确认回执、 接受或拒绝）。 必须通过除 CONTRL 消息以外的一种方法报告收到的 CONTRL 消息中的错误。 如果一个或多个 CONTRL 消息包含在包含数据消息，CONTRL 消息作为对响应生成的交换中将生成的交换，就像收到的交换中包含任何 CONTRL 消息一样。  
  
 **SG 循环**  
  
 CONTRL 功能确认的结构将会以不同的方式取决于收到的交换是否包含一个或多个组。 如果该交换包括一个组，确认将包含一个 UCF 段，每个组。 每个 UCF 段将包含一个 UCM 段，每个消息，并且每个 UCM 段将包括在迁移后的 UCS 和 UCD 段的一系列。  
  
 XML 格式的确认消息将包括一个封装每个 UCF 段的 SG3Loop 元素、 封装每个 UCM 元素的 SG4Loop 元素和 SG5Loop 元素封装每对 UCS 和 UCD 元素。 SG 循环标记中不存在该消息的本机 EDI 格式。  
  
 如果交换不包含一组，确认将不包含任何 UCF 段。 相反，它将包含一个 UCM 段，每个消息，以及每个 UCM 段将包括在迁移后的一系列的 UCS 和 UCD 段。  
  
 XML 格式的确认消息将包括一个封装每个 UCM 元素的 SG1Loop 元素和 SG2Loop 元素封装每对 UCS 和 UCD 元素。 与包括组的交换，SG 标记中不存在的本机格式的确认。  
  
> [!NOTE]
>  通过默认根据行业用法 SG1/SG4 循环不需要接受的事务集。 但是，若要支持符合标准，您可以强制生成 SG1/SG4 通过选择**为已接受的事务集 SG1/SG4 生成循环**中的复选框**确认**页两个业务配置文件之间的协议的协议属性对话框 (或**确认**为业务配置文件的 EDI 设置选项卡的页面)。 如果选择此复选框，则接收管道将生成 SG1/SG4 循环是否接受或拒绝事务集。 否则，将仅为错误事务集生成这些循环 (ucm5 ！ = 7)。  
  
 **数据元素**  
  
 CONTRL 功能确认包括以下数据元素：  
  
|数据元素|“属性”|用法|  
|------------------|----------|-----------|  
|UNH1|消息参考编号|-|  
|UNH2|消息标识符子组件|子组件为：<br /><br /> -1 = CONTRL<br /><br /> - 2 = 4<br /><br /> - 3 = 1<br /><br /> -4 = 取消|  
|UCI1|交换控制编号|映射自已接收消息的 UNB5 字段。|  
|UCI2|交换发送方|映射自已接收消息的 UNB2 字段。 第一个子组件 （标识） 是必需的。 第二个子组件 （代码限定符） 和第三个组件 （反向路由地址） 是可选的。|  
|UCI3|交换接收方|映射自已接收消息的 UNB3 字段。 第一个子组件 （标识） 是必需的。 第二个子组件 （代码限定符） 是可选的。|  
|UCI4|操作代码|这些操作代码为：<br /><br /> -8 如果交换被接受<br /><br /> -7 如果交换被接受，但某些事务集将被拒绝<br /><br /> -4 如果交换被拒绝由于 UNA 或 UNB 段中出现错误<br /><br /> 这是必需的数据元素。|  
|UCI5|语法错误代码|标识接收交换中的错误情况 （如果有）。 有关详细信息，请参阅[EDIFACT CONTRL 确认错误代码](../core/edifact-contrl-acknowledgment-error-codes.md)。<br /><br /> 此数据元素为条件可选。|  
|UCI6|服务段标记|标识在 UCI.5 数据元素中确定了错误情况的段。<br /><br /> 此数据元素为条件可选。|  
|UCI7|数据元素标识|标识在 UCI.5 数据元素中确定了错误情况的数据元素。 UCI7 的子组件为：<br /><br /> -中的位置错误数据元素的段 （必需）<br /><br /> -错误组件数据元素的位置中段 （条件可选）<br /><br /> 的错误数据元素在段 （条件可选） 中匹配项|  
|UCI8|-|-|  
|UCF1|组参考编号|映射自已接收消息的 UNG5 字段。<br /><br /> 这是必需的数据元素。|  
|UCF2|应用程序发送方的标识|映射自已接收消息以及子组件的 UNG2 字段<br /><br /> 这是一个条件的数据元素。|  
|UCF3|应用程序接收方的标识|映射自已接收到的消息以及子组件的 UNG3 字段。<br /><br /> 这是一个条件的数据元素。|  
|UCF4|编码的操作|这些操作代码为：<br /><br /> -如果交换被接受的 7<br /><br /> -4 如果交换被拒绝由于 UNA 或 UNB 段中出现错误<br /><br /> 此代码适用于此级别和所有较低级别。<br /><br /> 这是必需的数据元素。|  
|UCF5|语法错误编码|标识组中的错误条件 （如果有）。 有关详细信息，请参阅[EDIFACT CONTRL 确认错误代码](../core/edifact-contrl-acknowledgment-error-codes.md)。<br /><br /> 此数据元素为条件可选。|  
|UCF6|服务段标记|标识组中的错误段。<br /><br /> 此数据元素为条件可选。|  
|UCF7|数据元素标识|标识在 UCF5 数据元素中确定了错误情况的数据元素。 UCF7 的子组件为：<br /><br /> -中的位置错误数据元素的段 （必需）<br /><br /> -错误组件数据元素的位置中段 （条件可选）<br /><br /> 的错误数据元素在段 （必需） 中匹配项|  
|UCM1|消息参考编号|映射自已接收消息的 UNH1 字段。<br /><br /> 这是必需的数据元素。|  
|UCM2|消息标识符|映射自已接收消息以及子组件的 UNH2 字段<br /><br /> 这是一个条件的数据元素。|  
|UCM3|编码的操作|这些操作代码为：<br /><br /> -如果交换被接受的 7<br /><br /> -4 如果交换被拒绝由于 UNA 或 UNB 段中出现错误<br /><br /> 此代码适用于此级别和所有较低级别。<br /><br /> 这是必需的数据元素。|  
|UCM4|语法错误编码|标识组中的错误条件 （如果有）。 有关详细信息，请参阅[EDIFACT CONTRL 确认错误代码](../core/edifact-contrl-acknowledgment-error-codes.md)。<br /><br /> 此数据元素为条件可选。|  
|UCM5|服务段标记|标识错误中的 UNH 或 UNT 段。<br /><br /> 此数据元素为条件可选。|  
|UCM7|数据元素标识|标识在 UCM5 数据元素中确定了错误情况的数据元素。 UCM7 的子组件为：<br /><br /> -中的位置错误数据元素的段 （必需）<br /><br /> -错误组件数据元素的位置中段 （条件可选）<br /><br /> 的错误数据元素在段 （必需） 中匹配项|  
|UCS1|消息正文中的段位置|为 1 的 UNH 开始的错误段位置计数。 若要报告段是缺失，这是之前的位置，其中缺少的段应为已处理的最后一个段的数值计数位置。 标识为缺少组中的第一个段表示缺少的段组。<br /><br /> 这是必需的数据元素。|  
|UCS2|语法错误编码|标识组中的错误条件 （如果有）。 有关详细信息，请参阅[EDIFACT CONTRL 确认错误代码](../core/edifact-contrl-acknowledgment-error-codes.md)。<br /><br /> 此数据元素为条件可选。|  
|UCD1|语法错误编码|标识组中的错误条件 （如果有）。 有关详细信息，请参阅[EDIFACT CONTRL 确认错误代码](../core/edifact-contrl-acknowledgment-error-codes.md)。<br /><br /> 此数据元素为条件可选。<br /><br /> **注意：** 如果发生 XSD 验证失败，UCD1 数据元素将报告代码值 12，无效的值。|  
|UCD2|数据元素标识|标识在 UCD1 数据元素中确定了错误情况的数据元素。 UCD2 的子组件为：<br /><br /> -中的位置错误数据元素的段 （必需）<br /><br /> -错误组件数据元素的位置中段 （条件可选）<br /><br /> 的错误数据元素在段 （必需） 中匹配项|  
|UNT1|段的计数|-|  
|UNT2|消息参考编号|-|