---
title: 证书疑难解答 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b7013db6-ebf7-4294-a072-e9b5b0ad0de2
caps.latest.revision: 26
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e9db2898f2d40103ed31f4da417d390dc0132dd2
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65296654"
---
# <a name="troubleshooting-certificates"></a>证书疑难解答
Microsoft[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]可以进行针对进行文档加密和解密，文档签名和验证 （不可否认性） 和参与方解析使用的公钥基础结构 (PKI) 数字证书。 本主题介绍了各种证书使用方案和配置选项和有关将数字证书用于提供一些通用准则[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。  

## <a name="certificate-usage-scenarios-and-configuration-options"></a>证书使用方案和配置选项  
 使用证书时出现的大多数问题[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]是不正确或不完整配置的结果。 例如导入错误的证书存储的正确的证书，到正确的存储或未能在 BizTalk 管理控制台中输入相应信息不正确的证书将导致出现运行时错误时使用证书。  

 使用下表作为参考的证书使用方案和配置选项中提供的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]:  


|       **证书使用情况**        |                           **用户上下文**                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        **证书存储位置**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |        **证书类型**        | **使用的管道组件** |                                                                                                                                                                                                                                                                                         **在 BizTalk Server 管理控制台中的配置参数**                                                                                                                                                                                                                                                                                         |
|------------------------------------|-----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|-----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|        加密 （发送）        |  使用与发送处理程序关联的主机实例帐户   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              登录到运行的每台计算机[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，将 S/MIME 编码器管道的宿主，并将加密证书导入**本地计算机 \ 其他人**存储。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 贸易合作伙伴公共证书 |     MIME/SMIME 编码器      |                                                                                                      -为指定值的加密证书**公用名**并**指纹**上**证书**页**发送端口属性**对话框。<br />-指定管道**编码**中的选项**配置管道**对话框。 **配置管道**通过单击下一步按钮将显示对话框**发送管道**上的下拉列表**常规**页**发送端口属性**对话框。                                                                                                       |
|       解密 （接收）       | 使用与接收处理程序关联的主机实例帐户 | 登录到运行的每台计算机[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，将 S/MIME 解码器管道的宿主为每个主机实例服务帐户，并将解密证书导入**当前用户 \ 个人**存储。 **注意：** 在 IIS 7.0 的计算机上成功执行管道解密，请确保为 IIS 应用程序池帐户和与接收处理程序关联的主机实例使用的帐户是相同的并且此帐户是属于\<machineName\>\IIS_WPG 组。 有关为 IIS 7.0 设置 IIS 进程标识的详细信息，请参阅[解决 IIS 权限疑难问题的准则](../core/guidelines-for-resolving-iis-permissions-problems.md)。 这些进程必须以确保在加载管道中执行解密所需的注册表项加载帐户配置文件的同一帐户下运行。 出于性能原因，IIS 6.0 不加载帐户配置文件启动关联的 w3wp.exe 进程时，因此[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]必须使用相同的帐户配置主机实例，以便[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]将一起加载帐户配置文件和注册表项。 |      私人证书       |     MIME/SMIME 解码器      |                                                                                                   -指定的解密证书值**公用名**并**指纹**上**证书**的每个页**主机属性**对话框。<br />-指定管道**解码**中的选项**配置管道**对话框。 **配置管道**通过单击下一步按钮将显示对话框**接收管道**上的下拉列表**常规**页**接收位置属性**对话框。                                                                                                   |
|        签名 （发送）         |  使用与发送处理程序关联的主机实例帐户   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               登录到运行的每台计算机[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，将 S/MIME 编码器管道的宿主为每个主机实例服务帐户，并为签名证书导入**当前用户 \ 个人**存储。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |      私人证书       |     MIME/SMIME 编码器      |                    -指定值的签名证书**公用名**并**指纹**上**证书**页**BizTalk 组属性**对话框。 **注意：**     可以按每个指定只有一个签名证书[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]组。<br />-指定管道**编码**中的选项**配置管道**对话框。 **配置管道**通过单击下一步按钮将显示对话框**发送管道**上的下拉列表**常规**页**发送端口属性**对话框。                    |
| 签名验证 （接收） | 使用与接收处理程序关联的主机实例帐户 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                登录到运行的每台计算机[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，将 S/MIME 解码器管道的宿主并导入到的签名证书**本地计算机 \ 其他人**存储。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 贸易合作伙伴公共证书 |     MIME/SMIME 解码器      |                                -指定用于验证证书的值**公用名**并**指纹**上**证书**的每个页**参与方属性**对话框。<br />-指定管道**解码**中的选项**配置管道**对话框。 **配置管道**通过单击下一步按钮将显示对话框**接收管道**上的下拉列表**常规**页**接收位置属性**对话框。 **注意：**     配置**解码**选项要求部署具有 MIME/SMIME 解码器组件的管道。                                 |
|    参与方解析 （接收）    | 使用与接收处理程序关联的主机实例帐户 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    登录到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]哪个参与方解析为其配置和将证书导入计算机**本地计算机 \ 其他人**存储。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 贸易合作伙伴公共证书 |      参与方解析       |       -指定证书的值**公用名**并**指纹**上**证书**的每个页**主机属性**对话框.<br />-指定**解析参与方**中的选项**配置管道**对话框。 **配置管道**通过单击下一步按钮将显示对话框**接收管道**上的下拉列表**常规**页**接收位置属性**对话框。 **注意：**     此选项的配置需要使用包含的管道**参与方解析**组件。 **XMLReceive**管道包含**参与方解析**组件。       |
|          HTTPS （发送）           |  使用与发送处理程序关联的主机实例帐户   |                                                                                                                                                                                                                                                                     SSL 通信不需要客户端证书。 客户端证书是否需要是目标 Web 服务器管理员决定。 如果目标 Web 服务器要求客户端证书，则执行以下步骤：<br /><br /> -从贸易合作伙伴获取公共证书。<br />-登录到运行每个计算机[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]作为与发送处理程序关联的主机实例使用的帐户。<br />-将证书导入**当前用户 \ 个人**存储。<br /><br /> 有关如何使用 Windows Server 2008 证书服务网页获取证书的信息，请参阅[请求证书通过 Web](http://go.microsoft.com/fwlink/?LinkId=129628)。                                                                                                                                                                                                                                                                      | 贸易合作伙伴公共证书 |             不适用              | -   **HTTP 传输**-设置**SSL 客户端证书指纹**选项卡上**身份验证**选项卡**HTTP 传输属性**对话框。 **HTTP 传输属性**通过单击显示对话框**配置**按钮**常规**页**发送端口属性**对话框。<br />-   **SOAP 传输**-设置**客户端证书指纹**选项卡上**常规**选项卡**SOAP 传输属性**对话框。 **SOAP 传输属性**通过单击显示对话框**配置**按钮**常规**页**发送端口属性**对话框。 |

#### <a name="to-display-the-certificates-management-console-interface-for-local-computer-and-current-user"></a>若要显示本地计算机和当前用户证书管理控制台接口  

1.  单击**启动**，单击**运行**，类型**MMC**，然后单击**确定**打开**Microsoft 管理控制台**.  

2.  单击**文件**菜单，并单击**添加/删除管理单元中**以显示**添加/删除管理单元中**对话框。  

3.  选择**证书**从列表中可用的管理单元，然后单击**添加**。  

4.  选择**计算机帐户**，单击**下一步**，然后单击**完成**。 这将添加**证书管理控制台**接口**本地计算机**。  

5.  絋粄**证书**从管理单元的列表仍处于选中状态，然后单击**添加**试。  

6.  选择**我的用户帐户**，然后单击**完成**。 这将添加**证书管理控制台**接口**当前用户**。  

    > [!NOTE]
    >  这将显示**证书管理控制台**当前以登录的帐户。 如果你需要将证书导入的服务帐户的个人存储然后您应该登录使用服务帐户凭据第一次。  

7.  单击**确定**按钮**添加/删除管理单元中**对话框。  

## <a name="general-guidelines"></a>通用指导原则  

- **请确保导入的证书，用于其预期目的**:若要执行此操作，请双击中的证书**证书管理控制台**接口，然后单击**详细信息**选项卡**证书**对话框。 然后单击**所有**选项**显示**下拉列表，然后单击此项可选择**密钥用法**和/或**增强型密钥用法**字段若要验证的预期的用途。 如果[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]尝试将证书用于其预期用途的运行时错误而不会发生。  

- **测试连接到目标 Web 站点**:如果在使用 SSL，确保你可以连接到目标 Web 站点使用 Internet Explorer 然后再尝试连接到目标网站，使用 HTTP 或 SOAP 传输。 验证连接到目标网站时无对话框显示在 Internet Explorer 中。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 不已连接的任何机制与连接到目标网站时可能会显示任何对话框。 Internet Explorer 可能会显示一个对话框，如果目标网站名称不匹配的 SSL 证书中的 web 站点为指定的名称，或如果 SSL 证书的根证书颁发机构不在相应**受信任的根证书颁发机构**存储。  

- **使用 SSL 诊断工具可以分析 SSL 连接问题：** SSL 诊断工具是 IIS 诊断工具包的可选组件。  下载 IIS 诊断工具包从[Internet 信息服务诊断工具](http://go.microsoft.com/fwlink/?LinkId=64426)。  

- **请确保证书有效**。 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 如果该证书已过期，不会提示您。 相反，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]将挂起该消息。  

## <a name="see-also"></a>请参阅  
 [加密和签名证书](../core/encryption-and-signing-certificates.md)