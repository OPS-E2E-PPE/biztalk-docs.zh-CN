---
title: WCF 适配器常见问题解答： 消息流和映射 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 907e5c6a-a095-4b3a-9362-506832b6bc8c
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ae55b6447923e9618a3e4776284659d48a2b25a9
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36968174"
---
# <a name="wcf-adapter-faq-message-flow-and-mapping"></a><span data-ttu-id="7a3e8-102">WCF 适配器常见问题解答： 消息流和映射</span><span class="sxs-lookup"><span data-stu-id="7a3e8-102">WCF Adapter FAQ: Message Flow and Mapping</span></span>
## <a name="what-is-the-message-flow-within-the-wcf-and-biztalk-systems"></a><span data-ttu-id="7a3e8-103">WCF 和 BizTalk 系统中的消息流是什么？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-103">What is the message flow within the WCF and BizTalk systems?</span></span>  
 <span data-ttu-id="7a3e8-104">以下是对传入 BizTalk Server 的 WCF 消息流的说明：</span><span class="sxs-lookup"><span data-stu-id="7a3e8-104">Here is a description of the flow of an incoming WCF message to BizTalk Server:</span></span>  
  
1. <span data-ttu-id="7a3e8-105">WCF 消息到达接收位置，然后 BizTalk Server 实例化承载的 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-105">A WCF message arrives at a receive location, and BizTalk Server instantiates a hosted WCF service.</span></span>  
  
2. <span data-ttu-id="7a3e8-106">WCF 运行时实例化服务的通道堆栈及其通道侦听器。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-106">The WCF runtime instantiates the service’s channel stack and its channel listeners.</span></span> <span data-ttu-id="7a3e8-107">通道堆栈是处理不同处理任务的阶段序列。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-107">A channel stack is a sequence of stages that handle differing processing tasks.</span></span> <span data-ttu-id="7a3e8-108">每个通道堆栈至少由一个传输通道（大多数情况下为消息编码器）和零或多个协议通道组成。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-108">Each channel stack consists of at least a transport channel, most often a message encoder, and zero or more protocol channels.</span></span> <span data-ttu-id="7a3e8-109">传输通道读取到达的传入消息流。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-109">The transport channel reads the incoming message stream upon arrival.</span></span> <span data-ttu-id="7a3e8-110">它调用编码器来解释该消息并生成 WCF 消息对象。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-110">It invokes an encoder to interpret the message and to produce a WCF Message object.</span></span> <span data-ttu-id="7a3e8-111">此时，每个协议通道都有机会按顺序操作 WCF 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-111">At this point each protocol channel will have an opportunity to operate on the WCF message in order.</span></span>  
  
3. <span data-ttu-id="7a3e8-112">WCF 消息由侦听器接收，该侦听器通过配置的 WCF 通道堆栈转发消息并将其调度到相应的服务实例。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-112">The WCF message is received by a listener that forwards it through the configured WCF channel stack and dispatches it to the proper service instance.</span></span> <span data-ttu-id="7a3e8-113">此时，WCF 消息被转换（映射）为 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-113">At this point the WCF message is converted (mapped) to a BizTalk message.</span></span> <span data-ttu-id="7a3e8-114">简而言之，WCF 消息标头被写入 BizTalk 消息上下文，且 WCF 消息正文被写入 BizTalk 消息的正文部分。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-114">Briefly stated, the WCF message headers are written into the BizTalk message context, and the WCF message body is written into the  BizTalk message body part.</span></span> <span data-ttu-id="7a3e8-115">映射控制 WCF 消息的哪个部分变为 BizTalk 消息正文： 信封、 正文或子元素。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-115">Mapping controls what part of the WCF message becomes the BizTalk message body: Envelope, body, or sub-element.</span></span>  
  
4. <span data-ttu-id="7a3e8-116">在接收位置配置的任何管道组件处理 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-116">Any pipeline components configured in the receive location processes the BizTalk message.</span></span>  
  
5. <span data-ttu-id="7a3e8-117">将 BizTalk 消息存储在 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-117">The BizTalk message is stored in the MessageBox database.</span></span>  
  
   <span data-ttu-id="7a3e8-118">以下是对自 BizTalk Server 传出的 WCF 消息流的说明：</span><span class="sxs-lookup"><span data-stu-id="7a3e8-118">Here is a description of the flow of an outgoing WCF message from BizTalk Server:</span></span>  
  
6. <span data-ttu-id="7a3e8-119">发送端口根据其订阅接收 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-119">A BizTalk message is received by a send port according to its subscription.</span></span>  
  
7. <span data-ttu-id="7a3e8-120">在发送端口配置的任何管道组件处理 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-120">Any pipeline components configured in the send port process the BizTalk message.</span></span>  
  
8. <span data-ttu-id="7a3e8-121">根据服务的外部可见协议，实例化 WCF 通道堆栈，且将 BizTalk 消息转换（映射）为 WCF 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-121">A WCF channel stack is instantiated, and the BizTalk message is converted (mapped) into a WCF message based upon the service’s external visible contract.</span></span>  
  
9. <span data-ttu-id="7a3e8-122">WCF 通道堆栈将 WCF 消息传输到外部 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-122">The WCF channel stack transmits the WCF message to the external WCF service.</span></span>  
  
## <a name="how-is-a-wcf-message-converted-mapped-into-a-biztalk-message"></a><span data-ttu-id="7a3e8-123">如何将 WCF 消息转换（映射）为 BizTalk 消息？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-123">How is a WCF message converted (mapped) into a BizTalk message?</span></span>  
 <span data-ttu-id="7a3e8-124">要了解映射，我们需要查看 WCF 消息和 BizTalk 消息的结构。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-124">In order to understand the mapping, we need to look at the structure of a WCF message and a BizTalk message.</span></span>  
  
 <span data-ttu-id="7a3e8-125">WCF 消息以 SOAP 消息结构为模型，由消息属性、消息标头和一个消息正文组成。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-125">A WCF message is modeled on the SOAP message structure and consists of message properties, message headers, and a single message body.</span></span>  
  
- <span data-ttu-id="7a3e8-126">**消息属性**是附加到消息对象的公共语言运行时 (CLR) 对象。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-126">The **message properties** are Common Language Runtime (CLR) objects that are attached to the Message object.</span></span> <span data-ttu-id="7a3e8-127">这些属性对于通信每端的 WCF 堆栈和用户应用程序都是内部属性。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-127">Properties are internal to the WCF stack and the user’s application at each end of the communication.</span></span> <span data-ttu-id="7a3e8-128">它们从不直接在客户端和服务器之间进行传输。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-128">They are never directly transferred between client and server.</span></span>  
  
- <span data-ttu-id="7a3e8-129">**消息标头**，但是，客户端和服务器之间进行传输。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-129">**Message headers**, however, are transferred between client and server.</span></span> <span data-ttu-id="7a3e8-130">一条消息中可能含有许多标头，但只有一个消息正文，与标头不同，以流方式传输消息正文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-130">There can be many headers on a message, but there is only one message body, and unlike the headers the message body is streamed.</span></span> <span data-ttu-id="7a3e8-131">消息标头和消息正文都定义为 XML Infoset。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-131">Both the message headers and the message body are defined as an XML Infoset.</span></span>  
  
- <span data-ttu-id="7a3e8-132">**正文**的 WCF 消息是为其属性和标头提供的详细信息的消息的主要内容。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-132">The **body** of a WCF message is the main content of the message for which the properties and headers provide more information.</span></span>  
  
  <span data-ttu-id="7a3e8-133">BizTalk 消息具有不同的结构。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-133">A BizTalk message has a different structure.</span></span>  
  
- <span data-ttu-id="7a3e8-134">每条消息有一组上下文属性。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-134">There is a single set of context properties on each message.</span></span> <span data-ttu-id="7a3e8-135">每个上下文属性都由命名空间名称/值对组成。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-135">Each context property consists of a namespace name/value pair.</span></span> <span data-ttu-id="7a3e8-136">上下文属性可被升级或写入。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-136">Context properties can be either promoted or written.</span></span> <span data-ttu-id="7a3e8-137">如果是升级，它们可参与到在 BizTalk Server 中执行的路由规则。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-137">If they are promoted, they can take part in the routing rules that execute within BizTalk Server.</span></span>  
  
- <span data-ttu-id="7a3e8-138">BizTalk Server 中消息的数据可由多个数据流组成。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-138">The data of a message in BizTalk Server can consist of multiple streams.</span></span> <span data-ttu-id="7a3e8-139">BizTalk 消息分为多部分，因为可以分别读取各个流。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-139">A BizTalk message is multipart because each stream can be read independently.</span></span> <span data-ttu-id="7a3e8-140">其中一个消息部分比较特殊，称为正文部分。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-140">One of the message parts is special and it is referred to as the body part.</span></span>  
  
  <span data-ttu-id="7a3e8-141">因为通信有时是双向的，所以 WCF 适配器允许为消息交换的入站和出站方向配置特定的转换或映射。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-141">Because the communication can sometimes be two-way, the WCF adapter allows the particular translation or mapping to be configured for both inbound and outbound directions of message exchange.</span></span> <span data-ttu-id="7a3e8-142">可为 BizTalk Server 中的接收位置和发送端口执行此操作。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-142">This can be done for both the receive locations and send ports within BizTalk Server.</span></span>  
  
  <span data-ttu-id="7a3e8-143">BizTalk WCF 适配器在运行时支持在这两种消息结构之间进行多种排列的转换。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-143">The BizTalk WCF adapters support a number of permutations of translating at run time between these two message structures.</span></span> <span data-ttu-id="7a3e8-144">通过控制映射**消息**选项卡**传输属性**个 WCF 适配器的对话框。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-144">Mapping is controlled through the **Messages** tab in the **Transport Properties** dialog box for a WCF adapter.</span></span> <span data-ttu-id="7a3e8-145">例如，最明显转换也即默认转换是在入站 WCF 消息的正文变为 BizTalk 消息的正文时。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-145">For example, the most obvious translation, and the default, is when the body of an inbound WCF message becomes the body of the BizTalk message.</span></span> <span data-ttu-id="7a3e8-146">有关映射模式的详细信息，请参阅[ http://go.microsoft.com/fwlink/?LinkID=119792 ](http://go.microsoft.com/fwlink/?LinkID=119792)。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-146">For more information about mapping modes, see [http://go.microsoft.com/fwlink/?LinkID=119792](http://go.microsoft.com/fwlink/?LinkID=119792).</span></span>  
  
## <a name="how-can-you-preserve-the-complete-incoming-wcf-message-inside-the-biztalk-message"></a><span data-ttu-id="7a3e8-147">如何在 BizTalk 消息内保留完整的 WCF 传入消息？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-147">How can you preserve the complete incoming WCF message inside the BizTalk message?</span></span>  
 <span data-ttu-id="7a3e8-148">入站 BizTalk 消息正文选项之一是**信封**选项。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-148">One of the inbound BizTalk message body options is the **Envelope** option.</span></span> <span data-ttu-id="7a3e8-149">选择此选项可将 soap:Envelope 元素中包含的整个 SOAP 消息带到传入 BizTalk 消息正文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-149">Choosing this option takes the entire SOAP message contained within the soap:Envelope element into the incoming BizTalk message body.</span></span> <span data-ttu-id="7a3e8-150">所生成的 BizTalk 消息将包含信封标记、所有标头和正文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-150">The resulting BizTalk message contains the Envelope tags, all the headers, and the body.</span></span>  
  
## <a name="how-can-you-extract-specific-elements-of-the-incoming-wcf-message-into-a-biztalk-message-or-map-elements-of-an-outgoing-biztalk-message-to-an-outgoing-wcf-message"></a><span data-ttu-id="7a3e8-151">如何将传入 WCF 消息的特定元素提取到 BizTalk 消息，或如何将传出 BizTalk 消息的元素映射到传出 WCF 消息？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-151">How can you extract specific elements of the incoming WCF message into a BizTalk message, or map elements of an outgoing BizTalk message to an outgoing WCF message?</span></span>  
 <span data-ttu-id="7a3e8-152">若要映射 WCF 或 BizTalk 消息正文的一部分，请使用“路径或模板”选项。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-152">To map a section of a WCF or BizTalk message body, use the Path or Template option.</span></span> <span data-ttu-id="7a3e8-153">这使您可以输入 XPath 表达式来提取消息正文的特定部分。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-153">This allows you to enter an XPath expression to extract specific parts of the message body.</span></span> <span data-ttu-id="7a3e8-154">在这种情况下不支持完整的 XPath 语法，因为提取是流式传输的，因此读取器必须始终向前读取内容。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-154">Full XPath syntax is not supported in this situation as the extraction is streamed and the reader must therefore always walk forward.</span></span> <span data-ttu-id="7a3e8-155">这就是在为什么**消息**它称为"路径-按正文路径定位内容"而不是"XPath – 按正文路径定位内容。"选项卡</span><span class="sxs-lookup"><span data-stu-id="7a3e8-155">This is why in the **Messages** tab it is called “Path – content located by body path” instead of “XPath – content located by body path.”</span></span>  
  
 <span data-ttu-id="7a3e8-156">在接收端，使用指示如何从 WCF 消息读取数据的 Path 表达式。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-156">On the receive side, use a Path expression that dictates how data is to be read from the WCF message.</span></span> <span data-ttu-id="7a3e8-157">对于入站消息，Path 语句提取的特定元素将替换 BizTalk 消息的正文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-157">For an inbound message, the specific element extracted by the Path statement gets substituted for the content of the BizTalk message.</span></span> <span data-ttu-id="7a3e8-158">适配器使用此 Path 表达式来查找和提取 BizTalk 消息的所需数据。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-158">The adapter uses this Path expression to locate and extract the desired data for the BizTalk message.</span></span>  
  
 <span data-ttu-id="7a3e8-159">在发送端，使用模板从 BizTalk 消息创建 WCF 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-159">On the send side, use a template to create a WCF message from the BizTalk message.</span></span> <span data-ttu-id="7a3e8-160">为出站消息指定模板选项可允许 XPath 选项反向。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-160">The template option for outbound messages is designed to allow the exact opposite of the XPath option.</span></span> <span data-ttu-id="7a3e8-161">在 WCF 适配器配置中，XML 代码段用作出站消息结构的基础。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-161">In the WCF adapter configuration, the snippet of XML is used as the basis for the structure of the outbound message.</span></span> <span data-ttu-id="7a3e8-162">BizTalk 消息的内容在运行时插入到此结构中。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-162">The content of the BizTalk message is inserted at run time into this structure.</span></span>  
  
 <span data-ttu-id="7a3e8-163">对于传出消息，还必须选择使用“节点编码”设置（XML、Base64、String 或 Hexadecimal）所编写元素的类型。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-163">For an outgoing message, you must also choose the type of the element written by using the Node Encoding setting from XML, Base64, String, or Hexadecimal.</span></span> <span data-ttu-id="7a3e8-164">在希望提取 WCF 消息中包含的二进制数据流时，此选项非常有用。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-164">This option is very useful when you want to extract a binary data stream contained in a WCF message.</span></span> <span data-ttu-id="7a3e8-165">使用此功能可指示 WCF 适配器对 WCF 消息的正文读取器调用 ReadContextAsBase64。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-165">Using this feature instructs the WCF Adapter to use the ReadContextAsBase64 calls on the body Reader of the WCF Message.</span></span> <span data-ttu-id="7a3e8-166">此调用允许直接通过 XmlReader API 读取二进制数据，因此使用此功能，二进制数据可以直接从 WCF Transport 移动到 BizTalk MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-166">This call allows binary data to be read directly through the XmlReader API, so using this feature binary data can be moved directly from the WCF Transport into the BizTalk MessageBox database.</span></span> <span data-ttu-id="7a3e8-167">通过写入含有二进制数据的节点的路径，您可以提取它并将其放入 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-167">By writing a path to the node containing the binary data you can pull it out and place it into the BizTalk message.</span></span>  
  
## <a name="how-do-you-access-wcf-message-properties-within-an-incoming-wcf-message"></a><span data-ttu-id="7a3e8-168">如何访问传入 WCF 消息中的 WCF 消息属性？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-168">How do you access WCF message properties within an incoming WCF message?</span></span>  
 <span data-ttu-id="7a3e8-169">若要在传入 WCF 消息转换为 BizTalk 消息之前访问其中的属性，可以结合使用 WCF 行为和自定义 WCF 通道组件或服务模型扩展点。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-169">To access properties within an incoming WCF message before it is transformed into a BizTalk message, you can use a custom WCF channel component or a service model extensibility point with a WCF behavior.</span></span> <span data-ttu-id="7a3e8-170">例如， **IDispatchMessageInspector**对象。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-170">For example, an **IDispatchMessageInspector** object.</span></span> <span data-ttu-id="7a3e8-171">BizTalk Wcf-custom 和 Wcf-customisolated 适配器提供了使你的应用程序可插入到使用 WCF 行为的强大功能轻松地**行为**选项卡**传输属性**对话框这些适配器。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-171">The BizTalk WCF-Custom and WCF-CustomIsolated adapters provide a simple way for your application to plug into the power of WCF behaviors using the **Behavior** tab in the **Transport Properties** dialog for those adapters.</span></span>  
  
 <span data-ttu-id="7a3e8-172">若要使 WCF 消息的属性可用于 WCF 适配器，必须首先将这些属性作为内容写入消息正文或标头。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-172">To allow the properties of a WCF message to be available to the WCF adapter, those properties first have to be written into the message body or header as content.</span></span> <span data-ttu-id="7a3e8-173">自动为您将标头复制到 BizTalk 消息上下文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-173">The headers are copied into the BizTalk message context automatically for you.</span></span> <span data-ttu-id="7a3e8-174">如果你想升级属性值，可用于自定义 BizTalk 管道组件中将 WCF 消息属性升级到 BizTalk 消息上下文**IComponent： 执行**方法。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-174">If you want a property value promoted, you can use a custom BizTalk pipeline component to promote the WCF message property into the BizTalk message context from within the **IComponent:Execute** method.</span></span> <span data-ttu-id="7a3e8-175">WCF 自定义适配器中使用自定义 WCF 行为，可充分利用 WCF 和 BizTalk 的扩展性让您的解决方案，更为强大和灵活。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-175">Using custom WCF behaviors with the WCF custom adapters allows you to take advantage of both WCF and BizTalk extensibility to make your solution more powerful and flexible.</span></span> <span data-ttu-id="7a3e8-176">WCF 适配器使您可以结合使用现有 BizTalk 和 WCF 扩展性来解决问题。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-176">The WCF adapter allows you to combine existing BizTalk and WCF extensibilities to solve your problem.</span></span>  
  
 <span data-ttu-id="7a3e8-177">好消息是在这种常见属性情况下，WCF 适配器中有一个快捷方式。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-177">The good news is that there is a shortcut in the WCF adapter for this common property case.</span></span> <span data-ttu-id="7a3e8-178">您只需使用 WCF 扩展创建 WCF 适配器了解的新“已知”属性，而无需同时写入这两个扩展内容。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-178">Rather than writing to both extensibility stories, you can simply have the WCF extension create a new “well known” property that is understood by the WCF adapter.</span></span>  
  
 <span data-ttu-id="7a3e8-179">为了将 SOAP 标头值写入或升级到 BizTalk 消息上下文，WCF 消息必须包含由属性名称和命名空间组成的值对集合。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-179">In order to write or promote SOAP header values into the BizTalk message context, the WCF message must contain a collection of value pairs that consist of property names and namespaces.</span></span> <span data-ttu-id="7a3e8-180">这使 WCF 适配器可以识别标头值是被写入还是被升级的。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-180">This allows the WCF adapters to recognize that the header values are to be written or promoted.</span></span>  
  
 <span data-ttu-id="7a3e8-181">在将 SOAP 标头值写入或升级到 BizTalk 消息上下文时，WCF 适配器需要获取 WCF 消息中的以下消息属性：</span><span class="sxs-lookup"><span data-stu-id="7a3e8-181">A WCF adapter expects the following message properties in the WCF messages for writing or promoting SOAP header values to the BizTalk message context:</span></span>  
  
-   <span data-ttu-id="7a3e8-182">若要升级到 BizTalk 消息上下文的 SOAP 标头值，WCF 适配器会寻找的密钥对**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote**和值**列表 < KeyValuePair\<XmlQualifiedName，对象\>>**.</span><span class="sxs-lookup"><span data-stu-id="7a3e8-182">To promote the SOAP header values to the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/Promote** and value **List<KeyValuePair\<XmlQualifiedName, object\>>**.</span></span> <span data-ttu-id="7a3e8-183">使用此对 WCF 适配器采用命名空间、 名称和值从**XmlQualifiedName**对象，并将其用于升级标头值。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-183">Using this pair, WCF adapters take the namespace, name, and value from the **XmlQualifiedName** object and use them for promoting the header values.</span></span>  
  
-   <span data-ttu-id="7a3e8-184">若要编写，而不是升级到 BizTalk 消息上下文中，SOAP 标头值 WCF 适配器会寻找的密钥对**http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext**和值**列表 < KeyValuePair\<XmlQualifiedName，对象\>>。**</span><span class="sxs-lookup"><span data-stu-id="7a3e8-184">To write, but not promote, the SOAP header values into the BizTalk message context, WCF adapters are looking for the pair of key **http://schemas.microsoft.com/BizTalk/2006/01/Adapters/WCF-properties/WriteToContext** and value **List<KeyValuePair\<XmlQualifiedName, object\>>.**</span></span> <span data-ttu-id="7a3e8-185">WCF 适配器使用此对将这些值写入消息上下文。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-185">Using this pair, WCF adapters write the values to the message context.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7a3e8-186">还必须在 BizTalk 属性架构中指定升级的属性，以便被 BizTalk 运行时接受。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-186">Promoted properties must also be specified in a BizTalk property schema in order to be accepted by the BizTalk runtime.</span></span>  
  
## <a name="you-have-an-existing-orchestration-or-send-port-etc-that-expects-a-biztalk-multipart-message-how-can-you-get-a-multipart-message-in-the-wcf-scenario"></a><span data-ttu-id="7a3e8-187">您有一个期望 BizTalk 多部分消息的现有业务流程（或发送端口等）。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-187">You have an existing orchestration (or send port, etc.) that expects a BizTalk multipart message.</span></span> <span data-ttu-id="7a3e8-188">如何在 WCF 方案中获取多部分消息？</span><span class="sxs-lookup"><span data-stu-id="7a3e8-188">How can you get a multipart message in the WCF scenario?</span></span>  
 <span data-ttu-id="7a3e8-189">BizTalk 多部分消息由一个或多个消息部分组成。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-189">A BizTalk multipart message is composed of one or more message parts.</span></span> <span data-ttu-id="7a3e8-190">但是，WCF 没有多部分消息的概念。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-190">However, WCF has no concept of a multipart message.</span></span> <span data-ttu-id="7a3e8-191">因为 WCF 不使用多部分消息，所以 BizTalk WCF 适配器也不使用它们。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-191">Because WCF does not use multipart messages, the BizTalk WCF adapters also do not use them.</span></span> <span data-ttu-id="7a3e8-192">问题在于，您可以让写入的现有 BizTalk 业务流程或管道生成或使用多部分消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-192">The problem is that you may have an existing BizTalk orchestration or pipeline that is written to produce or consume multipart messages.</span></span>  
  
 <span data-ttu-id="7a3e8-193">如果需要通过传入 WCF 消息和 WCF 适配器将多部分消息写入 BizTalk Server，请在 WCF 消息中以 XML 形式显示多部分数据。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-193">If you need to get a multipart message into BizTalk Server by using an incoming WCF message and the WCF adapters, render your multipart data as XML in your WCF message.</span></span> <span data-ttu-id="7a3e8-194">开发自定义 BizTalk 管道组件可处理传入 XML 流（WCF 消息）并为应用程序创建相应的 BizTalk 多部分消息。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-194">Develop a custom BizTalk pipeline component to process the incoming XML stream (WCF message) and create the appropriate BizTalk multipart message for your application.</span></span> <span data-ttu-id="7a3e8-195">如果需要，可以在发送端反向完成这些步骤。</span><span class="sxs-lookup"><span data-stu-id="7a3e8-195">These steps can be done in reverse for the Send side if required.</span></span>