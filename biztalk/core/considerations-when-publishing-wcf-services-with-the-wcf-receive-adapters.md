---
title: 接收适配器发布 WCF 服务和 WCF 时的注意事项 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- publishing, WCF services
- WCF adapters, best practices
- WCF adapters, receive adapters
- WCF services, publishing
- best practices, WCF adapters
ms.assetid: 797b7ffd-534c-4f09-9738-fb17b208bc96
caps.latest.revision: 34
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: fa7a36d9e38463ea9be43b6be1520d7b6732ef5e
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65354696"
---
# <a name="considerations-when-publishing-wcf-services-with-the-wcf-receive-adapters"></a><span data-ttu-id="0f407-102">接收适配器发布 WCF 服务和 WCF 时的注意事项</span><span class="sxs-lookup"><span data-stu-id="0f407-102">Considerations When Publishing WCF Services with the WCF Receive Adapters</span></span>
<span data-ttu-id="0f407-103">本主题提供发布 WCF 服务通过 WCF 接收适配器时应考虑的信息。</span><span class="sxs-lookup"><span data-stu-id="0f407-103">This topic provides information that you should take into consideration when publishing WCF services with the WCF receive adapters.</span></span>  <span data-ttu-id="0f407-104">使用 WCF 适配器发布服务可由 WCF 客户端调用，就像典型的 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="0f407-104">Publishing a service using a WCF adapter allows it to be called by a WCF client as if it were a typical WCF service.</span></span>  
  
## <a name="in-process-hosting"></a><span data-ttu-id="0f407-105">进程内托管</span><span class="sxs-lookup"><span data-stu-id="0f407-105">In-Process Hosting</span></span>  
 <span data-ttu-id="0f407-106">托管中的接收位置[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]进程空间，btsntsvc.exe，可简化的开发和部署的好处。</span><span class="sxs-lookup"><span data-stu-id="0f407-106">Hosting the receive location within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process space, btsntsvc.exe, allows the benefits of simplified development and deployment.</span></span> <span data-ttu-id="0f407-107">此外，它会创建比在以充分利用高可用性和负载均衡的功能的 IIS 中承载的更多主机实例[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="0f407-107">Additionally, it creates more host instances than hosting in IIS to take advantage of the high-availability and load balancing capabilities of  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  <span data-ttu-id="0f407-108">在外进行托管的信息[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]在 IIS 中的过程是指[对于独立 WCF 接收适配器配置 IIS](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="0f407-108">For information in hosting outside of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process in IIS refer to [Configuring IIS for the Isolated WCF Receive Adapters](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md).</span></span>  
  
## <a name="set-the-isoneway-property-of-wcf-services-published-with-the-wcf-adapters-except-for-the-wcf-netmsmq-receive-adapter-to-false"></a><span data-ttu-id="0f407-109">使用 WCF 适配器为 false （对于 Wcf-netmsmq 接收适配器除外） 发布的 WCF 服务的 IsOneWay 属性设置</span><span class="sxs-lookup"><span data-stu-id="0f407-109">Set the IsOneWay property of WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) to false</span></span>  
 <span data-ttu-id="0f407-110">**System.ServiceModel.OperationContractAttribute.IsOneWay**通过 WCF 适配器发布的 WCF 服务属性，接收的适配器设置为使用 Wcf-netmsmq 发布的服务除外 **，则返回 true** -设置为**false**甚至对于单向接收位置。</span><span class="sxs-lookup"><span data-stu-id="0f407-110">The **System.ServiceModel.OperationContractAttribute.IsOneWay** property of WCF services published with the WCF adapters—except for services published with the WCF-NetMsmq receive adapter where it is set to **true** —is set to **false** even for the one-way receive locations.</span></span> <span data-ttu-id="0f407-111">如果**IsOneWay**属性设置为**false**，甚至是返回的方法**void**生成答复消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-111">If the **IsOneWay** property is set to **false**, even methods that return a **void** result in a reply message.</span></span> <span data-ttu-id="0f407-112">在这种情况下，基础结构创建，并会发送空消息来向调用方指示该方法已返回。</span><span class="sxs-lookup"><span data-stu-id="0f407-112">In this case, the infrastructure creates and sends an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="0f407-113">使用此方法使基础结构以发送由服务操作返回到客户端引发的异常。</span><span class="sxs-lookup"><span data-stu-id="0f407-113">Using this approach enables the infrastructure to send exceptions thrown by the service operation back to the client.</span></span>  
  
 <span data-ttu-id="0f407-114">若要在其中使用通过 WCF 适配器 （对于 Wcf-netmsmq 接收适配器除外） 发布的 WCF 服务**IsOneWay**是**false**，则**IsOneWay**属性客户端必须设置为**false** ，如下所示：</span><span class="sxs-lookup"><span data-stu-id="0f407-114">To consume WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) in which **IsOneWay** is **false**, the **IsOneWay** property on the client side must be set to **false** as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="0f407-115">因为默认值**IsOneWay**属性是**false**，无需在代码中指定该属性。</span><span class="sxs-lookup"><span data-stu-id="0f407-115">Because the default value of the **IsOneWay** property is **false**, you do not have to specify the property in the code.</span></span>  
  
## <a name="the-replyaction-property-of-the-operationcontractattribute-on-the-client-side-should-be-set-to--an-asterisk-when-consuming-wcf-services-published-with-one-way-receive-locations"></a><span data-ttu-id="0f407-116">在客户端上 OperationContractAttribute 的 ReplyAction 属性应设置为"\*"（星号） 时使用 WCF 服务发布使用单向接收位置</span><span class="sxs-lookup"><span data-stu-id="0f407-116">The ReplyAction property of the OperationContractAttribute on the client side should be set to "\*" (an asterisk) when consuming WCF services published with one-way receive locations</span></span>  
 <span data-ttu-id="0f407-117">**System.ServiceModel.OperationContractAttribute.ReplyAction**的属性**System.ServiceModel.OperationContractAttribute**可以在客户端上用于指定的值从 WCF 服务的响应消息的 SOAP 操作。</span><span class="sxs-lookup"><span data-stu-id="0f407-117">The **System.ServiceModel.OperationContractAttribute.ReplyAction** property of the **System.ServiceModel.OperationContractAttribute** can be used on the client side to specify the value of the SOAP action for the response messages from WCF services.</span></span>  
  
 <span data-ttu-id="0f407-118">除了指定答复消息的操作标头的特定值 (这是一个答复时通知客户端以及要采取的操作)，还可以指定字符串"\*"（星号）。</span><span class="sxs-lookup"><span data-stu-id="0f407-118">In addition to specifying a particular value for the action header of the reply message (to notify the client this is a reply and what action to be taken), you can also specify the string "\*" (an asterisk).</span></span> <span data-ttu-id="0f407-119">在客户端应用程序中指定星号可指示客户端不验证该服务将发送的响应消息中的答复操作。</span><span class="sxs-lookup"><span data-stu-id="0f407-119">Specifying an asterisk in a client application instructs the client not to validate the reply action in response messages that the service sends.</span></span>  
  
 <span data-ttu-id="0f407-120">使用 WCF 服务发布的单向接收位置，代理方法 WCF 服务必须返回**void**，在这种情况下代理方法希望 WCF 服务会发送空消息来向调用方指示，该方法已返回。</span><span class="sxs-lookup"><span data-stu-id="0f407-120">To consume a WCF service published by a one-way receive location, the proxy method for the WCF service must return **void**, in which case the proxy method expects that the WCF service will send an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="0f407-121">为代理方法能够收到这则空消息， **ReplyAction**的属性**OperationContractAttribute**应设置为"\*"（星号），如下所示：</span><span class="sxs-lookup"><span data-stu-id="0f407-121">For the proxy method to receive this empty message, the **ReplyAction** property of the **OperationContractAttribute** should be set to "\*" (an asterisk) as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="0f407-122">不需要设置**ReplyAction**属性设置为"\*"（星号） 对于 Wcf-netmsmq 适配器，因为 Wcf-netmsmq 适配器要求 WCF 客户端可以设置**IsOneWay**属性 **，则返回 true**。</span><span class="sxs-lookup"><span data-stu-id="0f407-122">You do not have to set the **ReplyAction** property to "\*" (an asterisk) for the WCF-NetMsmq adapter, because the WCF-NetMsmq adapter requires the WCF clients to set the **IsOneWay** property to **true**.</span></span>  
  
## <a name="an-isolated-host-instance-can-run-only-one-adapter"></a><span data-ttu-id="0f407-123">一个独立的主机实例运行只有一个适配器</span><span class="sxs-lookup"><span data-stu-id="0f407-123">An isolated host instance can run only one adapter</span></span>  
 <span data-ttu-id="0f407-124">一个独立的主机实例运行只有一个适配器。</span><span class="sxs-lookup"><span data-stu-id="0f407-124">An isolated host instance can run only one adapter.</span></span> <span data-ttu-id="0f407-125">如果用一个独立主机配置多个独立适配器，如 HTTP、 SOAP 和 WCF 适配器的接收处理程序，则必须创建多个应用程序池，每个适配器的一个应用程序池。</span><span class="sxs-lookup"><span data-stu-id="0f407-125">If you configure the receive handlers of multiple isolated adapters such as HTTP, SOAP, and WCF adapters with one isolated host, you must create multiple application pools, one application pool for each adapter.</span></span> <span data-ttu-id="0f407-126">有关 biztalk 独立主机的详细信息，请参阅[启用 Web 服务](../core/enabling-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="0f407-126">For more information about BizTalk isolated hosts, see [Enabling Web Services](../core/enabling-web-services.md).</span></span>  
  
## <a name="use-the-template----content-specified-by-template-option-when-sending-non-xml-content-as-response-messages"></a><span data-ttu-id="0f407-127">作为响应消息发送非 XML 内容时使用"模板-内容由模板指定"选项</span><span class="sxs-lookup"><span data-stu-id="0f407-127">Use the "Template -- content specified by template" option when sending non-XML content as response messages</span></span>  
 <span data-ttu-id="0f407-128">使用 WCF 适配器**正文--BizTalk 响应消息正文**（默认值） 选项不允许发送字符数据和位图图像等非 XML 消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-128">The WCF adapters with **Body -- BizTalk response message body** (the default value) option do not allow sending non-XML messages such as character data and bitmap images.</span></span> <span data-ttu-id="0f407-129">可以使用**模板-由模板指定的内容**WCF 适配器能够发送非 XML 消息的选项。</span><span class="sxs-lookup"><span data-stu-id="0f407-129">You can use the **Template -- content specified by template** option for the WCF adapters to send non-XML messages.</span></span> <span data-ttu-id="0f407-130">有关如何使用模板的详细信息，请参阅[指定 WCF 适配器的消息正文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="0f407-130">For more information about how to use the template, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-service-published-with-the-wcf-service-publishing-wizard"></a><span data-ttu-id="0f407-131">设置 WCF 服务的权限使用 WCF 服务发布向导发布</span><span class="sxs-lookup"><span data-stu-id="0f407-131">Setting up the permissions for a WCF service published with the WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="0f407-132">使用 ASP.NET 应用程序使用 WCF 服务发布向导在创建时[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]或[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]平台，可能会出现与 WCF 服务调用期间访问 Dll 相关的错误。</span><span class="sxs-lookup"><span data-stu-id="0f407-132">When using ASP.NET applications created with the WCF Service Publishing Wizard on the [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] or [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] platform, errors relating to accessing DLLs during WCF service invocation may occur.</span></span> <span data-ttu-id="0f407-133">这些错误通常与默认值的问题[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]和[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]安全。</span><span class="sxs-lookup"><span data-stu-id="0f407-133">These errors are typically related to issues with default [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] security.</span></span> <span data-ttu-id="0f407-134">有关这些错误的详细信息，请参阅 Microsoft 帮助和支持文章名为"，收到 'System.IO.FileNotFoundException' 错误时在客户端应用程序调用 Web 服务"帮助和支持网站上在[ http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span><span class="sxs-lookup"><span data-stu-id="0f407-134">For more information about these errors, see the Microsoft Help and Support article called "You Receive a "System.IO.FileNotFoundException" Error When the Client Application Calls a Web Service" on the Help and Support Web site at [http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="0f407-135">需要运行 WCF 服务的过程授予适当的权限是否为在进程内主机或独立主机运行服务。</span><span class="sxs-lookup"><span data-stu-id="0f407-135">requires that the process running the WCF service is granted the appropriate permissions whether an in-process host or an isolated host runs the service.</span></span> <span data-ttu-id="0f407-136">下[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]和[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]独立主机的默认 Windows 组是 Isolated Host Users 组，因此为 Isolated Host Users 组添加权限应当能够解决此问题。</span><span class="sxs-lookup"><span data-stu-id="0f407-136">Under [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] the default Windows group for isolated hosts is the Isolated Host Users Group, so adding the permissions to the Isolated Host Users Group should resolve this issue.</span></span>  
  
#### <a name="to-add-the-permissions-to-the-isolated-host-users-group"></a><span data-ttu-id="0f407-137">若要将权限添加到 Isolated Host Users 组</span><span class="sxs-lookup"><span data-stu-id="0f407-137">To add the permissions to the Isolated Host Users Group</span></span>  
  
1.  <span data-ttu-id="0f407-138">在 Microsoft Windows 资源管理器，找到 %windir%\temp 目录。</span><span class="sxs-lookup"><span data-stu-id="0f407-138">In Microsoft Windows Explorer, locate the %windir%\temp directory.</span></span>  
  
2.  <span data-ttu-id="0f407-139">右键单击 windir%\temp，然后依次**属性**。</span><span class="sxs-lookup"><span data-stu-id="0f407-139">Right-click %windir%\temp, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="0f407-140">在中**属性**对话框中，单击**安全**选项卡。</span><span class="sxs-lookup"><span data-stu-id="0f407-140">In the **Properties** dialog box, click the **Security** tab.</span></span>  
  
4.  <span data-ttu-id="0f407-141">单击**外**，选择**Isolated Host Users 组**，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="0f407-141">Click **Add**, select **the Isolated Host Users Group**, and then click **OK**.</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-receive-location-with-the-wcf-netmsmq-adapter"></a><span data-ttu-id="0f407-142">设置权限的 wcf 接收位置使用 Wcf-netmsmq 适配器</span><span class="sxs-lookup"><span data-stu-id="0f407-142">Setting up the permissions for a WCF receive location with the WCF-NetMsmq adapter</span></span>  
 <span data-ttu-id="0f407-143">当使用 NetMsmqBinding 的 WCF 客户端向通过 Wcf-netmsmq 适配器发布的 WCF 服务发送一条消息时，它解决了到目标队列，这是由服务的队列管理器管理的队列消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-143">When a WCF client using the NetMsmqBinding sends a message to a WCF service published with the WCF-NetMsmq adapter, it addresses the message to the target queue, which is the queue managed by the service's queue manager.</span></span> <span data-ttu-id="0f407-144">在客户端上的队列管理器将消息发送至传输 （或传出） 队列。</span><span class="sxs-lookup"><span data-stu-id="0f407-144">The queue manager on the client sends the message to a transmission (or outgoing) queue.</span></span> <span data-ttu-id="0f407-145">传输队列是客户端队列管理器中，用于存储传输到目标队列的消息队列。</span><span class="sxs-lookup"><span data-stu-id="0f407-145">The transmission queue is a queue on the client-side queue manager that stores messages for transmission to the target queue.</span></span>  
  
 <span data-ttu-id="0f407-146">服务的队列管理器接受定址到目标队列拥有并存储消息的消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-146">The service's queue manager accepts messages addressed to the target queues it owns and stores the messages.</span></span> <span data-ttu-id="0f407-147">然后，服务可进行请求以便读取来自目标队列，队列管理器将消息传递给该服务。</span><span class="sxs-lookup"><span data-stu-id="0f407-147">Then, the service makes requests to read from the target queue, and the queue manager delivers the messages to the service.</span></span> <span data-ttu-id="0f407-148">出于此原因，承载接收位置的 BizTalk 主机实例的服务帐户应具有从目标队列中读取的权限。</span><span class="sxs-lookup"><span data-stu-id="0f407-148">For this reason, the service account for the BizTalk host instance hosting the receive location should have the permissions to read from the target queue.</span></span>  
  
## <a name="use-an-empty-body-path-expression-to-receive-a-soap-message-with-character-data-in-the-content-of-the-soap-body-element"></a><span data-ttu-id="0f407-149">使用空的正文路径表达式接收字符数据的 SOAP 消息的 SOAP Body 元素内容中</span><span class="sxs-lookup"><span data-stu-id="0f407-149">Use an empty body path expression to receive a SOAP message with character data in the content of the SOAP Body element</span></span>  
 <span data-ttu-id="0f407-150">为了使 WCF 接收适配器从传入响应消息的 soap 内容中有字符数据创建 BizTalk 消息**正文**元素，如下面的示例中所示，应该将**正文路径表达式**文本框留空**消息**WCF 适配器传输属性对话框中的选项卡。</span><span class="sxs-lookup"><span data-stu-id="0f407-150">For a WCF receive adapter to create a BizTalk message from an incoming response message with character data in the content of the SOAP **Body** element, as shown in the following example, you should leave the **Body path expression** text box empty on the **Message** tab in the WCF adapter transport properties dialog box.</span></span>  
  
```  
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing">  
    <s:Header>  
      ...  
    </s:Header>  
    <s:Body>Contoso</s:Body>  
</s:Envelope>  
```  
  
 <span data-ttu-id="0f407-151">如果选择**信封**或**正文**选项时，适配器无法创建 BizTalk 消息，从前面的传入消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-151">If you select the **Envelope** or **Body** option, the adapter cannot create the BizTalk message from the previous incoming message.</span></span> <span data-ttu-id="0f407-152">消息未挂起，因为在入站 SOAP 封送处理中失败的消息不会挂起。</span><span class="sxs-lookup"><span data-stu-id="0f407-152">The message is not suspended because messages that fail in the inbound SOAP marshaling processing are not suspended.</span></span> <span data-ttu-id="0f407-153">详细了解如何在使用的正文路径表达式**消息**选项卡上，请参阅[WCF 适配器指定消息正文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="0f407-153">For more information about how to use the body path expression on the **Message** tab, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0f407-154">通过配置 btsntsvc.exe.config 文件来，可以在 Windows SDK 中使用的 TraceViewer 工具 (SvcTraceViewer.exe)。</span><span class="sxs-lookup"><span data-stu-id="0f407-154">You can use the TraceViewer tool (SvcTraceViewer.exe) in the Windows SDK by configuring the BTSNTSvc.exe.config.file.</span></span> <span data-ttu-id="0f407-155">有关 Windows SDK 的详细信息，请参阅"什么是 Windows SDK 中的新增功能"处[ http://go.microsoft.com/fwlink/?LinkId=75219 ](http://go.microsoft.com/fwlink/?LinkId=75219)。</span><span class="sxs-lookup"><span data-stu-id="0f407-155">For more information about the Windows SDK, see "What's New in the Windows SDK" at [http://go.microsoft.com/fwlink/?LinkId=75219](http://go.microsoft.com/fwlink/?LinkId=75219).</span></span> <span data-ttu-id="0f407-156">有关 TraceViewer 工具的详细信息，请参阅"TraceViewer 工具 (SvcTraceViewer.exe)"在[ http://go.microsoft.com/fwlink/?LinkId=75218 ](http://go.microsoft.com/fwlink/?LinkId=75218)。</span><span class="sxs-lookup"><span data-stu-id="0f407-156">For more information about the TraceViewer tool, see "TraceViewer Tool (SvcTraceViewer.exe)" at [http://go.microsoft.com/fwlink/?LinkId=75218](http://go.microsoft.com/fwlink/?LinkId=75218).</span></span>  
  
## <a name="using-schemas-that-reference-other-schemas"></a><span data-ttu-id="0f407-157">使用引用其他架构的架构</span><span class="sxs-lookup"><span data-stu-id="0f407-157">Using schemas that reference other schemas</span></span>  
 <span data-ttu-id="0f407-158">可以使用**重新定义**，**包括**，并**导入**元素时架构变得大而复杂，或当架构表示不同类型的实例消息具有共同某些部分。</span><span class="sxs-lookup"><span data-stu-id="0f407-158">You can use the **redefine**, **include**, and **import** elements when your schemas become large and complex, or when the schemas that represent your different types of instance messages have some portions in common.</span></span> <span data-ttu-id="0f407-159">它可用于将较小的架构合并到最终定义的计划与贸易合作伙伴交换的实例消息结构的架构。</span><span class="sxs-lookup"><span data-stu-id="0f407-159">It can be useful to combine smaller schemas into the schemas that ultimately define the structure of the instance messages you plan to exchange with trading partners.</span></span> <span data-ttu-id="0f407-160">可以使用 BizTalk WCF 服务发布向导将这些架构发布为 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="0f407-160">You can publish these schemas as WCF services by using the BizTalk WCF Service Publishing Wizard.</span></span>  
  
 <span data-ttu-id="0f407-161">应使用 BizTalk WCF 服务使用向导来创建使用从 BizTalk 项目的 WCF 服务所需的 BizTalk 项目。</span><span class="sxs-lookup"><span data-stu-id="0f407-161">You should use the BizTalk WCF Service Consuming Wizard to create the BizTalk artifacts necessary to consume the WCF services from a BizTalk project.</span></span> <span data-ttu-id="0f407-162">如果你想要使用.NET 应用程序中的 WCF 服务，应使用服务模型元数据实用工具工具 (Svcutil.exe) 来创建 WCF 服务的代理类。</span><span class="sxs-lookup"><span data-stu-id="0f407-162">If you want to consume the WCF services from a .NET application, you should use the Service Model Metadata Utility tool (Svcutil.exe) to create the proxy class for the WCF services.</span></span> <span data-ttu-id="0f407-163">有关如何使用引用其他架构的架构的详细信息，请参阅[，使用其他架构](../core/schemas-that-use-other-schemas.md)并[如何创建，使用其他架构](../core/how-to-create-schemas-that-use-other-schemas.md)。</span><span class="sxs-lookup"><span data-stu-id="0f407-163">For more information about how to use schemas that reference other schemas, see [Schemas That Use Other Schemas](../core/schemas-that-use-other-schemas.md) and [How to Create Schemas That Use Other Schemas](../core/how-to-create-schemas-that-use-other-schemas.md).</span></span> <span data-ttu-id="0f407-164">有关 Svcutil.exe 的详细信息，请参阅"服务模型元数据实用工具工具 (Svcutil.exe) 在" [ http://go.microsoft.com/fwlink/?LinkID=74696 ](http://go.microsoft.com/fwlink/?LinkID=74696)。</span><span class="sxs-lookup"><span data-stu-id="0f407-164">For more information about Svcutil.exe, see "Service Model Metadata Utility Tool (Svcutil.exe)" at [http://go.microsoft.com/fwlink/?LinkID=74696](http://go.microsoft.com/fwlink/?LinkID=74696).</span></span>  
  
 <span data-ttu-id="0f407-165">下表显示了限制，并需要了解使用时的注意事项发布 WCF 服务与使用其他架构的架构。</span><span class="sxs-lookup"><span data-stu-id="0f407-165">The following table shows the limitations and considerations that you need to know when consuming published WCF services with schemas that use other schemas.</span></span>  
  
|<span data-ttu-id="0f407-166">XML 架构元素</span><span class="sxs-lookup"><span data-stu-id="0f407-166">XML schema element</span></span>|<span data-ttu-id="0f407-167">使用 WCF 服务使用 BizTalk WCF 服务发布向导发布</span><span class="sxs-lookup"><span data-stu-id="0f407-167">Consuming WCF services published with the BizTalk WCF Service Publishing Wizard</span></span>|<span data-ttu-id="0f407-168">使用由.NET 应用程序承载的 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="0f407-168">Consuming WCF services hosted by .NET applications</span></span>|  
|------------------------|-------------------------------------------------------------------------------------|--------------------------------------------------------|  
|<span data-ttu-id="0f407-169">\<import\></span><span class="sxs-lookup"><span data-stu-id="0f407-169">\<import\></span></span>|<span data-ttu-id="0f407-170">使用 BizTalk WCF 服务使用向导和 Svcutil.exe 支持</span><span class="sxs-lookup"><span data-stu-id="0f407-170">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|<span data-ttu-id="0f407-171">使用 BizTalk WCF 服务使用向导和 Svcutil.exe 支持</span><span class="sxs-lookup"><span data-stu-id="0f407-171">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|  
|<span data-ttu-id="0f407-172">\<include\></span><span class="sxs-lookup"><span data-stu-id="0f407-172">\<include\></span></span>|<span data-ttu-id="0f407-173">支持这两个 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-173">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|<span data-ttu-id="0f407-174">支持这两个 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-174">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
|<span data-ttu-id="0f407-175">\<redefine\></span><span class="sxs-lookup"><span data-stu-id="0f407-175">\<redefine\></span></span>|<span data-ttu-id="0f407-176">-支持使用 BizTalk WCF 服务使用向导</span><span class="sxs-lookup"><span data-stu-id="0f407-176">-   Supported with the BizTalk WCF Service Consuming Wizard</span></span><br /><span data-ttu-id="0f407-177">-有限的支持由 Svcutil.exe**注意：** Svcutil.exe 具有相同的限制**重新定义**元素的 xsd.exe 具有。</span><span class="sxs-lookup"><span data-stu-id="0f407-177">-   Limited support by Svcutil.exe **Note:**  Svcutil.exe has the same limitation for the **redefine** element as XSD.exe has.</span></span>|<span data-ttu-id="0f407-178">支持这两个 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-178">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="0f407-179">与使用的架构创建对已发布的 BizTalk WCF 服务的代理类时，Svcutil.exe 可能会引发一条警告消息**包括**并**重新定义**元素。</span><span class="sxs-lookup"><span data-stu-id="0f407-179">Svcutil.exe may raise a warning message when creating the proxy class against the published BizTalk WCF service with the schemas using the **include** and **redefine** elements.</span></span> <span data-ttu-id="0f407-180">例如，"全局元素已声明。"</span><span class="sxs-lookup"><span data-stu-id="0f407-180">For example, "The global element has already been declared."</span></span>  
  
## <a name="ensure-that-an-in-process-wcf-receive-location-is-not-disabled-after-you-change-the-computer-name-part-in-its-service-endpoint-address"></a><span data-ttu-id="0f407-181">请确保在更改其服务终结点地址中的计算机名部分之后未禁用进程内 WCF 接收位置</span><span class="sxs-lookup"><span data-stu-id="0f407-181">Ensure that an in-process WCF receive location is not disabled after you change the computer name part in its service endpoint address</span></span>  
 <span data-ttu-id="0f407-182">如果更改中的计算机名称部分**地址 (URI)** 文本框中的进程内运行 WCF 接收位置，我们建议使用 BizTalk 管理控制台来检查是否仍在运行接收位置。</span><span class="sxs-lookup"><span data-stu-id="0f407-182">If you change the computer name part in the **Address (URI)** text box of a running in-process WCF receive location, we recommend that you use the BizTalk Administration console to check whether the receive location is still running.</span></span> <span data-ttu-id="0f407-183">例如，如果你更改服务终结点地址使用的 Wcf-nettcp 接收适配器，请**net.tcp://\<**<em>您的计算机名称</em>**\>/samplepath**到**net.tcp://localhost/samplepath**，可能会禁用该接收位置与**Service.InvalidOperationException**。</span><span class="sxs-lookup"><span data-stu-id="0f407-183">For example, if you change a service endpoint address using the WCF-NetTcp receive adapter, **net.tcp://\<**<em>Your Computer Name</em>**\>/samplepath**, to **net.tcp://localhost/samplepath**, the receive location may be disabled with a **Service.InvalidOperationException**.</span></span> <span data-ttu-id="0f407-184">如果仅中的计算机名称部分服务终结点地址更改而无需修改路径部分，请确保未禁用接收位置，并启用它，如有必要。</span><span class="sxs-lookup"><span data-stu-id="0f407-184">If you change only the computer name part in the service endpoint address without modifying the path part, make sure that the receive location is not disabled, and enable it if necessary.</span></span>  
  
## <a name="set-the-appropriate-msdtc-security-configuration-options-on-client-computers-communicating-with-remote-wcf-receive-locations-through-a-transaction-protocol"></a><span data-ttu-id="0f407-185">设置相应的 MSDTC 安全配置选项与远程 WCF 进行通信的客户端计算机上接收位置通过事务协议</span><span class="sxs-lookup"><span data-stu-id="0f407-185">Set the appropriate MSDTC Security Configuration options on client computers communicating with remote WCF receive locations through a transaction protocol</span></span>  
 <span data-ttu-id="0f407-186">Wcf-nettcp、 Wcf-wshttp 和 Wcf-netnamedpipe 接收适配器可以参与事务性协调进程使用 WCF 客户端管理的**WS-AtomicTransaction**和**OleTransaction**事务协议。</span><span class="sxs-lookup"><span data-stu-id="0f407-186">WCF-NetTcp, WCF-WSHttp, and WCF-NetNamedPipe receive adapters can participate in transactional coordination processes that WCF clients manage with the **WS-AtomicTransaction** and **OleTransaction** transaction protocols.</span></span> <span data-ttu-id="0f407-187">消息可以传输到目标接收位置和删除从 MessageBox 数据库在事务上下文中使用的事务协议。</span><span class="sxs-lookup"><span data-stu-id="0f407-187">Messages can be transmitted to the destination receive locations and deleted from the MessageBox database in a transactional context by using the transaction protocols.</span></span>  
  
 <span data-ttu-id="0f407-188">为与远程 WCF 接收位置使用的事务协议，必须适当地配置 MSDTC**的安全配置**WCF 客户端计算机上的选项。</span><span class="sxs-lookup"><span data-stu-id="0f407-188">To communicate with remote WCF receive locations by using the transaction protocols, you must appropriately configure MSDTC **Security Configuration** options on WCF client computers.</span></span> <span data-ttu-id="0f407-189">下表列出了所需的值的选项，可在 MSDTC**的安全配置**对话框：</span><span class="sxs-lookup"><span data-stu-id="0f407-189">The following table lists the required values for the options that are available in the MSDTC **Security Configuration** dialog box:</span></span>  
  
|<span data-ttu-id="0f407-190">配置选项</span><span class="sxs-lookup"><span data-stu-id="0f407-190">Configuration option</span></span>|<span data-ttu-id="0f407-191">默认值</span><span class="sxs-lookup"><span data-stu-id="0f407-191">Default value</span></span>|<span data-ttu-id="0f407-192">推荐值</span><span class="sxs-lookup"><span data-stu-id="0f407-192">Recommended value</span></span>|  
|--------------------------|-------------------|-----------------------|  
|<span data-ttu-id="0f407-193">网络 DTC 访问</span><span class="sxs-lookup"><span data-stu-id="0f407-193">Network DTC Access</span></span>|<span data-ttu-id="0f407-194">禁用</span><span class="sxs-lookup"><span data-stu-id="0f407-194">Disabled</span></span>|<span data-ttu-id="0f407-195">Enabled</span><span class="sxs-lookup"><span data-stu-id="0f407-195">Enabled</span></span>|  
|<span data-ttu-id="0f407-196">允许出站</span><span class="sxs-lookup"><span data-stu-id="0f407-196">Allow Outbound</span></span>|<span data-ttu-id="0f407-197">禁用</span><span class="sxs-lookup"><span data-stu-id="0f407-197">Disabled</span></span>|<span data-ttu-id="0f407-198">Enabled</span><span class="sxs-lookup"><span data-stu-id="0f407-198">Enabled</span></span>|  
|<span data-ttu-id="0f407-199">要求进行相互身份验证</span><span class="sxs-lookup"><span data-stu-id="0f407-199">Mutual Authentication Required</span></span>|<span data-ttu-id="0f407-200">Enabled</span><span class="sxs-lookup"><span data-stu-id="0f407-200">Enabled</span></span>|<span data-ttu-id="0f407-201">如果相应的远程接收位置都运行 Windows Server 2003 SP1 或 SP2，并且配置为包含已启用**要求相互身份验证**。</span><span class="sxs-lookup"><span data-stu-id="0f407-201">Enabled if the corresponding remote receive locations are running Windows Server 2003 SP1 or SP2, and are configured with **Mutual Authentication Required**.</span></span>|  
|<span data-ttu-id="0f407-202">要求对呼叫方进行身份验证</span><span class="sxs-lookup"><span data-stu-id="0f407-202">Incoming Caller Authentication Required</span></span>|<span data-ttu-id="0f407-203">禁用</span><span class="sxs-lookup"><span data-stu-id="0f407-203">Disabled</span></span>|<span data-ttu-id="0f407-204">如果运行 MSDTC 的群集上，启用。</span><span class="sxs-lookup"><span data-stu-id="0f407-204">Enabled if running MSDTC on a cluster.</span></span>|  
  
 <span data-ttu-id="0f407-205">应用这些更改后，您必须重新启动 MSDTC 服务。</span><span class="sxs-lookup"><span data-stu-id="0f407-205">After you apply these changes, you have to restart the MSDTC service.</span></span>  
  
 <span data-ttu-id="0f407-206">若要访问 MSDTC**的安全配置**对话框框中，请执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="0f407-206">To access the MSDTC **Security Configuration** dialog box, follow these steps:</span></span>  
  
1.  <span data-ttu-id="0f407-207">单击**启动**，单击**运行**，然后键入**dcomcnfg**以启动**组件服务**管理控制台。</span><span class="sxs-lookup"><span data-stu-id="0f407-207">Click **Start**, click **Run**, and type **dcomcnfg** to launch the **Component Services** Management console.</span></span>  
  
2.  <span data-ttu-id="0f407-208">展开**组件服务**，展开**计算机**，右键单击**我的电脑**，然后单击**属性**。</span><span class="sxs-lookup"><span data-stu-id="0f407-208">Expand **Component Services**, expand **Computers**, right-click **My Computer**, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="0f407-209">在中**我的电脑属性**对话框中，单击**MSDTC**选项卡，然后依次**安全配置**以显示**安全配置**对话框。</span><span class="sxs-lookup"><span data-stu-id="0f407-209">In the **My Computer Properties** dialog box, click the **MSDTC** tab, and then click **Security Configuration** to display the **Security Configuration** dialog box.</span></span>  
  
## <a name="explanation-of-the-soap-wrapper-when-using-the-biztalk-wcf-service-publishing-wizard"></a><span data-ttu-id="0f407-210">使用 BizTalk WCF 服务发布向导时 SOAP 包装的说明</span><span class="sxs-lookup"><span data-stu-id="0f407-210">Explanation of the SOAP wrapper when using the BizTalk WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="0f407-211">当业务流程公开为[!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)]服务通过使用[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]生成服务发布向导，一个包装器。</span><span class="sxs-lookup"><span data-stu-id="0f407-211">When an orchestration is exposed as a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] service by using the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Service Publishing Wizard, a wrapper is generated.</span></span> <span data-ttu-id="0f407-212">此包装器使用的端口将消息发送 XML 消息中的方法名称。</span><span class="sxs-lookup"><span data-stu-id="0f407-212">This wrapper uses the method name of the port in the XML message to which the message is sent.</span></span> <span data-ttu-id="0f407-213">此包装是 Microsoft SOAP 信封的默认值。</span><span class="sxs-lookup"><span data-stu-id="0f407-213">This wrapper is the default for Microsoft SOAP envelopes.</span></span> <span data-ttu-id="0f407-214">它允许[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]包装 WCF 消息由适配器传输到的终结点中的多个部分组成的 SOAP 消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-214">It allows [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] to wrap the multi-part SOAP message in one WCF message to be transmitted to the endpoint by the adapter.</span></span>  
  
 <span data-ttu-id="0f407-215">最佳做法是，发送方应使用包装和接收方应，或发送方不应使用一个包装器和接收方应接收原始[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]消息。</span><span class="sxs-lookup"><span data-stu-id="0f407-215">As a best practice, either the sender should use a wrapper and the receiver should expect it, or the sender should not use a wrapper and the receiver should expect the raw [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message.</span></span> <span data-ttu-id="0f407-216">无法提前预知使用包装是否会导致之间发送和接收到的内容不兼容性问题。</span><span class="sxs-lookup"><span data-stu-id="0f407-216">Failure to agree ahead of time on whether to use a wrapper can cause incompatibility issues between what is sent and what is received.</span></span>