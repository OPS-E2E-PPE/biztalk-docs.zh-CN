---
title: 接收适配器发布 WCF 服务和 WCF 时的注意事项 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- publishing, WCF services
- WCF adapters, best practices
- WCF adapters, receive adapters
- WCF services, publishing
- best practices, WCF adapters
ms.assetid: 797b7ffd-534c-4f09-9738-fb17b208bc96
caps.latest.revision: 34
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f9c232f085647d3f69f576232ec9d9adb3b01a2b
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37004078"
---
# <a name="considerations-when-publishing-wcf-services-with-the-wcf-receive-adapters"></a><span data-ttu-id="88a71-102">通过 WCF 接收适配器发布 WCF 服务时的注意事项</span><span class="sxs-lookup"><span data-stu-id="88a71-102">Considerations When Publishing WCF Services with the WCF Receive Adapters</span></span>
<span data-ttu-id="88a71-103">本主题提供在通过 WCF 接收适配器发布 WCF 服务时应当注意的信息。</span><span class="sxs-lookup"><span data-stu-id="88a71-103">This topic provides information that you should take into consideration when publishing WCF services with the WCF receive adapters.</span></span>  <span data-ttu-id="88a71-104">如果使用 WCF 适配器发布服务，会允许该服务由 WCF 客户端调用，就像该服务是一个典型的 WCF 服务一样。</span><span class="sxs-lookup"><span data-stu-id="88a71-104">Publishing a service using a WCF adapter allows it to be called by a WCF client as if it were a typical WCF service.</span></span>  
  
## <a name="in-process-hosting"></a><span data-ttu-id="88a71-105">进程内托管</span><span class="sxs-lookup"><span data-stu-id="88a71-105">In-Process Hosting</span></span>  
 <span data-ttu-id="88a71-106">如果在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 进程空间 btsntsvc.exe 内托管接收位置，可以简化开发和部署过程。</span><span class="sxs-lookup"><span data-stu-id="88a71-106">Hosting the receive location within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process space, btsntsvc.exe, allows the benefits of simplified development and deployment.</span></span> <span data-ttu-id="88a71-107">此外，它比在 IIS 中托管能够创建更多的主机实例，从而能够利用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的高可用性和负载平衡功能。</span><span class="sxs-lookup"><span data-stu-id="88a71-107">Additionally, it creates more host instances than hosting in IIS to take advantage of the high-availability and load balancing capabilities of  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  <span data-ttu-id="88a71-108">在外进行托管的信息[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]在 IIS 中的过程是指[对于独立 WCF 接收适配器配置 IIS](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="88a71-108">For information in hosting outside of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] process in IIS refer to [Configuring IIS for the Isolated WCF Receive Adapters](../core/configuring-iis-for-the-isolated-wcf-receive-adapters.md).</span></span>  
  
## <a name="set-the-isoneway-property-of-wcf-services-published-with-the-wcf-adapters-except-for-the-wcf-netmsmq-receive-adapter-to-false"></a><span data-ttu-id="88a71-109">将 WCF 适配器（WCF-NetMsmq 接收适配器除外）发布的 WCF 服务的 IsOneWay 属性设置为 false</span><span class="sxs-lookup"><span data-stu-id="88a71-109">Set the IsOneWay property of WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) to false</span></span>  
 <span data-ttu-id="88a71-110">**System.ServiceModel.OperationContractAttribute.IsOneWay**通过 WCF 适配器发布的 WCF 服务属性，接收的适配器设置为使用 Wcf-netmsmq 发布的服务除外 **，则返回 true** -设置为**false**甚至对于单向接收位置。</span><span class="sxs-lookup"><span data-stu-id="88a71-110">The **System.ServiceModel.OperationContractAttribute.IsOneWay** property of WCF services published with the WCF adapters—except for services published with the WCF-NetMsmq receive adapter where it is set to **true** —is set to **false** even for the one-way receive locations.</span></span> <span data-ttu-id="88a71-111">如果**IsOneWay**属性设置为**false**，甚至是返回的方法**void**生成答复消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-111">If the **IsOneWay** property is set to **false**, even methods that return a **void** result in a reply message.</span></span> <span data-ttu-id="88a71-112">在这种情况下，基础结构将创建并发送一则空消息，向调用方指明该方法已返回。</span><span class="sxs-lookup"><span data-stu-id="88a71-112">In this case, the infrastructure creates and sends an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="88a71-113">使用此方法，基础结构可以向客户端回发服务操作引发的异常。</span><span class="sxs-lookup"><span data-stu-id="88a71-113">Using this approach enables the infrastructure to send exceptions thrown by the service operation back to the client.</span></span>  
  
 <span data-ttu-id="88a71-114">若要在其中使用通过 WCF 适配器 （对于 Wcf-netmsmq 接收适配器除外） 发布的 WCF 服务**IsOneWay**是**false**，则**IsOneWay**属性客户端必须设置为**false** ，如下所示：</span><span class="sxs-lookup"><span data-stu-id="88a71-114">To consume WCF services published with the WCF adapters (except for the WCF-NetMsmq receive adapter) in which **IsOneWay** is **false**, the **IsOneWay** property on the client side must be set to **false** as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="88a71-115">因为默认值**IsOneWay**属性是**false**，无需在代码中指定该属性。</span><span class="sxs-lookup"><span data-stu-id="88a71-115">Because the default value of the **IsOneWay** property is **false**, you do not have to specify the property in the code.</span></span>  
  
## <a name="the-replyaction-property-of-the-operationcontractattribute-on-the-client-side-should-be-set-to--an-asterisk-when-consuming-wcf-services-published-with-one-way-receive-locations"></a><span data-ttu-id="88a71-116">在使用通过单向接收位置发布的 WCF 服务时，客户端上 OperationContractAttribute 的 ReplyAction 属性应当设置为“\*”（星号）</span><span class="sxs-lookup"><span data-stu-id="88a71-116">The ReplyAction property of the OperationContractAttribute on the client side should be set to "\*" (an asterisk) when consuming WCF services published with one-way receive locations</span></span>  
 <span data-ttu-id="88a71-117">**System.ServiceModel.OperationContractAttribute.ReplyAction**的属性**System.ServiceModel.OperationContractAttribute**可以在客户端上用于指定的值从 WCF 服务的响应消息的 SOAP 操作。</span><span class="sxs-lookup"><span data-stu-id="88a71-117">The **System.ServiceModel.OperationContractAttribute.ReplyAction** property of the **System.ServiceModel.OperationContractAttribute** can be used on the client side to specify the value of the SOAP action for the response messages from WCF services.</span></span>  
  
 <span data-ttu-id="88a71-118">除了为答复消息的操作头指定特定值以外（以通知客户端这是一个答复，以及要执行的操作），还可以指定字符串“\*”（星号）。</span><span class="sxs-lookup"><span data-stu-id="88a71-118">In addition to specifying a particular value for the action header of the reply message (to notify the client this is a reply and what action to be taken), you can also specify the string "\*" (an asterisk).</span></span> <span data-ttu-id="88a71-119">在客户端应用程序中指定星号即指示客户端不验证服务所发送的响应消息中的答复操作。</span><span class="sxs-lookup"><span data-stu-id="88a71-119">Specifying an asterisk in a client application instructs the client not to validate the reply action in response messages that the service sends.</span></span>  
  
 <span data-ttu-id="88a71-120">使用 WCF 服务发布的单向接收位置，代理方法 WCF 服务必须返回**void**，在这种情况下代理方法希望 WCF 服务会发送空消息来向调用方指示，该方法已返回。</span><span class="sxs-lookup"><span data-stu-id="88a71-120">To consume a WCF service published by a one-way receive location, the proxy method for the WCF service must return **void**, in which case the proxy method expects that the WCF service will send an empty message to indicate to the caller that the method has returned.</span></span> <span data-ttu-id="88a71-121">为代理方法能够收到这则空消息， **ReplyAction**的属性**OperationContractAttribute**应设置为"\*"（星号），如下所示：</span><span class="sxs-lookup"><span data-stu-id="88a71-121">For the proxy method to receive this empty message, the **ReplyAction** property of the **OperationContractAttribute** should be set to "\*" (an asterisk) as follows:</span></span>  
  
```  
[ServiceContract(Namespace="Microsoft.WCF.Documentation")]  
  public interface ISampleService{  
    [OperationContract(IsOneWay=false, ReplyAction="*",Action="…"]  
    string SampleMethod(string msg);  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="88a71-122">不需要设置**ReplyAction**属性设置为"\*"（星号） 对于 Wcf-netmsmq 适配器，因为 Wcf-netmsmq 适配器要求 WCF 客户端可以设置**IsOneWay**属性 **，则返回 true**。</span><span class="sxs-lookup"><span data-stu-id="88a71-122">You do not have to set the **ReplyAction** property to "\*" (an asterisk) for the WCF-NetMsmq adapter, because the WCF-NetMsmq adapter requires the WCF clients to set the **IsOneWay** property to **true**.</span></span>  
  
## <a name="an-isolated-host-instance-can-run-only-one-adapter"></a><span data-ttu-id="88a71-123">一个独立主机实例只能运行一个适配器</span><span class="sxs-lookup"><span data-stu-id="88a71-123">An isolated host instance can run only one adapter</span></span>  
 <span data-ttu-id="88a71-124">一个独立主机实例只能运行一个适配器。</span><span class="sxs-lookup"><span data-stu-id="88a71-124">An isolated host instance can run only one adapter.</span></span> <span data-ttu-id="88a71-125">如果用一个独立主机配置多个独立适配器（如 HTTP、SOAP 和 WCF 适配器）的接收处理程序，则必须创建多个应用程序池，每个适配器对应一个应用程序池。</span><span class="sxs-lookup"><span data-stu-id="88a71-125">If you configure the receive handlers of multiple isolated adapters such as HTTP, SOAP, and WCF adapters with one isolated host, you must create multiple application pools, one application pool for each adapter.</span></span> <span data-ttu-id="88a71-126">有关 biztalk 独立主机的详细信息，请参阅[启用 Web 服务](../core/enabling-web-services.md)。</span><span class="sxs-lookup"><span data-stu-id="88a71-126">For more information about BizTalk isolated hosts, see [Enabling Web Services](../core/enabling-web-services.md).</span></span>  
  
## <a name="use-the-template----content-specified-by-template-option-when-sending-non-xml-content-as-response-messages"></a><span data-ttu-id="88a71-127">在发送 XML 内容作为响应消息时使用“模板 - 由模板指定的内容”选项</span><span class="sxs-lookup"><span data-stu-id="88a71-127">Use the "Template -- content specified by template" option when sending non-XML content as response messages</span></span>  
 <span data-ttu-id="88a71-128">使用 WCF 适配器**正文--BizTalk 响应消息正文**（默认值） 选项不允许发送字符数据和位图图像等非 XML 消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-128">The WCF adapters with **Body -- BizTalk response message body** (the default value) option do not allow sending non-XML messages such as character data and bitmap images.</span></span> <span data-ttu-id="88a71-129">可以使用**模板-由模板指定的内容**WCF 适配器能够发送非 XML 消息的选项。</span><span class="sxs-lookup"><span data-stu-id="88a71-129">You can use the **Template -- content specified by template** option for the WCF adapters to send non-XML messages.</span></span> <span data-ttu-id="88a71-130">有关如何使用模板的详细信息，请参阅[指定 WCF 适配器的消息正文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="88a71-130">For more information about how to use the template, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-service-published-with-the-wcf-service-publishing-wizard"></a><span data-ttu-id="88a71-131">为通过 WCF 服务发布向导发布的 WCF 服务设置权限</span><span class="sxs-lookup"><span data-stu-id="88a71-131">Setting up the permissions for a WCF service published with the WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="88a71-132">在 [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] 或 [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] 平台上使用通过 WCF 服务发布向导创建的 ASP.NET 应用程序时，在调用 WCF 服务期间可能会出现与访问 DLL 相关的错误。</span><span class="sxs-lookup"><span data-stu-id="88a71-132">When using ASP.NET applications created with the WCF Service Publishing Wizard on the [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] or [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] platform, errors relating to accessing DLLs during WCF service invocation may occur.</span></span> <span data-ttu-id="88a71-133">通常这些错误与默认的 [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] 和 [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] 安全问题有关。</span><span class="sxs-lookup"><span data-stu-id="88a71-133">These errors are typically related to issues with default [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] security.</span></span> <span data-ttu-id="88a71-134">有关这些错误的详细信息，请参阅 Microsoft 帮助和支持文章名为"，收到 'System.IO.FileNotFoundException' 错误时在客户端应用程序调用 Web 服务"帮助和支持网站上在[ http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span><span class="sxs-lookup"><span data-stu-id="88a71-134">For more information about these errors, see the Microsoft Help and Support article called "You Receive a "System.IO.FileNotFoundException" Error When the Client Application Calls a Web Service" on the Help and Support Web site at [http://go.microsoft.com/fwlink/?LinkId=43659](http://go.microsoft.com/fwlink/?LinkId=43659).</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="88a71-135"> 要求：无论 WCF 服务是在进程内主机上运行还是在独立主机上运行，运行该服务的进程都必须被授予适当的权限。</span><span class="sxs-lookup"><span data-stu-id="88a71-135"> requires that the process running the WCF service is granted the appropriate permissions whether an in-process host or an isolated host runs the service.</span></span> <span data-ttu-id="88a71-136">在 [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] 和 [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] 中，独立主机的默认 Windows 组是 Isolated Host Users 组，因此为 Isolated Host Users 组添加权限应当能够解决此问题。</span><span class="sxs-lookup"><span data-stu-id="88a71-136">Under [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] and [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] the default Windows group for isolated hosts is the Isolated Host Users Group, so adding the permissions to the Isolated Host Users Group should resolve this issue.</span></span>  
  
#### <a name="to-add-the-permissions-to-the-isolated-host-users-group"></a><span data-ttu-id="88a71-137">为 Isolated Host Users 组添加权限</span><span class="sxs-lookup"><span data-stu-id="88a71-137">To add the permissions to the Isolated Host Users Group</span></span>  
  
1.  <span data-ttu-id="88a71-138">在 Microsoft Windows 资源管理器中，找到 %windir%\temp 目录。</span><span class="sxs-lookup"><span data-stu-id="88a71-138">In Microsoft Windows Explorer, locate the %windir%\temp directory.</span></span>  
  
2.  <span data-ttu-id="88a71-139">右键单击 windir%\temp，然后依次**属性**。</span><span class="sxs-lookup"><span data-stu-id="88a71-139">Right-click %windir%\temp, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="88a71-140">在中**属性**对话框中，单击**安全**选项卡。</span><span class="sxs-lookup"><span data-stu-id="88a71-140">In the **Properties** dialog box, click the **Security** tab.</span></span>  
  
4.  <span data-ttu-id="88a71-141">单击**外**，选择**Isolated Host Users 组**，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="88a71-141">Click **Add**, select **the Isolated Host Users Group**, and then click **OK**.</span></span>  
  
## <a name="setting-up-the-permissions-for-a-wcf-receive-location-with-the-wcf-netmsmq-adapter"></a><span data-ttu-id="88a71-142">为带有 WCF-NetMsmq 适配器的 WCF 接收位置设置权限</span><span class="sxs-lookup"><span data-stu-id="88a71-142">Setting up the permissions for a WCF receive location with the WCF-NetMsmq adapter</span></span>  
 <span data-ttu-id="88a71-143">当使用 NetMsmqBinding 的 WCF 客户端向通过 WCF-NetMsmq 适配器发布的 WCF 服务发送消息时，它会将消息发送到目标队列（也就是由服务的队列管理器管理的队列）。</span><span class="sxs-lookup"><span data-stu-id="88a71-143">When a WCF client using the NetMsmqBinding sends a message to a WCF service published with the WCF-NetMsmq adapter, it addresses the message to the target queue, which is the queue managed by the service's queue manager.</span></span> <span data-ttu-id="88a71-144">客户端上的队列管理器会将该消息发送到传输（或传出）队列。</span><span class="sxs-lookup"><span data-stu-id="88a71-144">The queue manager on the client sends the message to a transmission (or outgoing) queue.</span></span> <span data-ttu-id="88a71-145">传输队列是客户端队列管理器上的一个队列，用来存储要传输到目标队列的消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-145">The transmission queue is a queue on the client-side queue manager that stores messages for transmission to the target queue.</span></span>  
  
 <span data-ttu-id="88a71-146">服务的队列管理器接受发送到它所拥有的目标队列的消息，并存储这些消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-146">The service's queue manager accepts messages addressed to the target queues it owns and stores the messages.</span></span> <span data-ttu-id="88a71-147">然后，服务会请求从目标队列读取消息，而队列管理器会将这些消息传送给该服务。</span><span class="sxs-lookup"><span data-stu-id="88a71-147">Then, the service makes requests to read from the target queue, and the queue manager delivers the messages to the service.</span></span> <span data-ttu-id="88a71-148">因此，承载接收位置的 BizTalk 主机实例的服务帐户应当具有从目标队列进行读取的权限。</span><span class="sxs-lookup"><span data-stu-id="88a71-148">For this reason, the service account for the BizTalk host instance hosting the receive location should have the permissions to read from the target queue.</span></span>  
  
## <a name="use-an-empty-body-path-expression-to-receive-a-soap-message-with-character-data-in-the-content-of-the-soap-body-element"></a><span data-ttu-id="88a71-149">使用空的正文路径表达式接收在 SOAP Body 元素内容中有字符数据的 SOAP 消息</span><span class="sxs-lookup"><span data-stu-id="88a71-149">Use an empty body path expression to receive a SOAP message with character data in the content of the SOAP Body element</span></span>  
 <span data-ttu-id="88a71-150">为了使 WCF 接收适配器从传入响应消息的 soap 内容中有字符数据创建 BizTalk 消息**正文**元素，如下面的示例中所示，应该将**正文路径表达式**文本框留空**消息**WCF 适配器传输属性对话框中的选项卡。</span><span class="sxs-lookup"><span data-stu-id="88a71-150">For a WCF receive adapter to create a BizTalk message from an incoming response message with character data in the content of the SOAP **Body** element, as shown in the following example, you should leave the **Body path expression** text box empty on the **Message** tab in the WCF adapter transport properties dialog box.</span></span>  
  
```  
<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing">  
    <s:Header>  
      ...  
    </s:Header>  
    <s:Body>Contoso</s:Body>  
</s:Envelope>  
```  
  
 <span data-ttu-id="88a71-151">如果选择**信封**或**正文**选项时，适配器无法创建 BizTalk 消息，从前面的传入消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-151">If you select the **Envelope** or **Body** option, the adapter cannot create the BizTalk message from the previous incoming message.</span></span> <span data-ttu-id="88a71-152">该消息不会挂起，因为在入站 SOAP 封送处理中失败的消息不会挂起。</span><span class="sxs-lookup"><span data-stu-id="88a71-152">The message is not suspended because messages that fail in the inbound SOAP marshaling processing are not suspended.</span></span> <span data-ttu-id="88a71-153">详细了解如何在使用的正文路径表达式**消息**选项卡上，请参阅[WCF 适配器指定消息正文](../core/specifying-the-message-body-for-the-wcf-adapters.md)。</span><span class="sxs-lookup"><span data-stu-id="88a71-153">For more information about how to use the body path expression on the **Message** tab, see [Specifying the Message Body for the WCF Adapters](../core/specifying-the-message-body-for-the-wcf-adapters.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="88a71-154">可以通过配置 BTSNTSvc.exe.config 文件来使用 Windows SDK 中的 TraceViewer 工具 (SvcTraceViewer.exe)。</span><span class="sxs-lookup"><span data-stu-id="88a71-154">You can use the TraceViewer tool (SvcTraceViewer.exe) in the Windows SDK by configuring the BTSNTSvc.exe.config.file.</span></span> <span data-ttu-id="88a71-155">有关 Windows SDK 的详细信息，请参阅"什么是 Windows SDK 中的新增功能"处[ http://go.microsoft.com/fwlink/?LinkId=75219 ](http://go.microsoft.com/fwlink/?LinkId=75219)。</span><span class="sxs-lookup"><span data-stu-id="88a71-155">For more information about the Windows SDK, see "What's New in the Windows SDK" at [http://go.microsoft.com/fwlink/?LinkId=75219](http://go.microsoft.com/fwlink/?LinkId=75219).</span></span> <span data-ttu-id="88a71-156">有关 TraceViewer 工具的详细信息，请参阅"TraceViewer 工具 (SvcTraceViewer.exe)"在[ http://go.microsoft.com/fwlink/?LinkId=75218 ](http://go.microsoft.com/fwlink/?LinkId=75218)。</span><span class="sxs-lookup"><span data-stu-id="88a71-156">For more information about the TraceViewer tool, see "TraceViewer Tool (SvcTraceViewer.exe)" at [http://go.microsoft.com/fwlink/?LinkId=75218](http://go.microsoft.com/fwlink/?LinkId=75218).</span></span>  
  
## <a name="using-schemas-that-reference-other-schemas"></a><span data-ttu-id="88a71-157">使用引用其他架构的架构</span><span class="sxs-lookup"><span data-stu-id="88a71-157">Using schemas that reference other schemas</span></span>  
 <span data-ttu-id="88a71-158">可以使用**重新定义**，**包括**，并**导入**元素时架构变得大而复杂，或当架构表示不同类型的实例消息具有共同某些部分。</span><span class="sxs-lookup"><span data-stu-id="88a71-158">You can use the **redefine**, **include**, and **import** elements when your schemas become large and complex, or when the schemas that represent your different types of instance messages have some portions in common.</span></span> <span data-ttu-id="88a71-159">可能有必要将较小的架构组合成新的架构，这个新的架构可以最终定义要与贸易合作伙伴进行交换的实例消息的结构。</span><span class="sxs-lookup"><span data-stu-id="88a71-159">It can be useful to combine smaller schemas into the schemas that ultimately define the structure of the instance messages you plan to exchange with trading partners.</span></span> <span data-ttu-id="88a71-160">可使用 BizTalk WCF 服务发布向导将这些架构发布为 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="88a71-160">You can publish these schemas as WCF services by using the BizTalk WCF Service Publishing Wizard.</span></span>  
  
 <span data-ttu-id="88a71-161">应当使用 BizTalk WCF 服务使用向导创建从 BizTalk 项目使用 WCF 服务所必需的 BizTalk 项目。</span><span class="sxs-lookup"><span data-stu-id="88a71-161">You should use the BizTalk WCF Service Consuming Wizard to create the BizTalk artifacts necessary to consume the WCF services from a BizTalk project.</span></span> <span data-ttu-id="88a71-162">如果要从 .NET 应用程序使用 WCF 服务，应当使用服务模型元数据实用工具 (Svcutil.exe) 为 WCF 服务创建代理类。</span><span class="sxs-lookup"><span data-stu-id="88a71-162">If you want to consume the WCF services from a .NET application, you should use the Service Model Metadata Utility tool (Svcutil.exe) to create the proxy class for the WCF services.</span></span> <span data-ttu-id="88a71-163">有关如何使用引用其他架构的架构的详细信息，请参阅[，使用其他架构](../core/schemas-that-use-other-schemas.md)并[如何创建，使用其他架构](../core/how-to-create-schemas-that-use-other-schemas.md)。</span><span class="sxs-lookup"><span data-stu-id="88a71-163">For more information about how to use schemas that reference other schemas, see [Schemas That Use Other Schemas](../core/schemas-that-use-other-schemas.md) and [How to Create Schemas That Use Other Schemas](../core/how-to-create-schemas-that-use-other-schemas.md).</span></span> <span data-ttu-id="88a71-164">有关 Svcutil.exe 的详细信息，请参阅"服务模型元数据实用工具工具 (Svcutil.exe) 在" [ http://go.microsoft.com/fwlink/?LinkID=74696 ](http://go.microsoft.com/fwlink/?LinkID=74696)。</span><span class="sxs-lookup"><span data-stu-id="88a71-164">For more information about Svcutil.exe, see "Service Model Metadata Utility Tool (Svcutil.exe)" at [http://go.microsoft.com/fwlink/?LinkID=74696](http://go.microsoft.com/fwlink/?LinkID=74696).</span></span>  
  
 <span data-ttu-id="88a71-165">下表显示了在使用已发布的、其架构使用其他架构的 WCF 服务时，需要了解的限制和注意事项。</span><span class="sxs-lookup"><span data-stu-id="88a71-165">The following table shows the limitations and considerations that you need to know when consuming published WCF services with schemas that use other schemas.</span></span>  
  
|<span data-ttu-id="88a71-166">XML 架构元素</span><span class="sxs-lookup"><span data-stu-id="88a71-166">XML schema element</span></span>|<span data-ttu-id="88a71-167">使用通过 BizTalk WCF 服务发布向导发布的 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="88a71-167">Consuming WCF services published with the BizTalk WCF Service Publishing Wizard</span></span>|<span data-ttu-id="88a71-168">使用由 .NET 应用程序承载的 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="88a71-168">Consuming WCF services hosted by .NET applications</span></span>|  
|------------------------|-------------------------------------------------------------------------------------|--------------------------------------------------------|  
|<span data-ttu-id="88a71-169">\<import\></span><span class="sxs-lookup"><span data-stu-id="88a71-169">\<import\></span></span>|<span data-ttu-id="88a71-170">BizTalk WCF 服务使用向导和 Svcutil.exe 均支持</span><span class="sxs-lookup"><span data-stu-id="88a71-170">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|<span data-ttu-id="88a71-171">BizTalk WCF 服务使用向导和 Svcutil.exe 均支持</span><span class="sxs-lookup"><span data-stu-id="88a71-171">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe</span></span>|  
|<span data-ttu-id="88a71-172">\<包括\></span><span class="sxs-lookup"><span data-stu-id="88a71-172">\<include\></span></span>|<span data-ttu-id="88a71-173">支持使用 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-173">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|<span data-ttu-id="88a71-174">支持使用 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-174">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
|<span data-ttu-id="88a71-175">\<redefine\></span><span class="sxs-lookup"><span data-stu-id="88a71-175">\<redefine\></span></span>|<span data-ttu-id="88a71-176">-支持使用 BizTalk WCF 服务使用向导</span><span class="sxs-lookup"><span data-stu-id="88a71-176">-   Supported with the BizTalk WCF Service Consuming Wizard</span></span><br /><span data-ttu-id="88a71-177">-有限的支持由 Svcutil.exe**注意：** Svcutil.exe 具有相同的限制**重新定义**元素的 xsd.exe 具有。</span><span class="sxs-lookup"><span data-stu-id="88a71-177">-   Limited support by Svcutil.exe **Note:**  Svcutil.exe has the same limitation for the **redefine** element as XSD.exe has.</span></span>|<span data-ttu-id="88a71-178">支持使用 BizTalk WCF 服务使用向导和 Svcutil.exe**注意：** 创建代理类时，Svcutil.exe 可能会引发一条警告消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-178">Supported with both the BizTalk WCF Service Consuming Wizard and Svcutil.exe **Note:**  Svcutil.exe may raise a warning message when creating the proxy class.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="88a71-179">与使用的架构创建对已发布的 BizTalk WCF 服务的代理类时，Svcutil.exe 可能会引发一条警告消息**包括**并**重新定义**元素。</span><span class="sxs-lookup"><span data-stu-id="88a71-179">Svcutil.exe may raise a warning message when creating the proxy class against the published BizTalk WCF service with the schemas using the **include** and **redefine** elements.</span></span> <span data-ttu-id="88a71-180">例如，“The global element has already been declared.”（此全局元素已声明。）</span><span class="sxs-lookup"><span data-stu-id="88a71-180">For example, "The global element has already been declared."</span></span>  
  
## <a name="ensure-that-an-in-process-wcf-receive-location-is-not-disabled-after-you-change-the-computer-name-part-in-its-service-endpoint-address"></a><span data-ttu-id="88a71-181">在更改了服务终结点地址中的计算机名部分之后，请确保相应的进程内 WCF 接收位置未被禁用。</span><span class="sxs-lookup"><span data-stu-id="88a71-181">Ensure that an in-process WCF receive location is not disabled after you change the computer name part in its service endpoint address</span></span>  
 <span data-ttu-id="88a71-182">如果更改中的计算机名称部分**地址 (URI)** 文本框中的进程内运行 WCF 接收位置，我们建议使用 BizTalk 管理控制台来检查是否仍在运行接收位置。</span><span class="sxs-lookup"><span data-stu-id="88a71-182">If you change the computer name part in the **Address (URI)** text box of a running in-process WCF receive location, we recommend that you use the BizTalk Administration console to check whether the receive location is still running.</span></span> <span data-ttu-id="88a71-183">例如，如果你更改服务终结点地址使用的 Wcf-nettcp 接收适配器，请**net.tcp://\<**<em>您的计算机名称</em>**\>/samplepath**到**net.tcp://localhost/samplepath**，可能会禁用该接收位置与**Service.InvalidOperationException**。</span><span class="sxs-lookup"><span data-stu-id="88a71-183">For example, if you change a service endpoint address using the WCF-NetTcp receive adapter, **net.tcp://\<**<em>Your Computer Name</em>**\>/samplepath**, to **net.tcp://localhost/samplepath**, the receive location may be disabled with a **Service.InvalidOperationException**.</span></span> <span data-ttu-id="88a71-184">如果只更改服务终结点地址中的计算机名部分，而不修改路径部分，则请确保接收位置未被禁用，如有必要请启用它。</span><span class="sxs-lookup"><span data-stu-id="88a71-184">If you change only the computer name part in the service endpoint address without modifying the path part, make sure that the receive location is not disabled, and enable it if necessary.</span></span>  
  
## <a name="set-the-appropriate-msdtc-security-configuration-options-on-client-computers-communicating-with-remote-wcf-receive-locations-through-a-transaction-protocol"></a><span data-ttu-id="88a71-185">在通过事务协议与远程 WCF 接收位置进行通信的客户端计算机上设置相应的 MSDTC 安全配置选项</span><span class="sxs-lookup"><span data-stu-id="88a71-185">Set the appropriate MSDTC Security Configuration options on client computers communicating with remote WCF receive locations through a transaction protocol</span></span>  
 <span data-ttu-id="88a71-186">Wcf-nettcp、 Wcf-wshttp 和 Wcf-netnamedpipe 接收适配器可以参与事务性协调进程使用 WCF 客户端管理的**WS-AtomicTransaction**和**OleTransaction**事务协议。</span><span class="sxs-lookup"><span data-stu-id="88a71-186">WCF-NetTcp, WCF-WSHttp, and WCF-NetNamedPipe receive adapters can participate in transactional coordination processes that WCF clients manage with the **WS-AtomicTransaction** and **OleTransaction** transaction protocols.</span></span> <span data-ttu-id="88a71-187">可以在事务性上下文中使用事务协议将消息传输到目标接收位置并将其从 MessageBox 数据库中删除。</span><span class="sxs-lookup"><span data-stu-id="88a71-187">Messages can be transmitted to the destination receive locations and deleted from the MessageBox database in a transactional context by using the transaction protocols.</span></span>  
  
 <span data-ttu-id="88a71-188">为与远程 WCF 接收位置使用的事务协议，必须适当地配置 MSDTC**的安全配置**WCF 客户端计算机上的选项。</span><span class="sxs-lookup"><span data-stu-id="88a71-188">To communicate with remote WCF receive locations by using the transaction protocols, you must appropriately configure MSDTC **Security Configuration** options on WCF client computers.</span></span> <span data-ttu-id="88a71-189">下表列出了所需的值的选项，可在 MSDTC**的安全配置**对话框：</span><span class="sxs-lookup"><span data-stu-id="88a71-189">The following table lists the required values for the options that are available in the MSDTC **Security Configuration** dialog box:</span></span>  
  
|<span data-ttu-id="88a71-190">配置选项</span><span class="sxs-lookup"><span data-stu-id="88a71-190">Configuration option</span></span>|<span data-ttu-id="88a71-191">默认值</span><span class="sxs-lookup"><span data-stu-id="88a71-191">Default value</span></span>|<span data-ttu-id="88a71-192">推荐值</span><span class="sxs-lookup"><span data-stu-id="88a71-192">Recommended value</span></span>|  
|--------------------------|-------------------|-----------------------|  
|<span data-ttu-id="88a71-193">网络 DTC 访问</span><span class="sxs-lookup"><span data-stu-id="88a71-193">Network DTC Access</span></span>|<span data-ttu-id="88a71-194">禁用</span><span class="sxs-lookup"><span data-stu-id="88a71-194">Disabled</span></span>|<span data-ttu-id="88a71-195">已启用</span><span class="sxs-lookup"><span data-stu-id="88a71-195">Enabled</span></span>|  
|<span data-ttu-id="88a71-196">允许出站</span><span class="sxs-lookup"><span data-stu-id="88a71-196">Allow Outbound</span></span>|<span data-ttu-id="88a71-197">禁用</span><span class="sxs-lookup"><span data-stu-id="88a71-197">Disabled</span></span>|<span data-ttu-id="88a71-198">已启用</span><span class="sxs-lookup"><span data-stu-id="88a71-198">Enabled</span></span>|  
|<span data-ttu-id="88a71-199">要求进行相互身份验证</span><span class="sxs-lookup"><span data-stu-id="88a71-199">Mutual Authentication Required</span></span>|<span data-ttu-id="88a71-200">已启用</span><span class="sxs-lookup"><span data-stu-id="88a71-200">Enabled</span></span>|<span data-ttu-id="88a71-201">如果相应的远程接收位置都运行 Windows Server 2003 SP1 或 SP2，并且配置为包含已启用**要求相互身份验证**。</span><span class="sxs-lookup"><span data-stu-id="88a71-201">Enabled if the corresponding remote receive locations are running Windows Server 2003 SP1 or SP2, and are configured with **Mutual Authentication Required**.</span></span>|  
|<span data-ttu-id="88a71-202">要求对呼叫方进行身份验证</span><span class="sxs-lookup"><span data-stu-id="88a71-202">Incoming Caller Authentication Required</span></span>|<span data-ttu-id="88a71-203">禁用</span><span class="sxs-lookup"><span data-stu-id="88a71-203">Disabled</span></span>|<span data-ttu-id="88a71-204">如果运行 MSDTC 的群集上，启用。</span><span class="sxs-lookup"><span data-stu-id="88a71-204">Enabled if running MSDTC on a cluster.</span></span>|  
  
 <span data-ttu-id="88a71-205">在应用这些更改之后，必须重新启动 MSDTC 服务。</span><span class="sxs-lookup"><span data-stu-id="88a71-205">After you apply these changes, you have to restart the MSDTC service.</span></span>  
  
 <span data-ttu-id="88a71-206">若要访问 MSDTC**的安全配置**对话框框中，请执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="88a71-206">To access the MSDTC **Security Configuration** dialog box, follow these steps:</span></span>  
  
1.  <span data-ttu-id="88a71-207">单击**启动**，单击**运行**，然后键入**dcomcnfg**以启动**组件服务**管理控制台。</span><span class="sxs-lookup"><span data-stu-id="88a71-207">Click **Start**, click **Run**, and type **dcomcnfg** to launch the **Component Services** Management console.</span></span>  
  
2.  <span data-ttu-id="88a71-208">展开**组件服务**，展开**计算机**，右键单击**我的电脑**，然后单击**属性**。</span><span class="sxs-lookup"><span data-stu-id="88a71-208">Expand **Component Services**, expand **Computers**, right-click **My Computer**, and then click **Properties**.</span></span>  
  
3.  <span data-ttu-id="88a71-209">在中**我的电脑属性**对话框中，单击**MSDTC**选项卡，然后依次**安全配置**以显示**安全配置**对话框。</span><span class="sxs-lookup"><span data-stu-id="88a71-209">In the **My Computer Properties** dialog box, click the **MSDTC** tab, and then click **Security Configuration** to display the **Security Configuration** dialog box.</span></span>  
  
## <a name="explanation-of-the-soap-wrapper-when-using-the-biztalk-wcf-service-publishing-wizard"></a><span data-ttu-id="88a71-210">使用 BizTalk WCF 服务发布向导时 SOAP 包装的说明</span><span class="sxs-lookup"><span data-stu-id="88a71-210">Explanation of the SOAP wrapper when using the BizTalk WCF Service Publishing Wizard</span></span>  
 <span data-ttu-id="88a71-211">当使用 [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] 服务发布向导将业务流程作为 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务发布时，会生成一个包装。</span><span class="sxs-lookup"><span data-stu-id="88a71-211">When an orchestration is exposed as a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] service by using the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Service Publishing Wizard, a wrapper is generated.</span></span> <span data-ttu-id="88a71-212">包装将使用消息发送到的 XML 消息端口的方法名称。</span><span class="sxs-lookup"><span data-stu-id="88a71-212">This wrapper uses the method name of the port in the XML message to which the message is sent.</span></span> <span data-ttu-id="88a71-213">此包装是 Microsoft SOAP 信封的默认值。</span><span class="sxs-lookup"><span data-stu-id="88a71-213">This wrapper is the default for Microsoft SOAP envelopes.</span></span> <span data-ttu-id="88a71-214">它允许 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 包装 WCF 消息中通过适配器传输到终节点的多部分 SOAP 消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-214">It allows [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] to wrap the multi-part SOAP message in one WCF message to be transmitted to the endpoint by the adapter.</span></span>  
  
 <span data-ttu-id="88a71-215">作为最佳实践，发送方应使用包装，接收方应接收消息，或者，发送方不使用包装，接收方应接收原始 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 消息。</span><span class="sxs-lookup"><span data-stu-id="88a71-215">As a best practice, either the sender should use a wrapper and the receiver should expect it, or the sender should not use a wrapper and the receiver should expect the raw [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message.</span></span> <span data-ttu-id="88a71-216">无法提前预知使用包装是否会导致发送和接收内容之间的不兼容问题。</span><span class="sxs-lookup"><span data-stu-id="88a71-216">Failure to agree ahead of time on whether to use a wrapper can cause incompatibility issues between what is sent and what is received.</span></span>