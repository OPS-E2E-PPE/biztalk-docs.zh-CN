---
title: 教程 4： 创建使用 BizTalk Server 2013 的混合应用程序 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3a9de95f-7d2c-437d-be5b-0062592f32c6
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 4dca1edae471c7d0bb588c4d9dc45168a4f66a2c
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37007982"
---
# <a name="tutorial-4-creating-a-hybrid-application-using-biztalk-server-2013"></a><span data-ttu-id="e2b01-102">教程 4： 创建混合应用程序使用 BizTalk Server 2013</span><span class="sxs-lookup"><span data-stu-id="e2b01-102">Tutorial 4: Creating a Hybrid Application Using BizTalk Server 2013</span></span>
<span data-ttu-id="e2b01-103">本部分提供了有关如何创建包含[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]和 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的混合应用程序的分步概览。</span><span class="sxs-lookup"><span data-stu-id="e2b01-103">This section provides a step-by-step walkthrough on how to create a hybrid application involving [!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)] and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  

## <a name="business-scenario"></a><span data-ttu-id="e2b01-104">业务方案</span><span class="sxs-lookup"><span data-stu-id="e2b01-104">Business Scenario</span></span>  
 <span data-ttu-id="e2b01-105">Northwind 是一家接收合作伙伴（其中之一为 Contoso）销售订单（以平面文件 EDI 消息的形式）的企业。</span><span class="sxs-lookup"><span data-stu-id="e2b01-105">Northwind is an enterprise that receives sales orders from its partners, one of them being Contoso, in the form of a flat-file EDI message.</span></span> <span data-ttu-id="e2b01-106">Northwind 希望设置一个执行以下操作的端到端应用程序：</span><span class="sxs-lookup"><span data-stu-id="e2b01-106">Northwind wants to set up an end-to-end application that does the following:</span></span>  

- <span data-ttu-id="e2b01-107">**管理 EDI 消息处理**– 此模块应用程序必须验证从 Contoso 接收的消息是否符合标准的 EDI 消息格式。</span><span class="sxs-lookup"><span data-stu-id="e2b01-107">**Manage the EDI message processing** – This module of the application must verify that the message received from Contoso conforms to the standard EDI message formats.</span></span> <span data-ttu-id="e2b01-108">此模块还必须生成所有必需的确认以验证是否成功处理了消息。</span><span class="sxs-lookup"><span data-stu-id="e2b01-108">This module must also generate all the required acknowledgements to verify that the message is successfully processed.</span></span>  

- <span data-ttu-id="e2b01-109">**使用业务逻辑来处理数据**– 后已成功验证和处理 EDI 消息，Northwind 必须针对进行进一步处理的业务逻辑运行消息。</span><span class="sxs-lookup"><span data-stu-id="e2b01-109">**Use business logic to process the data** – Once the EDI message is successfully verified and processed, Northwind must run the message against business logic for further processing.</span></span> <span data-ttu-id="e2b01-110">例如，如果所收到消息中的订单数量超出了给定数量，则将数据存储在 SQL Server 数据库中，</span><span class="sxs-lookup"><span data-stu-id="e2b01-110">For example, if the order quantity in the received message is more than a given amount, the data is stored in a SQL Server database.</span></span> <span data-ttu-id="e2b01-111">否则会将数据发送到共享文件位置。</span><span class="sxs-lookup"><span data-stu-id="e2b01-111">Otherwise, the data is sent to a shared file location.</span></span>  

  <span data-ttu-id="e2b01-112">为了实现此方案，Northwind 决定设置一个混合应用程序，其中 EDI 消息处理在云中完成，业务逻辑驱动的数据处理则在本地完成。</span><span class="sxs-lookup"><span data-stu-id="e2b01-112">To achieve this scenario, Northwind decides to set up a hybrid application where the EDI message processing is done on the cloud while the business-logic-driven data processing is done within the premises.</span></span> <span data-ttu-id="e2b01-113">为了设置此混合应用程序，Northwind 使用了以下项：</span><span class="sxs-lookup"><span data-stu-id="e2b01-113">To set up this hybrid application Northwind uses the following:</span></span>  

- <span data-ttu-id="e2b01-114">**[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]**  – 适用于在 Azure BizTalk 门户[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]使客户能够在配置贸易合作伙伴和 EDI 协议[!INCLUDE[winazure](../includes/winazure-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="e2b01-114">**[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]**  – The Azure BizTalk Portal available with [!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)] enables customers to configure trading partners and EDI agreements on [!INCLUDE[winazure](../includes/winazure-md.md)].</span></span> <span data-ttu-id="e2b01-115">Northwind 使用[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]（2012 年 4 月版）来创建和部署该协议，该协议将处理传入的 EDI 消息，根据 X12 840 销售订单架构对其进行验证，将其转换为 Northwind 所需的架构，然后将其发送到 Service Bus 队列。</span><span class="sxs-lookup"><span data-stu-id="e2b01-115">Northwind uses the [!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)] – April 2012 release to create and deploy an agreement that processes the incoming EDI message, validates it against the X12 840 sales order schema, transforms the message to a schema required by Northwind, and then sends the message to a Service Bus Queue.</span></span> <span data-ttu-id="e2b01-116">因此，为了开发混合应用程序，应将数据从 Service Bus 队列发送到用户所在场所的应用程序。</span><span class="sxs-lookup"><span data-stu-id="e2b01-116">So, to develop a hybrid application, the data should be sent from the Service Bus Queue to an on-premises application.</span></span>  

- <span data-ttu-id="e2b01-117">**[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**  – 服务总线新适配器 (**Sb-messaging**) 适用于[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]使应用程序以接收来自服务总线实体，例如队列、 主题、 消息等到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="e2b01-117">**[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**  – The new adapter for Service Bus (**SB-Messaging**) available with [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] enables applications to receive messages from Service Bus entities like Queues, Topics, and so on into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="e2b01-118">作为的一部分[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]应用程序中，Northwind 使用一个业务流程来确定收到的销售订单中请求的数量是否大于 100。</span><span class="sxs-lookup"><span data-stu-id="e2b01-118">As part of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application, Northwind uses an orchestration to decide whether the quantity requested in the received sales order is more than 100.</span></span> <span data-ttu-id="e2b01-119">如果该数量大于 100，将消息插入到名为的 SQL Server 数据库表**SalesOrder**。</span><span class="sxs-lookup"><span data-stu-id="e2b01-119">If the quantity is more than 100, the message is inserted into a SQL Server database table called **SalesOrder**.</span></span> <span data-ttu-id="e2b01-120">如果该数量小于 100，则将消息发送到共享文件位置。</span><span class="sxs-lookup"><span data-stu-id="e2b01-120">If the quantity is less than 100, the message is sent to a shared file location.</span></span>  

   <span data-ttu-id="e2b01-121">为了将消息插入 SQL Server 数据库表，Northwind 使用作为 [!INCLUDE[adaptersql](../includes/adaptersql-md.md)] 的一部分提供的[!INCLUDE[adapterpacknoversion](../includes/adapterpacknoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="e2b01-121">To insert the message into a SQL Server database table, Northwind uses the [!INCLUDE[adaptersql](../includes/adaptersql-md.md)] available as part of the [!INCLUDE[adapterpacknoversion](../includes/adapterpacknoversion-md.md)].</span></span>  

### <a name="end-to-end-message-flow"></a><span data-ttu-id="e2b01-122">端到端消息流</span><span class="sxs-lookup"><span data-stu-id="e2b01-122">End-to-end Message Flow</span></span>  
 <span data-ttu-id="e2b01-123">以下说明了消息如何流经混合应用程序：</span><span class="sxs-lookup"><span data-stu-id="e2b01-123">This is how the message flows through the hybrid application:</span></span>  

1. <span data-ttu-id="e2b01-124">Contoso 将一个 X12 销售订单消息发送至终结点，该终结点已在云中部署了 EDI 协议。</span><span class="sxs-lookup"><span data-stu-id="e2b01-124">Contoso sends an X12 sales order message to the endpoint where the EDI agreement is deployed on the cloud.</span></span>  

2. <span data-ttu-id="e2b01-125">通过 EDI 协议成功处理该消息后，再将其发送到 Service Bus 队列。</span><span class="sxs-lookup"><span data-stu-id="e2b01-125">After the message is successfully processed through the EDI agreement, it is sent to the Service Bus Queue.</span></span>  

3. <span data-ttu-id="e2b01-126">SB 消息接收适配器处理来自 Service Bus 队列的消息，并实例化 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中部署的业务流程，以便根据订单数量将消息发送到不同目标。</span><span class="sxs-lookup"><span data-stu-id="e2b01-126">SB-Messaging receive adapter consumes the message from the Service Bus Queue and instantiates the orchestration deployed in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to send the message to different destinations based on the order quantity.</span></span>  

4. <span data-ttu-id="e2b01-127">如果订购数量大于 100，该业务流程将插入到消息**SalesOrder**表。</span><span class="sxs-lookup"><span data-stu-id="e2b01-127">If the quantity ordered is greater than 100, the orchestration inserts the message to a **SalesOrder** table.</span></span> <span data-ttu-id="e2b01-128">如果订购数量小于或等于 100，则将消息写入到共享文件位置。</span><span class="sxs-lookup"><span data-stu-id="e2b01-128">If the quantity ordered is less than or equal to 100, the message is written to a shared file location.</span></span>  

## <a name="set-up-your-computer"></a><span data-ttu-id="e2b01-129">设置计算机</span><span class="sxs-lookup"><span data-stu-id="e2b01-129">Set up Your Computer</span></span>  
 <span data-ttu-id="e2b01-130">本教程要求你执行四大活动。</span><span class="sxs-lookup"><span data-stu-id="e2b01-130">This tutorial requires you to perform four broad activities.</span></span> <span data-ttu-id="e2b01-131">下表列出了各种活动以及每个活动的软件要求：</span><span class="sxs-lookup"><span data-stu-id="e2b01-131">The following table lists the activities and the software requirements for each activity:</span></span>  


|                                                            <span data-ttu-id="e2b01-132">活动</span><span class="sxs-lookup"><span data-stu-id="e2b01-132">Activity</span></span>                                                             |                                                                                                                                              <span data-ttu-id="e2b01-133">必需软件</span><span class="sxs-lookup"><span data-stu-id="e2b01-133">Required software</span></span>                                                                                                                                               |
|---------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     <span data-ttu-id="e2b01-134">创建 EDI 协议所需的 EDI 项目</span><span class="sxs-lookup"><span data-stu-id="e2b01-134">Create the EDI artifacts required for the EDI agreement</span></span>                                     | <span data-ttu-id="e2b01-135">本教程是使用[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]（2012 年 4 月版）和 X12 840 销售订单架构创建的。</span><span class="sxs-lookup"><span data-stu-id="e2b01-135">This tutorial was created with the [!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)] – April 2012 release as well as the X12 840 sales order schema.</span></span> <span data-ttu-id="e2b01-136">可以从下载这些[ http://go.microsoft.com/fwlink/p/?LinkId=235057 ](http://go.microsoft.com/fwlink/p/?LinkId=235057)。</span><span class="sxs-lookup"><span data-stu-id="e2b01-136">These can be downloaded from [http://go.microsoft.com/fwlink/p/?LinkId=235057](http://go.microsoft.com/fwlink/p/?LinkId=235057).</span></span> |
|                                               <span data-ttu-id="e2b01-137">创建和部署 EDI 协议</span><span class="sxs-lookup"><span data-stu-id="e2b01-137">Create and deploy the EDI agreement</span></span>                                               |                                                                                 <span data-ttu-id="e2b01-138">由于 EDI 协议是部署到 Azure 上，因此，你仅需要一个 Web 浏览器（如 Internet Explorer）登录到 Azure BizTalk Portal 即可。</span><span class="sxs-lookup"><span data-stu-id="e2b01-138">Because the EDI agreement is deployed on Azure, you only need a Web browser (e.g. Internet Explorer) to log in to the Azure BizTalk Portal.</span></span>                                                                                  |
| <span data-ttu-id="e2b01-139">构建、部署和配置 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 应用程序</span><span class="sxs-lookup"><span data-stu-id="e2b01-139">Build, deploy, and configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application</span></span> |              <span data-ttu-id="e2b01-140">如果想要预配[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]计算机上 Azure VM，请遵循的说明[ http://msdn.microsoft.com/library/azure/jj248689.aspx ](http://msdn.microsoft.com/library/azure/jj248689.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e2b01-140">If you want to provision a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer on an Azure VM, follow the instructions at [http://msdn.microsoft.com/library/azure/jj248689.aspx](http://msdn.microsoft.com/library/azure/jj248689.aspx).</span></span>               |
|                                        <span data-ttu-id="e2b01-141">向 EDI 协议终结点发送测试消息</span><span class="sxs-lookup"><span data-stu-id="e2b01-141">Send a test message to the EDI agreement endpoint</span></span>                                        |   <span data-ttu-id="e2b01-142">你可以使用[!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)]附带的示例程序包中提供的 MessageSender 工具。</span><span class="sxs-lookup"><span data-stu-id="e2b01-142">You can use the MessageSender tool available in the samples package shipped with [!INCLUDE[appfabricintegration](../includes/appfabricintegration-md.md)].</span></span> <span data-ttu-id="e2b01-143">可以从示例包下载[ http://go.microsoft.com/fwlink/p/?LinkId=235057 ](http://go.microsoft.com/fwlink/p/?LinkId=235057)。</span><span class="sxs-lookup"><span data-stu-id="e2b01-143">You can download the samples package from [http://go.microsoft.com/fwlink/p/?LinkId=235057](http://go.microsoft.com/fwlink/p/?LinkId=235057).</span></span>   |

 <span data-ttu-id="e2b01-144">你可以选择在同一计算机上安装所有这些项目，也可以在不同计算机上进行安装。</span><span class="sxs-lookup"><span data-stu-id="e2b01-144">You can opt to install all these on the same computer or on different computers.</span></span>  

## <a name="in-this-section"></a><span data-ttu-id="e2b01-145">本节内容</span><span class="sxs-lookup"><span data-stu-id="e2b01-145">In This Section</span></span>  

-   [<span data-ttu-id="e2b01-146">步骤 1（适用于 Azure）：创建 EDI 项目</span><span class="sxs-lookup"><span data-stu-id="e2b01-146">Step 1 (For Azure): Create the EDI Project</span></span>](../core/step-1-for-azure-create-the-edi-project.md)  

-   [<span data-ttu-id="e2b01-147">步骤 2（适用于 Azure）：创建 EDI 协议</span><span class="sxs-lookup"><span data-stu-id="e2b01-147">Step 2 (For Azure): Create an EDI Agreement</span></span>](../core/step-2-for-azure-create-an-edi-agreement.md)  

-   [<span data-ttu-id="e2b01-148">步骤 3（适用于 Azure）：创建服务总线队列</span><span class="sxs-lookup"><span data-stu-id="e2b01-148">Step 3 (For Azure): Create a Service Bus Queue</span></span>](../core/step-3-for-azure-create-a-service-bus-queue.md)  

-   [<span data-ttu-id="e2b01-149">步骤 4（本地）：创建 SQL Server 表</span><span class="sxs-lookup"><span data-stu-id="e2b01-149">Step 4 (On Premises): Create the SQL Server Table</span></span>](../core/step-4-on-premises-create-the-sql-server-table.md)  

-   [<span data-ttu-id="e2b01-150">步骤 5（本地）：生成用于向 SalesOrder 表中插入消息的架构</span><span class="sxs-lookup"><span data-stu-id="e2b01-150">Step 5 (On Premises): Generate the Schema for Inserting a Message inito SalesOrder Table</span></span>](../core/step-5-generate-the-schema-for-inserting-a-message-into-salesorder-table.md)  

-   [<span data-ttu-id="e2b01-151">步骤 6（本地）：创建一个转换，以便将消息从队列映射到插入架构</span><span class="sxs-lookup"><span data-stu-id="e2b01-151">Step 6 (On Premises): Create a Transform to Map the Message from the Queue to the Insert Schema</span></span>](../core/step-6-map-the-message-from-the-queue-to-the-insert-schema.md)  

-   [<span data-ttu-id="e2b01-152">步骤 7（本地）：创建业务流程</span><span class="sxs-lookup"><span data-stu-id="e2b01-152">Step 7 (On Premises): Create an Orchestration</span></span>](../core/step-7-on-premises-create-an-orchestration.md)  

-   [<span data-ttu-id="e2b01-153">步骤 8（本地）：配置 BizTalk Server 应用程序</span><span class="sxs-lookup"><span data-stu-id="e2b01-153">Step 8 (On Premises): Configure the BizTalk Server Application</span></span>](../core/step-8-on-premises-configure-the-biztalk-server-application.md)  

-   [<span data-ttu-id="e2b01-154">步骤 9：测试解决方案</span><span class="sxs-lookup"><span data-stu-id="e2b01-154">Step 9: Test the Solution</span></span>](../core/step-9-test-the-solution.md)