---
title: 业务流程 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- orchestrations
- correlations, orchestrations
- orchestrations, correlations
- orchestrations, deploying
- deploying, orchestrations
- orchestrations, about orchestrations
ms.assetid: fb01f78a-b805-46be-a7d9-2b7597daab96
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a045aa332f567a757327015fb114b795be7e06bd
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65262709"
---
# <a name="orchestrations"></a>业务流程
*业务流程*都可以订阅 （接收） 的可执行业务流程和发布 （发送） 消息通过 MessageBox 数据库。 此外，业务流程可以构造新消息。 使用的订阅接收消息和路由基础结构中所述[消息的生命周期](../core/lifecycle-of-a-message.md)。 订阅的业务流程在填充后激活新的实例传递消息，或对于实例订阅，该实例解除冻结，如有必要，然后传递消息。 当从业务流程发送消息时，发布到 MessageBox 中消息到达接收位置获取插入到在路由中使用的数据库的相应属性与相同的方式。  
  
 在业务流程中构造的消息必须放置在 MessageBox 数据库中并引用的业务流程实例，但它们应发布，因为它们具有尚未发送。 XLANG/s 子服务调用消息代理 API 直接插入消息。 这样，业务流程引擎将消息正文插入 MessageBox，并将其直接与正在运行的业务流程实例相关联。 MessageBox 数据库中构造的持久性是消息的与业务流程作为数据库操作的其他优化中的持久化点协调一致。  
  
 业务流程，使发布和订阅的概念看起来作用不同是绑定。 业务流程端口是描述的交互的逻辑端口。 必须将这些逻辑端口绑定到物理端口，以便消息传送，但此绑定进程只不过是配置消息路由的订阅。  
  
 有四个基本选项用于绑定这些端口：  
  
-   立即指定 （在业务流程中直接指定端口）  
  
-   指定更高版本 （在部署时指定端口）  
  
-   使用其中的地址在业务流程代码中设置动态发送端口  
  
-   从业务流程创建直接绑定到 MessageBox 数据库或其他业务流程  
  
## <a name="deploying-orchestrations"></a>部署业务流程  
 当在设计时指定绑定时，部署业务流程时，创建与业务流程中配置的参数相匹配的物理端口。 当在部署时配置绑定时，符合要求的逻辑端口的任何端口可以绑定到业务流程端口中。 对于动态绑定，如使用立即指定选项，只需创建物理端口，但是该端口是没有配置地址信息的动态发送端口。  
  
 令人困惑的概念是： 尽管业务流程中的发送端口绑定到物理发送端口，但这不会阻止消息送达到其他订户。 也就是说，如果另一个发送端口恰好有一个订阅，通过其筛选器，发送到绑定端口，这两个发送端口接收消息的消息。 绑定仅创建订阅，以便从业务流程始终发送的消息与绑定的发送端口的条件相匹配。 同样，业务流程端口绑定到接收端口创建相应的订阅根据消息类型和接收端口 id。 订阅确保传入和传出业务流程的消息传送给绑定的端口，但消息仍通过相同的发布和订阅机制前面所述。  
  
 可能最常被误解、 误用和未充分使用的绑定选项是直接绑定选项。 直接绑定允许业务流程将消息发布到 MessageBox 数据库使用不同的路由属性很多像发布消息由接收位置。 在简单的直接消息传送，消息发布到 MessageBox 使用升级属性，如接收到 BizTalk Server 的任何其他已发布的消息路由。 这使任何订户都可以接收此消息，但要求至少一个订阅服务器上存在，或业务流程将收到路由故障错误。  
  
 对于直接绑定的另一个选项是使用自相关端口。 自相关端口是端口，创建唯一相关标记和独立关联实例之间的消息中使用该标记。 自相关端口的最常见用途是调用或启动传入端口参数的业务流程。 在调用的业务流程，该端口可以用于发送消息，而在调用业务流程可以使用相同的端口接收的消息。 由于端口具有唯一的相关标记，该消息将路由回调用业务流程。 自相关端口充当业务流程实例之间的专用通信信道。  
  
 最后一个选项是使用合作伙伴业务流程中，在调用业务流程和调用的业务流程中的端口配置使用的相同共享端口类型和在端口配置中，选择相同的端口。 例如，在 Orch1 和 Orch2 中都选定 Orch2.MyDirectPort。 此类型的绑定设置了一种订阅，接收业务流程基于发送业务流程类型、 端口名称和操作名称。 这样再次确保消息获取路由到正确的实例。  
  
 所有直接消息传送选项使用基本的发布和订阅模型。 这些选项之间的区别是用于创建订阅和路由，在属性中，在使用情况下它们有助于解决。  
  
 使用在业务流程直接绑定的端口时遇到的一个常见问题是业务流程可能发布被订阅到一条消息。 例如，业务流程配置为由 PurchaseOrder 消息激活。 此业务流程使用直接端口将 PurchaseOrder 消息发布到 MessageBox。 但是，除了按预期方式接收消息，因为它也具有 PurchaseOrder 消息的订阅启动的业务流程的另一个实例。 该处理进入无穷循环，并可能需要一些时间让开发人员可以找出发生了什么。  
  
## <a name="correlation"></a>Correlation  
 *相关*业务流程中是用于相关的消息接收到同一个正在运行的业务流程实例的机制。 在业务流程设计器中，开发人员按照以下常规步骤，使用相关：  
  
- 定义包含用于消息相关的升级的属性的相关类型。  
  
- 定义一个相关集，后者定义只是相关类型的实例。  
  
- 用于发送和接收端口，指定是否初始化或沿用给定的相关集。  
  
  实例订阅时需考虑启动相关集，因为这是为所有沿用此相关集接收消息的这些端口创建订阅时。 相关类型定义了要用于相关的属性，因为业务流程引擎可以从正在发送或接收初始化操作的消息中提取这些属性。 然后使用这些值来定义订阅的所有剩余操作的沿用此相关集。  
  
  接收到 BizTalk Server 和用于相关的消息具有正确定义和升级到消息上下文及其已提升的属性至关重要。 大多数属性获取升级时最初收到消息时，在管道的拆装器组件提取值。 出于此原因，不能使用直通接收管道来接收必须与正在运行的业务流程实例相关的消息。 当您使用 SOAP 接收适配器接收相关的消息，因为直通管道是接收管道的默认值时使用 Web Services 发布向导时，会出现此问题。  
  
## <a name="see-also"></a>请参阅  
 [项目](../core/artifacts.md)   
 [使用业务流程设计器创建业务流程](../core/creating-orchestrations-using-orchestration-designer.md)