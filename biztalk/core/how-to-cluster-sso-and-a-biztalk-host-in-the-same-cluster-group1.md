---
title: 如何安装群集 SSO 和 BizTalk 主机在同一群集组 1 中 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 413cc8f4-f343-4c1c-8b79-3b15cb4c101d
caps.latest.revision: 44
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 554f6a6515b9b586387c85e040b051e528a9db8b
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36966966"
---
# <a name="how-to-cluster-sso-and-a-biztalk-host-in-the-same-cluster-group"></a><span data-ttu-id="52060-102">如何将 SSO 和 BizTalk 主机群集到同一群集组中</span><span class="sxs-lookup"><span data-stu-id="52060-102">How to Cluster SSO and a BizTalk Host in the Same Cluster Group</span></span>
<span data-ttu-id="52060-103">利用 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，您可以将一台或多台 BizTalk 主机和企业单一登录 (SSO) 服务群集到同一个 Windows Server 群集中。</span><span class="sxs-lookup"><span data-stu-id="52060-103">With [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] you can cluster one or more BizTalk hosts and the Enterprise Single Sign-On (SSO) service on the same Windows Server cluster.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="52060-104">正确实施这一策略需要在同一群集组中将任何 BizTalk 主机实例和 SSO 服务创建为群集资源。</span><span class="sxs-lookup"><span data-stu-id="52060-104">Correct implementation of this strategy requires that you create any BizTalk host instances and the SSO service as cluster resources in the same cluster group.</span></span>  
  
 <span data-ttu-id="52060-105">将 Windows 群集与一个或多个 BizTalk 主机和 SSO 配合使用通常属于以下类别之一：</span><span class="sxs-lookup"><span data-stu-id="52060-105">The use of Windows Clustering with one or more BizTalk hosts and SSO typically falls into one of these categories:</span></span>  
  
1. <span data-ttu-id="52060-106">将 SSO 主密钥服务器和一个或多个 BizTalk 主机群集到同一个群集组中。</span><span class="sxs-lookup"><span data-stu-id="52060-106">Clustering the SSO master secret server and one or more BizTalk hosts in the same cluster group.</span></span>  
  
    <span data-ttu-id="52060-107">在此方案中，群集的 BizTalk 主机和群集的 SSO 服务之间的依赖关系被维护，因此，如果群集组故障转移，所有资源都移动组。</span><span class="sxs-lookup"><span data-stu-id="52060-107">In this scenario, the dependency between the clustered BizTalk hosts and the clustered SSO service is maintained so that if the cluster group is failed over, all resources move with the group.</span></span>  
  
    <span data-ttu-id="52060-108">如果在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上将 SSO 服务配置为群集资源，则必须在同一群集组中创建群集 IIS Web Services。</span><span class="sxs-lookup"><span data-stu-id="52060-108">If the SSO service is configured as a clustered resource on a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, you must create a clustered IIS web service in the same cluster group.</span></span> <span data-ttu-id="52060-109">必须完成此操作才能确保在 SSO 服务运行的群集节点上运行所有独立的主机实例。</span><span class="sxs-lookup"><span data-stu-id="52060-109">This must be done to ensure that all isolated host instances will run on the cluster node that the SSO service is running on.</span></span> <span data-ttu-id="52060-110">这可确保在独立主机实例中运行的任何适配器都将具有对企业 SSO 服务的访问权限，因为独立主机实例在 IIS 中运行。</span><span class="sxs-lookup"><span data-stu-id="52060-110">This ensures that any adapters that run in an isolated host instance will have access to the SSO service since isolated host instances run in IIS.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="52060-111">如果 BizTalk 主机的非群集实例与 SSO 服务的群集实例在同一群集节点上运行，则 SSO 服务的群集实例无法进行故障转移，除非停止 BizTalk 主机的非群集实例。</span><span class="sxs-lookup"><span data-stu-id="52060-111">If an unclustered instance of a BizTalk host is running on the same cluster node that a clustered instance of the SSO service is running, the clustered instance of the SSO service cannot be failed over unless the unclustered instance of the BizTalk host is stopped.</span></span> <span data-ttu-id="52060-112">非群集的 BizTalk 主机的实例维护依赖于群集节点上运行的 SSO 服务的群集实例，并阻止故障转移群集的 SSO 服务的实例。</span><span class="sxs-lookup"><span data-stu-id="52060-112">An unclustered instance of the BizTalk host maintains a dependency upon the clustered instance of the SSO service running on the cluster node and prevents the clustered instance of the SSO service from failing over.</span></span> <span data-ttu-id="52060-113">因此，建议您不要在运行 SSO 服务的群集实例的群集节点上创建 BizTalk 主机的非群集实例。</span><span class="sxs-lookup"><span data-stu-id="52060-113">For this reason, it is recommended that you do not create an unclustered instance of a BizTalk host to run on the same cluster node that is running a clustered instance of the SSO service.</span></span>  
  
2. <span data-ttu-id="52060-114">将 SSO 服务（非主密钥服务器）和一个或多个 BizTalk 主机群集到同一个群集组中。</span><span class="sxs-lookup"><span data-stu-id="52060-114">Clustering the SSO service (non master secret server) and one or more BizTalk hosts in the same cluster group.</span></span> <span data-ttu-id="52060-115">此方案要求远程主密钥服务器可用。</span><span class="sxs-lookup"><span data-stu-id="52060-115">This scenario requires that a remote master secret server be available.</span></span> <span data-ttu-id="52060-116">在此方案中，群集 BizTalk 主机和群集 SSO 服务之间的依存关系得到了维持，因此如果群集组发生故障转移，所有资源将随组一起移动。</span><span class="sxs-lookup"><span data-stu-id="52060-116">In this scenario, the dependency between the clustered BizTalk hosts and the clustered SSO service is maintained so if the cluster group is failed over, all resources move with the group.</span></span>  
  
    <span data-ttu-id="52060-117">如果在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上将 SSO 服务配置为群集资源，则必须在同一群集组中创建群集 IIS Web Services。</span><span class="sxs-lookup"><span data-stu-id="52060-117">If the SSO service is configured as a clustered resource on a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, you must create a clustered IIS web service in the same cluster group.</span></span> <span data-ttu-id="52060-118">必须完成此操作才能确保在 SSO 服务运行的群集节点上运行所有独立的主机实例。</span><span class="sxs-lookup"><span data-stu-id="52060-118">This must be done to ensure that all isolated host instances will run on the cluster node that the SSO service is running on.</span></span> <span data-ttu-id="52060-119">这可确保在独立主机实例中运行的任何适配器都将具有对企业 SSO 服务的访问权限，因为独立主机实例在 IIS 中运行。</span><span class="sxs-lookup"><span data-stu-id="52060-119">This ensures that any adapters that run in an isolated host instance will have access to the SSO service since isolated host instances run in IIS.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="52060-120">如果 BizTalk 主机的非群集实例与 SSO 服务的群集实例在同一群集节点上运行，则 SSO 服务的群集实例可能无法进行故障转移，除非停止 BizTalk 主机的非群集实例。</span><span class="sxs-lookup"><span data-stu-id="52060-120">If an unclustered instance of a BizTalk host is running on the same cluster node that a clustered instance of the SSO service is running then the clustered instance of the SSO service cannot be failed over unless the unclustered instance of the BizTalk host is stopped.</span></span> <span data-ttu-id="52060-121">BizTalk 主机的非群集实例保持对运行在群集节点上的 SSO 服务的群集实例的依存关系，并阻止 SSO 服务的群集实例进行故障转移。</span><span class="sxs-lookup"><span data-stu-id="52060-121">An un-clustered instance of the BizTalk host maintains a dependency upon the clustered instance of the SSO service running on the cluster node and prevents the clustered instance of the SSO service from failing over.</span></span> <span data-ttu-id="52060-122">出于此原因，建议您创建的非群集的 BizTalk 主机，若要运行 SSO 服务的群集的实例在同一群集节点上运行的实例。</span><span class="sxs-lookup"><span data-stu-id="52060-122">For this reason, it is recommended that you not create a unclustered instance of a BizTalk host to run on the same cluster node that is running a clustered instance of the SSO service.</span></span>  
  
3. <span data-ttu-id="52060-123">在 Windows Server 群集上群集一个或多个 BizTalk 主机，而不群集 SSO 服务。</span><span class="sxs-lookup"><span data-stu-id="52060-123">Clustering one or more BizTalk hosts on a Windows Server cluster without clustering the SSO service.</span></span> <span data-ttu-id="52060-124">在此方案中，将一个或多个 BizTalk 主机配置为群集资源，但不将 SSO 服务配置为群集资源。</span><span class="sxs-lookup"><span data-stu-id="52060-124">In this scenario, one or more BizTalk hosts are configured as cluster resources but the SSO service is not configured as a clustered resource.</span></span> <span data-ttu-id="52060-125">这一设计可为群集 BizTalk 主机提供高可用性，但不能为 SSO 服务提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="52060-125">This design provides high availability for the clustered BizTalk hosts but does not provide high availability for the SSO service.</span></span> <span data-ttu-id="52060-126">在此方案中，如果某一节点上的 SSO 服务失败，则依赖于该节点上 SSO 的 BizTalk Server 组件也将失败。</span><span class="sxs-lookup"><span data-stu-id="52060-126">In this scenario, if the SSO service on a node fails then BizTalk Server components that depend on SSO on that node will also fail.</span></span> <span data-ttu-id="52060-127">有关如何将 BizTalk Server 主机配置为群集资源的详细信息请参阅[如何将 BizTalk 主机配置为群集资源](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3)。</span><span class="sxs-lookup"><span data-stu-id="52060-127">For more information about how to configure a BizTalk Server host as a cluster resource see [How to Configure a BizTalk Host as a Cluster Resource](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3).</span></span>  
  
   <span data-ttu-id="52060-128">下面的过程介绍了将 BizTalk 主机和 SSO 服务群集到同一个 Windows Server 群集中应执行的步骤。</span><span class="sxs-lookup"><span data-stu-id="52060-128">The following procedures describe the steps that you should follow to cluster a BizTalk host and the SSO service on the same Windows Server cluster.</span></span>  
  
### <a name="to-cluster-a-biztalk-host-and-the-sso-master-secret-server-on-the-same-windows-server-cluster"></a><span data-ttu-id="52060-129">将 BizTalk 主机和 SSO 主密钥服务器群集到同一个 Windows Server 群集</span><span class="sxs-lookup"><span data-stu-id="52060-129">To cluster a BizTalk host and the SSO master secret server on the same Windows Server cluster</span></span>  
  
1. <span data-ttu-id="52060-130">如果不使用群集分布式事务处理协调器 (MSDTC) 资源配置群集，对 MSDTC 进行群集上的 Windows Server 故障转移群集中的步骤[核对清单： 在 Windows Server 2008 中创建 MS DTC 资源故障转移群集](http://go.microsoft.com/fwlink/p/?LinkID=129677)(http://go.microsoft.com/fwlink/p/?LinkID=129677)。</span><span class="sxs-lookup"><span data-stu-id="52060-130">If the cluster is not configured with a clustered Distributed Transaction Coordinator (MSDTC) resource, cluster MSDTC on a Windows Server failover cluster by following the steps in [Checklist: Creating an MS DTC Resource in a Windows Server 2008 Failover Cluster](http://go.microsoft.com/fwlink/p/?LinkID=129677) (http://go.microsoft.com/fwlink/p/?LinkID=129677).</span></span>  
  
2. <span data-ttu-id="52060-131">安装和配置 Windows Server 群集上的 SSO 服务，按照中的步骤[如何群集主密钥服务器](http://msdn.microsoft.com/library/59895616-4178-46d0-b9ff-95589b809ff5)。</span><span class="sxs-lookup"><span data-stu-id="52060-131">Install and configure the SSO service on the Windows Server cluster by following the steps in [How to Cluster the Master Secret Server](http://msdn.microsoft.com/library/59895616-4178-46d0-b9ff-95589b809ff5).</span></span> <span data-ttu-id="52060-132">由于要在 Windows Server 群集上运行 BizTalk Server，因此即使这次只配置 SSO 组件，也需要安装所有必需的 BizTalk Server 组件。</span><span class="sxs-lookup"><span data-stu-id="52060-132">Since you will be running BizTalk Server on the Windows Server cluster, install all required BizTalk Server components even though you will only be configuring the SSO components at this time.</span></span>  
  
3. <span data-ttu-id="52060-133">上群集 IIS[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]计算机中所述的步骤[Microsoft 知识库文章 970759"配置 IIS 7.0 中 Microsoft Windows Server 2008 故障转移群集"](http://go.microsoft.com/fwlink/p/?LinkId=152793) (<http://go.microsoft.com/fwlink/p/?LinkId=152793>)。</span><span class="sxs-lookup"><span data-stu-id="52060-133">Cluster IIS on the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer by following the steps documented in [Microsoft Knowledge Base article 970759 "Configuring IIS 7.0 in a Microsoft Windows Server 2008 failover cluster"](http://go.microsoft.com/fwlink/p/?LinkId=152793) (<http://go.microsoft.com/fwlink/p/?LinkId=152793>).</span></span> <span data-ttu-id="52060-134">在与群集 SSO 服务所在相同的群集组中创建群集 IIS Web Services。</span><span class="sxs-lookup"><span data-stu-id="52060-134">Create the clustered IIS Web service in the same cluster group as the clustered SSO service.</span></span>  
  
4. <span data-ttu-id="52060-135">将包含群集的 SSO 服务到一个群集节点的群集组移并登录到此群集节点上。</span><span class="sxs-lookup"><span data-stu-id="52060-135">Move the cluster group that contains the clustered SSO service to one of the cluster nodes, and log on to this cluster node.</span></span>  
  
5. <span data-ttu-id="52060-136">启动 BizTalk Server 配置程序，并在此群集节点上完成 BizTalk Server 的配置。</span><span class="sxs-lookup"><span data-stu-id="52060-136">Start the BizTalk Server Configuration program, and complete the configuration of BizTalk Server on this cluster node.</span></span> <span data-ttu-id="52060-137">由于这是组中的第一个 BizTalk Server 计算机，单击**创建新的 BizTalk 组**配置 BizTalk 组时。</span><span class="sxs-lookup"><span data-stu-id="52060-137">Since this is the first BizTalk Server computer in the group, click **Create a new BizTalk Group** when configuring the BizTalk Group.</span></span>  
  
6. <span data-ttu-id="52060-138">在成功完成 BizTalk Server 的配置后，将包含群集 SSO 服务的群集组移到另一个群集节点，并登录到此群集节点。</span><span class="sxs-lookup"><span data-stu-id="52060-138">Once the BizTalk Server configuration has completed successfully, move the cluster group that contains the clustered SSO service to the other cluster node, and log on to this cluster node.</span></span>  
  
7. <span data-ttu-id="52060-139">启动 BizTalk Server 配置程序，并在此群集节点上完成 BizTalk Server 的配置。</span><span class="sxs-lookup"><span data-stu-id="52060-139">Start the BizTalk Server Configuration program, and complete the configuration of BizTalk Server on this cluster node.</span></span> <span data-ttu-id="52060-140">单击**加入现有 BizTalk 组**此群集节点上，配置 BizTalk 组组件时，指定第一个节点创建的 BizTalk 组。</span><span class="sxs-lookup"><span data-stu-id="52060-140">Click **Join an existing BizTalk Group** when configuring the BizTalk Group component on this cluster node, and specify the BizTalk group that you created on the first node.</span></span>  
  
8. <span data-ttu-id="52060-141">已成功完成 BizTalk Server 配置后，创建一个或多个群集 BizTalk 主机中的步骤[如何将 BizTalk 主机配置为群集资源](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3)。</span><span class="sxs-lookup"><span data-stu-id="52060-141">Once the BizTalk Server configuration has completed successfully, create one or more clustered BizTalk hosts by following the steps in [How to Configure a BizTalk Host as a Cluster Resource](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3).</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="52060-142">在此方案中，所有 BizTalk 主机都必须都创建为群集 SSO 服务资源所在的群集组中的群集资源。</span><span class="sxs-lookup"><span data-stu-id="52060-142">In this scenario, all BizTalk hosts must be created as cluster resources in the same cluster group as the clustered SSO service resource.</span></span> <span data-ttu-id="52060-143">其中群集 SSO 服务的 Windows Server 群集节点上运行的非群集的 BizTalk 主机实例不是受支持的配置。</span><span class="sxs-lookup"><span data-stu-id="52060-143">Running a unclustered BizTalk host instance on a Windows Server Cluster node where the SSO service is clustered is not a supported configuration.</span></span> <span data-ttu-id="52060-144">这是因为当群集 SSO 服务由于与 SSO 服务上的 BizTalk 主机实例存在依赖关系而将故障转移至另一节点时，非群集 BizTalk 主机实例将失败。</span><span class="sxs-lookup"><span data-stu-id="52060-144">This is because the unclustered BizTalk host instance will fail when the clustered SSO service is failed over to another node due to the dependency of a BizTalk host instance on the SSO service.</span></span>  
  
### <a name="to-cluster-a-biztalk-host-and-sso-non-master-secret-server-on-the-same-windows-server-cluster-when-the-sso-master-secret-server-is-remote"></a><span data-ttu-id="52060-145">当 SSO 主密钥服务器为远程主密钥服务器时，将 BizTalk 主机和 SSO（非主密钥服务器）群集到同一个 Windows Server 群集</span><span class="sxs-lookup"><span data-stu-id="52060-145">To cluster a BizTalk host and SSO (non master secret server) on the same Windows Server cluster when the SSO master secret server is remote</span></span>  
  
1. <span data-ttu-id="52060-146">如果不使用群集分布式事务处理协调器 (MSDTC) 资源配置群集，对 MSDTC 进行群集上的 Windows Server 故障转移群集中的步骤[核对清单： 在 Windows Server 2008 中创建 MS DTC 资源故障转移群集](http://go.microsoft.com/fwlink/p/?LinkID=129677)(http://go.microsoft.com/fwlink/p/?LinkID=129677)。</span><span class="sxs-lookup"><span data-stu-id="52060-146">If the cluster is not configured with a clustered Distributed Transaction Coordinator (MSDTC) resource, cluster MSDTC on a Windows Server failover cluster by following the steps in [Checklist: Creating an MS DTC Resource in a Windows Server 2008 Failover Cluster](http://go.microsoft.com/fwlink/p/?LinkID=129677) (http://go.microsoft.com/fwlink/p/?LinkID=129677).</span></span>  
  
2. <span data-ttu-id="52060-147">创建域组的名称**SSO Administrators**并**SSO Affiliate Administrators**。</span><span class="sxs-lookup"><span data-stu-id="52060-147">Create domain groups with the names **SSO Administrators** and **SSO Affiliate Administrators**.</span></span> <span data-ttu-id="52060-148">若要创建群集的 SSO 服务的实例，必须创建**SSO Administrators**并**SSO Affiliate Administrators**为域组的组。</span><span class="sxs-lookup"><span data-stu-id="52060-148">To create a clustered instance of the SSO service, you must create the **SSO Administrators** and **SSO Affiliate Administrators** groups as domain groups.</span></span>  
  
3. <span data-ttu-id="52060-149">创建或指定的成员的域帐户**SSO Administrators**域组。</span><span class="sxs-lookup"><span data-stu-id="52060-149">Create or designate a domain account that is a member of the **SSO Administrators** domain group.</span></span> <span data-ttu-id="52060-150">每个节点上的 SSO 服务都将配置为使用此域帐户登录。</span><span class="sxs-lookup"><span data-stu-id="52060-150">The SSO service on each node will be configured to log on as this domain account.</span></span> <span data-ttu-id="52060-151">此帐户必须具有**作为服务登录**直接在群集中每个节点上。</span><span class="sxs-lookup"><span data-stu-id="52060-151">This account must have the **Log on as a service** right on each node in the cluster.</span></span>  
  
4. <span data-ttu-id="52060-152">添加的帐户，您用来登录到域安装和配置流程期间**SSO Administrators**组。</span><span class="sxs-lookup"><span data-stu-id="52060-152">Add the account that you are using to log on during the installation and configuration process to the domain **SSO Administrators** group.</span></span>  
  
   > [!IMPORTANT]
   >  <span data-ttu-id="52060-153">如果没有完成步骤 3 和步骤 4，则配置 SSO 服务将失败。</span><span class="sxs-lookup"><span data-stu-id="52060-153">Configuration of the SSO service will fail if steps 3 and 4 are not completed.</span></span>  
  
5. <span data-ttu-id="52060-154">登录到其中一个群集节点并安装 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="52060-154">Log on to one of the cluster nodes and install [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="52060-155">在安装成功完成时，选择启动配置程序的选项。</span><span class="sxs-lookup"><span data-stu-id="52060-155">Select the option to start the configuration program when installation has completed successfully.</span></span>  
  
6. <span data-ttu-id="52060-156">选择**自定义配置**选项并输入相应的值**数据库服务器名称**，**用户名**和**密码**字段。</span><span class="sxs-lookup"><span data-stu-id="52060-156">Choose the **Custom Configuration** option and enter the appropriate values for the **Database server name**, **User name** and **Password** fields.</span></span> <span data-ttu-id="52060-157">输入这些值后，单击**配置**按钮以继续。</span><span class="sxs-lookup"><span data-stu-id="52060-157">After entering these values click the **Configure** button to continue.</span></span>  
  
7. <span data-ttu-id="52060-158">为 SSO 功能设置以下选项：</span><span class="sxs-lookup"><span data-stu-id="52060-158">Set the following options for the SSO feature:</span></span>  
  
   1.  <span data-ttu-id="52060-159">选中的复选框旁边**启用企业单一登录此计算机上**。</span><span class="sxs-lookup"><span data-stu-id="52060-159">Select the check the box next to **Enable Enterprise Single Sign-On on this computer**.</span></span>  
  
   2.  <span data-ttu-id="52060-160">单击选项**加入现有 SSO 系统**。</span><span class="sxs-lookup"><span data-stu-id="52060-160">Click the option to **Join an existing SSO system**.</span></span>  
  
   3.  <span data-ttu-id="52060-161">输入现有 SSO 数据库服务器名称和数据库名称的值。</span><span class="sxs-lookup"><span data-stu-id="52060-161">Enter values for the existing SSO Database Server Name and Database Name.</span></span>  
  
   4.  <span data-ttu-id="52060-162">指定要使用企业单一登录服务的帐户时，请输入现有 SSO 服务帐户。</span><span class="sxs-lookup"><span data-stu-id="52060-162">Enter the existing SSO service account when specifying the account to use for the Enterprise Single Sign-On service.</span></span>  
  
8. <span data-ttu-id="52060-163">由于这是第一个 BizTalk Server 组中选择的选项**创建新的 BizTalk 组**配置 BizTalk 组组件时。</span><span class="sxs-lookup"><span data-stu-id="52060-163">Since this is the first BizTalk Server in the group choose the option to **Create a new BizTalk Group** when configuring the BizTalk Group component.</span></span>  
  
9. <span data-ttu-id="52060-164">根据需要指定其他配置选项，然后将 BizTalk Server 配置应用到此节点。</span><span class="sxs-lookup"><span data-stu-id="52060-164">Specify the remaining configuration options as needed and apply the BizTalk Server configuration to this node.</span></span>  
  
10. <span data-ttu-id="52060-165">在第一个节点上成功完成 BizTalk Server 配置后，登录到第二个节点并安装 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="52060-165">Once the BizTalk Server configuration has completed successfully on the first node, log on to the second node and install [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="52060-166">在安装成功完成时，选择启动配置程序的选项。</span><span class="sxs-lookup"><span data-stu-id="52060-166">Select the option to start the configuration program when installation has completed successfully.</span></span>  
  
11. <span data-ttu-id="52060-167">选择**自定义配置**选项，然后再输入相应的值**数据库服务器名称**，**用户名**和**密码**字段。</span><span class="sxs-lookup"><span data-stu-id="52060-167">Choose the **Custom Configuration** option, and then enter the appropriate values for the **Database server name**, **User name** and **Password** fields.</span></span> <span data-ttu-id="52060-168">输入这些值后，单击**配置**按钮以继续。</span><span class="sxs-lookup"><span data-stu-id="52060-168">After entering these values, click the **Configure** button to continue.</span></span>  
  
12. <span data-ttu-id="52060-169">为 SSO 功能设置以下选项：</span><span class="sxs-lookup"><span data-stu-id="52060-169">Set the following options for the SSO feature:</span></span>  
  
    1.  <span data-ttu-id="52060-170">选中的复选框旁边**启用企业单一登录此计算机上**。</span><span class="sxs-lookup"><span data-stu-id="52060-170">Select the check the box next to **Enable Enterprise Single Sign-On on this computer**.</span></span>  
  
    2.  <span data-ttu-id="52060-171">单击**加入现有 SSO 系统**。</span><span class="sxs-lookup"><span data-stu-id="52060-171">Click **Join an existing SSO system**.</span></span>  
  
    3.  <span data-ttu-id="52060-172">输入现有 SSO 数据库服务器名称和数据库名称的值。</span><span class="sxs-lookup"><span data-stu-id="52060-172">Enter values for the existing SSO Database Server Name and Database Name.</span></span>  
  
    4.  <span data-ttu-id="52060-173">指定要使用企业单一登录服务的帐户时，请输入现有 SSO 服务帐户。</span><span class="sxs-lookup"><span data-stu-id="52060-173">Enter the existing SSO service account when specifying the account to use for the Enterprise Single Sign-On service.</span></span>  
  
13. <span data-ttu-id="52060-174">选择选项**加入现有 BizTalk 组**此群集节点上，配置 BizTalk 组组件时，指定第一个节点创建的 BizTalk 组。</span><span class="sxs-lookup"><span data-stu-id="52060-174">Choose the option to **Join an existing BizTalk Group** when configuring the BizTalk Group component on this cluster node, and specify the BizTalk group that you created on the first node.</span></span>  
  
14. <span data-ttu-id="52060-175">根据需要指定其他配置选项，然后将 BizTalk Server 配置应用到此节点。</span><span class="sxs-lookup"><span data-stu-id="52060-175">Specify the remaining configuration options as needed and apply the BizTalk Server configuration to this node.</span></span>  
  
15. <span data-ttu-id="52060-176">在成功完成 BizTalk Server 配置后，按照以下步骤群集 SSO 服务：</span><span class="sxs-lookup"><span data-stu-id="52060-176">After the BizTalk Server configuration has completed successfully, follow these steps to cluster the SSO service:</span></span>  
  
    1.  <span data-ttu-id="52060-177">从命令行键入以下命令，停止每个群集节点上的 SSO 服务：</span><span class="sxs-lookup"><span data-stu-id="52060-177">Stop the SSO service on each of the cluster nodes by typing the following command from a command:</span></span>  
  
        ```  
        net stop entsso  
        ```  
  
    2.  <span data-ttu-id="52060-178">在“故障转移群集管理”中，将所有群集组移到一个节点，并登录到此节点。</span><span class="sxs-lookup"><span data-stu-id="52060-178">In Failover Cluster Management, move all cluster groups to one node and log on to this node.</span></span>  
  
    3.  <span data-ttu-id="52060-179">在左窗格中单击选择一个包含 IP 地址和网络名称资源的群集服务或应用程序。</span><span class="sxs-lookup"><span data-stu-id="52060-179">In the left hand pane click to select a clustered service or application that contains an IP Address and Network Name resource.</span></span> <span data-ttu-id="52060-180">该群集服务或应用程序将包含群集 SSO 服务和群集 BizTalk 主机。</span><span class="sxs-lookup"><span data-stu-id="52060-180">This clustered service or application will contain the clustered SSO service and the clustered BizTalk host.</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="52060-181">群集的 SSO 服务没有明确要求使用同组中的群集物理磁盘资源。</span><span class="sxs-lookup"><span data-stu-id="52060-181">A clustered SSO service does not explicitly require the use of a clustered Physical Disk resource in the same group.</span></span>  
  
    4.  <span data-ttu-id="52060-182">右键单击群集的服务或应用程序，指向**将资源添加**，然后单击**通用服务**以显示**新建资源向导**对话框。</span><span class="sxs-lookup"><span data-stu-id="52060-182">Right-click the clustered service or application, point to **Add a resource**, and click **Generic Service** to display the **New Resource Wizard** dialog box.</span></span>  
  
    5.  <span data-ttu-id="52060-183">上**选择服务**页**新建资源向导**，选择**企业单一登录服务**，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="52060-183">On the **Select Service** page of the **New Resource Wizard**, select **Enterprise Single Sign-On Service**, and then click **Next**.</span></span>  
  
    6.  <span data-ttu-id="52060-184">上**确认**页上，单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="52060-184">On the **Confirmation** page click **Next**.</span></span>  
  
    7.  <span data-ttu-id="52060-185">上**摘要**页上，单击**完成**。</span><span class="sxs-lookup"><span data-stu-id="52060-185">On the **Summary** page click **Finish**.</span></span> <span data-ttu-id="52060-186">企业单一登录服务的群集的实例将显示在下面**信息的其他资源**中的中心窗格**故障转移群集管理**接口。</span><span class="sxs-lookup"><span data-stu-id="52060-186">A clustered instance of the Enterprise Single Sign-On Service will appear under **Other Resources** in the center pane of the **Failover Cluster Management** interface.</span></span>  
  
    8.  <span data-ttu-id="52060-187">右键单击企业单一登录服务的群集的实例，然后选择**属性**以显示**企业单一登录服务属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="52060-187">Right-click the clustered instance of the Enterprise Single Sign-On Service and select **Properties** to display the **Enterprise Single Sign-On Service Properties** dialog box.</span></span>  
  
    9. <span data-ttu-id="52060-188">单击**依赖项**选项卡的属性对话框中，单击**插入**。</span><span class="sxs-lookup"><span data-stu-id="52060-188">Click the **Dependencies** tab of the properties dialog box and click **Insert**.</span></span>  
  
    10. <span data-ttu-id="52060-189">单击下的下拉**资源**，选择**名称：** 资源，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="52060-189">Click the drop down box under **Resource**, select the **Name:** resource and click **OK**.</span></span>  
  
        > [!IMPORTANT]
        >  <span data-ttu-id="52060-190">如果不添加到依赖项**名称：** 资源，在尝试联系 SSO 服务的此群集的实例时，SSO 客户端计算机将生成类似于以下的错误：</span><span class="sxs-lookup"><span data-stu-id="52060-190">If you do not add the dependency to the **Name:** resource, SSO client computers will generate an error similar to the following when they try to contact this clustered instance of the SSO service:</span></span>  
        >   
        >  <span data-ttu-id="52060-191">检索主密钥失败。</span><span class="sxs-lookup"><span data-stu-id="52060-191">Failed to retrieve master secrets.</span></span>  
        >   
        >  <span data-ttu-id="52060-192">请确保主密钥服务器名称正确且该服务器可用。</span><span class="sxs-lookup"><span data-stu-id="52060-192">Verify that the master secret server name is correct and that it is available.</span></span> <span data-ttu-id="52060-193">密钥服务器名称: ENTSSO 错误代码: 0x800706D9，终结点映射器中没有更多的终结点可用。</span><span class="sxs-lookup"><span data-stu-id="52060-193">Secret Server Name: ENTSSO Error Code: 0x800706D9, there are no more endpoints available from the endpoint mapper.</span></span>  
  
16. <span data-ttu-id="52060-194">上群集 IIS[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]计算机中所述的步骤[Microsoft 知识库文章 970759"配置 IIS 7.0 中 Microsoft Windows Server 2008 故障转移群集"](http://go.microsoft.com/fwlink/p/?LinkId=152793) (<http://go.microsoft.com/fwlink/p/?LinkId=152793>)。</span><span class="sxs-lookup"><span data-stu-id="52060-194">Cluster IIS on the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer by following the steps documented in [Microsoft Knowledge Base article 970759 "Configuring IIS 7.0 in a Microsoft Windows Server 2008 failover cluster"](http://go.microsoft.com/fwlink/p/?LinkId=152793) (<http://go.microsoft.com/fwlink/p/?LinkId=152793>).</span></span> <span data-ttu-id="52060-195">在与群集 SSO 服务相同的群集组中创建群集的 IIS web 服务。</span><span class="sxs-lookup"><span data-stu-id="52060-195">Create the clustered IIS web service in the same cluster group as the clustered SSO service.</span></span>  
  
17. <span data-ttu-id="52060-196">在故障转移群集管理中，右键单击群集的服务或包含群集的企业单一登录服务的应用程序，然后单击**使此服务或应用程序联机**以启动所有中的资源群集的服务或应用程序。</span><span class="sxs-lookup"><span data-stu-id="52060-196">In Failover Cluster Management, right click the clustered service or application that contains the clustered Enterprise Single Sign-On service and then click **Bring this service or application online** to start all of the resources in the clustered service or application.</span></span>  
  
18. <span data-ttu-id="52060-197">右键单击群集的服务或应用程序，指向**将此服务或应用程序到另一个节点移动**，然后单击第二个节点。</span><span class="sxs-lookup"><span data-stu-id="52060-197">Right-click the clustered service or application, point to **Move this service or application to another node**, and click the second node.</span></span> <span data-ttu-id="52060-198">该步骤将群集服务或包含群集企业单一登录服务的应用程序从第一个节点移动到第二个节点。</span><span class="sxs-lookup"><span data-stu-id="52060-198">This step moves the clustered service or application that contains the clustered Enterprise Single Sign-On service from the first node to the second node.</span></span>  
  
19. <span data-ttu-id="52060-199">右键单击群集的企业单一登录服务，然后单击**使此服务或应用程序脱机**，然后右键单击 SSO 服务的群集的实例，并单击**使此服务或应用程序联机**。</span><span class="sxs-lookup"><span data-stu-id="52060-199">Right-click the clustered Enterprise Single Sign-On service and click **Take this service or application offline**, then right-click the clustered instance of the SSO service and click **Bring this service or application online**.</span></span>  
  
20. <span data-ttu-id="52060-200">使用 ssomanage 命令行实用工具将所有用户的 SSO 服务器名称设置为群集 SSO 服务。</span><span class="sxs-lookup"><span data-stu-id="52060-200">Set the SSO server name for all users to the clustered SSO service with the ssomanage command line utility.</span></span> <span data-ttu-id="52060-201">此命令应在组中的每个 BizTalk Server 上的 SSO 安装文件夹下运行。</span><span class="sxs-lookup"><span data-stu-id="52060-201">This command should be run from the SSO installation folder on each BizTalk server in the group.</span></span> <span data-ttu-id="52060-202">例如，以下命令行会将所有用户的 SSO 服务器名称设置为群集 SSO 服务：</span><span class="sxs-lookup"><span data-stu-id="52060-202">For example, the following command line will set the SSO server name for all users to the clustered SSO service:</span></span>  
  
    ```  
    ssomanage -serverall SSOCLUSTER  
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="52060-203">*SSOCLUSTER*是在包含群集的 SSO 服务的群集组中创建的实际网络名称资源的占位符。</span><span class="sxs-lookup"><span data-stu-id="52060-203">*SSOCLUSTER* is a placeholder for the actual network name resource that is created in the cluster group that contains the clustered SSO service.</span></span>  
  
21. <span data-ttu-id="52060-204">更新可在中访问的 SSO 服务器名称**BizTalk 组属性**页后，可以引用群集的 SSO 服务。</span><span class="sxs-lookup"><span data-stu-id="52060-204">Update the SSO Server name accessible in the **BizTalk Group Properties** page to reference the clustered SSO service.</span></span> <span data-ttu-id="52060-205">打开**BizTalk Server 管理**，右键单击 BizTalk 组，选择**属性**菜单项，更新 SSO 服务器名称的条目，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="52060-205">Open **BizTalk Server Administration**, right-click the BizTalk Group, select the **Properties** menu item, update the entry for SSO Server name, and then click **OK**.</span></span>  
  
22. <span data-ttu-id="52060-206">按照中的步骤[如何将 BizTalk 主机配置为群集资源](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3)在创建群集的 SSO 服务的同一群集组中创建一个或多个群集的 BizTalk 主机实例。</span><span class="sxs-lookup"><span data-stu-id="52060-206">Follow the steps in [How to Configure a BizTalk Host as a Cluster Resource](http://msdn.microsoft.com/library/6e9aab00-7623-4175-bb12-ba916306f1e3) to create one or more clustered BizTalk host instances in the same cluster group that you have created the clustered SSO service.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="52060-207">在此方案中，所有 BizTalk 主机都必须都创建为群集 SSO 服务资源所在的群集组中的群集资源。</span><span class="sxs-lookup"><span data-stu-id="52060-207">In this scenario, all BizTalk hosts must be created as cluster resources in the same cluster group as the clustered SSO service resource.</span></span> <span data-ttu-id="52060-208">不支持在群集 SSO 服务的 Windows Server 群集节点上运行非群集 BizTalk 主机实例的配置。</span><span class="sxs-lookup"><span data-stu-id="52060-208">Running an unclustered BizTalk host instance on a Windows Server Cluster node where the SSO service is clustered is not a supported configuration.</span></span> <span data-ttu-id="52060-209">这是因为当群集 SSO 服务由于与 SSO 服务上的 BizTalk 主机实例存在依赖关系而将故障转移至另一节点时，非群集 BizTalk 主机实例将失败。</span><span class="sxs-lookup"><span data-stu-id="52060-209">This is because the unclustered BizTalk host instance will fail when the clustered SSO service is failed over to another node due to the dependency of a BizTalk host instance on the SSO service.</span></span>