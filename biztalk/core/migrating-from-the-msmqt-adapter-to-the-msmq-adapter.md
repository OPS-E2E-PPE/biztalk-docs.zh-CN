---
title: 将从 MSMQT 适配器迁移到 MSMQ 适配器 |Microsoft 文档
ms.custom: ''
ms.date: 12/07/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 97126f70-0be5-4a2f-bcba-173fd932b6de
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1696e732bdbd005b01f16834a075fe69460602f9
ms.sourcegitcommit: 32f380810b90b70e5df7be72a6a14988a747868e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/28/2018
ms.locfileid: "29710184"
---
# <a name="migrate-from-the-msmqt-adapter-to-the-msmq-adapter"></a><span data-ttu-id="e52d1-102">将从 MSMQT 适配器迁移到 MSMQ 适配器</span><span class="sxs-lookup"><span data-stu-id="e52d1-102">Migrate from the MSMQT Adapter to the MSMQ Adapter</span></span>
<span data-ttu-id="e52d1-103">本主题讨论在将解决方案从 BizTalk 消息队列 (MSMQT) 适配器迁移到消息队列 (MSMQ) 适配器之前，在端对端按序送达、事务一致性、高可用性以及可伸缩性等方面的注意事项。</span><span class="sxs-lookup"><span data-stu-id="e52d1-103">This topic discusses points to consider regarding end-to-end ordered delivery, transactional consistency, high availability, and scalability before migrating solutions from the BizTalk Message Queuing (MSMQT) adapter to the Message Queuing (MSMQ) adapter.</span></span> <span data-ttu-id="e52d1-104">在本主题中，按序送达、事务一致性、高可用性以及可伸缩性的定义如下：</span><span class="sxs-lookup"><span data-stu-id="e52d1-104">For purposes of this topic ordered delivery, transactional consistency, high availability, and scalability are defined as follows:</span></span>  
  
-   <span data-ttu-id="e52d1-105">**有序的传递。**</span><span class="sxs-lookup"><span data-stu-id="e52d1-105">**Ordered delivery.**</span></span> <span data-ttu-id="e52d1-106">确保消息按照接收时的顺序从 BizTalk Server 发出。</span><span class="sxs-lookup"><span data-stu-id="e52d1-106">Guarantee that messages are sent out of BizTalk Server in the same order that they are received.</span></span>  
  
-   <span data-ttu-id="e52d1-107">**事务一致性。**</span><span class="sxs-lookup"><span data-stu-id="e52d1-107">**Transactional consistency.**</span></span> <span data-ttu-id="e52d1-108">确保消息在处理过程中不会由于硬件、软件或网络故障而丢失或重复。</span><span class="sxs-lookup"><span data-stu-id="e52d1-108">Guarantee that messages being processed are not lost or duplicated due to hardware, software, or network failure.</span></span>  
  
-   <span data-ttu-id="e52d1-109">**高可用性。**</span><span class="sxs-lookup"><span data-stu-id="e52d1-109">**High availability.**</span></span> <span data-ttu-id="e52d1-110">确保用于处理消息的服务随时可用于执行处理任务。</span><span class="sxs-lookup"><span data-stu-id="e52d1-110">Guarantee that services used to process messages are always available for processing.</span></span>  
  
-   <span data-ttu-id="e52d1-111">**可伸缩性。**</span><span class="sxs-lookup"><span data-stu-id="e52d1-111">**Scalability.**</span></span> <span data-ttu-id="e52d1-112">可提高现有消息处理能力的功能。</span><span class="sxs-lookup"><span data-stu-id="e52d1-112">Ability to increase existing message-processing capacity.</span></span>  
  
## <a name="end-to-end-ordered-delivery"></a><span data-ttu-id="e52d1-113">端到端的传递顺序</span><span class="sxs-lookup"><span data-stu-id="e52d1-113">End-to-End Ordered Delivery</span></span>  
 <span data-ttu-id="e52d1-114">MSMQT 适配器可确保消息的端对端按序送达。</span><span class="sxs-lookup"><span data-stu-id="e52d1-114">The MSMQT adapter ensures end-to-end ordered delivery of messages.</span></span> <span data-ttu-id="e52d1-115">这意味着，如果一个 MSMQ 应用程序将 1、 2 和 3 的消息发送到绑定到 MSMQT 适配器接收位置，然后这些消息传递到业务流程或发送端口 BizTalk Server 中的相同顺序︰ 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-115">This means that if an MSMQ application sends messages 1, 2, and 3 to a receive location bound to the MSMQT adapter, then these messages are delivered to an orchestration or send port in BizTalk Server in the same order: 1, 2, 3.</span></span> <span data-ttu-id="e52d1-116">此功能的一项应用可能包括股票市场交易，这些交易必须以与接收它们的顺序相同的顺序提交和执行。</span><span class="sxs-lookup"><span data-stu-id="e52d1-116">One use of this functionality might include stock market trades that must be submitted and executed in the same order that they are received.</span></span>  
  
 <span data-ttu-id="e52d1-117">MSMQT 的端对端按序送达需要将多个组件协同使用。</span><span class="sxs-lookup"><span data-stu-id="e52d1-117">End-to-end in-order delivery with MSMQT requires many components to be working together.</span></span> <span data-ttu-id="e52d1-118">以下一系列事件阐释了 MSMQT 适配器是如何实现此功能的：</span><span class="sxs-lookup"><span data-stu-id="e52d1-118">The following sequence of events illustrates how this is done with the MSMQT adapter:</span></span>  
  
1.  <span data-ttu-id="e52d1-119">MSMQ API 远程计算机上按顺序接收消息 1、 2 和 3，并将它们推送至事务的本地队列中的相同顺序︰ 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-119">The MSMQ API on a remote computer receives messages 1, 2, and 3 in order and pushes them into a transactional, local queue in the same order: 1, 2, 3.</span></span>  
  
2.  <span data-ttu-id="e52d1-120">在远程计算机上的 MSMQ 客户端将从队列的消息，并将其发送到 MSMQT 队列按顺序︰ 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-120">An MSMQ client on the remote computer takes the messages from the queue and sends them to the MSMQT queue in order: 1, 2, 3.</span></span>  
  
3.  <span data-ttu-id="e52d1-121">MSMQT 适配器接收的消息按顺序 1，2，3，并将其传递到相同的顺序中的 BizTalk MessageAgent 组件︰ 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-121">The MSMQT adapter receives the messages in order 1, 2, 3 and hands them to the BizTalk MessageAgent component in the same order: 1, 2, 3.</span></span>  
  
4.  <span data-ttu-id="e52d1-122">BizTalk MessageAgent 组件可确保消息将发送到按顺序 MessageBox: 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-122">The BizTalk MessageAgent component ensures that the messages are sent to the MessageBox in order: 1, 2, 3.</span></span>  
  
5.  <span data-ttu-id="e52d1-123">MessageBox 将消息路由，并确保它们路由到同一实例的业务流程或发送端口，如果它们传递到此实例的相同顺序︰ 1、 2、 3。</span><span class="sxs-lookup"><span data-stu-id="e52d1-123">The MessageBox routes the messages and ensures that if they are routed to the same instance of an orchestration or a send port, that they are delivered to this instance in the same order: 1, 2, 3.</span></span>  
  
 <span data-ttu-id="e52d1-124">在 BizTalk Server 2004 MSMQT 是端到，从而保证的支持的唯一适配器有序传送的结束。</span><span class="sxs-lookup"><span data-stu-id="e52d1-124">In BizTalk Server 2004, MSMQT was the only adapter capable of guaranteeing end-to end ordered delivery.</span></span> <span data-ttu-id="e52d1-125">集成的其他所有 BizTalk 适配器都可能会在上面所列的步骤 3 到 5 中更改消息的顺序。</span><span class="sxs-lookup"><span data-stu-id="e52d1-125">All of the other integrated BizTalk adapters can potentially change the order of the messages in steps 3 through 5 listed above.</span></span> <span data-ttu-id="e52d1-126">集成的其他大多数适配器都通过使用称为“端点管理器”的组件来完成步骤 3，该组件本身为多线程组件，因此不会保留顺序。</span><span class="sxs-lookup"><span data-stu-id="e52d1-126">Most of the other integrated adapters complete step 3 by the use of a component known as the End Point Manager, which is inherently multithreaded and therefore does not preserve order.</span></span> <span data-ttu-id="e52d1-127">BizTalk Server 2004 MSMQ 适配器使用保留的步骤 3，顺序"串行处理"功能，但并不然后要求 MessageAgent 保留今后，因此消息可能被路由到业务流程或发送端口无序的顺序。</span><span class="sxs-lookup"><span data-stu-id="e52d1-127">The BizTalk Server 2004 MSMQ adapter used a "Serial Processing" feature that preserves order for step 3, but it does not then ask the MessageAgent to preserve order going forward, so the messages may be routed to an orchestration or send port out of order.</span></span>  
  
 <span data-ttu-id="e52d1-128">**端到端与 MSMQ 适配器的传递顺序**</span><span class="sxs-lookup"><span data-stu-id="e52d1-128">**End-to-end ordered delivery with the MSMQ adapter**</span></span>  
  
 <span data-ttu-id="e52d1-129">若要实现端到端的传递顺序与 MSMQ 适配器，请按照下列步骤︰</span><span class="sxs-lookup"><span data-stu-id="e52d1-129">To achieve end-to-end ordered delivery with the MSMQ adapter, follow these steps:</span></span>  
  
1.  <span data-ttu-id="e52d1-130">启用 **按序送达** 属性接收端口用于订阅的业务流程或发送端口。</span><span class="sxs-lookup"><span data-stu-id="e52d1-130">Enable the **Ordered Delivery** property on the receive port for the subscribing orchestration or send port.</span></span> <span data-ttu-id="e52d1-131">在 BizTalk Server 中接收在业务流程中的端口和发送端口都具有**按序送达**配置选项。</span><span class="sxs-lookup"><span data-stu-id="e52d1-131">In BizTalk Server, receive ports in orchestrations and send ports have an **Ordered Delivery** configuration option.</span></span> <span data-ttu-id="e52d1-132">如果启用了此选项，则业务流程接收端口或发送端口将要求 MessageBox 按照消息的提交顺序向其传送消息。</span><span class="sxs-lookup"><span data-stu-id="e52d1-132">If this option is enabled, then the orchestration receive port or the send port asks the MessageBox to deliver messages to it in the same order they were submitted into the MessageBox.</span></span>  
  
2.  <span data-ttu-id="e52d1-133">设置 **排序处理** 属性绑定到 MSMQ 适配器接收位置 `True`。</span><span class="sxs-lookup"><span data-stu-id="e52d1-133">Set the **Ordered Processing** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span> <span data-ttu-id="e52d1-134">在 BizTalk Server 中，将收到使用 MSMQ 传输，可以将配置为使用排序处理这样，如果启用，可以确保消息被发送到它们已接收的相同顺序 MessageBox 的位置。</span><span class="sxs-lookup"><span data-stu-id="e52d1-134">In BizTalk Server, receive locations that use the MSMQ transport can be configured to use Ordered Processing which, if enabled, ensures that messages are sent to the MessageBox in the same order that they were received.</span></span>  
  
3.  <span data-ttu-id="e52d1-135">设置 **事务** 属性绑定到 MSMQ 适配器接收位置 `True`。</span><span class="sxs-lookup"><span data-stu-id="e52d1-135">Set the **Transactional** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span>  
  
4.  <span data-ttu-id="e52d1-136">确保将 MSMQ 接收位置监视的所有 MSMQ 队列标记为“事务性”。</span><span class="sxs-lookup"><span data-stu-id="e52d1-136">Ensure that any MSMQ queues that are being monitored by the MSMQ receive locations are marked as "Transactional".</span></span> <span data-ttu-id="e52d1-137">必须对队列设置此属性以确保消息的按序送达。</span><span class="sxs-lookup"><span data-stu-id="e52d1-137">This property must be set on the queues to ensure ordered delivery of messages.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e52d1-138">只有当 BizTalk 接收位置监视的 MSMQ 队列仅由一台计算机提供支持时，才可确保按序送达。</span><span class="sxs-lookup"><span data-stu-id="e52d1-138">Ordered delivery is guaranteed only if the MSMQ queue or queues that are being monitored by BizTalk receive locations is/are serviced by only one computer.</span></span> <span data-ttu-id="e52d1-139">这可能会在可伸缩性方面产生问题，在下文中将对此进行说明。</span><span class="sxs-lookup"><span data-stu-id="e52d1-139">This can present problems for scalability, as described below.</span></span>  
  
## <a name="transaction-usage-when-processing-messages-with-the-msmqt-adapter-vs-the-msmq-adapter"></a><span data-ttu-id="e52d1-140">使用 MSMQT 适配器处理消息与使用 MSMQ 适配器处理消息时的事务使用比较</span><span class="sxs-lookup"><span data-stu-id="e52d1-140">Transaction Usage When Processing Messages with the MSMQT Adapter vs. the MSMQ Adapter</span></span>  
 <span data-ttu-id="e52d1-141">在事务使用方面，MSMQT 和 MSMQ 适配器在处理消息的方式上有重要差异。</span><span class="sxs-lookup"><span data-stu-id="e52d1-141">With regard to transaction usage, there is a key difference between how the MSMQT and MSMQ adapters process messages.</span></span>  
  
 <span data-ttu-id="e52d1-142">在使用 MSMQT 适配器时，从网络接收消息并使用 BizTalk Server 对其进行处理的过程是在单个事务中进行处理的。</span><span class="sxs-lookup"><span data-stu-id="e52d1-142">When using the MSMQT adapter, the process of receiving a message from the network and processing it with BizTalk Server is handled under a single transaction.</span></span> <span data-ttu-id="e52d1-143">在使用 MSMQT 适配器时，为发件人生成的 ACK 消息表示消息已被接收并已被 BizTalk Server 成功处理。</span><span class="sxs-lookup"><span data-stu-id="e52d1-143">When using the MSMQT adapter, ACK messages generated for the sender are an indication that the message has been received and has been successfully processed by BizTalk Server.</span></span>  
  
 <span data-ttu-id="e52d1-144">在使用 MSMQ 适配器时，从网络接收消息并使用 BizTalk Server 对其进行处理的过程在两个单独的事务中进行处理，一个负责从网络接收消息，而另一个负责使用 BizTalk Server 对消息进行处理。</span><span class="sxs-lookup"><span data-stu-id="e52d1-144">When using the MSMQ adapter, the processes of receiving a message from the network and processing it with BizTalk Server are handled under two separate transactions, one for receiving from the network and one for processing it with BizTalk Server.</span></span> <span data-ttu-id="e52d1-145">在使用 MSMQ 适配器时，为发件人生成的 ACK 消息仅表示消息已被成功地从网络接收，并不表示该消息已被 BizTalk Server 成功处理。</span><span class="sxs-lookup"><span data-stu-id="e52d1-145">When using the MSMQ adapter, ACK messages generated for the sender are only an indication that the message has been successfully received from the network, not that the message has been successfully processed by BizTalk Server.</span></span> <span data-ttu-id="e52d1-146">当从网络接收消息并将该消息保存到本地 MSMQ 队列之后，无论是否安装了 BizTalk Server，发件人都会从 Microsoft 消息队列服务器接收到一个 ACK。</span><span class="sxs-lookup"><span data-stu-id="e52d1-146">The sender receives an ACK from the Microsoft Message Queuing server when the message is received from the network and persisted into the local MSMQ queue regardless of whether BizTalk Server is installed.</span></span> <span data-ttu-id="e52d1-147">在将消息保存到 MSMQ 队列之后，BizTalk MSMQ 适配器将提取该消息，并对其进行处理，然后将其发布到 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="e52d1-147">After the message has been persisted to the MSMQ queue, the BizTalk MSMQ adapter picks it up, processes it, and publishes it to the MessageBox.</span></span> <span data-ttu-id="e52d1-148">如果此过程失败，消息将发送到 BizTalk 挂起队列或保留在本地 MSMQ 队列（当使用事务性处理）中，并且发件人不会收到该消息在 BizTalk Server 中处理失败的提示。</span><span class="sxs-lookup"><span data-stu-id="e52d1-148">If this process fails, the message is either sent to the BizTalk suspended queue or left in the local MSMQ queue (when using transactional processing), and the sender has no indication that the message failed processing in BizTalk Server.</span></span>  
  
 <span data-ttu-id="e52d1-149">从 MSMQT 适配器迁移到 MSMQ 适配器时，如果您的结构要求您在 BizTalk Server 成功处理消息之后收到 ACK，则必须添加应用程序级别的 ACK。</span><span class="sxs-lookup"><span data-stu-id="e52d1-149">If your architecture requires that you receive ACKs when your messages are successfully processed by BizTalk Server, then you must add application-level ACKs if you are migrating from the MSMQT adapter to the MSMQ adapter.</span></span> <span data-ttu-id="e52d1-150">您需要更新您的业务流程和发送应用程序以实现应用程序级别的 ACK。</span><span class="sxs-lookup"><span data-stu-id="e52d1-150">You will need to update your orchestration and sending application to implement application-level ACKs.</span></span>  
  
## <a name="high-availability-transactional-in-order"></a><span data-ttu-id="e52d1-151">高可用性（事务性，按顺序）</span><span class="sxs-lookup"><span data-stu-id="e52d1-151">High Availability (Transactional, in Order)</span></span>  
 <span data-ttu-id="e52d1-152">若要为 MSMQT 适配器提供高可用性你可以将多台计算机添加到接收主机和网络负载平衡 (NLB) 配置容错或可以群集默认 BizTalk 主机。</span><span class="sxs-lookup"><span data-stu-id="e52d1-152">To provide high availability for the MSMQT adapter you can either add multiple computers to the receive host and configure Network Load Balancing (NLB) for fault tolerance or you can cluster the default BizTalk Host.</span></span> <span data-ttu-id="e52d1-153">如果在运行 MSMQT 适配器时使用 NLB，当一台服务器出现故障时，其他服务器将处理负载。</span><span class="sxs-lookup"><span data-stu-id="e52d1-153">If you are running the MSMQT adapter in conjunction with NLB, if one server goes down the other servers handle the load.</span></span> <span data-ttu-id="e52d1-154">如果在群集主机中运行 MSMQT 适配器处理程序，当一个主机节点出现故障时，群集软件将把该群集主机切换到其他节点。</span><span class="sxs-lookup"><span data-stu-id="e52d1-154">If you are running the MSMQT adapter handlers on a clustered host, if one host node fails, cluster software fails over the clustered host to the other node.</span></span> <span data-ttu-id="e52d1-155">在使用 MSMQ 适配器时，由于 MSMQ 适配器使用本地 MSMQ 队列用于中间存储，因此，如果需要没有数据损失的事务性处理，NLB 将无法工作。</span><span class="sxs-lookup"><span data-stu-id="e52d1-155">When using the MSMQ adapter, NLB does not work if you need transactional processing with no data loss because the MSMQ adapter uses local MSMQ queues for intermediate storage.</span></span> <span data-ttu-id="e52d1-156">在这种情况下，如果消息已送达本地 MSMQ 队列，但尚未被 MSMQ 适配器使用，则当计算机出现故障时该消息将丢失。</span><span class="sxs-lookup"><span data-stu-id="e52d1-156">In this scenario, if a message has been delivered to the local MSMQ queue but has not been consumed by the MSMQ adapter, the message is lost if the computer fails.</span></span>  
  
 <span data-ttu-id="e52d1-157">若要与 MSMQ 适配器提供高可用性和事务一致性，应执行以下操作︰</span><span class="sxs-lookup"><span data-stu-id="e52d1-157">To provide high availability and transactional consistency with the MSMQ adapter, you should do the following:</span></span>  
  
1.  <span data-ttu-id="e52d1-158">在 BizTalk 服务器上，将 Microsoft 消息队列 (MSMQ) 配置为 Windows Server 群集组中的群集资源。</span><span class="sxs-lookup"><span data-stu-id="e52d1-158">Configure Microsoft Message Queuing (MSMQ) as a clustered resource in a Windows Server cluster group on your BizTalk servers.</span></span>  
  
2.  <span data-ttu-id="e52d1-159">在已配置为群集 MSMQ 资源所在群集组中的群集资源的 BizTalk 主机实例中，配置 MSMQ 适配器接收处理程序。</span><span class="sxs-lookup"><span data-stu-id="e52d1-159">Configure the MSMQ adapter receive handler in a BizTalk Host instance that has been configured as a cluster resource in the same cluster group as the clustered MSMQ resource.</span></span>  
  
3.  <span data-ttu-id="e52d1-160">为 BizTalk 主机实例配置群集资源以便其维护对群集 MSMQ 资源的依存关系。</span><span class="sxs-lookup"><span data-stu-id="e52d1-160">Configure the cluster resource for the BizTalk Host instance so that it maintains a dependency on the clustered MSMQ resource.</span></span>  
  
 <span data-ttu-id="e52d1-161">若要实现此体系结构使用的有序的传递，请按照下"端到端的传递顺序与 MSMQ 适配器。"前面提供的步骤</span><span class="sxs-lookup"><span data-stu-id="e52d1-161">To implement ordered delivery with this architecture, follow the steps presented earlier under "End-to-end ordered delivery with the MSMQ adapter."</span></span>  
  
## <a name="high-availability-nontransactional-not-in-order"></a><span data-ttu-id="e52d1-162">高可用性（非事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="e52d1-162">High Availability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="e52d1-163">如果需要高可用性，但不需要事务性处理，则可以通过实现 NLB 并在 NLB 后的多个 BizTalk 服务器上运行配置有 MSMQ 发送和接收处理程序的主机实例，使用 MSMQ 适配器实现此目的。</span><span class="sxs-lookup"><span data-stu-id="e52d1-163">If you need high availability but do not need transactional processing, you can achieve this with the MSMQ adapter by implementing NLB and running instances of a host configured with the MSMQ send and receive handlers on multiple BizTalk servers behind NLB.</span></span> <span data-ttu-id="e52d1-164">实现与 MSMQ NLB 时你应遵循最佳做法，如 Microsoft 知识库文章中所述[899611： 消息队列如何客户端可通过网络负载平衡 (NLB)](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb)。</span><span class="sxs-lookup"><span data-stu-id="e52d1-164">When implementing NLB with MSMQ you should follow best practices as documented in Microsoft Knowledge Base article [899611 : How Message Queuing can function over Network Load Balancing (NLB)](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb).</span></span> <span data-ttu-id="e52d1-165">在这种情况下，如果一台 BizTalk 服务器出现故障，在该 BizTalk 服务器恢复之前，在该 BizTalk 服务器上的主机实例中运行的消息将不可用。</span><span class="sxs-lookup"><span data-stu-id="e52d1-165">In this scenario, if one of the BizTalk servers fails, the messages that are running in the host instance on that BizTalk server will be unavailable until the BizTalk server is recovered.</span></span> <span data-ttu-id="e52d1-166">由于当一台 BizTalk 服务器不可用时，NLB 会将请求路由至其他 BizTalk 服务器，因此该配置可提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="e52d1-166">This configuration provides high availability because if one of the BizTalk servers is not available, NLB routes requests to the other BizTalk server.</span></span>  
  
## <a name="scalability-nontransactional-not-in-order"></a><span data-ttu-id="e52d1-167">可伸缩性（非事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="e52d1-167">Scalability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="e52d1-168">通过遵循高可用性（非事务性）准则并添加其他主机实例，可以实现可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="e52d1-168">You can achieve scalability by following the guidelines for high availability (nontransactional) and adding additional host instances.</span></span> <span data-ttu-id="e52d1-169">此结构提供了快速送达以及可伸缩性，但是不提供按序送达。</span><span class="sxs-lookup"><span data-stu-id="e52d1-169">This architecture provides fast delivery as well as scalability, but does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-not-in-order"></a><span data-ttu-id="e52d1-170">可伸缩性（事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="e52d1-170">Scalability (Transactional, Not in Order)</span></span>  
 <span data-ttu-id="e52d1-171">对于非按序送达的事务性消息送达，可以将使用 MSMQ 的 NLB 与 Windows 群集组合使用。</span><span class="sxs-lookup"><span data-stu-id="e52d1-171">For transactional delivery of messages without ordered delivery, you can combine the use of NLB with MSMQ and Windows clustering.</span></span> <span data-ttu-id="e52d1-172">此结构要求您按照“高可用性（事务性，按顺序）”中的步骤，在两个单独的 Windows 群集环境中为每个 Windows 群集至少配置两个群集组。</span><span class="sxs-lookup"><span data-stu-id="e52d1-172">This architecture requires that you configure at least two cluster groups on two separate Windows Cluster environments following the steps under "High Availability (Transactional, in Order)" for each Windows Cluster.</span></span> <span data-ttu-id="e52d1-173">随后即可实现 NLB 以在群集组之间分布负载。</span><span class="sxs-lookup"><span data-stu-id="e52d1-173">You then implement NLB to distribute load between the cluster groups.</span></span> <span data-ttu-id="e52d1-174">由于 Windows NLB 不支持在 Windows 群集上运行，在这种情况下，需要使用硬件 NLB 解决方案。</span><span class="sxs-lookup"><span data-stu-id="e52d1-174">Because Windows NLB is not supported running on a Windows Cluster, this scenario requires a hardware NLB solution.</span></span> <span data-ttu-id="e52d1-175">下图对此结构进行了说明：</span><span class="sxs-lookup"><span data-stu-id="e52d1-175">The following diagram illustrates this architecture.</span></span>  
  
 <span data-ttu-id="e52d1-176">![负载平衡群集组之间](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span><span class="sxs-lookup"><span data-stu-id="e52d1-176">![Load balancing between cluster groups](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e52d1-177">此结构不提供按序送达。</span><span class="sxs-lookup"><span data-stu-id="e52d1-177">This architecture does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-in-order"></a><span data-ttu-id="e52d1-178">可伸缩性（事务性，按顺序）</span><span class="sxs-lookup"><span data-stu-id="e52d1-178">Scalability (Transactional, in Order)</span></span>  
 <span data-ttu-id="e52d1-179">使用 MSMQ 3.0 或早期版本时，因为不支持远程事务性读取，所以对提供高可用性、事务一致性以及按序送达的结构进行扩展将会有问题（除非 BizTalk Server 计算机和远程 MSMQ 服务器都运行 MSMQ 4.0）。</span><span class="sxs-lookup"><span data-stu-id="e52d1-179">Scaling out an architecture that provides high availability, transactional consistency, and ordered delivery is problematic when using MSMQ 3.0 or earlier because remote transactional reads are not supported unless both the BizTalk Server computer and the remote MSMQ server are running MSMQ 4.0.</span></span> <span data-ttu-id="e52d1-180">当使用 MSMQ 3.0 或早期版本时，必须使用多个本地 MSMQ 队列才能进行扩展。</span><span class="sxs-lookup"><span data-stu-id="e52d1-180">When using MSMQ 3.0 or earlier, scale out must be achieved using multiple local MSMQ queues.</span></span> <span data-ttu-id="e52d1-181">而且，在这种情况下，如果用于与 NLB 进行 MSMQ 会话的 TCP/IP 连接中断，该连接可被 NLB 随后还原到另一台计算机上，这会导致送达顺序紊乱。</span><span class="sxs-lookup"><span data-stu-id="e52d1-181">Furthermore, in this scenario, if the TCP/IP connection for the MSMQ session to the NLB is broken, it may subsequently be restored by NLB to a different computer, which can cause out-of-order delivery.</span></span>  
  
 <span data-ttu-id="e52d1-182">针对此限制的一种可能的解决办法是：通过将目标队列分配到不同的计算机手动进行消息送达的负载平衡。</span><span class="sxs-lookup"><span data-stu-id="e52d1-182">One possible workaround to this limitation is to manually load balance message delivery by allocating destination queues to different computers.</span></span> <span data-ttu-id="e52d1-183">通过尝试将特定的 BizTalk 主机实例分配给特定的 MSMQ 队列可实现此目的。</span><span class="sxs-lookup"><span data-stu-id="e52d1-183">You can so this by tying specific BizTalk Host instances to specific MSMQ queues.</span></span> <span data-ttu-id="e52d1-184">因此，例如，如果从特定的贸易合作伙伴接收大量文档，请在特定的 BizTalk 服务器上为该贸易合作伙伴创建单独的主机和接收队列。</span><span class="sxs-lookup"><span data-stu-id="e52d1-184">So for example, if you receive a large number of documents from one particular trading partner, create a separate host and receive queue on a particular BizTalk server for just that trading partner.</span></span>  
  
 <span data-ttu-id="e52d1-185">如果可能，请在要求远程事务性读取和负载平衡时在远程计算机上运行 MSMQ 4.0。</span><span class="sxs-lookup"><span data-stu-id="e52d1-185">If possible, run MSMQ 4.0 on remote computers when both remote transactional reads and load balancing are required.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="e52d1-186">摘要</span><span class="sxs-lookup"><span data-stu-id="e52d1-186">Summary</span></span>  
 <span data-ttu-id="e52d1-187">下表概括列出了可用来实现特定功能的结构：</span><span class="sxs-lookup"><span data-stu-id="e52d1-187">The following table summarizes the architectures that you can implement to accommodate specific functionality.</span></span>  
  
|<span data-ttu-id="e52d1-188">**功能**</span><span class="sxs-lookup"><span data-stu-id="e52d1-188">**Functionality**</span></span>|<span data-ttu-id="e52d1-189">**NLB 和群集都不**</span><span class="sxs-lookup"><span data-stu-id="e52d1-189">**Neither NLB nor cluster**</span></span>|<span data-ttu-id="e52d1-190">**NLB**</span><span class="sxs-lookup"><span data-stu-id="e52d1-190">**NLB**</span></span>|<span data-ttu-id="e52d1-191">**群集**</span><span class="sxs-lookup"><span data-stu-id="e52d1-191">**Cluster**</span></span>|<span data-ttu-id="e52d1-192">**NLB 和群集**</span><span class="sxs-lookup"><span data-stu-id="e52d1-192">**NLB and cluster**</span></span>|  
|-----------------------|---------------------------------|-------------|-----------------|-------------------------|  
|<span data-ttu-id="e52d1-193">端对端按序送达</span><span class="sxs-lookup"><span data-stu-id="e52d1-193">End-to-end ordered delivery</span></span>|<span data-ttu-id="e52d1-194">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-194">Yes</span></span>|<span data-ttu-id="e52d1-195">“否”</span><span class="sxs-lookup"><span data-stu-id="e52d1-195">No</span></span>|<span data-ttu-id="e52d1-196">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-196">Yes</span></span>|<span data-ttu-id="e52d1-197">可通过手动配置实现</span><span class="sxs-lookup"><span data-stu-id="e52d1-197">Possible with manual configuration</span></span>|  
|<span data-ttu-id="e52d1-198">事务一致性</span><span class="sxs-lookup"><span data-stu-id="e52d1-198">Transactional consistency</span></span>|<span data-ttu-id="e52d1-199">否（如果出现服务故障，消息可能会丢失或重复）</span><span class="sxs-lookup"><span data-stu-id="e52d1-199">No (messages can be lost or duplicated if service failure occurs)</span></span>|<span data-ttu-id="e52d1-200">否</span><span class="sxs-lookup"><span data-stu-id="e52d1-200">No</span></span>|<span data-ttu-id="e52d1-201">用户帐户控制</span><span class="sxs-lookup"><span data-stu-id="e52d1-201">Yes</span></span>|<span data-ttu-id="e52d1-202">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-202">Yes</span></span>|  
|<span data-ttu-id="e52d1-203">高度可用</span><span class="sxs-lookup"><span data-stu-id="e52d1-203">Highly available</span></span>|<span data-ttu-id="e52d1-204">否</span><span class="sxs-lookup"><span data-stu-id="e52d1-204">No</span></span>|<span data-ttu-id="e52d1-205">用户帐户控制</span><span class="sxs-lookup"><span data-stu-id="e52d1-205">Yes</span></span>|<span data-ttu-id="e52d1-206">用户帐户控制</span><span class="sxs-lookup"><span data-stu-id="e52d1-206">Yes</span></span>|<span data-ttu-id="e52d1-207">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-207">Yes</span></span>|  
|<span data-ttu-id="e52d1-208">可伸缩</span><span class="sxs-lookup"><span data-stu-id="e52d1-208">Scalable</span></span>|<span data-ttu-id="e52d1-209">否</span><span class="sxs-lookup"><span data-stu-id="e52d1-209">No</span></span>|<span data-ttu-id="e52d1-210">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-210">Yes</span></span>|<span data-ttu-id="e52d1-211">“否”</span><span class="sxs-lookup"><span data-stu-id="e52d1-211">No</span></span>|<span data-ttu-id="e52d1-212">是</span><span class="sxs-lookup"><span data-stu-id="e52d1-212">Yes</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e52d1-213">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e52d1-213">See Also</span></span>  
 [<span data-ttu-id="e52d1-214">Windows Server 群集用于 BizTalk Server Hosts2 为提供高可用性</span><span class="sxs-lookup"><span data-stu-id="e52d1-214">Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2</span></span>](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)