---
title: 从 MSMQT 适配器迁移到 MSMQ 适配器 |Microsoft Docs
ms.custom: ''
ms.date: 12/07/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 97126f70-0be5-4a2f-bcba-173fd932b6de
caps.latest.revision: 30
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 345247a39a3226d3e51b7c73f12be177adf01a3d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65324832"
---
# <a name="migrate-from-the-msmqt-adapter-to-the-msmq-adapter"></a><span data-ttu-id="6d009-102">从 MSMQT 适配器迁移到 MSMQ 适配器</span><span class="sxs-lookup"><span data-stu-id="6d009-102">Migrate from the MSMQT Adapter to the MSMQ Adapter</span></span>
<span data-ttu-id="6d009-103">本主题讨论点需要注意的有关端到端按序送达、 事务一致性、 高可用性和可伸缩性迁移之前从 BizTalk 消息队列 (MSMQT) 适配器的消息队列 (MSMQ) 适配器的解决方案。</span><span class="sxs-lookup"><span data-stu-id="6d009-103">This topic discusses points to consider regarding end-to-end ordered delivery, transactional consistency, high availability, and scalability before migrating solutions from the BizTalk Message Queuing (MSMQT) adapter to the Message Queuing (MSMQ) adapter.</span></span> <span data-ttu-id="6d009-104">对于本主题按序送达，事务一致性、 高可用性和可伸缩性定义，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6d009-104">For purposes of this topic ordered delivery, transactional consistency, high availability, and scalability are defined as follows:</span></span>  
  
-   <span data-ttu-id="6d009-105">**按序的送达。**</span><span class="sxs-lookup"><span data-stu-id="6d009-105">**Ordered delivery.**</span></span> <span data-ttu-id="6d009-106">保证消息发送出 BizTalk Server 接收时的顺序相同。</span><span class="sxs-lookup"><span data-stu-id="6d009-106">Guarantee that messages are sent out of BizTalk Server in the same order that they are received.</span></span>  
  
-   <span data-ttu-id="6d009-107">**事务一致性。**</span><span class="sxs-lookup"><span data-stu-id="6d009-107">**Transactional consistency.**</span></span> <span data-ttu-id="6d009-108">正在处理的消息不能保证而丢失或重复由于硬件、 软件或网络故障。</span><span class="sxs-lookup"><span data-stu-id="6d009-108">Guarantee that messages being processed are not lost or duplicated due to hardware, software, or network failure.</span></span>  
  
-   <span data-ttu-id="6d009-109">**高可用性。**</span><span class="sxs-lookup"><span data-stu-id="6d009-109">**High availability.**</span></span> <span data-ttu-id="6d009-110">保证服务用于处理消息始终可供处理。</span><span class="sxs-lookup"><span data-stu-id="6d009-110">Guarantee that services used to process messages are always available for processing.</span></span>  
  
-   <span data-ttu-id="6d009-111">**可伸缩性。**</span><span class="sxs-lookup"><span data-stu-id="6d009-111">**Scalability.**</span></span> <span data-ttu-id="6d009-112">若要提高现有消息处理能力的功能。</span><span class="sxs-lookup"><span data-stu-id="6d009-112">Ability to increase existing message-processing capacity.</span></span>  
  
## <a name="end-to-end-ordered-delivery"></a><span data-ttu-id="6d009-113">端到端按序送达</span><span class="sxs-lookup"><span data-stu-id="6d009-113">End-to-End Ordered Delivery</span></span>  
 <span data-ttu-id="6d009-114">MSMQT 适配器可确保端到端按序的送达消息。</span><span class="sxs-lookup"><span data-stu-id="6d009-114">The MSMQT adapter ensures end-to-end ordered delivery of messages.</span></span> <span data-ttu-id="6d009-115">这意味着，如果 MSMQ 应用程序将消息 1、 2 和 3 发送到接收位置绑定到 MSMQT 适配器，则这些消息发送到业务流程或发送端口在 BizTalk Server 中的相同顺序：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-115">This means that if an MSMQ application sends messages 1, 2, and 3 to a receive location bound to the MSMQT adapter, then these messages are delivered to an orchestration or send port in BizTalk Server in the same order: 1, 2, 3.</span></span> <span data-ttu-id="6d009-116">此功能的一种用法可能包括股票市场交易，必须提交并按相同顺序接收时的执行。</span><span class="sxs-lookup"><span data-stu-id="6d009-116">One use of this functionality might include stock market trades that must be submitted and executed in the same order that they are received.</span></span>  
  
 <span data-ttu-id="6d009-117">MSMQT 的端到端按序送达需要多个组件协同工作。</span><span class="sxs-lookup"><span data-stu-id="6d009-117">End-to-end in-order delivery with MSMQT requires many components to be working together.</span></span> <span data-ttu-id="6d009-118">以下一系列事件阐释了如何做到这一点与 MSMQT 适配器：</span><span class="sxs-lookup"><span data-stu-id="6d009-118">The following sequence of events illustrates how this is done with the MSMQT adapter:</span></span>  
  
1. <span data-ttu-id="6d009-119">远程计算机上的 MSMQ API 按顺序接收消息 1、 2 和 3，并将其推送到相同的顺序中的事务的本地队列：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-119">The MSMQ API on a remote computer receives messages 1, 2, and 3 in order and pushes them into a transactional, local queue in the same order: 1, 2, 3.</span></span>  
  
2. <span data-ttu-id="6d009-120">在远程计算机上的 MSMQ 客户端将消息从队列，并将其发送到 MSMQT 队列按顺序：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-120">An MSMQ client on the remote computer takes the messages from the queue and sends them to the MSMQT queue in order: 1, 2, 3.</span></span>  
  
3. <span data-ttu-id="6d009-121">MSMQT 适配器接收的消息按顺序 1，2，3，并将其传递到 BizTalk MessageAgent 组件的相同顺序：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-121">The MSMQT adapter receives the messages in order 1, 2, 3 and hands them to the BizTalk MessageAgent component in the same order: 1, 2, 3.</span></span>  
  
4. <span data-ttu-id="6d009-122">BizTalk MessageAgent 组件确保消息都发送到 MessageBox 中顺序：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-122">The BizTalk MessageAgent component ensures that the messages are sent to the MessageBox in order: 1, 2, 3.</span></span>  
  
5. <span data-ttu-id="6d009-123">MessageBox 将消息路由，并确保其路由到同一实例的业务流程或发送端口，确保它们都已传递到此实例的相同顺序：1, 2, 3.</span><span class="sxs-lookup"><span data-stu-id="6d009-123">The MessageBox routes the messages and ensures that if they are routed to the same instance of an orchestration or a send port, that they are delivered to this instance in the same order: 1, 2, 3.</span></span>  
  
   <span data-ttu-id="6d009-124">在 BizTalk Server 2004 中，MSMQT 是唯一的适配器能够确保端对端按序送达。</span><span class="sxs-lookup"><span data-stu-id="6d009-124">In BizTalk Server 2004, MSMQT was the only adapter capable of guaranteeing end-to end ordered delivery.</span></span> <span data-ttu-id="6d009-125">所有其他集成的 BizTalk 适配器可能可以更改与消息在步骤 3 至 5 上面列出的顺序。</span><span class="sxs-lookup"><span data-stu-id="6d009-125">All of the other integrated BizTalk adapters can potentially change the order of the messages in steps 3 through 5 listed above.</span></span> <span data-ttu-id="6d009-126">大多数其他集成适配器完成通过使用组件，称为作为终结点管理器中，这是本质上是多线程，因此将不保留顺序的步骤 3。</span><span class="sxs-lookup"><span data-stu-id="6d009-126">Most of the other integrated adapters complete step 3 by the use of a component known as the End Point Manager, which is inherently multithreaded and therefore does not preserve order.</span></span> <span data-ttu-id="6d009-127">使用"串行处理"功能保留步骤 3 中，为使 BizTalk Server 2004 MSMQ 适配器，但然后要求 MessageAgent 保留下来，因此可能被路由到业务流程或发送端口无序的消息的顺序。</span><span class="sxs-lookup"><span data-stu-id="6d009-127">The BizTalk Server 2004 MSMQ adapter used a "Serial Processing" feature that preserves order for step 3, but it does not then ask the MessageAgent to preserve order going forward, so the messages may be routed to an orchestration or send port out of order.</span></span>  
  
   <span data-ttu-id="6d009-128">**端到端使用 MSMQ 适配器按序送达**</span><span class="sxs-lookup"><span data-stu-id="6d009-128">**End-to-end ordered delivery with the MSMQ adapter**</span></span>  
  
   <span data-ttu-id="6d009-129">若要实现端到端使用 MSMQ 适配器按序送达，请执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6d009-129">To achieve end-to-end ordered delivery with the MSMQ adapter, follow these steps:</span></span>  
  
6. <span data-ttu-id="6d009-130">启用**按序送达**属性的接收订阅业务流程的端口或发送端口。</span><span class="sxs-lookup"><span data-stu-id="6d009-130">Enable the **Ordered Delivery** property on the receive port for the subscribing orchestration or send port.</span></span> <span data-ttu-id="6d009-131">在 BizTalk Server 中，接收业务流程中的端口和发送端口都具有**按序送达**配置选项。</span><span class="sxs-lookup"><span data-stu-id="6d009-131">In BizTalk Server, receive ports in orchestrations and send ports have an **Ordered Delivery** configuration option.</span></span> <span data-ttu-id="6d009-132">如果启用此选项，然后业务流程接收端口或发送端口将要求 MessageBox，以向其提交到 MessageBox 的相同顺序传送消息。</span><span class="sxs-lookup"><span data-stu-id="6d009-132">If this option is enabled, then the orchestration receive port or the send port asks the MessageBox to deliver messages to it in the same order they were submitted into the MessageBox.</span></span>  
  
7. <span data-ttu-id="6d009-133">设置**按序处理**绑定到 MSMQ 适配器的接收位置属性`True`。</span><span class="sxs-lookup"><span data-stu-id="6d009-133">Set the **Ordered Processing** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span> <span data-ttu-id="6d009-134">在 BizTalk Server 接收位置使用 MSMQ 传输可以将配置为使用按序处理这样，如果启用，可以确保消息将发送到 MessageBox 中相同的顺序接收。</span><span class="sxs-lookup"><span data-stu-id="6d009-134">In BizTalk Server, receive locations that use the MSMQ transport can be configured to use Ordered Processing which, if enabled, ensures that messages are sent to the MessageBox in the same order that they were received.</span></span>  
  
8. <span data-ttu-id="6d009-135">设置**事务性**绑定到 MSMQ 适配器的接收位置属性`True`。</span><span class="sxs-lookup"><span data-stu-id="6d009-135">Set the **Transactional** property for the receive location that is bound to the MSMQ adapter to `True`.</span></span>  
  
9. <span data-ttu-id="6d009-136">确保所有 MSMQ 队列是受监视的 MSMQ 都接收位置标记为"事务性"。</span><span class="sxs-lookup"><span data-stu-id="6d009-136">Ensure that any MSMQ queues that are being monitored by the MSMQ receive locations are marked as "Transactional".</span></span> <span data-ttu-id="6d009-137">此属性必须在队列上设置，以确保按序的送达消息。</span><span class="sxs-lookup"><span data-stu-id="6d009-137">This property must be set on the queues to ensure ordered delivery of messages.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6d009-138">按序的送达保证仅当 MSMQ 队列或队列是受监视的 BizTalk 接收位置是 / 由只有一台计算机提供服务。</span><span class="sxs-lookup"><span data-stu-id="6d009-138">Ordered delivery is guaranteed only if the MSMQ queue or queues that are being monitored by BizTalk receive locations is/are serviced by only one computer.</span></span> <span data-ttu-id="6d009-139">这可以提供可伸缩性，遇到的问题，如下所述。</span><span class="sxs-lookup"><span data-stu-id="6d009-139">This can present problems for scalability, as described below.</span></span>  
  
## <a name="transaction-usage-when-processing-messages-with-the-msmqt-adapter-vs-the-msmq-adapter"></a><span data-ttu-id="6d009-140">当使用 MSMQ 适配器与 MSMQT 适配器处理消息时使用的事务</span><span class="sxs-lookup"><span data-stu-id="6d009-140">Transaction Usage When Processing Messages with the MSMQT Adapter vs. the MSMQ Adapter</span></span>  
 <span data-ttu-id="6d009-141">事务使用方面是 MSMQT 和 MSMQ 适配器如何处理消息的主要区别。</span><span class="sxs-lookup"><span data-stu-id="6d009-141">With regard to transaction usage, there is a key difference between how the MSMQT and MSMQ adapters process messages.</span></span>  
  
 <span data-ttu-id="6d009-142">使用 MSMQT 适配器时，在单个事务下处理从网络接收消息和处理与 BizTalk Server 的过程。</span><span class="sxs-lookup"><span data-stu-id="6d009-142">When using the MSMQT adapter, the process of receiving a message from the network and processing it with BizTalk Server is handled under a single transaction.</span></span> <span data-ttu-id="6d009-143">使用 MSMQT 适配器时，该发件人生成的 ACK 消息将是一种指示消息已收到并已由 BizTalk Server 成功处理。</span><span class="sxs-lookup"><span data-stu-id="6d009-143">When using the MSMQT adapter, ACK messages generated for the sender are an indication that the message has been received and has been successfully processed by BizTalk Server.</span></span>  
  
 <span data-ttu-id="6d009-144">使用 MSMQ 适配器时，将其与 BizTalk Server 中的网络和处理从接收一条消息的进程处理两个单独的事务，一个用于从网络接收，一个用于处理与 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="6d009-144">When using the MSMQ adapter, the processes of receiving a message from the network and processing it with BizTalk Server are handled under two separate transactions, one for receiving from the network and one for processing it with BizTalk Server.</span></span> <span data-ttu-id="6d009-145">使用 MSMQ 适配器，发件人为生成的 ACK 消息时，仅表示消息已成功接收来自网络，该消息已成功处理的 BizTalk Server 不。</span><span class="sxs-lookup"><span data-stu-id="6d009-145">When using the MSMQ adapter, ACK messages generated for the sender are only an indication that the message has been successfully received from the network, not that the message has been successfully processed by BizTalk Server.</span></span> <span data-ttu-id="6d009-146">从网络接收消息并将其保存到本地 MSMQ 队列之后，无论是否安装了 BizTalk Server 时，发件人从 Microsoft 消息队列服务器接收确认。</span><span class="sxs-lookup"><span data-stu-id="6d009-146">The sender receives an ACK from the Microsoft Message Queuing server when the message is received from the network and persisted into the local MSMQ queue regardless of whether BizTalk Server is installed.</span></span> <span data-ttu-id="6d009-147">消息已保存到 MSMQ 队列之后，BizTalk MSMQ 适配器提取该消息、 处理它，并将其发布到 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="6d009-147">After the message has been persisted to the MSMQ queue, the BizTalk MSMQ adapter picks it up, processes it, and publishes it to the MessageBox.</span></span> <span data-ttu-id="6d009-148">如果此过程失败，消息是发送到 BizTalk 挂起队列或保留在本地 MSMQ 队列 （当使用事务处理），并且发件人具有不会指示消息在 BizTalk Server 中的处理失败。</span><span class="sxs-lookup"><span data-stu-id="6d009-148">If this process fails, the message is either sent to the BizTalk suspended queue or left in the local MSMQ queue (when using transactional processing), and the sender has no indication that the message failed processing in BizTalk Server.</span></span>  
  
 <span data-ttu-id="6d009-149">如果您的体系结构需要被 BizTalk Server 成功处理消息时收到 Ack，则必须如果从 MSMQT 适配器迁移到 MSMQ 适配器添加应用程序级别的 Ack。</span><span class="sxs-lookup"><span data-stu-id="6d009-149">If your architecture requires that you receive ACKs when your messages are successfully processed by BizTalk Server, then you must add application-level ACKs if you are migrating from the MSMQT adapter to the MSMQ adapter.</span></span> <span data-ttu-id="6d009-150">您需要更新你的业务流程和发送应用程序以实现应用程序级别的 Ack。</span><span class="sxs-lookup"><span data-stu-id="6d009-150">You will need to update your orchestration and sending application to implement application-level ACKs.</span></span>  
  
## <a name="high-availability-transactional-in-order"></a><span data-ttu-id="6d009-151">高可用性 （事务性，按顺序）</span><span class="sxs-lookup"><span data-stu-id="6d009-151">High Availability (Transactional, in Order)</span></span>  
 <span data-ttu-id="6d009-152">若要为 MSMQT 适配器提供高可用性可以向接收主机添加多台计算机，并为容错配置网络负载平衡 (NLB) 或在可以群集默认的 BizTalk 主机。</span><span class="sxs-lookup"><span data-stu-id="6d009-152">To provide high availability for the MSMQT adapter you can either add multiple computers to the receive host and configure Network Load Balancing (NLB) for fault tolerance or you can cluster the default BizTalk Host.</span></span> <span data-ttu-id="6d009-153">如果您使用 NLB，在运行 MSMQT 适配器，如果一台服务器出现故障的其他服务器处理的负载。</span><span class="sxs-lookup"><span data-stu-id="6d009-153">If you are running the MSMQT adapter in conjunction with NLB, if one server goes down the other servers handle the load.</span></span> <span data-ttu-id="6d009-154">如果群集主机上运行 MSMQT 适配器处理程序，如果一个主机节点出现故障，群集软件将故障转移到另一个节点的群集主机。</span><span class="sxs-lookup"><span data-stu-id="6d009-154">If you are running the MSMQT adapter handlers on a clustered host, if one host node fails, cluster software fails over the clustered host to the other node.</span></span> <span data-ttu-id="6d009-155">使用 MSMQ 适配器时，NLB 将无法工作如果需要事务性处理，而无数据丢失因为 MSMQ 适配器使用本地 MSMQ 队列的中间存储。</span><span class="sxs-lookup"><span data-stu-id="6d009-155">When using the MSMQ adapter, NLB does not work if you need transactional processing with no data loss because the MSMQ adapter uses local MSMQ queues for intermediate storage.</span></span> <span data-ttu-id="6d009-156">在此方案中，如果消息已传送到本地 MSMQ 队列，但不是消耗了 MSMQ 适配器，消息将丢失如果计算机出现故障。</span><span class="sxs-lookup"><span data-stu-id="6d009-156">In this scenario, if a message has been delivered to the local MSMQ queue but has not been consumed by the MSMQ adapter, the message is lost if the computer fails.</span></span>  
  
 <span data-ttu-id="6d009-157">若要使用 MSMQ 适配器提供高可用性和事务一致性，应执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="6d009-157">To provide high availability and transactional consistency with the MSMQ adapter, you should do the following:</span></span>  
  
1. <span data-ttu-id="6d009-158">将 Microsoft 消息队列 (MSMQ) 配置为在 BizTalk server 上的 Windows Server 群集组中的群集资源。</span><span class="sxs-lookup"><span data-stu-id="6d009-158">Configure Microsoft Message Queuing (MSMQ) as a clustered resource in a Windows Server cluster group on your BizTalk servers.</span></span>  
  
2. <span data-ttu-id="6d009-159">配置 MSMQ 适配器接收处理程序已配置为群集 MSMQ 资源所在的群集组中的群集资源的 BizTalk 主机实例中。</span><span class="sxs-lookup"><span data-stu-id="6d009-159">Configure the MSMQ adapter receive handler in a BizTalk Host instance that has been configured as a cluster resource in the same cluster group as the clustered MSMQ resource.</span></span>  
  
3. <span data-ttu-id="6d009-160">配置 BizTalk 主机实例的群集资源，使它保持群集 MSMQ 资源上的依赖项。</span><span class="sxs-lookup"><span data-stu-id="6d009-160">Configure the cluster resource for the BizTalk Host instance so that it maintains a dependency on the clustered MSMQ resource.</span></span>  
  
   <span data-ttu-id="6d009-161">若要实现这种体系结构的按序的送达，请按照前述"端到端使用 MSMQ 适配器按序送达。"的步骤</span><span class="sxs-lookup"><span data-stu-id="6d009-161">To implement ordered delivery with this architecture, follow the steps presented earlier under "End-to-end ordered delivery with the MSMQ adapter."</span></span>  
  
## <a name="high-availability-nontransactional-not-in-order"></a><span data-ttu-id="6d009-162">高可用性 （非事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="6d009-162">High Availability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="6d009-163">如果需要高可用性，但不是需要事务性处理，您可以使用 MSMQ 适配器实现此目的通过实现 NLB 并正在运行的实例的主机配置有 MSMQ 发送和接收 NLB 后的多个 BizTalk 服务器上的处理程序。</span><span class="sxs-lookup"><span data-stu-id="6d009-163">If you need high availability but do not need transactional processing, you can achieve this with the MSMQ adapter by implementing NLB and running instances of a host configured with the MSMQ send and receive handlers on multiple BizTalk servers behind NLB.</span></span> <span data-ttu-id="6d009-164">当使用 MSMQ 实现 NLB 时你应遵循最佳做法，如 Microsoft 知识库文章中所述[899611:消息队列如何函数通过网络负载平衡 (NLB)](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb)。</span><span class="sxs-lookup"><span data-stu-id="6d009-164">When implementing NLB with MSMQ you should follow best practices as documented in Microsoft Knowledge Base article [899611 : How Message Queuing can function over Network Load Balancing (NLB)](https://support.microsoft.com/help/899611/how-message-queuing-can-function-over-network-load-balancing-nlb).</span></span> <span data-ttu-id="6d009-165">在此方案中，如果 BizTalk 服务器出现故障时，将恢复中的主机实例运行的 BizTalk server 将不可用之前的 BizTalk server 的消息。</span><span class="sxs-lookup"><span data-stu-id="6d009-165">In this scenario, if one of the BizTalk servers fails, the messages that are running in the host instance on that BizTalk server will be unavailable until the BizTalk server is recovered.</span></span> <span data-ttu-id="6d009-166">此配置提供高可用性，因为如果其中一台 BizTalk 服务器不可用，NLB 会将请求路由到其他 BizTalk 服务器。</span><span class="sxs-lookup"><span data-stu-id="6d009-166">This configuration provides high availability because if one of the BizTalk servers is not available, NLB routes requests to the other BizTalk server.</span></span>  
  
## <a name="scalability-nontransactional-not-in-order"></a><span data-ttu-id="6d009-167">可伸缩性 （事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="6d009-167">Scalability (Nontransactional, Not in Order)</span></span>  
 <span data-ttu-id="6d009-168">为实现高可用性 （非事务性） 准则并添加其他主机实例，即可实现可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6d009-168">You can achieve scalability by following the guidelines for high availability (nontransactional) and adding additional host instances.</span></span> <span data-ttu-id="6d009-169">此体系结构提供了快速送达以及可伸缩性，但不提供按序的送达。</span><span class="sxs-lookup"><span data-stu-id="6d009-169">This architecture provides fast delivery as well as scalability, but does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-not-in-order"></a><span data-ttu-id="6d009-170">可伸缩性 （事务性，不按顺序）</span><span class="sxs-lookup"><span data-stu-id="6d009-170">Scalability (Transactional, Not in Order)</span></span>  
 <span data-ttu-id="6d009-171">对于送达的事务性消息不按序送达的情况下，可以使用 MSMQ 和 Windows 群集组合使用 NLB。</span><span class="sxs-lookup"><span data-stu-id="6d009-171">For transactional delivery of messages without ordered delivery, you can combine the use of NLB with MSMQ and Windows clustering.</span></span> <span data-ttu-id="6d009-172">此体系结构需要两个独立 Windows 群集环境中的步骤"高可用性 （事务性，按顺序）"下为每个 Windows 群集上配置至少两个群集组。</span><span class="sxs-lookup"><span data-stu-id="6d009-172">This architecture requires that you configure at least two cluster groups on two separate Windows Cluster environments following the steps under "High Availability (Transactional, in Order)" for each Windows Cluster.</span></span> <span data-ttu-id="6d009-173">随后即可实现 NLB 群集组之间的负载分配。</span><span class="sxs-lookup"><span data-stu-id="6d009-173">You then implement NLB to distribute load between the cluster groups.</span></span> <span data-ttu-id="6d009-174">由于 Windows NLB 不支持 Windows 群集上运行，这种情况下需要使用硬件 NLB 解决方案。</span><span class="sxs-lookup"><span data-stu-id="6d009-174">Because Windows NLB is not supported running on a Windows Cluster, this scenario requires a hardware NLB solution.</span></span> <span data-ttu-id="6d009-175">下图对此结构进行了说明：</span><span class="sxs-lookup"><span data-stu-id="6d009-175">The following diagram illustrates this architecture.</span></span>  
  
 <span data-ttu-id="6d009-176">![群集组之间的负载平衡](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span><span class="sxs-lookup"><span data-stu-id="6d009-176">![Load balancing between cluster groups](../core/media/scaleclusteredmsmqwithnlb.gif "ScaleClusteredMSMQwithNLB")</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6d009-177">此体系结构不提供按序的送达。</span><span class="sxs-lookup"><span data-stu-id="6d009-177">This architecture does not provide ordered delivery.</span></span>  
  
## <a name="scalability-transactional-in-order"></a><span data-ttu-id="6d009-178">可伸缩性 （事务性，按顺序）</span><span class="sxs-lookup"><span data-stu-id="6d009-178">Scalability (Transactional, in Order)</span></span>  
 <span data-ttu-id="6d009-179">扩展提供高可用性、 事务一致性以及按序的送达的体系结构是使用 MSMQ 3.0 时，会出现问题或更早版本不支持远程事务性读取，除非由于 BizTalk Server 计算机和远程 MSMQ 服务器都运行 MSMQ 4.0。</span><span class="sxs-lookup"><span data-stu-id="6d009-179">Scaling out an architecture that provides high availability, transactional consistency, and ordered delivery is problematic when using MSMQ 3.0 or earlier because remote transactional reads are not supported unless both the BizTalk Server computer and the remote MSMQ server are running MSMQ 4.0.</span></span> <span data-ttu-id="6d009-180">使用 MSMQ 3.0 或更早版本时，必须使用多个本地 MSMQ 队列实现向外扩展。</span><span class="sxs-lookup"><span data-stu-id="6d009-180">When using MSMQ 3.0 or earlier, scale out must be achieved using multiple local MSMQ queues.</span></span> <span data-ttu-id="6d009-181">此外，在此方案中，如果连接到 NLB 的 MSMQ 会话的 TCP/IP 连接中断，它可能被 NLB 随后还原到其他计算机，这会导致无序送达。</span><span class="sxs-lookup"><span data-stu-id="6d009-181">Furthermore, in this scenario, if the TCP/IP connection for the MSMQ session to the NLB is broken, it may subsequently be restored by NLB to a different computer, which can cause out-of-order delivery.</span></span>  
  
 <span data-ttu-id="6d009-182">这一限制的一种解决方法是手动加载平衡消息传递目标队列分配到不同的计算机。</span><span class="sxs-lookup"><span data-stu-id="6d009-182">One possible workaround to this limitation is to manually load balance message delivery by allocating destination queues to different computers.</span></span> <span data-ttu-id="6d009-183">你可以使这通过将特定的 BizTalk 主机实例到特定的 MSMQ 队列。</span><span class="sxs-lookup"><span data-stu-id="6d009-183">You can so this by tying specific BizTalk Host instances to specific MSMQ queues.</span></span> <span data-ttu-id="6d009-184">因此，例如，如果从特定的贸易合作伙伴接收大量的文档，创建单独的主机，并为该贸易合作伙伴接收特定的 BizTalk server 上的队列。</span><span class="sxs-lookup"><span data-stu-id="6d009-184">So for example, if you receive a large number of documents from one particular trading partner, create a separate host and receive queue on a particular BizTalk server for just that trading partner.</span></span>  
  
 <span data-ttu-id="6d009-185">如果可能，请在远程计算机上运行 MSMQ 4.0，需要远程事务性读取和负载平衡时。</span><span class="sxs-lookup"><span data-stu-id="6d009-185">If possible, run MSMQ 4.0 on remote computers when both remote transactional reads and load balancing are required.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="6d009-186">总结</span><span class="sxs-lookup"><span data-stu-id="6d009-186">Summary</span></span>  
 <span data-ttu-id="6d009-187">下表总结了你可用来实现特定功能的体系结构。</span><span class="sxs-lookup"><span data-stu-id="6d009-187">The following table summarizes the architectures that you can implement to accommodate specific functionality.</span></span>  
  
|<span data-ttu-id="6d009-188">**功能**</span><span class="sxs-lookup"><span data-stu-id="6d009-188">**Functionality**</span></span>|<span data-ttu-id="6d009-189">**NLB 和群集都不**</span><span class="sxs-lookup"><span data-stu-id="6d009-189">**Neither NLB nor cluster**</span></span>|<span data-ttu-id="6d009-190">**NLB**</span><span class="sxs-lookup"><span data-stu-id="6d009-190">**NLB**</span></span>|<span data-ttu-id="6d009-191">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="6d009-191">**Cluster**</span></span>|<span data-ttu-id="6d009-192">**NLB 和群集**</span><span class="sxs-lookup"><span data-stu-id="6d009-192">**NLB and cluster**</span></span>|  
|-----------------------|---------------------------------|-------------|-----------------|-------------------------|  
|<span data-ttu-id="6d009-193">端到端按序送达</span><span class="sxs-lookup"><span data-stu-id="6d009-193">End-to-end ordered delivery</span></span>|<span data-ttu-id="6d009-194">是</span><span class="sxs-lookup"><span data-stu-id="6d009-194">Yes</span></span>|<span data-ttu-id="6d009-195">否</span><span class="sxs-lookup"><span data-stu-id="6d009-195">No</span></span>|<span data-ttu-id="6d009-196">是</span><span class="sxs-lookup"><span data-stu-id="6d009-196">Yes</span></span>|<span data-ttu-id="6d009-197">可能的通过手动配置</span><span class="sxs-lookup"><span data-stu-id="6d009-197">Possible with manual configuration</span></span>|  
|<span data-ttu-id="6d009-198">事务一致性</span><span class="sxs-lookup"><span data-stu-id="6d009-198">Transactional consistency</span></span>|<span data-ttu-id="6d009-199">否 （消息可能已丢失或重复如果出现服务故障）</span><span class="sxs-lookup"><span data-stu-id="6d009-199">No (messages can be lost or duplicated if service failure occurs)</span></span>|<span data-ttu-id="6d009-200">否</span><span class="sxs-lookup"><span data-stu-id="6d009-200">No</span></span>|<span data-ttu-id="6d009-201">是</span><span class="sxs-lookup"><span data-stu-id="6d009-201">Yes</span></span>|<span data-ttu-id="6d009-202">是</span><span class="sxs-lookup"><span data-stu-id="6d009-202">Yes</span></span>|  
|<span data-ttu-id="6d009-203">高度可用</span><span class="sxs-lookup"><span data-stu-id="6d009-203">Highly available</span></span>|<span data-ttu-id="6d009-204">否</span><span class="sxs-lookup"><span data-stu-id="6d009-204">No</span></span>|<span data-ttu-id="6d009-205">是</span><span class="sxs-lookup"><span data-stu-id="6d009-205">Yes</span></span>|<span data-ttu-id="6d009-206">是</span><span class="sxs-lookup"><span data-stu-id="6d009-206">Yes</span></span>|<span data-ttu-id="6d009-207">是</span><span class="sxs-lookup"><span data-stu-id="6d009-207">Yes</span></span>|  
|<span data-ttu-id="6d009-208">可缩放</span><span class="sxs-lookup"><span data-stu-id="6d009-208">Scalable</span></span>|<span data-ttu-id="6d009-209">否</span><span class="sxs-lookup"><span data-stu-id="6d009-209">No</span></span>|<span data-ttu-id="6d009-210">是</span><span class="sxs-lookup"><span data-stu-id="6d009-210">Yes</span></span>|<span data-ttu-id="6d009-211">否</span><span class="sxs-lookup"><span data-stu-id="6d009-211">No</span></span>|<span data-ttu-id="6d009-212">是</span><span class="sxs-lookup"><span data-stu-id="6d009-212">Yes</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="6d009-213">请参阅</span><span class="sxs-lookup"><span data-stu-id="6d009-213">See Also</span></span>  
 [<span data-ttu-id="6d009-214">使用 Windows Server 群集为 BizTalk Server 主机 2 提供高可用性</span><span class="sxs-lookup"><span data-stu-id="6d009-214">Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2</span></span>](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)