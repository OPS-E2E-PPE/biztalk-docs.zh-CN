---
title: MDN 消息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 16ac6253-0be5-4636-b102-bf5af8956261
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c2ac015986c78f97082321171ca2fcd01a4854e6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65380014"
---
# <a name="mdn-messages"></a><span data-ttu-id="7f36f-102">MDN 消息</span><span class="sxs-lookup"><span data-stu-id="7f36f-102">MDN Messages</span></span>
<span data-ttu-id="7f36f-103">消息处置通知 (MDN) 用于确认已发送 AS2 消息的响应中。</span><span class="sxs-lookup"><span data-stu-id="7f36f-103">The Message Disposition Notification (MDN) is the acknowledgment sent in response to an AS2 message.</span></span> <span data-ttu-id="7f36f-104">如果启用了 MDN，直到接收并验证 MDN 才完成 AS2 传输。</span><span class="sxs-lookup"><span data-stu-id="7f36f-104">If an MDN is enabled, the AS2 transmission is not complete until the MDN has been received and verified.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="7f36f-105">将始终尝试返回一个 MDN 以指示消息处理的状态，即使在处理 AS2 消息时出错。</span><span class="sxs-lookup"><span data-stu-id="7f36f-105">will always attempt to return an MDN to indicate the status of message processing, even if an error occurred in processing the AS2 message.</span></span>  
  
 <span data-ttu-id="7f36f-106">MDN 用于确认以下：</span><span class="sxs-lookup"><span data-stu-id="7f36f-106">The MDN provides verification of the following:</span></span>  
  
-   <span data-ttu-id="7f36f-107">**原始消息已成功接收到接收方**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-107">**That the original message was successfully received by the receiving party**.</span></span> <span data-ttu-id="7f36f-108">原始消息的发件人来验证这一点比较包含在 MDN 中接收方的原始消息 id 字段的原始发送消息的 MessageID。</span><span class="sxs-lookup"><span data-stu-id="7f36f-108">The sender of the original message verifies this by comparing the MessageID of the original sent message with the original-message-id field that the receiver included in the MDN.</span></span>  
  
-   <span data-ttu-id="7f36f-109">**接收方已验证交换的数据的完整性**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-109">**That the integrity of the data exchanged was verified by the receiving partner**.</span></span> <span data-ttu-id="7f36f-110">原始消息的发件人来验证这一点将原始发送的消息有效负载，接收方收到的消息有效负载计算以及 （如果 MDN 的接收时间内容 MIC 字段中包含的 mic 计算的 MIC 进行比较有符号）。</span><span class="sxs-lookup"><span data-stu-id="7f36f-110">The sender of the original message verifies this by comparing the MIC that was calculated from the original sent message payload, with the MIC that the receiver calculated on the received message payload and included in the Received-content-MIC field of the MDN (if signed).</span></span>  
  
-   <span data-ttu-id="7f36f-111">**是否存在的不可否认的回执**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-111">**That there is a non-repudiation of receipt**.</span></span> <span data-ttu-id="7f36f-112">发件人执行此方法是使用接收方的公钥，验证已签名的 MDN，并通过验证返回的 MIC 值在 MDN 中的原始消息负载的 MIC 相同存储在不可否认数据库中。</span><span class="sxs-lookup"><span data-stu-id="7f36f-112">The sender does this by verifying the signed MDN with the receiving partner's public key, and by verifying that the returned MIC value in the MDN is the same as the MIC for the original message payload stored in the non-repudiation database.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="7f36f-113">同步 MDN 可用作 HTTP 响应，例如，200 OK。</span><span class="sxs-lookup"><span data-stu-id="7f36f-113">A synchronous MDN serves as an HTTP Response, e.g., 200 OK.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="7f36f-114">有关 Mdn 的接收方处理的详细信息，请参阅[处理传入 MDN](../core/processing-an-incoming-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="7f36f-114">For more information about receive-side processing of MDNs, see [Processing an Incoming MDN](../core/processing-an-incoming-mdn.md).</span></span> <span data-ttu-id="7f36f-115">有关 Mdn 的发送端处理的详细信息，请参阅[发送传出的 MDN](../core/sending-an-outgoing-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="7f36f-115">For more information about send-side processing of MDNs, see [Sending an Outgoing MDN](../core/sending-an-outgoing-mdn.md).</span></span>  
  
## <a name="properties-used-to-generate-the-mdn"></a><span data-ttu-id="7f36f-116">用于生成 MDN 的属性</span><span class="sxs-lookup"><span data-stu-id="7f36f-116">Properties Used to Generate the MDN</span></span>  
 <span data-ttu-id="7f36f-117">AS2Receive 接收管道将生成 MDN 使用参与方的 AS2 协议属性，如果**使用的验证和 MDN 的协议设置而非消息标头**中的单向协议选项卡上选择属性**协议属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="7f36f-117">The AS2Receive receive pipeline will generate an MDN using a party's AS2 agreement properties if the **Use agreement settings for validation and MDN instead of message header** property is selected on the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="7f36f-118">在此情况下，AS2-从消息中的属性标头将用于生成 MDN，但其他属性将被从参与方的 AS2 协议设置。</span><span class="sxs-lookup"><span data-stu-id="7f36f-118">In this instance, the AS2-From property in the message header will be used in generating the MDN, but other properties will be taken from the party's AS2 agreement settings.</span></span>  
  
 <span data-ttu-id="7f36f-119">如果未选择的选项来覆盖 AS2 属性，或者参与方的 AS2 协议可用，则接收管道将生成 MDN 的 AS2 标头标记使用传入消息中。</span><span class="sxs-lookup"><span data-stu-id="7f36f-119">If the option to override AS2 property is not selected, or the party’s AS2 agreement is available, the receive pipeline will generate the MDN using the AS2 header tags in the incoming message.</span></span>  
  
 <span data-ttu-id="7f36f-120">可以对 MDN 进行签名，但不能加密或压缩。</span><span class="sxs-lookup"><span data-stu-id="7f36f-120">An MDN can be signed, but it cannot be encrypted or compressed.</span></span>  
  
## <a name="mdn-context-properties"></a><span data-ttu-id="7f36f-121">MDN 上下文属性</span><span class="sxs-lookup"><span data-stu-id="7f36f-121">MDN Context Properties</span></span>  
 <span data-ttu-id="7f36f-122">使用在处理 MDN 消息上下文属性包括可以升级的属性，以及未公开，但可以在已挂起和跟踪消息中查看的属性。</span><span class="sxs-lookup"><span data-stu-id="7f36f-122">Context properties used in processing MDN messages include properties that can be promoted as well as properties that are not publicly exposed, but can be viewed in suspended and tracked messages.</span></span> <span data-ttu-id="7f36f-123">有关这些上下文属性的列表，请参阅[AS2 上下文属性](../core/as2-context-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="7f36f-123">For a list of these context properties, see [AS2 Context Properties](../core/as2-context-properties.md).</span></span>  
  
 <span data-ttu-id="7f36f-124">若要生成 MDN，必须升级 DispositionMode 和 DispositionType 上下文属性。</span><span class="sxs-lookup"><span data-stu-id="7f36f-124">Both the DispositionMode and DispositionType context properties must be promoted in order for an MDN to be generated.</span></span> <span data-ttu-id="7f36f-125">如果在 AS2 或 EDI 负载中出错，则 DispositionType 属性将指示该错误。</span><span class="sxs-lookup"><span data-stu-id="7f36f-125">If an error occurs in the AS2 or EDI payload, the DispositionType property will indicate the error.</span></span> <span data-ttu-id="7f36f-126">可以看到在此属性**消息的详细信息**中的挂起服务实例 （通过服务详细信息对话框中） 显示的对话框**组中心**页[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="7f36f-126">You can see this property in the **Message Details** dialog box that is displayed (via the Service Details dialog box) from the Suspended service instances in the **Group Hub** page of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration Console.</span></span> <span data-ttu-id="7f36f-127">如果在标题中，出现错误[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]将指示错误在 DispositionType 属性中，并将尝试发送该 MDN，但根据具体的错误，可能无法再执行此操作。</span><span class="sxs-lookup"><span data-stu-id="7f36f-127">If an error occurs in the header, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will indicate the error in the DispositionType property, and will attempt to send the MDN, but depending on the error, may not be able to do so.</span></span>  
  
## <a name="mdn-headers"></a><span data-ttu-id="7f36f-128">MDN 标头</span><span class="sxs-lookup"><span data-stu-id="7f36f-128">MDN Headers</span></span>  
 <span data-ttu-id="7f36f-129">MDN 包含以下标头：</span><span class="sxs-lookup"><span data-stu-id="7f36f-129">The MDN contains the following headers:</span></span>  
  
- <span data-ttu-id="7f36f-130">**HTTP/AS2 标头**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-130">**HTTP/AS2 headers**.</span></span> <span data-ttu-id="7f36f-131">有关详细信息，请参阅[AS2 消息](../core/as2-messages.md)。</span><span class="sxs-lookup"><span data-stu-id="7f36f-131">For more information, see [AS2 Messages](../core/as2-messages.md).</span></span>  
  
- <span data-ttu-id="7f36f-132">**传输层**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-132">**Transfer Layer**.</span></span> <span data-ttu-id="7f36f-133">这包括用于 MIC、 签名格式化协议和最外面的多部分边界子标头包括已签名的多部分消息，该算法的内容类型标头。</span><span class="sxs-lookup"><span data-stu-id="7f36f-133">This includes the Content-Type header that includes the signed multipart message, the algorithm for the MIC, the signature formatting protocol, and the outermost multipart boundary sub-headers.</span></span>  
  
- <span data-ttu-id="7f36f-134">**第一部分**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-134">**First Part**.</span></span> <span data-ttu-id="7f36f-135">多部分签名消息的第一部分是嵌入式的 MDN。</span><span class="sxs-lookup"><span data-stu-id="7f36f-135">The first part of the multipart signed message is the embedded MDN.</span></span> <span data-ttu-id="7f36f-136">它是人工可读。</span><span class="sxs-lookup"><span data-stu-id="7f36f-136">It is human readable.</span></span>  
  
- <span data-ttu-id="7f36f-137">**第 2 个部分**。</span><span class="sxs-lookup"><span data-stu-id="7f36f-137">**Second Part**.</span></span> <span data-ttu-id="7f36f-138">多部分签名消息的第二部分包含的数字签名、 原始消息、 处置类型和状态和 MIC 值的引用。</span><span class="sxs-lookup"><span data-stu-id="7f36f-138">The second part of the multipart signed message contains the digital signature, a reference to the original message, the disposition type and status, and the MIC value.</span></span> <span data-ttu-id="7f36f-139">它是计算机可读。</span><span class="sxs-lookup"><span data-stu-id="7f36f-139">It is machine readable.</span></span>  
  
  <span data-ttu-id="7f36f-140">AS2-From 标头、 AS2-标头和 MessageID 上下文属性用于将 MDN 所响应的 AS2 消息相关联。</span><span class="sxs-lookup"><span data-stu-id="7f36f-140">The AS2-From header, AS2-To header, and MessageID context property are used to correlate an MDN to the AS2 message that it is responding to.</span></span> <span data-ttu-id="7f36f-141">MDN 中的原始消息 ID 标头来自 MDN 所响应的 AS2 消息的消息 ID 标头。</span><span class="sxs-lookup"><span data-stu-id="7f36f-141">The Original-Message-ID header in an MDN comes from the Message-ID header of the AS2 message that the MDN is responding to.</span></span>  
  
## <a name="mic"></a><span data-ttu-id="7f36f-142">MIC</span><span class="sxs-lookup"><span data-stu-id="7f36f-142">MIC</span></span>  
 <span data-ttu-id="7f36f-143">消息完整性检查 (MIC) 用于验证 MDN 关联到原始发送的消息有效负载。</span><span class="sxs-lookup"><span data-stu-id="7f36f-143">The Message Integrity Check (MIC) is used to verify that an MDN correlates to the original sent message payload.</span></span> <span data-ttu-id="7f36f-144">MIC 摘要包括在多部分签名 MDN 消息的第二部分中的已接收内容 MIC 扩展字段。</span><span class="sxs-lookup"><span data-stu-id="7f36f-144">The MIC digest is included in the Received-Content-MIC extension field in the second part of the multipart signed MDN message.</span></span>  
  
 <span data-ttu-id="7f36f-145">如果启用了 MDN，当 AS2 发送管道处理出站消息时，它将计算出一个 MICHashValue 从消息负载。</span><span class="sxs-lookup"><span data-stu-id="7f36f-145">If an MDN is enabled, when the AS2 send pipeline processes an outbound message, it computes a MICHashValue from the message payload.</span></span> <span data-ttu-id="7f36f-146">发送管道在 BizTalkMsgBoxDb 数据库的 EdiInt_Mic 表中保存的哈希值。</span><span class="sxs-lookup"><span data-stu-id="7f36f-146">The send pipeline saves the hash value in the EdiInt_Mic table of the BizTalkMsgBoxDb database.</span></span> <span data-ttu-id="7f36f-147">在此表中，由 AS2From 和 AS2To，MessageID 值，并伴随的 MICHashValue 列唯一标识跟踪 AS2 消息。</span><span class="sxs-lookup"><span data-stu-id="7f36f-147">AS2 messages are tracked in this table, identified uniquely by the AS2From, AS2To, and MessageID values, with an accompanying MICHashValue column.</span></span> <span data-ttu-id="7f36f-148">消息的接收方处理消息负载，和它返回的 MDN 中包括的哈希值时计算 MIC 哈希值。</span><span class="sxs-lookup"><span data-stu-id="7f36f-148">The receiver of the message calculates the MIC hash value when it processes the message payload, and includes the hash value in the MDN that it returns.</span></span> <span data-ttu-id="7f36f-149">原始消息的发件人将比较接收 MDN 中的 MIC 哈希值与将其保存的哈希值。</span><span class="sxs-lookup"><span data-stu-id="7f36f-149">The sender of the original message will compare the MIC hash value in the MDN that it receives with the hash value that it saved.</span></span> <span data-ttu-id="7f36f-150">如果它们匹配，则处置 MDN、 删除 EdiInt_Mic 表中，以及传输中的项是完成。</span><span class="sxs-lookup"><span data-stu-id="7f36f-150">If they match, it disposes of the MDN, deletes the entry in the EdiInt_Mic table, and the transmission is complete.</span></span>  
  
 <span data-ttu-id="7f36f-151">MIC 是 base64 编码。</span><span class="sxs-lookup"><span data-stu-id="7f36f-151">The MIC is base64 encoded.</span></span> <span data-ttu-id="7f36f-152">要将应用于的 MIC 的算法可以是 SHA1 或 MD5。</span><span class="sxs-lookup"><span data-stu-id="7f36f-152">The algorithm to be applied for the MIC can be SHA1 or MD5.</span></span> <span data-ttu-id="7f36f-153">它由**签名算法**下拉列表 (才启用**请求经过签名的 MDN**属性为选中状态) 中**发送方 MDN 设置**单向协议的页在选项卡**协议属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="7f36f-153">It is determined from the **Signing Algorithm** drop-down (enabled if **Request Signed MDN** property is checked) in the **Sender MDN Settings** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="7f36f-154">它还取决于从原始消息的 Signed-receipt-micalg 即用的 AS2 标头。</span><span class="sxs-lookup"><span data-stu-id="7f36f-154">It is also determined from the Signed-Receipt-MICalg AS2 header of the original message.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7f36f-155">请参阅</span><span class="sxs-lookup"><span data-stu-id="7f36f-155">See Also</span></span>  
 <span data-ttu-id="7f36f-156">[AS2 消息](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="7f36f-156">[AS2 Messages](../core/as2-messages.md) </span></span>  
 <span data-ttu-id="7f36f-157">[处理传入 MDN](../core/processing-an-incoming-mdn.md) </span><span class="sxs-lookup"><span data-stu-id="7f36f-157">[Processing an Incoming MDN](../core/processing-an-incoming-mdn.md) </span></span>  
 [<span data-ttu-id="7f36f-158">发送传出 MDN</span><span class="sxs-lookup"><span data-stu-id="7f36f-158">Sending an Outgoing MDN</span></span>](../core/sending-an-outgoing-mdn.md)