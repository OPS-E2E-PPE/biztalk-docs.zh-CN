---
title: MDN 消息 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 16ac6253-0be5-4636-b102-bf5af8956261
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 5a6600237961b59e440a460263a8f4315b2c4773
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22263725"
---
# <a name="mdn-messages"></a><span data-ttu-id="25b2a-102">MDN 消息</span><span class="sxs-lookup"><span data-stu-id="25b2a-102">MDN Messages</span></span>
<span data-ttu-id="25b2a-103">消息处置通知 (MDN) 用于确认已发送 AS2 消息。</span><span class="sxs-lookup"><span data-stu-id="25b2a-103">The Message Disposition Notification (MDN) is the acknowledgment sent in response to an AS2 message.</span></span> <span data-ttu-id="25b2a-104">如果启用了 MDN，则 AS2 传输直到接收并验证 MDN 后才完成。</span><span class="sxs-lookup"><span data-stu-id="25b2a-104">If an MDN is enabled, the AS2 transmission is not complete until the MDN has been received and verified.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="25b2a-105">将始终尝试返回 MDN 以指示消息处理的状态，即使在处理 AS2 消息时出错。</span><span class="sxs-lookup"><span data-stu-id="25b2a-105"> will always attempt to return an MDN to indicate the status of message processing, even if an error occurred in processing the AS2 message.</span></span>  
  
 <span data-ttu-id="25b2a-106">MDN 用于确认以下过程：</span><span class="sxs-lookup"><span data-stu-id="25b2a-106">The MDN provides verification of the following:</span></span>  
  
-   <span data-ttu-id="25b2a-107">**原始消息已成功接收的接收方**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-107">**That the original message was successfully received by the receiving party**.</span></span> <span data-ttu-id="25b2a-108">原始消息的发送方通过比较已发送原始消息的 MessageID 与接收方包括在 MDN 中的 original-message-id 字段来验证这一点。</span><span class="sxs-lookup"><span data-stu-id="25b2a-108">The sender of the original message verifies this by comparing the MessageID of the original sent message with the original-message-id field that the receiver included in the MDN.</span></span>  
  
-   <span data-ttu-id="25b2a-109">**通过接收合作伙伴已验证交换的数据的完整性**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-109">**That the integrity of the data exchanged was verified by the receiving partner**.</span></span> <span data-ttu-id="25b2a-110">原始消息的发件人对此进行验证通过比较计算的原始发送的消息有效负载，使用 MIC，接收方收到的消息负载计算以及 （如果 MDN 的接收时间内容 MIC 字段中包含 MIC签名）。</span><span class="sxs-lookup"><span data-stu-id="25b2a-110">The sender of the original message verifies this by comparing the MIC that was calculated from the original sent message payload, with the MIC that the receiver calculated on the received message payload and included in the Received-content-MIC field of the MDN (if signed).</span></span>  
  
-   <span data-ttu-id="25b2a-111">**是否有不可否认性的回执**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-111">**That there is a non-repudiation of receipt**.</span></span> <span data-ttu-id="25b2a-112">通过使用接收合作伙伴公钥验证签名的 MDN 的发件人执行此操作并通过验证返回的 MIC 值中 MDN 的原始消息负载 MIC 相同存储在不可否认性数据库中。</span><span class="sxs-lookup"><span data-stu-id="25b2a-112">The sender does this by verifying the signed MDN with the receiving partner's public key, and by verifying that the returned MIC value in the MDN is the same as the MIC for the original message payload stored in the non-repudiation database.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="25b2a-113">同步 MDN 可用作 HTTP 响应，例如：200 OK。</span><span class="sxs-lookup"><span data-stu-id="25b2a-113">A synchronous MDN serves as an HTTP Response, e.g., 200 OK.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="25b2a-114">Mdn 的接收方处理的详细信息，请参阅[处理传入 MDN](../core/processing-an-incoming-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="25b2a-114">For more information about receive-side processing of MDNs, see [Processing an Incoming MDN](../core/processing-an-incoming-mdn.md).</span></span> <span data-ttu-id="25b2a-115">Mdn 的发送方处理的详细信息，请参阅[发送传出 MDN](../core/sending-an-outgoing-mdn.md)。</span><span class="sxs-lookup"><span data-stu-id="25b2a-115">For more information about send-side processing of MDNs, see [Sending an Outgoing MDN](../core/sending-an-outgoing-mdn.md).</span></span>  
  
## <a name="properties-used-to-generate-the-mdn"></a><span data-ttu-id="25b2a-116">用于生成 MDN 的属性</span><span class="sxs-lookup"><span data-stu-id="25b2a-116">Properties Used to Generate the MDN</span></span>  
 <span data-ttu-id="25b2a-117">AS2Receive 接收管道将生成使用方的 AS2 协议属性，如果 MDN**使用验证和 MDN 的协议设置，而不是消息标头**中的单向协议选项卡上选择属性**协议属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="25b2a-117">The AS2Receive receive pipeline will generate an MDN using a party's AS2 agreement properties if the **Use agreement settings for validation and MDN instead of message header** property is selected on the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="25b2a-118">在此情况下，AS2-从消息中的属性标头将用来生成 MDN，但其他属性不会执行从方的 AS2 协议设置。</span><span class="sxs-lookup"><span data-stu-id="25b2a-118">In this instance, the AS2-From property in the message header will be used in generating the MDN, but other properties will be taken from the party's AS2 agreement settings.</span></span>  
  
 <span data-ttu-id="25b2a-119">如果未选择的选项重写 AS2 属性，或当事方的 AS2 协议可用，接收管道将生成传入消息中使用 AS2 头标记 MDN。</span><span class="sxs-lookup"><span data-stu-id="25b2a-119">If the option to override AS2 property is not selected, or the party’s AS2 agreement is available, the receive pipeline will generate the MDN using the AS2 header tags in the incoming message.</span></span>  
  
 <span data-ttu-id="25b2a-120">MDN 可进行签名，但不能加密或压缩。</span><span class="sxs-lookup"><span data-stu-id="25b2a-120">An MDN can be signed, but it cannot be encrypted or compressed.</span></span>  
  
## <a name="mdn-context-properties"></a><span data-ttu-id="25b2a-121">MDN 上下文属性</span><span class="sxs-lookup"><span data-stu-id="25b2a-121">MDN Context Properties</span></span>  
 <span data-ttu-id="25b2a-122">处理 MDN 消息时使用的上下文属性包括可以升级的属性以及未公开但可以在已挂起和跟踪的消息中查看的属性。</span><span class="sxs-lookup"><span data-stu-id="25b2a-122">Context properties used in processing MDN messages include properties that can be promoted as well as properties that are not publicly exposed, but can be viewed in suspended and tracked messages.</span></span> <span data-ttu-id="25b2a-123">这些上下文属性的列表，请参阅[AS2 上下文属性](../core/as2-context-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="25b2a-123">For a list of these context properties, see [AS2 Context Properties](../core/as2-context-properties.md).</span></span>  
  
 <span data-ttu-id="25b2a-124">若要生成 MDN，必须同时升级 DispositionMode 和 DispositionType 上下文属性。</span><span class="sxs-lookup"><span data-stu-id="25b2a-124">Both the DispositionMode and DispositionType context properties must be promoted in order for an MDN to be generated.</span></span> <span data-ttu-id="25b2a-125">如果在 AS2 或 EDI 负载中出现错误，则 DispositionType 属性将指示出该错误。</span><span class="sxs-lookup"><span data-stu-id="25b2a-125">If an error occurs in the AS2 or EDI payload, the DispositionType property will indicate the error.</span></span> <span data-ttu-id="25b2a-126">你可以看到在此属性**消息详细信息**（通过服务详细信息对话框中） 中的已挂起服务实例从显示的对话框**组中心数据库**页[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="25b2a-126">You can see this property in the **Message Details** dialog box that is displayed (via the Service Details dialog box) from the Suspended service instances in the **Group Hub** page of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration Console.</span></span> <span data-ttu-id="25b2a-127">如果错误发生在标头，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]将指示 DispositionType 属性中中的错误和将尝试发送 MDN，但根据具体的错误，可能不能这样做。</span><span class="sxs-lookup"><span data-stu-id="25b2a-127">If an error occurs in the header, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will indicate the error in the DispositionType property, and will attempt to send the MDN, but depending on the error, may not be able to do so.</span></span>  
  
## <a name="mdn-headers"></a><span data-ttu-id="25b2a-128">MDN 标头</span><span class="sxs-lookup"><span data-stu-id="25b2a-128">MDN Headers</span></span>  
 <span data-ttu-id="25b2a-129">MDN 包含下列标头：</span><span class="sxs-lookup"><span data-stu-id="25b2a-129">The MDN contains the following headers:</span></span>  
  
-   <span data-ttu-id="25b2a-130">**HTTP/AS2 标头**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-130">**HTTP/AS2 headers**.</span></span> <span data-ttu-id="25b2a-131">有关详细信息，请参阅[AS2 消息](../core/as2-messages.md)。</span><span class="sxs-lookup"><span data-stu-id="25b2a-131">For more information, see [AS2 Messages](../core/as2-messages.md).</span></span>  
  
-   <span data-ttu-id="25b2a-132">**传输层**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-132">**Transfer Layer**.</span></span> <span data-ttu-id="25b2a-133">这包括内容类型标头，其中包括签名的多部分消息、MIC 的算法、签名格式化协议以及最外面的多部分边界子标头。</span><span class="sxs-lookup"><span data-stu-id="25b2a-133">This includes the Content-Type header that includes the signed multipart message, the algorithm for the MIC, the signature formatting protocol, and the outermost multipart boundary sub-headers.</span></span>  
  
-   <span data-ttu-id="25b2a-134">**第一次部件**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-134">**First Part**.</span></span> <span data-ttu-id="25b2a-135">多部分签名消息的第一部分是嵌入式 MDN。</span><span class="sxs-lookup"><span data-stu-id="25b2a-135">The first part of the multipart signed message is the embedded MDN.</span></span> <span data-ttu-id="25b2a-136">它是人工可读取的。</span><span class="sxs-lookup"><span data-stu-id="25b2a-136">It is human readable.</span></span>  
  
-   <span data-ttu-id="25b2a-137">**第二个一部分**。</span><span class="sxs-lookup"><span data-stu-id="25b2a-137">**Second Part**.</span></span> <span data-ttu-id="25b2a-138">多部分签名消息的第二部分包含数字签名、原始消息的引用、处置类型和状态、MIC 值。</span><span class="sxs-lookup"><span data-stu-id="25b2a-138">The second part of the multipart signed message contains the digital signature, a reference to the original message, the disposition type and status, and the MIC value.</span></span> <span data-ttu-id="25b2a-139">它是机器可读取的。</span><span class="sxs-lookup"><span data-stu-id="25b2a-139">It is machine readable.</span></span>  
  
 <span data-ttu-id="25b2a-140">AS2-From 标头、AS2-To 标头和 MessageID 上下文属性用于将 MDN 与其要做出响应的 AS2 消息相关联。</span><span class="sxs-lookup"><span data-stu-id="25b2a-140">The AS2-From header, AS2-To header, and MessageID context property are used to correlate an MDN to the AS2 message that it is responding to.</span></span> <span data-ttu-id="25b2a-141">MDN 中的 Original-Message-ID 标头来自 MDN 所响应的 AS2 消息的 Message-ID 标头。</span><span class="sxs-lookup"><span data-stu-id="25b2a-141">The Original-Message-ID header in an MDN comes from the Message-ID header of the AS2 message that the MDN is responding to.</span></span>  
  
## <a name="mic"></a><span data-ttu-id="25b2a-142">MIC</span><span class="sxs-lookup"><span data-stu-id="25b2a-142">MIC</span></span>  
 <span data-ttu-id="25b2a-143">消息完整性检查 (MIC) 用于验证 MDN 对应于原始发送的消息有效负载。</span><span class="sxs-lookup"><span data-stu-id="25b2a-143">The Message Integrity Check (MIC) is used to verify that an MDN correlates to the original sent message payload.</span></span> <span data-ttu-id="25b2a-144">MIC 摘要包括在多部分签名 MDN 消息的第二部分中的 Received-Content-MIC 扩展字段中。</span><span class="sxs-lookup"><span data-stu-id="25b2a-144">The MIC digest is included in the Received-Content-MIC extension field in the second part of the multipart signed MDN message.</span></span>  
  
 <span data-ttu-id="25b2a-145">如果已启用 MDN，则当 AS2 发送管道处理出站消息时，它将通过相应的消息负载计算 MICHashValue。</span><span class="sxs-lookup"><span data-stu-id="25b2a-145">If an MDN is enabled, when the AS2 send pipeline processes an outbound message, it computes a MICHashValue from the message payload.</span></span> <span data-ttu-id="25b2a-146">该发送管道在 BizTalkMsgBoxDb 数据库的 EdiInt_Mic 表中保存哈希值。</span><span class="sxs-lookup"><span data-stu-id="25b2a-146">The send pipeline saves the hash value in the EdiInt_Mic table of the BizTalkMsgBoxDb database.</span></span> <span data-ttu-id="25b2a-147">系统在此表中跟踪 AS2 消息，并使用 AS2From、AS2To 和 MessageID 值和伴随的 MICHashValue 列唯一标识这些消息。</span><span class="sxs-lookup"><span data-stu-id="25b2a-147">AS2 messages are tracked in this table, identified uniquely by the AS2From, AS2To, and MessageID values, with an accompanying MICHashValue column.</span></span> <span data-ttu-id="25b2a-148">消息的接收方在处理消息负载时计算 MIC 哈希值，并在它返回的 MDN 中包括该哈希值。</span><span class="sxs-lookup"><span data-stu-id="25b2a-148">The receiver of the message calculates the MIC hash value when it processes the message payload, and includes the hash value in the MDN that it returns.</span></span> <span data-ttu-id="25b2a-149">原始消息的发送方将把它接收的 MDN 中的 MIC 哈希值与它所保存的哈希值相比较。</span><span class="sxs-lookup"><span data-stu-id="25b2a-149">The sender of the original message will compare the MIC hash value in the MDN that it receives with the hash value that it saved.</span></span> <span data-ttu-id="25b2a-150">如果这两个值相匹配，则处置 MDN、删除 EdiInt_Mic 表中的条目，传输将完成。</span><span class="sxs-lookup"><span data-stu-id="25b2a-150">If they match, it disposes of the MDN, deletes the entry in the EdiInt_Mic table, and the transmission is complete.</span></span>  
  
 <span data-ttu-id="25b2a-151">MIC 是 base64 编码的。</span><span class="sxs-lookup"><span data-stu-id="25b2a-151">The MIC is base64 encoded.</span></span> <span data-ttu-id="25b2a-152">对 MIC 可使用 SHA1 或 MD5 算法。</span><span class="sxs-lookup"><span data-stu-id="25b2a-152">The algorithm to be applied for the MIC can be SHA1 or MD5.</span></span> <span data-ttu-id="25b2a-153">取决于**签名算法**下拉列表 (如果已启用**请求签名的 MDN**检查属性) 中**发件人 MDN 设置**的单向协议页选项卡中**协议属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="25b2a-153">It is determined from the **Signing Algorithm** drop-down (enabled if **Request Signed MDN** property is checked) in the **Sender MDN Settings** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="25b2a-154">也可通过原始消息的 Signed-Receipt-MICalg AS2 标头来确定。</span><span class="sxs-lookup"><span data-stu-id="25b2a-154">It is also determined from the Signed-Receipt-MICalg AS2 header of the original message.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25b2a-155">另请参阅</span><span class="sxs-lookup"><span data-stu-id="25b2a-155">See Also</span></span>  
 <span data-ttu-id="25b2a-156">[AS2 消息](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="25b2a-156">[AS2 Messages](../core/as2-messages.md) </span></span>  
 <span data-ttu-id="25b2a-157">[处理传入的 MDN](../core/processing-an-incoming-mdn.md) </span><span class="sxs-lookup"><span data-stu-id="25b2a-157">[Processing an Incoming MDN](../core/processing-an-incoming-mdn.md) </span></span>  
 [<span data-ttu-id="25b2a-158">发送传出 MDN</span><span class="sxs-lookup"><span data-stu-id="25b2a-158">Sending an Outgoing MDN</span></span>](../core/sending-an-outgoing-mdn.md)