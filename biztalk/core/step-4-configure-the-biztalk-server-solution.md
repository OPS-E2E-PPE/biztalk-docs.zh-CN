---
title: 步骤 4：配置 BizTalk Server 解决方案 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d60e6a82-51af-41e5-a755-5f337492ba2f
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 5d2d0e2c04fb11432f85821ec3e5ac4b65c490b6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65392533"
---
# <a name="step-4-configure-the-biztalk-server-solution"></a><span data-ttu-id="c57f0-102">步骤 4：配置 BizTalk Server 解决方案</span><span class="sxs-lookup"><span data-stu-id="c57f0-102">Step 4: Configure the BizTalk Server Solution</span></span>
<span data-ttu-id="c57f0-103">在上一步骤中，创建和部署[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]应用程序以 Salesforce 通知接收到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]和插入本地 SQL Server 数据库的详细信息。</span><span class="sxs-lookup"><span data-stu-id="c57f0-103">In the previous step, you created and deployed a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application to receive Salesforce notification into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and insert the details into an on-premise SQL Server database.</span></span> <span data-ttu-id="c57f0-104">在此步骤中，我们将配置中的应用程序[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="c57f0-104">In this step, we’ll configure the application in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="c57f0-105">配置应用程序主要涉及创建对应于我们在业务流程中创建的逻辑端口的物理端口。</span><span class="sxs-lookup"><span data-stu-id="c57f0-105">Configuring the application primarily involves creating physical ports corresponding to the logical ports we created in the orchestration.</span></span> <span data-ttu-id="c57f0-106">它还涉及将物理端口绑定到逻辑端口。</span><span class="sxs-lookup"><span data-stu-id="c57f0-106">It also involves binding the physical port to the logical ports.</span></span> <span data-ttu-id="c57f0-107">我们将执行以下步骤以配置[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]应用程序：</span><span class="sxs-lookup"><span data-stu-id="c57f0-107">We’ll perform the following steps to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application:</span></span>  
  
- <span data-ttu-id="c57f0-108">配置请求-响应 Wcf-basichttprelay 接收位置以接收来自 Salesforce 的机会通知。</span><span class="sxs-lookup"><span data-stu-id="c57f0-108">Configure a request-response WCF-BasicHttpRelay receive location to receive opportunity notifications from Salesforce.</span></span>  
  
- <span data-ttu-id="c57f0-109">配置请求-响应 Wcf-webhttp 发送端口用于向 Salesforce 发送查询，用于检索与收到的机会通知相关的产品详细信息。</span><span class="sxs-lookup"><span data-stu-id="c57f0-109">Configure a request-response WCF-WebHttp send port to send query to Salesforce for retrieving product details related to the received opportunity notification.</span></span> <span data-ttu-id="c57f0-110">此发送端口还从 Salesforce 接收查询响应。</span><span class="sxs-lookup"><span data-stu-id="c57f0-110">This send port also receives the query response from Salesforce.</span></span>  
  
- <span data-ttu-id="c57f0-111">配置单向 WCF-SQL 发送端口以从 Salesforce 查询响应插入到本地 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="c57f0-111">Configure a one-way WCF-SQL send port to insert the query response from Salesforce into an on-premise SQL Server database.</span></span>  
  
- <span data-ttu-id="c57f0-112">配置[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]应用程序将在业务流程中的逻辑端口与中创建的物理端口相关联[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="c57f0-112">Configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application by associating the logical port in the orchestration with the physical ports created in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span>  
  
### <a name="to-configure-the-wcf-basichttprelay-receive-location"></a><span data-ttu-id="c57f0-113">配置 Wcf-basichttprelay 接收位置</span><span class="sxs-lookup"><span data-stu-id="c57f0-113">To configure the WCF-BasicHttpRelay receive location</span></span>  
  
1. <span data-ttu-id="c57f0-114">打开[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="c57f0-114">Open the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="c57f0-115">展开应用程序节点并查找**SalesforceIntegration**应用程序。</span><span class="sxs-lookup"><span data-stu-id="c57f0-115">Expand the Applications node and look for the **SalesforceIntegration** application.</span></span> <span data-ttu-id="c57f0-116">在部署时创建此应用程序[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]从 Visual Studio 项目。</span><span class="sxs-lookup"><span data-stu-id="c57f0-116">This application is created when you deployed the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project from Visual Studio.</span></span>  
  
2. <span data-ttu-id="c57f0-117">展开**SalesforceIntegration**应用程序中，右键单击**接收端口**，指向**新建**，然后单击**请求-响应接收端口**.</span><span class="sxs-lookup"><span data-stu-id="c57f0-117">Expand the **SalesforceIntegration** application, right-click **Receive Ports**, point to **New**, and then click **Request-Response Receive Port**.</span></span> <span data-ttu-id="c57f0-118">将端口名称指定为`ReceiveOppNotification`，然后从左窗格中，单击**接收位置**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-118">Specify the port name as `ReceiveOppNotification` and from the left-pane, click **Receive Locations**.</span></span>  
  
3. <span data-ttu-id="c57f0-119">在接收位置属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-119">In the Receive Location Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="c57f0-120">“属性”</span><span class="sxs-lookup"><span data-stu-id="c57f0-120">Name</span></span>|<span data-ttu-id="c57f0-121">输入`ReceiveOppNotification`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-121">Enter `ReceiveOppNotification`.</span></span>|  
   |<span data-ttu-id="c57f0-122">类型</span><span class="sxs-lookup"><span data-stu-id="c57f0-122">Type</span></span>|<span data-ttu-id="c57f0-123">选择**Wcf-basichttprelay**</span><span class="sxs-lookup"><span data-stu-id="c57f0-123">Select **WCF-BasicHttpRelay**</span></span>|  
   |<span data-ttu-id="c57f0-124">接收处理程序</span><span class="sxs-lookup"><span data-stu-id="c57f0-124">Receive Handler</span></span>|<span data-ttu-id="c57f0-125">Select **BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="c57f0-125">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="c57f0-126">接收管道</span><span class="sxs-lookup"><span data-stu-id="c57f0-126">Receive Pipeline</span></span>|<span data-ttu-id="c57f0-127">选择**XMLReceive**</span><span class="sxs-lookup"><span data-stu-id="c57f0-127">Select **XMLReceive**</span></span>|  
   |<span data-ttu-id="c57f0-128">发送管道</span><span class="sxs-lookup"><span data-stu-id="c57f0-128">Send Pipeline</span></span>|<span data-ttu-id="c57f0-129">选择**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="c57f0-129">Select **PassThruTransmit**</span></span>|  
  
    <span data-ttu-id="c57f0-130">单击**配置**针对端口类型。</span><span class="sxs-lookup"><span data-stu-id="c57f0-130">Click **Configure** against the port type.</span></span>  
  
4. <span data-ttu-id="c57f0-131">在 Wcf-basichttprelay 传输属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-131">In the WCF-BasicHttpRelay Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="c57f0-132">上**常规**选项卡上，对于**地址 (URI)**，输入`https://btssalesforce.servicebus.windows.net/notifications/opportunity`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-132">On the **General** tab, for **Address (URI)**, enter `https://btssalesforce.servicebus.windows.net/notifications/opportunity`.</span></span> <span data-ttu-id="c57f0-133">在这里， **btssalesforce**是命名空间中创建[步骤 1:创建服务总线 Namespace](../core/step-1-create-a-service-bus-namespace.md)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-133">Here, **btssalesforce** is namespace you created in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md).</span></span> <span data-ttu-id="c57f0-134">下面是在 Salesforce 中创建工作流时指定的相同 URL 指定的 URL[步骤 2:设置 Salesforce 系统](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-134">The URL you specify here is the same URL you specified while creating a workflow in Salesforce in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span> <span data-ttu-id="c57f0-135">设置工作流在其中每次将机会的阶段设置为已结束-赢得 Salesforce 发送通知到的 URL *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>*。</span><span class="sxs-lookup"><span data-stu-id="c57f0-135">You set up a workflow in which every time the stage of an opportunity is set to Closed Won, Salesforce sends a notification to the URL *<https://btssalesforce.servicebus.windows.net/notifications/opportunity>*.</span></span> <span data-ttu-id="c57f0-136">我们指定相同的 URL 作为此过程中接收位置配置。</span><span class="sxs-lookup"><span data-stu-id="c57f0-136">We specify the same URL here as part of this receive location configuration.</span></span> <span data-ttu-id="c57f0-137">启用接收位置后，在创建中继终结点 URL 指定[!INCLUDE[winazure](../includes/winazure-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="c57f0-137">When the receive location is enabled, the relay endpoint specified by the URL is created in [!INCLUDE[winazure](../includes/winazure-md.md)].</span></span>  
  
   2. <span data-ttu-id="c57f0-138">上**安全**选项卡上，指定以下内容：</span><span class="sxs-lookup"><span data-stu-id="c57f0-138">On the **Security** tab, specify the following:</span></span>  
  
      -   <span data-ttu-id="c57f0-139">有关**安全模式**，选择**传输**对于**中继客户端身份验证类型**，选择**无**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-139">For **Security mode**, select **Transport** and for **Relay client authentication type**, select **None**.</span></span>  
  
      -   <span data-ttu-id="c57f0-140">选择**启用服务发现**复选框可将发布中的服务行为[服务注册表](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-140">Select the **Enable service discovery** check box to publish the service behavior in the [Service Registry](http://msdn.microsoft.com/library/windowsazure/dd582704.aspx).</span></span> <span data-ttu-id="c57f0-141">指定**显示名称**该项表示与该服务发布到注册表的名称。</span><span class="sxs-lookup"><span data-stu-id="c57f0-141">Specify the **Display name** which denotes the name with which the service is published to the registry.</span></span> <span data-ttu-id="c57f0-142">可以设置**发现模式**向公有或私有。</span><span class="sxs-lookup"><span data-stu-id="c57f0-142">You can set the **Discovery mode** to public or private.</span></span> <span data-ttu-id="c57f0-143">对于本教程中，设置**显示名称**到`SF Outbound Notification`并**发现模式**到**公共**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-143">For this tutorial, set **Display name** to `SF Outbound Notification` and **Discovery mode** to **Public**.</span></span>  
  
      -   <span data-ttu-id="c57f0-144">在访问控制服务框下单击**编辑**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-144">Under Access control service box, click **Edit**.</span></span> <span data-ttu-id="c57f0-145">有关**访问控制服务 STS Uri**，输入`https://btssalesforce-sb.accesscontrol.windows.net/`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-145">For **Access Control Service STS Uri**, enter `https://btssalesforce-sb.accesscontrol.windows.net/`.</span></span> <span data-ttu-id="c57f0-146">有关**颁发者名称**并**颁发者密钥**，输入中保存的值[步骤 1:创建服务总线 Namespace](../core/step-1-create-a-service-bus-namespace.md)有关**默认用户**并**默认密钥**字段。</span><span class="sxs-lookup"><span data-stu-id="c57f0-146">For **Issuer Name** and **Issuer Key**, enter the values that you saved in [Step 1: Create a Service Bus Namespace](../core/step-1-create-a-service-bus-namespace.md) for **Default User** and **Default Key** fields.</span></span>  
  
   3. <span data-ttu-id="c57f0-147">单击**确定**直到您退出所有打开的对话框。</span><span class="sxs-lookup"><span data-stu-id="c57f0-147">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-webhttp-send-port"></a><span data-ttu-id="c57f0-148">若要配置 Wcf-webhttp 发送端口</span><span class="sxs-lookup"><span data-stu-id="c57f0-148">To configure the WCF-WebHttp send port</span></span>  
  
1. <span data-ttu-id="c57f0-149">展开**SalesforceIntegration**应用程序中，右键单击**发送端口**，指向**新建**，然后单击**静态要求响应发送端口**.</span><span class="sxs-lookup"><span data-stu-id="c57f0-149">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static Solicit-Response Send Port**.</span></span>  
  
2. <span data-ttu-id="c57f0-150">在发送端口属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-150">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
   |||  
   |-|-|  
   |<span data-ttu-id="c57f0-151">“属性”</span><span class="sxs-lookup"><span data-stu-id="c57f0-151">Name</span></span>|<span data-ttu-id="c57f0-152">输入`SalesforceREST`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-152">Enter `SalesforceREST`.</span></span>|  
   |<span data-ttu-id="c57f0-153">类型</span><span class="sxs-lookup"><span data-stu-id="c57f0-153">Type</span></span>|<span data-ttu-id="c57f0-154">选择**的 Wcf-webhttp**</span><span class="sxs-lookup"><span data-stu-id="c57f0-154">Select **WCF-WebHttp**</span></span>|  
   |<span data-ttu-id="c57f0-155">发送处理程序</span><span class="sxs-lookup"><span data-stu-id="c57f0-155">Send Handler</span></span>|<span data-ttu-id="c57f0-156">Select **BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="c57f0-156">Select **BizTalkServerApplication**</span></span>|  
   |<span data-ttu-id="c57f0-157">发送管道</span><span class="sxs-lookup"><span data-stu-id="c57f0-157">Send Pipeline</span></span>|<span data-ttu-id="c57f0-158">选择**PassThruTransmit**</span><span class="sxs-lookup"><span data-stu-id="c57f0-158">Select **PassThruTransmit**</span></span>|  
   |<span data-ttu-id="c57f0-159">接收管道</span><span class="sxs-lookup"><span data-stu-id="c57f0-159">Receive Pipeline</span></span>|<span data-ttu-id="c57f0-160">选择**AddNamespace**单击对要配置管道的管道的省略号按钮。</span><span class="sxs-lookup"><span data-stu-id="c57f0-160">Select **AddNamespace** and click the ellipsis button against the pipeline to configure the pipeline.</span></span><br /><br /> <span data-ttu-id="c57f0-161">-在**阶段 1:解码**，对于**NamespaceBase**，输入`http://BtsSalesforceIntegration.QueryResult`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-161">-   Under **Stage 1: Decode**, for **NamespaceBase**, enter `http://BtsSalesforceIntegration.QueryResult`.</span></span> <span data-ttu-id="c57f0-162">这是你在中创建的 QueryResult.xsd 架构的命名空间[步骤 3b:使用 Wcf-webhttp 适配器从 Salesforce 检索机会详细信息](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-162">This is the namespace of the QueryResult.xsd schema that you created in [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md).</span></span> <span data-ttu-id="c57f0-163">当**AddNamespace**接收管道从 Salesforce 接收响应，它将此命名空间添加到响应消息。</span><span class="sxs-lookup"><span data-stu-id="c57f0-163">When the **AddNamespace** receive pipeline receives the response from Salesforce, it adds this namespace to the response message.</span></span> <span data-ttu-id="c57f0-164">默认情况下，来自 Salesforce 的响应消息不包括任何命名空间。</span><span class="sxs-lookup"><span data-stu-id="c57f0-164">By default, the response message from Salesforce does not include any namespace.</span></span><br />     <span data-ttu-id="c57f0-165">有关**NamespacePrefix**，输入`sf`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-165">For **NamespacePrefix**, enter `sf`.</span></span><br /><span data-ttu-id="c57f0-166">-在**阶段 2:反汇编**，接受默认值，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-166">-   Under **Stage 2: Disassemble**, accept the default values and then click **OK**.</span></span>|  
  
    <span data-ttu-id="c57f0-167">在发送端口属性对话框中，单击**配置**针对端口类型。</span><span class="sxs-lookup"><span data-stu-id="c57f0-167">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3. <span data-ttu-id="c57f0-168">在 Wcf-webhttp 传输属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-168">In the WCF-WebHttp Transport Properties dialog box, specify the following values:</span></span>  
  
   1. <span data-ttu-id="c57f0-169">在 **“常规”** 选项卡上，请执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="c57f0-169">On the **General** tab, do the following:</span></span>  
  
      - <span data-ttu-id="c57f0-170">有关**地址 (URI)**，输入`https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-170">for **Address (URI)**, enter `https://<Salesforce_instance_name>.salesforce.com/services/data/v24.0`.</span></span> <span data-ttu-id="c57f0-171">必须打开 Salesforce.com 门户的地址栏中复制 https:// 与 Salesforce.com 之间的文本，可以检索 Salesforce 实例名。</span><span class="sxs-lookup"><span data-stu-id="c57f0-171">You can retrieve the Salesforce instance name by copying the text between https:// and Salesforce.com in the address bar where you have the Salesforce.com portal open.</span></span> <span data-ttu-id="c57f0-172">例如，如果 Salesforce 门户中的 URL 是*https://*<em>na15</em>*.salesforce.com/home/home.jsp*，Salesforce 实例名是**na15**.</span><span class="sxs-lookup"><span data-stu-id="c57f0-172">For example, if the URL in the Salesforce portal is *https://*<em>na15</em>*.salesforce.com/home/home.jsp*, the Salesforce instance name is **na15**.</span></span>  
  
      - <span data-ttu-id="c57f0-173">下**HTTP 方法和 URL 映射**框中，指定以下内容：</span><span class="sxs-lookup"><span data-stu-id="c57f0-173">Under **HTTP Method and URL Mapping** box, specify the following:</span></span>  
  
        ```  
        <BtsHttpUrlMapping>  
        <Operation Method="GET" Url="/query?q={VAR}" />  
        </BtsHttpUrlMapping>  
        ```  
  
         <span data-ttu-id="c57f0-174">以下是如何使用此设置，若要查询 Salesforce 以检索有关机会通知的详细信息，我们必须执行 GET 操作在 Salesforce REST 终结点上的 (中的指定**地址**字段) 和追加查询以检索机会详细信息。</span><span class="sxs-lookup"><span data-stu-id="c57f0-174">Here’s how this setting is used— To query Salesforce for retrieving more information about the opportunity notification, we must perform a GET operation on the Salesforce REST endpoint (specified in the **Address** field) and append the query to retrieve the opportunity details.</span></span> <span data-ttu-id="c57f0-175">因此，URL 应如下所示：</span><span class="sxs-lookup"><span data-stu-id="c57f0-175">So, the URL should look like:</span></span>  
  
        ```  
        https://na15.salesforce.com/services/data/v24.0/query?q=<query_string>  
        ```  
  
         <span data-ttu-id="c57f0-176">我们已有作为的一部分的 Salesforce REST 终结点**地址 (URI)** 字段。</span><span class="sxs-lookup"><span data-stu-id="c57f0-176">We already have the Salesforce REST endpoint as part of the **Address (URI)** field.</span></span> <span data-ttu-id="c57f0-177">因此，作为的一部分**HTTP 方法和 URL 映射**属性，我们指定使用 GET 方法并追加 **{VAR}** 为变量。</span><span class="sxs-lookup"><span data-stu-id="c57f0-177">So, as part of **HTTP Method and URL Mapping** property, we specify using the GET method and appending the **{VAR}** as a variable.</span></span>  
  
      - <span data-ttu-id="c57f0-178">在中**Variable**框中，单击**编辑**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-178">In the **Variable Mapping** box, click **Edit**.</span></span> <span data-ttu-id="c57f0-179">在此框，指定如何为值 **{VAR}** 变量推导在运行时。</span><span class="sxs-lookup"><span data-stu-id="c57f0-179">In this box you specify how the value for the **{VAR}** variable is deduced at runtime.</span></span>  
  
         <span data-ttu-id="c57f0-180">在[步骤 3b:使用 Wcf-webhttp 适配器从 Salesforce 检索机会详细信息](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md)，我们升级了 Query 属性，从而导致创建**PropertySchema.xsd**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-180">In [Step 3b: Retrieve Opportunity Details from Salesforce using the WCF-WebHttp Adapter](../core/step-3b-retrieve-opportunities-from-salesforce-using-the-wcf-webhttp-adapter.md), we had promoted the Query property, which resulted in creating a **PropertySchema.xsd**.</span></span> <span data-ttu-id="c57f0-181">我们将使用**查询**该架构，将查询字符串传递的该元素映射到在 URL 中的 {VAR} 变量中的元素。</span><span class="sxs-lookup"><span data-stu-id="c57f0-181">We’ll use the **Query** element in that schema to pass the query string by mapping that element to the {VAR} variable in the URL.</span></span>  
  
         <span data-ttu-id="c57f0-182">在变量映射对话框中，**变量**列中列出的指定更早版本，例如，变量名称**VAR**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-182">In the Variable Mapping dialog box, the **Variable** column lists the name of the variable you specified earlier, for example, **VAR**.</span></span> <span data-ttu-id="c57f0-183">在中**属性名称**列中，指定具有要传递到该变量的查询字符串的已提升属性的名称。</span><span class="sxs-lookup"><span data-stu-id="c57f0-183">In the **Property Name** column, specify the name of the promoted property that has the query string to be passed to the variable.</span></span> <span data-ttu-id="c57f0-184">在本教程中，该属性的名称是**查询**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-184">In this tutorial, that property name is **Query**.</span></span> <span data-ttu-id="c57f0-185">最后，对于**属性 Namespace**，指定的命名空间**PropertySchema.xsd**，这是`https://BtsSalesforceIntegration.PropertySchema`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-185">Finally, for **Property Namespace**, specify the namespace for the **PropertySchema.xsd**, which is `https://BtsSalesforceIntegration.PropertySchema`.</span></span> <span data-ttu-id="c57f0-186">单击“确定” 。</span><span class="sxs-lookup"><span data-stu-id="c57f0-186">Click **OK**.</span></span>  
  
         <span data-ttu-id="c57f0-187">![WCF 的常规选项卡&#45;WebHttp 适配器](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span><span class="sxs-lookup"><span data-stu-id="c57f0-187">![General tab of WCF&#45;WebHttp Adapter](../core/media/bts-sf-webhttp-general.jpg "BTS_SF_WebHttp_General")</span></span>  
  
   2. <span data-ttu-id="c57f0-188">上**安全**选项卡上，对于**安全模式**，选择**传输**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-188">On the **Security** tab, for **Security mode**, select **Transport**.</span></span>  
  
   3. <span data-ttu-id="c57f0-189">上**行为**选项卡上，使用你在中创建的自定义行为[步骤 3d:启用 BizTalk Server 发送和接收来自 Salesforce 的消息](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md)向 Salesforce 进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="c57f0-189">On the **Behavior** tab, use the custom behavior that you created in [Step 3d: Enabling BizTalk Server to Send and Receive Messages from Salesforce](../core/step-3d-enabling-biztalk-server-to-send-and-receive-messages-from-salesforce.md) to authenticate with Salesforce.</span></span> <span data-ttu-id="c57f0-190">若要使用的行为，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="c57f0-190">To use the behavior, do the following:</span></span>  
  
      -   <span data-ttu-id="c57f0-191">右键单击**EndpointBehavior** ，然后选择**将扩展添加**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-191">Right-click **EndpointBehavior** and then select **Add extension**.</span></span>  
  
      -   <span data-ttu-id="c57f0-192">在中**选择行为扩展**对话框中，选择**Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-192">In the **Select Behavior Extension** dialog box, select **Microsoft.BizTalk.Adapter.Behaviors.Demo.Salesforce**.</span></span> <span data-ttu-id="c57f0-193">我们将行为添加到 machine.config 时使用此行为名称。</span><span class="sxs-lookup"><span data-stu-id="c57f0-193">We had used this behavior name while adding the behavior to the machine.config.</span></span>  
  
      -   <span data-ttu-id="c57f0-194">选择新添加的行为，然后指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-194">Select the newly added behavior and then specify the following values:</span></span>  
  
          |||  
          |-|-|  
          |<span data-ttu-id="c57f0-195">consumerKey （必需）</span><span class="sxs-lookup"><span data-stu-id="c57f0-195">consumerKey (Required)</span></span>|<span data-ttu-id="c57f0-196">指定你的 Salesforce 帐户的使用者密钥。</span><span class="sxs-lookup"><span data-stu-id="c57f0-196">Specify the consumer key for your Salesforce account.</span></span> <span data-ttu-id="c57f0-197">可以通过转到在中创建的连接的 Salesforce 应用程序来检索使用者密钥[步骤 2:设置 Salesforce 系统](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-197">You can retrieve the consumer key by going to the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="c57f0-198">consumerSecret （必需）</span><span class="sxs-lookup"><span data-stu-id="c57f0-198">consumerSecret (Required)</span></span>|<span data-ttu-id="c57f0-199">检索使用者机密从 Salesforce 连接的应用程序中创建[步骤 2:设置 Salesforce 系统](../core/step-2-set-up-the-salesforce-system.md)。</span><span class="sxs-lookup"><span data-stu-id="c57f0-199">Retrieve the consumer secret from the Salesforce connected application you created in [Step 2: Set up the Salesforce System](../core/step-2-set-up-the-salesforce-system.md).</span></span>|  
          |<span data-ttu-id="c57f0-200">密码 （必需）</span><span class="sxs-lookup"><span data-stu-id="c57f0-200">Password (Required)</span></span>|<span data-ttu-id="c57f0-201">指定 Salesforce 帐户的密码。</span><span class="sxs-lookup"><span data-stu-id="c57f0-201">Specify the password for the Salesforce account.</span></span> <span data-ttu-id="c57f0-202">若要从第三方应用程序连接到 Salesforce，必须后跟安全令牌格式密码中指定的密码。</span><span class="sxs-lookup"><span data-stu-id="c57f0-202">To connect to Salesforce from a third party application, you must specify the password in the format password followed by the security token.</span></span> <span data-ttu-id="c57f0-203">例如，如果密码不是**密码**和令牌**XXXXXX**，则必须输入`passwordXXXXXX`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-203">For example, if the password is **password** and the token is **XXXXXX**, you must enter `passwordXXXXXX`.</span></span>|  
          |<span data-ttu-id="c57f0-204">sessionTimeout</span><span class="sxs-lookup"><span data-stu-id="c57f0-204">sessionTimeout</span></span>|<span data-ttu-id="c57f0-205">这具有默认值为 300。</span><span class="sxs-lookup"><span data-stu-id="c57f0-205">This has a default value of 300.</span></span>|  
          |<span data-ttu-id="c57f0-206">用户名 （必需）</span><span class="sxs-lookup"><span data-stu-id="c57f0-206">Username (Required)</span></span>|<span data-ttu-id="c57f0-207">指定 Salesforce 开发人员登录帐户。</span><span class="sxs-lookup"><span data-stu-id="c57f0-207">Specify the Salesforce developer login account.</span></span>|  
  
           <span data-ttu-id="c57f0-208">![为 WCF 行为 ' 选项卡&#45;WebHttp 适配器](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span><span class="sxs-lookup"><span data-stu-id="c57f0-208">![Behavior tab for WCF&#45;WebHttp adapter](../core/media/bts-sf-webhttp-behavior.jpg "BTS_SF_WebHttp_Behavior")</span></span>  
  
   4. <span data-ttu-id="c57f0-209">上**消息**选项卡上，在**出站消息**框中，对于**为谓词取消正文**，输入`GET`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-209">On the **Messages** tab, under **Outbound Message** box, for **Suppress Body for Verbs**, enter `GET`.</span></span> <span data-ttu-id="c57f0-210">对于 GET 方法，这可确保没有任何消息负载中发送到 Salesforce 的请求。</span><span class="sxs-lookup"><span data-stu-id="c57f0-210">This ensures for the GET method, there is no message payload in the request being sent to Salesforce.</span></span>  
  
   5. <span data-ttu-id="c57f0-211">单击**确定**直到您退出所有打开的对话框。</span><span class="sxs-lookup"><span data-stu-id="c57f0-211">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-wcf-sql-send-port"></a><span data-ttu-id="c57f0-212">若要配置 WCF-SQL 发送端口</span><span class="sxs-lookup"><span data-stu-id="c57f0-212">To configure the WCF-SQL send port</span></span>  
  
1.  <span data-ttu-id="c57f0-213">展开**SalesforceIntegration**应用程序中，右键单击**发送端口**，指向**新建**，然后单击**静态单向发送端口**.</span><span class="sxs-lookup"><span data-stu-id="c57f0-213">Expand the **SalesforceIntegration** application, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
2.  <span data-ttu-id="c57f0-214">在发送端口属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-214">In the Send Port Properties dialog box, specify the following values:</span></span>  
  
    |||  
    |-|-|  
    |<span data-ttu-id="c57f0-215">“属性”</span><span class="sxs-lookup"><span data-stu-id="c57f0-215">Name</span></span>|<span data-ttu-id="c57f0-216">输入`SendToSQL`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-216">Enter `SendToSQL`.</span></span>|  
    |<span data-ttu-id="c57f0-217">类型</span><span class="sxs-lookup"><span data-stu-id="c57f0-217">Type</span></span>|<span data-ttu-id="c57f0-218">选择**WCF SQL**</span><span class="sxs-lookup"><span data-stu-id="c57f0-218">Select **WCF-SQL**</span></span>|  
    |<span data-ttu-id="c57f0-219">发送处理程序</span><span class="sxs-lookup"><span data-stu-id="c57f0-219">Send Handler</span></span>|<span data-ttu-id="c57f0-220">Select **BizTalkServerApplication**</span><span class="sxs-lookup"><span data-stu-id="c57f0-220">Select **BizTalkServerApplication**</span></span>|  
    |<span data-ttu-id="c57f0-221">发送管道</span><span class="sxs-lookup"><span data-stu-id="c57f0-221">Send Pipeline</span></span>|<span data-ttu-id="c57f0-222">选择**XMLTransmit**</span><span class="sxs-lookup"><span data-stu-id="c57f0-222">Select **XMLTransmit**</span></span>|  
  
     <span data-ttu-id="c57f0-223">在发送端口属性对话框中，单击**配置**针对端口类型。</span><span class="sxs-lookup"><span data-stu-id="c57f0-223">On the Send Port Properties dialog box, click **Configure** against the port type.</span></span>  
  
3.  <span data-ttu-id="c57f0-224">在 WCF-SQL 传输属性对话框中，指定以下值：</span><span class="sxs-lookup"><span data-stu-id="c57f0-224">In the WCF-SQL Transport Properties dialog box, specify the following values:</span></span>  
  
    1.  <span data-ttu-id="c57f0-225">在 **“常规”** 选项卡上，请执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="c57f0-225">On the **General** tab, do the following:</span></span>  
  
        -   <span data-ttu-id="c57f0-226">下`Endpoint Address`，单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-226">Under `Endpoint Address`, click **Configure**.</span></span> <span data-ttu-id="c57f0-227">有关**InitialCatalog**属性，指定包含必须在其中输入 Salesforce 响应中的数据的表的数据库名称。</span><span class="sxs-lookup"><span data-stu-id="c57f0-227">For the **InitialCatalog** property, specify the database name that contains the table where the data from Salesforce response must be entered.</span></span> <span data-ttu-id="c57f0-228">对于本教程中，输入此值作为`Orders`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-228">For this tutorial enter this value as `Orders`.</span></span> <span data-ttu-id="c57f0-229">有关**Server**属性，输入服务器名称安装 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="c57f0-229">For **Server** property, enter the server name where SQL Server database is installed.</span></span>  
  
        -   <span data-ttu-id="c57f0-230">下**SOAP 操作标头**，指定要用于插入操作**OrderDetails**表。</span><span class="sxs-lookup"><span data-stu-id="c57f0-230">Under **SOAP Action header**, specify the action to be used for inserting into the **OrderDetails** table.</span></span> <span data-ttu-id="c57f0-231">必须输入`TableOp/Insert/dbo/OrderDetails`。</span><span class="sxs-lookup"><span data-stu-id="c57f0-231">You must enter `TableOp/Insert/dbo/OrderDetails`.</span></span>  
  
    2.  <span data-ttu-id="c57f0-232">在凭据选项卡上，如果将所有内容留空适配器使用 Windows 身份验证连接到 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="c57f0-232">On the Credentials tab, if you leave everything blank the adapter uses Windows Authentication to connect to the SQL Server database.</span></span> <span data-ttu-id="c57f0-233">如果你想要使用任何其他形式的身份验证，可以指定相关值。</span><span class="sxs-lookup"><span data-stu-id="c57f0-233">If you want to use any other form of authentication, you can specify the relevant values.</span></span>  
  
    3.  <span data-ttu-id="c57f0-234">单击**确定**直到您退出所有打开的对话框。</span><span class="sxs-lookup"><span data-stu-id="c57f0-234">Click **OK** until you exit all open dialog boxes.</span></span>  
  
### <a name="to-configure-the-biztalk-server-application"></a><span data-ttu-id="c57f0-235">若要配置 BizTalk Server 应用程序</span><span class="sxs-lookup"><span data-stu-id="c57f0-235">To configure the BizTalk Server application</span></span>  
  
1. <span data-ttu-id="c57f0-236">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，右键单击**SalesforceIntegration**应用程序，，然后单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-236">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click the **SalesforceIntegration** application, and then click **Configure**.</span></span>  
  
2. <span data-ttu-id="c57f0-237">在配置应用程序对话框中，选择**NotificationServiceClient**业务流程，并在右窗格中执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="c57f0-237">In the Configure Application dialog box, select the **NotificationServiceClient** orchestration, and from the right pane do the following:</span></span>  
  
   1. <span data-ttu-id="c57f0-238">对于主机，选择**BizTalkServerApplication**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-238">For Host, select **BizTalkServerApplication**.</span></span>  
  
   2. <span data-ttu-id="c57f0-239">映射的逻辑接收端口**SalesforceNotificationPort**到物理接收端口， **ReceiveOppNotification**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-239">Map the logical receive port **SalesforceNotificationPort** to the physical receive port, **ReceiveOppNotification**.</span></span>  
  
   3. <span data-ttu-id="c57f0-240">将逻辑发送端口映射**SalesforceRESTInterface**到物理发送端口**SalesforceREST**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-240">Map the logical send port **SalesforceRESTInterface** to the physical send port, **SalesforceREST**.</span></span>  
  
   4. <span data-ttu-id="c57f0-241">将逻辑发送端口映射**SendToSQL**到物理发送端口**SendToSQL**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-241">Map the logical send port **SendToSQL** to the physical send port, **SendToSQL**.</span></span>  
  
      <span data-ttu-id="c57f0-242">单击“确定” 。</span><span class="sxs-lookup"><span data-stu-id="c57f0-242">Click **OK**.</span></span>  
  
3. <span data-ttu-id="c57f0-243">右键单击**SalesforceIntegration**应用程序，然后单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="c57f0-243">Right-click the **SalesforceIntegration** application and then click **Start**.</span></span> <span data-ttu-id="c57f0-244">这将启动**NotificationServiceClient**业务流程，启用该接收位置，并启动发送端口。</span><span class="sxs-lookup"><span data-stu-id="c57f0-244">This starts the **NotificationServiceClient** orchestration, enables the receive location, and starts the send port.</span></span>  
  
   <span data-ttu-id="c57f0-245">在本主题中，我们完成了配置中的解决方案[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]通过将业务流程中的逻辑端口与物理端口相关联的管理控制台。</span><span class="sxs-lookup"><span data-stu-id="c57f0-245">In this topic, we finished configuring the solution in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console by associating the logical ports in the orchestration with the physical ports.</span></span>