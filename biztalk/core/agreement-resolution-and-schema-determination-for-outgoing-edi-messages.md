---
title: 协议解析和架构确定传出 EDI 消息的 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e37aeb9d-1e95-464d-bb71-73653c1d4674
caps.latest.revision: 24
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a718f386686b8a23bc8c97108b94b5fba717ee90
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36992022"
---
# <a name="agreement-resolution-and-schema-determination-for-outgoing-edi-messages"></a><span data-ttu-id="663e7-102">传出 EDI 消息的协议解析和架构确定</span><span class="sxs-lookup"><span data-stu-id="663e7-102">Agreement Resolution and Schema Determination for Outgoing EDI Messages</span></span>
<span data-ttu-id="663e7-103">若要向贸易合作伙伴生成 EDI 消息，EDI 发送管道必须执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="663e7-103">To generate an EDI message to a trading partner, the EDI send pipeline must do the following:</span></span>  
  
-   <span data-ttu-id="663e7-104">确定消息解析为的协议</span><span class="sxs-lookup"><span data-stu-id="663e7-104">Determine the agreement that the message resolves to</span></span>  
  
-   <span data-ttu-id="663e7-105">确定要用于验证消息的架构</span><span class="sxs-lookup"><span data-stu-id="663e7-105">Determine the schema to use to validate the message</span></span>  
  
## <a name="agreement-resolution"></a><span data-ttu-id="663e7-106">协议解析</span><span class="sxs-lookup"><span data-stu-id="663e7-106">Agreement Resolution</span></span>  
 <span data-ttu-id="663e7-107">EDI 发送管道执行一系列步骤，确定传出交换和协议属性是否匹配，进而查找协议。</span><span class="sxs-lookup"><span data-stu-id="663e7-107">The EDI send pipeline performs agreement lookup by performing a series of steps to determine whether there is a match between the outgoing interchange and the properties of an agreement.</span></span> <span data-ttu-id="663e7-108">一旦 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 确定协议，便可确定适用于交换的文档架构（见下文）。</span><span class="sxs-lookup"><span data-stu-id="663e7-108">Once [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] has determined the agreement, it determines the document schema that applies to the interchange (see below).</span></span> <span data-ttu-id="663e7-109">它使用与匹配协议关联的属性及相关架构来生成并验证传出消息。</span><span class="sxs-lookup"><span data-stu-id="663e7-109">It uses the properties associated with the matching agreement and the relevant schema to generate and validate the outgoing message.</span></span>  
  
 <span data-ttu-id="663e7-110">若要执行协议解析，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 将按照以下方式继续进行操作：</span><span class="sxs-lookup"><span data-stu-id="663e7-110">To perform agreement resolution, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] proceeds as follows:</span></span>  
  
1. <span data-ttu-id="663e7-111">通过将 AgreementPartIDForSend 上下文属性与单向协议的 ID 相匹配来解析协议。</span><span class="sxs-lookup"><span data-stu-id="663e7-111">Resolves the agreement by matching the AgreementPartIDForSend context property with the ID of the one-way agreement.</span></span> <span data-ttu-id="663e7-112">此属性应为整数类型，此属性可以在自定义组件中进行设置，它并不是由 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 设置的。</span><span class="sxs-lookup"><span data-stu-id="663e7-112">This property should be an integer type, it can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
2. <span data-ttu-id="663e7-113">如果第 1 步不成功，通过与协议属性的所有以下三个上下文属性进行匹配来解析协议： AgreementNameForSend、 SenderPartyNameForSend、 ReceiverPartyNameForSend。</span><span class="sxs-lookup"><span data-stu-id="663e7-113">If step 1 does not succeed, resolves the agreement by matching all the following three context properties with the agreement properties: AgreementNameForSend, SenderPartyNameForSend, ReceiverPartyNameForSend.</span></span> <span data-ttu-id="663e7-114">请注意，要成功解析为协议，这三个属性都必须要设置。</span><span class="sxs-lookup"><span data-stu-id="663e7-114">Note that all the three properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="663e7-115">这些属性可以在自定义组件中进行设置，它们并不是由 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 设置的。</span><span class="sxs-lookup"><span data-stu-id="663e7-115">These properties can be set in a custom component; it is not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
3. <span data-ttu-id="663e7-116">如果第 2 步不成功，则解析协议通过匹配的参与方名称与 DestinationPartyName 属性设置为中的其他协议解析程序将消息上下文属性中**标识符**选项卡协议属性。</span><span class="sxs-lookup"><span data-stu-id="663e7-116">If step 2 does not succeed, resolves the agreement by matching the party name in the message context properties with the DestinationPartyName property, which is set as additional agreement resolver in the **Identifiers** tab of agreement properties.</span></span>  
  
4. <span data-ttu-id="663e7-117">如果第 3 步不成功，则通过将消息上下文中的下列属性与协议属性中的这些属性进行匹配来解析协议：DestinationPartySenderIdentifier、DestinationPartySenderQualifier、DestinationPartyReceiverIdentifier 和 DestinationPartyReceiverQualifier。</span><span class="sxs-lookup"><span data-stu-id="663e7-117">If step 3 does not succeed, resolves the agreement by matching the following properties in the context of a message with those in agreement properties: DestinationPartySenderIdentifier, DestinationPartySenderQualifier, DestinationPartyReceiverIdentifier, and DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="663e7-118">请注意，要成功解析为协议，所有这四个属性都必须设置。</span><span class="sxs-lookup"><span data-stu-id="663e7-118">Note that all the four properties must be set in order to successfully resolve to an agreement.</span></span> <span data-ttu-id="663e7-119">这些属性可以设置在自定义组件;它们不通过设置[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="663e7-119">These properties can be set in a custom component; they are not set by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="663e7-120">有关详细信息，请参阅下面。</span><span class="sxs-lookup"><span data-stu-id="663e7-120">For more information, see below.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="663e7-121">如果上述任何上下文属性集经过升级，且 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 无法找到与这些上下文属性关联的协议，则 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 将挂起此消息。</span><span class="sxs-lookup"><span data-stu-id="663e7-121">If any of the above sets of context properties are promoted and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is unable to find an agreement associated with those context properties, then [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] suspends the message.</span></span>  
   > 
   >  <span data-ttu-id="663e7-122">如果用户有意编写一组上下文属性的协议解析和冲突解决程序不能确定 OnewayAgreement，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="663e7-122">If the user intentionally writes a set of context properties for agreement resolution, and if the resolver fails to identify the OnewayAgreement, then the message is suspended.</span></span> <span data-ttu-id="663e7-123">失败时要解析为协议根据一组上下文属性，相应的警告消息引发的事件日志中。</span><span class="sxs-lookup"><span data-stu-id="663e7-123">On failure to resolve to an agreement based on a set of context properties, a corresponding warning message is thrown in the EventLog.</span></span>  
  
5. <span data-ttu-id="663e7-124">如果步骤 4 没成功，或上述上下文属性均未升级，则通过将订阅该消息的发送端口与协议关联的发送端口进行匹配，EDI 消息会解析为一条协议。</span><span class="sxs-lookup"><span data-stu-id="663e7-124">If step 4 does not succeed or none of the above context properties are promoted, then the EDI message is resolved to an agreement by matching the send port that subscribed to the message with the send port associated with an agreement.</span></span>  
  
   > [!NOTE]
   >  <span data-ttu-id="663e7-125">如果同一发送端口与多个协议关联，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 将生成错误。</span><span class="sxs-lookup"><span data-stu-id="663e7-125">If the same send port is associated with multiple agreements, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will generate an error.</span></span>  
  
6. <span data-ttu-id="663e7-126">如果在步骤 1、2、3 或 4 中找不到协议，则发送管道将使用备用协议设置生成传出消息。</span><span class="sxs-lookup"><span data-stu-id="663e7-126">If no agreement is found in steps 1, 2, 3, or 4, the send pipeline uses the fallback agreement settings to generate the outgoing message.</span></span>  
  
   <span data-ttu-id="663e7-127">**通过匹配发送方和接收方上下文属性的协议解析**</span><span class="sxs-lookup"><span data-stu-id="663e7-127">**Agreement Resolution by Matching Sender and Receiver Context Properties**</span></span>  
  
   <span data-ttu-id="663e7-128">在上面第二个步骤中，在匹配中使用的四个上下文属性是 EDI。DestinationPartySenderIdentifier，EDI。DestinationPartySenderQualifier，EDI。DestinationPartyReceiverIdentifier 和 EDI。DestinationPartyReceiverQualifier。</span><span class="sxs-lookup"><span data-stu-id="663e7-128">In the second step above, the four context properties used in the match are EDI.DestinationPartySenderIdentifier, EDI.DestinationPartySenderQualifier, EDI.DestinationPartyReceiverIdentifier, and EDI.DestinationPartyReceiverQualifier.</span></span> <span data-ttu-id="663e7-129">这些上下文属性的命名空间是 `http://schemas.microsoft.com/Edi/PropertySchema`。</span><span class="sxs-lookup"><span data-stu-id="663e7-129">The namespace for these context properties is `http://schemas.microsoft.com/Edi/PropertySchema`.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="663e7-130"> 尝试进行匹配的相关发送方和接收方的标识符和限定符的单向协议属性中使用这些值。</span><span class="sxs-lookup"><span data-stu-id="663e7-130"> attempts to match these values with the related sender and receiver identifiers and qualifiers in the one-way agreement properties.</span></span> <span data-ttu-id="663e7-131">对于 X12，这些字段为 ISA05、 ISA06、 ISA07 和在 ISA08**标识符**页中的单向协议选项卡**协议属性**对话框; 对于 EDIFACT，这些字段为 UNB2.1、 UNB2.2，UNB3.1 和 UNB3.2 中的**标识符**页中的单向协议选项卡**协议属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="663e7-131">For X12, these fields are ISA05, ISA06, ISA07, and ISA08 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box; for EDIFACT, these fields are UNB2.1, UNB2.2, UNB3.1, and UNB3.2 in the **Identifiers** page of the one-way agreement tab in the **Agreement Properties** dialog box.</span></span>  
  
   <span data-ttu-id="663e7-132">若要使用所有四个发送方和接收方的标识符和限定符启用发送端协议解析，必须设置所有四个上下文属性。</span><span class="sxs-lookup"><span data-stu-id="663e7-132">To enable send-side agreement resolution using all four sender and receiver identifiers and qualifiers, you will have to set all four context properties.</span></span> <span data-ttu-id="663e7-133">以唯一方式执行此操作可标识协议。</span><span class="sxs-lookup"><span data-stu-id="663e7-133">Doing so uniquely identifies the agreement.</span></span> <span data-ttu-id="663e7-134">使用上述协议查找方法可以更灵活地执行发送端处理。</span><span class="sxs-lookup"><span data-stu-id="663e7-134">Using this method of agreement lookup gives you more flexibility in send-side processing.</span></span> <span data-ttu-id="663e7-135">例如，此方法可以让您以避免在某些情况下，创建多个发送端口并避免复杂的发送端口筛选器。</span><span class="sxs-lookup"><span data-stu-id="663e7-135">For example, this method may enable you to avoid creating multiple send ports in some circumstances, and to avoid complicated send port filters.</span></span> <span data-ttu-id="663e7-136">同时，您还可以根据需要避免设置 OneWayAgreementId 属性。</span><span class="sxs-lookup"><span data-stu-id="663e7-136">It also enables you to avoid setting the OneWayAgreementId property, if desired.</span></span>  
  
   <span data-ttu-id="663e7-137">如果已将所有四个上下文属性设置为一条消息，并且这些上下文属性和属性属性之间不存在任何匹配，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="663e7-137">If all four context properties have been set for a message, and no match is found between those context properties and the property properties, the message is suspended.</span></span> <span data-ttu-id="663e7-138">仅在尚未设置所有四个上下文属性时，才会使用与协议关联的发送端口解析该协议。</span><span class="sxs-lookup"><span data-stu-id="663e7-138">The agreement will be resolved using the send port associated with an agreement only if all four context properties have not been set.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="663e7-139">EDI 管道中的消息将转到协议解析中的后续步骤，直到该消息在协议处于启用状态的情况下通过相应步骤得到解析。</span><span class="sxs-lookup"><span data-stu-id="663e7-139">A message in the EDI pipeline goes to the succeeding step in Agreement Resolution till the message gets resolved with the step having Agreement in enable state.</span></span> <span data-ttu-id="663e7-140">例如，如果消息在协议解析的第一步中得到解析，但协议处于禁用状态，则消息将转到后续步骤进行解析。</span><span class="sxs-lookup"><span data-stu-id="663e7-140">For example, if the message gets resolved in the first step of Agreement Resolution but the Agreement is in a disabled state then the message goes to the succeeding step for resolution.</span></span>  
  
## <a name="schema-determination"></a><span data-ttu-id="663e7-141">架构确定</span><span class="sxs-lookup"><span data-stu-id="663e7-141">Schema Determination</span></span>  
 <span data-ttu-id="663e7-142">EDI 发送管道可确定适用于消息的架构名称和每个事务集 （作为文档类型信息或在根节点） 的中间 XML 文件中包含的架构命名空间中的架构。</span><span class="sxs-lookup"><span data-stu-id="663e7-142">The EDI send pipeline determines the schema that applies to the message from the schema name and schema namespace contained in the intermediate XML file for each transaction set (either as doc type information or in the root node).</span></span>  
  
 <span data-ttu-id="663e7-143">对于交换，已被预留，发送管道使用中间 XML 文件的完整交换的设置在单个事务中的文档类型信息。</span><span class="sxs-lookup"><span data-stu-id="663e7-143">For an interchange that has been preserved, the send pipeline uses the doc type information in the individual transaction sets of the intermediate XML file for the complete interchange.</span></span> <span data-ttu-id="663e7-144">它使用控制段架构进行处理的信封段。</span><span class="sxs-lookup"><span data-stu-id="663e7-144">It uses the control segment schemas for processing the envelope segments.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="663e7-145">请参阅</span><span class="sxs-lookup"><span data-stu-id="663e7-145">See Also</span></span>  
 [<span data-ttu-id="663e7-146">BizTalk Server 如何发送 EDI 消息</span><span class="sxs-lookup"><span data-stu-id="663e7-146">How BizTalk Server Sends EDI Messages</span></span>](../core/how-biztalk-server-sends-edi-messages.md)