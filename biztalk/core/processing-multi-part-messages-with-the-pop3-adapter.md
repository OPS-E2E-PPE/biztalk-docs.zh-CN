---
title: 使用 POP3 适配器处理多部分消息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 56ad041f-f155-4c1c-ab87-1405c80d9b68
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 68c02f7a5bded3ccffa60ae7327297342ffdc0d6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65396977"
---
# <a name="processing-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="75004-102">使用 POP3 适配器处理多部分消息</span><span class="sxs-lookup"><span data-stu-id="75004-102">Processing Multi Part Messages with the POP3 Adapter</span></span>
<span data-ttu-id="75004-103">POP3 适配器可以处理符合 IETF 标准中所述的 MIME 编码的消息[RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810)， [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811)，并[RFC 最多允许 2047年](http://go.microsoft.com/fwlink/?LinkId=58812)。</span><span class="sxs-lookup"><span data-stu-id="75004-103">The POP3 Adapter can process MIME-encoded messages that conform to the IETF standards documented in [RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810), [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811), and [RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812).</span></span> <span data-ttu-id="75004-104">MIME 编码的消息可以包含一到使用不同的内容类型的许多部件。</span><span class="sxs-lookup"><span data-stu-id="75004-104">MIME encoded messages can have from one to many parts with different content types.</span></span> <span data-ttu-id="75004-105">本主题讨论如何 POP3 适配器处理多部分 MIME 编码消息。</span><span class="sxs-lookup"><span data-stu-id="75004-105">This topic discusses the how the POP3 adapter processes multi part MIME encoded messages.</span></span>  
  
## <a name="receiving-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="75004-106">使用 POP3 适配器接收多部分消息</span><span class="sxs-lookup"><span data-stu-id="75004-106">Receiving Multi part Messages with the POP3 Adapter</span></span>  
 <span data-ttu-id="75004-107">使用 POP3 适配器的接收位置是否**应用 MIME 解码**选项设置为**True**然后 POP3 适配器接收的 MIME 编码消息时将执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="75004-107">If a receive location that uses the POP3 adapter has the **Apply MIME Decoding** option set to **True** then the POP3 adapter performs the following actions when receiving a MIME-encoded message:</span></span>  
  
1.  <span data-ttu-id="75004-108">从其接收的 MIME 编码消息各部分创建多部分 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="75004-108">Creates a multi part BizTalk message from the parts of the MIME encoded message that it receives.</span></span> <span data-ttu-id="75004-109">此多部分消息可以包含一到多个部分，并且将包含接收的 MIME 编码消息相同的部分数。</span><span class="sxs-lookup"><span data-stu-id="75004-109">This multi part message can contain from 1 to many parts and will contain the same number of parts as the MIME encoded message that is received.</span></span>  
  
2.  <span data-ttu-id="75004-110">扫描 MIME 编码消息的标头。</span><span class="sxs-lookup"><span data-stu-id="75004-110">Scans the headers of the MIME encoded message.</span></span> <span data-ttu-id="75004-111">如果任何标头与匹配的主题中描述的属性列表[POP3 适配器属性架构和属性](../core/pop3-adapter-property-schema-and-properties.md)然后这些标头升级到多部分 BizTalk 消息上下文属性为。</span><span class="sxs-lookup"><span data-stu-id="75004-111">If any headers match the list of properties documented in the topic [POP3 Adapter Property Schema and Properties](../core/pop3-adapter-property-schema-and-properties.md) then these headers are promoted to the multi part BizTalk message as context properties.</span></span>  
  
3.  <span data-ttu-id="75004-112">使用可配置的算法来指定的 MIME 编码消息部分作为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-112">Uses a configurable algorithm to designate one of the parts of the MIME encoded message as the BizTalk message body part.</span></span> <span data-ttu-id="75004-113">用于确定哪个消息部分将 BizTalk 消息正文部分的算法部分所述下面**POP3 适配器使用的正文部分选择算法**。</span><span class="sxs-lookup"><span data-stu-id="75004-113">The algorithm used to determine which message part will be the BizTalk message body part is described below in the section **Body Part Selection Algorithm Used by the POP3 Adapter**.</span></span>  
  
4.  <span data-ttu-id="75004-114">将多部分 BizTalk 消息发布到 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="75004-114">Publishes the multi part BizTalk message to the MessageBox.</span></span>  
  
## <a name="body-part-selection-algorithm-used-by-the-pop3-adapter"></a><span data-ttu-id="75004-115">POP3 适配器使用的正文部分选择算法</span><span class="sxs-lookup"><span data-stu-id="75004-115">Body Part Selection Algorithm Used by the POP3 Adapter</span></span>  
 <span data-ttu-id="75004-116">当 POP3 适配器从其接收的 MIME 编码消息的各部分创建多部分 BizTalk 消息时，它选择一个消息部分作为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-116">When the POP3 adapter creates a multipart BizTalk message from the parts of the MIME-encoded message that it receives, it selects one of the message parts as the BizTalk message body part.</span></span> <span data-ttu-id="75004-117">消息验证、 映射、 属性升级、 平面文件的程序集和其他操作等工作，BizTalk Server 使用 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-117">The BizTalk message body part is used by BizTalk Server for things such as message validation, mapping, property promotion, flat file assembly and other operations.</span></span> <span data-ttu-id="75004-118">多部分 BizTalk 消息的订阅服务器接收所有消息部分，但将只使用指定的 BizTalk 消息正文部分，除非使用业务流程、 自定义管道或适配器，它可以理解多部分消息。</span><span class="sxs-lookup"><span data-stu-id="75004-118">Subscribers to a multi part BizTalk message receive all of the message parts but will only consume the designated BizTalk message body part unless using an orchestration, a custom pipeline, or an adapter that can understand multi part messages.</span></span> <span data-ttu-id="75004-119">例如，可以配置业务流程可读取多部分消息; 的所有部分SMTP 适配器可以读取的所有部件的多部分消息，并可以将自定义管道配置为使用 MIME/SMIME 编码器管道组件。</span><span class="sxs-lookup"><span data-stu-id="75004-119">For example, you can configure an orchestration to read all parts of multi part message; the SMTP adapter can read all of the parts of a multi part message, and a custom pipeline can be configured to use the MIME/SMIME encoder pipeline component.</span></span> <span data-ttu-id="75004-120">有关使用业务流程使用多部分消息的详细信息请参阅以下部分**业务流程中处理多部分消息**。</span><span class="sxs-lookup"><span data-stu-id="75004-120">For more information about using an orchestration to consume a multi part message see the section below, **Processing Multi Part Messages in Orchestrations**.</span></span>  
  
 <span data-ttu-id="75004-121">POP3 适配器从可用正文部分基于为提供的值中选择 BizTalk 消息正文部分**正文部分索引**并**正文部分内容类型**。</span><span class="sxs-lookup"><span data-stu-id="75004-121">The POP3 adapter selects the BizTalk message body part from the available body parts based upon the values supplied for the **Body Part Index** and the **Body Part Content Type**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="75004-122">POP3 适配器专门识别中定义正文部分内容类型[RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569)。</span><span class="sxs-lookup"><span data-stu-id="75004-122">The POP3 adapter is designed to recognize the Body Part Content Types that are defined in [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569).</span></span>  
  
 <span data-ttu-id="75004-123">用于选择电子邮件的 BizTalk 消息正文部分的算法如下所述：</span><span class="sxs-lookup"><span data-stu-id="75004-123">The algorithm that is used to select the BizTalk message body part of an e-mail is described below:</span></span>  
  
1.  <span data-ttu-id="75004-124">如果**正文部分索引**设置为 0，**正文部分内容类型**为空，则使用以下算法来选择 BizTalk 消息正文部分：</span><span class="sxs-lookup"><span data-stu-id="75004-124">If the **Body Part Index** is set to 0 and the **Body Part Content Type** is blank then the following algorithm is used to select the BizTalk message body part:</span></span>  
  
    -   <span data-ttu-id="75004-125">设置为"body"的内容说明标头，使用第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="75004-125">Use the first MIME part with the Content-Description header set to "body".</span></span>  
  
    -   <span data-ttu-id="75004-126">否则，第一个 MIME 部分使用设置为"text/xml"的内容类型标头。</span><span class="sxs-lookup"><span data-stu-id="75004-126">Otherwise use the first MIME part with the Content-Type header set to "text/xml".</span></span>  
  
    -   <span data-ttu-id="75004-127">否则，第一个 MIME 部分使用设置为"text/plain"的内容类型标头。</span><span class="sxs-lookup"><span data-stu-id="75004-127">Otherwise use the first MIME part with the Content-Type header set to "text/plain".</span></span>  
  
    -   <span data-ttu-id="75004-128">否则，第一个 MIME 部分使用内容类型标头设置为"text /"。</span><span class="sxs-lookup"><span data-stu-id="75004-128">Otherwise use the first MIME part with the Content-Type header set to "text/".</span></span>  
  
    -   <span data-ttu-id="75004-129">否则使用第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="75004-129">Otherwise use the first MIME part.</span></span>  
  
2.  <span data-ttu-id="75004-130">否则为如果**正文部分索引**设置为 0，**正文部分内容类型**为集，则匹配所指定的传入消息的第一个正文部分**正文部分内容类型**选为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-130">Otherwise if the **Body Part Index** is set to 0 and the **Body Part Content Type** is set, then the first body part of the incoming message that matches the specified **Body Part Content Type** is selected as the BizTalk message body part.</span></span> <span data-ttu-id="75004-131">如果没有具有匹配的内容类型的部件会挂起消息。</span><span class="sxs-lookup"><span data-stu-id="75004-131">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
3.  <span data-ttu-id="75004-132">否则为如果**正文部分索引**设置为值大于 0 并**正文部分内容类型**为空，则选择具有指定索引的正文部分作为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-132">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is blank, then the body part with the specified index is selected as the BizTalk message body part.</span></span> <span data-ttu-id="75004-133">如果指定的索引大于正文部分的数量会挂起消息。</span><span class="sxs-lookup"><span data-stu-id="75004-133">If the specified index is greater than the number of body parts then the message is suspended.</span></span>  
  
4.  <span data-ttu-id="75004-134">否则为如果**正文部分索引**设置为值大于 0 并**正文部分内容类型**设置，则**正文部分索引**，才会应用为正文部分具有指定**正文部分内容类型**并选择相应的正文部分作为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-134">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is set, then the **Body Part Index** is only applied to those body parts that match the specified **Body Part Content Type** and the corresponding body part is selected as the BizTalk message body part.</span></span> <span data-ttu-id="75004-135">如果指定的索引大于具有匹配的内容类型的部分数会挂起消息。</span><span class="sxs-lookup"><span data-stu-id="75004-135">If the specified index is greater than the number of parts with a matching content type then the message is suspended.</span></span> <span data-ttu-id="75004-136">如果没有具有匹配的内容类型的部件会挂起消息。</span><span class="sxs-lookup"><span data-stu-id="75004-136">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
5.  <span data-ttu-id="75004-137">BizTalk 消息正文部分变得多部分 BizTalk 消息发布到 MessageBox 的第一个部分所选的部分，该消息的其余部分保持顺序在原始 MIME 编码的消息所具有的。</span><span class="sxs-lookup"><span data-stu-id="75004-137">The part that is selected as the BizTalk message body part becomes the first part of the multi part BizTalk message that is published to the MessageBox, the remaining parts of the message maintain the order that they had in the original MIME encoded message.</span></span>  
  
## <a name="processing-multi-part-messages-in-orchestrations"></a><span data-ttu-id="75004-138">处理业务流程中的多部分消息</span><span class="sxs-lookup"><span data-stu-id="75004-138">Processing Multi Part Messages in Orchestrations</span></span>  
 <span data-ttu-id="75004-139">当 POP3 适配器从其接收的 MIME 编码消息创建多部分 BizTalk 消息时，所有部件被发布到 MessageBox 数据库中，即使只有其中一个部分指定为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="75004-139">When the POP3 adapter creates a multi part BizTalk message from a MIME encoded message that it receives, all of the parts are published to the MessageBox database even though only one of the parts is designated as the BizTalk message body part.</span></span> <span data-ttu-id="75004-140">订阅多部分消息的业务流程可以随后使用这些部件。</span><span class="sxs-lookup"><span data-stu-id="75004-140">These parts can be subsequently consumed by an orchestration that subscribes to the multi part message.</span></span> <span data-ttu-id="75004-141">处理业务流程中的多部分消息时，本部分将介绍一些注意事项。</span><span class="sxs-lookup"><span data-stu-id="75004-141">This section documents some considerations when processing multi part messages in an orchestration.</span></span>  
  
### <a name="processing-multi-part-messages-with-a-known-number-of-parts-and-known-part-types"></a><span data-ttu-id="75004-142">处理具有已知数量的部件和已知的部分类型的多部分消息</span><span class="sxs-lookup"><span data-stu-id="75004-142">Processing multi part messages with a known number of parts and known part types</span></span>  
 <span data-ttu-id="75004-143">如果业务流程将要接收具有已知部分数和已知的部分类型的多部分消息然后可以声明一个业务流程中的多部分消息，并在设计时设置部分和部件类型的数量。</span><span class="sxs-lookup"><span data-stu-id="75004-143">If your orchestration is receiving a multi part message with a known number of parts and known part types then you can declare a multi part message in the orchestration and set the number of parts and part types at design time.</span></span>  
  
### <a name="processing-multi-part-messages-with-unknown-part-types"></a><span data-ttu-id="75004-144">处理多部分消息具有未知的部分类型</span><span class="sxs-lookup"><span data-stu-id="75004-144">Processing multi part messages with unknown part types</span></span>  
 <span data-ttu-id="75004-145">如果业务流程将要接收具有未知的部分类型的多部分消息，则可以声明多部分消息中的业务流程和使用**XmlDocument**的每个部分的类型是未知的类型。</span><span class="sxs-lookup"><span data-stu-id="75004-145">If your orchestration is receiving a multi part message with unknown part types then you can declare a multi part message in the orchestration and use the **XmlDocument** type for each of the parts for which the type is unknown.</span></span>  
  
### <a name="processing-multi-part-messages-with-an-unknown-number-of-parts-and-all-of-the-part-types-are-unknown"></a><span data-ttu-id="75004-146">处理多部分消息具有未知的部分数和所有部件类型是未知</span><span class="sxs-lookup"><span data-stu-id="75004-146">Processing multi part messages with an unknown number of parts and all of the part types are unknown</span></span>  
 <span data-ttu-id="75004-147">如果业务流程将要接收具有未知部分数多部分消息，则可以声明多部分消息的单个部分**XmlDocument**业务流程中的类型，用于接收消息。</span><span class="sxs-lookup"><span data-stu-id="75004-147">If your orchestration is receiving a multi part message with an unknown number of parts then you can declare a multi part message with a single part of the **XmlDocument** type in the orchestration to receive the message.</span></span> <span data-ttu-id="75004-148">如果收到包含多于声明部分数量更多部分消息，则业务流程引擎读取有多少个部分是在消息中，然后构造正确的部分类型的部件的匹配部分中声明的消息数类型，然后构造**XmlDocument**部件的剩余部分。</span><span class="sxs-lookup"><span data-stu-id="75004-148">If a multi part message that contains greater than the number of declared parts is received, the orchestration engine reads how many parts there are in the message, then constructs the proper part types for the parts that match the number of parts in the declared message type and then constructs **XmlDocument** parts for the remaining parts.</span></span>