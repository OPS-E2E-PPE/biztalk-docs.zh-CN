---
title: "处理多部分消息使用 POP3 适配器 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 56ad041f-f155-4c1c-ab87-1405c80d9b68
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 26aff4569414103ad8c4f37a9e4699a85874e481
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="processing-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="789d4-102">使用 POP3 适配器处理多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-102">Processing Multi Part Messages with the POP3 Adapter</span></span>
<span data-ttu-id="789d4-103">POP3 适配器可以处理符合 IETF 标准中所述的 MIME 编码消息[RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810)， [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811)，和[RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812)。</span><span class="sxs-lookup"><span data-stu-id="789d4-103">The POP3 Adapter can process MIME-encoded messages that conform to the IETF standards documented in [RFC 2045](http://go.microsoft.com/fwlink/?LinkId=58810), [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=58811), and [RFC 2047](http://go.microsoft.com/fwlink/?LinkId=58812).</span></span> <span data-ttu-id="789d4-104">MIME 编码的消息可以只包含一个部分，也可以包含多个部分且各部分具有不同的内容类型。</span><span class="sxs-lookup"><span data-stu-id="789d4-104">MIME encoded messages can have from one to many parts with different content types.</span></span> <span data-ttu-id="789d4-105">本主题介绍 POP3 适配器将如何处理多部分 MIME 编码的消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-105">This topic discusses the how the POP3 adapter processes multi part MIME encoded messages.</span></span>  
  
## <a name="receiving-multi-part-messages-with-the-pop3-adapter"></a><span data-ttu-id="789d4-106">使用 POP3 适配器接收多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-106">Receiving Multi part Messages with the POP3 Adapter</span></span>  
 <span data-ttu-id="789d4-107">如果具有使用 POP3 适配器接收位置**应用 MIME 解码**选项设置为**True**然后 POP3 适配器接收 MIME 编码消息时执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="789d4-107">If a receive location that uses the POP3 adapter has the **Apply MIME Decoding** option set to **True** then the POP3 adapter performs the following actions when receiving a MIME-encoded message:</span></span>  
  
1.  <span data-ttu-id="789d4-108">从其接收的 MIME 编码消息的各部分创建一个多部分 BizTalk 消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-108">Creates a multi part BizTalk message from the parts of the MIME encoded message that it receives.</span></span> <span data-ttu-id="789d4-109">此多部分消息可包含一到多个部分，并且所包含的部分数与接收到的 MIME 编码消息相同。</span><span class="sxs-lookup"><span data-stu-id="789d4-109">This multi part message can contain from 1 to many parts and will contain the same number of parts as the MIME encoded message that is received.</span></span>  
  
2.  <span data-ttu-id="789d4-110">扫描 MIME 编码消息的标头。</span><span class="sxs-lookup"><span data-stu-id="789d4-110">Scans the headers of the MIME encoded message.</span></span> <span data-ttu-id="789d4-111">如果任何标头与匹配的记录在该主题的属性列表[POP3 适配器属性架构和属性](../core/pop3-adapter-property-schema-and-properties.md)然后这些标头将被提升到多一部分 BizTalk 消息作为上下文属性。</span><span class="sxs-lookup"><span data-stu-id="789d4-111">If any headers match the list of properties documented in the topic [POP3 Adapter Property Schema and Properties](../core/pop3-adapter-property-schema-and-properties.md) then these headers are promoted to the multi part BizTalk message as context properties.</span></span>  
  
3.  <span data-ttu-id="789d4-112">使用一个可配置的算法，将 MIME 编码消息中的一个部分指定为 BizTalk 消息的正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-112">Uses a configurable algorithm to designate one of the parts of the MIME encoded message as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-113">用来确定哪些消息部分将 BizTalk 消息正文部分的算法节所述下面**POP3 适配器使用的正文部分选择算法**。</span><span class="sxs-lookup"><span data-stu-id="789d4-113">The algorithm used to determine which message part will be the BizTalk message body part is described below in the section **Body Part Selection Algorithm Used by the POP3 Adapter**.</span></span>  
  
4.  <span data-ttu-id="789d4-114">将多部分 BizTalk 消息发布到 MessageBox。</span><span class="sxs-lookup"><span data-stu-id="789d4-114">Publishes the multi part BizTalk message to the MessageBox.</span></span>  
  
## <a name="body-part-selection-algorithm-used-by-the-pop3-adapter"></a><span data-ttu-id="789d4-115">POP3 适配器使用的正文部分选择算法</span><span class="sxs-lookup"><span data-stu-id="789d4-115">Body Part Selection Algorithm Used by the POP3 Adapter</span></span>  
 <span data-ttu-id="789d4-116">当 POP3 适配器从其接收的 MIME 编码消息的各部分创建一个多部分 BizTalk 消息时，它将选择其中的一个消息部分作为 BizTalk 消息的正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-116">When the POP3 adapter creates a multipart BizTalk message from the parts of the MIME-encoded message that it receives, it selects one of the message parts as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-117">BizTalk Server 将使用 BizTalk 消息正文部分来执行消息验证、映射、属性升级、平面文件组装等操作。</span><span class="sxs-lookup"><span data-stu-id="789d4-117">The BizTalk message body part is used by BizTalk Server for things such as message validation, mapping, property promotion, flat file assembly and other operations.</span></span> <span data-ttu-id="789d4-118">多部分 BizTalk 消息的订户将接收所有的消息部分，但除非使用可以理解多部分消息的业务流程、自定义管道或适配器，它将只使用指定的 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-118">Subscribers to a multi part BizTalk message receive all of the message parts but will only consume the designated BizTalk message body part unless using an orchestration, a custom pipeline, or an adapter that can understand multi part messages.</span></span> <span data-ttu-id="789d4-119">例如，您可以配置业务流程，使其读取多部分消息的所有部分。SMTP 适配器可以读取多部分消息的所有部分。您也可以配置一个自定义管道，使其使用 MIME/SMIME 编码器管道组件。</span><span class="sxs-lookup"><span data-stu-id="789d4-119">For example, you can configure an orchestration to read all parts of multi part message; the SMTP adapter can read all of the parts of a multi part message, and a custom pipeline can be configured to use the MIME/SMIME encoder pipeline component.</span></span> <span data-ttu-id="789d4-120">有关使用业务流程使用多部分消息的详细信息请参阅以下部分，**在业务流程中处理多部分消息**。</span><span class="sxs-lookup"><span data-stu-id="789d4-120">For more information about using an orchestration to consume a multi part message see the section below, **Processing Multi Part Messages in Orchestrations**.</span></span>  
  
 <span data-ttu-id="789d4-121">POP3 适配器从可用的正文部分基于为提供的值选择 BizTalk 消息正文部分**正文部分索引**和**正文部分内容类型**。</span><span class="sxs-lookup"><span data-stu-id="789d4-121">The POP3 adapter selects the BizTalk message body part from the available body parts based upon the values supplied for the **Body Part Index** and the **Body Part Content Type**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="789d4-122">POP3 适配器旨在识别中定义正文部分内容类型[RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569)。</span><span class="sxs-lookup"><span data-stu-id="789d4-122">The POP3 adapter is designed to recognize the Body Part Content Types that are defined in [RFC 2046](http://go.microsoft.com/fwlink/?LinkId=119569).</span></span>  
  
 <span data-ttu-id="789d4-123">下面介绍了用于选择电子邮件的 BizTalk 消息正文部分的算法：</span><span class="sxs-lookup"><span data-stu-id="789d4-123">The algorithm that is used to select the BizTalk message body part of an e-mail is described below:</span></span>  
  
1.  <span data-ttu-id="789d4-124">如果**正文部分索引**设置为 0 和**正文部分内容类型**为空，则将使用以下算法选择 BizTalk 消息正文部分：</span><span class="sxs-lookup"><span data-stu-id="789d4-124">If the **Body Part Index** is set to 0 and the **Body Part Content Type** is blank then the following algorithm is used to select the BizTalk message body part:</span></span>  
  
    -   <span data-ttu-id="789d4-125">使用内容说明标头设置为“body”的第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-125">Use the first MIME part with the Content-Description header set to "body".</span></span>  
  
    -   <span data-ttu-id="789d4-126">否则，使用内容类型标头设置为“text/xml”的第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-126">Otherwise use the first MIME part with the Content-Type header set to "text/xml".</span></span>  
  
    -   <span data-ttu-id="789d4-127">否则，使用内容类型标头设置为“text/plain”的第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-127">Otherwise use the first MIME part with the Content-Type header set to "text/plain".</span></span>  
  
    -   <span data-ttu-id="789d4-128">否则，使用内容类型标头设置为“text/”的第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-128">Otherwise use the first MIME part with the Content-Type header set to "text/".</span></span>  
  
    -   <span data-ttu-id="789d4-129">否则，使用第一个 MIME 部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-129">Otherwise use the first MIME part.</span></span>  
  
2.  <span data-ttu-id="789d4-130">否则为如果**正文部分索引**设置为 0 和**正文部分内容类型**是设置，那么匹配所指定的传入消息的第一个正文部分**正文部分内容类型**被选为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-130">Otherwise if the **Body Part Index** is set to 0 and the **Body Part Content Type** is set, then the first body part of the incoming message that matches the specified **Body Part Content Type** is selected as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-131">如果所有部分的内容类型均不与指定的正文部分内容类型匹配，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-131">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
3.  <span data-ttu-id="789d4-132">否则为如果**正文部分索引**设置为值大于 0 和**正文部分内容类型**为空，则具有指定索引的正文部分被选为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-132">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is blank, then the body part with the specified index is selected as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-133">如果指定的索引大于正文部分的数量，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-133">If the specified index is greater than the number of body parts then the message is suspended.</span></span>  
  
4.  <span data-ttu-id="789d4-134">否则为如果**正文部分索引**设置为值大于 0 和**正文部分内容类型**设置，则**正文部分索引**仅应用到那些正文部分具有指定**正文部分内容类型**和相应的正文部分被选为 BizTalk 消息正文部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-134">Otherwise if the **Body Part Index** is set to a value greater than 0 and the **Body Part Content Type** is set, then the **Body Part Index** is only applied to those body parts that match the specified **Body Part Content Type** and the corresponding body part is selected as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-135">如果指定的索引大于具有匹配内容类型的部分的数量，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-135">If the specified index is greater than the number of parts with a matching content type then the message is suspended.</span></span> <span data-ttu-id="789d4-136">如果所有部分的内容类型均不与指定的正文部分内容类型匹配，则挂起消息。</span><span class="sxs-lookup"><span data-stu-id="789d4-136">If there are no parts with a matching content type then the message is suspended.</span></span>  
  
5.  <span data-ttu-id="789d4-137">选择作为 BizTalk 消息正文部分的部分将被首先发布到 MessageBox，其余的多部分 BizTalk 消息部分则保持其在原始 MIME 编码消息中的顺序。</span><span class="sxs-lookup"><span data-stu-id="789d4-137">The part that is selected as the BizTalk message body part becomes the first part of the multi part BizTalk message that is published to the MessageBox, the remaining parts of the message maintain the order that they had in the original MIME encoded message.</span></span>  
  
## <a name="processing-multi-part-messages-in-orchestrations"></a><span data-ttu-id="789d4-138">在业务流程中处理多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-138">Processing Multi Part Messages in Orchestrations</span></span>  
 <span data-ttu-id="789d4-139">当 POP3 适配器从其接收的 MIME 编码消息创建多部分 BizTalk 消息时，会将所有部分发布到 MessageBox 数据库，即使只有其中一个部分被指定为 BizTalk 消息正文部分，也会发布所有部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-139">When the POP3 adapter creates a multi part BizTalk message from a MIME encoded message that it receives, all of the parts are published to the MessageBox database even though only one of the parts is designated as the BizTalk message body part.</span></span> <span data-ttu-id="789d4-140">随后，订阅多部分消息的业务流程就可以使用这些部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-140">These parts can be subsequently consumed by an orchestration that subscribes to the multi part message.</span></span> <span data-ttu-id="789d4-141">本部分说明了一些在业务流程中处理多部分消息时应注意的事项。</span><span class="sxs-lookup"><span data-stu-id="789d4-141">This section documents some considerations when processing multi part messages in an orchestration.</span></span>  
  
### <a name="processing-multi-part-messages-with-a-known-number-of-parts-and-known-part-types"></a><span data-ttu-id="789d4-142">处理部分数和部分类型已知的多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-142">Processing multi part messages with a known number of parts and known part types</span></span>  
 <span data-ttu-id="789d4-143">如果业务流程将要接收具有已知部分数和已知部分类型的多部分消息，则可以选择在业务流程中声明一个多部分消息，并在设计时设置部分数和部分类型。</span><span class="sxs-lookup"><span data-stu-id="789d4-143">If your orchestration is receiving a multi part message with a known number of parts and known part types then you can declare a multi part message in the orchestration and set the number of parts and part types at design time.</span></span>  
  
### <a name="processing-multi-part-messages-with-unknown-part-types"></a><span data-ttu-id="789d4-144">处理部分类型未知的多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-144">Processing multi part messages with unknown part types</span></span>  
 <span data-ttu-id="789d4-145">如果您的业务流程接收具有未知的部件类型的多部分消息，则你可以声明中的业务流程和使用多部分消息**XmlDocument**的每个部分的类型是未知的类型。</span><span class="sxs-lookup"><span data-stu-id="789d4-145">If your orchestration is receiving a multi part message with unknown part types then you can declare a multi part message in the orchestration and use the **XmlDocument** type for each of the parts for which the type is unknown.</span></span>  
  
### <a name="processing-multi-part-messages-with-an-unknown-number-of-parts-and-all-of-the-part-types-are-unknown"></a><span data-ttu-id="789d4-146">处理部分数和所有部分类型均未知的多部分消息</span><span class="sxs-lookup"><span data-stu-id="789d4-146">Processing multi part messages with an unknown number of parts and all of the part types are unknown</span></span>  
 <span data-ttu-id="789d4-147">如果您的业务流程接收未知数量的部件的多部分消息，则你可以声明的单个部件的多部分消息**XmlDocument**业务流程中要接收消息的类型。</span><span class="sxs-lookup"><span data-stu-id="789d4-147">If your orchestration is receiving a multi part message with an unknown number of parts then you can declare a multi part message with a single part of the **XmlDocument** type in the orchestration to receive the message.</span></span> <span data-ttu-id="789d4-148">如果收到包含大于的声明部分数多部分消息时，有多少个部分是在消息中，业务流程引擎读取然后构造中声明的消息的部件的数量匹配的部件的正确部件类型类型，然后构造**XmlDocument**部件的其余部分。</span><span class="sxs-lookup"><span data-stu-id="789d4-148">If a multi part message that contains greater than the number of declared parts is received, the orchestration engine reads how many parts there are in the message, then constructs the proper part types for the parts that match the number of parts in the declared message type and then constructs **XmlDocument** parts for the remaining parts.</span></span>