---
title: 使用失败消息路由 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
f1_keywords:
- bts10.ops.tsroutingfailure
ms.assetid: d081934c-600e-44ce-8ba4-fb646d494589
caps.latest.revision: 33
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2de325312d81ba5b4d666d47c0af829835dc764d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65247210"
---
# <a name="using-failed-message-routing"></a><span data-ttu-id="cf2a8-102">使用失败的消息路由</span><span class="sxs-lookup"><span data-stu-id="cf2a8-102">Using Failed Message Routing</span></span>
<span data-ttu-id="cf2a8-103">使用错误处理功能，设计者可以指定对消息传送失败进行自动处理，以此作为将失败消息放在挂起队列中的传统（现在是默认）行为的替换选择。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-103">The error-handling facility allows the designer to designate automated handling of messaging failures as an alternative to the traditional (now default) behavior of placing failed messages in the Suspended queue.</span></span> <span data-ttu-id="cf2a8-104">此自动处理方式会将错误消息路由到任何订阅路由目标（例如发送端口或业务流程）。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-104">This automated handling routes an error message to any subscribing routing destination, such as a send port or orchestration.</span></span> <span data-ttu-id="cf2a8-105">错误消息是原始消息的克隆，其中以前升级的所有属性将降级，与特定消息传送失败相关的所选属性将升级到消息上下文。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-105">The error message is a clone of the original message with all previously promoted properties now demoted and with selected properties related to the specific messaging failure promoted to the message context.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="cf2a8-106">失败消息包含原始消息的副本。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-106">Failed messages contain a copy of the original message.</span></span> <span data-ttu-id="cf2a8-107">如果原始消息包含敏感信息，则应当设计手动和自动失败消息处理，以避免意外泄漏这些信息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-107">If the original message contains sensitive information, design your manual and automatic failed message processes so that they avoid accidental disclosure.</span></span>  
  
## <a name="what-does-failed-message-routing-consist-of"></a><span data-ttu-id="cf2a8-108">失败消息路由由哪些部分组成？</span><span class="sxs-lookup"><span data-stu-id="cf2a8-108">What Does Failed Message Routing Consist Of?</span></span>  
 <span data-ttu-id="cf2a8-109">启用失败消息路由后，BizTalk Server 不会挂起消息，而是路由消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-109">When failed message routing is enabled, BizTalk Server does not suspend the message—it routes the message instead.</span></span> <span data-ttu-id="cf2a8-110">可以在接收端口和发送端口上都启用失败消息路由，其结果如下：</span><span class="sxs-lookup"><span data-stu-id="cf2a8-110">Failed message routing can be enabled on both receive and send ports, with the following results:</span></span>  
  
- <span data-ttu-id="cf2a8-111">如果在接收端口上启用失败消息路由，并且消息在接收管道或路由中失败，则会生成失败消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-111">If failed message routing is enabled on a receive port and a message fails in the receive pipeline or in routing, a failed message is generated.</span></span> <span data-ttu-id="cf2a8-112">在拆装阶段中或拆装阶段之前出现错误的情况下，错误消息是原始交换的克隆。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-112">In the case where an error occurs in or before the disassembly phase, the error message is a clone of the original interchange.</span></span>  
  
- <span data-ttu-id="cf2a8-113">如果在发送端口上启用失败消息路由，并且消息在发送管道中失败，则会生成失败消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-113">If failed message routing is enabled on a send port and the message fails in the send pipeline, a failed message is generated.</span></span>  
  
  <span data-ttu-id="cf2a8-114">生成失败消息时，BizTalk Server 会在发布失败消息之前将与错误报告相关的消息上下文属性升级，并将常规消息上下文属性降级。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-114">When a failed message is generated, BizTalk Server promotes error-report-related message context properties and demotes regular message context properties before publishing the failed message.</span></span> <span data-ttu-id="cf2a8-115">这与默认行为时失败的消息路由未启用：失败的消息被挂起。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-115">Compare this to the default behavior when failed message routing is not enabled: Messages that fail are suspended.</span></span>  
  
## <a name="what-kinds-of-messaging-failures-trigger-an-error-message"></a><span data-ttu-id="cf2a8-116">有哪些种类的消息失败会触发错误消息？</span><span class="sxs-lookup"><span data-stu-id="cf2a8-116">What Kinds of Messaging Failures Trigger an Error Message?</span></span>  
 <span data-ttu-id="cf2a8-117">如果启用了对失败消息的路由，则在适配器处理、管道处理、映射或消息路由过程中所发生的任何故障都将导致错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-117">Any failure that occurs in adapter processing, pipeline processing, mapping, or message routing results in an error message if routing for failed messages is enabled.</span></span> <span data-ttu-id="cf2a8-118">如果从接收端口接收或向发送端口发送业务流程时出现了消息传送错误，则生成的错误消息将与业务流程所绑定的消息端口关联。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-118">When a messaging error occurs while an orchestration is receiving from a receive port or sending to a send port, the resulting error message is associated with the messaging ports to which the orchestration is bound.</span></span>  
  
## <a name="subscribing-to-an-error-message"></a><span data-ttu-id="cf2a8-119">订阅错误消息</span><span class="sxs-lookup"><span data-stu-id="cf2a8-119">Subscribing to an Error Message</span></span>  
 <span data-ttu-id="cf2a8-120">错误消息将传送到已订阅接收它们的业务流程或发送端口。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-120">Error messages are delivered to orchestrations or send ports that have subscribed to receive them.</span></span> <span data-ttu-id="cf2a8-121">通常，订阅基于出现消息传送错误的端口（发送端口或接收端口）的名称来选择错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-121">A subscription typically selects an error message based on the name of the port in which the messaging error occurred (either a send or a receive port).</span></span> <span data-ttu-id="cf2a8-122">订阅还可能对升级到错误消息上下文的其他属性（例如， **InboundTransportLocation** 或 **FailureCode**）进行筛选。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-122">A subscription might also filter on other properties promoted to the error's message context (for example, **InboundTransportLocation** or **FailureCode**).</span></span>  
  
## <a name="error-message-specification"></a><span data-ttu-id="cf2a8-123">错误消息规范</span><span class="sxs-lookup"><span data-stu-id="cf2a8-123">Error Message Specification</span></span>  
 <span data-ttu-id="cf2a8-124">错误消息是原始失败消息的克隆，其中以前升级的所有属性将降级，一组特定于错误的属性将升级到消息上下文。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-124">An error message is a clone of the original failed message, with all previously promoted properties demoted and with a set of error-specific properties promoted to the message context.</span></span> <span data-ttu-id="cf2a8-125">以前升级的属性降级是为了避免非有意地将其传送给未指定接收错误消息的订户。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-125">Previously promoted properties are demoted to avoid unintended delivery to subscribers not designated to receive the error message.</span></span> <span data-ttu-id="cf2a8-126">发布错误消息以分发给订户（业务流程、发送端口和发送端口组）。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-126">The error message is published for distribution to subscribers (orchestrations, send ports, and send port groups).</span></span>  
  
 <span data-ttu-id="cf2a8-127">升级到的所有这些都包含在下一条错误消息上下文属性**ErrorReport** BizTalk Server 中的命名空间。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-127">The properties that are promoted to the context of an error message all fall under the **ErrorReport** namespace in BizTalk Server.</span></span> <span data-ttu-id="cf2a8-128">这些属性包括：</span><span class="sxs-lookup"><span data-stu-id="cf2a8-128">They are as follows:</span></span>  
  
|<span data-ttu-id="cf2a8-129">属性名称</span><span class="sxs-lookup"><span data-stu-id="cf2a8-129">Property name</span></span>|<span data-ttu-id="cf2a8-130">数据类型</span><span class="sxs-lookup"><span data-stu-id="cf2a8-130">Data type</span></span>|<span data-ttu-id="cf2a8-131">已升级</span><span class="sxs-lookup"><span data-stu-id="cf2a8-131">Promoted</span></span>|<span data-ttu-id="cf2a8-132">Description</span><span class="sxs-lookup"><span data-stu-id="cf2a8-132">Description</span></span>|  
|-------------------|---------------|--------------|-----------------|  
|<span data-ttu-id="cf2a8-133">FailureCode</span><span class="sxs-lookup"><span data-stu-id="cf2a8-133">FailureCode</span></span>|<span data-ttu-id="cf2a8-134">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-134">System.String</span></span>|<span data-ttu-id="cf2a8-135">是</span><span class="sxs-lookup"><span data-stu-id="cf2a8-135">Yes</span></span>|<span data-ttu-id="cf2a8-136">错误代码。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-136">Error code.</span></span> <span data-ttu-id="cf2a8-137">十六进制值，在 BizTalk Server 管理控制台中报告该值。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-137">A hexadecimal value that is reported in the BizTalk Server Administration console.</span></span>|  
|<span data-ttu-id="cf2a8-138">FailureCategory</span><span class="sxs-lookup"><span data-stu-id="cf2a8-138">FailureCategory</span></span>|<span data-ttu-id="cf2a8-139">System.Int32</span><span class="sxs-lookup"><span data-stu-id="cf2a8-139">System.Int32</span></span>|<span data-ttu-id="cf2a8-140">是</span><span class="sxs-lookup"><span data-stu-id="cf2a8-140">Yes</span></span>|<span data-ttu-id="cf2a8-141">不使用此属性。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-141">This property is not used.</span></span> <span data-ttu-id="cf2a8-142">未定义其值。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-142">Its value is undefined.</span></span>|  
|<span data-ttu-id="cf2a8-143">Description</span><span class="sxs-lookup"><span data-stu-id="cf2a8-143">Description</span></span>|<span data-ttu-id="cf2a8-144">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-144">System.String</span></span>|<span data-ttu-id="cf2a8-145">否</span><span class="sxs-lookup"><span data-stu-id="cf2a8-145">No</span></span>|<span data-ttu-id="cf2a8-146">错误说明。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-146">Error description.</span></span> <span data-ttu-id="cf2a8-147">与写入应用程序事件日志中的内容相同的诊断文本，提供有关此消息传送失败的信息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-147">Same diagnostic text as is written to the Application Event Log regarding this messaging failure.</span></span>|  
|<span data-ttu-id="cf2a8-148">MessageType</span><span class="sxs-lookup"><span data-stu-id="cf2a8-148">MessageType</span></span>|<span data-ttu-id="cf2a8-149">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-149">System.String</span></span>|<span data-ttu-id="cf2a8-150">是</span><span class="sxs-lookup"><span data-stu-id="cf2a8-150">Yes</span></span>|<span data-ttu-id="cf2a8-151">失败消息的消息类型，如果消息类型不确定则为空。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-151">Message type of failed message, or empty if message type is indeterminate.</span></span><br /><br /> <span data-ttu-id="cf2a8-152">BizTalk Server 使用消息类型将消息与其 XML 架构相关联。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-152">BizTalk Server uses the message type to associate messages with their XML schemas.</span></span> <span data-ttu-id="cf2a8-153">消息类型通过连接架构命名空间和架构根节点形成： http://mynamespace#rootnode。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-153">Message type is formed by concatenating the schema namespace with the schema root node: http://mynamespace#rootnode.</span></span> <span data-ttu-id="cf2a8-154">**注意：** 消息失败之前确定其消息类型不具有此属性设置。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-154">**Note:**  Messages that fail before their message type is determined do not have this property set.</span></span>|  
|<span data-ttu-id="cf2a8-155">ReceivePortName</span><span class="sxs-lookup"><span data-stu-id="cf2a8-155">ReceivePortName</span></span>|<span data-ttu-id="cf2a8-156">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-156">System.String</span></span>|<span data-ttu-id="cf2a8-157">如果失败发生在入站处理期间（在接收端口中），则为“已升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-157">**Promoted** if the failure happened during inbound processing (in a receive port)</span></span><br /><br /> <span data-ttu-id="cf2a8-158">如果在发生端口发生失败，则为“未升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-158">**Not promoted** if the failure happened in a send port.</span></span>|<span data-ttu-id="cf2a8-159">发生失败的接收端口的名称。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-159">Name of the receive port where the failure happened.</span></span>|  
|<span data-ttu-id="cf2a8-160">InboundTransportLocation</span><span class="sxs-lookup"><span data-stu-id="cf2a8-160">InboundTransportLocation</span></span>|<span data-ttu-id="cf2a8-161">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-161">System.String</span></span>|<span data-ttu-id="cf2a8-162">如果失败发生在入站处理期间（在接收端口中），则为“已升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-162">**Promoted** if the failure happened during inbound processing (in a receive port)</span></span><br /><br /> <span data-ttu-id="cf2a8-163">如果在发生端口发生失败，则为“未升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-163">**Not promoted** if the failure happened in a send port.</span></span>|<span data-ttu-id="cf2a8-164">发生失败的接收位置的 URI。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-164">URI of the receive location where the failure happened.</span></span>|  
|<span data-ttu-id="cf2a8-165">SendPortName</span><span class="sxs-lookup"><span data-stu-id="cf2a8-165">SendPortName</span></span>|<span data-ttu-id="cf2a8-166">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-166">System.String</span></span>|<span data-ttu-id="cf2a8-167">如果失败发生在出站处理期间（在发送端口中），则为“已升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-167">**Promoted** if the failure happened during outbound processing (in a send port)</span></span><br /><br /> <span data-ttu-id="cf2a8-168">如果失败发生在接收端口中，则为“未升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-168">**Not promoted** if the failure happened in a receive port.</span></span>|<span data-ttu-id="cf2a8-169">发生失败的发送端口的名称。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-169">Name of the send port where the failure happened.</span></span>|  
|<span data-ttu-id="cf2a8-170">OutboundTransportLocation</span><span class="sxs-lookup"><span data-stu-id="cf2a8-170">OutboundTransportLocation</span></span>|<span data-ttu-id="cf2a8-171">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-171">System.String</span></span>|<span data-ttu-id="cf2a8-172">如果失败发生在出站处理期间（在发送端口中），则为“已升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-172">**Promoted** if the failure happened during outbound processing (in a send port)</span></span><br /><br /> <span data-ttu-id="cf2a8-173">如果失败发生在接收端口中，则为“未升级” 。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-173">**Not promoted** if the failure happened in a receive port.</span></span>|<span data-ttu-id="cf2a8-174">发生失败的发送位置的 URI。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-174">URI of the send location where the failure happened.</span></span>|  
|<span data-ttu-id="cf2a8-175">ErrorType</span><span class="sxs-lookup"><span data-stu-id="cf2a8-175">ErrorType</span></span>|<span data-ttu-id="cf2a8-176">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-176">System.String</span></span>|<span data-ttu-id="cf2a8-177">是</span><span class="sxs-lookup"><span data-stu-id="cf2a8-177">Yes</span></span>|<span data-ttu-id="cf2a8-178">指示错误包含的消息的类型。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-178">Indicates the type of message that the error contains.</span></span> <span data-ttu-id="cf2a8-179">此属性始终包含值 **FailedMessage**，表示错误包含原始的失败消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-179">This property always contains the value **FailedMessage**, meaning that the error contains the original failed message.</span></span>|  
|<span data-ttu-id="cf2a8-180">RoutingFailureReportID</span><span class="sxs-lookup"><span data-stu-id="cf2a8-180">RoutingFailureReportID</span></span>|<span data-ttu-id="cf2a8-181">System.String</span><span class="sxs-lookup"><span data-stu-id="cf2a8-181">System.String</span></span>|<span data-ttu-id="cf2a8-182">是</span><span class="sxs-lookup"><span data-stu-id="cf2a8-182">Yes</span></span>|<span data-ttu-id="cf2a8-183">存在路由故障时，此属性提供 BizTalk Server 生成的路由故障报告的 ID。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-183">This property provides the ID of the routing failure report that BizTalk Server generates when there is a routing failure.</span></span> <span data-ttu-id="cf2a8-184">路由故障报告是由 BizTalk Server 生成和挂起的特殊消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-184">A routing failure report is a special message that BizTalk Server generates and suspends.</span></span> <span data-ttu-id="cf2a8-185">此消息没有正文，但它具有失败消息的上下文。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-185">This message does not have a body, but it has the context of the failed message.</span></span> <span data-ttu-id="cf2a8-186">使用此 ID，错误处理业务流程或发送端口可以查询 MessageBox 数据库并处理路由故障报告。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-186">Using this ID, an error-handling orchestration or a send port can query the MessageBox database and process the routing failure report.</span></span> <span data-ttu-id="cf2a8-187">例如，业务流程在获取失败消息之后可能要终止路由故障报告。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-187">For example, an orchestration may want to terminate the routing failure report after it gets the failed message.</span></span>|  
  
## <a name="handling-error-messages"></a><span data-ttu-id="cf2a8-188">处理错误消息</span><span class="sxs-lookup"><span data-stu-id="cf2a8-188">Handling Error Messages</span></span>  
 <span data-ttu-id="cf2a8-189">错误处理由其筛选器与已升级到错误消息的消息上下文的属性匹配的业务流程或发送端口订阅指定。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-189">Error handling is specified by an orchestration or send-port subscription whose filter matches the properties that have been promoted to the message context of the error message.</span></span>  
  
## <a name="security-implications"></a><span data-ttu-id="cf2a8-190">安全含义</span><span class="sxs-lookup"><span data-stu-id="cf2a8-190">Security Implications</span></span>  
 <span data-ttu-id="cf2a8-191">将与原始消息关联的标识（它的初始标识或它的最后标识，由接收管道的解析参与方阶段确定）分配给错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-191">The identity associated with the original message—either its initial identity or its final identity determined by the Resolve Party stage of the receive pipeline—is assigned to the error message.</span></span>  
  
 <span data-ttu-id="cf2a8-192">限制消息只能传送给授权的订阅端口和业务流程的安全机制也应用于错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-192">The security mechanisms that restrict delivery of messages to authorized subscribing ports and orchestrations also apply to error messages.</span></span>  
  
 <span data-ttu-id="cf2a8-193">对于订阅错误消息但未使用适当的解密证书进行配置的发送端口，不会收到在接收管道（原始消息通过其进入 BizTalk Server）解密阶段之内或之前基于消息传送失败产生的错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-193">A send port that subscribes to an error message, but is not configured with an appropriate decryption certificate, does not receive error messages that result from messaging failures at or before the decrypt stage of the receive pipeline through which the original message entered BizTalk Server.</span></span> <span data-ttu-id="cf2a8-194">而失败消息将放置在挂起队列中。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-194">Instead, the failed messages are placed in the Suspended queue.</span></span>  
  
## <a name="adapter-messaging-failure"></a><span data-ttu-id="cf2a8-195">适配器消息传送失败</span><span class="sxs-lookup"><span data-stu-id="cf2a8-195">Adapter Messaging Failure</span></span>  
 <span data-ttu-id="cf2a8-196">如果适配器挂起消息，则会发布错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-196">If an adapter suspends a message, an error message is published.</span></span> <span data-ttu-id="cf2a8-197">如果消息未挂起，则不会生成错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-197">No error message is generated if the message is not suspended.</span></span>  
  
## <a name="transactional-receive-pipelines"></a><span data-ttu-id="cf2a8-198">事务性接收管道</span><span class="sxs-lookup"><span data-stu-id="cf2a8-198">Transactional Receive Pipelines</span></span>  
 <span data-ttu-id="cf2a8-199">如果事务性接收管道引发异常（指定事务应被中止），则事务将中止，并发布错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-199">If a transactional receive pipeline throws an exception (specifies that the transaction should be aborted), then the transaction is aborted and an error message is published.</span></span>  
  
 <span data-ttu-id="cf2a8-200">如果事务性接收管道显式挂起消息（指定 MessageDestination = SuspendQueue），则允许当前事务继续（并且可能被提交，除非随后的阶段指定将其中止），并且发布所生成的错误消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-200">If a transactional receive pipeline explicitly suspends a message (specifies that MessageDestination = SuspendQueue), then the current transaction is allowed to proceed (and may be committed unless subsequent stages specify to abort it) and the resulting error message is published.</span></span>  
  
## <a name="solicit-response-send-ports"></a><span data-ttu-id="cf2a8-201">要求响应发送端口</span><span class="sxs-lookup"><span data-stu-id="cf2a8-201">Solicit-Response Send Ports</span></span>  
 <span data-ttu-id="cf2a8-202">如果从业务流程发送请求消息，而请求消息传输失败或其响应在入站处理时失败，则不管是否已经路由失败消息，业务流程都将获得异常。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-202">When a request message is sent from an orchestration and it fails transmission or its response fails inbound processing, the orchestration gets an exception, regardless of whether the failed message has been routed.</span></span>  
  
 <span data-ttu-id="cf2a8-203">在将要求响应发送端口连接到请求响应接收端口的情况下，不管是否已经路由失败消息，接收端口都将获得响应消息（如果传输成功）或 NACK（如果传输失败）。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-203">In the case where a solicit-response send port is connected to a request-response receive port, the receive port gets either a response message (if the transmission succeeds) or a NACK (if the transmission fails), regardless of whether the failed message has been routed.</span></span>  
  
## <a name="one-way-send-ports"></a><span data-ttu-id="cf2a8-204">单向发送端口</span><span class="sxs-lookup"><span data-stu-id="cf2a8-204">One-Way Send Ports</span></span>  
 <span data-ttu-id="cf2a8-205">如果从业务流程通过配置送达通知的发送端口发送消息，则不管是否已经路由了错误消息，业务流程都将收到送达通知。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-205">When a message is sent from an orchestration through a send port configured for delivery notification, then the orchestration receives a delivery notification regardless of whether the error message has been routed.</span></span> <span data-ttu-id="cf2a8-206">换句话说，即使端口在处理期间遇到消息传送失败，发送端口也将为业务流程生成送达通知。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-206">In other words, the send port generates a delivery notification for the orchestration even if the port encounters a messaging failure during processing.</span></span> <span data-ttu-id="cf2a8-207">通知会确认到端口的送达，但不会确保通过端口成功进行处理。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-207">The notification confirms delivery to the port, but does not address successful processing through the port.</span></span>  
  
## <a name="resuming-suspended-messages"></a><span data-ttu-id="cf2a8-208">恢复挂起消息</span><span class="sxs-lookup"><span data-stu-id="cf2a8-208">Resuming Suspended Messages</span></span>  
 <span data-ttu-id="cf2a8-209">大多数入站处理（即从接收适配器（包括）到发布到 MessageBox（不包括）的处理）失败并且其失败未处理的消息将会作为可恢复消息挂起。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-209">Most messages that fail inbound processing (that is, processing from and including the receive adapter and up to but not including publication to the message box), and whose failures are not handled, are suspended as resumable.</span></span> <span data-ttu-id="cf2a8-210">例外情况是来自双向接收端口的请求消息将作为不可恢复消息挂起。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-210">The exception is that request messages from two-way receive ports are suspended as nonresumable.</span></span>  
  
 <span data-ttu-id="cf2a8-211">消息通常以其原始形式（管道处理之前的形式）挂起，但以下两种消息除外：</span><span class="sxs-lookup"><span data-stu-id="cf2a8-211">Messages are typically suspended in their original form (as they were before pipeline processing), with two exceptions:</span></span>  
  
-   <span data-ttu-id="cf2a8-212">**由管道组件挂起的消息。**</span><span class="sxs-lookup"><span data-stu-id="cf2a8-212">**Messages suspended by pipeline components.**</span></span> <span data-ttu-id="cf2a8-213">BizTalk Server 以将其提供给失败管道组件时的相同形式挂起此类消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-213">BizTalk Server suspends this type of message in the same form as it was provided to the failing pipeline component.</span></span> <span data-ttu-id="cf2a8-214">恢复消息时，从同一管道的开始位置执行管道处理。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-214">When the message is resumed, it undergoes pipeline processing from the beginning of the same pipeline.</span></span> <span data-ttu-id="cf2a8-215">这意味着，对于在出现原始失败的阶段以前的管道阶段中的管道组件，它们必须准备以不同于原始形式（处理该消息的形式）的形式处理“相同”消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-215">This implies that a pipeline component in a pipeline stage that precedes the stage where the original failure occurred must be prepared to handle the "same" message in a form that is different from the original form in which it processed that message.</span></span>  
  
-   <span data-ttu-id="cf2a8-216">**来自可恢复的消息的交换拆装随后路由失败。**</span><span class="sxs-lookup"><span data-stu-id="cf2a8-216">**Messages from recoverable interchange disassembly that subsequently fail routing.**</span></span> <span data-ttu-id="cf2a8-217">BizTalk Server 以其被发布时的相同形式挂起此类消息。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-217">BizTalk Server suspends this type of message in the same form as it was published.</span></span> <span data-ttu-id="cf2a8-218">这是在管道执行 **之后** 消息所具有的形式。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-218">This is the form the message had **after** pipeline execution.</span></span> <span data-ttu-id="cf2a8-219">消息恢复后，会跳过管道处理，直接发布到 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-219">When the message is resumed, it skips pipeline processing and is published directly to the MessageBox database.</span></span>  
  
## <a name="scenarios-leading-to-suspended-non-resumable-messages"></a><span data-ttu-id="cf2a8-220">导致消息挂起（不可恢复）的情况</span><span class="sxs-lookup"><span data-stu-id="cf2a8-220">Scenarios Leading to Suspended (Non-Resumable) Messages</span></span>  
 <span data-ttu-id="cf2a8-221">通常，挂起的消息是可恢复的，不过在某些情况下，也会导致不可恢复的消息：</span><span class="sxs-lookup"><span data-stu-id="cf2a8-221">While it is more common for messages to be suspended as resumable, there are some scenarios that lead to non-resumable messages:</span></span>  
  
-   <span data-ttu-id="cf2a8-222">在允许在发生故障后仍继续的“按序送达”发送端口中，如果管道、映射或传输发生故障的情况下。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-222">In an Ordered Delivery send port with continue on failure enabled, if there is a failure in the pipeline, mapping or transmission.</span></span>  
  
-   <span data-ttu-id="cf2a8-223">在“按序送达”接收端口中，如果适配器配置为发生故障时以不可恢复的方式挂起消息的情况下。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-223">In an Ordered Delivery receive port, if the adapter is configured to suspend messages on non-resumable on failure.</span></span> <span data-ttu-id="cf2a8-224">例如，如果 MSMQ 适配器的“失败时”设置设为“已挂起(不可恢复)”或者 MQSeries 适配器启用了“挂起且不可恢复”，则失败的消息将作为不可恢复的消息被挂起。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-224">For example, if the MSMQ adapter setting "On Failure" is set to "Suspend (non-resumable)" or the MQSeries adapter has "Suspend as Non Resumable" enabled, failed messages will be suspended as non-resumable.</span></span>  
  
-   <span data-ttu-id="cf2a8-225">在双向接收端口中，如果管道、映射或传输中的响应消息失败的情况下。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-225">In a two-way receive port, if the response message fails in the pipeline, mapping, or transmission.</span></span>  
  
-   <span data-ttu-id="cf2a8-226">在双向接收端口中，如果管道、映射或传输中的接收消息失败的情况下。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-226">In a two-way receive port, if the receive message fails in the pipeline, mapping or transmission.</span></span> <span data-ttu-id="cf2a8-227">不同的适配器可能有不同的行为。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-227">Individual adapter behavior may be different.</span></span> <span data-ttu-id="cf2a8-228">例如，默认情况下 HTTP 适配器不会将消息挂起，但可以配置为将消息挂起。</span><span class="sxs-lookup"><span data-stu-id="cf2a8-228">For example, the HTTP adapter does not suspend messages by default but can be configured to do so.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cf2a8-229">请参阅</span><span class="sxs-lookup"><span data-stu-id="cf2a8-229">See Also</span></span>  
 <span data-ttu-id="cf2a8-230">[错误处理](../core/error-handling.md) </span><span class="sxs-lookup"><span data-stu-id="cf2a8-230">[Error Handling](../core/error-handling.md) </span></span>  
 <span data-ttu-id="cf2a8-231">[使用确认](../core/using-acknowledgments.md) </span><span class="sxs-lookup"><span data-stu-id="cf2a8-231">[Using Acknowledgments](../core/using-acknowledgments.md) </span></span>  
 [<span data-ttu-id="cf2a8-232">按序送达消息</span><span class="sxs-lookup"><span data-stu-id="cf2a8-232">Ordered Delivery of Messages</span></span>](../core/ordered-delivery-of-messages.md)