---
title: 测量最大可承受跟踪吞吐量 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 35605427-0217-4bdd-8b4a-3e68b3f5f452
caps.latest.revision: 20
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d68d1661a86858b8d2bca1bb067c8fa17ea421e3
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37017057"
---
# <a name="measuring-maximum-sustainable-tracking-throughput"></a><span data-ttu-id="5f690-102">度量最大可承受跟踪吞吐量</span><span class="sxs-lookup"><span data-stu-id="5f690-102">Measuring Maximum Sustainable Tracking Throughput</span></span>
<span data-ttu-id="5f690-103">将行业解决方案部署到 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 平台上之后，应跟踪并监视该系统，以了解以下信息：</span><span class="sxs-lookup"><span data-stu-id="5f690-103">After you deploy a line of business solution onto the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] platform, you should track and monitor the system to understand the following:</span></span>  
  
- <span data-ttu-id="5f690-104">系统的执行情况</span><span class="sxs-lookup"><span data-stu-id="5f690-104">How the system is performing</span></span>  
  
- <span data-ttu-id="5f690-105">可能出现的异常和错误以及出现的原因</span><span class="sxs-lookup"><span data-stu-id="5f690-105">What exceptions and errors may be occurring and why</span></span>  
  
- <span data-ttu-id="5f690-106">作为 BizTalk 解决方案实现的业务流程的当前状态</span><span class="sxs-lookup"><span data-stu-id="5f690-106">The current state of the business processes implemented as BizTalk solutions</span></span>  
  
  <span data-ttu-id="5f690-107">对许多组织而言，也很重要记录出于不可否认目的流经系统的实际原始消息。</span><span class="sxs-lookup"><span data-stu-id="5f690-107">For many organizations, it is also important to record the actual raw messages flowing through the system for non-repudiation purposes.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="5f690-108"> 提供了满足这些要求的两种类型的跟踪功能：</span><span class="sxs-lookup"><span data-stu-id="5f690-108"> provides two types of tracking functionality that address these requirements:</span></span>  
  
- <span data-ttu-id="5f690-109">**数据跟踪和活动 (DTA) 跟踪**。</span><span class="sxs-lookup"><span data-stu-id="5f690-109">**Data Tracking and Activity (DTA) tracking**.</span></span> <span data-ttu-id="5f690-110">DTA 将跟踪用户定义的各种消息属性、业务流程调试事件、消息流事件以及服务实例状态。</span><span class="sxs-lookup"><span data-stu-id="5f690-110">DTA tracks a variety of user-defined message properties, orchestration debug events, message flow events, and service instance status.</span></span> <span data-ttu-id="5f690-111">您可以使用跟踪来查询存储在 BizTalk DTA 跟踪数据库 （BizTalkDTADb） 中的数据。</span><span class="sxs-lookup"><span data-stu-id="5f690-111">You use tracking to query the data stored in the BizTalk DTA Tracking database (BizTalkDTADb).</span></span> <span data-ttu-id="5f690-112">DTA 跟踪还包括原始消息（称为消息正文）的跟踪，以便防止抵赖和解决问题。</span><span class="sxs-lookup"><span data-stu-id="5f690-112">DTA tracking also includes the tracking of raw messages, known as message bodies, for non-repudiation and problem resolution purposes.</span></span>  
  
- <span data-ttu-id="5f690-113">**业务活动监视 (BAM) 跟踪**。</span><span class="sxs-lookup"><span data-stu-id="5f690-113">**Business Activity Monitoring (BAM) tracking**.</span></span> <span data-ttu-id="5f690-114">BAM 将使用用户定义的跟踪配置文件来跟踪业务流程的状态，并将其记录到一组特殊的 BAM 数据库中。</span><span class="sxs-lookup"><span data-stu-id="5f690-114">BAM uses a user-defined tracking profile to track the state of a business process into a special set of BAM databases.</span></span>  
  
  <span data-ttu-id="5f690-115">本主题介绍了 DTA 结构以及确定使用 DTA 的系统可以无限维持的最大可承受吞吐量的系统方法。</span><span class="sxs-lookup"><span data-stu-id="5f690-115">In this topic, we describe the DTA architecture and a systematic approach to determine the maximum sustainable throughput that a system employing DTA can sustain indefinitely.</span></span> <span data-ttu-id="5f690-116">尽管 DTA 和 BAM 共享某些结构组件，但本主题仅介绍 DTA 的行为。</span><span class="sxs-lookup"><span data-stu-id="5f690-116">Although DTA and BAM share some architectural components, this topic covers the behavior of DTA only.</span></span> <span data-ttu-id="5f690-117">有关 BAM 结构的信息，请参阅[业务活动监视 (BAM)](../core/business-activity-monitoring-bam.md)。</span><span class="sxs-lookup"><span data-stu-id="5f690-117">For information about BAM architecture, see [Business Activity Monitoring (BAM)](../core/business-activity-monitoring-bam.md).</span></span>  
  
## <a name="overview-of-dta-tracking-architecture"></a><span data-ttu-id="5f690-118">DTA 跟踪结构概述</span><span class="sxs-lookup"><span data-stu-id="5f690-118">Overview of DTA Tracking Architecture</span></span>  
 <span data-ttu-id="5f690-119">消息通过系统时，各种被跟踪的元素（如消息正文、属性和事件）会通过一系列流程和数据库，最终将这些元素写入 BizTalkDTADb 数据库中。</span><span class="sxs-lookup"><span data-stu-id="5f690-119">As messages flow through the system, various tracked elements such as message bodies, properties, and events, pass through a series of processes and databases that ultimately result in writing them to the BizTalkDTADb database.</span></span> <span data-ttu-id="5f690-120">将这些元素写入 BizTalkDTADb 数据库之后，可以使用跟踪来查询被跟踪的信息。</span><span class="sxs-lookup"><span data-stu-id="5f690-120">After the elements are written to the BizTalkDTADb database, you can use tracking to query the tracked information.</span></span> <span data-ttu-id="5f690-121">有关设置和使用 BizTalkDTADb 数据库信息和跟踪，请参阅[查看历史记录和跟踪数据](../core/viewing-historical-and-tracked-data.md)。</span><span class="sxs-lookup"><span data-stu-id="5f690-121">For information about setting up and using the BizTalkDTADb database and tracking, see [Viewing Historical and Tracked Data](../core/viewing-historical-and-tracked-data.md).</span></span>  
  
 <span data-ttu-id="5f690-122">为了确保系统具有可持续性并以给定的消息流量无限期运行，被跟踪元素到达 BizTalkDTADb 数据库所通过的路径以及数据库本身需要保持良好的状况。</span><span class="sxs-lookup"><span data-stu-id="5f690-122">To ensure that the system is sustainable and will run indefinitely at a given message flow rate, the pathway that tracked elements pass through on their way to the BizTalkDTADb database, and the database itself, need to remain healthy.</span></span> <span data-ttu-id="5f690-123">例如，传输过程中在数据库表中生成的消息或在 DTA 生成的消息会导致未绑定数据库文件的增长，如果未得到正确管理，系统将无法承受。</span><span class="sxs-lookup"><span data-stu-id="5f690-123">For example, messages building up in database tables along the way, or in the DTA, can cause unbounded database file growth that would not be sustainable if not properly managed.</span></span>  
  
 <span data-ttu-id="5f690-124">因此，我们首先应了解结构和被跟踪信息通过的路径。</span><span class="sxs-lookup"><span data-stu-id="5f690-124">So, let's start by understanding the architecture and pathways that tracked information flows through.</span></span> <span data-ttu-id="5f690-125">这将公开的重要资源和性能指标，必须监视以确定如何跟踪系统与消息流量流经保持[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]引擎。</span><span class="sxs-lookup"><span data-stu-id="5f690-125">This will expose the key resources and performance indicators that you must monitor to determine how well the tracking system is keeping up with the message traffic flowing through the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] engine.</span></span>  
  
 <span data-ttu-id="5f690-126">下图显示了 DTA 跟踪结构和路径的概况：</span><span class="sxs-lookup"><span data-stu-id="5f690-126">The following figure shows an overview of the DTA tracking architecture and pathways.</span></span>  
  
 <span data-ttu-id="5f690-127">![DTA 跟踪概述](../core/media/dtatrackingoverview.gif "DTATrackingOverview")</span><span class="sxs-lookup"><span data-stu-id="5f690-127">![DTA tracking overview](../core/media/dtatrackingoverview.gif "DTATrackingOverview")</span></span>  
  
 <span data-ttu-id="5f690-128">按照图中编号进程的顺序，所有 DTA 跟踪的数据进出 BizTalkDTADb 数据库的过程如下所示：</span><span class="sxs-lookup"><span data-stu-id="5f690-128">Taking the numbered processes from the figure in order, all DTA tracked data flows into and out of the BizTalkDTADb database as follows:</span></span>  
  
1. <span data-ttu-id="5f690-129">BizTalk Server 运行时进程包括一个称为侦听器的组件。</span><span class="sxs-lookup"><span data-stu-id="5f690-129">The BizTalk Server runtime process includes a component called the interceptor.</span></span> <span data-ttu-id="5f690-130">侦听器的工作是在运行时缓存被跟踪的元素，在下一次 MessageBox 数据库往返过程中（例如，将消息传输到 MessageBox 数据库中）将缓存的元素转发到 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="5f690-130">The interceptor’s job is to cache the tracked elements at runtime and, upon the next MessageBox database roundtrip (for example, en-queuing a message to the MessageBox database), forwards the cached elements to the MessageBox database.</span></span> <span data-ttu-id="5f690-131">侦听器通过查看跟踪配置（也称为跟踪配置文件，从管理数据库获取并缓存在每个主机运行时实例中以备侦听器使用）来确定要跟踪的元素。</span><span class="sxs-lookup"><span data-stu-id="5f690-131">The interceptor determines what elements to track by looking at the tracking configuration (also known as a tracking profile) which is obtained from the management database and cached in each host runtime instance for use by the interceptor.</span></span>  
  
    <span data-ttu-id="5f690-132">如上图所示，向 MessageBox 数据库插入了以下两个数据流：</span><span class="sxs-lookup"><span data-stu-id="5f690-132">As shown in the above figure, there are two data streams inserted into the MessageBox database:</span></span>  
  
   - <span data-ttu-id="5f690-133">由 Spool 表表示的数据流</span><span class="sxs-lookup"><span data-stu-id="5f690-133">One represented by the Spool table</span></span>  
  
   - <span data-ttu-id="5f690-134">由 TrackingData 表表示的数据流</span><span class="sxs-lookup"><span data-stu-id="5f690-134">One by the TrackingData table</span></span>  
  
     <span data-ttu-id="5f690-135">被跟踪的消息正文将使用这两个数据流。</span><span class="sxs-lookup"><span data-stu-id="5f690-135">Tracked message bodies use both streams.</span></span> <span data-ttu-id="5f690-136">即，消息正文本身（将它们视为 blob 数据）通过 Spool 表表示的一组表进行处理。</span><span class="sxs-lookup"><span data-stu-id="5f690-136">That is, the message bodies themselves (think of them as blobs of data) are handled via a set of tables represented by the spool table.</span></span> <span data-ttu-id="5f690-137">与消息正文相关联的消息事件（例如消息标识符、跟踪消息正文的时间、与消息正文相关联的实例）通过 TrackingData 表进行处理。</span><span class="sxs-lookup"><span data-stu-id="5f690-137">The message events associated with the message bodies (for example, message identifiers, when the message bodies were tracked, what instances the message bodies are associated with) are handled via the TrackingData table.</span></span> <span data-ttu-id="5f690-138">未与消息正文跟踪关联的所有被跟踪元素仅通过 TrackingData 表进行处理。</span><span class="sxs-lookup"><span data-stu-id="5f690-138">All tracked elements not associated with message body tracking are handled via the TrackingData table only.</span></span>  
  
2. <span data-ttu-id="5f690-139">MessageBox 数据库是被跟踪数据的第一站，用于缓存被跟踪的数据，这样，运行时可以继续处理，而不会直接被进一步的跟踪数据处理阻止。</span><span class="sxs-lookup"><span data-stu-id="5f690-139">The MessageBox database is just the first stop for tracked data and is used to cache the tracked data so that the runtime can continue processing without being directly blocked by further tracking data processing.</span></span>  
  
    <span data-ttu-id="5f690-140">若要获取跟踪的消息正文 (blob) 传输到 BizTalkDTADb 数据库可以在其中查看并将它们存档到更持久的存储，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]采用了称为 TrackedMessages_Copy_BizTalkMsgBoxDb 的每个 MessageBox 上运行的 SQL 代理作业数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="5f690-140">To get the tracked message bodies (blobs) transferred to the BizTalkDTADb database where you can view and archive them to more permanent storage, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] employs a SQL Agent job called TrackedMessages_Copy_BizTalkMsgBoxDb which runs on each MessageBox database server.</span></span> <span data-ttu-id="5f690-141">此作业负责将标记为进行跟踪的消息正文复制到 BizTalkDTADb 数据库。</span><span class="sxs-lookup"><span data-stu-id="5f690-141">It is the responsibility of this job to copy the message bodies marked for tracking to the BizTalkDTADb database.</span></span>  
  
3. <span data-ttu-id="5f690-142">之外消息正文跟踪的数据的所有从 MessageBox 数据库移到 BizTalkDTADb 数据库由一个称为 TDDS 运行中的一个或多个服务[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]主机。</span><span class="sxs-lookup"><span data-stu-id="5f690-142">All of the tracked data other than message bodies are moved from the MessageBox database to the BizTalkDTADb database by a service called TDDS which runs in one or more of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hosts.</span></span> <span data-ttu-id="5f690-143">只要通过 BizTalk Server 管理控制台中的主机属性页将主机配置为主机跟踪，TDDS 子服务就会在该主机的每个实例中运行。</span><span class="sxs-lookup"><span data-stu-id="5f690-143">Whenever a host is configured as Hosts Tracking via the host property pages in the BizTalk Server administration console, the TDDS sub-service will run in every instance of that host.</span></span>  
  
4. <span data-ttu-id="5f690-144">除非定期清空 BizTalkDTADb 数据库，否则它将无限增长，最终导致运行问题。</span><span class="sxs-lookup"><span data-stu-id="5f690-144">Unless the BizTalkDTADb database is purged periodically, it will grow unbounded which will eventually lead to operational problems.</span></span> <span data-ttu-id="5f690-145">称为 DTA 清除和存档 (BizTalkDTADb) 的 SQL 代理作业可执行清空 BizTalkDTADb 数据库的任务。</span><span class="sxs-lookup"><span data-stu-id="5f690-145">There is a single SQL Agent job called DTA Purge and Archive (BizTalkDTADb) that performs the task of purging the BizTalkDTADb database.</span></span> <span data-ttu-id="5f690-146">默认情况下，此作业每分钟运行一次，清除早于用户所配置时间（例如 24 小时）的所有已完成实例。</span><span class="sxs-lookup"><span data-stu-id="5f690-146">By default, this job runs every minute and purges all completed instances older than some user configured time (for example, 24hours).</span></span>  
  
    <span data-ttu-id="5f690-147">有关详细信息有关 DTA 清除和存档作业，请参阅[如何配置 DTA 清除和存档作业](../core/how-to-configure-the-dta-purge-and-archive-job.md)。</span><span class="sxs-lookup"><span data-stu-id="5f690-147">For more information abut the DTA Purge and Archive job, see [How to Configure the DTA Purge and Archive Job](../core/how-to-configure-the-dta-purge-and-archive-job.md).</span></span>  
  
5. <span data-ttu-id="5f690-148">另外，DTA 清除和存档作业还可以将 BizTalkDTADb 数据作为 SQL 备份进行存档，以便更长久地存储和/或脱机查看这些数据。</span><span class="sxs-lookup"><span data-stu-id="5f690-148">Optionally, the DTA Purge and Archive job can also archive the BizTalkDTADb data as a SQL Backup for longer term storage and/or off-line viewing of the data.</span></span> <span data-ttu-id="5f690-149">如果需要查询存档的 BizTalkDTADb 数据，则首先必须在 SQL Server 中将数据还原为新数据库，则可以使用跟踪或 SQL 查询分析器工具查询数据。</span><span class="sxs-lookup"><span data-stu-id="5f690-149">If the archived BizTalkDTADb data needs to be queried, it must first be restored as a new database in SQL Server and then you can use tracking or the SQL Query Analyzer to query it.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="5f690-150">本节内容</span><span class="sxs-lookup"><span data-stu-id="5f690-150">In This Section</span></span>  
  
-   [<span data-ttu-id="5f690-151">了解 DTA 跟踪性能行为</span><span class="sxs-lookup"><span data-stu-id="5f690-151">Understanding DTA Tracking Performance Behavior</span></span>](../core/understanding-dta-tracking-performance-behavior.md)  
  
-   [<span data-ttu-id="5f690-152">测量 DTA 跟踪的 MST 的测试方案</span><span class="sxs-lookup"><span data-stu-id="5f690-152">Test Scenarios for Measuring MST of DTA Tracking</span></span>](../core/test-scenarios-for-measuring-mst-of-dta-tracking.md)  
  
-   [<span data-ttu-id="5f690-153"> DTA 跟踪的 MST 的提示与技巧</span><span class="sxs-lookup"><span data-stu-id="5f690-153">Tips and Tricks for Finding MST of DTA Tracking</span></span>](../core/tips-and-tricks-for-finding-mst-of-dta-tracking.md)  
  
## <a name="see-also"></a><span data-ttu-id="5f690-154">请参阅</span><span class="sxs-lookup"><span data-stu-id="5f690-154">See Also</span></span>  
 [<span data-ttu-id="5f690-155">跟踪数据库的大小调整准则</span><span class="sxs-lookup"><span data-stu-id="5f690-155">Tracking Database Sizing Guidelines</span></span>](../core/tracking-database-sizing-guidelines.md)