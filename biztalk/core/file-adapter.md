---
title: 文件适配器 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- File adapters
ms.assetid: e4f6e94b-89b8-42ba-a4c2-a629f1107bb1
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ceb4f0728eb6fac66fb0fc5f84b117b37ba84121
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="file-adapter"></a><span data-ttu-id="d2d4b-102">文件适配器</span><span class="sxs-lookup"><span data-stu-id="d2d4b-102">File Adapter</span></span>
<span data-ttu-id="d2d4b-103">文件适配器用于将文件传入和传出 Microsoft BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-103">The File adapter transfers files into and out of Microsoft BizTalk Server.</span></span> <span data-ttu-id="d2d4b-104">文件适配器包含两个适配器-接收适配器和一个发送适配器。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-104">The File adapter consists of two adapters — a receive adapter and a send adapter.</span></span>  
  
 <span data-ttu-id="d2d4b-105">本部分将介绍文件接收适配器和文件发送适配器的工作流和批处理支持。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-105">This section discusses the workflow and batching support for both the File receive adapter and the File send adapter.</span></span>  
 
## <a name="file-receive-adapter"></a><span data-ttu-id="d2d4b-106">File 接收适配器</span><span class="sxs-lookup"><span data-stu-id="d2d4b-106">File receive adapter</span></span>  
  
<span data-ttu-id="d2d4b-107">使用文件收到适配器从文件中读取消息并将其提交到服务器。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-107">Use the File receive adapter to read messages from files, and submit them to the server.</span></span> <span data-ttu-id="d2d4b-108">接收适配器读取该文件，并创建 BizTalk 消息对象，因此该 BizTalk 服务器能够处理该消息。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-108">The receive adapter reads the file, and creates a BizTalk Message object, so that BizTalk Server can process the message.</span></span> <span data-ttu-id="d2d4b-109">在从文件中进行读取时，适配器将锁定该文件以确保无法对文件内容进行修改。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-109">While reading from the file, the adapter locks the file to ensure that no modifications can be made to the file content.</span></span>  
  
> [!NOTE] 
> <span data-ttu-id="d2d4b-110">文件接收适配器不提取只读文件或系统文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-110">The File receive adapter does not pick up read-only files or system files.</span></span>  
  
 <span data-ttu-id="d2d4b-111">文件接收适配器从本地文件系统或网络共享位置上的文件中读取消息。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-111">The File receive adapter reads the messages from files on local file systems or on network shares.</span></span> <span data-ttu-id="d2d4b-112">如果由于网络问题无法访问网络共享中的指定位置，则接收适配器将重试读取操作（重试次数可在 BizTalk Server 管理控制台中进行配置）。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-112">When the specified location on a network share is unavailable due to network problems, the receive adapter retries the read operation (the number of retries is configurable in the BizTalk Server Administration console).</span></span> <span data-ttu-id="d2d4b-113">BizTalk 消息引擎读取并成功接受消息后，接收适配器将从文件系统或网络共享位置中删除该文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-113">After the message has been read and successfully accepted by the BizTalk Messaging Engine, the receive adapter deletes the file from the file system or network share.</span></span> <span data-ttu-id="d2d4b-114">如果已读取消息但管道未成功处理该消息，则适配器会将该消息放置在挂起队列中，然后从文件系统或网络共享位置中删除该文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-114">If the message was read but the pipeline did not successfully process the message, the adapter puts the message in the suspended queue and then deletes the file from the file system or network share.</span></span> <span data-ttu-id="d2d4b-115">如果文件接收适配器无法将消息提交到 MessageBox 数据库或挂起消息，则不从文件系统或网络共享位置删除原始文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-115">If the File receive adapter cannot submit or suspend the message to the MessageBox database, it does not delete the original file from the file system or network share.</span></span>  
  
 <span data-ttu-id="d2d4b-116">也可以将文件接收适配器配置为在处理文件时对其进行重命名。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-116">You can also configure the File receive adapter to rename files when processing them.</span></span> <span data-ttu-id="d2d4b-117">应重命名文件以确保在关闭并重新启动接收位置时接收适配器不生成重复消息。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-117">You should rename files to ensure that the receive adapter does not generate duplicate messages if the receive location is shut down and restarted.</span></span> <span data-ttu-id="d2d4b-118">对于文件接收位置，这是一个可配置选项。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-118">This is a configurable option for File receive locations.</span></span> <span data-ttu-id="d2d4b-119">默认情况下，重命名处于禁用状态。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-119">By default, renaming is disabled.</span></span> <span data-ttu-id="d2d4b-120">如果启用重命名，则文件接收适配器会将扩展名 .BTS-WIP 附加到该文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-120">When renaming is enabled, the File receive adapter appends the extension .BTS-WIP to the file.</span></span> <span data-ttu-id="d2d4b-121">接收适配器随后会从位于接收位置的重命名的文件中读取消息并将其提交给服务器。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-121">The receive adapter then reads the messages from the renamed file in the receive location and submits it to the server.</span></span> <span data-ttu-id="d2d4b-122">在接收适配器成功提交文件后，该接收适配器将从文件系统或网络共享位置中删除重命名的文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-122">After the receive adapter has successfully submitted a file, the receive adapter deletes the renamed file from the file system or network share.</span></span> <span data-ttu-id="d2d4b-123">如果已读取消息但在管道中处理该消息时失败，则接收适配器会将该消息放置在 MessageBox 数据库的挂起队列中，然后从网络共享位置中删除重命名的文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-123">If a message has been read but failed processing in the pipeline, the receive adapter places the message in the MessageBox database suspended queue, and deletes the renamed file from the network share.</span></span>  
  
> [!NOTE] 
> <span data-ttu-id="d2d4b-124">重命名文件不会影响性能。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-124">Renaming files has no impact on performance.</span></span>  
  
 <span data-ttu-id="d2d4b-125">如果文件接收适配器已成功读取消息但未将该消息成功存储在 MessageBox 数据库中，则重命名的文件将恢复为其不带 .BTS-WIP 扩展名的原始名称。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-125">If the File receive adapter successfully reads the message but did not successfully store the message in the MessageBox database, the renamed file reverts to its original name, without the .BTS-WIP extension.</span></span> <span data-ttu-id="d2d4b-126">请注意，如果启用了重命名选项，则接收适配器将不读取带有 .BTS-WIP 扩展名的文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-126">Note that the receive adapter does not read files with the extension .BTS-WIP if the renaming option is turned on.</span></span>  
  
#### <a name="using-file-change-notifications-and-polling"></a><span data-ttu-id="d2d4b-127">使用文件更改通知和轮询</span><span class="sxs-lookup"><span data-stu-id="d2d4b-127">Using file change notifications and polling</span></span>
  
 <span data-ttu-id="d2d4b-128">文件接收适配器依靠 Windows 文件更改通知来确定何时从指定的目录或共享提取文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-128">The File receive adapter relies on Windows File Change Notifications to determine when to pick up a file from the specified directory or share.</span></span> <span data-ttu-id="d2d4b-129">如果文件接收适配器在文件尚未完全写入到指定目录或共享时即收到 Windows 文件更改通知，则该文件将会锁定，并且文件适配器将不检索该文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-129">If the File receive adapter receives a Windows File Change Notification before the file has been completely written to the specified directory or share then the file will be locked and the File receive adapter will not retrieve the file.</span></span> <span data-ttu-id="d2d4b-130">在此方案中，该文件收到适配器将主动轮询指定的目录或共享在**轮询间隔 （毫秒）**上指定**高级设置**对话框中配置时可用文件接收位置。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-130">In this scenario, the File receive adapter will actively poll the specified directory or share at the **Polling interval (ms)** specified on the **Advanced settings** dialog box available when configuring a File receive location.</span></span> <span data-ttu-id="d2d4b-131">文件接收适配器轮询目录或共享时，会从共享上检索未锁定的文件并将其提交至 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-131">When the File receive adapter polls a directory or share it retrieves unlocked files from the share and submits the files to the MessageBox database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d2d4b-132">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]文件适配器仅已测试，并且支持 NTFS 文件系统上。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-132">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] File adapter has only been tested on, and is supported on, the NTFS file system.</span></span>  
  
 <span data-ttu-id="d2d4b-133">下列 Windows 文件更改通知将导致文件接收适配器从指定的位置提取文件：</span><span class="sxs-lookup"><span data-stu-id="d2d4b-133">The following Windows File Change Notifications will cause the File receive adapter to pick up a file from the specified location:</span></span>  
  
 `FILE_NOTIFY_CHANGE_ATTRIBUTES`
  
 <span data-ttu-id="d2d4b-134">对受监视的目录或子树中属性的任意更改都会导致返回一个更改通知等待操作。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-134">Any attribute change in the watched directory or subtree causes a change notification wait operation to return.</span></span>  
  
 `FILE_NOTIFY_CHANGE_FILE_NAME`  
  
 <span data-ttu-id="d2d4b-135">对受监视的目录或子树中文件名的任意更改都会导致返回一个更改通知等待操作。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-135">Any file name change in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="d2d4b-136">这些更改包括重命名、创建或删除文件名。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-136">Changes include renaming, creating, or deleting a file name.</span></span>  
  
 `FILE_NOTIFY_CHANGE_SIZE`  
  
 <span data-ttu-id="d2d4b-137">对受监视的目录或子树中文件大小的任意更改都会导致返回一个更改通知等待操作。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-137">Any file-size change in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="d2d4b-138">仅当文件写入磁盘时，操作系统才会检测文件大小的更改。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-138">The operating system detects a change in file size only when the file is written to the disk.</span></span> <span data-ttu-id="d2d4b-139">对于使用大量缓存的操作系统，仅当缓存充分刷新时，才会进行检测。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-139">For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</span></span>  
  
 `FILE_NOTIFY_CHANGE_LAST_WRITE`  
  
 <span data-ttu-id="d2d4b-140">对受监视的目录或子树中文件的上次写入时间的任意更改都会导致返回一个更改通知等待操作。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-140">Any change to the last write-time of files in the watched directory or subtree causes a change notification wait operation to return.</span></span> <span data-ttu-id="d2d4b-141">仅当文件写入磁盘时，操作系统才会检测上次写入时间的更改。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-141">The operating system detects a change to the last write-time only when the file is written to the disk.</span></span> <span data-ttu-id="d2d4b-142">对于使用大量缓存的操作系统，仅当缓存充分刷新时，才会进行检测。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-142">For operating systems that use extensive caching, detection occurs only when the cache is sufficiently flushed.</span></span>  
  
 <span data-ttu-id="d2d4b-143">有关详细信息**FindFirstChangeNotification**函数，请参阅[https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx](https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="d2d4b-143">For more information about the **FindFirstChangeNotification** function see [https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx](https://msdn.microsoft.com/library/windows/desktop/aa364417(v=vs.85).aspx).</span></span>  
  
### <a name="file-receive-adapter-batching-support"></a><span data-ttu-id="d2d4b-144">文件接收适配器的批处理支持</span><span class="sxs-lookup"><span data-stu-id="d2d4b-144">File Receive Adapter Batching Support</span></span>
  
 <span data-ttu-id="d2d4b-145">文件接收适配器将消息分批提交给服务器。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-145">The File receive adapter submits messages to the server in batches.</span></span> <span data-ttu-id="d2d4b-146">通过收集接收位置中所有可用的可读文件来为每个接收位置生成单独的一批，可启动文件接收适配器。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-146">The File receive adapter starts by building a single batch per receive location by collecting all the readable files available in the receive location.</span></span> <span data-ttu-id="d2d4b-147">在收集了所有可用文件后，或当收集的文件量超过最大批大小时，接收适配器会将各批提交给 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-147">Batches are submitted to the MessageBox database by the receive adapter when all the available files have been collected or when the amount of files collected exceeds the maximum batch size.</span></span>  
  
 <span data-ttu-id="d2d4b-148">在成功读取批中的所有消息并将其提交给 MessageBox 数据库后，文件接收适配器将从接收位置中删除相应的文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-148">After all the messages within the batch have been successfully read and submitted into the MessageBox database, the File receive adapter deletes the corresponding files from the receive location.</span></span> <span data-ttu-id="d2d4b-149">如果处理批中的部分消息时失败，则文件接收适配器将挂起这些消息并从接收位置中删除相应的文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-149">If some of the messages within the batch failed processing, the File receive adapter suspends them and deletes the corresponding files from the receive location.</span></span> <span data-ttu-id="d2d4b-150">如果无法将部分或全部消息存储在 MessageBox 数据库中，则回滚整个批处理操作并将所有相应文件原封不动地保留在接收位置中。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-150">If some or all of the messages fail to be stored in the MessageBox database, the entire batch operation is rolled back and all corresponding files are left unchanged in the receive location.</span></span>  
  
## <a name="file-send-adapter"></a><span data-ttu-id="d2d4b-151">文件发送适配器</span><span class="sxs-lookup"><span data-stu-id="d2d4b-151">File Send Adapter</span></span>
  
 <span data-ttu-id="d2d4b-152">文件发送适配器将消息从 MessageBox 数据库中传输到指定的目标位置 (URL)。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-152">The File send adapter transmits messages from the MessageBox database to a specified destination address (URL).</span></span> <span data-ttu-id="d2d4b-153">使用与消息上下文属性相关的通配符可定义 URL，该 URL 为文件路径和文件名。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-153">You define the URL, which is a file path and file name, by using wildcard characters related to the message context properties.</span></span> <span data-ttu-id="d2d4b-154">在向该文件写入消息之前，文件发送适配器会将通配符解析为实际的文件名。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-154">The File send adapter resolves the wildcard characters to the actual file name before writing the message to the file.</span></span>  
  
 <span data-ttu-id="d2d4b-155">在向文件写入消息时，文件发送适配器将从 BizTalk 消息对象的正文部分中获取该消息的上下文。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-155">When writing a message to a file, the File send adapter gets the message content from the body part of the BizTalk Message object.</span></span> <span data-ttu-id="d2d4b-156">文件发送适配器将忽略 BizTalk 消息对象中的其他消息部分。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-156">The File send adapter ignores other message parts in the BizTalk Message object.</span></span> <span data-ttu-id="d2d4b-157">在将该消息写入文件后，文件适配器将从 MessageBox 数据库中将其删除。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-157">After the File adapter writes the message to a file, it deletes the message from the MessageBox database.</span></span> <span data-ttu-id="d2d4b-158">文件适配器可直接将文件写入文件系统；也可使用文件系统缓存将其写入文件系统，这样可提高性能，尤其适用于大型文件。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-158">The File adapter writes files to the file system either directly or by using the file system cache, which can improve performance, particularly for large files.</span></span>  
  
### <a name="file-send-adapter-batching-support"></a><span data-ttu-id="d2d4b-159">文件发送适配器的批处理支持</span><span class="sxs-lookup"><span data-stu-id="d2d4b-159">File Send Adapter Batching Support</span></span>
  
 <span data-ttu-id="d2d4b-160">文件发送适配器从 MessageBox 数据库中获取消息批并将其写入文件系统或网络共享位置中的目标位置。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-160">The File send adapter gets batches of messages from the MessageBox database and writes them to files in destination locations on the file system or the network share.</span></span> <span data-ttu-id="d2d4b-161">文件发送适配器的批大小不可配置并且预设为 20。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-161">The size of File send adapter batches is not configurable and is preset to 20.</span></span> <span data-ttu-id="d2d4b-162">如果 BizTalk Server 无法将批中的部分消息写入文件，则系统会将这些消息重新提交给 MessageBox 数据库以重试对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-162">If BizTalk Server fails to write some of the messages within a batch to files, the system resubmits those messages to the MessageBox database for retry processing.</span></span> <span data-ttu-id="d2d4b-163">可使用 BizTalk Server 管理控制台来配置重试时间间隔和重试次数。</span><span class="sxs-lookup"><span data-stu-id="d2d4b-163">You can configure the retry interval and retry count by using the BizTalk Server Administration console.</span></span>  
  
 
## <a name="in-this-section"></a><span data-ttu-id="d2d4b-164">在本节中</span><span class="sxs-lookup"><span data-stu-id="d2d4b-164">In this section</span></span>  
  
-   [<span data-ttu-id="d2d4b-165">配置文件适配器</span><span class="sxs-lookup"><span data-stu-id="d2d4b-165">Configure the File adapter</span></span>](../core/configure-the-file-adapter.md) 
  
-   [<span data-ttu-id="d2d4b-166">配置文件适配器时的限制</span><span class="sxs-lookup"><span data-stu-id="d2d4b-166">Restrictions when configuring the File adapter</span></span>](../core/restrictions-when-configuring-the-file-adapter.md)  
