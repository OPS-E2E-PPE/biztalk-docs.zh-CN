---
title: 为 BizTalk 主机提供高可用性 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- messages, MessageBox database
- planning, hosts
- hosts, high availability
- messages, routing
- deploying, high availability
- high availability, hosts
- hosts
- hosts, planning
- MessageBox database
ms.assetid: 9583b85c-7cad-4016-8065-5ca7de3f4359
caps.latest.revision: 47
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f964a8e170c2215c4abb2b6b5842f8fe0e159457
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22271893"
---
# <a name="providing-high-availability-for-biztalk-hosts"></a><span data-ttu-id="4e413-102">为 BizTalk 主机提供高可用性</span><span class="sxs-lookup"><span data-stu-id="4e413-102">Providing High Availability for BizTalk Hosts</span></span>
<span data-ttu-id="4e413-103">由于您可以策略性地将逻辑主机专门用于运行特定方面的功能，如接收消息、发送消息或处理业务流程，所以 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 可灵活处理高可用性方面的问题。</span><span class="sxs-lookup"><span data-stu-id="4e413-103">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] provides great flexibility for addressing high availability because you can strategically dedicate logical hosts to run specific areas of functionality such as receiving messages, sending messages or processing orchestrations.</span></span>  
  
 <span data-ttu-id="4e413-104">BizTalk 主机是 BizTalk Server 组中的逻辑容器，该容器可以容纳不同的 BizTalk Server 项，例如适配器处理程序、接收位置（包括管道）和业务流程等。</span><span class="sxs-lookup"><span data-stu-id="4e413-104">A BizTalk host is a logical container within a BizTalk Server group that can house BizTalk Server items such as adapter handlers, receive locations (including pipelines), and orchestrations.</span></span> <span data-ttu-id="4e413-105">通常，您可将具有类似扩展要求的项分到特定的主机中。</span><span class="sxs-lookup"><span data-stu-id="4e413-105">You typically group items that have similar scaling requirements into a particular host.</span></span> <span data-ttu-id="4e413-106">例如，可以将接收位置分到“接收”主机中，将发送端口分到“发送”主机中，将业务流程分到“处理”主机。</span><span class="sxs-lookup"><span data-stu-id="4e413-106">For example, you would group receive locations into a “receive” host, send ports into a “send” host, and orchestrations into an “processing” host.</span></span>  
  
 <span data-ttu-id="4e413-107">在创建了主机（逻辑容器）之后，可以在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 组中的物理 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上配置主机实例。</span><span class="sxs-lookup"><span data-stu-id="4e413-107">After you create a host (a logical container), you can configure instances of the host to run on physical [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group.</span></span> <span data-ttu-id="4e413-108">主机实例在指定 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上作为 Windows 服务运行。</span><span class="sxs-lookup"><span data-stu-id="4e413-108">A host instance runs as a Windows Service on the designated [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer(s).</span></span> <span data-ttu-id="4e413-109">虽然不能在给定 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上运行同一主机的多个实例，但通过在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 组中的单独 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上配置主机实例，可以运行特定主机的多个实例。</span><span class="sxs-lookup"><span data-stu-id="4e413-109">Although it is not possible to run multiple instances of the same host on a given [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, you can run multiple instances of a particular host by configuring instances of the host on separate [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers in a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group.</span></span> <span data-ttu-id="4e413-110">您还可以在单一 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上运行不同主机的多个实例。</span><span class="sxs-lookup"><span data-stu-id="4e413-110">You can also run multiple instances of different hosts on a single [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer.</span></span>  
  
 <span data-ttu-id="4e413-111">BizTalk 主机中包含的项可以执行以下功能：</span><span class="sxs-lookup"><span data-stu-id="4e413-111">Items that are contained in BizTalk hosts can perform the following functions:</span></span>  
  
-   <span data-ttu-id="4e413-112">**接收**后会选取在接收位置，这些项执行操作初始消息的处理。</span><span class="sxs-lookup"><span data-stu-id="4e413-112">**Receiving** These items do the initial processing of messages after they are picked up in a receive location.</span></span> <span data-ttu-id="4e413-113">当主机包含接收项（例如接收位置或管道）时，该主机将充当安全边界，而且消息的解码和解密都将发生在主机内的管道中。</span><span class="sxs-lookup"><span data-stu-id="4e413-113">When a host contains a receiving item, such as a receive location or pipeline, it acts as a security boundary, and the message decoding and decrypting occurs in a pipeline within the host.</span></span>  
  
-   <span data-ttu-id="4e413-114">**发送**它们发送到发送端口之前，这些项执行操作消息的最终处理。</span><span class="sxs-lookup"><span data-stu-id="4e413-114">**Sending** These items do the final processing of messages before they are sent out to the send port.</span></span> <span data-ttu-id="4e413-115">当主机包含发送项（例如发送端口或管道）时，该主机将充当安全边界，而且消息的签名和加密都将发生在主机内的管道中。</span><span class="sxs-lookup"><span data-stu-id="4e413-115">When a host contains a sending item, such as a send port or pipeline, the host acts as a security boundary, and the message signing and encryption occurs in a pipeline within the host.</span></span>  
  
-   <span data-ttu-id="4e413-116">**处理**这些项处理基于业务流程中的说明进行操作的消息。</span><span class="sxs-lookup"><span data-stu-id="4e413-116">**Processing** These items process messages based on the instructions in an orchestration.</span></span>  
  
 <span data-ttu-id="4e413-117">虽然单一 BizTalk 主机可以包含接收、发送和处理消息的项目，但为了创建安全边界以及出于管理简易性和可伸缩性原因，最佳做法是为每个功能创建不同的主机。</span><span class="sxs-lookup"><span data-stu-id="4e413-117">Although a single BizTalk Host can contain items that receive, send, and process messages, it is considered a best practice to create different hosts for each function to create security boundaries and for easier management and scalability.</span></span> <span data-ttu-id="4e413-118">特别是，建议对于处理操作和接收/发送操作分别使用不同的主机，并且分隔可信任项和不可信任项。</span><span class="sxs-lookup"><span data-stu-id="4e413-118">In particular, we recommend that you use different hosts for processing and for receive/send operations, and that you separate trusted and non-trusted items.</span></span>  
  
 <span data-ttu-id="4e413-119">例如，如果您接收一条消息，运行业务流程，然后发送十条消息，则需要将接收功能和发送功能分隔到两个单独的主机中，因为发送项的流量将是接收项的十倍。</span><span class="sxs-lookup"><span data-stu-id="4e413-119">For example, if you receive one message, run an orchestration, and send ten messages, you want to separate the receive and send functionality into two separate hosts because the send items will have ten times more traffic than the receive items.</span></span> <span data-ttu-id="4e413-120">如果您接收一条消息，运行业务流程，然后发送一条消息，则可以将这些项视为一个工作单位，并将它们分到单个主机中。</span><span class="sxs-lookup"><span data-stu-id="4e413-120">If you receive one message, run an orchestration, and send one message, you can think of these items as a unit of work and group them into one single host.</span></span> <span data-ttu-id="4e413-121">或者，可以将它们分到三个不同的主机中，以提高性能和灵活性。</span><span class="sxs-lookup"><span data-stu-id="4e413-121">Alternatively, you can separate them into three different hosts to increase performance and flexibility.</span></span>  
  
 <span data-ttu-id="4e413-122">BizTalk 主机是两种类型之一**进程内**或**Isolated**。</span><span class="sxs-lookup"><span data-stu-id="4e413-122">BizTalk hosts are one of two types, **In-process** or **Isolated**.</span></span> <span data-ttu-id="4e413-123">进程内主机在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 运行时进程内运行，而独立的主机不在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 运行时进程中运行。</span><span class="sxs-lookup"><span data-stu-id="4e413-123">In-process hosts run inside of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] runtime process whereas Isolated hosts do not run in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] runtime process.</span></span> <span data-ttu-id="4e413-124">下表分别列出了这两种主机类型可能包含的项：</span><span class="sxs-lookup"><span data-stu-id="4e413-124">The following table lists the items that each of these host types may contain.</span></span>  
  
|<span data-ttu-id="4e413-125">**主机类型**</span><span class="sxs-lookup"><span data-stu-id="4e413-125">**Host Type**</span></span>|<span data-ttu-id="4e413-126">**逻辑容器**</span><span class="sxs-lookup"><span data-stu-id="4e413-126">**Logical container for**</span></span>|  
|-------------------|-------------------------------|  
|<span data-ttu-id="4e413-127">进程内</span><span class="sxs-lookup"><span data-stu-id="4e413-127">In-Process</span></span>|<span data-ttu-id="4e413-128">-业务流程</span><span class="sxs-lookup"><span data-stu-id="4e413-128">-   Orchestrations</span></span><br /><span data-ttu-id="4e413-129">-适配器发送处理程序</span><span class="sxs-lookup"><span data-stu-id="4e413-129">-   Adapter Send Handlers</span></span><br /><span data-ttu-id="4e413-130">-适配器接收 HTTP 和 SOAP 以外的处理程序</span><span class="sxs-lookup"><span data-stu-id="4e413-130">-   Adapter Receive Handlers other than HTTP and SOAP</span></span>|  
|<span data-ttu-id="4e413-131">隔离</span><span class="sxs-lookup"><span data-stu-id="4e413-131">Isolated</span></span>|<span data-ttu-id="4e413-132">HTTP 和 SOAP 接收处理程序</span><span class="sxs-lookup"><span data-stu-id="4e413-132">HTTP and SOAP Receive Handlers</span></span>|  
  
 <span data-ttu-id="4e413-133">有关主机和主机实例的详细信息，请参阅[管理 BizTalk 主机和主机实例](../core/managing-biztalk-hosts-and-host-instances.md)。</span><span class="sxs-lookup"><span data-stu-id="4e413-133">For more information about hosts and host instances, see [Managing BizTalk Hosts and Host Instances](../core/managing-biztalk-hosts-and-host-instances.md).</span></span>  
  
 <span data-ttu-id="4e413-134">为确保 BizTalk 主机的高可用性，您的环境（包含两台或更多 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机）中的每个主机必须具有两个或更多主机实例。</span><span class="sxs-lookup"><span data-stu-id="4e413-134">To provide high availability for BizTalk hosts, you must have two or more host instances for each host in your environment (on two or more [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers).</span></span> <span data-ttu-id="4e413-135">通过为每个主机创建多个主机实例，可以确保在一个主机实例不可用时，运行该主机的实例的其他计算机可恢复有问题或失败的主机实例的功能，并确保整个系统可以继续工作，最大程度地减少中断时间。</span><span class="sxs-lookup"><span data-stu-id="4e413-135">By having more than one host instance for each host you ensure that if one host instance becomes unavailable, the other computers that are running instances of that host can resume the functions of the problematic or failed host instance, and that the overall system can continue performing with minimal disruption.</span></span>  
  
## <a name="message-persistence"></a><span data-ttu-id="4e413-136">消息持久性</span><span class="sxs-lookup"><span data-stu-id="4e413-136">Message Persistence</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="4e413-137"> 的高可用性在很大程度上依赖于 [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]，因为 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中涉及的每个主机都将消息保存到 BizTalk MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="4e413-137"> relies heavily on [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] for high availability because every host involved in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] persists messages to the BizTalk MessageBox database.</span></span> <span data-ttu-id="4e413-138">例如，当[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]接收传入消息时，接收主机将其保存到 MessageBox 数据库之前的其他主机检索业务流程处理和发送的消息。</span><span class="sxs-lookup"><span data-stu-id="4e413-138">For example, when [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] receives an incoming message, the receive host persists it to the MessageBox database before other hosts retrieve the message for orchestration processing and sending.</span></span>  
  
 <span data-ttu-id="4e413-139">如果 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 解决方案包含业务流程，则 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 会将消息路由到执行业务程序的主机（处理主机），并在业务流程完成后将消息保存到 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="4e413-139">If your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution involves orchestration, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] routes the message to the host that executes the business process (processing host), and saves the message to the MessageBox database after the orchestration finishes.</span></span> <span data-ttu-id="4e413-140">随后，发送主机将从 MessageBox 数据库中检索消息，再通过相应的发送适配器将该消息发送到外部应用程序。</span><span class="sxs-lookup"><span data-stu-id="4e413-140">The sending host then retrieves the message from the MessageBox database before sending it to the external application through the appropriate send adapter.</span></span>  
  
## <a name="separating-the-host-and-database-functions"></a><span data-ttu-id="4e413-141">分隔主机功能和数据库功能</span><span class="sxs-lookup"><span data-stu-id="4e413-141">Separating the Host and Database Functions</span></span>  
 <span data-ttu-id="4e413-142">由于 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 可以分隔数据与处理数据的主机，因此您可以将在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中执行的主机功能（发送、接收和处理）与在 [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] 中执行的数据库功能分开，以创建高可用性环境。</span><span class="sxs-lookup"><span data-stu-id="4e413-142">Because [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] separates the data from the hosts that process the data, one step that you can take to create a highly available environment is to separate the host functions (sending, receiving, and processing) that occur in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] from the database functions that occur in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="4e413-143">通过分隔这些功能，您可以独立地扩展处理、发送和接收主机功能以及存储数据的数据库。</span><span class="sxs-lookup"><span data-stu-id="4e413-143">By separating these functions, you can independently scale the processing, sending, and receiving hosts and the databases that store the data.</span></span> <span data-ttu-id="4e413-144">运行时层与数据库层是相关的，即，如果增加 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机的数目，就很可能需要增加运行 [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] 的计算机的数目才能处理附加负载。</span><span class="sxs-lookup"><span data-stu-id="4e413-144">The runtime and database layers are related, that is, if you increase the number of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers you will likely need to increase the number of computers that are running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] to handle the additional load.</span></span> <span data-ttu-id="4e413-145">但是，在数据库层和 BizTalk 层之间并没有直接关系。</span><span class="sxs-lookup"><span data-stu-id="4e413-145">However, there is no direct relationship between the database layer and the BizTalk layer.</span></span> <span data-ttu-id="4e413-146">它们是两个独立的层，您可以单独地扩展它们。</span><span class="sxs-lookup"><span data-stu-id="4e413-146">They are two independent layers and you can scale them out separately.</span></span>  
  
 <span data-ttu-id="4e413-147">确保主机高度可用所要执行的操作不同于确保数据库高度可用所要执行的操作。</span><span class="sxs-lookup"><span data-stu-id="4e413-147">What you must do to make the hosts highly available is different from what you must do to make the databases highly available.</span></span> <span data-ttu-id="4e413-148">以下部分说明了确保接收主机、发送主机和处理主机高度可用所要执行的操作。</span><span class="sxs-lookup"><span data-stu-id="4e413-148">The following sections explain what you must do to make the receiving, sending, and processing hosts highly available.</span></span> <span data-ttu-id="4e413-149">有关如何使数据库层高度可用的详细信息，请参阅[BizTalk Server 数据库提供高可用性](../core/providing-high-availability-for-biztalk-server-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="4e413-149">For more information about how to make the database layer highly available, see [Providing High Availability for BizTalk Server Databases](../core/providing-high-availability-for-biztalk-server-databases.md).</span></span>  
  
 <span data-ttu-id="4e413-150">对于 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 进程多于 SQL Server 进程的部署，您可以配置多台 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机来使用运行 SQL Server 的同一计算机。</span><span class="sxs-lookup"><span data-stu-id="4e413-150">For deployments where [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] processes more than SQL Server processes, you can configure multiple [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers that use the same computer that is running SQL Server.</span></span> <span data-ttu-id="4e413-151">此配置可使用每台计算机上可用的资源。</span><span class="sxs-lookup"><span data-stu-id="4e413-151">This configuration uses the resources available on each computer.</span></span> <span data-ttu-id="4e413-152">例如，如果 CPU 或内存在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机上的使用率很高（大于 75%），而在运行 SQL Server 的计算机上使用率很低（小于 25%），则您可以向其他 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 计算机分配工作负荷，同时提高运行 SQL Server 的计算机的资源使用率。</span><span class="sxs-lookup"><span data-stu-id="4e413-152">For example, if CPU or memory use runs high (more than 75 percent) on the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer but runs low (less than 25 percent) on the computer that is running SQL Server, you can include additional [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computers to distribute the workload while raising the resource utilization on the computer that is running SQL Server.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="4e413-153">本节内容</span><span class="sxs-lookup"><span data-stu-id="4e413-153">In This Section</span></span>  
  
-   [<span data-ttu-id="4e413-154">向外扩展接收主机</span><span class="sxs-lookup"><span data-stu-id="4e413-154">Scaled-Out Receiving Hosts</span></span>](../core/scaled-out-receiving-hosts.md)  
  
-   [<span data-ttu-id="4e413-155">向外扩展的处理主机</span><span class="sxs-lookup"><span data-stu-id="4e413-155">Scaled-Out Processing Hosts</span></span>](../core/scaled-out-processing-hosts.md)  
  
-   [<span data-ttu-id="4e413-156">向外扩展的发送主机</span><span class="sxs-lookup"><span data-stu-id="4e413-156">Scaled-Out Sending Hosts</span></span>](../core/scaled-out-sending-hosts.md)  
  
-   [<span data-ttu-id="4e413-157">Windows Server 群集用于 BizTalk Server Hosts2 为提供高可用性</span><span class="sxs-lookup"><span data-stu-id="4e413-157">Using Windows Server Cluster to Provide High Availability for BizTalk Server Hosts2</span></span>](../core/use-windows-cluster-to-provide-high-availability-for-biztalk-hosts.md)  
  
## <a name="see-also"></a><span data-ttu-id="4e413-158">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4e413-158">See Also</span></span>  
 <span data-ttu-id="4e413-159">[为 BizTalk Server 数据库提供高可用性](../core/providing-high-availability-for-biztalk-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="4e413-159">[Providing High Availability for BizTalk Server Databases](../core/providing-high-availability-for-biztalk-server-databases.md) </span></span>  
 [<span data-ttu-id="4e413-160">为企业单一登录的高可用性</span><span class="sxs-lookup"><span data-stu-id="4e413-160">High Availability for Enterprise Single Sign-On</span></span>](../core/high-availability-for-enterprise-single-sign-on.md)