---
title: 活动数据存储 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- performance, BAM
- databases [BAM], performance
- activities [BAM], peformance
- databases [BAM], partitioning
- BAM, performance
ms.assetid: 1f736599-3d16-496e-a459-8b0507d57fcb
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: cd0a4744f5022bfdc466460a25def23ea362d7b6
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65361690"
---
# <a name="activity-data-storage"></a><span data-ttu-id="7f51b-102">活动数据存储</span><span class="sxs-lookup"><span data-stu-id="7f51b-102">Activity Data Storage</span></span>
<span data-ttu-id="7f51b-103">本主题介绍活动数据存储，随着时间推移，活动表中的增长和 BAM 如何解决了进行中的活动和已完成的活动的单独表的这些性能问题导致的性能问题。</span><span class="sxs-lookup"><span data-stu-id="7f51b-103">This topic describes activity data storage, the performance problems caused by the growth of activity tables over time, and how BAM solves these performance problems with separate tables for activities in progress and completed activities.</span></span> <span data-ttu-id="7f51b-104">本主题还介绍用于查询数据，以及如何使用更高的性能在 BAM 中的分区的联机时段。</span><span class="sxs-lookup"><span data-stu-id="7f51b-104">This topic also describes the online window for querying data, and how you can use partitioning in BAM for higher performance.</span></span>  
  
 <span data-ttu-id="7f51b-105">活动数据存储的基本理念是具有一个单独的表的每个活动类型，在其中每个记录表示不同的活动实例 （例如，正在进行中或已完成）。</span><span class="sxs-lookup"><span data-stu-id="7f51b-105">The basic idea of activity data storage is to have a separate table for each activity type, in which each record represents a different activity instance (for example, in-progress or completed).</span></span>  
  
 <span data-ttu-id="7f51b-106">在此示例中，如果活动为采购订单表将所示，如下所示：</span><span class="sxs-lookup"><span data-stu-id="7f51b-106">In this example, if the activity were Purchase Order the table would look as follows:</span></span>  
  
|<span data-ttu-id="7f51b-107">PO#</span><span class="sxs-lookup"><span data-stu-id="7f51b-107">PO#</span></span>|<span data-ttu-id="7f51b-108">RecvTime</span><span class="sxs-lookup"><span data-stu-id="7f51b-108">RecvTime</span></span>|<span data-ttu-id="7f51b-109">City</span><span class="sxs-lookup"><span data-stu-id="7f51b-109">City</span></span>|<span data-ttu-id="7f51b-110">Quantity</span><span class="sxs-lookup"><span data-stu-id="7f51b-110">Quantity</span></span>|<span data-ttu-id="7f51b-111">ShipTime</span><span class="sxs-lookup"><span data-stu-id="7f51b-111">ShipTime</span></span>|<span data-ttu-id="7f51b-112">DeliveryTime</span><span class="sxs-lookup"><span data-stu-id="7f51b-112">DeliveryTime</span></span>|  
|----------|--------------|----------|--------------|--------------|------------------|  
|<span data-ttu-id="7f51b-113">123</span><span class="sxs-lookup"><span data-stu-id="7f51b-113">123</span></span>|<span data-ttu-id="7f51b-114">上午 8:00</span><span class="sxs-lookup"><span data-stu-id="7f51b-114">8:00am</span></span>|<span data-ttu-id="7f51b-115">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-115">Seattle</span></span>|<span data-ttu-id="7f51b-116">150</span><span class="sxs-lookup"><span data-stu-id="7f51b-116">150</span></span>|<span data-ttu-id="7f51b-117">8:24 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-117">8:24am</span></span>|<span data-ttu-id="7f51b-118">12:45 pm</span><span class="sxs-lookup"><span data-stu-id="7f51b-118">12:45pm</span></span>|  
|<span data-ttu-id="7f51b-119">124</span><span class="sxs-lookup"><span data-stu-id="7f51b-119">124</span></span>|<span data-ttu-id="7f51b-120">上午 8:30</span><span class="sxs-lookup"><span data-stu-id="7f51b-120">8:30am</span></span>|<span data-ttu-id="7f51b-121">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-121">Seattle</span></span>|<span data-ttu-id="7f51b-122">234</span><span class="sxs-lookup"><span data-stu-id="7f51b-122">234</span></span>|<span data-ttu-id="7f51b-123">8:45 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-123">8:45am</span></span>|<span data-ttu-id="7f51b-124">下午 1:20</span><span class="sxs-lookup"><span data-stu-id="7f51b-124">1:20pm</span></span>|  
|<span data-ttu-id="7f51b-125">125</span><span class="sxs-lookup"><span data-stu-id="7f51b-125">125</span></span>|<span data-ttu-id="7f51b-126">上午 8:35</span><span class="sxs-lookup"><span data-stu-id="7f51b-126">8:35am</span></span>|<span data-ttu-id="7f51b-127">Redmond</span><span class="sxs-lookup"><span data-stu-id="7f51b-127">Redmond</span></span>|<span data-ttu-id="7f51b-128">87</span><span class="sxs-lookup"><span data-stu-id="7f51b-128">87</span></span>|<span data-ttu-id="7f51b-129">9:05 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-129">9:05am</span></span>|<span data-ttu-id="7f51b-130">下午 2:30</span><span class="sxs-lookup"><span data-stu-id="7f51b-130">2:30pm</span></span>|  
|<span data-ttu-id="7f51b-131">126</span><span class="sxs-lookup"><span data-stu-id="7f51b-131">126</span></span>|<span data-ttu-id="7f51b-132">8:45 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-132">8:45am</span></span>|<span data-ttu-id="7f51b-133">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-133">Seattle</span></span>|<span data-ttu-id="7f51b-134">450</span><span class="sxs-lookup"><span data-stu-id="7f51b-134">450</span></span>|<span data-ttu-id="7f51b-135">上午 9:20</span><span class="sxs-lookup"><span data-stu-id="7f51b-135">9:20am</span></span>|<span data-ttu-id="7f51b-136">3:10 pm</span><span class="sxs-lookup"><span data-stu-id="7f51b-136">3:10pm</span></span>|  
|<span data-ttu-id="7f51b-137">127</span><span class="sxs-lookup"><span data-stu-id="7f51b-137">127</span></span>|<span data-ttu-id="7f51b-138">8:55 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-138">8:55am</span></span>|<span data-ttu-id="7f51b-139">Redmond</span><span class="sxs-lookup"><span data-stu-id="7f51b-139">Redmond</span></span>|<span data-ttu-id="7f51b-140">200</span><span class="sxs-lookup"><span data-stu-id="7f51b-140">200</span></span>|<span data-ttu-id="7f51b-141">上午 9:30</span><span class="sxs-lookup"><span data-stu-id="7f51b-141">9:30am</span></span>|<span data-ttu-id="7f51b-142">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-142">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-143">128</span><span class="sxs-lookup"><span data-stu-id="7f51b-143">128</span></span>|<span data-ttu-id="7f51b-144">8:57 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-144">8:57am</span></span>|<span data-ttu-id="7f51b-145">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-145">Seattle</span></span>|<span data-ttu-id="7f51b-146">340</span><span class="sxs-lookup"><span data-stu-id="7f51b-146">340</span></span>|<span data-ttu-id="7f51b-147">上午 9:20</span><span class="sxs-lookup"><span data-stu-id="7f51b-147">9:20am</span></span>|<span data-ttu-id="7f51b-148">3:05 pm</span><span class="sxs-lookup"><span data-stu-id="7f51b-148">3:05pm</span></span>|  
|<span data-ttu-id="7f51b-149">129</span><span class="sxs-lookup"><span data-stu-id="7f51b-149">129</span></span>|<span data-ttu-id="7f51b-150">上午 9:12 点</span><span class="sxs-lookup"><span data-stu-id="7f51b-150">9:12am</span></span>|<span data-ttu-id="7f51b-151">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-151">Seattle</span></span>|<span data-ttu-id="7f51b-152">120</span><span class="sxs-lookup"><span data-stu-id="7f51b-152">120</span></span>|<span data-ttu-id="7f51b-153">9:45 am</span><span class="sxs-lookup"><span data-stu-id="7f51b-153">9:45am</span></span>|<span data-ttu-id="7f51b-154">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-154">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-155">130</span><span class="sxs-lookup"><span data-stu-id="7f51b-155">130</span></span>|<span data-ttu-id="7f51b-156">上午 9:30</span><span class="sxs-lookup"><span data-stu-id="7f51b-156">9:30am</span></span>|<span data-ttu-id="7f51b-157">Redmond</span><span class="sxs-lookup"><span data-stu-id="7f51b-157">Redmond</span></span>|<span data-ttu-id="7f51b-158">25</span><span class="sxs-lookup"><span data-stu-id="7f51b-158">25</span></span>|<span data-ttu-id="7f51b-159">上午 10:15</span><span class="sxs-lookup"><span data-stu-id="7f51b-159">10:15am</span></span>|<span data-ttu-id="7f51b-160">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-160">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-161">131</span><span class="sxs-lookup"><span data-stu-id="7f51b-161">131</span></span>|<span data-ttu-id="7f51b-162">9:45</span><span class="sxs-lookup"><span data-stu-id="7f51b-162">9:45</span></span>|<span data-ttu-id="7f51b-163">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-163">Seattle</span></span>|<span data-ttu-id="7f51b-164">250</span><span class="sxs-lookup"><span data-stu-id="7f51b-164">250</span></span>|<span data-ttu-id="7f51b-165">上午 10:35</span><span class="sxs-lookup"><span data-stu-id="7f51b-165">10:35am</span></span>|<span data-ttu-id="7f51b-166">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-166">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-167">132</span><span class="sxs-lookup"><span data-stu-id="7f51b-167">132</span></span>|<span data-ttu-id="7f51b-168">上午 10:00</span><span class="sxs-lookup"><span data-stu-id="7f51b-168">10:00am</span></span>|<span data-ttu-id="7f51b-169">Redmond</span><span class="sxs-lookup"><span data-stu-id="7f51b-169">Redmond</span></span>|<span data-ttu-id="7f51b-170">100</span><span class="sxs-lookup"><span data-stu-id="7f51b-170">100</span></span>|<span data-ttu-id="7f51b-171">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-171">\<NULL\></span></span>|<span data-ttu-id="7f51b-172">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-172">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-173">133</span><span class="sxs-lookup"><span data-stu-id="7f51b-173">133</span></span>|<span data-ttu-id="7f51b-174">上午 10:15</span><span class="sxs-lookup"><span data-stu-id="7f51b-174">10:15am</span></span>|<span data-ttu-id="7f51b-175">Seattle</span><span class="sxs-lookup"><span data-stu-id="7f51b-175">Seattle</span></span>|<span data-ttu-id="7f51b-176">230</span><span class="sxs-lookup"><span data-stu-id="7f51b-176">230</span></span>|<span data-ttu-id="7f51b-177">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-177">\<NULL\></span></span>|<span data-ttu-id="7f51b-178">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-178">\<NULL\></span></span>|  
|<span data-ttu-id="7f51b-179">134</span><span class="sxs-lookup"><span data-stu-id="7f51b-179">134</span></span>|<span data-ttu-id="7f51b-180">上午 10:25</span><span class="sxs-lookup"><span data-stu-id="7f51b-180">10:25am</span></span>|<span data-ttu-id="7f51b-181">Redmond</span><span class="sxs-lookup"><span data-stu-id="7f51b-181">Redmond</span></span>|<span data-ttu-id="7f51b-182">45</span><span class="sxs-lookup"><span data-stu-id="7f51b-182">45</span></span>|<span data-ttu-id="7f51b-183">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-183">\<NULL\></span></span>|<span data-ttu-id="7f51b-184">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="7f51b-184">\<NULL\></span></span>|  
  
 <span data-ttu-id="7f51b-185">在此表中，当 BAM 接收新的采购订单，它将插入新行，一些设置为非 null 值 （例如，RecvTime、 城市、 数量等） 的某些列。</span><span class="sxs-lookup"><span data-stu-id="7f51b-185">In this table, when BAM receives a new purchase order, it inserts a new row and some sets some of the columns to non-null values (RecvTime, City, Quantity, and so on).</span></span> <span data-ttu-id="7f51b-186">更高版本，当您批准并发布此采购订单，BAM 会将 ShipTime 设置为非 null 值。</span><span class="sxs-lookup"><span data-stu-id="7f51b-186">Later, when you approve and ship this purchase order, BAM sets ShipTime to a non-null value.</span></span> <span data-ttu-id="7f51b-187">最后，当接收和确认货物时，BAM 会将 DeliveryTime 设置为非 null 值。</span><span class="sxs-lookup"><span data-stu-id="7f51b-187">Finally, when you receive and confirm the shipment, BAM sets DeliveryTime to a non-null value.</span></span>  
  
 <span data-ttu-id="7f51b-188">随着时间迅速下降的这个简单的实施性能。</span><span class="sxs-lookup"><span data-stu-id="7f51b-188">The performance of this simplistic implementation quickly degrades over time.</span></span> <span data-ttu-id="7f51b-189">在开始时，性能受 SQL server 可执行 (实质上是 CPU 绑定)、 事务数但在一些时间，急剧下降。</span><span class="sxs-lookup"><span data-stu-id="7f51b-189">In the beginning, the performance is limited by the number of the transactions the SQL server can perform (essentially CPU bound), but after some time, it drops drastically.</span></span> <span data-ttu-id="7f51b-190">在同一时间，磁盘 IO 的平均队列长度增加到超出可接受的限制：</span><span class="sxs-lookup"><span data-stu-id="7f51b-190">At the same time, the average queue length for disk IO increases beyond the acceptable limits:</span></span>  
  
 <span data-ttu-id="7f51b-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span><span class="sxs-lookup"><span data-stu-id="7f51b-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span></span>  
<span data-ttu-id="7f51b-192">BAM 写入性能与磁盘队列长度</span><span class="sxs-lookup"><span data-stu-id="7f51b-192">BAM Write Performance versus Disk Queue Length</span></span>  
  
 <span data-ttu-id="7f51b-193">这样做的原因是表的大小增长随着更多的业务流程实例完整。</span><span class="sxs-lookup"><span data-stu-id="7f51b-193">The reason for this is that the size of the table grows as more instances of the business process complete.</span></span> <span data-ttu-id="7f51b-194">例如，第一次，UPDATE 语句的存储的过程会导致搜索上的聚集索引的采购订单号和将在内存中的某些页读入。</span><span class="sxs-lookup"><span data-stu-id="7f51b-194">For example, the first time, the UPDATE statement of the stored procedure causes a search on the clustered index for purchase order number and reads some pages in memory.</span></span> <span data-ttu-id="7f51b-195">因为采购订单流程的实例是独立 （某些需要较长的时间，但某些较短），存储过程的后续调用可能是一些其他采购订单实例，因此将需要不同的数据页在内存中读取。</span><span class="sxs-lookup"><span data-stu-id="7f51b-195">Since the instances of the purchase order process are independent (some take a long time, but some are short), the next call to the stored procedure may be for some other purchase order instance and therefore will require reading of different data pages in memory.</span></span> <span data-ttu-id="7f51b-196">只要采购订单记录的总数很小，SQL Server 将缓存在内存中的所有数据页。</span><span class="sxs-lookup"><span data-stu-id="7f51b-196">As long as the total number of purchase order records is small, SQL Server will cache all data pages in memory.</span></span> <span data-ttu-id="7f51b-197">当记录数增长到足够大时，缓存命中率将降低，并且每个操作需要读取物理磁盘。</span><span class="sxs-lookup"><span data-stu-id="7f51b-197">When the number of the records grows large enough, the cache-hit ratio decreases and each operation requires a physical disk read.</span></span> <span data-ttu-id="7f51b-198">显然，在这种情况下对表执行任何查询活动不是可能的。</span><span class="sxs-lookup"><span data-stu-id="7f51b-198">Apparently, in this situation no query activity against the table is possible.</span></span>  
  
## <a name="bam-tables"></a><span data-ttu-id="7f51b-199">BAM 表</span><span class="sxs-lookup"><span data-stu-id="7f51b-199">BAM tables</span></span>  
 <span data-ttu-id="7f51b-200">若要避免此问题，BAM 使用已完成与下图中的两个单独的表 – 一个用于仍在进行中，活动，另一个：</span><span class="sxs-lookup"><span data-stu-id="7f51b-200">To avoid this problem BAM uses two separate tables – one for the activities still in progress, and another for the completed ones in the following figure:</span></span>  
  
 <span data-ttu-id="7f51b-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span><span class="sxs-lookup"><span data-stu-id="7f51b-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span></span>  
<span data-ttu-id="7f51b-202">BAM 表</span><span class="sxs-lookup"><span data-stu-id="7f51b-202">BAM Tables</span></span>  
  
 <span data-ttu-id="7f51b-203">在此图中，基本思想是使相对较小的表中发生更新的另一种不断增大，但可递增访问 (只使用 Insert)。</span><span class="sxs-lookup"><span data-stu-id="7f51b-203">In this figure, the idea is to keep a relatively small table that updates occur in and another that grows large, but is incrementally accessed (INSERTs only).</span></span> <span data-ttu-id="7f51b-204">在示例中，仅在当前正在处理的订单将在活动表中，在已传递的所有订单将都进入已完成的表。</span><span class="sxs-lookup"><span data-stu-id="7f51b-204">In the example, only the orders being processed at the moment will be in the active table, while all orders that were already delivered will go to the completed table.</span></span>  
  
 <span data-ttu-id="7f51b-205">由于存在触发器，此表的结构比在开始时，单个表的 INSERT/UPDATE 慢，但会维护随着时间的推移稳定的写入性能。</span><span class="sxs-lookup"><span data-stu-id="7f51b-205">Because of the trigger, this structure of tables is slower than an INSERT/UPDATE of a single table at the beginning, but maintains stable write performance over time.</span></span>  
  
## <a name="online-window-for-activity-data"></a><span data-ttu-id="7f51b-206">活动数据的联机时段</span><span class="sxs-lookup"><span data-stu-id="7f51b-206">Online Window for activity data</span></span>  
 <span data-ttu-id="7f51b-207">活动存储主要处理对当前或最近完成的活动的查询。</span><span class="sxs-lookup"><span data-stu-id="7f51b-207">Activity storage primarily handles queries for current or recently completed activities.</span></span> <span data-ttu-id="7f51b-208">BAM 存档，然后从 BAM 主导入数据库中清除非常旧的、 已完成的活动。</span><span class="sxs-lookup"><span data-stu-id="7f51b-208">BAM archives and then purges very old, completed activities from the BAM Primary Import database.</span></span> <span data-ttu-id="7f51b-209">因此活动数据将流过 BAM 和在可配置的联机时段都可用于查询。</span><span class="sxs-lookup"><span data-stu-id="7f51b-209">Thus the activity data flows through BAM and is available for queries during a configurable Online Window.</span></span>  
  
## <a name="bam-partitioning"></a><span data-ttu-id="7f51b-210">BAM 分区</span><span class="sxs-lookup"><span data-stu-id="7f51b-210">BAM partitioning</span></span>  
 <span data-ttu-id="7f51b-211">若要为提高性能并避免停机时间，活动存储使用分区时活动的完成基于时间戳。</span><span class="sxs-lookup"><span data-stu-id="7f51b-211">To allow for higher performance and avoid downtime, activity storage uses partitioning based on the time stamp when the activity was completed.</span></span> <span data-ttu-id="7f51b-212">BAM 通过与另一个空表的格式完全相同的已完成表定期交换来此实现。</span><span class="sxs-lookup"><span data-stu-id="7f51b-212">BAM achieves this by regular swapping of the completed table with another empty table of exactly the same format.</span></span> <span data-ttu-id="7f51b-213">BAM 完成此，一旦进一步已完成的活动进入新表中，而 BAM 将保留旧证书仅供查询，如图所示：</span><span class="sxs-lookup"><span data-stu-id="7f51b-213">Once BAM does this, the further completed activities go into the new table, while BAM keeps the old one only for queries, as in the following figure:</span></span>  
  
 <span data-ttu-id="7f51b-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span><span class="sxs-lookup"><span data-stu-id="7f51b-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span></span>  
<span data-ttu-id="7f51b-215">BAM 分区交换</span><span class="sxs-lookup"><span data-stu-id="7f51b-215">BAM Partition Swapping</span></span>  
  
 <span data-ttu-id="7f51b-216">后一个分区完全联机时段之外，BAM 存档，然后删除它。</span><span class="sxs-lookup"><span data-stu-id="7f51b-216">Once a partition is completely outside the online window, BAM archives and then drops it.</span></span> <span data-ttu-id="7f51b-217">为了尽量减少用户这种复杂性，BAM 还维护分区的视图的窗体：</span><span class="sxs-lookup"><span data-stu-id="7f51b-217">To minimize this complexity from the user, BAM also maintains a partitioned view of the form:</span></span>  
  
```  
SELECT * FROM Active   
UNION ALL   
SELECT * FROM Completed   
UNION ALL  
  
```  
  
 <span data-ttu-id="7f51b-218">BAM 会自动重新创建此视图每次创建或删除分区。</span><span class="sxs-lookup"><span data-stu-id="7f51b-218">BAM automatically re-creates this view each time it creates or drops a partition.</span></span>  
  
 <span data-ttu-id="7f51b-219">请注意以下关于 BAM 分区：</span><span class="sxs-lookup"><span data-stu-id="7f51b-219">Note the following about BAM partitioning:</span></span>  
  
-   <span data-ttu-id="7f51b-220">已分区视图的名称是**bam_\<ActivityName\>_AllInstances**。</span><span class="sxs-lookup"><span data-stu-id="7f51b-220">The name of the partitioned view is **bam_\<ActivityName\>_AllInstances**.</span></span> <span data-ttu-id="7f51b-221">此视图不适用于直接查询，但对 BAM 规范进行故障排除时可能很有用。</span><span class="sxs-lookup"><span data-stu-id="7f51b-221">This view is not meant for direct queries, but may be useful when troubleshooting the BAM instrumentation.</span></span> <span data-ttu-id="7f51b-222">您应查询每个类别创建在此视图顶部的业务用户的特定视图中的数据。</span><span class="sxs-lookup"><span data-stu-id="7f51b-222">You should query the data from the specific views for each category of business users that you create on top of this view.</span></span> <span data-ttu-id="7f51b-223">有关详细信息，请参阅[查询实例数据](../core/querying-instance-data.md)。</span><span class="sxs-lookup"><span data-stu-id="7f51b-223">For more information, see [Querying Instance Data](../core/querying-instance-data.md).</span></span>  
  
-   <span data-ttu-id="7f51b-224">通过修改的值设置联机时段**OnlineWindowTimeUnit**并**OnlineWindowLength**表中的当前活动的记录中**bam_Metadata_Activities**主导入数据库中。</span><span class="sxs-lookup"><span data-stu-id="7f51b-224">You set the online window by modifying the values for **OnlineWindowTimeUnit** and **OnlineWindowLength** in the record for the current activity in the table **bam_Metadata_Activities** in the Primary Import database.</span></span>  
  
-   <span data-ttu-id="7f51b-225">DTS 包， **BAM_DM_\<ActivityName\>**、 执行分区和存档/清除。</span><span class="sxs-lookup"><span data-stu-id="7f51b-225">The DTS package, **BAM_DM_\<ActivityName\>**, performs the partitioning and archiving/purging.</span></span> <span data-ttu-id="7f51b-226">每次运行此包，它将截断其他分区并存档/删除联机时段之外的所有分区。</span><span class="sxs-lookup"><span data-stu-id="7f51b-226">Each time this package runs, it truncates another partition and archives/drops all partitions that are outside the online window.</span></span>  
  
-   <span data-ttu-id="7f51b-227">如果没有配置存档数据库，然后 BAM 将删除旧的活动数据而不进行存档。</span><span class="sxs-lookup"><span data-stu-id="7f51b-227">If you do not have Archiving Database configured, then BAM drops the aged activity data without archiving.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7f51b-228">请参阅</span><span class="sxs-lookup"><span data-stu-id="7f51b-228">See Also</span></span>  
 [<span data-ttu-id="7f51b-229">BAM 动态基础结构</span><span class="sxs-lookup"><span data-stu-id="7f51b-229">BAM Dynamic Infrastructure</span></span>](../core/bam-dynamic-infrastructure.md)