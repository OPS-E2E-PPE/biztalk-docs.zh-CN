---
title: 活动数据存储 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- performance, BAM
- databases [BAM], performance
- activities [BAM], peformance
- databases [BAM], partitioning
- BAM, performance
ms.assetid: 1f736599-3d16-496e-a459-8b0507d57fcb
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 0139e76512eb9ca60089cb3c5f1e71b4f5524690
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2017
ms.locfileid: "25967019"
---
# <a name="activity-data-storage"></a><span data-ttu-id="d911d-102">活动数据存储</span><span class="sxs-lookup"><span data-stu-id="d911d-102">Activity Data Storage</span></span>
<span data-ttu-id="d911d-103">本主题介绍以下内容：关于活动数据存储的内容，由于活动表随着时间而不断增加所导致的性能问题，以及 BAM 如何通过对正进行的活动和已完成的活动使用不同的表来解决这些性能问题。</span><span class="sxs-lookup"><span data-stu-id="d911d-103">This topic describes activity data storage, the performance problems caused by the growth of activity tables over time, and how BAM solves these performance problems with separate tables for activities in progress and completed activities.</span></span> <span data-ttu-id="d911d-104">本主题还将介绍用于查询数据的联机时段，以及在 BAM 中如何使用分区来提高性能。</span><span class="sxs-lookup"><span data-stu-id="d911d-104">This topic also describes the online window for querying data, and how you can use partitioning in BAM for higher performance.</span></span>  
  
 <span data-ttu-id="d911d-105">活动数据存储的基本思想是，每种活动类型都具有各自的表，在表中的每条记录都代表一个不同的活动实例（例如，正进行的活动或者已完成的活动）。</span><span class="sxs-lookup"><span data-stu-id="d911d-105">The basic idea of activity data storage is to have a separate table for each activity type, in which each record represents a different activity instance (for example, in-progress or completed).</span></span>  
  
 <span data-ttu-id="d911d-106">在下面的示例中，如果活动为采购订单，则表将如下所示：</span><span class="sxs-lookup"><span data-stu-id="d911d-106">In this example, if the activity were Purchase Order the table would look as follows:</span></span>  
  
|<span data-ttu-id="d911d-107">PO#</span><span class="sxs-lookup"><span data-stu-id="d911d-107">PO#</span></span>|<span data-ttu-id="d911d-108">RecvTime</span><span class="sxs-lookup"><span data-stu-id="d911d-108">RecvTime</span></span>|<span data-ttu-id="d911d-109">City</span><span class="sxs-lookup"><span data-stu-id="d911d-109">City</span></span>|<span data-ttu-id="d911d-110">数量</span><span class="sxs-lookup"><span data-stu-id="d911d-110">Quantity</span></span>|<span data-ttu-id="d911d-111">ShipTime</span><span class="sxs-lookup"><span data-stu-id="d911d-111">ShipTime</span></span>|<span data-ttu-id="d911d-112">DeliveryTime</span><span class="sxs-lookup"><span data-stu-id="d911d-112">DeliveryTime</span></span>|  
|----------|--------------|----------|--------------|--------------|------------------|  
|<span data-ttu-id="d911d-113">123</span><span class="sxs-lookup"><span data-stu-id="d911d-113">123</span></span>|<span data-ttu-id="d911d-114">上午 8:00</span><span class="sxs-lookup"><span data-stu-id="d911d-114">8:00am</span></span>|<span data-ttu-id="d911d-115">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-115">Seattle</span></span>|<span data-ttu-id="d911d-116">150</span><span class="sxs-lookup"><span data-stu-id="d911d-116">150</span></span>|<span data-ttu-id="d911d-117">8:24 am</span><span class="sxs-lookup"><span data-stu-id="d911d-117">8:24am</span></span>|<span data-ttu-id="d911d-118">12:45pm</span><span class="sxs-lookup"><span data-stu-id="d911d-118">12:45pm</span></span>|  
|<span data-ttu-id="d911d-119">124</span><span class="sxs-lookup"><span data-stu-id="d911d-119">124</span></span>|<span data-ttu-id="d911d-120">上午 8:30</span><span class="sxs-lookup"><span data-stu-id="d911d-120">8:30am</span></span>|<span data-ttu-id="d911d-121">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-121">Seattle</span></span>|<span data-ttu-id="d911d-122">234</span><span class="sxs-lookup"><span data-stu-id="d911d-122">234</span></span>|<span data-ttu-id="d911d-123">8:45 am</span><span class="sxs-lookup"><span data-stu-id="d911d-123">8:45am</span></span>|<span data-ttu-id="d911d-124">下午 1:20</span><span class="sxs-lookup"><span data-stu-id="d911d-124">1:20pm</span></span>|  
|<span data-ttu-id="d911d-125">125</span><span class="sxs-lookup"><span data-stu-id="d911d-125">125</span></span>|<span data-ttu-id="d911d-126">上午 8:35</span><span class="sxs-lookup"><span data-stu-id="d911d-126">8:35am</span></span>|<span data-ttu-id="d911d-127">Redmond</span><span class="sxs-lookup"><span data-stu-id="d911d-127">Redmond</span></span>|<span data-ttu-id="d911d-128">87</span><span class="sxs-lookup"><span data-stu-id="d911d-128">87</span></span>|<span data-ttu-id="d911d-129">上午 9:05</span><span class="sxs-lookup"><span data-stu-id="d911d-129">9:05am</span></span>|<span data-ttu-id="d911d-130">2:30 pm</span><span class="sxs-lookup"><span data-stu-id="d911d-130">2:30pm</span></span>|  
|<span data-ttu-id="d911d-131">126</span><span class="sxs-lookup"><span data-stu-id="d911d-131">126</span></span>|<span data-ttu-id="d911d-132">8:45 am</span><span class="sxs-lookup"><span data-stu-id="d911d-132">8:45am</span></span>|<span data-ttu-id="d911d-133">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-133">Seattle</span></span>|<span data-ttu-id="d911d-134">450</span><span class="sxs-lookup"><span data-stu-id="d911d-134">450</span></span>|<span data-ttu-id="d911d-135">上午 9:20</span><span class="sxs-lookup"><span data-stu-id="d911d-135">9:20am</span></span>|<span data-ttu-id="d911d-136">3:10 pm</span><span class="sxs-lookup"><span data-stu-id="d911d-136">3:10pm</span></span>|  
|<span data-ttu-id="d911d-137">127</span><span class="sxs-lookup"><span data-stu-id="d911d-137">127</span></span>|<span data-ttu-id="d911d-138">上午 8:55</span><span class="sxs-lookup"><span data-stu-id="d911d-138">8:55am</span></span>|<span data-ttu-id="d911d-139">Redmond</span><span class="sxs-lookup"><span data-stu-id="d911d-139">Redmond</span></span>|<span data-ttu-id="d911d-140">200</span><span class="sxs-lookup"><span data-stu-id="d911d-140">200</span></span>|<span data-ttu-id="d911d-141">上午 9:30</span><span class="sxs-lookup"><span data-stu-id="d911d-141">9:30am</span></span>|<span data-ttu-id="d911d-142">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-142">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-143">128</span><span class="sxs-lookup"><span data-stu-id="d911d-143">128</span></span>|<span data-ttu-id="d911d-144">8:57 am</span><span class="sxs-lookup"><span data-stu-id="d911d-144">8:57am</span></span>|<span data-ttu-id="d911d-145">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-145">Seattle</span></span>|<span data-ttu-id="d911d-146">340</span><span class="sxs-lookup"><span data-stu-id="d911d-146">340</span></span>|<span data-ttu-id="d911d-147">上午 9:20</span><span class="sxs-lookup"><span data-stu-id="d911d-147">9:20am</span></span>|<span data-ttu-id="d911d-148">3:05 pm</span><span class="sxs-lookup"><span data-stu-id="d911d-148">3:05pm</span></span>|  
|<span data-ttu-id="d911d-149">129</span><span class="sxs-lookup"><span data-stu-id="d911d-149">129</span></span>|<span data-ttu-id="d911d-150">上午 9:12</span><span class="sxs-lookup"><span data-stu-id="d911d-150">9:12am</span></span>|<span data-ttu-id="d911d-151">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-151">Seattle</span></span>|<span data-ttu-id="d911d-152">120</span><span class="sxs-lookup"><span data-stu-id="d911d-152">120</span></span>|<span data-ttu-id="d911d-153">上午 9:45</span><span class="sxs-lookup"><span data-stu-id="d911d-153">9:45am</span></span>|<span data-ttu-id="d911d-154">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-154">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-155">130</span><span class="sxs-lookup"><span data-stu-id="d911d-155">130</span></span>|<span data-ttu-id="d911d-156">上午 9:30</span><span class="sxs-lookup"><span data-stu-id="d911d-156">9:30am</span></span>|<span data-ttu-id="d911d-157">Redmond</span><span class="sxs-lookup"><span data-stu-id="d911d-157">Redmond</span></span>|<span data-ttu-id="d911d-158">25</span><span class="sxs-lookup"><span data-stu-id="d911d-158">25</span></span>|<span data-ttu-id="d911d-159">10:15 am</span><span class="sxs-lookup"><span data-stu-id="d911d-159">10:15am</span></span>|<span data-ttu-id="d911d-160">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-160">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-161">131</span><span class="sxs-lookup"><span data-stu-id="d911d-161">131</span></span>|<span data-ttu-id="d911d-162">9:45</span><span class="sxs-lookup"><span data-stu-id="d911d-162">9:45</span></span>|<span data-ttu-id="d911d-163">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-163">Seattle</span></span>|<span data-ttu-id="d911d-164">250</span><span class="sxs-lookup"><span data-stu-id="d911d-164">250</span></span>|<span data-ttu-id="d911d-165">上午 10:35</span><span class="sxs-lookup"><span data-stu-id="d911d-165">10:35am</span></span>|<span data-ttu-id="d911d-166">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-166">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-167">132</span><span class="sxs-lookup"><span data-stu-id="d911d-167">132</span></span>|<span data-ttu-id="d911d-168">上午 10:00</span><span class="sxs-lookup"><span data-stu-id="d911d-168">10:00am</span></span>|<span data-ttu-id="d911d-169">Redmond</span><span class="sxs-lookup"><span data-stu-id="d911d-169">Redmond</span></span>|<span data-ttu-id="d911d-170">100</span><span class="sxs-lookup"><span data-stu-id="d911d-170">100</span></span>|<span data-ttu-id="d911d-171">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-171">\<NULL\></span></span>|<span data-ttu-id="d911d-172">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-172">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-173">133</span><span class="sxs-lookup"><span data-stu-id="d911d-173">133</span></span>|<span data-ttu-id="d911d-174">10:15 am</span><span class="sxs-lookup"><span data-stu-id="d911d-174">10:15am</span></span>|<span data-ttu-id="d911d-175">Seattle</span><span class="sxs-lookup"><span data-stu-id="d911d-175">Seattle</span></span>|<span data-ttu-id="d911d-176">230</span><span class="sxs-lookup"><span data-stu-id="d911d-176">230</span></span>|<span data-ttu-id="d911d-177">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-177">\<NULL\></span></span>|<span data-ttu-id="d911d-178">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-178">\<NULL\></span></span>|  
|<span data-ttu-id="d911d-179">134</span><span class="sxs-lookup"><span data-stu-id="d911d-179">134</span></span>|<span data-ttu-id="d911d-180">上午 10:25</span><span class="sxs-lookup"><span data-stu-id="d911d-180">10:25am</span></span>|<span data-ttu-id="d911d-181">Redmond</span><span class="sxs-lookup"><span data-stu-id="d911d-181">Redmond</span></span>|<span data-ttu-id="d911d-182">45</span><span class="sxs-lookup"><span data-stu-id="d911d-182">45</span></span>|<span data-ttu-id="d911d-183">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-183">\<NULL\></span></span>|<span data-ttu-id="d911d-184">\<NULL\></span><span class="sxs-lookup"><span data-stu-id="d911d-184">\<NULL\></span></span>|  
  
 <span data-ttu-id="d911d-185">在此表中，当 BAM 接收到新采购订单时，它将插入一个新行，并且将某些列（例如，RecvTime、城市、数量等）设置为非空值。</span><span class="sxs-lookup"><span data-stu-id="d911d-185">In this table, when BAM receives a new purchase order, it inserts a new row and some sets some of the columns to non-null values (RecvTime, City, Quantity, and so on).</span></span> <span data-ttu-id="d911d-186">随后，当审批此采购订单并发货时，BAM 会将 ShipTime 设置为非空值。</span><span class="sxs-lookup"><span data-stu-id="d911d-186">Later, when you approve and ship this purchase order, BAM sets ShipTime to a non-null value.</span></span> <span data-ttu-id="d911d-187">最后，当接收和确认货物时，BAM 会将 DeliveryTime 设置为非空值。</span><span class="sxs-lookup"><span data-stu-id="d911d-187">Finally, when you receive and confirm the shipment, BAM sets DeliveryTime to a non-null value.</span></span>  
  
 <span data-ttu-id="d911d-188">此采购订单的简单实现的性能将随着时间迅速下降。</span><span class="sxs-lookup"><span data-stu-id="d911d-188">The performance of this simplistic implementation quickly degrades over time.</span></span> <span data-ttu-id="d911d-189">在开始时，性能只受到 SQL Server 可执行的事务数的限制（实际上是 CPU 限制），但是一段时间后，其性能急剧下降。</span><span class="sxs-lookup"><span data-stu-id="d911d-189">In the beginning, the performance is limited by the number of the transactions the SQL server can perform (essentially CPU bound), but after some time, it drops drastically.</span></span> <span data-ttu-id="d911d-190">同时，磁盘 IO 的平均队列长度将超过可接受的程度。</span><span class="sxs-lookup"><span data-stu-id="d911d-190">At the same time, the average queue length for disk IO increases beyond the acceptable limits:</span></span>  
  
 <span data-ttu-id="d911d-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span><span class="sxs-lookup"><span data-stu-id="d911d-191">![](../core/media/ebiz-prog-bam-data-maint-fig4.gif "ebiz_prog_bam_data_maint_fig4")</span></span>  
<span data-ttu-id="d911d-192">BAM 写入性能与磁盘队列长度</span><span class="sxs-lookup"><span data-stu-id="d911d-192">BAM Write Performance versus Disk Queue Length</span></span>  
  
 <span data-ttu-id="d911d-193">出现此问题的原因在于，随着完成的业务流程实例的增多，表的大小也将不断增加。</span><span class="sxs-lookup"><span data-stu-id="d911d-193">The reason for this is that the size of the table grows as more instances of the business process complete.</span></span> <span data-ttu-id="d911d-194">例如，最初存储过程的 UPDATE 语句对采购订单号的聚集索引执行搜索，并将某些页读入内存。</span><span class="sxs-lookup"><span data-stu-id="d911d-194">For example, the first time, the UPDATE statement of the stored procedure causes a search on the clustered index for purchase order number and reads some pages in memory.</span></span> <span data-ttu-id="d911d-195">由于采购订单流程的实例是相互独立的（有些实例需要很长时间，有些实例则需要较短时间），对存储过程的下一次调用可能是为某个其他采购订单实例调用的，因而需要将不同的数据页读入内存。</span><span class="sxs-lookup"><span data-stu-id="d911d-195">Since the instances of the purchase order process are independent (some take a long time, but some are short), the next call to the stored procedure may be for some other purchase order instance and therefore will require reading of different data pages in memory.</span></span> <span data-ttu-id="d911d-196">只要采购订单记录的总数足够小，SQL Server 就能够将所有数据页都缓存到内存中。</span><span class="sxs-lookup"><span data-stu-id="d911d-196">As long as the total number of purchase order records is small, SQL Server will cache all data pages in memory.</span></span> <span data-ttu-id="d911d-197">当记录数增长到足够大时，高速缓存命中率将降低，每个操作就都需要读取物理磁盘。</span><span class="sxs-lookup"><span data-stu-id="d911d-197">When the number of the records grows large enough, the cache-hit ratio decreases and each operation requires a physical disk read.</span></span> <span data-ttu-id="d911d-198">显然，在这种情况下，不可能对表执行任何查询活动。</span><span class="sxs-lookup"><span data-stu-id="d911d-198">Apparently, in this situation no query activity against the table is possible.</span></span>  
  
## <a name="bam-tables"></a><span data-ttu-id="d911d-199">BAM 表</span><span class="sxs-lookup"><span data-stu-id="d911d-199">BAM tables</span></span>  
 <span data-ttu-id="d911d-200">为了避免出现这种问题 ， BAM 使用了两个不同的表 – 一个表用于正在处理的活动 ， 一个表用于已完成的活动 ， 如下图所示 ：</span><span class="sxs-lookup"><span data-stu-id="d911d-200">To avoid this problem BAM uses two separate tables – one for the activities still in progress, and another for the completed ones in the following figure:</span></span>  
  
 <span data-ttu-id="d911d-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span><span class="sxs-lookup"><span data-stu-id="d911d-201">![](../core/media/ebiz-prog-bam-data-maint-fig5.gif "ebiz_prog_bam_data_maint_fig5")</span></span>  
<span data-ttu-id="d911d-202">BAM 表</span><span class="sxs-lookup"><span data-stu-id="d911d-202">BAM Tables</span></span>  
  
 <span data-ttu-id="d911d-203">在此图中，基本思想是使进行更新的表相对较小，而另一个表可以不断增大，但可递增访问（只使用 INSERT）。</span><span class="sxs-lookup"><span data-stu-id="d911d-203">In this figure, the idea is to keep a relatively small table that updates occur in and another that grows large, but is incrementally accessed (INSERTs only).</span></span> <span data-ttu-id="d911d-204">在本例中，只有当时正在处理的订单才位于活动表中，而已交付的所有订单都将进入已完成的表中。</span><span class="sxs-lookup"><span data-stu-id="d911d-204">In the example, only the orders being processed at the moment will be in the active table, while all orders that were already delivered will go to the completed table.</span></span>  
  
 <span data-ttu-id="d911d-205">由于存在触发器，使用这种结构的表在开始时要比单个表的 INSERT/UPDATE 慢，但是可一直维持稳定的写入性能。</span><span class="sxs-lookup"><span data-stu-id="d911d-205">Because of the trigger, this structure of tables is slower than an INSERT/UPDATE of a single table at the beginning, but maintains stable write performance over time.</span></span>  
  
## <a name="online-window-for-activity-data"></a><span data-ttu-id="d911d-206">活动数据的联机时段</span><span class="sxs-lookup"><span data-stu-id="d911d-206">Online Window for activity data</span></span>  
 <span data-ttu-id="d911d-207">活动存储主要处理对当前活动或最近完成的活动的查询。</span><span class="sxs-lookup"><span data-stu-id="d911d-207">Activity storage primarily handles queries for current or recently completed activities.</span></span> <span data-ttu-id="d911d-208">BAM 对很久以前的、已完成的活动进行存档，然后将其从 BAM 主导入数据库中清除。</span><span class="sxs-lookup"><span data-stu-id="d911d-208">BAM archives and then purges very old, completed activities from the BAM Primary Import database.</span></span> <span data-ttu-id="d911d-209">因而，活动数据将流过 BAM，并且在可配置的联机时段可对其进行查询。</span><span class="sxs-lookup"><span data-stu-id="d911d-209">Thus the activity data flows through BAM and is available for queries during a configurable Online Window.</span></span>  
  
## <a name="bam-partitioning"></a><span data-ttu-id="d911d-210">BAM 分区</span><span class="sxs-lookup"><span data-stu-id="d911d-210">BAM partitioning</span></span>  
 <span data-ttu-id="d911d-211">为提高性能并避免故障，活动存储基于活动完成时的时间戳来使用分区。</span><span class="sxs-lookup"><span data-stu-id="d911d-211">To allow for higher performance and avoid downtime, activity storage uses partitioning based on the time stamp when the activity was completed.</span></span> <span data-ttu-id="d911d-212">BAM 通过将已完成的表与另一个相同格式的空表定期交换来实现此操作。</span><span class="sxs-lookup"><span data-stu-id="d911d-212">BAM achieves this by regular swapping of the completed table with another empty table of exactly the same format.</span></span> <span data-ttu-id="d911d-213">BAM 完成此操作后，新的已完成活动将进入新表，而 BAM 将保留旧表仅供查询，如下图所示：</span><span class="sxs-lookup"><span data-stu-id="d911d-213">Once BAM does this, the further completed activities go into the new table, while BAM keeps the old one only for queries, as in the following figure:</span></span>  
  
 <span data-ttu-id="d911d-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span><span class="sxs-lookup"><span data-stu-id="d911d-214">![](../core/media/ebiz-prog-bam-data-maint-fig8.gif "ebiz_prog_bam_data_maint_fig8")</span></span>  
<span data-ttu-id="d911d-215">BAM 分区交换</span><span class="sxs-lookup"><span data-stu-id="d911d-215">BAM Partition Swapping</span></span>  
  
 <span data-ttu-id="d911d-216">当分区完全处于联机时段之外时，BAM 将对该分区进行存档，然后删除它。</span><span class="sxs-lookup"><span data-stu-id="d911d-216">Once a partition is completely outside the online window, BAM archives and then drops it.</span></span> <span data-ttu-id="d911d-217">为了从用户角度最大限度地降低这种复杂性，BAM 还维护一个以下形式的分区视图：</span><span class="sxs-lookup"><span data-stu-id="d911d-217">To minimize this complexity from the user, BAM also maintains a partitioned view of the form:</span></span>  
  
```  
SELECT * FROM Active   
UNION ALL   
SELECT * FROM Completed   
UNION ALL  
  
```  
  
 <span data-ttu-id="d911d-218">BAM 每次创建或删除分区时都自动重新创建此视图。</span><span class="sxs-lookup"><span data-stu-id="d911d-218">BAM automatically re-creates this view each time it creates or drops a partition.</span></span>  
  
 <span data-ttu-id="d911d-219">关于 BAM 分区，请注意以下几点：</span><span class="sxs-lookup"><span data-stu-id="d911d-219">Note the following about BAM partitioning:</span></span>  
  
-   <span data-ttu-id="d911d-220">分区视图的名称是**bam_\<ActivityName\>_AllInstances**。</span><span class="sxs-lookup"><span data-stu-id="d911d-220">The name of the partitioned view is **bam_\<ActivityName\>_AllInstances**.</span></span> <span data-ttu-id="d911d-221">此视图不适用于直接查询，但在对 BAM 规范进行疑难解答时可能非常有用。</span><span class="sxs-lookup"><span data-stu-id="d911d-221">This view is not meant for direct queries, but may be useful when troubleshooting the BAM instrumentation.</span></span> <span data-ttu-id="d911d-222">查询数据时，应该从您在此视图顶部为业务用户的每个类别创建的特定视图中查询数据。</span><span class="sxs-lookup"><span data-stu-id="d911d-222">You should query the data from the specific views for each category of business users that you create on top of this view.</span></span> <span data-ttu-id="d911d-223">有关详细信息，请参阅[查询实例数据](../core/querying-instance-data.md)。</span><span class="sxs-lookup"><span data-stu-id="d911d-223">For more information, see [Querying Instance Data](../core/querying-instance-data.md).</span></span>  
  
-   <span data-ttu-id="d911d-224">通过修改的值设置联机窗口**OnlineWindowTimeUnit**和**OnlineWindowLength**表中的当前活动的记录中**bam_Metadata_Activities**主导入数据库中。</span><span class="sxs-lookup"><span data-stu-id="d911d-224">You set the online window by modifying the values for **OnlineWindowTimeUnit** and **OnlineWindowLength** in the record for the current activity in the table **bam_Metadata_Activities** in the Primary Import database.</span></span>  
  
-   <span data-ttu-id="d911d-225">DTS 包， **BAM_DM_\<ActivityName\>**、 执行分区和存档/清除。</span><span class="sxs-lookup"><span data-stu-id="d911d-225">The DTS package, **BAM_DM_\<ActivityName\>**, performs the partitioning and archiving/purging.</span></span> <span data-ttu-id="d911d-226">每次此程序包运行时，它将截断其他分区，并对处于联机时段之外的所有分区进行存档/删除。</span><span class="sxs-lookup"><span data-stu-id="d911d-226">Each time this package runs, it truncates another partition and archives/drops all partitions that are outside the online window.</span></span>  
  
-   <span data-ttu-id="d911d-227">如果没有配置存档数据库，则 BAM 将直接删除旧的活动数据而不进行存档。</span><span class="sxs-lookup"><span data-stu-id="d911d-227">If you do not have Archiving Database configured, then BAM drops the aged activity data without archiving.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d911d-228">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d911d-228">See Also</span></span>  
 [<span data-ttu-id="d911d-229">BAM 动态基础结构</span><span class="sxs-lookup"><span data-stu-id="d911d-229">BAM Dynamic Infrastructure</span></span>](../core/bam-dynamic-infrastructure.md)