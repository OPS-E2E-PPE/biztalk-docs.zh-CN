---
title: 确定 BizTalk 层的瓶颈 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f38ade78-8af3-4485-9b2a-5e4cdba965d2
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 57e2a3df681b4ccfe00f5b16f0059d17d7471f75
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65382893"
---
# <a name="identifying-bottlenecks-in-the-biztalk-tier"></a><span data-ttu-id="8496f-102">确定 BizTalk 层的瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-102">Identifying Bottlenecks in the BizTalk Tier</span></span>
<span data-ttu-id="8496f-103">BizTalk 层可分为以下功能区域：</span><span class="sxs-lookup"><span data-stu-id="8496f-103">The BizTalk tier can be divided into the following functional areas:</span></span>  
  
- <span data-ttu-id="8496f-104">接收</span><span class="sxs-lookup"><span data-stu-id="8496f-104">Receiving</span></span>  
  
- <span data-ttu-id="8496f-105">处理</span><span class="sxs-lookup"><span data-stu-id="8496f-105">Processing</span></span>  
  
- <span data-ttu-id="8496f-106">传输</span><span class="sxs-lookup"><span data-stu-id="8496f-106">Transmitting</span></span>  
  
- <span data-ttu-id="8496f-107">跟踪</span><span class="sxs-lookup"><span data-stu-id="8496f-107">Tracking</span></span>  
  
- <span data-ttu-id="8496f-108">其他</span><span class="sxs-lookup"><span data-stu-id="8496f-108">Other</span></span>  
  
  <span data-ttu-id="8496f-109">对于这些区域，如果系统资源 （CPU、 内存和磁盘） 似乎趋于饱和，升级服务器通过纵向扩展。</span><span class="sxs-lookup"><span data-stu-id="8496f-109">For these areas, if the system resources (CPU, memory, and disk) appear to be saturated, upgrade the server by scaling up.</span></span> <span data-ttu-id="8496f-110">如果不饱和的系统资源，请执行本节中所述的步骤。</span><span class="sxs-lookup"><span data-stu-id="8496f-110">If the system resources are not saturated, perform the steps described in this section.</span></span>  
  
## <a name="bottlenecks-in-the-receive-location"></a><span data-ttu-id="8496f-111">中的瓶颈接收位置</span><span class="sxs-lookup"><span data-stu-id="8496f-111">Bottlenecks in the Receive Location</span></span>  
 <span data-ttu-id="8496f-112">如果消息开始构建在接收位置 （例如，文件接收文件夹增长大或传出队列不被速度不够快耗尽） 指示系统不能将 absorb 数据才能跟上传入的足够快的速度增长加载由于内部限制 (BizTalk 降低接收速率，如果订阅服务器无法处理的数据快速足够导致积压累积在数据库表中的)。</span><span class="sxs-lookup"><span data-stu-id="8496f-112">If messages start building up at the receive location (for example, file receive folder grows large or outgoing queue is not being drained fast enough) this is an indication that the system is unable to absorb data at a sufficiently fast rate to keep up with the incoming load either due to internal throttling (BizTalk reduces receiving rate if the subscribers are unable to process data fast enough causing backlog buildup in the database tables).</span></span> <span data-ttu-id="8496f-113">在由于硬件限制所导致的瓶颈的情况下请尝试纵向扩展。</span><span class="sxs-lookup"><span data-stu-id="8496f-113">In case the bottleneck is caused due to hardware limitations try scaling up.</span></span> <span data-ttu-id="8496f-114">还有可能要横向扩展通过将主机实例 （服务器） 添加到主机映射到接收处理程序。</span><span class="sxs-lookup"><span data-stu-id="8496f-114">It is also possible to scale out by adding a Host Instance (server) to the Host mapped to the receive handler.</span></span> <span data-ttu-id="8496f-115">使用 Perfmon 来监视系统上的资源利用率。</span><span class="sxs-lookup"><span data-stu-id="8496f-115">Use Perfmon to monitor the resource utilization on the system.</span></span> <span data-ttu-id="8496f-116">务必确认外部接收位置不是瓶颈的原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-116">It is important to confirm that the external receive location is not the cause of the bottleneck.</span></span> <span data-ttu-id="8496f-117">例如，远程文件共享饱和高速磁盘 IO 导致远程传出队列的宿主服务器不饱和或用于生成 HTTP/SOAP 负载的客户端不会耗尽线程上。</span><span class="sxs-lookup"><span data-stu-id="8496f-117">For example, remote file share is saturated due to high disk IO or the server hosting the remote outgoing queue is not saturated or the client used to generate HTTP/SOAP load is not starved on threads.</span></span>  
  
## <a name="processing-bottlenecks"></a><span data-ttu-id="8496f-118">处理瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-118">Processing Bottlenecks</span></span>  
 <span data-ttu-id="8496f-119">如果主机队列-长度计数 （请参阅下面的 Perfmon 计数器表） 正在增加，它表明业务流程速度不够快完成。</span><span class="sxs-lookup"><span data-stu-id="8496f-119">If the Host Queue - Length count (see the Perfmon counter table below) is climbing, it indicates that the orchestrations are not completing fast enough.</span></span> <span data-ttu-id="8496f-120">这可能是由于内存争用或 CPU 饱和所致。</span><span class="sxs-lookup"><span data-stu-id="8496f-120">This could be due to memory contention or CPU saturation.</span></span>  
  
 <span data-ttu-id="8496f-121">如果业务流程服务器是瓶颈，使用 Perfmon 来标识源。</span><span class="sxs-lookup"><span data-stu-id="8496f-121">If the orchestration servers are the bottleneck, use Perfmon to identify the source.</span></span>  
  
 <span data-ttu-id="8496f-122">如果服务器是受到 CPU 的约束，考虑以下方面：</span><span class="sxs-lookup"><span data-stu-id="8496f-122">If the server is CPU bound, consider the following:</span></span>  
  
-   <span data-ttu-id="8496f-123">如果在工作流复杂，请考虑将拆分到多个较小的业务流程的业务流程</span><span class="sxs-lookup"><span data-stu-id="8496f-123">If the workflow is complex consider splitting the orchestration into multiple smaller orchestrations</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="8496f-124">拆分到多个工作流的业务流程可能会导致额外的延迟，并会增加复杂性。</span><span class="sxs-lookup"><span data-stu-id="8496f-124">Splitting an orchestration into multiple workflows can cause additional latency and add complexity.</span></span>  
  
-   <span data-ttu-id="8496f-125">如果使用复杂的映射，请考虑是否可以将它们移到接收/发送端口 （验证哪个端口具有额外的带宽）。</span><span class="sxs-lookup"><span data-stu-id="8496f-125">If complex maps are used consider whether they can be moved to the Receive/Send ports (verify which ports have additional bandwidth).</span></span>  
  
-   <span data-ttu-id="8496f-126">请考虑向上扩展硬件或如果可能，请考虑通过将额外的处理服务器配置横向扩展。</span><span class="sxs-lookup"><span data-stu-id="8496f-126">Consider scaling up the hardware or if possible consider scaling out by configuring an additional processing server.</span></span>  
  
## <a name="transmitting-bottlenecks"></a><span data-ttu-id="8496f-127">传输瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-127">Transmitting Bottlenecks</span></span>  
 <span data-ttu-id="8496f-128">如果传输服务器上资源 （例如，磁盘、 内存、 CPU） 趋于饱和，请考虑向上扩展服务器，或如果可能，请考虑向外扩展到其他发送宿主服务器。</span><span class="sxs-lookup"><span data-stu-id="8496f-128">If the transmitting server is saturated on resources (for example, disk, memory, CPU), consider scaling-up the server or if possible consider scaling-out to additional send host servers.</span></span> <span data-ttu-id="8496f-129">如果目标 （BizTalk 外部） 不能以足够快的速度接收数据，发送层则可能成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="8496f-129">The sending tier could become the bottleneck if the destination (external to BizTalk) is unable to receive data fast enough.</span></span> <span data-ttu-id="8496f-130">这将导致消息累积到 MessageBox 数据库 (应用程序 SendHostQ) 中。</span><span class="sxs-lookup"><span data-stu-id="8496f-130">This will cause messages to buildup in the MessageBox database (Application SendHostQ).</span></span>  
  
 <span data-ttu-id="8496f-131">如果在所有终结点都在拓扑的范围，请考虑隔离的目标处的原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-131">If at all the endpoints are within the scope of the topology, consider isolating the cause at the destination.</span></span> <span data-ttu-id="8496f-132">例如，HTTP/SOAP 位置以最佳方式配置为接收负载或可能是向外扩展？</span><span class="sxs-lookup"><span data-stu-id="8496f-132">For example, is the HTTP/SOAP location optimally configured to receive load or could it be scaled-out?</span></span> <span data-ttu-id="8496f-133">是目标增长过多的输出消息由于 BizTalk 传送了？</span><span class="sxs-lookup"><span data-stu-id="8496f-133">Is the destination growing due to excessive output messages delivered by BizTalk?</span></span> <span data-ttu-id="8496f-134">如果是，请考虑维护计划来存档和清除目标消息。</span><span class="sxs-lookup"><span data-stu-id="8496f-134">If yes, consider a maintenance plan to archive and purge the destination messages.</span></span> <span data-ttu-id="8496f-135">例如，大量的目标文件夹中的文件会严重影响 BizTalk 服务的数据提交到磁盘驱动器的功能。</span><span class="sxs-lookup"><span data-stu-id="8496f-135">For example, large numbers of files in a destination folder can severely impact the ability of the BizTalk service to commit data to the disk drive.</span></span>  
  
## <a name="tracking-bottlenecks"></a><span data-ttu-id="8496f-136">跟踪瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-136">Tracking Bottlenecks</span></span>  
 <span data-ttu-id="8496f-137">跟踪主机实例是负责将 BAM 以及跟踪的消息事件和服务实例数据从 MessageBox 数据库 （TrackingData 表） 移至 BizTalkDTADb 和/或 BAMPrimaryImport 数据库表。</span><span class="sxs-lookup"><span data-stu-id="8496f-137">The Tracking Host Instance is responsible for moving both BAM & tracked message event and service instance data from the MessageBox database (TrackingData table) to the BizTalkDTADb and/or BAMPrimaryImport database tables.</span></span> <span data-ttu-id="8496f-138">如果配置了多个 MessageBox 数据库跟踪主机实例使用每个 MessageBox 的四个线程。</span><span class="sxs-lookup"><span data-stu-id="8496f-138">If multiple MessageBox databases are configured the tracking host instance uses four threads per MessageBox.</span></span>  
  
 <span data-ttu-id="8496f-139">很可能此主机实例可能受到 CPU 的约束。</span><span class="sxs-lookup"><span data-stu-id="8496f-139">It is possible that this host instance could get CPU bound.</span></span> <span data-ttu-id="8496f-140">如果出现这种情况，请考虑向上扩展服务器或横向扩展配置的另一台服务器与主机跟踪已启用。</span><span class="sxs-lookup"><span data-stu-id="8496f-140">If that is the case consider scaling-up the server or scale-out by configuring an additional server with Host Tracking enabled.</span></span> <span data-ttu-id="8496f-141">多个主机实例将自动配置的多个 Messagebox 的平衡负载。</span><span class="sxs-lookup"><span data-stu-id="8496f-141">The multiple host instances will automatically balance load for the multiple MessageBoxes configured.</span></span>  
  
 <span data-ttu-id="8496f-142">如果 MessageBox 数据库中的 TrackingData 表开始备份，它通常是因为配置导致的 BizTalkDTADb 和/或 BAMPrimaryImport 增长 BizTalkDTADb 和/或 BAMPrimaryImport 数据库上的数据维护作业未运行数据库。</span><span class="sxs-lookup"><span data-stu-id="8496f-142">If the TrackingData table in the MessageBox database starts backing up, it is usually because the data maintenance jobs on the BizTalkDTADb and/or BAMPrimaryImport database are not running as configured causing growth of the BizTalkDTADb and/or BAMPrimaryImport database.</span></span> <span data-ttu-id="8496f-143">一旦这些数据库变得太大，它可以跟踪主机能够将数据插入到 MessageBox 数据库表中的备份导致所跟踪的数据的这些表上产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="8496f-143">Once these databases grow too large it can have a negative impact on the ability of the tracking host to insert data into these tables causing the tracked data to backup in the MessageBox database tables.</span></span> <span data-ttu-id="8496f-144">MessageBox 的增长-> TrackingData 表将会导致限流。</span><span class="sxs-lookup"><span data-stu-id="8496f-144">The growth of the MessageBox->TrackingData table will cause throttling to kick in.</span></span>  
  
## <a name="other"></a><span data-ttu-id="8496f-145">其他</span><span class="sxs-lookup"><span data-stu-id="8496f-145">Other</span></span>  
 <span data-ttu-id="8496f-146">配置的部署拓扑，以便在专用的独立主机实例中运行不同的功能。</span><span class="sxs-lookup"><span data-stu-id="8496f-146">Configure the deployment topology such that different functionality runs in dedicated isolated host instances.</span></span> <span data-ttu-id="8496f-147">这种方式每个主机实例获取自己的 （上一个 32 位系统、 2GB 虚拟内存地址空间、 句柄、 线程） 的资源集。</span><span class="sxs-lookup"><span data-stu-id="8496f-147">This way each host instance gets its own set of resources (on a 32-bit system, 2GB virtual memory address space, handles, threads).</span></span> <span data-ttu-id="8496f-148">如果服务器是功能强大配置足够 （足够的 CPU 余量、 内存） 来承载多个主机实例，它们可以全部在同一台物理计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="8496f-148">If the server is powerful enough (sufficient CPU headroom, memory) to host multiple host instances they can all be configured to run on the same physical machine.</span></span> <span data-ttu-id="8496f-149">如果没有，这还使得它易于通过将功能移动到专用服务器来进行扩展。</span><span class="sxs-lookup"><span data-stu-id="8496f-149">If not, this also makes it easy to scale-out by moving the functionality to dedicated servers.</span></span> <span data-ttu-id="8496f-150">多个服务器上运行相同的功能也可用于提供高度可用的配置。</span><span class="sxs-lookup"><span data-stu-id="8496f-150">Running the same functionality on multiple servers also serves to provide a highly available configuration.</span></span>  
  
## <a name="biztalk-system-performance-counters"></a><span data-ttu-id="8496f-151">BizTalk 系统性能计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-151">BizTalk System Performance Counters</span></span>  
  
|<span data-ttu-id="8496f-152">Object</span><span class="sxs-lookup"><span data-stu-id="8496f-152">Object</span></span>|<span data-ttu-id="8496f-153">实例</span><span class="sxs-lookup"><span data-stu-id="8496f-153">Instance</span></span>|<span data-ttu-id="8496f-154">计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-154">Counter</span></span>|<span data-ttu-id="8496f-155">监视目的</span><span class="sxs-lookup"><span data-stu-id="8496f-155">Monitoring Purpose</span></span>|  
|------------|--------------|-------------|------------------------|  
|<span data-ttu-id="8496f-156">处理器</span><span class="sxs-lookup"><span data-stu-id="8496f-156">Processor</span></span>|<span data-ttu-id="8496f-157">_Total</span><span class="sxs-lookup"><span data-stu-id="8496f-157">_Total</span></span>|<span data-ttu-id="8496f-158">处理器时间百分比</span><span class="sxs-lookup"><span data-stu-id="8496f-158">% Processor Time</span></span>|<span data-ttu-id="8496f-159">资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-159">Resource Contention</span></span>|  
|<span data-ttu-id="8496f-160">Process</span><span class="sxs-lookup"><span data-stu-id="8496f-160">Process</span></span>|<span data-ttu-id="8496f-161">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="8496f-161">BTSNTSvc</span></span>|<span data-ttu-id="8496f-162">虚拟字节数</span><span class="sxs-lookup"><span data-stu-id="8496f-162">Virtual Bytes</span></span>|<span data-ttu-id="8496f-163">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="8496f-163">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="8496f-164">Process</span><span class="sxs-lookup"><span data-stu-id="8496f-164">Process</span></span>|<span data-ttu-id="8496f-165">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="8496f-165">BTSNTSvc</span></span>|<span data-ttu-id="8496f-166">专用字节数</span><span class="sxs-lookup"><span data-stu-id="8496f-166">Private Bytes</span></span>|<span data-ttu-id="8496f-167">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="8496f-167">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="8496f-168">Process</span><span class="sxs-lookup"><span data-stu-id="8496f-168">Process</span></span>|<span data-ttu-id="8496f-169">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="8496f-169">BTSNTSvc</span></span>|<span data-ttu-id="8496f-170">句柄计数</span><span class="sxs-lookup"><span data-stu-id="8496f-170">Handle Count</span></span>|<span data-ttu-id="8496f-171">资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-171">Resource Contention</span></span>|  
|<span data-ttu-id="8496f-172">Process</span><span class="sxs-lookup"><span data-stu-id="8496f-172">Process</span></span>|<span data-ttu-id="8496f-173">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="8496f-173">BTSNTSvc</span></span>|<span data-ttu-id="8496f-174">线程计数</span><span class="sxs-lookup"><span data-stu-id="8496f-174">Thread Count</span></span>|<span data-ttu-id="8496f-175">资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-175">Resource Contention</span></span>|  
|<span data-ttu-id="8496f-176">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="8496f-176">Physical Disk</span></span>|<span data-ttu-id="8496f-177">_Total</span><span class="sxs-lookup"><span data-stu-id="8496f-177">_Total</span></span>|<span data-ttu-id="8496f-178">空闲时间百分比</span><span class="sxs-lookup"><span data-stu-id="8496f-178">% Idle Time</span></span>|<span data-ttu-id="8496f-179">资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-179">Resource Contention</span></span>|  
|<span data-ttu-id="8496f-180">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="8496f-180">Physical Disk</span></span>|<span data-ttu-id="8496f-181">_Total</span><span class="sxs-lookup"><span data-stu-id="8496f-181">_Total</span></span>|<span data-ttu-id="8496f-182">Current Disk Queue Length</span><span class="sxs-lookup"><span data-stu-id="8496f-182">Current Disk Queue Length</span></span>|<span data-ttu-id="8496f-183">资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-183">Resource Contention</span></span>|  
  
### <a name="cpu-contention"></a><span data-ttu-id="8496f-184">CPU 争用</span><span class="sxs-lookup"><span data-stu-id="8496f-184">CPU Contention</span></span>  
 <span data-ttu-id="8496f-185">如果处理器趋于饱和，请考虑通过将接收与发送和业务流程来分段应用程序。</span><span class="sxs-lookup"><span data-stu-id="8496f-185">If the processor is saturated consider fragmenting the application by separating the Receiving from the Sending and Orchestration.</span></span> <span data-ttu-id="8496f-186">若要实现此目的的方法是通过创建单独的主机，映射到特定功能 （接收/发送/业务流程/跟踪） 这些主机和添加专用服务器添加到这些不同的主机。</span><span class="sxs-lookup"><span data-stu-id="8496f-186">The way to accomplish this is by creating separate hosts, mapping these hosts to specific functionality (Receive/Send/Orchestrations/Tracking) and adding dedicated servers to these separate hosts.</span></span> <span data-ttu-id="8496f-187">业务流程功能通常用来识别为 CPU 需求很大，因此配置系统，以便在单独的专用服务器上执行业务流程可帮助提高系统的整体吞吐量。</span><span class="sxs-lookup"><span data-stu-id="8496f-187">Orchestration functionality is generally known to be CPU hungry, thus configuring the system such that the orchestrations execute on a separate dedicated server helps improve overall system throughput.</span></span>  
  
 <span data-ttu-id="8496f-188">如果部署了多个业务流程，就可以登记到不同的专用业务流程主机。</span><span class="sxs-lookup"><span data-stu-id="8496f-188">If multiple orchestrations are deployed, it is possible to enlist them to different dedicated Orchestration-Hosts.</span></span> <span data-ttu-id="8496f-189">将不同的物理服务器映射到专用业务流程主机可确保不同的业务流程是独立的并且不会争用同一物理地址空间中或在同一服务器上的共享资源。</span><span class="sxs-lookup"><span data-stu-id="8496f-189">Mapping different physical servers to the dedicated Orchestration-Hosts ensures that the different orchestrations are isolated and do not contend for shared resources either in the same physical address space or on the same server.</span></span>  
  
### <a name="memory-starvation"></a><span data-ttu-id="8496f-190">内存不足</span><span class="sxs-lookup"><span data-stu-id="8496f-190">Memory Starvation</span></span>  
 <span data-ttu-id="8496f-191">高吞吐量情况可能会增加系统内存的需求。</span><span class="sxs-lookup"><span data-stu-id="8496f-191">High throughput scenarios can have increased demand on system memory.</span></span> <span data-ttu-id="8496f-192">由于 32 位进程受到可使用的内存量，建议来分隔到单独的主机实例的接收/处理/发送功能，以便每个主机接收自己 2 GB 的地址空间。</span><span class="sxs-lookup"><span data-stu-id="8496f-192">Since a 32-bit process is limited by the amount of memory it can consume, it is recommended to separate the Receive/Process/Send functionality into separate Host Instances such that each host receives its own 2GB address space.</span></span> <span data-ttu-id="8496f-193">此外，如果同一台物理服务器上运行多个主机实例是升级到 4/8 GB 内存，为了避免必须从实际内存到磁盘交换数据很有用。</span><span class="sxs-lookup"><span data-stu-id="8496f-193">In addition, if multiple Host Instances are running on the same physical server it is useful to upgrade to 4/8GB memory to avoid having to swap data to disk from real memory.</span></span> <span data-ttu-id="8496f-194">长时间运行的业务流程可容纳再导致内存膨胀和限流分配的内存。</span><span class="sxs-lookup"><span data-stu-id="8496f-194">Long running orchestrations can hold onto allocated memory longer causing memory bloat and thus throttling to kick in.</span></span> <span data-ttu-id="8496f-195">大消息也会导致高内存消耗。</span><span class="sxs-lookup"><span data-stu-id="8496f-195">Large messages can also cause high memory consumption.</span></span>  
  
 <span data-ttu-id="8496f-196">可以通过降低来处理大消息时解决此内存膨胀问题**内部消息队列大小**并**每 CPU 进程内消息**特定主机的值。</span><span class="sxs-lookup"><span data-stu-id="8496f-196">It is possible to overcome this memory bloat problem when large messages are being processed by lowering the **Internal Message Queue Size** and **In-process Messages per CPU** values for the specific host.</span></span>  
  
### <a name="disk-contention"></a><span data-ttu-id="8496f-197">磁盘争用</span><span class="sxs-lookup"><span data-stu-id="8496f-197">Disk Contention</span></span>  
 <span data-ttu-id="8496f-198">如果磁盘趋于饱和 （例如，文件 /MSMQ 传输），请考虑升级到多个心轴和条带化磁盘并用 RAID 1 + 0。</span><span class="sxs-lookup"><span data-stu-id="8496f-198">If the disks are saturated (for example, File/MSMQ transports) consider upgrading to multiple spindles and striping the disks with RAID 1+0.</span></span> <span data-ttu-id="8496f-199">此外一旦使用文件传输是必须确保该文件夹 （接收和发送） 不会变得过大 (> 50,000 文件)。</span><span class="sxs-lookup"><span data-stu-id="8496f-199">In addition whenever using the FILE transport it is important to ensure that the folders (both Receive and Send) do not grow too large (>50,000 files).</span></span>  
  
 <span data-ttu-id="8496f-200">接收文件夹可能变得大如果 BizTalk Server 选择阻止传入数据进入出于下面所述的各种原因而系统。</span><span class="sxs-lookup"><span data-stu-id="8496f-200">The Receive folder can grow large if BizTalk Server chooses to throttle incoming data into the system due to various reasons mentioned below.</span></span> <span data-ttu-id="8496f-201">务必也在将数据从发送文件夹移动，以便在此文件夹中的增长不会影响 BizTalk Server 能够编写额外的数据。</span><span class="sxs-lookup"><span data-stu-id="8496f-201">It is also important to move data from the send folder so that growth in this folder does not impact the ability of BizTalk Server to write additional data.</span></span> <span data-ttu-id="8496f-202">对于非事务性 MSMQ 队列，建议远程创建接收队列，以便在 BizTalk server 上减少磁盘争用。</span><span class="sxs-lookup"><span data-stu-id="8496f-202">For non-transactional MSMQ queues, it is recommended to remotely create the receive queues so that disk contention is reduced on the BizTalk server.</span></span>  
  
 <span data-ttu-id="8496f-203">此配置 （远程非事务性队列） 还提供了高可用性的好处，如队列的宿主的远程服务器可以群集化。</span><span class="sxs-lookup"><span data-stu-id="8496f-203">This configuration (remote non-transactional queues) also provides the added benefit of high availability as the remote server hosting the queue can be clustered.</span></span>  
  
### <a name="other-system-resource-contention"></a><span data-ttu-id="8496f-204">其他系统资源争用</span><span class="sxs-lookup"><span data-stu-id="8496f-204">Other System Resource Contention</span></span>  
 <span data-ttu-id="8496f-205">根据配置的传输的性质可能需要配置系统资源，如 IIS HTTP/SOAP （例如，MaxIOThreads，MaxWorkerThreads）。</span><span class="sxs-lookup"><span data-stu-id="8496f-205">Depending on the nature of the transport configured it may be necessary to configure system resources like IIS for HTTP/SOAP (for example, MaxIOThreads, MaxWorkerThreads).</span></span>  
  
### <a name="downstream-bottlenecks"></a><span data-ttu-id="8496f-206">下游瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-206">Downstream Bottlenecks</span></span>  
 <span data-ttu-id="8496f-207">如果下游系统接收数据快速足够从 BizTalk 此输出数据将导致膨胀，从而导致限流缩小接收管道，进而影响 BizTalk 的整体吞吐量在 BizTalk 数据库备份系统。</span><span class="sxs-lookup"><span data-stu-id="8496f-207">If the downstream system is unable to receive data fast enough from BizTalk this output data will back up within the BizTalk databases resulting in bloat causing throttling to kick in shrinking the receive pipe thereby impacting the overall throughput of the BizTalk system.</span></span> <span data-ttu-id="8496f-208">此直接指示将后台处理增长。</span><span class="sxs-lookup"><span data-stu-id="8496f-208">A direct indication of this would be Spool growth.</span></span>  
  
### <a name="throttling-impact"></a><span data-ttu-id="8496f-209">限制的影响</span><span class="sxs-lookup"><span data-stu-id="8496f-209">Throttling Impact</span></span>  
 <span data-ttu-id="8496f-210">阻止最终将触发以保护系统免受达到不可恢复的状态。</span><span class="sxs-lookup"><span data-stu-id="8496f-210">Throttling will ultimately kick in to protect the system from reaching an unrecoverable state.</span></span> <span data-ttu-id="8496f-211">因此限流是验证系统是否工作正常并发现问题根源的好时机。</span><span class="sxs-lookup"><span data-stu-id="8496f-211">Thus throttling is a good place to verify whether the system is functioning normally and discover the source of the problem.</span></span> <span data-ttu-id="8496f-212">通过限流状态确定了瓶颈的原因之后，分析其他性能计数器，以向下钻取到此问题的源。</span><span class="sxs-lookup"><span data-stu-id="8496f-212">After the cause of the bottleneck has been identified from the throttling state, analyze the other performance counters to drill down into the source of the problem.</span></span>  
  
 <span data-ttu-id="8496f-213">例如，MessageBox 数据库上的大量争用可能是由于 CPU 使用率过高，这可能由于对磁盘可能由于内存不足而导致过度分页所致。</span><span class="sxs-lookup"><span data-stu-id="8496f-213">For example, high contention on the MessageBox database could be due to high CPU usage, which could be caused due to excessively paging to disk which could be caused due to low memory conditions.</span></span> <span data-ttu-id="8496f-214">MessageBox 上的大量争用也可能引起高锁争用可能是造成磁盘设备趋于饱和。</span><span class="sxs-lookup"><span data-stu-id="8496f-214">High contention on the MessageBox could also be caused due to high lock contention which could be due to saturated disk drives.</span></span>  
  
## <a name="biztalk-application-counters"></a><span data-ttu-id="8496f-215">BizTalk 应用程序计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-215">BizTalk Application Counters</span></span>  
  
|<span data-ttu-id="8496f-216">Object</span><span class="sxs-lookup"><span data-stu-id="8496f-216">Object</span></span>|<span data-ttu-id="8496f-217">实例</span><span class="sxs-lookup"><span data-stu-id="8496f-217">Instance</span></span>|<span data-ttu-id="8496f-218">计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-218">Counter</span></span>|<span data-ttu-id="8496f-219">Description</span><span class="sxs-lookup"><span data-stu-id="8496f-219">Description</span></span>|  
|------------|--------------|-------------|-----------------|  
|<span data-ttu-id="8496f-220">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="8496f-220">BizTalk Messaging</span></span>|<span data-ttu-id="8496f-221">RxHost</span><span class="sxs-lookup"><span data-stu-id="8496f-221">RxHost</span></span>|<span data-ttu-id="8496f-222">Documents Received/Sec</span><span class="sxs-lookup"><span data-stu-id="8496f-222">Documents Received/Sec</span></span>|<span data-ttu-id="8496f-223">传入速率</span><span class="sxs-lookup"><span data-stu-id="8496f-223">Incoming Rate</span></span>|  
|<span data-ttu-id="8496f-224">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="8496f-224">BizTalk Messaging</span></span>|<span data-ttu-id="8496f-225">TxHost</span><span class="sxs-lookup"><span data-stu-id="8496f-225">TxHost</span></span>|<span data-ttu-id="8496f-226">处理的文档数/秒</span><span class="sxs-lookup"><span data-stu-id="8496f-226">Documents Processed/Sec</span></span>|<span data-ttu-id="8496f-227">传出速率</span><span class="sxs-lookup"><span data-stu-id="8496f-227">Outgoing Rate</span></span>|  
|<span data-ttu-id="8496f-228">XLANG/s 业务流程</span><span class="sxs-lookup"><span data-stu-id="8496f-228">XLANG/s Orchestrations</span></span>|<span data-ttu-id="8496f-229">PxHost</span><span class="sxs-lookup"><span data-stu-id="8496f-229">PxHost</span></span>|<span data-ttu-id="8496f-230">业务流程完成数/秒。</span><span class="sxs-lookup"><span data-stu-id="8496f-230">Orchestrations Completed/Sec.</span></span>|<span data-ttu-id="8496f-231">处理速率</span><span class="sxs-lookup"><span data-stu-id="8496f-231">Processing Rate</span></span>|  
|<span data-ttu-id="8496f-232">BizTalk:MessageBox:常规计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-232">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="8496f-233">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="8496f-233">MsgBoxName</span></span>|<span data-ttu-id="8496f-234">后台处理大小</span><span class="sxs-lookup"><span data-stu-id="8496f-234">Spool Size</span></span>|<span data-ttu-id="8496f-235">所有主机队列的累积大小</span><span class="sxs-lookup"><span data-stu-id="8496f-235">Cumulative size of all Host Queues</span></span>|  
|<span data-ttu-id="8496f-236">BizTalk:MessageBox:常规计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-236">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="8496f-237">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="8496f-237">MsgBoxName</span></span>|<span data-ttu-id="8496f-238">跟踪数据大小</span><span class="sxs-lookup"><span data-stu-id="8496f-238">Tracking Data Size</span></span>|<span data-ttu-id="8496f-239">MessageBox 上 TrackingData 表的大小</span><span class="sxs-lookup"><span data-stu-id="8496f-239">Size of TrackingData table on the MessageBox</span></span>|  
|<span data-ttu-id="8496f-240">BizTalk:MessageBox:Host 计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-240">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="8496f-241">PxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="8496f-241">PxHost:MsgBoxName</span></span>|<span data-ttu-id="8496f-242">主机队列-长度</span><span class="sxs-lookup"><span data-stu-id="8496f-242">Host Queue - Length</span></span>|<span data-ttu-id="8496f-243">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="8496f-243">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="8496f-244">BizTalk:MessageBox:Host 计数器</span><span class="sxs-lookup"><span data-stu-id="8496f-244">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="8496f-245">TxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="8496f-245">TxHost:MsgBoxName</span></span>|<span data-ttu-id="8496f-246">主机队列-长度</span><span class="sxs-lookup"><span data-stu-id="8496f-246">Host Queue - Length</span></span>|<span data-ttu-id="8496f-247">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="8496f-247">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="8496f-248">Biztalk: Message Agent</span><span class="sxs-lookup"><span data-stu-id="8496f-248">BizTalk:Message Agent</span></span>|<span data-ttu-id="8496f-249">RxHost</span><span class="sxs-lookup"><span data-stu-id="8496f-249">RxHost</span></span>|<span data-ttu-id="8496f-250">数据库大小</span><span class="sxs-lookup"><span data-stu-id="8496f-250">Database Size</span></span>|<span data-ttu-id="8496f-251">发布 (PxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="8496f-251">Size of publishing (PxHost) Queue</span></span>|  
|<span data-ttu-id="8496f-252">Biztalk: Message Agent</span><span class="sxs-lookup"><span data-stu-id="8496f-252">BizTalk:Message Agent</span></span>|<span data-ttu-id="8496f-253">PxHost</span><span class="sxs-lookup"><span data-stu-id="8496f-253">PxHost</span></span>|<span data-ttu-id="8496f-254">数据库大小</span><span class="sxs-lookup"><span data-stu-id="8496f-254">Database Size</span></span>|<span data-ttu-id="8496f-255">发布 (TxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="8496f-255">Size of publishing (TxHost) Queue</span></span>|  
|<span data-ttu-id="8496f-256">Biztalk: Message Agent</span><span class="sxs-lookup"><span data-stu-id="8496f-256">BizTalk:Message Agent</span></span>|<span data-ttu-id="8496f-257">HostName</span><span class="sxs-lookup"><span data-stu-id="8496f-257">HostName</span></span>|<span data-ttu-id="8496f-258">Message Delivery Throttling State</span><span class="sxs-lookup"><span data-stu-id="8496f-258">Message Delivery Throttling State</span></span>|<span data-ttu-id="8496f-259">影响 XLANG 和出站传输</span><span class="sxs-lookup"><span data-stu-id="8496f-259">Affects XLANG and Outbound transports</span></span>|  
|<span data-ttu-id="8496f-260">Biztalk: Message Agent</span><span class="sxs-lookup"><span data-stu-id="8496f-260">BizTalk:Message Agent</span></span>|<span data-ttu-id="8496f-261">HostName</span><span class="sxs-lookup"><span data-stu-id="8496f-261">HostName</span></span>|<span data-ttu-id="8496f-262">消息发布阻止状态</span><span class="sxs-lookup"><span data-stu-id="8496f-262">Message Publishing Throttling State</span></span>|<span data-ttu-id="8496f-263">影响 XLANG 和入站传输</span><span class="sxs-lookup"><span data-stu-id="8496f-263">Affects XLANG and Inbound transports</span></span>|  
  
### <a name="where-do-i-start"></a><span data-ttu-id="8496f-264">如何开始？</span><span class="sxs-lookup"><span data-stu-id="8496f-264">Where do I start?</span></span>  
 <span data-ttu-id="8496f-265">监视**Message Delivery Throttling State**并**Message Publishing Throttling State**对于每个主机实例通常是启动的好时机。</span><span class="sxs-lookup"><span data-stu-id="8496f-265">Monitoring the **Message Delivery Throttling State** and the **Message Publishing Throttling State** for each host instance is usually a good place to start.</span></span> <span data-ttu-id="8496f-266">如果这些计数器的值不为零，则表示 BizTalk 系统内正发生限流，并可以进一步分析瓶颈的原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-266">If the value of these counters is not zero it is indicative that throttling is happening within the BizTalk system and it is possible to further analyze the cause of the bottleneck.</span></span> <span data-ttu-id="8496f-267">有关其他性能计数器的说明，请参阅[标识数据库层的瓶颈](http://msdn.microsoft.com/library/f1dc58b5-73b0-41b5-9a1e-c0698485c732)。</span><span class="sxs-lookup"><span data-stu-id="8496f-267">For descriptions on the other performance counters, see [Identifying Bottlenecks in the Database Tier](http://msdn.microsoft.com/library/f1dc58b5-73b0-41b5-9a1e-c0698485c732).</span></span>  
  
## <a name="backlog-buildup"></a><span data-ttu-id="8496f-268">出现积压</span><span class="sxs-lookup"><span data-stu-id="8496f-268">Backlog Buildup</span></span>  
 <span data-ttu-id="8496f-269">对于 1-1 部署方案 1 条消息 1 个消息接收结果的位置处理和传输时，如果传出速率不等于传入速率，积压是某处累积系统中。</span><span class="sxs-lookup"><span data-stu-id="8496f-269">For a 1-1 deployment scenario where 1 message received results in 1 message processed and transmitted, if the Outgoing Rate does not equal the Incoming Rate, a backlog is building up somewhere in the system.</span></span> <span data-ttu-id="8496f-270">此类情况下就可以监视 Spool Size。</span><span class="sxs-lookup"><span data-stu-id="8496f-270">For such a situation it is possible to monitor the Spool Size.</span></span>  
  
 <span data-ttu-id="8496f-271">如果 Spool 呈线性增长，就可以进一步向下钻取到通过验证哪个应用程序队列导致 Spool 增长。</span><span class="sxs-lookup"><span data-stu-id="8496f-271">If the Spool is growing linearly, it is possible to further drill down by verifying which Application Queue is responsible for the Spool growth.</span></span>  
  
 <span data-ttu-id="8496f-272">如果没有任何应用程序队列增长，而 Spool 持续增长，它可能意味着清除作业无法跟上由于代理未运行或在 SQL server 上的其他系统资源争用。</span><span class="sxs-lookup"><span data-stu-id="8496f-272">If none of the application queues are growing and the Spool continues to grow it could mean that the purge jobs are unable to keep up either due to the agent not running or other system resource contention on the SQL server.</span></span>  
  
 <span data-ttu-id="8496f-273">如果一个应用程序队列增长，则务必诊断该增长的原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-273">If one of the application queues are growing, it is important to diagnose the cause of this growth.</span></span> <span data-ttu-id="8496f-274">监视无法清空特定应用程序队列的系统上的系统资源 （例如，业务流程 HOST-Q 增长由于在服务器上的 CPU 资源不足）。</span><span class="sxs-lookup"><span data-stu-id="8496f-274">Monitor the system resources on the system that is unable to drain the specific application queue (for example, Orchestration Host-Q is growing due to CPU starvation on the server).</span></span> <span data-ttu-id="8496f-275">除了验证特定主机实例的阻止计数器的值。</span><span class="sxs-lookup"><span data-stu-id="8496f-275">In addition verify the values of the throttling counter for the specific host instance.</span></span>  
  
 <span data-ttu-id="8496f-276">如果送达/发布状态不为零，检查该值以确认限流 （有关示例、 超过内存阈值、 正在处理的消息数过多等。） 的原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-276">If the Delivery/Publishing State is not zero, check the value to confirm the reason for throttling (for example, memory threshold exceeded, in-flight message count too high etc.).</span></span>  
  
## <a name="f1-profiler"></a><span data-ttu-id="8496f-277">F1 Profiler</span><span class="sxs-lookup"><span data-stu-id="8496f-277">F1 Profiler</span></span>  
 <span data-ttu-id="8496f-278">通过使用性能计数器，是能够快速检测瓶颈位置到较高层面。</span><span class="sxs-lookup"><span data-stu-id="8496f-278">By using performance counters, it is possible to quickly detect at a high level the location of the bottleneck.</span></span> <span data-ttu-id="8496f-279">但是，一旦范围缩小，它可能需要向下钻取进一步深入到代码以帮助缓解此问题。</span><span class="sxs-lookup"><span data-stu-id="8496f-279">However, once narrowed down, it may be necessary to drill down further into the code to help alleviate the problem.</span></span> <span data-ttu-id="8496f-280">使用 Visual Studio 附带 F1 Profiler 可以是非常有用的工具可帮助您诊断代码上花费其周期的大多数。</span><span class="sxs-lookup"><span data-stu-id="8496f-280">The F1 Profiler that ships with Visual Studio can be a very helpful tool to help diagnose where the code is spending most of its cycles.</span></span>  
  
 <span data-ttu-id="8496f-281">符号是重要，可帮助创建更有意义的堆栈 （特别是对于非托管代码）。</span><span class="sxs-lookup"><span data-stu-id="8496f-281">Symbols are important to help with creating a more meaningful stack (especially for unmanaged code).</span></span> <span data-ttu-id="8496f-282">例如，F1 Profiler 可帮助查明调用数和 API 调用所返回的时间量。</span><span class="sxs-lookup"><span data-stu-id="8496f-282">For example, the F1-Profiler can help pinpoint the number of invocations and the amount of time an API call takes to return.</span></span> <span data-ttu-id="8496f-283">钻取更多堆栈的下层，可能会能够检测到高延迟的根本原因。</span><span class="sxs-lookup"><span data-stu-id="8496f-283">Drilling further down the stack, it may be possible to detect the underlying cause of the high latency.</span></span> <span data-ttu-id="8496f-284">它可能是对数据库查询是阻塞调用还是只需等待的事件的调用。</span><span class="sxs-lookup"><span data-stu-id="8496f-284">It could be a blocking call to a database query or simply a call to wait on an event.</span></span>  
  
## <a name="l2l3-cache"></a><span data-ttu-id="8496f-285">L2/L3 缓存</span><span class="sxs-lookup"><span data-stu-id="8496f-285">L2/L3 Cache</span></span>  
 <span data-ttu-id="8496f-286">（从硬件角度看） 可以获得最大的好处是通过利用板载 CPU 缓存。</span><span class="sxs-lookup"><span data-stu-id="8496f-286">The biggest benefits (from a hardware perspective) that can be gained is by utilizing onboard CPU cache.</span></span> <span data-ttu-id="8496f-287">更高 CPU 缓存可帮助增加高速缓存命中率减少系统的需求对数据传入和传出内存到磁盘进行分页。</span><span class="sxs-lookup"><span data-stu-id="8496f-287">Higher CPU cache helps increase cache hit rate reducing the need for the system to page data in and out of memory to disk.</span></span>  
  
## <a name="64-bit-performance-bottlenecks"></a><span data-ttu-id="8496f-288">64 位性能瓶颈</span><span class="sxs-lookup"><span data-stu-id="8496f-288">64-Bit Performance Bottlenecks</span></span>  
 <span data-ttu-id="8496f-289">在 64 位系统上的性能可能不如 32 位系统上可以获得的内容。</span><span class="sxs-lookup"><span data-stu-id="8496f-289">Performance on 64-bit systems may appear lower than what can be achieved on 32-bit systems.</span></span> <span data-ttu-id="8496f-290">这可能是由于多种原因，最重要的一个是内存。</span><span class="sxs-lookup"><span data-stu-id="8496f-290">This is possible due to a couple of reasons, the most important one being memory.</span></span>  
  
 <span data-ttu-id="8496f-291">具有 2 GB 的内存并将结果与具有 2 GB 的类似 64 位系统上可以获得的内容进行比较的 32 位系统上的测量性能不是内存的 true 的同类型比较。</span><span class="sxs-lookup"><span data-stu-id="8496f-291">Measuring performance on a 32-bit system with 2-GB of memory and comparing the results to what can be achieved on a similar 64-bit system with 2-GB of memory is not a true apples to apples comparison.</span></span> <span data-ttu-id="8496f-292">64 位系统看起来是 DISK-IO 限制 （低于 %磁盘空闲时间和高磁盘队列长度） 以及 CPU 限制 （最大 CPU 和大量的上下文切换）。</span><span class="sxs-lookup"><span data-stu-id="8496f-292">The 64-bit system will appear to be disk-IO bound (low % Disk Idle time & high Disk Queue Length) and CPU bound (max CPU & high Context Switching).</span></span> <span data-ttu-id="8496f-293">但是，这是不是因为在 64 位系统上执行文件 IO 开销更大。</span><span class="sxs-lookup"><span data-stu-id="8496f-293">However, this is not because performing file IO on a 64-bit system is more expensive.</span></span>  
  
 <span data-ttu-id="8496f-294">64 位系统需要更多内存 （64 位寻址） 这会导致操作系统占用 2 GB 可用内存的大多数。</span><span class="sxs-lookup"><span data-stu-id="8496f-294">The 64-bit system is more memory hungry (64-bit addressing) which results in the OS consuming most of the 2-GB available memory.</span></span> <span data-ttu-id="8496f-295">一旦发生这种情况大部分的其他操作会导致对强调文件子系统的磁盘进行分页。</span><span class="sxs-lookup"><span data-stu-id="8496f-295">Once this happens most other operations cause paging to disk which stresses the file subsystem.</span></span> <span data-ttu-id="8496f-296">系统现在不仅花费 CPU 周期，这两个数据都分页/内存不足，并且代码但仍受影响的高磁盘延迟开销。</span><span class="sxs-lookup"><span data-stu-id="8496f-296">The system now not only spends CPU cycles paging in/out of memory both data and code but is also impacted by the high disk latency cost.</span></span> <span data-ttu-id="8496f-297">它表现为更多的磁盘争用和更高的 CPU 占用率。</span><span class="sxs-lookup"><span data-stu-id="8496f-297">This manifests itself as both higher disk contention and higher CPU consumption.</span></span>  
  
 <span data-ttu-id="8496f-298">若要缓解此问题的方法是来向上扩展服务器通过升级内存 (理想情况下为 8 GB)。</span><span class="sxs-lookup"><span data-stu-id="8496f-298">The way to alleviate this problem is to scale-up the server by upgrading the memory (ideally 8-GB).</span></span> <span data-ttu-id="8496f-299">但是，添加更多的内存并无帮助提高吞吐量，除非问题的原因是由于内存不足的情况的 CPU 资源不足。</span><span class="sxs-lookup"><span data-stu-id="8496f-299">However, adding more memory will not help improve throughput unless the source of the problem is CPU starvation due to low memory conditions.</span></span>  
  
## <a name="using-bam-to-identify-bottlenecks-and-high-latency-issues"></a><span data-ttu-id="8496f-300">使用 BAM 来查找瓶颈和高延迟问题</span><span class="sxs-lookup"><span data-stu-id="8496f-300">Using BAM to identify bottlenecks and high latency issues</span></span>  
 <span data-ttu-id="8496f-301">在低延迟非常重要的情况下，可以使用 BAM 来测量系统完成 BizTalk 系统中的每个阶段所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="8496f-301">In situations where low latency is important, you can use BAM to measure the time the system takes to complete each stage within the BizTalk system.</span></span> <span data-ttu-id="8496f-302">虽然跟踪的消息事件和服务实例数据可用于调试的消息状态和诊断路由消息中的问题的根源，但 BAM 可用于跟踪的消息流的各个点。</span><span class="sxs-lookup"><span data-stu-id="8496f-302">Although  tracked message event and service instance data can be used to debug the state of messages and diagnose the source of problems in routing messages, BAM can be used to track various points through the message flow.</span></span> <span data-ttu-id="8496f-303">通过创建一个 BAM 跟踪配置文件 （定义继续符的活动），可以测量系统来帮助跟踪工作流进程中成本最高的阶段的不同部件之间的延迟。</span><span class="sxs-lookup"><span data-stu-id="8496f-303">By creating a BAM tracking profile (defining an activity with continuations), you can measure latency between different parts of the system to help track the most expensive stages within the workflow process.</span></span>