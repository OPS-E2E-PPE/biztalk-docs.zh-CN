---
title: 识别 BizTalk 层中的瓶颈 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f38ade78-8af3-4485-9b2a-5e4cdba965d2
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a5dd356ac3b8563d207e3534fc503711f11a9c8e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22258181"
---
# <a name="identifying-bottlenecks-in-the-biztalk-tier"></a><span data-ttu-id="9470e-102">识别瓶颈 BizTalk 层中</span><span class="sxs-lookup"><span data-stu-id="9470e-102">Identifying Bottlenecks in the BizTalk Tier</span></span>
<span data-ttu-id="9470e-103">BizTalk 层可分为以下功能区域：</span><span class="sxs-lookup"><span data-stu-id="9470e-103">The BizTalk tier can be divided into the following functional areas:</span></span>  
  
-   <span data-ttu-id="9470e-104">接收</span><span class="sxs-lookup"><span data-stu-id="9470e-104">Receiving</span></span>  
  
-   <span data-ttu-id="9470e-105">处理</span><span class="sxs-lookup"><span data-stu-id="9470e-105">Processing</span></span>  
  
-   <span data-ttu-id="9470e-106">传输</span><span class="sxs-lookup"><span data-stu-id="9470e-106">Transmitting</span></span>  
  
-   <span data-ttu-id="9470e-107">跟踪</span><span class="sxs-lookup"><span data-stu-id="9470e-107">Tracking</span></span>  
  
-   <span data-ttu-id="9470e-108">其他</span><span class="sxs-lookup"><span data-stu-id="9470e-108">Other</span></span>  
  
 <span data-ttu-id="9470e-109">对于这些区域，如果系统资源（CPU、内存和磁盘）似乎趋于饱和，请通过向上扩展来升级服务器。</span><span class="sxs-lookup"><span data-stu-id="9470e-109">For these areas, if the system resources (CPU, memory, and disk) appear to be saturated, upgrade the server by scaling up.</span></span> <span data-ttu-id="9470e-110">如果系统资源不饱和，请执行本部分中介绍的这些步骤。</span><span class="sxs-lookup"><span data-stu-id="9470e-110">If the system resources are not saturated, perform the steps described in this section.</span></span>  
  
## <a name="bottlenecks-in-the-receive-location"></a><span data-ttu-id="9470e-111">接收位置中的瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-111">Bottlenecks in the Receive Location</span></span>  
 <span data-ttu-id="9470e-112">如果消息在接收位置开始累积（例如，文件接收文件夹不断增大或传出队列没有很快清空），则说明可能由于内部受阻而导致系统处理数据的速率不够快，无法跟上传入负载的速率（如果订户无法足够快速地处理数据而导致数据库表中出现积压，BizTalk 将会降低接收速率）。</span><span class="sxs-lookup"><span data-stu-id="9470e-112">If messages start building up at the receive location (for example, file receive folder grows large or outgoing queue is not being drained fast enough) this is an indication that the system is unable to absorb data at a sufficiently fast rate to keep up with the incoming load either due to internal throttling (BizTalk reduces receiving rate if the subscribers are unable to process data fast enough causing backlog buildup in the database tables).</span></span> <span data-ttu-id="9470e-113">如果是由于硬件限制所导致的瓶颈，请尝试向上扩展。</span><span class="sxs-lookup"><span data-stu-id="9470e-113">In case the bottleneck is caused due to hardware limitations try scaling up.</span></span> <span data-ttu-id="9470e-114">通过向映射到接收处理程序的主机添加主机实例（服务器）也能够得到扩展。</span><span class="sxs-lookup"><span data-stu-id="9470e-114">It is also possible to scale out by adding a Host Instance (server) to the Host mapped to the receive handler.</span></span> <span data-ttu-id="9470e-115">使用 Perfmon 来监视系统资源的利用率。</span><span class="sxs-lookup"><span data-stu-id="9470e-115">Use Perfmon to monitor the resource utilization on the system.</span></span> <span data-ttu-id="9470e-116">确认外部接收位置不是导致瓶颈的原因至关重要。</span><span class="sxs-lookup"><span data-stu-id="9470e-116">It is important to confirm that the external receive location is not the cause of the bottleneck.</span></span> <span data-ttu-id="9470e-117">例如，高速磁盘 IO 导致远程文件共享饱和，远程传出队列的宿主服务器不饱和，或者线程中用于生成 HTTP/SOAP 负载的客户端饱和。</span><span class="sxs-lookup"><span data-stu-id="9470e-117">For example, remote file share is saturated due to high disk IO or the server hosting the remote outgoing queue is not saturated or the client used to generate HTTP/SOAP load is not starved on threads.</span></span>  
  
## <a name="processing-bottlenecks"></a><span data-ttu-id="9470e-118">处理瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-118">Processing Bottlenecks</span></span>  
 <span data-ttu-id="9470e-119">如果“主机队列 - 长度”计数（请参阅下面的 Perfmon 计数器表）正在增加，它表明业务流程的完成速度不够快。</span><span class="sxs-lookup"><span data-stu-id="9470e-119">If the Host Queue - Length count (see the Perfmon counter table below) is climbing, it indicates that the orchestrations are not completing fast enough.</span></span> <span data-ttu-id="9470e-120">这可能是由于内存争用或 CPU 饱和所致。</span><span class="sxs-lookup"><span data-stu-id="9470e-120">This could be due to memory contention or CPU saturation.</span></span>  
  
 <span data-ttu-id="9470e-121">如果业务流程服务器是瓶颈，请使用 Perfmon 来标识来源。</span><span class="sxs-lookup"><span data-stu-id="9470e-121">If the orchestration servers are the bottleneck, use Perfmon to identify the source.</span></span>  
  
 <span data-ttu-id="9470e-122">如果服务器受到 CPU 的约束，请考虑以下情况：</span><span class="sxs-lookup"><span data-stu-id="9470e-122">If the server is CPU bound, consider the following:</span></span>  
  
-   <span data-ttu-id="9470e-123">如果工作流复杂，请考虑将业务流程拆分成多个较小的业务流程</span><span class="sxs-lookup"><span data-stu-id="9470e-123">If the workflow is complex consider splitting the orchestration into multiple smaller orchestrations</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9470e-124">将一个业务流程拆分成多个工作流可能会导致额外的延迟并使复杂性增加。</span><span class="sxs-lookup"><span data-stu-id="9470e-124">Splitting an orchestration into multiple workflows can cause additional latency and add complexity.</span></span>  
  
-   <span data-ttu-id="9470e-125">如果使用了一些复杂的映射，则请考虑是否可以将它们移动到发送/接收端口（验证哪个端口具有额外的带宽）。</span><span class="sxs-lookup"><span data-stu-id="9470e-125">If complex maps are used consider whether they can be moved to the Receive/Send ports (verify which ports have additional bandwidth).</span></span>  
  
-   <span data-ttu-id="9470e-126">请考虑向上扩展硬件；如果可能，请考虑配置其他处理服务器来实现向外扩展。</span><span class="sxs-lookup"><span data-stu-id="9470e-126">Consider scaling up the hardware or if possible consider scaling out by configuring an additional processing server.</span></span>  
  
## <a name="transmitting-bottlenecks"></a><span data-ttu-id="9470e-127">传输瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-127">Transmitting Bottlenecks</span></span>  
 <span data-ttu-id="9470e-128">如果传输服务器的资源（例如磁盘、内存和 CPU）趋于饱和，请考虑向上扩展服务器。如果可能，请考虑向外扩展到其他发送宿主服务器。</span><span class="sxs-lookup"><span data-stu-id="9470e-128">If the transmitting server is saturated on resources (for example, disk, memory, CPU), consider scaling-up the server or if possible consider scaling-out to additional send host servers.</span></span> <span data-ttu-id="9470e-129">如果目标（位于 BizTalk 外部）接收数据的速度不够快，发送层则可能成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="9470e-129">The sending tier could become the bottleneck if the destination (external to BizTalk) is unable to receive data fast enough.</span></span> <span data-ttu-id="9470e-130">这将会导致消息在 MessageBox 数据库（应用程序 SendHostQ）中累积。</span><span class="sxs-lookup"><span data-stu-id="9470e-130">This will cause messages to buildup in the MessageBox database (Application SendHostQ).</span></span>  
  
 <span data-ttu-id="9470e-131">如果所有的终结点都在拓扑结构的范围内，请考虑在目标处隔离导致问题的原因。</span><span class="sxs-lookup"><span data-stu-id="9470e-131">If at all the endpoints are within the scope of the topology, consider isolating the cause at the destination.</span></span> <span data-ttu-id="9470e-132">例如，HTTP/SOAP 位置是否经过优化配置以接收负载，或者是否能够向外扩展？</span><span class="sxs-lookup"><span data-stu-id="9470e-132">For example, is the HTTP/SOAP location optimally configured to receive load or could it be scaled-out?</span></span> <span data-ttu-id="9470e-133">目标增长是否是由于 BizTalk 传送了过多的输出消息所致？</span><span class="sxs-lookup"><span data-stu-id="9470e-133">Is the destination growing due to excessive output messages delivered by BizTalk?</span></span> <span data-ttu-id="9470e-134">如果是，请考虑通过维护计划来存档和清除目标消息。</span><span class="sxs-lookup"><span data-stu-id="9470e-134">If yes, consider a maintenance plan to archive and purge the destination messages.</span></span> <span data-ttu-id="9470e-135">例如，目标文件夹中的大量文件可能严重影响 BizTalk 服务将数据提交到磁盘驱动器的能力。</span><span class="sxs-lookup"><span data-stu-id="9470e-135">For example, large numbers of files in a destination folder can severely impact the ability of the BizTalk service to commit data to the disk drive.</span></span>  
  
## <a name="tracking-bottlenecks"></a><span data-ttu-id="9470e-136">跟踪瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-136">Tracking Bottlenecks</span></span>  
 <span data-ttu-id="9470e-137">跟踪主机实例负责将 BAM 以及跟踪的消息事件和服务实例数据从 MessageBox 数据库（TrackingData 表）移至 BizTalkDTADb 和/或 BAMPrimaryImport 数据库表。</span><span class="sxs-lookup"><span data-stu-id="9470e-137">The Tracking Host Instance is responsible for moving both BAM & tracked message event and service instance data from the MessageBox database (TrackingData table) to the BizTalkDTADb and/or BAMPrimaryImport database tables.</span></span> <span data-ttu-id="9470e-138">如果配置了多个 MessageBox 数据库，跟踪主机实例将对每个 MessageBox 使用四个线程。</span><span class="sxs-lookup"><span data-stu-id="9470e-138">If multiple MessageBox databases are configured the tracking host instance uses four threads per MessageBox.</span></span>  
  
 <span data-ttu-id="9470e-139">此主机实例可能会受到 CPU 的约束。</span><span class="sxs-lookup"><span data-stu-id="9470e-139">It is possible that this host instance could get CPU bound.</span></span> <span data-ttu-id="9470e-140">如果的确是这种情况，请考虑向上扩展服务器，或者将其他服务器配置为启用主机跟踪以实现向外扩展。</span><span class="sxs-lookup"><span data-stu-id="9470e-140">If that is the case consider scaling-up the server or scale-out by configuring an additional server with Host Tracking enabled.</span></span> <span data-ttu-id="9470e-141">多个主机实例将自动平衡多个配置的 MessageBox 的负载。</span><span class="sxs-lookup"><span data-stu-id="9470e-141">The multiple host instances will automatically balance load for the multiple MessageBoxes configured.</span></span>  
  
 <span data-ttu-id="9470e-142">如果 MessageBox 数据库的 TrackingData 表开始备份，这通常是由于在 BizTalkDTADb 和/或 BAMPrimaryImport 数据库上的数据维护作业没有按照配置来运行，导致 BizTalkDTADb 和/或 BAMPrimaryImport 数据库的增大所致。</span><span class="sxs-lookup"><span data-stu-id="9470e-142">If the TrackingData table in the MessageBox database starts backing up, it is usually because the data maintenance jobs on the BizTalkDTADb and/or BAMPrimaryImport database are not running as configured causing growth of the BizTalkDTADb and/or BAMPrimaryImport database.</span></span> <span data-ttu-id="9470e-143">一旦这些数据库变得过大，将会对跟踪主机将数据插入这些表的能力产生负面影响，并导致在 MessageBox 数据库表中备份跟踪数据。</span><span class="sxs-lookup"><span data-stu-id="9470e-143">Once these databases grow too large it can have a negative impact on the ability of the tracking host to insert data into these tables causing the tracked data to backup in the MessageBox database tables.</span></span> <span data-ttu-id="9470e-144">MessageBox 的增长-> TrackingData 表将导致限制进行计划。</span><span class="sxs-lookup"><span data-stu-id="9470e-144">The growth of the MessageBox->TrackingData table will cause throttling to kick in.</span></span>  
  
## <a name="other"></a><span data-ttu-id="9470e-145">其他</span><span class="sxs-lookup"><span data-stu-id="9470e-145">Other</span></span>  
 <span data-ttu-id="9470e-146">配置部署拓扑结构，以使不同的功能运行在专用的独立主机实例中。</span><span class="sxs-lookup"><span data-stu-id="9470e-146">Configure the deployment topology such that different functionality runs in dedicated isolated host instances.</span></span> <span data-ttu-id="9470e-147">这样，每个主机实例将获得自己的资源集（在 32 位系统中、2GB 虚拟内存地址空间、句柄和线程）。</span><span class="sxs-lookup"><span data-stu-id="9470e-147">This way each host instance gets its own set of resources (on a 32-bit system, 2GB virtual memory address space, handles, threads).</span></span> <span data-ttu-id="9470e-148">如果服务器足够强大（足够的 CPU 余量、内存）并能够承载多个主机实例，则可以将它们全部配置为在相同的物理计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="9470e-148">If the server is powerful enough (sufficient CPU headroom, memory) to host multiple host instances they can all be configured to run on the same physical machine.</span></span> <span data-ttu-id="9470e-149">如果不是，也可通过将功能移动到专用服务器上以方便向外扩展。</span><span class="sxs-lookup"><span data-stu-id="9470e-149">If not, this also makes it easy to scale-out by moving the functionality to dedicated servers.</span></span> <span data-ttu-id="9470e-150">在多个服务器上运行相同的功能也可用于提供高可用性的配置。</span><span class="sxs-lookup"><span data-stu-id="9470e-150">Running the same functionality on multiple servers also serves to provide a highly available configuration.</span></span>  
  
## <a name="biztalk-system-performance-counters"></a><span data-ttu-id="9470e-151">BizTalk 系统性能计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-151">BizTalk System Performance Counters</span></span>  
  
|<span data-ttu-id="9470e-152">对象</span><span class="sxs-lookup"><span data-stu-id="9470e-152">Object</span></span>|<span data-ttu-id="9470e-153">实例</span><span class="sxs-lookup"><span data-stu-id="9470e-153">Instance</span></span>|<span data-ttu-id="9470e-154">计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-154">Counter</span></span>|<span data-ttu-id="9470e-155">监视目的</span><span class="sxs-lookup"><span data-stu-id="9470e-155">Monitoring Purpose</span></span>|  
|------------|--------------|-------------|------------------------|  
|<span data-ttu-id="9470e-156">处理器</span><span class="sxs-lookup"><span data-stu-id="9470e-156">Processor</span></span>|<span data-ttu-id="9470e-157">_Total</span><span class="sxs-lookup"><span data-stu-id="9470e-157">_Total</span></span>|<span data-ttu-id="9470e-158">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="9470e-158">% Processor Time</span></span>|<span data-ttu-id="9470e-159">资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-159">Resource Contention</span></span>|  
|<span data-ttu-id="9470e-160">处理</span><span class="sxs-lookup"><span data-stu-id="9470e-160">Process</span></span>|<span data-ttu-id="9470e-161">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="9470e-161">BTSNTSvc</span></span>|<span data-ttu-id="9470e-162">Virtual Bytes</span><span class="sxs-lookup"><span data-stu-id="9470e-162">Virtual Bytes</span></span>|<span data-ttu-id="9470e-163">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="9470e-163">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="9470e-164">处理</span><span class="sxs-lookup"><span data-stu-id="9470e-164">Process</span></span>|<span data-ttu-id="9470e-165">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="9470e-165">BTSNTSvc</span></span>|<span data-ttu-id="9470e-166">Private Bytes</span><span class="sxs-lookup"><span data-stu-id="9470e-166">Private Bytes</span></span>|<span data-ttu-id="9470e-167">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="9470e-167">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="9470e-168">处理</span><span class="sxs-lookup"><span data-stu-id="9470e-168">Process</span></span>|<span data-ttu-id="9470e-169">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="9470e-169">BTSNTSvc</span></span>|<span data-ttu-id="9470e-170">Handle Count</span><span class="sxs-lookup"><span data-stu-id="9470e-170">Handle Count</span></span>|<span data-ttu-id="9470e-171">资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-171">Resource Contention</span></span>|  
|<span data-ttu-id="9470e-172">处理</span><span class="sxs-lookup"><span data-stu-id="9470e-172">Process</span></span>|<span data-ttu-id="9470e-173">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="9470e-173">BTSNTSvc</span></span>|<span data-ttu-id="9470e-174">线程计数</span><span class="sxs-lookup"><span data-stu-id="9470e-174">Thread Count</span></span>|<span data-ttu-id="9470e-175">资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-175">Resource Contention</span></span>|  
|<span data-ttu-id="9470e-176">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="9470e-176">Physical Disk</span></span>|<span data-ttu-id="9470e-177">_Total</span><span class="sxs-lookup"><span data-stu-id="9470e-177">_Total</span></span>|<span data-ttu-id="9470e-178">% Idle Time</span><span class="sxs-lookup"><span data-stu-id="9470e-178">% Idle Time</span></span>|<span data-ttu-id="9470e-179">资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-179">Resource Contention</span></span>|  
|<span data-ttu-id="9470e-180">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="9470e-180">Physical Disk</span></span>|<span data-ttu-id="9470e-181">_Total</span><span class="sxs-lookup"><span data-stu-id="9470e-181">_Total</span></span>|<span data-ttu-id="9470e-182">Current Disk Queue Length</span><span class="sxs-lookup"><span data-stu-id="9470e-182">Current Disk Queue Length</span></span>|<span data-ttu-id="9470e-183">资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-183">Resource Contention</span></span>|  
  
### <a name="cpu-contention"></a><span data-ttu-id="9470e-184">CPU 争用</span><span class="sxs-lookup"><span data-stu-id="9470e-184">CPU Contention</span></span>  
 <span data-ttu-id="9470e-185">如果处理器趋于饱和，请考虑将接收与发送和业务流程分开以将应用程序分为多个部分。</span><span class="sxs-lookup"><span data-stu-id="9470e-185">If the processor is saturated consider fragmenting the application by separating the Receiving from the Sending and Orchestration.</span></span> <span data-ttu-id="9470e-186">所使用的方法是：首先创建不同的主机，然后将这些主机映射到特定功能（接收/发送/业务流程/跟踪）并将专用服务器添加到这些不同的主机中。</span><span class="sxs-lookup"><span data-stu-id="9470e-186">The way to accomplish this is by creating separate hosts, mapping these hosts to specific functionality (Receive/Send/Orchestrations/Tracking) and adding dedicated servers to these separate hosts.</span></span> <span data-ttu-id="9470e-187">通常，业务流程功能需要占用大量 CPU 资源，因此将系统配置为在单独的专用服务器执行业务流程将有助于提高系统的整体吞吐率。</span><span class="sxs-lookup"><span data-stu-id="9470e-187">Orchestration functionality is generally known to be CPU hungry, thus configuring the system such that the orchestrations execute on a separate dedicated server helps improve overall system throughput.</span></span>  
  
 <span data-ttu-id="9470e-188">如果部署了多个业务流程，可以将业务流程登记到不同的专用业务流程主机上。</span><span class="sxs-lookup"><span data-stu-id="9470e-188">If multiple orchestrations are deployed, it is possible to enlist them to different dedicated Orchestration-Hosts.</span></span> <span data-ttu-id="9470e-189">将不同的物理服务器映射到专用业务流程主机，将确保不同的业务流程独立并且不会争用同一物理地址空间或同一服务器上的共享资源。</span><span class="sxs-lookup"><span data-stu-id="9470e-189">Mapping different physical servers to the dedicated Orchestration-Hosts ensures that the different orchestrations are isolated and do not contend for shared resources either in the same physical address space or on the same server.</span></span>  
  
### <a name="memory-starvation"></a><span data-ttu-id="9470e-190">内存资源不足</span><span class="sxs-lookup"><span data-stu-id="9470e-190">Memory Starvation</span></span>  
 <span data-ttu-id="9470e-191">高吞吐量情况可能会增加对系统内存的要求。</span><span class="sxs-lookup"><span data-stu-id="9470e-191">High throughput scenarios can have increased demand on system memory.</span></span> <span data-ttu-id="9470e-192">由于 32 位进程受到可使用的内存数量的限制，建议将接收/处理/发送功能分别放在单独的主机实例中，以使每个主机接收自己的 2GB 地址空间。</span><span class="sxs-lookup"><span data-stu-id="9470e-192">Since a 32-bit process is limited by the amount of memory it can consume, it is recommended to separate the Receive/Process/Send functionality into separate Host Instances such that each host receives its own 2GB address space.</span></span> <span data-ttu-id="9470e-193">此外，如果多个主机实例运行在相同的物理服务器上，则升级到 4/8GB 内存将非常有用，这样可避免在实际内存到磁盘之间进行不必要的数据交换。</span><span class="sxs-lookup"><span data-stu-id="9470e-193">In addition, if multiple Host Instances are running on the same physical server it is useful to upgrade to 4/8GB memory to avoid having to swap data to disk from real memory.</span></span> <span data-ttu-id="9470e-194">长时间运行的业务流程可以存放到分配的内存再导致内存膨胀和因此限制进行计划。</span><span class="sxs-lookup"><span data-stu-id="9470e-194">Long running orchestrations can hold onto allocated memory longer causing memory bloat and thus throttling to kick in.</span></span> <span data-ttu-id="9470e-195">大型消息也会导致高内存消耗。</span><span class="sxs-lookup"><span data-stu-id="9470e-195">Large messages can also cause high memory consumption.</span></span>  
  
 <span data-ttu-id="9470e-196">可以通过降低处理大消息时克服此内存膨胀问题**内部消息队列大小**和**每个 CPU 进程内消息**特定主机的值。</span><span class="sxs-lookup"><span data-stu-id="9470e-196">It is possible to overcome this memory bloat problem when large messages are being processed by lowering the **Internal Message Queue Size** and **In-process Messages per CPU** values for the specific host.</span></span>  
  
### <a name="disk-contention"></a><span data-ttu-id="9470e-197">磁盘争用</span><span class="sxs-lookup"><span data-stu-id="9470e-197">Disk Contention</span></span>  
 <span data-ttu-id="9470e-198">如果磁盘饱和 （例如，文件/MSMQ 传输） 请考虑升级到多个轴和条带化磁盘具有 RAID 1 + 0。</span><span class="sxs-lookup"><span data-stu-id="9470e-198">If the disks are saturated (for example, File/MSMQ transports) consider upgrading to multiple spindles and striping the disks with RAID 1+0.</span></span> <span data-ttu-id="9470e-199">此外每当使用文件传输时务必要确保 （接收和发送） 的文件夹不执行增长得太大 (> 50000 文件)。</span><span class="sxs-lookup"><span data-stu-id="9470e-199">In addition whenever using the FILE transport it is important to ensure that the folders (both Receive and Send) do not grow too large (>50,000 files).</span></span>  
  
 <span data-ttu-id="9470e-200">如果 BizTalk Server 由于以下提到的各种原因而选择阻止传入数据进入系统，则接收文件夹可能变得很大。</span><span class="sxs-lookup"><span data-stu-id="9470e-200">The Receive folder can grow large if BizTalk Server chooses to throttle incoming data into the system due to various reasons mentioned below.</span></span> <span data-ttu-id="9470e-201">将数据从发送文件夹中移出也是十分重要的，这使得该文件夹的增大不会影响 BizTalk Server 写入其他数据的能力。</span><span class="sxs-lookup"><span data-stu-id="9470e-201">It is also important to move data from the send folder so that growth in this folder does not impact the ability of BizTalk Server to write additional data.</span></span> <span data-ttu-id="9470e-202">对于非事务性 MSMQ 队列，建议远程创建接收队列，以便减少 BizTalk Server 上的磁盘争用。</span><span class="sxs-lookup"><span data-stu-id="9470e-202">For non-transactional MSMQ queues, it is recommended to remotely create the receive queues so that disk contention is reduced on the BizTalk server.</span></span>  
  
 <span data-ttu-id="9470e-203">该配置（远程非事务性队列）还具有一个优点，即高可用性，这是因为队列的宿主远程服务器可以群集。</span><span class="sxs-lookup"><span data-stu-id="9470e-203">This configuration (remote non-transactional queues) also provides the added benefit of high availability as the remote server hosting the queue can be clustered.</span></span>  
  
### <a name="other-system-resource-contention"></a><span data-ttu-id="9470e-204">其他系统资源争用</span><span class="sxs-lookup"><span data-stu-id="9470e-204">Other System Resource Contention</span></span>  
 <span data-ttu-id="9470e-205">根据所配置的传输的性质，可能需要针对 HTTP/SOAP 配置系统资源，如 IIS（例如，MaxIOThreads 和 MaxWorkerThreads）。</span><span class="sxs-lookup"><span data-stu-id="9470e-205">Depending on the nature of the transport configured it may be necessary to configure system resources like IIS for HTTP/SOAP (for example, MaxIOThreads, MaxWorkerThreads).</span></span>  
  
### <a name="downstream-bottlenecks"></a><span data-ttu-id="9470e-206">下游瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-206">Downstream Bottlenecks</span></span>  
 <span data-ttu-id="9470e-207">如果下游系统从 BizTalk 接收数据的速度不够快，则将在 BizTalk 数据库中备份此输出数据并导致膨胀，从而导致触发阻止功能并缩小接收管道，进而影响 BizTalk 系统的总体吞吐量。</span><span class="sxs-lookup"><span data-stu-id="9470e-207">If the downstream system is unable to receive data fast enough from BizTalk this output data will back up within the BizTalk databases resulting in bloat causing throttling to kick in shrinking the receive pipe thereby impacting the overall throughput of the BizTalk system.</span></span> <span data-ttu-id="9470e-208">这一问题的直接表现将是后台处理的增加。</span><span class="sxs-lookup"><span data-stu-id="9470e-208">A direct indication of this would be Spool growth.</span></span>  
  
### <a name="throttling-impact"></a><span data-ttu-id="9470e-209">触发阻止功能的影响</span><span class="sxs-lookup"><span data-stu-id="9470e-209">Throttling Impact</span></span>  
 <span data-ttu-id="9470e-210">最终将触发阻止功能以保护系统不要进入不可恢复的状态。</span><span class="sxs-lookup"><span data-stu-id="9470e-210">Throttling will ultimately kick in to protect the system from reaching an unrecoverable state.</span></span> <span data-ttu-id="9470e-211">因此限流是验证系统是否工作正常并发现问题根源的好时机。</span><span class="sxs-lookup"><span data-stu-id="9470e-211">Thus throttling is a good place to verify whether the system is functioning normally and discover the source of the problem.</span></span> <span data-ttu-id="9470e-212">通过限流状态找到导致瓶颈的原因之后，请分析其他性能计数器以深入查找问题的根源。</span><span class="sxs-lookup"><span data-stu-id="9470e-212">After the cause of the bottleneck has been identified from the throttling state, analyze the other performance counters to drill down into the source of the problem.</span></span>  
  
 <span data-ttu-id="9470e-213">例如，MessageBox 数据库上的大量争用可能是由于大量使用 CPU 所致，大量使用 CPU 则可能是由于对磁盘进行过度分页所致，而对磁盘过度分页则可能是因为内存不足所致。</span><span class="sxs-lookup"><span data-stu-id="9470e-213">For example, high contention on the MessageBox database could be due to high CPU usage, which could be caused due to excessively paging to disk which could be caused due to low memory conditions.</span></span> <span data-ttu-id="9470e-214">MessageBox 上的大量争用也可能是由于较高的锁争用所致，此锁争用则可能是由于磁盘设备趋于饱和所致。</span><span class="sxs-lookup"><span data-stu-id="9470e-214">High contention on the MessageBox could also be caused due to high lock contention which could be due to saturated disk drives.</span></span>  
  
## <a name="biztalk-application-counters"></a><span data-ttu-id="9470e-215">BizTalk 应用程序计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-215">BizTalk Application Counters</span></span>  
  
|<span data-ttu-id="9470e-216">对象</span><span class="sxs-lookup"><span data-stu-id="9470e-216">Object</span></span>|<span data-ttu-id="9470e-217">实例</span><span class="sxs-lookup"><span data-stu-id="9470e-217">Instance</span></span>|<span data-ttu-id="9470e-218">计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-218">Counter</span></span>|<span data-ttu-id="9470e-219">Description</span><span class="sxs-lookup"><span data-stu-id="9470e-219">Description</span></span>|  
|------------|--------------|-------------|-----------------|  
|<span data-ttu-id="9470e-220">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="9470e-220">BizTalk Messaging</span></span>|<span data-ttu-id="9470e-221">RxHost</span><span class="sxs-lookup"><span data-stu-id="9470e-221">RxHost</span></span>|<span data-ttu-id="9470e-222">Documents received/sec</span><span class="sxs-lookup"><span data-stu-id="9470e-222">Documents Received/Sec</span></span>|<span data-ttu-id="9470e-223">传入速率</span><span class="sxs-lookup"><span data-stu-id="9470e-223">Incoming Rate</span></span>|  
|<span data-ttu-id="9470e-224">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="9470e-224">BizTalk Messaging</span></span>|<span data-ttu-id="9470e-225">TxHost</span><span class="sxs-lookup"><span data-stu-id="9470e-225">TxHost</span></span>|<span data-ttu-id="9470e-226">Documents processed/Sec</span><span class="sxs-lookup"><span data-stu-id="9470e-226">Documents Processed/Sec</span></span>|<span data-ttu-id="9470e-227">传出速率</span><span class="sxs-lookup"><span data-stu-id="9470e-227">Outgoing Rate</span></span>|  
|<span data-ttu-id="9470e-228">XLANG/s 业务流程</span><span class="sxs-lookup"><span data-stu-id="9470e-228">XLANG/s Orchestrations</span></span>|<span data-ttu-id="9470e-229">PxHost</span><span class="sxs-lookup"><span data-stu-id="9470e-229">PxHost</span></span>|<span data-ttu-id="9470e-230">Orchestrations Completed/Sec.</span><span class="sxs-lookup"><span data-stu-id="9470e-230">Orchestrations Completed/Sec.</span></span>|<span data-ttu-id="9470e-231">处理速率</span><span class="sxs-lookup"><span data-stu-id="9470e-231">Processing Rate</span></span>|  
|<span data-ttu-id="9470e-232">BizTalk: MessageBox： 常规计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-232">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="9470e-233">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="9470e-233">MsgBoxName</span></span>|<span data-ttu-id="9470e-234">假脱机大小</span><span class="sxs-lookup"><span data-stu-id="9470e-234">Spool Size</span></span>|<span data-ttu-id="9470e-235">所有主机队列的累积大小</span><span class="sxs-lookup"><span data-stu-id="9470e-235">Cumulative size of all Host Queues</span></span>|  
|<span data-ttu-id="9470e-236">BizTalk: MessageBox： 常规计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-236">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="9470e-237">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="9470e-237">MsgBoxName</span></span>|<span data-ttu-id="9470e-238">Tracking Data Size</span><span class="sxs-lookup"><span data-stu-id="9470e-238">Tracking Data Size</span></span>|<span data-ttu-id="9470e-239">MessageBox 上 TrackingData 表的大小</span><span class="sxs-lookup"><span data-stu-id="9470e-239">Size of TrackingData table on the MessageBox</span></span>|  
|<span data-ttu-id="9470e-240">BizTalk:MessageBox:主机计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-240">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="9470e-241">PxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="9470e-241">PxHost:MsgBoxName</span></span>|<span data-ttu-id="9470e-242">Host Queue - Length</span><span class="sxs-lookup"><span data-stu-id="9470e-242">Host Queue - Length</span></span>|<span data-ttu-id="9470e-243">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="9470e-243">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="9470e-244">BizTalk:MessageBox:主机计数器</span><span class="sxs-lookup"><span data-stu-id="9470e-244">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="9470e-245">TxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="9470e-245">TxHost:MsgBoxName</span></span>|<span data-ttu-id="9470e-246">Host Queue - Length</span><span class="sxs-lookup"><span data-stu-id="9470e-246">Host Queue - Length</span></span>|<span data-ttu-id="9470e-247">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="9470e-247">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="9470e-248">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="9470e-248">BizTalk:Message Agent</span></span>|<span data-ttu-id="9470e-249">RxHost</span><span class="sxs-lookup"><span data-stu-id="9470e-249">RxHost</span></span>|<span data-ttu-id="9470e-250">Database Size</span><span class="sxs-lookup"><span data-stu-id="9470e-250">Database Size</span></span>|<span data-ttu-id="9470e-251">发布 (PxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="9470e-251">Size of publishing (PxHost) Queue</span></span>|  
|<span data-ttu-id="9470e-252">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="9470e-252">BizTalk:Message Agent</span></span>|<span data-ttu-id="9470e-253">PxHost</span><span class="sxs-lookup"><span data-stu-id="9470e-253">PxHost</span></span>|<span data-ttu-id="9470e-254">Database Size</span><span class="sxs-lookup"><span data-stu-id="9470e-254">Database Size</span></span>|<span data-ttu-id="9470e-255">发布 (TxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="9470e-255">Size of publishing (TxHost) Queue</span></span>|  
|<span data-ttu-id="9470e-256">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="9470e-256">BizTalk:Message Agent</span></span>|<span data-ttu-id="9470e-257">HostName</span><span class="sxs-lookup"><span data-stu-id="9470e-257">HostName</span></span>|<span data-ttu-id="9470e-258">Message delivery throttling state</span><span class="sxs-lookup"><span data-stu-id="9470e-258">Message Delivery Throttling State</span></span>|<span data-ttu-id="9470e-259">影响 XLANG 和出站传输</span><span class="sxs-lookup"><span data-stu-id="9470e-259">Affects XLANG and Outbound transports</span></span>|  
|<span data-ttu-id="9470e-260">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="9470e-260">BizTalk:Message Agent</span></span>|<span data-ttu-id="9470e-261">HostName</span><span class="sxs-lookup"><span data-stu-id="9470e-261">HostName</span></span>|<span data-ttu-id="9470e-262">限制状态消息发布</span><span class="sxs-lookup"><span data-stu-id="9470e-262">Message Publishing Throttling State</span></span>|<span data-ttu-id="9470e-263">影响 XLANG 和入站传输</span><span class="sxs-lookup"><span data-stu-id="9470e-263">Affects XLANG and Inbound transports</span></span>|  
  
### <a name="where-do-i-start"></a><span data-ttu-id="9470e-264">应该从何处开始？</span><span class="sxs-lookup"><span data-stu-id="9470e-264">Where do I start?</span></span>  
 <span data-ttu-id="9470e-265">监视**消息传递限制状态**和**消息发布限制状态**对于每个主机实例通常是启动的好时机。</span><span class="sxs-lookup"><span data-stu-id="9470e-265">Monitoring the **Message Delivery Throttling State** and the **Message Publishing Throttling State** for each host instance is usually a good place to start.</span></span> <span data-ttu-id="9470e-266">如果这些计数器的值不为零，则表示 BizTalk 系统内正发生限流，并可进一步分析导致瓶颈的原因。</span><span class="sxs-lookup"><span data-stu-id="9470e-266">If the value of these counters is not zero it is indicative that throttling is happening within the BizTalk system and it is possible to further analyze the cause of the bottleneck.</span></span> <span data-ttu-id="9470e-267">有关的其他性能计数器的说明，请参阅[标识数据库层中的瓶颈](http://msdn.microsoft.com/library/f1dc58b5-73b0-41b5-9a1e-c0698485c732)。</span><span class="sxs-lookup"><span data-stu-id="9470e-267">For descriptions on the other performance counters, see [Identifying Bottlenecks in the Database Tier](http://msdn.microsoft.com/library/f1dc58b5-73b0-41b5-9a1e-c0698485c732).</span></span>  
  
## <a name="backlog-buildup"></a><span data-ttu-id="9470e-268">出现积压</span><span class="sxs-lookup"><span data-stu-id="9470e-268">Backlog Buildup</span></span>  
 <span data-ttu-id="9470e-269">对于 1-1 部署方案，接收 1 个消息将导致处理并传输 1 个消息，如果传出速率不等于传入速率，积压将在系统中的某处累积。</span><span class="sxs-lookup"><span data-stu-id="9470e-269">For a 1-1 deployment scenario where 1 message received results in 1 message processed and transmitted, if the Outgoing Rate does not equal the Incoming Rate, a backlog is building up somewhere in the system.</span></span> <span data-ttu-id="9470e-270">在这种情况下，可以监视 Spool Size。</span><span class="sxs-lookup"><span data-stu-id="9470e-270">For such a situation it is possible to monitor the Spool Size.</span></span>  
  
 <span data-ttu-id="9470e-271">如果 Spool 呈线性增长，则可以进一步深入探查以确认是哪个应用程序队列导致 Spool 增长。</span><span class="sxs-lookup"><span data-stu-id="9470e-271">If the Spool is growing linearly, it is possible to further drill down by verifying which Application Queue is responsible for the Spool growth.</span></span>  
  
 <span data-ttu-id="9470e-272">如果应用程序队列都没有增长，而 Spool 持续增长，这可能表明由于代理未运行或 SQL 服务器上其他系统资源的争用导致了作业无法及时清除。</span><span class="sxs-lookup"><span data-stu-id="9470e-272">If none of the application queues are growing and the Spool continues to grow it could mean that the purge jobs are unable to keep up either due to the agent not running or other system resource contention on the SQL server.</span></span>  
  
 <span data-ttu-id="9470e-273">如果某一应用程序队列增长，则诊断该增长的原因就尤为重要了。</span><span class="sxs-lookup"><span data-stu-id="9470e-273">If one of the application queues are growing, it is important to diagnose the cause of this growth.</span></span> <span data-ttu-id="9470e-274">监视无法清空特定应用程序队列的系统上的系统资源（例如，由于服务器上 CPU 资源紧张而导致业务流程 Host-Q 不断增长）。</span><span class="sxs-lookup"><span data-stu-id="9470e-274">Monitor the system resources on the system that is unable to drain the specific application queue (for example, Orchestration Host-Q is growing due to CPU starvation on the server).</span></span> <span data-ttu-id="9470e-275">此外还要验证特定主机实例的阻止计数器的值。</span><span class="sxs-lookup"><span data-stu-id="9470e-275">In addition verify the values of the throttling counter for the specific host instance.</span></span>  
  
 <span data-ttu-id="9470e-276">如果送达/发布状态不为零，请检查该值以确认限流的原因（例如，超过内存阈值、正在处理的消息数过多等）。</span><span class="sxs-lookup"><span data-stu-id="9470e-276">If the Delivery/Publishing State is not zero, check the value to confirm the reason for throttling (for example, memory threshold exceeded, in-flight message count too high etc.).</span></span>  
  
## <a name="f1-profiler"></a><span data-ttu-id="9470e-277">F1 事件探查器</span><span class="sxs-lookup"><span data-stu-id="9470e-277">F1 Profiler</span></span>  
 <span data-ttu-id="9470e-278">使用性能计数器，可以快速深入地检测瓶颈位置。</span><span class="sxs-lookup"><span data-stu-id="9470e-278">By using performance counters, it is possible to quickly detect at a high level the location of the bottleneck.</span></span> <span data-ttu-id="9470e-279">然而，一旦范围缩小，则可能需要进一步对代码进行深入探查以帮助缓解此问题。</span><span class="sxs-lookup"><span data-stu-id="9470e-279">However, once narrowed down, it may be necessary to drill down further into the code to help alleviate the problem.</span></span> <span data-ttu-id="9470e-280">Visual Studio 附带的 F1 事件探查器是非常有用的工具，它可帮助诊断代码在哪些地方花费了大量时间。</span><span class="sxs-lookup"><span data-stu-id="9470e-280">The F1 Profiler that ships with Visual Studio can be a very helpful tool to help diagnose where the code is spending most of its cycles.</span></span>  
  
 <span data-ttu-id="9470e-281">符号对帮助创建更多有意义的堆栈（特别对非托管代码）非常重要。</span><span class="sxs-lookup"><span data-stu-id="9470e-281">Symbols are important to help with creating a more meaningful stack (especially for unmanaged code).</span></span> <span data-ttu-id="9470e-282">例如，F1 事件探查器可帮助查明调用数和返回 API 调用所需的时间。</span><span class="sxs-lookup"><span data-stu-id="9470e-282">For example, the F1-Profiler can help pinpoint the number of invocations and the amount of time an API call takes to return.</span></span> <span data-ttu-id="9470e-283">进一步深入探查堆栈，可能检测到高延迟时间的根本原因。</span><span class="sxs-lookup"><span data-stu-id="9470e-283">Drilling further down the stack, it may be possible to detect the underlying cause of the high latency.</span></span> <span data-ttu-id="9470e-284">它可能是一个对数据库查询的阻止调用或仅是一个等待事件的调用。</span><span class="sxs-lookup"><span data-stu-id="9470e-284">It could be a blocking call to a database query or simply a call to wait on an event.</span></span>  
  
## <a name="l2l3-cache"></a><span data-ttu-id="9470e-285">L2/L3 缓存</span><span class="sxs-lookup"><span data-stu-id="9470e-285">L2/L3 Cache</span></span>  
 <span data-ttu-id="9470e-286">从硬件方面来看，使用 CPU 上的高速缓存可以获得最大益处。</span><span class="sxs-lookup"><span data-stu-id="9470e-286">The biggest benefits (from a hardware perspective) that can be gained is by utilizing onboard CPU cache.</span></span> <span data-ttu-id="9470e-287">较高的 CPU 高速缓存可增加高速缓存命中率，减少系统在内存和磁盘之间读/写数据页的需要。</span><span class="sxs-lookup"><span data-stu-id="9470e-287">Higher CPU cache helps increase cache hit rate reducing the need for the system to page data in and out of memory to disk.</span></span>  
  
## <a name="64-bit-performance-bottlenecks"></a><span data-ttu-id="9470e-288">64 位性能瓶颈</span><span class="sxs-lookup"><span data-stu-id="9470e-288">64-Bit Performance Bottlenecks</span></span>  
 <span data-ttu-id="9470e-289">64 位系统的性能表现可能不如 32 位系统获得的性能。</span><span class="sxs-lookup"><span data-stu-id="9470e-289">Performance on 64-bit systems may appear lower than what can be achieved on 32-bit systems.</span></span> <span data-ttu-id="9470e-290">这可能是由于若干原因造成的，最重要的原因就是内存。</span><span class="sxs-lookup"><span data-stu-id="9470e-290">This is possible due to a couple of reasons, the most important one being memory.</span></span>  
  
 <span data-ttu-id="9470e-291">对内存都为 2 GB 的 32 位系统和 64 位系统进行性能比较，并不是真正的同类型比较。</span><span class="sxs-lookup"><span data-stu-id="9470e-291">Measuring performance on a 32-bit system with 2-GB of memory and comparing the results to what can be achieved on a similar 64-bit system with 2-GB of memory is not a true apples to apples comparison.</span></span> <span data-ttu-id="9470e-292">64 位系统看起来受到 disk-IO 限制（较低的磁盘空闲时间百分比和较长的磁盘队列长度）以及 CPU 限制（最大的 CPU 占用率和大量的上下文切换）。</span><span class="sxs-lookup"><span data-stu-id="9470e-292">The 64-bit system will appear to be disk-IO bound (low % Disk Idle time & high Disk Queue Length) and CPU bound (max CPU & high Context Switching).</span></span> <span data-ttu-id="9470e-293">然而，这并不是因为在 64 位系统上执行文件 IO 开销更大的缘故。</span><span class="sxs-lookup"><span data-stu-id="9470e-293">However, this is not because performing file IO on a 64-bit system is more expensive.</span></span>  
  
 <span data-ttu-id="9470e-294">64 位系统需要更多内存（64 位寻址），而这会导致操作系统占用 2 GB 可用内存中的大部分内存。</span><span class="sxs-lookup"><span data-stu-id="9470e-294">The 64-bit system is more memory hungry (64-bit addressing) which results in the OS consuming most of the 2-GB available memory.</span></span> <span data-ttu-id="9470e-295">一旦发生这种情况，大部分的其他操作将导致对磁盘进行分页，这将给文件子系统造成压力。</span><span class="sxs-lookup"><span data-stu-id="9470e-295">Once this happens most other operations cause paging to disk which stresses the file subsystem.</span></span> <span data-ttu-id="9470e-296">此时，系统不仅占用多个 CPU 周期以将数据和代码页从内存调入/调出，而且受到大量的磁盘延迟开销的影响。</span><span class="sxs-lookup"><span data-stu-id="9470e-296">The system now not only spends CPU cycles paging in/out of memory both data and code but is also impacted by the high disk latency cost.</span></span> <span data-ttu-id="9470e-297">它表现为更多的磁盘争用和更多的 CPU 占用。</span><span class="sxs-lookup"><span data-stu-id="9470e-297">This manifests itself as both higher disk contention and higher CPU consumption.</span></span>  
  
 <span data-ttu-id="9470e-298">缓解此问题的方法是：通过升级内存（最好为 8 GB）来向上扩展服务器。</span><span class="sxs-lookup"><span data-stu-id="9470e-298">The way to alleviate this problem is to scale-up the server by upgrading the memory (ideally 8-GB).</span></span> <span data-ttu-id="9470e-299">然而，增加更多的内存并不会帮助提高吞吐量，除非导致该问题的根本原因是由于内存较小从而导致 CPU 资源紧张的缘故。</span><span class="sxs-lookup"><span data-stu-id="9470e-299">However, adding more memory will not help improve throughput unless the source of the problem is CPU starvation due to low memory conditions.</span></span>  
  
## <a name="using-bam-to-identify-bottlenecks-and-high-latency-issues"></a><span data-ttu-id="9470e-300">使用 BAM 来查找瓶颈和高延迟问题</span><span class="sxs-lookup"><span data-stu-id="9470e-300">Using BAM to identify bottlenecks and high latency issues</span></span>  
 <span data-ttu-id="9470e-301">在低延迟非常重要的情况下，可以使用 BAM 来测量系统完成 BizTalk 系统内的每个阶段所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="9470e-301">In situations where low latency is important, you can use BAM to measure the time the system takes to complete each stage within the BizTalk system.</span></span> <span data-ttu-id="9470e-302">虽然跟踪的消息事件和服务实例数据可用于调试路由消息中的消息状态并诊断问题的根源，但 BAM 可用于跟踪消息流上的各个点。</span><span class="sxs-lookup"><span data-stu-id="9470e-302">Although  tracked message event and service instance data can be used to debug the state of messages and diagnose the source of problems in routing messages, BAM can be used to track various points through the message flow.</span></span> <span data-ttu-id="9470e-303">通过创建一个 BAM 跟踪配置文件（定义一个带有继续符的活动），可以测量系统不同部分之间的延迟，以帮助跟踪工作流进程中成本最高的阶段。</span><span class="sxs-lookup"><span data-stu-id="9470e-303">By creating a BAM tracking profile (defining an activity with continuations), you can measure latency between different parts of the system to help track the most expensive stages within the workflow process.</span></span>