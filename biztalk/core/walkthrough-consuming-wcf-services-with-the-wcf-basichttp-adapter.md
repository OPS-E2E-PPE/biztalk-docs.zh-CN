---
title: 演练： 使用 WCF 服务的 WCF BasicHttp 适配器 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 2d280198-ba55-4937-91c9-19d6d0ed3194
caps.latest.revision: 49
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2d72ccdb39bec5e063f48206df0bfcc54364d11c
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36981422"
---
# <a name="walkthrough-consuming-wcf-services-with-the-wcf-basichttp-adapter"></a><span data-ttu-id="9c65b-102">演练： 使用 Wcf-basichttp 适配器使用 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="9c65b-102">Walkthrough: Consuming WCF Services with the WCF-BasicHttp Adapter</span></span>
  
> [!NOTE]
>  <span data-ttu-id="9c65b-103">有关适配器的详细信息，请参阅[BizTalk Server 中的适配器](../core/adapters-in-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="9c65b-103">For more information about adapters, see [Adapters in BizTalk Server](../core/adapters-in-biztalk-server.md).</span></span>  
  
## <a name="introduction"></a><span data-ttu-id="9c65b-104">简介</span><span class="sxs-lookup"><span data-stu-id="9c65b-104">Introduction</span></span>
  
 <span data-ttu-id="9c65b-105">在本演练中，将通过 BizTalk 消息传送和 WCF-BasicHttp 发送适配器使用 Internet 信息服务 (IIS) 中的 [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-105">In this walkthrough, you will consume a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] service hosted inside Internet Information Services (IIS) using BizTalk messaging and the WCF-BasicHttp send adapter.</span></span> <span data-ttu-id="9c65b-106">此适配器使用**BasicHttpBinding**绑定来提供与 Web 服务作为 Microsoft 之间的桥梁的早期版本兼容的传输/协议堆栈实现[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]和[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]功能。</span><span class="sxs-lookup"><span data-stu-id="9c65b-106">This adapter uses the **BasicHttpBinding** binding to provide a transport/protocol stack implementation compatible with earlier versions of Web services to serve as a bridge between Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] functionality.</span></span> <span data-ttu-id="9c65b-107">业务流程可绑定至使用 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 适配器来调用 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的发送端口，并利用其逻辑业务处理中的功能。</span><span class="sxs-lookup"><span data-stu-id="9c65b-107">An orchestration can bind to a send port that uses a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] adapter to call a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service and leverage its functionality within its logical business processing.</span></span>  
  
 <span data-ttu-id="9c65b-108">WCF-BasicHttp 适配器由一个发送适配器和一个接收适配器组成。</span><span class="sxs-lookup"><span data-stu-id="9c65b-108">The WCF-BasicHttp adapter consists of both a send adapter and a receive adapter.</span></span> <span data-ttu-id="9c65b-109">在本示例中，将仅使用此适配器的发送功能通过 HTTP 协议进行对 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的 WCF 服务请求。</span><span class="sxs-lookup"><span data-stu-id="9c65b-109">In this sample you will use only the send side of this adapter to make WCF service requests through the HTTP protocol to a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  <span data-ttu-id="9c65b-110">对于要求-响应发送端口，发送适配器将发送至 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务并接收结果响应。</span><span class="sxs-lookup"><span data-stu-id="9c65b-110">For a Solicit-Response send port, the send adapter sends to a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service and receives back a result response.</span></span>  <span data-ttu-id="9c65b-111">相反，[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 接收适配器允许 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 业务流程由 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 客户端应用程序从外部发布和调用。</span><span class="sxs-lookup"><span data-stu-id="9c65b-111">Conversely, a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] receive adapter allows a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] orchestration to be published and called externally by a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] client application.</span></span> <span data-ttu-id="9c65b-112">请参阅[发布 WCF 服务](../core/publishing-wcf-services.md)有关其他信息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-112">Refer to the [Publishing WCF Services](../core/publishing-wcf-services.md) for additional information.</span></span>  
  
 <span data-ttu-id="9c65b-113">在完成本演练后，你将了解如何执行以下任务：</span><span class="sxs-lookup"><span data-stu-id="9c65b-113">After completing this walkthrough, you will understand how to perform the following tasks:</span></span>  
  
- <span data-ttu-id="9c65b-114">从[!INCLUDE[btsCoName](../includes/btsconame-md.md)]Visual Studio 中，使用**部署**命令来部署包含的程序集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]解决方案并[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务到本地实例中的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="9c65b-114">From within [!INCLUDE[btsCoName](../includes/btsconame-md.md)]Visual Studio, use the **Deploy** command to deploy the assemblies containing the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution and the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to a local instance of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="9c65b-115">这将创建一个用这些程序集填充的 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="9c65b-115">This creates a BizTalk application that is populated with the assemblies.</span></span>  
  
- <span data-ttu-id="9c65b-116">从 Visual Studio 中，使用**BizTalk WCF 服务使用向导**生成[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]架构和类型使用所需[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-116">From within Visual Studio, use the **BizTalk WCF Service Consuming Wizard** to generate the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] schemas and types necessary to consume the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-117">将生成空业务流程，您可以使用并将其绑定至逻辑端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-117">An empty orchestration is generated as well that you can use and bind to a logical port.</span></span> <span data-ttu-id="9c65b-118">此业务流程与架构和类型一同进行编译和部署。</span><span class="sxs-lookup"><span data-stu-id="9c65b-118">This orchestration is complied and deployed along with schemas and types.</span></span> <span data-ttu-id="9c65b-119">但是，业务流程工作流处理在此处为空，并不在此示例中使用，因为此示例仅是一个纯 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 消息传送方案。</span><span class="sxs-lookup"><span data-stu-id="9c65b-119">But the orchestration workflow processing is empty here and not used in this sample as this is merely a pure [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] messaging scenario.</span></span>  
  
- <span data-ttu-id="9c65b-120">在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理控制台中，通过使用 WCF-BasicHttp 发送端口来配置基于内容的路由。</span><span class="sxs-lookup"><span data-stu-id="9c65b-120">From the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, configure content-based routing by using the WCF-BasicHttp send port.</span></span> <span data-ttu-id="9c65b-121">将配置**SOAPAction**标头的目标[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务将要接收。</span><span class="sxs-lookup"><span data-stu-id="9c65b-121">You will configure the **SOAPAction** header that the target [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service expects to receive.</span></span>  
  
- <span data-ttu-id="9c65b-122">在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理控制台中，将筛选器表达式配置为将 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务可以发送的任何 SOAP 错误消息路由到输出文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-122">From the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, configure the filter expression to route any SOAP fault messages that a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service can send to an output folder.</span></span>  
  
- <span data-ttu-id="9c65b-123">在 Internet 信息服务 (IIS) 管理器中，将承载 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的 Web 应用程序配置为公开其元数据。</span><span class="sxs-lookup"><span data-stu-id="9c65b-123">From within Internet Information Services (IIS) Manager, configure the Web application hosting the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to expose its metadata.</span></span> <span data-ttu-id="9c65b-124">启用后， **BizTalk WCF 服务使用向导**可以获得此元数据来生成架构和类型来访问[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-124">After it is enabled, the **BizTalk WCF Service Consuming Wizard** can obtain this metadata to generate types and schemas to access the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="9c65b-125">必要條件</span><span class="sxs-lookup"><span data-stu-id="9c65b-125">Prerequisites</span></span>  
 <span data-ttu-id="9c65b-126">若要执行本示例中的步骤，请确保你的环境中安装了以下必备软件：</span><span class="sxs-lookup"><span data-stu-id="9c65b-126">To perform the steps in this sample ensure that your environment installs the following prerequisites:</span></span>  
  
- <span data-ttu-id="9c65b-127">运行本示例的计算机和生成程序集和运行部署过程的计算机需要 Microsoft [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]，Microsoft [!INCLUDE[netfx40_short](../includes/netfx40-short-md.md)]，与 Microsoft BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="9c65b-127">Both the computer that builds the assemblies and runs the deployment process, and the computer that runs the sample, require Microsoft [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)], Microsoft [!INCLUDE[netfx40_short](../includes/netfx40-short-md.md)], and Microsoft BizTalk Server.</span></span>  
  
- <span data-ttu-id="9c65b-128">用于构建程序集和运行部署过程的计算机需要安装 Microsoft Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="9c65b-128">The computer used to build the assemblies and run the deployment process requires Microsoft Visual Studio.</span></span>  
  
- <span data-ttu-id="9c65b-129">运行示例的计算机需要 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 适配器和 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 管理工具。</span><span class="sxs-lookup"><span data-stu-id="9c65b-129">The computer that runs the sample requires the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapters and the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Administration Tools.</span></span> <span data-ttu-id="9c65b-130">这些是用于安装 Microsoft BizTalk Server 安装过程的选项。</span><span class="sxs-lookup"><span data-stu-id="9c65b-130">These are options to install during setup of Microsoft BizTalk Server.</span></span>  
  
- <span data-ttu-id="9c65b-131">在用于执行管理任务的计算机上，你必须使用作为 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理员组成员的用户帐户运行，才能在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理控制台内配置 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 应用程序设置。</span><span class="sxs-lookup"><span data-stu-id="9c65b-131">On the computers that you use to perform administrative tasks, you must run as a user account that is a member of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administrators group to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application settings within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="9c65b-132">此用户帐户还必须是本地管理员组的成员，才能部署应用程序，管理主机实例以及其他可能需要的任务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-132">This user account must also be a member of the local Administrators group for application deployment, managing host instances, and other tasks that may be required.</span></span>  
  
- <span data-ttu-id="9c65b-133">需要的任何计算机上[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]功能，完成的一次性安装过程[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]在示例[ http://go.microsoft.com/fwlink/?LinkId=135510 ](http://go.microsoft.com/fwlink/?LinkId=135510)。</span><span class="sxs-lookup"><span data-stu-id="9c65b-133">On any computer that requires [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] capability, complete the one-time setup procedure for the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] samples at [http://go.microsoft.com/fwlink/?LinkId=135510](http://go.microsoft.com/fwlink/?LinkId=135510).</span></span>  
  
- <span data-ttu-id="9c65b-134">在运行示例并将绑定或 .msi 文件导入 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的计算机上，确保主机不是受信任主机，否则导入将失败。</span><span class="sxs-lookup"><span data-stu-id="9c65b-134">On the computer that runs the sample and imports a binding or an .msi file into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], ensure the host is not a trusted host or the import will fail.</span></span>  
  
- <span data-ttu-id="9c65b-135">你必须下载演练代码并将其解压缩到您的计算机。</span><span class="sxs-lookup"><span data-stu-id="9c65b-135">You must download the walkthrough code and extract it to your computer.</span></span>  <span data-ttu-id="9c65b-136">本演练是整个的一部分[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]适配器演练包。</span><span class="sxs-lookup"><span data-stu-id="9c65b-136">This walkthrough is a part of the entire [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapter Walkthrough package.</span></span> <span data-ttu-id="9c65b-137">您可以下载文件**WCFAdapterWalkthroughs.exe**从[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]开发人员中心，[http://go.microsoft.com/fwlink/?LinkId=194140](http://go.microsoft.com/fwlink/?LinkId=194140)。</span><span class="sxs-lookup"><span data-stu-id="9c65b-137">You can download the file **WCFAdapterWalkthroughs.exe** from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Developer Center at[http://go.microsoft.com/fwlink/?LinkId=194140](http://go.microsoft.com/fwlink/?LinkId=194140).</span></span>  
  
## <a name="deploy-the-sample-wcf-service"></a><span data-ttu-id="9c65b-138">部署示例 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="9c65b-138">Deploy the sample WCF service</span></span>  
  
1. <span data-ttu-id="9c65b-139">运行自解压**WCFBasicHttpSendAdapter.exe**文件，并将文件提取到**C:\WCFBasicHttpSendAdapter**文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-139">Run the self-extracting **WCFBasicHttpSendAdapter.exe** file and extract the files into the **C:\WCFBasicHttpSendAdapter** folder.</span></span>  
  
2. <span data-ttu-id="9c65b-140">打开**C:\WCFBasicHttpSendAdapter\WCFBasicHttpSendAdapter.sln** Visual Studio 中。</span><span class="sxs-lookup"><span data-stu-id="9c65b-140">Open the **C:\WCFBasicHttpSendAdapter\WCFBasicHttpSendAdapter.sln** in Visual Studio.</span></span>  
  
3. <span data-ttu-id="9c65b-141">在解决方案资源管理器，展开**BasicHttpWCFServiceConsuming**项目。</span><span class="sxs-lookup"><span data-stu-id="9c65b-141">In Solution Explorer, expand the **BasicHttpWCFServiceConsuming** project.</span></span> <span data-ttu-id="9c65b-142">此项目为将由发送端口调用的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-142">This project is the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service that will be called by the send port.</span></span> <span data-ttu-id="9c65b-143">它将承载于使用 Internet 信息服务 (IIS) 的托管主机环境中。</span><span class="sxs-lookup"><span data-stu-id="9c65b-143">It will be hosted in a managed host environment using Internet Information Services (IIS).</span></span> <span data-ttu-id="9c65b-144">在 IIS 中承载将使用基于消息的激活来管理服务的激活和生存期。</span><span class="sxs-lookup"><span data-stu-id="9c65b-144">Hosting in IIS uses message-based activation to manage the activation and lifetime of the service.</span></span> <span data-ttu-id="9c65b-145">展开**App_Code**，然后打开**OrderProcess.cs**查看。</span><span class="sxs-lookup"><span data-stu-id="9c65b-145">Expand **App_Code**, and then open **OrderProcess.cs** to review.</span></span> <span data-ttu-id="9c65b-146">这[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务接收订单请求消息通过**OrderRequest**方法。</span><span class="sxs-lookup"><span data-stu-id="9c65b-146">This [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service receives order request messages through the **OrderRequest** method.</span></span> <span data-ttu-id="9c65b-147">OrderProcess.cs 文件包含 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的接口定义和实现。</span><span class="sxs-lookup"><span data-stu-id="9c65b-147">The OrderProcess.cs file contains the interface defition and implementation of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-148">它仅返回该订单响应消息通过**OrderResponse**方法。</span><span class="sxs-lookup"><span data-stu-id="9c65b-148">It simply returns order response messages through the **OrderResponse** method.</span></span>  
  
4. <span data-ttu-id="9c65b-149">查看 OrderProcess.svc 文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-149">Review the OrderProcess.svc file.</span></span> <span data-ttu-id="9c65b-150">它仅包含一行，该行用来告诉 IIS 为客户端应用程序激活服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-150">It contains only one line which is used to tell IIS to activate the service for a client application.</span></span> <span data-ttu-id="9c65b-151"><strong>@ServiceHost</strong>属性用来承载该服务是中的扩展点[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]编程模型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-151">The <strong>@ServiceHost</strong> attribute used to host the service is a point of extensibility within the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] programming model.</span></span> <span data-ttu-id="9c65b-152">使用工厂模式**ServiceHostFactory**若要创建的实例**ServiceHost**的实例与[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务来处理传入的请求。</span><span class="sxs-lookup"><span data-stu-id="9c65b-152">A factory pattern uses **ServiceHostFactory** to create an instance of **ServiceHost** with an instance of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to handle incoming requests.</span></span> <span data-ttu-id="9c65b-153">基于此实例的实例化**ServiceBehaviorAttribute.ConcurrencyMode**属性，确定服务是否支持一个线程、 多个线程或可重入调用。</span><span class="sxs-lookup"><span data-stu-id="9c65b-153">Instantiation of this instance is based upon the **ServiceBehaviorAttribute.ConcurrencyMode** property, which determines whether a service supports one thread, multiple threads, or reentrant calls.</span></span> <span data-ttu-id="9c65b-154">实例化也由**ServiceBehavior.InstanceMode**属性，确定如果只有一个实例将提供所有调用方 （单一实例），如果一个实例将创建每个调用 （无状态），或者如果一个实例将为每个会话 （有状态） 创建。</span><span class="sxs-lookup"><span data-stu-id="9c65b-154">Instantiation is also determined by the **ServiceBehavior.InstanceMode** property, which determines if a only one instance will serve all callers (singleton), if one instance will be created per call (stateless), or if one instance will be created for each session (stateful).</span></span>  
  
   ```  
   <%@ServiceHost language=c# Debug="true" Service="Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming.OrderProcessServiceType" %>  
   ```  
  
5. <span data-ttu-id="9c65b-155">在 Visual Studio 中，在解决方案资源管理器中打开**Web.config**查看。</span><span class="sxs-lookup"><span data-stu-id="9c65b-155">In Visual Studio, in Solution Explorer, open **Web.config** to review.</span></span> <span data-ttu-id="9c65b-156">承载于 IIS 中时，[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务使用 Web.config 文件进行配置，而不是像承载于控制台应用程序中时使用 app.config 文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-156">When hosted in IIS, a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service is configured using a Web.config file instead of an app.config file as when hosted in a console application.</span></span>  
  
   -   <span data-ttu-id="9c65b-157">请确保**httpGetEnabled**的属性\< **serviceMetaData** \>元素设置为`true`以便**BizTalk WCF 服务使用向导**可以使用该服务的元数据。</span><span class="sxs-lookup"><span data-stu-id="9c65b-157">Make sure that the **httpGetEnabled** attribute of the \<**serviceMetaData**\> element is set to `true` so that the **BizTalk WCF Service Consuming Wizard** can consume the metadata for the service.</span></span>  
  
   -   <span data-ttu-id="9c65b-158">请确保**模式下**的属性\<**安全**\>元素设置为**无**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-158">Make sure that the **mode** attribute of the \<**security**\> element is set to **None**.</span></span> <span data-ttu-id="9c65b-159">由于本演练使用**None**安全模式下，Web 应用程序承载该服务必须配置为允许匿名访问。</span><span class="sxs-lookup"><span data-stu-id="9c65b-159">Because this walkthrough uses the **None** security mode, the Web application hosting this service must be configured to allow anonymous access.</span></span>  
  
6. <span data-ttu-id="9c65b-160">因为**Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming**程序集必须安装在 GAC 中，它将需要一个强名称密钥文件，以完成部署过程。</span><span class="sxs-lookup"><span data-stu-id="9c65b-160">Because the **Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming** assembly must be installed in the GAC, it will need a strong name key file to complete the deployment process.</span></span> <span data-ttu-id="9c65b-161">右键单击**BasicHttpWcfServiceConsuming**项目，并单击**属性**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-161">Right-click the **BasicHttpWcfServiceConsuming** project, and then click **Properties**.</span></span> <span data-ttu-id="9c65b-162">上**属性**页上，单击**签名**，然后选择**程序集签名**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-162">On the **Properties** page, click **Signing**, and select **Sign the assembly**.</span></span> <span data-ttu-id="9c65b-163">单击中的向下箭头**选择强名称密钥文件**下拉列表中，单击**\<新建\>**，然后输入`keyfile.snk`中**密钥文件名称**文本框中。</span><span class="sxs-lookup"><span data-stu-id="9c65b-163">Click the down arrow in the **Choose a strong name key file** drop-down list, click **\<New\>**, and enter `keyfile.snk` in the **key file name** textbox.</span></span>  <span data-ttu-id="9c65b-164">取消选中**保护密钥文件使用密码**，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-164">Uncheck **Protect my key file with a password**, and then click **OK**.</span></span>  
  
7. <span data-ttu-id="9c65b-165">在解决方案资源管理器中右键单击**BasicHttpWcfServiceConsuming**，然后单击**重新生成**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-165">In Solution Explorer, right-click **BasicHttpWcfServiceConsuming**, and then click **Rebuild**.</span></span>  
  
8. <span data-ttu-id="9c65b-166">使用 Windows 资源管理器中，将复制的内容**C:\WCFBasicHttpSendAdapter\BasicHttpWCFServiceConsuming**到**C:\InetPub\wwwroot**文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-166">Using Windows Explorer, copy the contents of **C:\WCFBasicHttpSendAdapter\BasicHttpWCFServiceConsuming** to the **C:\InetPub\wwwroot** folder.</span></span>  
  
9. <span data-ttu-id="9c65b-167">配置 Web 应用程序以承载[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9c65b-167">Configure the Web application to host the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service as follows:</span></span>  
  
   1. <span data-ttu-id="9c65b-168">单击**启动**，依次指向**管理工具**，然后单击**Internet Information Services (IIS) Manager**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-168">Click **Start**, point to **Administrator Tools**, and then click **Internet Information Services (IIS) Manager**.</span></span>  
  
   2. <span data-ttu-id="9c65b-169">创建此服务将运行在其中的应用程序池。</span><span class="sxs-lookup"><span data-stu-id="9c65b-169">Create an application pool within which this service will run.</span></span> <span data-ttu-id="9c65b-170">右键单击**应用程序池**，单击**添加应用程序池...**，输入应用程序池的名称，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-170">Right-click **Application Pools**, click **Add Application Pool…**, enter a name for the application pool, and then click **OK**.</span></span>  
  
   3. <span data-ttu-id="9c65b-171">展开**应用程序池**，右键单击您刚的应用程序池创建，并选择**高级设置**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-171">Expand **Application Pools**, right-click the application pool you just created, and then select **Advanced Settings**.</span></span> <span data-ttu-id="9c65b-172">下**过程模型**部分中，输入的帐户有权[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库下**标识**字段。</span><span class="sxs-lookup"><span data-stu-id="9c65b-172">Under **Process Model** section, enter the account which has access to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases under the **Identity** field.</span></span>  
  
   4. <span data-ttu-id="9c65b-173">展开**站点**，展开**Default Web Site**，右键单击**BasicHttpWCFServiceConsuming**，然后单击**转换为应用程序**若要为此创建 Web 应用程序[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-173">Expand **Sites**, expand **Default Web Site**, right-click **BasicHttpWCFServiceConsuming**, and then click **Convert to Application** to create a Web application for this [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
   5. <span data-ttu-id="9c65b-174">在中**转换为应用程序**对话框中，单击**选择**若要选择之前创建的应用程序池，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-174">In the **Convert to Application** dialog box, click **Select** to select the application pool created earlier, and then click **OK**.</span></span>  
  
   6. <span data-ttu-id="9c65b-175">在功能视图中，单击**身份验证**图标，并确保**匿名身份验证**选项**启用**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-175">In Features View, click the **Authentication** icon and ensure that the **Anonymous Authentication** option is **enabled**.</span></span> <span data-ttu-id="9c65b-176">这支持[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务与**None**安全模式。</span><span class="sxs-lookup"><span data-stu-id="9c65b-176">This supports [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] services with the **None** security mode.</span></span>  
  
10. <span data-ttu-id="9c65b-177">测试已发布的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9c65b-177">Test the published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service as follows:</span></span>  
  
    1. <span data-ttu-id="9c65b-178">在 IIS 管理器中，展开**网站**，然后展开**BasicHttpWCFServiceConsuming**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-178">In IIS Manager, expand **Web Sites**, and then expand **BasicHttpWCFServiceConsuming**.</span></span>  
  
    2. <span data-ttu-id="9c65b-179">在 IIS 管理器中，在右窗格中，右键单击**OrderProcess.svc**，然后单击**浏览**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-179">In IIS Manager, in the right pane, right-click **OrderProcess.svc**, and then click **Browse**.</span></span> <span data-ttu-id="9c65b-180">这将打开 Internet Explorer 以显示**OrderProcessServiceType 服务**页，指示你已成功创建一个正在运行[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-180">This opens Internet Explorer to display the **OrderProcessServiceType Service** page that indicates you have successfully created a running [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-181">此页还包含一个完整的 WSDL 地址，您可以通过复制该地址并将其用于服务元数据工具 (svcutil.exe) 来创建可用于该服务客户端应用程序开发的代理代码和配置文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-181">The page also includes a full WSDL address that you can copy and use with the Service Metadata Tool (svcutil.exe) to create proxy code and a configuration file that can be used to develop a client application for the service.</span></span>  
  
    3. <span data-ttu-id="9c65b-182">将完整的 WSDL 地址复制到系统剪贴板中。</span><span class="sxs-lookup"><span data-stu-id="9c65b-182">Copy the full WSDL address to the system Clipboard.</span></span> <span data-ttu-id="9c65b-183">不复制 **"svcutil.exe"** 一部分： **http://localhost/BasicHttpWcfServiceConsuming/OrderProcess.svc?wsdl**</span><span class="sxs-lookup"><span data-stu-id="9c65b-183">Do not copy the **“svcutil.exe”** part: **http://localhost/BasicHttpWcfServiceConsuming/OrderProcess.svc?wsdl**</span></span>  
  
## <a name="add-the-schemas-and-types-for-the-wcf-basichttp-adapter-to-the-sample-biztalk-application"></a><span data-ttu-id="9c65b-184">将架构和 Wcf-basichttp 适配器的类型添加到 BizTalk 应用程序示例</span><span class="sxs-lookup"><span data-stu-id="9c65b-184">Add the schemas and types for the WCF-BasicHttp adapter to the sample BizTalk application</span></span>  
  
1. <span data-ttu-id="9c65b-185">由于此适配器将调用 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务，因此它需要架构和类型中有关如何使用元数据对该服务进行此调用的信息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-185">Since the adapter will call the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service it needs information from schemas and types about how to make that call to that service using the metadata.</span></span> <span data-ttu-id="9c65b-186">**BizTalkApp**提供了要使用的项目[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-186">**BizTalkApp** provides the artifacts to consume the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-187">在 Visual Studio 中，在解决方案资源管理器中右键单击**BizTalkApp**，单击**添加**，然后单击**添加生成的项**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-187">In Visual Studio, in Solution Explorer, right-click **BizTalkApp**, click **Add**, and then click **Add Generated Items**.</span></span>  
  
2. <span data-ttu-id="9c65b-188">在中**添加生成的项**对话框中**模板**部分中，选择**使用 WCF 服务**，然后单击**添加**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-188">In the **Add Generated Items** dialog box, in the **Templates** section, select **Consume WCF Service**, and then click **Add**.</span></span>  
  
3. <span data-ttu-id="9c65b-189">上**欢迎使用 BizTalk WCF 服务使用向导**页上，单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-189">On the **Welcome to the BizTalk WCF Service Consuming Wizard** page, click **Next**.</span></span> <span data-ttu-id="9c65b-190">此向导将读取元数据并创建架构和类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-190">This wizard will read the metadata and create schemas and types.</span></span>  
  
4. <span data-ttu-id="9c65b-191">上**元数据来源**页上，选择**元数据交换 (MEX) 终结点**选项以使用元数据从 URL 复制到剪贴板中的上一个过程，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-191">On the **Metadata source** page, select the **Metadata Exchange (MEX) endpoint** option to consume metadata from the URL that you copied to the Clipboard in the previous procedure, and then click **Next**.</span></span>  
  
5. <span data-ttu-id="9c65b-192">上**元数据终结点**页上，将粘贴到在上一步骤中复制的完整 WSDL 地址**元数据地址**下拉列表，再单击**获取**获取该示例的元数据文档[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-192">On the **Metadata Endpoint** page, paste the full WSDL address that you copied in the previous procedure to the **Metadata Address** drop-down list, and then click **Get** to get the metadata document for the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-193">获取元数据使**下一步**按钮。</span><span class="sxs-lookup"><span data-stu-id="9c65b-193">Obtaining the metadata enables the **Next** button.</span></span> <span data-ttu-id="9c65b-194">单击 **“下一步”** 继续。</span><span class="sxs-lookup"><span data-stu-id="9c65b-194">Click **Next** to continue.</span></span>  
  
6. <span data-ttu-id="9c65b-195">上**导入 WCF 服务元数据摘要**页上，查看你的设置。</span><span class="sxs-lookup"><span data-stu-id="9c65b-195">On the **Import WCF Service Metadata Summary** page, review your settings.</span></span> <span data-ttu-id="9c65b-196">此对话框会显示要导入的元数据的命名空间、XSD 及 WSDL 摘要。</span><span class="sxs-lookup"><span data-stu-id="9c65b-196">This dialog box shows the namespace, XSD, and WSDL summaries of the metadata to be imported.</span></span> <span data-ttu-id="9c65b-197">它还显示业务流程 (.odx)、 绑定 (.xml) 和架构 (.xsd) 文件的写入位置导入过程。</span><span class="sxs-lookup"><span data-stu-id="9c65b-197">It also shows where orchestration (.odx), bindings (.xml), and schema (.xsd) files will be written during the import process.</span></span> <span data-ttu-id="9c65b-198">单击**导入**创建 BizTalk 项目和使用该示例使用类型[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-198">Click **Import** to create the BizTalk artifacts and types to be used for consuming the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
7. <span data-ttu-id="9c65b-199">上**完成 BizTalk WCF 服务使用向导**页上，单击**完成**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-199">On the **Completing the BizTalk WCF Service Consuming Wizard** page, click **Finish**.</span></span>  
  
8. <span data-ttu-id="9c65b-200">在 Visual Studio 中，在解决方案资源管理器**BizTalk WCF 服务使用向导**生成以下文件：</span><span class="sxs-lookup"><span data-stu-id="9c65b-200">In Visual Studio, in Solution Explorer, the **BizTalk WCF Service Consuming Wizard** generates the following files:</span></span>  
  
   - <span data-ttu-id="9c65b-201">业务流程文件**OrderProcessServiceType.odx**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-201">An orchestration file **OrderProcessServiceType.odx**.</span></span> <span data-ttu-id="9c65b-202">在此业务流程中没有工作流阶段。</span><span class="sxs-lookup"><span data-stu-id="9c65b-202">There are no workflow stages in this orchestration.</span></span> <span data-ttu-id="9c65b-203">但是，您可以向其中添加并将其绑定至逻辑端口以使用 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-203">However, you could add to it and bind it to logical ports to consume the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-204">它包含重要的 BizTalk 类型（例如端口类型和多部分消息类型），在此示例中将会使用这些类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-204">It does contain the important BizTalk types such as port types and multipart message types, which are used in this sample.</span></span> <span data-ttu-id="9c65b-205">若要查看此信息，请双击**OrderProcessServiceType.odx**业务流程。</span><span class="sxs-lookup"><span data-stu-id="9c65b-205">To view this information, double-click the **OrderProcessServiceType.odx** orchestration.</span></span> <span data-ttu-id="9c65b-206">单击**视图**，单击**其他 Windows**，然后单击**业务流程视图**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-206">Click **View**, click **Other Windows**, and click **Orchestration View**.</span></span> <span data-ttu-id="9c65b-207">展开**类型**，展开**端口类型**，然后展开**IOrderProcess**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-207">Expand **Types**, expand **Port Types**, and then expand **IOrderProcess**.</span></span> <span data-ttu-id="9c65b-208">你将看到**提交**方法。</span><span class="sxs-lookup"><span data-stu-id="9c65b-208">You will see the **Submit** method.</span></span> <span data-ttu-id="9c65b-209">展开该方法，您将看到**OrderRequest**并**OrderResponse**端口类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-209">Expand that method and you will see the **OrderRequest** and **OrderResponse** port types.</span></span> <span data-ttu-id="9c65b-210">单击每个端口类型并查看其**说明**字段中的属性浏览器和查看不同的 WSDL 输入和输出消息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-210">Click each port type and view their **Description** fields in the property browser and see the different WSDL input and output messages.</span></span> <span data-ttu-id="9c65b-211">单击**多部分消息类型**并查看**OrderRequest**并**OrderResponse**多部分消息类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-211">Click **Multi-Part Message Types** and view the **OrderRequest** and **OrderResponse** multi-part message types.</span></span> <span data-ttu-id="9c65b-212">单击他们**说明**字段和视图 WDSL 消息名称对于每个消息类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-212">Click their **Description** fields and view the WDSL message names for each message type.</span></span>  
  
   - <span data-ttu-id="9c65b-213">将生成两个架构文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-213">Two schema files are generated.</span></span> <span data-ttu-id="9c65b-214">第一个架构文件 (**OrderProcessServiceType_biztalk_WCF_basichttpsendadapter_basichttpWCFserviceconsuming.xsd**) 定义的消息类型示例[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务使用。</span><span class="sxs-lookup"><span data-stu-id="9c65b-214">The first schema file (**OrderProcessServiceType_biztalk_WCF_basichttpsendadapter_basichttpWCFserviceconsuming.xsd**) defines the message types that the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service uses.</span></span> <span data-ttu-id="9c65b-215">它使用**OrderID**字段中同时**OrderRequest**并**OrderResponse**调用。</span><span class="sxs-lookup"><span data-stu-id="9c65b-215">It uses the **OrderID** field in both **OrderRequest** and **OrderResponse** calls.</span></span>  
  
   - <span data-ttu-id="9c65b-216">第二个架构文件 (**OrderProcessServiceType_schemas_microsoft_com_2003_10_Serialization.xsd**) 由导出[DataContractSerializer](http://go.microsoft.com/fwlink/?LinkId=81722)的类型、 元素和属性命名空间， http://schemas.microsoft.com/2003/10/Serialization/。</span><span class="sxs-lookup"><span data-stu-id="9c65b-216">The second schema file (**OrderProcessServiceType_schemas_microsoft_com_2003_10_Serialization.xsd**) is exported by [DataContractSerializer](http://go.microsoft.com/fwlink/?LinkId=81722) for the types, elements, and attributes from the namespace, http://schemas.microsoft.com/2003/10/Serialization/.</span></span>  
  
   - <span data-ttu-id="9c65b-217">生成两个绑定文件，这将在稍后创建 BizTalk 应用程序： **OrderProcessServiceType.BindingInfo.xml**并**OrderProcessServiceType_Custom.BindingInfo.xml**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-217">Two binding files are generated, which will be used later to create the BizTalk application: **OrderProcessServiceType.BindingInfo.xml** and **OrderProcessServiceType_Custom.BindingInfo.xml**.</span></span> <span data-ttu-id="9c65b-218">一般情况下，您通常使用非自定义绑定文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-218">In the general case you will typically use the non-custom binding file.</span></span> <span data-ttu-id="9c65b-219">但在您拥有自定义绑定元素的某些少数情形下，将使用自定义绑定文件。</span><span class="sxs-lookup"><span data-stu-id="9c65b-219">But in some rare situations where you have a custom binding element use the custom binding file.</span></span> <span data-ttu-id="9c65b-220">自定义绑定元素将为应用程序创建发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-220">The custom binding element creates send ports for the applications.</span></span> <span data-ttu-id="9c65b-221">双击**OrderProcessServiceType.BindingInfo.xml**文件并搜索**发送端口**定义行，并查看文件导入此绑定时，将创建的发送端口[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="9c65b-221">Double-click the **OrderProcessServiceType.BindingInfo.xml** file and search for the **SendPort** definition line, and review the send port that will be created when you import this binding file into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]:</span></span>  
  
     ```  
     <SendPort Name="WCFSendPort_OrderProcessServiceType_ServiceEndpoint" …  >  
     ```  
  
   - <span data-ttu-id="9c65b-222">这些文件将用于使用 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 适配器的发送端口，以使用元数据中描述的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务示例。</span><span class="sxs-lookup"><span data-stu-id="9c65b-222">These files are used for the send port using the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] adapter to consume the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service described in the metadata.</span></span>  
  
## <a name="deploy-the-sample-biztalk-solution-biztalkapp"></a><span data-ttu-id="9c65b-223">部署示例 BizTalk 解决方案 BizTalkApp</span><span class="sxs-lookup"><span data-stu-id="9c65b-223">Deploy the sample BizTalk solution, BizTalkApp</span></span>  
  
1. <span data-ttu-id="9c65b-224">部署[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]应用程序，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9c65b-224">Deploy the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application as follows:</span></span>  
  
   1. <span data-ttu-id="9c65b-225">在 Visual Studio 中，在解决方案资源管理器中右键单击**BizTalkApp**，然后单击**属性**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-225">In Visual Studio, in Solution Explorer, right-click **BizTalkApp**, and then click **Properties** .</span></span>  
  
   2. <span data-ttu-id="9c65b-226">在中**项目设计器**窗口中，单击**部署**选项卡，然后将更改**Server**属性，如果使用不同的数据库的服务器[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理数据库。</span><span class="sxs-lookup"><span data-stu-id="9c65b-226">In the **Project Designer** window, click **Deployment** tab, and then change the **Server** property if you use a different database server for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Management database.</span></span> <span data-ttu-id="9c65b-227">请确保应用程序名称**WCFBasicHttpSendAdapter**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-227">Ensure the application name is **WCFBasicHttpSendAdapter**.</span></span>  
  
   3. <span data-ttu-id="9c65b-228">在 Visual Studio 中，在解决方案资源管理器中右键单击**BizTalkApp**，然后单击**重新生成**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-228">In Visual Studio, in Solution Explorer, right-click **BizTalkApp**, and then click **Rebuild**.</span></span>  
  
   4. <span data-ttu-id="9c65b-229">在 Visual Studio 中，在解决方案资源管理器中右键单击**BizTalkApp**，然后单击**部署**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-229">In Visual Studio, in Solution Explorer, right-click **BizTalkApp**, and then click **Deploy**.</span></span>  <span data-ttu-id="9c65b-230">这将 Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BizTalkApp 程序集部署到 GAC，并为项目[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]名为应用程序**WCFBasicHttpSendAdapter**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-230">This deploys the Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BizTalkApp assembly to the GAC, and the artifacts to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application named **WCFBasicHttpSendAdapter**.</span></span>  
  
2. <span data-ttu-id="9c65b-231">在 BizTalk 应用程序中配置 WCF-BasicHttp 发送端口，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9c65b-231">Configure a WCF-BasicHttp send port in the BizTalk application as follows:</span></span>  
  
   1. <span data-ttu-id="9c65b-232">单击**启动**，依次指向**所有程序**，指向[!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)]，然后单击**BizTalk Server 管理**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-232">Click **Start**, point to **All Programs**, point to [!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)], and then click **BizTalk Server Administration**.</span></span>  
  
   2. <span data-ttu-id="9c65b-233">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**BizTalk 组**，展开**应用程序**，右键单击**WCFBasicHttpSendAdapter**，指向**导入**，然后单击**绑定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-233">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **BizTalk Group**, expand **Applications**, right-click **WCFBasicHttpSendAdapter**, point to **Import**, and then click **Bindings**.</span></span>  
  
   3. <span data-ttu-id="9c65b-234">在中**导入绑定**对话框中，转到**C:\WCFBasicHttpSendAdapter\BizTalkApp**文件夹，选择**OrderProcessServiceType.BindingInfo.xml**，然后单击**打开**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-234">In the **Import Bindings** dialog box, go to the **C:\WCFBasicHttpSendAdapter\BizTalkApp** folder, select **OrderProcessServiceType.BindingInfo.xml**, and then click **Open**.</span></span> <span data-ttu-id="9c65b-235">这是由创建的绑定文件之一**BizTalk WCF 服务使用向导**以前。</span><span class="sxs-lookup"><span data-stu-id="9c65b-235">This is one of the binding files created by the **BizTalk WCF Service Consuming Wizard** previously.</span></span> <span data-ttu-id="9c65b-236">这将创建**WCFSendPort_OrderProcessServiceType_ServiceEndpoint**发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-236">This creates the **WCFSendPort_OrderProcessServiceType_ServiceEndpoint** send port.</span></span>  
  
   4. <span data-ttu-id="9c65b-237">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，然后单击**发送端口**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-237">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, and then click **Send Ports**.</span></span>  
  
   5. <span data-ttu-id="9c65b-238">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中的，在右窗格中，双击**WCFSendPort_OrderProcessServiceType_ServiceEndpoint**，来创建通过导入绑定文件OrderProcessServiceType.BindingInfo.xml。</span><span class="sxs-lookup"><span data-stu-id="9c65b-238">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, in the right pane, double-click **WCFSendPort_OrderProcessServiceType_ServiceEndpoint**, which was created by importing the binding file OrderProcessServiceType.BindingInfo.xml.</span></span> <span data-ttu-id="9c65b-239">这将显示**发送端口属性**对话框。</span><span class="sxs-lookup"><span data-stu-id="9c65b-239">This brings up the **Send Port Properties** dialog box.</span></span>  
  
   6. <span data-ttu-id="9c65b-240">在中**发送端口属性**对话框中，单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-240">In the **Send Port Properties** dialog box, click **Configure**.</span></span>  
  
   7. <span data-ttu-id="9c65b-241">上**常规**选项卡上查看**地址 （uri)** 字段**<http://localhost/BasicHttpWcfServiceConsuming/OrderProcess.svc>**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-241">On the **General** tab review the **Address(URI)** field of **<http://localhost/BasicHttpWcfServiceConsuming/OrderProcess.svc>**.</span></span> <span data-ttu-id="9c65b-242">此为 WCF-BasicHttp 适配器将调用的 IIS 中承载的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的地址。</span><span class="sxs-lookup"><span data-stu-id="9c65b-242">This is the address of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service hosted in IIS that the WCF-BasicHttp adapter will call.</span></span>  
  
   8. <span data-ttu-id="9c65b-243">查看的内容**SOAP 操作标头/操作**文本框中：</span><span class="sxs-lookup"><span data-stu-id="9c65b-243">Review the contents of the **SOAP Action header/Action** text box:</span></span>  
  
      ```  
      <BtsActionMapping xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">  
        <Operation Name="Submit" Action="http://Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming/IOrderProcess/Submit" />  
      </BtsActionMapping>  
      ```  
  
       <span data-ttu-id="9c65b-244">此字段指示传出 SOAP HTTP 请求消息的目的。</span><span class="sxs-lookup"><span data-stu-id="9c65b-244">This field indicates the intent of the outgoing SOAP HTTP request message.</span></span> <span data-ttu-id="9c65b-245">此处用来在 IOrderProcess 接口上从 Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming 命名空间来调用“提交”操作。</span><span class="sxs-lookup"><span data-stu-id="9c65b-245">Here it is to call the Submit operation on the IOrderProcess interface from the Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWcfServiceConsuming namespace.</span></span>  
  
      > [!NOTE]
      >  <span data-ttu-id="9c65b-246">绑定文件**BizTalk WCF 服务使用向导**生成操作映射格式用于**StaticAction**属性。</span><span class="sxs-lookup"><span data-stu-id="9c65b-246">The binding file that the **BizTalk WCF Service Consuming Wizard** generates uses the action mapping format for the **StaticAction** property.</span></span> <span data-ttu-id="9c65b-247">在使用基于内容的路由用于 WCF 发送适配器将消息发送到 WCF 服务时，需要设置**BTS。操作**在管道组件中针对操作映射格式用于基于内容的路由此字段的属性。</span><span class="sxs-lookup"><span data-stu-id="9c65b-247">When using content-based routing for the WCF send adapters to send messages to WCF services, you need to set the **BTS.Operation** property in pipeline components for the action mapping format as the field to be used for content-based routing.</span></span> <span data-ttu-id="9c65b-248">或者，您也可以选择将单一操作格式用于基于内容的路由。</span><span class="sxs-lookup"><span data-stu-id="9c65b-248">Alternatively, you can use the single action format for content-based routing.</span></span> <span data-ttu-id="9c65b-249">在本演练中，您将使用单一操作格式。</span><span class="sxs-lookup"><span data-stu-id="9c65b-249">In this walkthrough, you use the single action format.</span></span> <span data-ttu-id="9c65b-250">有关单一操作格式和操作映射格式的详细信息，请参阅**Wcf-basichttp 传输属性对话框，发送，常规**选项卡[!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)]。</span><span class="sxs-lookup"><span data-stu-id="9c65b-250">For more information about the single action format and the action mapping format, see the **WCF-BasicHttp Transport Properties Dialog Box, Send, General** tab [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span></span>  
  
   9. <span data-ttu-id="9c65b-251">单击**确定**两次以返回到[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="9c65b-251">Click **OK** twice to return to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span>  
  
3. <span data-ttu-id="9c65b-252">创建单向静态接收端口和 FILE 接收位置。</span><span class="sxs-lookup"><span data-stu-id="9c65b-252">Create a one-way static receive port and a FILE receive location.</span></span> <span data-ttu-id="9c65b-253">接收端口是一个或多个接收位置的逻辑容器。</span><span class="sxs-lookup"><span data-stu-id="9c65b-253">A receive port is a logical container for one or more receive locations.</span></span> <span data-ttu-id="9c65b-254">此处您将丢出一个示例 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 消息，该消息将由文件适配器拾取，然后发送至 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-254">This is where you will drop a sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] message that will be picked up by the File adapter, and then sent to the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
   1. <span data-ttu-id="9c65b-255">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，右键单击**接收端口**，指向**新建**，然后单击**单向接收端口**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-255">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, right-click **Receive Ports**, point to **New**, and then click **One-way Receive Port**.</span></span>  
  
   2. <span data-ttu-id="9c65b-256">在中**接收端口属性**对话框中**名称**文本框中，键入`WCFBasicSendAdapter.ReceivePurchaseOrder`，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-256">In the **Receive Port Properties** dialog box, in the **Name** text box, type `WCFBasicSendAdapter.ReceivePurchaseOrder`, and then click **OK**.</span></span>  
  
   3. <span data-ttu-id="9c65b-257">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，右键单击**WCFBasicHttpSendAdapter.ReceivePurchaseOrder**，依次指向**新建**，然后单击**接收位置**.</span><span class="sxs-lookup"><span data-stu-id="9c65b-257">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click **WCFBasicHttpSendAdapter.ReceivePurchaseOrder**, point to **New**, and then click **Receive Location**.</span></span>  
  
   4. <span data-ttu-id="9c65b-258">在中**接收位置属性**对话框中**名称**文本框中，键入`WCFBasicSendAdapter.ReceivePurchaseOrder.FILE`。</span><span class="sxs-lookup"><span data-stu-id="9c65b-258">In the **Receive Location Properties** dialog box, in the **Name** text box, type `WCFBasicSendAdapter.ReceivePurchaseOrder.FILE`.</span></span>  
  
   5. <span data-ttu-id="9c65b-259">在中**接收位置属性**对话框中**传输**部分旁边**类型**，选择**文件**从下拉列表中，然后单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-259">In the **Receive Location Properties** dialog box, in the **Transport** section next to **Type**, select **FILE** from the drop-down list, and then click **Configure**.</span></span>  
  
   6. <span data-ttu-id="9c65b-260">在**FILE 传输属性**对话框中，在**常规**选项卡上，在**接收文件夹**文本框中，键入`C:\WCFBasicHttpSendAdapter\OrderRequestIn`，然后单击**确定**.</span><span class="sxs-lookup"><span data-stu-id="9c65b-260">In the **FILE Transport Properties** dialog box, on the **General**  tab, in the **Receive folder** text box, type `C:\WCFBasicHttpSendAdapter\OrderRequestIn`, and then click **OK**.</span></span>  
  
   7. <span data-ttu-id="9c65b-261">在中**接收位置属性**对话框中，单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-261">In the **Receive Location Properties** dialog box, click **OK**.</span></span>  
  
4. <span data-ttu-id="9c65b-262">创建一个筛选器，将消息从上一步中创建的 FILE 接收位置路由至 WCF-BasicHttp 发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-262">Create a filter to route messages to the WCF-BasicHttp send port from the FILE receive location that you created in the previous step.</span></span> <span data-ttu-id="9c65b-263">与端口关联的筛选器作用与 SQL“where”子句相似，如果其值为真，则将消息发送至该端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-263">A filter associated with a port acts like a SQL “where” clause in that if it evaluates to true the message will be given to that port.</span></span>  
  
   1. <span data-ttu-id="9c65b-264">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，单击**发送端口**，然后双击**WCFSendPort_OrderProcessServiceType_ServiceEndpoint**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-264">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, click **Send Ports**, and then double-click **WCFSendPort_OrderProcessServiceType_ServiceEndpoint**.</span></span>  
  
   2. <span data-ttu-id="9c65b-265">在中**发送端口属性**对话框中，在**筛选器**选项卡上，选择**BTS。ReceivePortName**中**属性**字段中，键入`WCFBasicSendAdapter.ReceivePurchaseOrder`中**值**字段，，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-265">In the **Send Port Properties** dialog box, on the **Filters** tab, select **BTS.ReceivePortName** in the **Property** field, type `WCFBasicSendAdapter.ReceivePurchaseOrder` in the **Value** field, and then click **OK**.</span></span> <span data-ttu-id="9c65b-266">此筛选器表达式将从 WCFBasicSendAdapter.ReceivePurchaseOrder 接收端口将传入消息路由至此 WCF-BasicHttp 发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-266">This filter expression routes incoming messages from the WCFBasicSendAdapter.ReceivePurchaseOrder receive port to this WCF-BasicHttp send port.</span></span>  
  
5. <span data-ttu-id="9c65b-267">为示例应用程序创建两个 FILE 发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-267">Create two FILE send ports for the sample application.</span></span> <span data-ttu-id="9c65b-268">第一个发送端口将输出响应消息从 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务发送至 FILE 端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-268">The first send port sends output response messages to the FILE port from the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-269">第二个发送端口用来处理从 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务发送至客户端的错误消息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-269">The second send port is used to handle fault messages sent from the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service destined for the client.</span></span>  
  
   1. <span data-ttu-id="9c65b-270">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，右键单击**发送端口**，指向**新建**，然后单击**静态单向发送端口**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-270">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
   2. <span data-ttu-id="9c65b-271">在中**发送端口属性**对话框中**名称**文本框中，键入`WCFBasicSendAdapter.SendPurchaseOrder.FILE`。</span><span class="sxs-lookup"><span data-stu-id="9c65b-271">In the **Send Port Properties** dialog box, in the **Name** text box, type `WCFBasicSendAdapter.SendPurchaseOrder.FILE`.</span></span>  
  
   3. <span data-ttu-id="9c65b-272">在中**发送端口属性**对话框中**传输**类型旁，选择部分**文件**从下拉列表中，然后单击**配置**.</span><span class="sxs-lookup"><span data-stu-id="9c65b-272">In the **Send Port Properties** dialog box, in the **Transport** section next to Type, select **FILE** from the drop-down list, and then click **Configure**.</span></span>  
  
   4. <span data-ttu-id="9c65b-273">在中**FILE 传输属性**对话框中，在**常规**选项卡上，在**目标文件夹**文本框中，键入`C:\WCFBasicHttpSendAdapter\OrderResponseOut`，然后单击**确定**.</span><span class="sxs-lookup"><span data-stu-id="9c65b-273">In the **FILE Transport Properties** dialog box, on the **General** tab, in the **Destination folder** text box, type `C:\WCFBasicHttpSendAdapter\OrderResponseOut`, and then click **OK**.</span></span>  
  
   5. <span data-ttu-id="9c65b-274">在中**发送端口属性**对话框中，在**筛选器**选项卡上，选择**BTS。MessageType**中**属性**字段中，键入`http://Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWCFServiceConsuming#OrderResponse`中**值**字段来指定响应消息类型的示例[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务，并然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-274">In the **Send Port Properties** dialog box, on the **Filters** tab, select **BTS.MessageType** in the **Property** field, type `http://Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWCFServiceConsuming#OrderResponse` in the **Value** field to specify the response message type from the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service, and then click **OK**.</span></span> <span data-ttu-id="9c65b-275">此筛选器表达式将响应消息从示例 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务路由至此 FILE 发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-275">This filter expression routes response messages from the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to this FILE send port.</span></span> <span data-ttu-id="9c65b-276">此发送端口通过在筛选器属性中指定类型来订阅 OrderResponse 类型的消息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-276">The send port subscribes to messages of the OrderResponse type by specifying that type in the filter property.</span></span> <span data-ttu-id="9c65b-277">这是来自 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的响应消息的消息类型。</span><span class="sxs-lookup"><span data-stu-id="9c65b-277">This is the message type of the response message from the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
   6. <span data-ttu-id="9c65b-278">在中**发送端口属性**对话框中，单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-278">In the **Send Port Properties** dialog box, click **OK**.</span></span>  
  
   7. <span data-ttu-id="9c65b-279">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，右键单击**发送端口**，指向**新建**，然后单击**静态单向发送端口**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-279">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
   8. <span data-ttu-id="9c65b-280">在中**发送端口属性**对话框中**名称**文本框中，键入`WCFAdapterErrorSend.FILE`。</span><span class="sxs-lookup"><span data-stu-id="9c65b-280">In the **Send Port Properties** dialog box, in the **Name** text box, type `WCFAdapterErrorSend.FILE`.</span></span>  
  
   9. <span data-ttu-id="9c65b-281">在**发送端口属性**对话框中**传输**部分旁边**类型**，选择**文件**从下拉列表中，然后单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-281">In the **Send Port Properties** dialog box, in the **Transport** section next to **Type**, select **FILE** from the drop-down list, and then click **Configure**.</span></span>  
  
   10. <span data-ttu-id="9c65b-282">在中**FILE 传输属性**对话框中，在**常规**选项卡上，在**目标文件夹**文本框中，键入`C:\WCFBasicHttpSendAdapter\WCFAdapterErrorOut\`，然后单击**确定**.</span><span class="sxs-lookup"><span data-stu-id="9c65b-282">In the **FILE Transport Properties** dialog box, on the **General** tab, in the **Destination folder** text box, type `C:\WCFBasicHttpSendAdapter\WCFAdapterErrorOut\`, and then click **OK**.</span></span>  
  
   11. <span data-ttu-id="9c65b-283">在中**发送端口属性**对话框中，在**筛选器**选项卡上，选择**WCF。IsFault**中**属性**字段中，键入`True`中**值**字段，，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-283">In the **Send Port Properties** dialog box, on the **Filters** tab, select **WCF.IsFault** in the **Property** field, type `True` in the **Value** field, and then click **OK**.</span></span> <span data-ttu-id="9c65b-284">可以通过检查应用程序中检测异常或错误**WCF。IsFault**发送回调用方的消息的属性。</span><span class="sxs-lookup"><span data-stu-id="9c65b-284">Within an application an exception or fault can be detected by checking the **WCF.IsFault** property of the message sent back to the caller.</span></span> <span data-ttu-id="9c65b-285">此属性将设置为 **，则返回 True**如果发送的消息的 SOAP 错误消息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-285">This property will be set to **True** if the message being sent is a SOAP fault message.</span></span> <span data-ttu-id="9c65b-286">此筛选器表达式将错误消息从示例 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务路由至此 FILE 发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-286">This filter expression routes fault messages from the sample [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to this FILE send port.</span></span>  
  
6. <span data-ttu-id="9c65b-287">指定的主机名和示例应用程序的绑定，如下所示：</span><span class="sxs-lookup"><span data-stu-id="9c65b-287">Specify the host name and bindings for the sample application as follows:</span></span>  
  
    <span data-ttu-id="9c65b-288">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFBasicHttpSendAdapter**，展开**业务流程**，右键单击**Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BizTalkApp.OrderProcessServiceTypeClient**业务流程中，单击**属性**，单击**绑定**，设置**主机**到**BizTalkServerApplication**，然后单击**确定**保存配置。</span><span class="sxs-lookup"><span data-stu-id="9c65b-288">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFBasicHttpSendAdapter**, expand **Orchestrations**, right-click the **Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BizTalkApp.OrderProcessServiceTypeClient** orchestration, click **Properties**, click **Bindings**, set **Host** to **BizTalkServerApplication**, and then click **OK** to save the configuration.</span></span>  
  
## <a name="test-the-sample-solution-with-the-wcf-basichttp-send-adapter"></a><span data-ttu-id="9c65b-289">测试示例解决方案使用 Wcf-basichttp 发送适配器</span><span class="sxs-lookup"><span data-stu-id="9c65b-289">Test the sample solution with the WCF-BasicHttp send adapter</span></span>  
  
1. <span data-ttu-id="9c65b-290">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，右键单击**WCFBasicHttpSendAdapter**，然后单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-290">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click **WCFBasicHttpSendAdapter**, and then click **Start**.</span></span>  
  
2. <span data-ttu-id="9c65b-291">在中**启动**对话框中，单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-291">In the **Start** dialog box, click **Start**.</span></span>  
  
3. <span data-ttu-id="9c65b-292">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**平台设置**，展开**主机实例**，右键单击**BizTalkServerApplication**或另一个相应的主机实例，然后依次**重新启动**。</span><span class="sxs-lookup"><span data-stu-id="9c65b-292">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **Platform Settings**, expand **Host Instances**, right-click **BizTalkServerApplication** or another appropriate host instance, and then click **Restart**.</span></span>  
  
4. <span data-ttu-id="9c65b-293">打开命令提示符，键入**iisreset**回收 IIS 及其依存的服务，然后按 ENTER。</span><span class="sxs-lookup"><span data-stu-id="9c65b-293">Open a command prompt, type **iisreset** to recycle IIS and its dependent services, and then press ENTER.</span></span>  
  
5. <span data-ttu-id="9c65b-294">在命令提示符下，复制**C:\WCFBasicHttpSendAdapter\TestData\WCFBasicSendAdapter.OrderRequest.Sample.xml**到**C:\WCFBasicHttpSendAdapter\OrderRequestIn**文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-294">At the command prompt, copy **C:\WCFBasicHttpSendAdapter\TestData\WCFBasicSendAdapter.OrderRequest.Sample.xml** to the **C:\WCFBasicHttpSendAdapter\OrderRequestIn** folder.</span></span> <span data-ttu-id="9c65b-295">此消息路由到双向**WcfSendPort_OrderProcessServiceType_ServiceEndpoint**静态要求响应发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-295">This message is routed to the two-way **WcfSendPort_OrderProcessServiceType_ServiceEndpoint** static Solicit-Response send port.</span></span>  <span data-ttu-id="9c65b-296">此双向发送方发送端口调用**提交**方法[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]在 IIS 中承载的服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-296">The send side of this two-way send port calls **Submit** method on the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service hosted in IIS.</span></span> <span data-ttu-id="9c65b-297">结果返回到的响应端口**WcfSendPort_OrderProcessServiceType_ServiceEndpoint**发送端口。</span><span class="sxs-lookup"><span data-stu-id="9c65b-297">The result is returned to the response port of the **WcfSendPort_OrderProcessServiceType_ServiceEndpoint** send port.</span></span>  <span data-ttu-id="9c65b-298">**WCFBasicSendAdapter.SendPurchaseOrder.FILE**发送端口订阅该消息的类型时，将触发**<http://Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWCFServiceConsuming#OrderResponse>**。它将获取已成功处理的消息并将其写出到**C:\WCFBasicHttpSendAdapter\OrderResponseOut**文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-298">The **WCFBasicSendAdapter.SendPurchaseOrder.FILE** send port has a subscription that will be triggered when the type of the message is **<http://Microsoft.Samples.BizTalk.WCF.BasicHttpSendAdapter.BasicHttpWCFServiceConsuming#OrderResponse>**.It will get the successfully processed message and write it out to the **C:\WCFBasicHttpSendAdapter\OrderResponseOut** folder.</span></span>  
  
6. <span data-ttu-id="9c65b-299">检查**C:\WCFBasicHttpSendAdapter\OrderResponseOut**文件夹中的响应消息[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-299">Check the **C:\WCFBasicHttpSendAdapter\OrderResponseOut** folder for a response message from the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
7. <span data-ttu-id="9c65b-300">在命令提示符**C:\WCFBasicHttpSendAdapter\TestData\WCFBasicSendAdapter.OrderRequest.Invalid.xml**到**C:\WCFBasicHttpSendAdapter\OrderRequestIn**文件夹。</span><span class="sxs-lookup"><span data-stu-id="9c65b-300">At the command prompt, **C:\WCFBasicHttpSendAdapter\TestData\WCFBasicSendAdapter.OrderRequest.Invalid.xml** to the **C:\WCFBasicHttpSendAdapter\OrderRequestIn** folder.</span></span> <span data-ttu-id="9c65b-301">此消息包含无效的命名空间，以便[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务将返回错误消息。</span><span class="sxs-lookup"><span data-stu-id="9c65b-301">This message contains an invalid namespace so that the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service returns a fault message.</span></span>  
  
8. <span data-ttu-id="9c65b-302">检查**C:\WCFBasicHttpSendAdapter\WCFAdapterErrorOut**包含从错误消息的 XML 文件的文件夹[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="9c65b-302">Check the **C:\WCFBasicHttpSendAdapter\WCFAdapterErrorOut** folder for an XML file containing the fault message from the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="9c65b-303">看看\< **faultstring** \>字段显示错误消息是一个无效的消息正文，其中的原因。</span><span class="sxs-lookup"><span data-stu-id="9c65b-303">Look at the \<**faultstring**\> field showing the cause of the fault message to be an invalid message body.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9c65b-304">请参阅</span><span class="sxs-lookup"><span data-stu-id="9c65b-304">See Also</span></span>  
 <span data-ttu-id="9c65b-305">[演练： 发布具有 Wcf-basichttp 适配器的 WCF 服务](../core/walkthrough-publishing-wcf-services-with-the-wcf-basichttp-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="9c65b-305">[Walkthrough: Publishing WCF Services with the WCF-BasicHttp Adapter](../core/walkthrough-publishing-wcf-services-with-the-wcf-basichttp-adapter.md) </span></span>  
 <span data-ttu-id="9c65b-306">[如何使用 BizTalk WCF 服务使用向导来使用 WCF 服务](../core/how-to-use-the-biztalk-wcf-service-consuming-wizard-to-consume-a-wcf-service.md) </span><span class="sxs-lookup"><span data-stu-id="9c65b-306">[How to Use the BizTalk WCF Service Consuming Wizard to Consume a WCF Service](../core/how-to-use-the-biztalk-wcf-service-consuming-wizard-to-consume-a-wcf-service.md) </span></span>  
 [<span data-ttu-id="9c65b-307">指定 WCF 适配器的消息正文</span><span class="sxs-lookup"><span data-stu-id="9c65b-307">Specifying the Message Body for the WCF Adapters</span></span>](../core/specifying-the-message-body-for-the-wcf-adapters.md)