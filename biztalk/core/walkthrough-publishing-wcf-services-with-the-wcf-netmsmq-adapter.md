---
title: 演练： 发布具有 Wcf-netmsmq 适配器的 WCF 服务 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e623b6dc-32e5-467c-bb7d-68b7a75723c1
caps.latest.revision: 46
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 45f8b47b60663348c48ca398cedca464b3a2dd6b
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36995830"
---
# <a name="walkthrough-publishing-wcf-services-with-the-wcf-netmsmq-adapter"></a><span data-ttu-id="60c47-102">演练： 发布具有 Wcf-netmsmq 适配器的 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="60c47-102">Walkthrough: Publishing WCF Services with the WCF-NetMsmq Adapter</span></span>
  
> [!NOTE]
>  <span data-ttu-id="60c47-103">有关适配器的详细信息，请参阅[BizTalk Server 中的适配器](../core/adapters-in-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="60c47-103">For more information about adapters, see [Adapters in BizTalk Server](../core/adapters-in-biztalk-server.md).</span></span>  
  
## <a name="introduction"></a><span data-ttu-id="60c47-104">简介</span><span class="sxs-lookup"><span data-stu-id="60c47-104">Introduction</span></span>
  
 <span data-ttu-id="60c47-105">在 BizTalk Server 中，可以作为发布业务流程[!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="60c47-105">In BizTalk Server, an orchestration can be published as a [!INCLUDE[firstref_btsWinCommFoundation](../includes/firstref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="60c47-106">通过 BizTalk 接收位置，业务流程可以公开 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 终结点，以允许由 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 客户端进行调用。</span><span class="sxs-lookup"><span data-stu-id="60c47-106">Through a BizTalk receive location, an orchestration can expose a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] endpoint, which allows it to be called by a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] client.</span></span> <span data-ttu-id="60c47-107">**BizTalk WCF 服务发布向导**提供简单的方法来公开业务流程作为接收位置。</span><span class="sxs-lookup"><span data-stu-id="60c47-107">The **BizTalk WCF Service Publishing Wizard** provides a simple way to expose an orchestration as a receive location.</span></span>  
  
 <span data-ttu-id="60c47-108">使用 Wcf-netmsmq 适配器**NetMsmqBinding**绑定为使用 Microsoft 消息队列 (也称为 MSMQ) 作为其基础传输提供支持。</span><span class="sxs-lookup"><span data-stu-id="60c47-108">The WCF-NetMsmq adapter uses the **NetMsmqBinding** binding to provide support for using Microsoft Message Queuing (also known as MSMQ) as its underlying transport.</span></span> <span data-ttu-id="60c47-109">[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的客户端使用配置为使用 WCF-NetMSMQ 适配器的接收位置，将 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 消息发送到 MSMQ 队列。</span><span class="sxs-lookup"><span data-stu-id="60c47-109">The client of a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service sends [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] messages to an MSMQ queue by using the receive location configured to use the WCF-NetMSMQ adapter.</span></span> <span data-ttu-id="60c47-110">该适配器从 MSMQ 队列提取 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 消息，将其转换成 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 格式，然后再写入到 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="60c47-110">The adapter picks up the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] messages from the MSMQ queue, converts them into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] format, and writes them to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox database.</span></span>  
  
 <span data-ttu-id="60c47-111">本演练将说明 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 客户端控制台应用程序如何通过 MSMQ 消息队列，使用 WCF-NetMsmq 适配器与 .NET 控制台应用程序中承载的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务进行通信。</span><span class="sxs-lookup"><span data-stu-id="60c47-111">This walkthrough shows how a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] client console application uses the WCF-NetMsmq adapter to communicate with a [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service, hosted in a .NET console application, through an MSMQ message queue.</span></span> <span data-ttu-id="60c47-112">演示了如何使用 BizTalk WCF 服务发布向导为接收位置发布元数据。</span><span class="sxs-lookup"><span data-stu-id="60c47-112">It demonstrates how to publish metadata for a receive location with the BizTalk WCF Service Publishing Wizard.</span></span> <span data-ttu-id="60c47-113">它还演示如何配置 Web 应用程序以支持发布元数据。</span><span class="sxs-lookup"><span data-stu-id="60c47-113">It also shows how to configure a Web application to support publishing metadata.</span></span>  
  
 <span data-ttu-id="60c47-114">在完成本演练后，你将了解如何执行以下任务：</span><span class="sxs-lookup"><span data-stu-id="60c47-114">After completing this walkthrough, you will understand how to perform the following tasks:</span></span>  
  
- <span data-ttu-id="60c47-115">从 Visual Studio 中，使用**部署**命令将 BizTalk 程序集部署到的本地实例[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="60c47-115">From within Visual Studio, use the **Deploy** command to deploy BizTalk assemblies to a local instance of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="60c47-116">这将创建一个用这些程序集填充的 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="60c47-116">This creates a BizTalk application that is populated with the assemblies.</span></span> <span data-ttu-id="60c47-117">BizTalk 程序集将包含各种资源信息，例如要在 BizTalk 解决方案中使用的业务流程、管道、架构和映射。</span><span class="sxs-lookup"><span data-stu-id="60c47-117">A BizTalk assembly contains resource information such as orchestrations, pipelines, schemas, and maps to be used in a BizTalk solution.</span></span>  
  
- <span data-ttu-id="60c47-118">在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理控制台中，配置 WCF-NetMsmq 接收位置以承载已发布的 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务。</span><span class="sxs-lookup"><span data-stu-id="60c47-118">From the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, configure a WCF-NetMsmq receive location to host the published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
- <span data-ttu-id="60c47-119">从**BizTalk WCF 服务发布向导**，创建 Web 应用程序的现有接收位置发布元数据。</span><span class="sxs-lookup"><span data-stu-id="60c47-119">From the **BizTalk WCF Service Publishing Wizard**, create the Web application to publish metadata for an existing receive location.</span></span> <span data-ttu-id="60c47-120">该元数据由向接收位置提交消息的客户端使用。</span><span class="sxs-lookup"><span data-stu-id="60c47-120">This metadata is used by the client that submits messages to the receive location.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="60c47-121">必要條件</span><span class="sxs-lookup"><span data-stu-id="60c47-121">Prerequisites</span></span>  
 <span data-ttu-id="60c47-122">若要执行本示例中的步骤，请确保你的环境中安装了以下必备软件：</span><span class="sxs-lookup"><span data-stu-id="60c47-122">To perform the steps in this sample ensure that your environment installs the following prerequisites:</span></span>  
  
- <span data-ttu-id="60c47-123">这两个程序集将生成并运行部署过程中，并运行该示例的计算机的计算机需要 Microsoft Windows Server、.NET Framework 和 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="60c47-123">Both the computer that builds the assemblies and runs the deployment process, and the computer that runs the sample, require Microsoft Windows Server, .NET Framework, and BizTalk Server.</span></span>  
  
- <span data-ttu-id="60c47-124">用于构建程序集和运行部署过程的计算机需要安装 Microsoft Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="60c47-124">The computer used to build the assemblies and run the deployment process requires Microsoft Visual Studio.</span></span>  
  
- <span data-ttu-id="60c47-125">运行示例的计算机需要 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 适配器和 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 管理工具。</span><span class="sxs-lookup"><span data-stu-id="60c47-125">The computer that runs the sample requires the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapters and the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Administration Tools.</span></span> <span data-ttu-id="60c47-126">这些是用于安装 Microsoft BizTalk Server 安装过程的选项。</span><span class="sxs-lookup"><span data-stu-id="60c47-126">These are options to install during setup of Microsoft BizTalk Server.</span></span>  
  
- <span data-ttu-id="60c47-127">在用于执行管理任务的计算机上，你必须使用作为 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理员组成员的用户帐户运行，才能在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 管理控制台内配置 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 应用程序设置。</span><span class="sxs-lookup"><span data-stu-id="60c47-127">On the computers that you use to perform administrative tasks, you must run as a user account that is a member of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administrators group to configure the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application settings within the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="60c47-128">此用户帐户还必须是本地管理员组的成员，才能部署应用程序，管理主机实例以及其他可能需要的任务。</span><span class="sxs-lookup"><span data-stu-id="60c47-128">This user account must also be a member of the local Administrators group for application deployment, managing host instances, and other tasks that may be required.</span></span>  
  
- <span data-ttu-id="60c47-129">需要的任何计算机上[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]功能，完成的一次性安装过程[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]在示例[ http://go.microsoft.com/fwlink/?LinkId=135510 ](http://go.microsoft.com/fwlink/?LinkId=135510)。</span><span class="sxs-lookup"><span data-stu-id="60c47-129">On any computer that requires [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] capability, complete the one-time setup procedure for the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] samples at [http://go.microsoft.com/fwlink/?LinkId=135510](http://go.microsoft.com/fwlink/?LinkId=135510).</span></span>  
  
- <span data-ttu-id="60c47-130">在运行示例并将绑定或 .msi 文件导入 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的计算机上，确保主机不是受信任主机，否则导入将失败。</span><span class="sxs-lookup"><span data-stu-id="60c47-130">On the computer that runs the sample and imports a binding or an .msi file into [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], ensure the host is not a trusted host or the import will fail.</span></span>  
  
- <span data-ttu-id="60c47-131">你必须下载演练代码并将其解压缩到您的计算机。</span><span class="sxs-lookup"><span data-stu-id="60c47-131">You must download the walkthrough code and extract it to your computer.</span></span> <span data-ttu-id="60c47-132">本演练是整个的一部分[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]适配器演练包。</span><span class="sxs-lookup"><span data-stu-id="60c47-132">This walkthrough is a part of the entire [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] Adapter Walkthrough package.</span></span> <span data-ttu-id="60c47-133">您可以下载文件**WCFAdapterWalkthroughs.exe**从[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]开发人员中心， [ http://go.microsoft.com/fwlink/?LinkId=194140 ](http://go.microsoft.com/fwlink/?LinkId=194140)。</span><span class="sxs-lookup"><span data-stu-id="60c47-133">You can download the file **WCFAdapterWalkthroughs.exe** from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Developer Center at [http://go.microsoft.com/fwlink/?LinkId=194140](http://go.microsoft.com/fwlink/?LinkId=194140).</span></span>  
  
## <a name="build-and-deploy-the-biztalk-solution-biztalkapp"></a><span data-ttu-id="60c47-134">生成和部署 BizTalk 解决方案 biztalkapp 的步骤</span><span class="sxs-lookup"><span data-stu-id="60c47-134">Build and deploy the BizTalk solution, BizTalkApp</span></span>  
  
1.  <span data-ttu-id="60c47-135">提取到 WCFNetMsmqAdapterPublishing.exe **C:\WCFNetMsmqAdapterPublishing**。</span><span class="sxs-lookup"><span data-stu-id="60c47-135">Extract WCFNetMsmqAdapterPublishing.exe to **C:\WCFNetMsmqAdapterPublishing**.</span></span>  
  
2.  <span data-ttu-id="60c47-136">在 Visual Studio 中打开**WCFNetMsmqAdapterPublishing.sln**文件。</span><span class="sxs-lookup"><span data-stu-id="60c47-136">In Visual Studio, open the **WCFNetMsmqAdapterPublishing.sln** file.</span></span>  
  
3.  <span data-ttu-id="60c47-137">在解决方案资源管理器，展开**BizTalkApp**，然后打开**OrderProcess.odx**查看。</span><span class="sxs-lookup"><span data-stu-id="60c47-137">In Solution Explorer, expand **BizTalkApp**, and then open **OrderProcess.odx** to review.</span></span> <span data-ttu-id="60c47-138">示例业务流程接收订单请求消息，但只返回订单响应消息。</span><span class="sxs-lookup"><span data-stu-id="60c47-138">The sample orchestration receives order request messages, and simply returns the order response messages.</span></span>  
  
4.  <span data-ttu-id="60c47-139">因为**BizTalkApp**程序集必须安装在 GAC 中，它将需要一个强名称密钥文件，以完成部署过程。</span><span class="sxs-lookup"><span data-stu-id="60c47-139">Because the **BizTalkApp** assembly must be installed in the GAC, it will need a strong name key file to complete the deployment process.</span></span> <span data-ttu-id="60c47-140">右键单击**BizTalkApp**项目，并单击**属性**。</span><span class="sxs-lookup"><span data-stu-id="60c47-140">Right-click the **BizTalkApp** project, and then click **Properties**.</span></span> <span data-ttu-id="60c47-141">上**属性**页上，单击**签名**，然后选择**程序集签名**。</span><span class="sxs-lookup"><span data-stu-id="60c47-141">On the **Properties** page, click **Signing**, and select **Sign the assembly**.</span></span> <span data-ttu-id="60c47-142">单击中的向下箭头**选择强名称密钥文件**下拉列表中，单击**\<新建\>** 并输入`keyfile.snk`中**密钥文件名称**文本框中。</span><span class="sxs-lookup"><span data-stu-id="60c47-142">Click the down arrow in the **Choose a strong name key file** drop-down list, click **\<New\>** and enter `keyfile.snk` in the **key file name** textbox.</span></span> <span data-ttu-id="60c47-143">取消选中**保护密钥文件使用密码**，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="60c47-143">Uncheck **Protect my key file with a password**, and then click **OK**.</span></span>  
  
5.  <span data-ttu-id="60c47-144">单击**部署**选项卡，然后将更改**服务器**如果除了 BizTalk 管理数据库使用不同的数据库服务器的属性**LOCALHOST**。</span><span class="sxs-lookup"><span data-stu-id="60c47-144">Click the **Deployment** tab, and then change the **Server** property if you use a different database server for the BizTalk Management database besides **LOCALHOST**.</span></span>  <span data-ttu-id="60c47-145">请确保**BizTalk 应用程序**值设置为**WCFNetMsmqAdapterPublishing**。</span><span class="sxs-lookup"><span data-stu-id="60c47-145">Ensure **BizTalk Application** value is set to **WCFNetMsmqAdapterPublishing**.</span></span> <span data-ttu-id="60c47-146">请确保**安装到全局程序集缓存**设置为**True**。</span><span class="sxs-lookup"><span data-stu-id="60c47-146">Ensure **Install to Global Assembly Cache** is set to **True**.</span></span>  
  
6.  <span data-ttu-id="60c47-147">在解决方案资源管理器中右键单击**BizTalkApp**项目，然后单击**重新生成**。</span><span class="sxs-lookup"><span data-stu-id="60c47-147">In Solution Explorer, right-click the **BizTalkApp**  project and then click **Rebuild**.</span></span>  
  
7.  <span data-ttu-id="60c47-148">在解决方案资源管理器中右键单击**BizTalkApp**，然后单击**部署**。</span><span class="sxs-lookup"><span data-stu-id="60c47-148">In Solution Explorer, right-click **BizTalkApp**, and then click **Deploy**.</span></span>  
  
## <a name="configure-the-application"></a><span data-ttu-id="60c47-149">配置应用程序</span><span class="sxs-lookup"><span data-stu-id="60c47-149">Configure the application</span></span>  
  
1. <span data-ttu-id="60c47-150">确保按如下方式将 Microsoft 消息队列 (MSMQ) 组件安装在您的计算机上：</span><span class="sxs-lookup"><span data-stu-id="60c47-150">Make sure that the Microsoft Message Queuing (MSMQ) component is installed on your computer as follows:</span></span>  
  
   1.  <span data-ttu-id="60c47-151">单击**启动**，右键单击**计算机**，然后单击**管理**以打开**服务器管理器**。</span><span class="sxs-lookup"><span data-stu-id="60c47-151">Click **Start**, right-click **Computer**, and then click **Manage** to open **Server Manager**.</span></span>  
  
   2.  <span data-ttu-id="60c47-152">展开**功能**节点。</span><span class="sxs-lookup"><span data-stu-id="60c47-152">Expand the **Features** node.</span></span>  <span data-ttu-id="60c47-153">如果**消息队列**是未安装，请右键单击**功能**，然后选择**添加功能**。</span><span class="sxs-lookup"><span data-stu-id="60c47-153">If **Message Queuing** is not installed, right-click **Features**, and select **Add Features**.</span></span> <span data-ttu-id="60c47-154">检查**消息队列**，单击**下一步**，然后单击**安装**该系统上安装 MSMQ。</span><span class="sxs-lookup"><span data-stu-id="60c47-154">Check **Message Queuing**, click **Next**, and then click **Install** to install MSMQ on that system.</span></span>  
  
2. <span data-ttu-id="60c47-155">按照以下方法确保在您的计算机上启动 MSMQ 消息队列，以供 WCF-NetMsmq 适配器使用：</span><span class="sxs-lookup"><span data-stu-id="60c47-155">Make sure that the MSMQ message queuing service is started on your computer to be used by the WCF-NetMsmq adapter as follows:</span></span>  
  
   1.  <span data-ttu-id="60c47-156">单击**启动**，依次指向**管理工具**，然后单击**Services**。</span><span class="sxs-lookup"><span data-stu-id="60c47-156">Click **Start**, point to **Administrative Tools**, and then click **Services**.</span></span>  
  
   2.  <span data-ttu-id="60c47-157">在中**Services**，请确保**状态**的**消息队列**服务是**已启动**。</span><span class="sxs-lookup"><span data-stu-id="60c47-157">In **Services**, make sure that the **Status** of the **Message Queuing** service is **Started**.</span></span> <span data-ttu-id="60c47-158">如果该服务未启动，请右击**消息队列**，然后单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="60c47-158">If the service is not started, right-click **Message Queuing**, and then click **Start**.</span></span>  
  
3. <span data-ttu-id="60c47-159">创建接收位置使用的目标队列，WCF-NetMsmq 适配器从中提取来自客户端的传入 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 消息。</span><span class="sxs-lookup"><span data-stu-id="60c47-159">Create the target queue that the receive location uses from which the WCF-NetMsmq adapter picks up incoming [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] messages from the clients.</span></span>  
  
   1.  <span data-ttu-id="60c47-160">单击**启动**，依次指向**管理工具**，然后单击**计算机管理**。</span><span class="sxs-lookup"><span data-stu-id="60c47-160">Click **Start**, point to **Administrative Tools**, and then click **Computer Management**.</span></span>  
  
   2.  <span data-ttu-id="60c47-161">在中**计算机管理**，展开**服务和应用程序**，展开**消息队列**，右键单击**专用队列**，依次指向**新建**，然后单击**专用队列**。</span><span class="sxs-lookup"><span data-stu-id="60c47-161">In **Computer Management**, expand **Services and Applications**, expand **Message Queuing**, right-click **Private Queues**, point to **New**, and then click **Private Queue**.</span></span>  
  
   3.  <span data-ttu-id="60c47-162">在中**新建专用队列**对话框中，键入`WCFNetMsmqAdapterPublishing`中**队列名称**文本框中，选择**事务性**复选框，然后依次**确定**.</span><span class="sxs-lookup"><span data-stu-id="60c47-162">In the **New Private Queue** dialog box, type `WCFNetMsmqAdapterPublishing` in the **Queue name** text box, select the **Transactional** check box, and then click **OK**.</span></span>  
  
4. <span data-ttu-id="60c47-163">创建 Wcf-netmsmq 接收位置的示例应用程序，如下所示：</span><span class="sxs-lookup"><span data-stu-id="60c47-163">Create a WCF-NetMsmq receive location for the sample application as follows:</span></span>  
  
   1. <span data-ttu-id="60c47-164">单击**启动**，依次指向**所有程序**，指向[!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)]，然后单击**BizTalk Server 管理**。</span><span class="sxs-lookup"><span data-stu-id="60c47-164">Click **Start**, point to **All Programs**, point to [!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)], and then click **BizTalk Server Administration**.</span></span>  
  
   2. <span data-ttu-id="60c47-165">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**BizTalk 组**，展开**应用程序**，展开**WCFNetMsmqAdapterPublishing**，右键单击**接收端口**，依次指向**新建**，然后单击**单向接收端口。**</span><span class="sxs-lookup"><span data-stu-id="60c47-165">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **BizTalk Group**, expand **Applications**, expand **WCFNetMsmqAdapterPublishing**, right-click **Receive Ports**, point to **New**, and then click **One-way Receive Port.**</span></span>  
  
   3. <span data-ttu-id="60c47-166">在中**接收端口属性**对话框中**名称**文本框中，键入`WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder`，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="60c47-166">In the **Receive Port Properties** dialog box, in the **Name** text box, type `WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder`, and then click **OK**.</span></span>  
  
   4. <span data-ttu-id="60c47-167">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，右键单击**WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder**，依次指向**新建**，然后单击**接收位置**.</span><span class="sxs-lookup"><span data-stu-id="60c47-167">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click **WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder**, point to **New**, and then click **Receive Location**.</span></span>  
  
   5. <span data-ttu-id="60c47-168">在中**接收位置属性**对话框中**名称**文本框中，键入`WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder.NetMsmq`。</span><span class="sxs-lookup"><span data-stu-id="60c47-168">In the **Receive Location Properties** dialog box, in the **Name** text box, type `WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder.NetMsmq`.</span></span>  
  
   6. <span data-ttu-id="60c47-169">在中**接收位置属性**对话框中**传输**部分旁边**类型**，选择**Wcf-netmsmq**从下拉列表，再单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="60c47-169">In the **Receive Location Properties** dialog box, in the **Transport** section next to **Type**, select **WCF-NetMsmq** from the drop-down list, and then click **Configure**.</span></span>  
  
   7. <span data-ttu-id="60c47-170">在中**Wcf-netmsmq 传输属性**对话框中，在**常规**选项卡上，在**地址 (URI)** 文本框中，键入`net.msmq://localhost/private/WCFNetMsmqAdapterPublishing`。</span><span class="sxs-lookup"><span data-stu-id="60c47-170">In the **WCF-NetMsmq Transport Properties** dialog box, on the **General**  tab, in the **Address (URI)** text box, type `net.msmq://localhost/private/WCFNetMsmqAdapterPublishing`.</span></span>  
  
   8. <span data-ttu-id="60c47-171">在中**Wcf-netmsmq 传输属性**对话框中，在**绑定**选项卡上，请确保**事务性**复选框处于选中状态。</span><span class="sxs-lookup"><span data-stu-id="60c47-171">In the **WCF-NetMsmq Transport Properties** dialog box, on the **Binding**  tab, make sure that the **Transactional** check box is selected.</span></span>  
  
      > [!NOTE]
      >  <span data-ttu-id="60c47-172">由于在创建目标队列为事务性队列，必须选中此复选框。</span><span class="sxs-lookup"><span data-stu-id="60c47-172">Because you created the target queue as a transactional queue, you must select this check box.</span></span> <span data-ttu-id="60c47-173">如果未选中此框，接收位置将不启用因为事务性接收位置的要求和的基础的 MSMQ 队列之间会有差异。</span><span class="sxs-lookup"><span data-stu-id="60c47-173">If this box is not selected, the receive location will not be enabled because there will be a discrepancy between the transactional requirement of the receive location and that of the underlying MSMQ queue.</span></span>  
  
   9. <span data-ttu-id="60c47-174">在中**Wcf-netmsmq 传输属性**对话框中，在**安全**选项卡上，选择**None**从**安全模式**下拉列表.</span><span class="sxs-lookup"><span data-stu-id="60c47-174">In the **WCF-NetMsmq Transport Properties** dialog box, on the **Security**  tab, select **None** from the **Security mode** drop-down list.</span></span>  
  
      > [!NOTE]
      >  <span data-ttu-id="60c47-175">本演练假定 MSMQ 已安装，且计算机禁用 [!INCLUDE[btsAD](../includes/btsad-md.md)] 集成。</span><span class="sxs-lookup"><span data-stu-id="60c47-175">This walkthrough assumes that MSMQ is installed with [!INCLUDE[btsAD](../includes/btsad-md.md)] integration disabled on your computer.</span></span> <span data-ttu-id="60c47-176">默认值**WindowsDomain**，对于**MSMQ 身份验证模式**时，属性是可用[!INCLUDE[btsAD](../includes/btsad-md.md)]启用集成。</span><span class="sxs-lookup"><span data-stu-id="60c47-176">The default value, **WindowsDomain**, for the **MSMQ authentication mode** property is available when [!INCLUDE[btsAD](../includes/btsad-md.md)] integration is enabled.</span></span>  
  
   10. <span data-ttu-id="60c47-177">在中**接收位置属性**对话框中，单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="60c47-177">In the **Receive Location Properties** dialog box, click **OK**.</span></span>  
  
5. <span data-ttu-id="60c47-178">为示例应用程序创建 FILE 发送端口。</span><span class="sxs-lookup"><span data-stu-id="60c47-178">Create a FILE send port for the sample application.</span></span> <span data-ttu-id="60c47-179">此端口用于路由来自服务的基础业务流程采购定单的响应。</span><span class="sxs-lookup"><span data-stu-id="60c47-179">This port is used to route the response from the purchase order from the service's underlying orchestration.</span></span>  
  
   1. <span data-ttu-id="60c47-180">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFNetMsmqAdapterPublishing**，右键单击**发送端口**，指向**新建**，然后单击**静态单向发送端口**。</span><span class="sxs-lookup"><span data-stu-id="60c47-180">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFNetMsmqAdapterPublishing**, right-click **Send Ports**, point to **New**, and then click **Static One-way Send Port**.</span></span>  
  
   2. <span data-ttu-id="60c47-181">在中**发送端口属性**对话框中**名称**文本框中，键入`WCFNetMsmqAdapterPublishing.SendPurchaseOrder.File`。</span><span class="sxs-lookup"><span data-stu-id="60c47-181">In the **Send Port Properties** dialog box, in the **Name** text box, type `WCFNetMsmqAdapterPublishing.SendPurchaseOrder.File`.</span></span>  
  
   3. <span data-ttu-id="60c47-182">在**发送端口属性**对话框中**传输**部分旁边**类型**，选择**文件**从下拉列表中，然后单击**配置**。</span><span class="sxs-lookup"><span data-stu-id="60c47-182">In the **Send Port Properties** dialog box, in the **Transport** section next to **Type**, select **FILE** from the drop-down list, and then click **Configure**.</span></span>  
  
   4. <span data-ttu-id="60c47-183">在中**FILE 传输属性**对话框中，在**常规**选项卡上，在**目标文件夹**文本框中，键入`C:\WCFNetMsmqAdapterPublishing\Out`，然后单击**确定**.</span><span class="sxs-lookup"><span data-stu-id="60c47-183">In the **FILE Transport Properties** dialog box, on the **General** tab, in the **Destination folder** text box, type `C:\WCFNetMsmqAdapterPublishing\Out`, and then click **OK**.</span></span>  
  
   5. <span data-ttu-id="60c47-184">在中**发送端口属性**对话框中，单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="60c47-184">In the **Send Port Properties** dialog box, click **OK**.</span></span>  
  
6. <span data-ttu-id="60c47-185">指定的主机名和示例应用程序的绑定，如下所示：</span><span class="sxs-lookup"><span data-stu-id="60c47-185">Specify the host name and bindings for the sample application as follows:</span></span>  
  
   1. <span data-ttu-id="60c47-186">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**WCFNetMsmqAdapterPublishing**，展开**业务流程**，右键单击示例业务流程，单击**属性**，单击**绑定**，并设置**主机**到**BizTalkServerApplication**或其他相应的主机。</span><span class="sxs-lookup"><span data-stu-id="60c47-186">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **WCFNetMsmqAdapterPublishing**, expand **Orchestrations**, right-click the sample orchestration, click **Properties**, click **Bindings**, and set **Host** to **BizTalkServerApplication** or another appropriate host.</span></span>  
  
   2. <span data-ttu-id="60c47-187">在中**业务流程属性**对话框中，选择**WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder**从**接收端口**的下拉列表**PurchaseOrderRequestPort**。</span><span class="sxs-lookup"><span data-stu-id="60c47-187">In the **Orchestration Properties** dialog box, select **WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder** from the **Receive Ports** drop-down list for the **PurchaseOrderRequestPort**.</span></span>  
  
   3. <span data-ttu-id="60c47-188">在中**业务流程属性**对话框中，选择**WCFNetMsmqAdapterPublishing.SendPurchaseOrder.File**从**发送端口/发送端口组**下拉列表有关**PurchaseOrderResponsePort**。</span><span class="sxs-lookup"><span data-stu-id="60c47-188">In the **Orchestration Properties** dialog box, select **WCFNetMsmqAdapterPublishing.SendPurchaseOrder.File** from the **Send Ports/Send Port Groups** drop-down list for the **PurchaseOrderResponsePort**.</span></span>  
  
   4. <span data-ttu-id="60c47-189">在中**业务流程属性**对话框中，单击**确定**保存配置。</span><span class="sxs-lookup"><span data-stu-id="60c47-189">In the **Orchestration Properties** dialog box, click **OK** to save the configuration.</span></span>  
  
## <a name="publish-the-metadata-for-the-wcf-netmsmq-receive-location"></a><span data-ttu-id="60c47-190">Wcf-netmsmq 接收位置发布元数据</span><span class="sxs-lookup"><span data-stu-id="60c47-190">Publish the metadata for the WCF-NetMsmq receive location</span></span>  
  
1. <span data-ttu-id="60c47-191">单击**启动**，依次指向**所有程序**，指向[!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)]，然后单击**BizTalk WCF 服务发布向导**。</span><span class="sxs-lookup"><span data-stu-id="60c47-191">Click **Start**, point to **All Programs**, point to [!INCLUDE[btsBizTalkServerStartMenuItemui](../includes/btsbiztalkserverstartmenuitemui-md.md)], and then click **BizTalk WCF Service Publishing Wizard**.</span></span>  
  
2. <span data-ttu-id="60c47-192">上**欢迎使用 BizTalk WCF 服务发布向导**页上，单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="60c47-192">On the **Welcome to the BizTalk WCF Service Publishing Wizard** page, click **Next**.</span></span>  
  
3. <span data-ttu-id="60c47-193">上**WCF 服务类型**页上，选择**元数据仅终结点 (MEX)** 复选框可将元数据发布，以为 WCFNetMsmq 接收位置。</span><span class="sxs-lookup"><span data-stu-id="60c47-193">On the **WCF Service Type** page, select the **Metadata only endpoint (MEX)** check box to publish the metadata for the WCFNetMsmq receive location.</span></span> <span data-ttu-id="60c47-194">选择**WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder.NetMsmq**从**接收位置发布元数据用于**下拉列表，再单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="60c47-194">Select **WCFNetMsmqAdapterPublishing.ReceivePurchaseOrder.NetMsmq** from the **Publish metadata for receive location** drop-down list, and then click **Next**.</span></span>  
  
4. <span data-ttu-id="60c47-195">上**创建 WCF 服务**页上，选择**BizTalk 业务流程发布为 WCF 服务**，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="60c47-195">On the **Create WCF Service** page, select **Publish BizTalk orchestrations as WCF service**, and then click **Next**.</span></span>  
  
5. <span data-ttu-id="60c47-196">上**BizTalk 程序集**页上，在**BizTalk 程序集文件 (\*.dll)** 文本框中，单击**浏览**以浏览到**C:\WCFNetMsmqAdapterPublishing\BizTalkApp\bin\Development**文件夹中，双击包含示例业务流程的程序集以发布，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="60c47-196">On the **BizTalk Assembly** page, in the **BizTalk assembly file (\*.dll)** text box, click **Browse** to browse to the **C:\WCFNetMsmqAdapterPublishing\BizTalkApp\bin\Development** folder, double-click the assembly containing the sample orchestration to publish, and then click **Next**.</span></span>  
  
6. <span data-ttu-id="60c47-197">上**业务流程和端口**页上，请确保**端口： PurchaseOrderRequestPort**节点的页上，选择，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="60c47-197">On the **Orchestrations and Ports** page, make sure that the **Port: PurchaseOrderRequestPort** node is selected on the page, and then click **Next**.</span></span>  
  
    <span data-ttu-id="60c47-198">客户端将发布接收端口的 MEX，并用它来向接收位置提交消息。</span><span class="sxs-lookup"><span data-stu-id="60c47-198">The MEX for the receive port will be published and used by the client to submit messages to the receive location.</span></span>  
  
7. <span data-ttu-id="60c47-199">上**WCF 服务属性**页上，在**的 WCF 服务的目标命名空间**文本框中，键入此已发布的 URI[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]若要使用，提供服务，然后单击**下一步**.</span><span class="sxs-lookup"><span data-stu-id="60c47-199">On the **WCF Service Properties** page, in the **Target namespace of WCF service** text box, type a URI that you want this published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service to use, and then click **Next**.</span></span> <span data-ttu-id="60c47-200">对于本演练中，保留默认的 URI `http://tempuri.org/`。</span><span class="sxs-lookup"><span data-stu-id="60c47-200">For this walkthrough, leave the default URI, `http://tempuri.org/`.</span></span>  
  
8. <span data-ttu-id="60c47-201">上**WCF 服务位置**页上，执行以下操作以指定的位置[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务以创建，然后单击**下一步**:</span><span class="sxs-lookup"><span data-stu-id="60c47-201">On the **WCF Service Location** page, perform the following actions to specify the location of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] services to create, and then click **Next**:</span></span>  
  
   1. <span data-ttu-id="60c47-202">在中**位置**文本框中，键入 Web 目录名称[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务运行，或单击**浏览**并选择 Web 目录。</span><span class="sxs-lookup"><span data-stu-id="60c47-202">In the **Location** text box, type the Web directory name where the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service runs or click **Browse** and select a Web directory.</span></span> <span data-ttu-id="60c47-203">对于本演练中，保留默认位置 (http://localhost/<em>\<BizTalk 程序集名称\></em>) 中**位置**文本框。</span><span class="sxs-lookup"><span data-stu-id="60c47-203">For this walkthrough, leave the default location (http://localhost/<em>\<BizTalk Assembly Name\></em>) in the **Location** text box.</span></span>  
  
   2. <span data-ttu-id="60c47-204">选择**允许匿名访问 WCF 服务**选项。</span><span class="sxs-lookup"><span data-stu-id="60c47-204">Select the **Allow anonymous access to WCF service** option.</span></span> <span data-ttu-id="60c47-205">此选项会为已创建的虚拟目录添加匿名访问权限。</span><span class="sxs-lookup"><span data-stu-id="60c47-205">This option adds anonymous access to the created virtual directory.</span></span> <span data-ttu-id="60c47-206">此选项需要选择允许使用此向导将创建的 Web 应用程序的匿名身份验证。</span><span class="sxs-lookup"><span data-stu-id="60c47-206">This option needs to be selected to allow anonymous authentication for the Web application that this wizard will create.</span></span>  
  
9. <span data-ttu-id="60c47-207">上**WCF 服务摘要**页上，单击**创建**创建[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="60c47-207">On the **WCF Service Summary** page, click **Create** to create the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span>  
  
10. <span data-ttu-id="60c47-208">上**完成 BizTalk WCF 服务发布向导**页上，单击**完成**。</span><span class="sxs-lookup"><span data-stu-id="60c47-208">On the **Completing BizTalk WCF Service Publishing Wizard** page, click **Finish**.</span></span>  
  
## <a name="configure-the-web-application-hosting-the-published-metadata-service"></a><span data-ttu-id="60c47-209">配置承载已发布元数据服务的 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="60c47-209">Configure the Web application hosting the published metadata service</span></span>  
  
1. <span data-ttu-id="60c47-210">打开命令提示符处，转到**C:\inetpub\wwwroot\Microsoft.Samples.BizTalk.WCF.NetMsmqPublishing.BizTalkApp**文件夹位置**BizTalk WCF 服务发布向导**创建[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务。</span><span class="sxs-lookup"><span data-stu-id="60c47-210">Open a command prompt, go to the **C:\inetpub\wwwroot\Microsoft.Samples.BizTalk.WCF.NetMsmqPublishing.BizTalkApp** folder where the **BizTalk WCF Service Publishing Wizard** created the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service.</span></span> <span data-ttu-id="60c47-211">打开**Web.config**文件中使用记事本。</span><span class="sxs-lookup"><span data-stu-id="60c47-211">Open the **Web.config** file using Notepad.</span></span>  
  
2. <span data-ttu-id="60c47-212">在记事本中，添加以下行**\<system.web\>** 元素：</span><span class="sxs-lookup"><span data-stu-id="60c47-212">In Notepad, add the following line inside the **\<system.web\>** element:</span></span>  
  
   ```  
   <trust level="Full" originUrl="" />  
   ```  
  
   > [!NOTE]
   >  <span data-ttu-id="60c47-213">此设置是可选的。</span><span class="sxs-lookup"><span data-stu-id="60c47-213">This setting is optional.</span></span> <span data-ttu-id="60c47-214">此设置向已发布了 [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] 服务的宿主 ASP.NET 应用程序授予对受操作系统安全机制保护的任何资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="60c47-214">It grants the ASP.NET application hosting the published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service access to any resource that is subject to operating system security.</span></span>  
  
3. <span data-ttu-id="60c47-215">测试已发布[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务通过使用 Internet Explorer，如下所示：</span><span class="sxs-lookup"><span data-stu-id="60c47-215">Test the published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service by using Internet Explorer as follows:</span></span>  
  
   1. <span data-ttu-id="60c47-216">单击**启动**，依次指向**管理工具**，然后单击**Internet Information Services (IIS) Manager**。</span><span class="sxs-lookup"><span data-stu-id="60c47-216">Click **Start**, point to **Administrator Tools**, and then click **Internet Information Services (IIS) Manager**.</span></span>  
  
   2. <span data-ttu-id="60c47-217">在 IIS 管理器中，创建一个拥有正确 BizTalk 数据库权限的应用程序池，此服务将在其中运行。</span><span class="sxs-lookup"><span data-stu-id="60c47-217">In IIS Manager, create an application pool within which this service will run that has the correct BizTalk database permissions.</span></span> <span data-ttu-id="60c47-218">右键单击**应用程序池**，单击**添加应用程序池**，输入应用程序池的名称，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="60c47-218">Right-click **Application Pools**, click **Add Application Pool**, enter a name for the application pool, and then click **OK**.</span></span>  
  
   3. <span data-ttu-id="60c47-219">展开**应用程序池**，右键单击您刚的应用程序池创建，并选择**高级设置**。</span><span class="sxs-lookup"><span data-stu-id="60c47-219">Expand **Application Pools**, right-click the application pool you just created, and then select **Advanced Settings**.</span></span> <span data-ttu-id="60c47-220">下**过程模型**部分中，输入的帐户有权[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库下**标识**字段。</span><span class="sxs-lookup"><span data-stu-id="60c47-220">Under **Process Model** section, enter the account which has access to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases under the **Identity** field.</span></span>  
  
   4. <span data-ttu-id="60c47-221">展开**网站**，展开**Default Web Site**，然后展开 BizTalk WCF 服务发布向导创建的 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="60c47-221">Expand **Web Sites**, expand **Default Web Site**, and then expand the Web application that the BizTalk WCF Service Publishing Wizard created.</span></span>  
  
   5. <span data-ttu-id="60c47-222">在 IIS 管理器中，在中心窗格中，单击**内容视图**以显示应用程序的文件。</span><span class="sxs-lookup"><span data-stu-id="60c47-222">In IIS Manager, in the center pane, click **Content View** to display the files for the application.</span></span>  
  
   6. <span data-ttu-id="60c47-223">右键单击**Microsoft_Samples_BizTalk_WCF_NetMsmqPublishing_BizTalkApp_OrderProcess_PurchaseOrderRequestPort.svc**服务文件**BizTalk WCF 服务发布向导**创建，然后依次**浏览**。</span><span class="sxs-lookup"><span data-stu-id="60c47-223">Right-click the **Microsoft_Samples_BizTalk_WCF_NetMsmqPublishing_BizTalkApp_OrderProcess_PurchaseOrderRequestPort.svc** service file that the **BizTalk WCF Service Publishing Wizard** created, and then click **Browse**.</span></span> <span data-ttu-id="60c47-224">这将打开 Internet Explorer 以显示**BizTalkServerInstance Service**页，指示实例[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务是否正在运行。</span><span class="sxs-lookup"><span data-stu-id="60c47-224">This opens Internet Explorer to display the **BizTalkServerInstance Service** page indicating that an instance of the [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service is running.</span></span> <span data-ttu-id="60c47-225">页面将显示完整的 WSDL 地址，可以复制和使用的服务元数据工具 (svcutil.exe)，或从 Visual Studio 中，若要检索代理代码和配置文件，可用于创建该服务的客户端应用程序。</span><span class="sxs-lookup"><span data-stu-id="60c47-225">The page displays a full WSDL address that you can copy and use with the Service Metadata Tool (svcutil.exe), or from within Visual Studio, to retrieve proxy code and a configuration file that can be used to create a client application for the service.</span></span>  
  
   7. <span data-ttu-id="60c47-226">将带有完整 WSDL 地址从命令行复制到剪贴板**BizTalkServerInstance Service** Internet 资源管理器显示上一步中的页。</span><span class="sxs-lookup"><span data-stu-id="60c47-226">Copy to the Clipboard the command line with the full WSDL address from **BizTalkServerInstance Service** page that Internet Explorer shows in the previous step.</span></span>  
  
       <span data-ttu-id="60c47-227">**svcutil.exe http://localhost/Microsoft.Samples.BizTalk.WCF.NetMsmqPublishing.BizTalkApp/Microsoft_Samples_BizTalk_WCF_NetMsmqPublishing_BizTalkApp_OrderProcess_PurchaseOrderRequestPort.svc?wsdl**</span><span class="sxs-lookup"><span data-stu-id="60c47-227">**svcutil.exe http://localhost/Microsoft.Samples.BizTalk.WCF.NetMsmqPublishing.BizTalkApp/Microsoft_Samples_BizTalk_WCF_NetMsmqPublishing_BizTalkApp_OrderProcess_PurchaseOrderRequestPort.svc?wsdl**</span></span>  
  
## <a name="build-the-client-application"></a><span data-ttu-id="60c47-228">生成客户端应用程序</span><span class="sxs-lookup"><span data-stu-id="60c47-228">Build the client application</span></span>  
  
1. <span data-ttu-id="60c47-229">打开 Visual Studio 命令提示符以管理员身份，并转到**C:\WCFNetMsmqAdapterPublishing\WCFClient**文件夹。</span><span class="sxs-lookup"><span data-stu-id="60c47-229">Open a Visual Studio command prompt as Administrator and go to the **C:\WCFNetMsmqAdapterPublishing\WCFClient** folder.</span></span> <span data-ttu-id="60c47-230">这是放置代理类和应用程序配置文件的位置。</span><span class="sxs-lookup"><span data-stu-id="60c47-230">This is where you will place the proxy class and application configuration file.</span></span>  
  
2. <span data-ttu-id="60c47-231">粘贴包含您在上一过程中复制的整个 WSDL 地址的完整 svcutil.exe 命令行，然后按 Enter。</span><span class="sxs-lookup"><span data-stu-id="60c47-231">Paste the entire svcutil.exe command line containing the full WSDL address that you copied in the previous procedure, and then press ENTER.</span></span> <span data-ttu-id="60c47-232">这将创建代理类中， **BizTalkServiceInstance.cs**，和应用程序配置文件**output.config**。保持命令提示符窗口打开以供最后一部分使用。</span><span class="sxs-lookup"><span data-stu-id="60c47-232">This creates the proxy class, **BizTalkServiceInstance.cs**, and application configuration file, **output.config**. Keep the command prompt window open for use during the final section.</span></span>  
  
3. <span data-ttu-id="60c47-233">在 Visual Studio 中，在解决方案资源管理器中右键单击**WCFClient**，依次指向**添加**，然后单击**现有项**。</span><span class="sxs-lookup"><span data-stu-id="60c47-233">In Visual Studio, in Solution Explorer, right-click **WCFClient**, point to **Add**, and then click **Existing Item**.</span></span>  
  
4. <span data-ttu-id="60c47-234">在中**添加现有项**对话框中，浏览到**WCFClient**文件夹，选择**的所有文件 (\*。\*)** 中**类型的文件**下拉列表中，选择**BizTalkServiceInstance.cs**并**output.config**文件，然后依次**添加**。</span><span class="sxs-lookup"><span data-stu-id="60c47-234">In the **Add Existing Item** dialog box, browse to the **WCFClient** folder, select **All Files (\*.\*)** in the **Files of type** drop-down list, select the **BizTalkServiceInstance.cs** and **output.config** files, and then click **Add**.</span></span>  
  
5. <span data-ttu-id="60c47-235">展开**WCFClient**，右键单击**output.config**，单击**重命名**，然后键入`App.config`作为新名称。</span><span class="sxs-lookup"><span data-stu-id="60c47-235">Expand **WCFClient**, right-click **output.config**, click **Rename**, and then type `App.config` as the new name.</span></span>  
  
6. <span data-ttu-id="60c47-236">双击**Program.cs**查看如何来调用已发布[!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)]服务使用 svcutil.exe 生成的代理类。</span><span class="sxs-lookup"><span data-stu-id="60c47-236">Double-click **Program.cs** to review how to call the published [!INCLUDE[nextref_btsWinCommFoundation](../includes/nextref-btswincommfoundation-md.md)] service using the proxy class generated by svcutil.exe.</span></span>  
  
7. <span data-ttu-id="60c47-237">展开**引用**，并请务必**WCFClient**项目具有**System.ServiceModel.dll**引用。</span><span class="sxs-lookup"><span data-stu-id="60c47-237">Expand **References**, and then make sure that the **WCFClient** project has **System.ServiceModel.dll** referenced.</span></span>  
  
8. <span data-ttu-id="60c47-238">右键单击**WCFClient**项目，然后选择**生成**。</span><span class="sxs-lookup"><span data-stu-id="60c47-238">Right-click the **WCFClient** project and select **Build**.</span></span> <span data-ttu-id="60c47-239">到下一部分保持 Visual Studio 并打开。</span><span class="sxs-lookup"><span data-stu-id="60c47-239">Keep Visual Studio open and go to the next section.</span></span>  
  
## <a name="test-the-sample-solution-with-the-wcf-netmsmq-adapter"></a><span data-ttu-id="60c47-240">测试示例解决方案使用 Wcf-netmsmq 适配器</span><span class="sxs-lookup"><span data-stu-id="60c47-240">Test the sample solution with the WCF-NetMsmq adapter</span></span>  
  
1. <span data-ttu-id="60c47-241">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，右键单击**WCFNetMsmqAdapterPublishing**应用程序，，然后单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="60c47-241">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, right-click the **WCFNetMsmqAdapterPublishing** application, and then click **Start**.</span></span> <span data-ttu-id="60c47-242">在中**启动**对话框中，单击**启动**。</span><span class="sxs-lookup"><span data-stu-id="60c47-242">In the **Start** dialog box, click **Start**.</span></span>  
  
2. <span data-ttu-id="60c47-243">在中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台中，展开**平台设置**，展开**主机实例**，右键单击**BizTalkServerApplication**或另一个相应的主机实例，然后依次**重新启动**。</span><span class="sxs-lookup"><span data-stu-id="60c47-243">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console, expand **Platform Settings**, expand **Host Instances**, right-click **BizTalkServerApplication** or another appropriate host instance, and then click **Restart**.</span></span> <span data-ttu-id="60c47-244">尽管本步骤中并未要求，但确保本示例到此处仍能正常运行不失为一个好的方法。</span><span class="sxs-lookup"><span data-stu-id="60c47-244">While this step is not required, it is a good idea to ensure the sample works correctly up to this point.</span></span>  
  
3. <span data-ttu-id="60c47-245">在 Visual Studio 中，在**调试**菜单上，单击**启动但不调试**以运行 WCFClient 应用程序。</span><span class="sxs-lookup"><span data-stu-id="60c47-245">In Visual Studio, on the **Debug** menu, click **Start Without Debugging** to run the WCFClient application.</span></span> <span data-ttu-id="60c47-246">这会向 WCF-NetMsmq 接收位置发送示例消息。</span><span class="sxs-lookup"><span data-stu-id="60c47-246">This sends a sample message to the WCF-NetMsmq receive location.</span></span> <span data-ttu-id="60c47-247">您将看到以下输出消息，说明消息已发送。</span><span class="sxs-lookup"><span data-stu-id="60c47-247">You will see the output message below stating the message was sent.</span></span>  
  
    <span data-ttu-id="60c47-248">**调用提交操作在 Wcf-netmsmq 接收位置**</span><span class="sxs-lookup"><span data-stu-id="60c47-248">**Calling the Submit operation on the WCF-NetMsmq receive location**</span></span>  
  
    <span data-ttu-id="60c47-249">**按任意键关闭 WCF 客户端应用程序**</span><span class="sxs-lookup"><span data-stu-id="60c47-249">**Press any key to close WCF client application**</span></span>  
  
4. <span data-ttu-id="60c47-250">按任意键以关闭 WCFClient 应用程序。</span><span class="sxs-lookup"><span data-stu-id="60c47-250">Press any key to close the WCFClient application.</span></span>  
  
5. <span data-ttu-id="60c47-251">在 Visual Studio 命令提示符下，请转到**C:\WCFNetMsmqAdapterPublishing\Out**文件夹，然后确保存在 WCFClient 应用程序发回的响应消息。</span><span class="sxs-lookup"><span data-stu-id="60c47-251">In the Visual Studio Command Prompt, go to the **C:\WCFNetMsmqAdapterPublishing\Out** folder, and then make sure the response message that the WCFClient application sent back exists.</span></span>  
  
6. <span data-ttu-id="60c47-252">双击 {GUID}.xml 文件以在 Internet Explorer 和视图中打开它**OrderID**值由服务处理。</span><span class="sxs-lookup"><span data-stu-id="60c47-252">Double-click the {GUID}.xml file to open it in Internet Explorer and view the **OrderID** value processed by the service.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="60c47-253">请参阅</span><span class="sxs-lookup"><span data-stu-id="60c47-253">See Also</span></span>  
 <span data-ttu-id="60c47-254">[配置 Wcf-netmsmq 接收位置](../core/how-to-configure-a-wcf-netmsmq-receive-location.md) </span><span class="sxs-lookup"><span data-stu-id="60c47-254">[Configure a WCF-NetMsmq Receive Location](../core/how-to-configure-a-wcf-netmsmq-receive-location.md) </span></span>  
 <span data-ttu-id="60c47-255">[WCF 适配器演练](../core/wcf-adapter-walkthroughs.md) </span><span class="sxs-lookup"><span data-stu-id="60c47-255">[WCF Adapter Walkthroughs](../core/wcf-adapter-walkthroughs.md) </span></span>  
 [<span data-ttu-id="60c47-256">为 WCF 接收适配器发布服务元数据</span><span class="sxs-lookup"><span data-stu-id="60c47-256">Publishing Service Metadata for the WCF Receive Adapters</span></span>](../core/publishing-service-metadata-for-the-wcf-receive-adapters.md)