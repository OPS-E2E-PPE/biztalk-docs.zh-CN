---
title: 使用 BaseFunctoid |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: fb26a54d-20bf-4302-a5cb-b38e4091002b
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3f2d1381b1babb26324730c301800d6b0909a411
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22288709"
---
# <a name="using-basefunctoid"></a><span data-ttu-id="4f9f9-102">使用 BaseFunctoid</span><span class="sxs-lookup"><span data-stu-id="4f9f9-102">Using BaseFunctoid</span></span>
<span data-ttu-id="4f9f9-103">所有自定义 functoid 都必须从 **BaseFunctoid** 类派生。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-103">All custom functoids must derive from the **BaseFunctoid** class.</span></span> <span data-ttu-id="4f9f9-104">您必须首先重写该构造函数，并执行一组调用，将您的自定义 functoid 通知给 BizTalk 映射器。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-104">You must first override the constructor and make a set of calls that tell BizTalk Mapper about your custom functoid.</span></span> <span data-ttu-id="4f9f9-105">然后需要编写 functoid 逻辑。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-105">Then you need to write the functoid logic.</span></span>  
  
## <a name="overriding-the-constructor"></a><span data-ttu-id="4f9f9-106">重写该构造函数</span><span class="sxs-lookup"><span data-stu-id="4f9f9-106">Overriding the Constructor</span></span>  
 <span data-ttu-id="4f9f9-107">您必须在类构造函数重写方法中执行多个任务来描述 functoid 的特征。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-107">You must perform a number of tasks in the class constructor override method to characterize your functoid.</span></span> <span data-ttu-id="4f9f9-108">这些任务对解决方案所需的任何特定于 functoid 的代码进行补充。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-108">These tasks are in addition to any functoid-specific code your solution requires.</span></span> <span data-ttu-id="4f9f9-109">下表对主要任务进行了说明：</span><span class="sxs-lookup"><span data-stu-id="4f9f9-109">The following table describes the primary tasks.</span></span>  
  
|<span data-ttu-id="4f9f9-110">任务</span><span class="sxs-lookup"><span data-stu-id="4f9f9-110">Task</span></span>|<span data-ttu-id="4f9f9-111">使用这些方法或属性</span><span class="sxs-lookup"><span data-stu-id="4f9f9-111">Use these methods or properties</span></span>|<span data-ttu-id="4f9f9-112">注释</span><span class="sxs-lookup"><span data-stu-id="4f9f9-112">Comments</span></span>|  
|----------|-------------------------------------|--------------|  
|<span data-ttu-id="4f9f9-113">为 functoid 分配唯一 ID</span><span class="sxs-lookup"><span data-stu-id="4f9f9-113">Assign a unique ID to the functoid</span></span>|<span data-ttu-id="4f9f9-114">**ID**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-114">**ID**</span></span>|<span data-ttu-id="4f9f9-115">使用尚未用过的大于 6000 的值。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-115">Use a value greater than 6000 that has not been used.</span></span> <span data-ttu-id="4f9f9-116">小于 6000 的值是保留值，供内部 functoid 使用。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-116">Values less than 6000 are reserved for use by internal functoids.</span></span>|  
|<span data-ttu-id="4f9f9-117">指示 functoid 是否具有副作用</span><span class="sxs-lookup"><span data-stu-id="4f9f9-117">Indicate whether the functoid has side effects</span></span>|<span data-ttu-id="4f9f9-118">**HasSideEffects**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-118">**HasSideEffects**</span></span>|<span data-ttu-id="4f9f9-119">由映射器使用来优化所生成的 XSLT 代码。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-119">Used by the mapper to optimize the XSLT code that is generated.</span></span> <span data-ttu-id="4f9f9-120">默认情况下，此属性为真。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-120">This property is true by default.</span></span>|  
|<span data-ttu-id="4f9f9-121">指向资源程序集</span><span class="sxs-lookup"><span data-stu-id="4f9f9-121">Point to the resource assembly</span></span>|<span data-ttu-id="4f9f9-122">**SetupResourceAssembly**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-122">**SetupResourceAssembly**</span></span>|<span data-ttu-id="4f9f9-123">在项目中包含资源文件。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-123">Include a resource file with your project.</span></span> <span data-ttu-id="4f9f9-124">如果使用生成[!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)]，资源程序集必须**ProjectName.ResourceName**。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-124">If building with [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], the resource assembly must be **ProjectName.ResourceName**.</span></span>|  
|<span data-ttu-id="4f9f9-125">使自定义 functoid 出现在 BizTalk 映射器面板中</span><span class="sxs-lookup"><span data-stu-id="4f9f9-125">Enable the custom functoid to appear in the BizTalk Mapper palette</span></span>|<span data-ttu-id="4f9f9-126">**SetName**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-126">**SetName**</span></span><br /><br /> <span data-ttu-id="4f9f9-127">**SetTooltip**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-127">**SetTooltip**</span></span><br /><br /> <span data-ttu-id="4f9f9-128">**SetDescription**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-128">**SetDescription**</span></span><br /><br /> <span data-ttu-id="4f9f9-129">**SetBitmap**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-129">**SetBitmap**</span></span>|<span data-ttu-id="4f9f9-130">使用指向字符串的资源 ID 表示名称、工具提示和说明；使用 16x16 像素的位图。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-130">Use a resource ID pointing to a string for the name, tooltip and description; use a 16x16-pixel bitmap.</span></span>|  
|<span data-ttu-id="4f9f9-131">将 functoid 分配到一个或多个类别中</span><span class="sxs-lookup"><span data-stu-id="4f9f9-131">Assign the functoid to one or more categories</span></span>|<span data-ttu-id="4f9f9-132">**类别**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-132">**Category**</span></span>|<span data-ttu-id="4f9f9-133">使用一个或多个 [Microsoft.BizTalk.BaseFunctoids.FunctoidCategory](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.functoidcategory.aspx) 值对 functoid 进行分类。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-133">Categorize the functoid by using one or more [Microsoft.BizTalk.BaseFunctoids.FunctoidCategory](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.functoidcategory.aspx) values.</span></span>|  
|<span data-ttu-id="4f9f9-134">指定接受的参数数量</span><span class="sxs-lookup"><span data-stu-id="4f9f9-134">Specify the number of parameters accepted</span></span>|<span data-ttu-id="4f9f9-135">**SetMinParams**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-135">**SetMinParams**</span></span><br /><br /> <span data-ttu-id="4f9f9-136">**SetMaxParams**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-136">**SetMaxParams**</span></span><br /><br /> <span data-ttu-id="4f9f9-137">**HasVariableInputs**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-137">**HasVariableInputs**</span></span>|<span data-ttu-id="4f9f9-138">使用 **SetMinParams** 方法设置必需参数的数量，使用 **SetMaxParams** 方法设置可选参数的数量。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-138">Use the **SetMinParams** method to set the number of required parameters and the **SetMaxParams** method to set the number of optional parameters.</span></span> <span data-ttu-id="4f9f9-139">请按照以下准则来设置这些值：</span><span class="sxs-lookup"><span data-stu-id="4f9f9-139">Use the following guidelines to set these values:</span></span><br /><br /> <span data-ttu-id="4f9f9-140">-如果你没有任何可选参数，设置最小值 = 最大值。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-140">-   If you have no optional parameters, set min = max.</span></span><br /><span data-ttu-id="4f9f9-141">-如果你拥有某些可选参数，设置最大值 = （多个可选参数的参数的最小数目）。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-141">-   If you have some optional parameters, set max = (number of optional parameters - min number of parameters).</span></span><br /><span data-ttu-id="4f9f9-142">-如果你想要允许不受限制的可选参数，不要设置最大值。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-142">-   If you want to allow unlimited optional parameters, do not set max.</span></span><br /><span data-ttu-id="4f9f9-143">-如果你具有可变数量的输入，是否未设置最小值或最大值，并设置**HasVariableInputs** = `true`。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-143">-   If you have a variable number of inputs, do not set min or max, and set **HasVariableInputs** = `true`.</span></span>|  
|<span data-ttu-id="4f9f9-144">声明可与 functoid 连接的类型</span><span class="sxs-lookup"><span data-stu-id="4f9f9-144">Declare what can connect to your functoid</span></span>|<span data-ttu-id="4f9f9-145">**AddInputConnectionType**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-145">**AddInputConnectionType**</span></span>|<span data-ttu-id="4f9f9-146">为 functoid 支持的每个 **Microsoft.BizTalk.BaseFunctoids.ConnectionType** 调用一次 [AddInputConnectionType](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.connectiontype.aspx) 。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-146">Call **AddInputConnectionType** once for each [Microsoft.BizTalk.BaseFunctoids.ConnectionType](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.connectiontype.aspx) that the functoid supports.</span></span>|  
|<span data-ttu-id="4f9f9-147">声明 functoid 可连接到的类型</span><span class="sxs-lookup"><span data-stu-id="4f9f9-147">Declare what your functoid can connect to</span></span>|<span data-ttu-id="4f9f9-148">**OutputConnectionType**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-148">**OutputConnectionType**</span></span>|<span data-ttu-id="4f9f9-149">使用 [Microsoft.BizTalk.BaseFunctoids.ConnectionType](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.connectiontype.aspx) 中的值通知 BizTalk 映射器哪些类型的对象可接收 functoid 的输出。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-149">Use values from [Microsoft.BizTalk.BaseFunctoids.ConnectionType](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.connectiontype.aspx) to tell BizTalk Mapper the types of objects that can receive output from your functoid.</span></span> <span data-ttu-id="4f9f9-150">使用 **OR** 可以指定多个连接类型。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-150">Use **OR** to specify multiple connection types.</span></span>|  
|<span data-ttu-id="4f9f9-151">通知 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 为 functoid 调用哪些方法</span><span class="sxs-lookup"><span data-stu-id="4f9f9-151">Tell [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] which methods to invoke for your functoid</span></span>|<span data-ttu-id="4f9f9-152">**SetExternalFunctionName**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-152">**SetExternalFunctionName**</span></span><br /><br /> <span data-ttu-id="4f9f9-153">**SetExternalFunctionName2**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-153">**SetExternalFunctionName2**</span></span><br /><br /> <span data-ttu-id="4f9f9-154">**SetExternalFunctionName3**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-154">**SetExternalFunctionName3**</span></span>|<span data-ttu-id="4f9f9-155">对于累计 functoid，请使用 **SetExternalFunctionName** 设置初始化函数，使用 **SetExternalFunctionName2** 设置累计函数，使用 **SetExternalFunctionName3** 指定返回累计值的函数。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-155">For cumulative functoids, use **SetExternalFunctionName** to set the initialization function, **SetExternalFunctionName2** to set the accumulation function, and **SetExternalFunctionName3** to specify the function that returns the accumulated value.</span></span> <span data-ttu-id="4f9f9-156">对于非累计 functoid，请使用 **SetExternalFunctionName** 设置 functoid 方法。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-156">For noncumulative functoids use **SetExternalFunctionName** to set the functoid method.</span></span>|  
|<span data-ttu-id="4f9f9-157">让 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 使用内联代码调用 functoid</span><span class="sxs-lookup"><span data-stu-id="4f9f9-157">Have [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] use inline code to invoke your functoid</span></span>|<span data-ttu-id="4f9f9-158">**AddScriptTypeSupport SetScriptBuffer**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-158">**AddScriptTypeSupport SetScriptBuffer**</span></span>|<span data-ttu-id="4f9f9-159">使用 **Microsoft.BizTalk.BaseFunctoids.ScriptType** 调用 [AddScriptTypeSupport](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.scripttype.aspx) 以启用内联代码。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-159">Call **AddScriptTypeSupport** with [Microsoft.BizTalk.BaseFunctoids.ScriptType](http://msdn.microsoft.com/library/microsoft.biztalk.basefunctoids.scripttype.aspx) to enable inline code.</span></span> <span data-ttu-id="4f9f9-160">调用 **SetScriptBuffer** 以传入 functoid 的代码。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-160">Invoke **SetScriptBuffer** to pass in the code for the functoid.</span></span> <span data-ttu-id="4f9f9-161">这些代码将被复制到映射中。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-161">This code will be copied into the map.</span></span>|  
|<span data-ttu-id="4f9f9-162">声明内联 functoid 的全局变量</span><span class="sxs-lookup"><span data-stu-id="4f9f9-162">Declare global variables for an inline functoid</span></span>|<span data-ttu-id="4f9f9-163">**SetScriptGlobalBuffer**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-163">**SetScriptGlobalBuffer**</span></span>|<span data-ttu-id="4f9f9-164">所做的任何声明对映射中包含的其他内联脚本都是可见的。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-164">Any declarations made will be visible to other inline scripts included in the map.</span></span>|  
|<span data-ttu-id="4f9f9-165">指示内联 functoid 需要哪些助手函数</span><span class="sxs-lookup"><span data-stu-id="4f9f9-165">Indicate which helper functions your inline functoid requires</span></span>|<span data-ttu-id="4f9f9-166">**RequiredGlobalHelperFunctions**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-166">**RequiredGlobalHelperFunctions**</span></span>|<span data-ttu-id="4f9f9-167">使用 **InlineGlobalHelperFunction** 枚举的值指定需要哪些助手函数。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-167">Use values from the **InlineGlobalHelperFunction** enumeration to specify which helper functions are required.</span></span> <span data-ttu-id="4f9f9-168">使用 **OR** 可以指定多个助手函数。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-168">Use **OR** to specify multiple helper functions.</span></span>|  
|<span data-ttu-id="4f9f9-169">验证传递给 functoid 的参数</span><span class="sxs-lookup"><span data-stu-id="4f9f9-169">Validate parameters passed to your functoid</span></span>|<span data-ttu-id="4f9f9-170">**IsDate**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-170">**IsDate**</span></span><br /><br /> <span data-ttu-id="4f9f9-171">**IsNumeric**</span><span class="sxs-lookup"><span data-stu-id="4f9f9-171">**IsNumeric**</span></span>|<span data-ttu-id="4f9f9-172">这些函数提供“真/假”答案，而不引发异常。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-172">These functions provide a true/false answer without throwing an exception.</span></span>|  
  
## <a name="implementing-functoid-logic"></a><span data-ttu-id="4f9f9-173">实现 Functoid 逻辑</span><span class="sxs-lookup"><span data-stu-id="4f9f9-173">Implementing Functoid Logic</span></span>  
 <span data-ttu-id="4f9f9-174">为使 functoid 有用，您必须实现一个或多个方法，方法的数量取决于 functoid 的类别。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-174">To make the functoid useful you must implement one or more methods depending upon the functoid category.</span></span> <span data-ttu-id="4f9f9-175">如果 functoid 是累计 functoid，则您需要提供三个方法，一个用于初始化，一个执行累计，一个返回累计值。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-175">If the functoid is cumulative, then you need to supply three methods—one for initialization, one to do the accumulation, and one to return the accumulated value.</span></span> <span data-ttu-id="4f9f9-176">如果 functoid 不是累计 functoid，则您只需要提供一个返回值的方法。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-176">If the functoid is not cumulative, then you need to supply one method that returns a value.</span></span>  
  
 <span data-ttu-id="4f9f9-177">而且您还必须确定，内联的 functoid 实现代码应复制到映射中，还是应保留在编译的 .NET 程序集内并通过引用来使用。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-177">You also have to decide if the functoid implementation code should be copied inline into the map or kept within a compiled .NET assembly and used through a reference.</span></span>  
  
 <span data-ttu-id="4f9f9-178">在下列情况下可考虑使用内联 functoid：</span><span class="sxs-lookup"><span data-stu-id="4f9f9-178">Consider using an inline functoid when:</span></span>  
  
-   <span data-ttu-id="4f9f9-179">其他人可以读取并可以修改您的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-179">It is okay for others to read and potentially modify your business logic.</span></span>  
  
-   <span data-ttu-id="4f9f9-180">functoid 只依赖于映射支持的 .NET Framework 命名空间。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-180">Your functoid depends only upon .NET Framework namespaces that the map supports.</span></span> <span data-ttu-id="4f9f9-181">有关可用命名空间，请参阅[脚本使用内联 C#、 JScript.NET 和 Visual Basic.NET](../core/scripting-using-inline-csharp-jscript-net-and-visual-basic-net.md)。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-181">For available namespaces, see [Scripting Using Inline C#, JScript .NET, and Visual Basic .NET](../core/scripting-using-inline-csharp-jscript-net-and-visual-basic-net.md).</span></span>  
  
-   <span data-ttu-id="4f9f9-182">不需要在 BizTalk 解决方案中部署和维护其他程序集。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-182">You do not want to deploy and maintain another assembly with your BizTalk solution.</span></span>  
  
-   <span data-ttu-id="4f9f9-183">要编写一系列共享变量的 functoid。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-183">You are writing a series of functoids that share variables.</span></span>  
  
 <span data-ttu-id="4f9f9-184">在下列情况下可考虑使用引用的 functoid：</span><span class="sxs-lookup"><span data-stu-id="4f9f9-184">Consider using a referenced functoid when:</span></span>  
  
-   <span data-ttu-id="4f9f9-185">不希望业务逻辑复制到其他人可以看到或能够对其进行修改的映射中。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-185">You do not want your business logic copied into the map where it might be seen or modified by others.</span></span>  
  
-   <span data-ttu-id="4f9f9-186">functoid 依赖于映射不支持的 .NET Framework 类。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-186">Your functoid depends upon .NET Framework classes that the map does not support.</span></span>  
  
-   <span data-ttu-id="4f9f9-187">.NET Framework 提供的附加功能要求您的 BizTalk 解决方案部署和维护另一个程序集。</span><span class="sxs-lookup"><span data-stu-id="4f9f9-187">The added functionality provided by the .NET Framework justifies deploying and maintaining another assembly with your BizTalk solution.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4f9f9-188">另请参阅</span><span class="sxs-lookup"><span data-stu-id="4f9f9-188">See Also</span></span>  
 <span data-ttu-id="4f9f9-189">[开发自定义引用 Functoid](../core/developing-a-custom-referenced-functoid.md) </span><span class="sxs-lookup"><span data-stu-id="4f9f9-189">[Developing a Custom Referenced Functoid](../core/developing-a-custom-referenced-functoid.md) </span></span>  
 <span data-ttu-id="4f9f9-190">[开发自定义的内联 Functoid](../core/developing-a-custom-inline-functoid.md) </span><span class="sxs-lookup"><span data-stu-id="4f9f9-190">[Developing a Custom Inline Functoid](../core/developing-a-custom-inline-functoid.md) </span></span>  
 <span data-ttu-id="4f9f9-191">[开发自定义的累积 Functoid](../core/developing-a-custom-cumulative-functoid.md) </span><span class="sxs-lookup"><span data-stu-id="4f9f9-191">[Developing a Custom Cumulative Functoid](../core/developing-a-custom-cumulative-functoid.md) </span></span>  
 [<span data-ttu-id="4f9f9-192">Microsoft.BizTalk.BaseFunctoids.BaseFunctoid</span><span class="sxs-lookup"><span data-stu-id="4f9f9-192">Microsoft.BizTalk.BaseFunctoids.BaseFunctoid</span></span>](http://msdn.microsoft.com/library/Microsoft.BizTalk.BaseFunctoids.BaseFunctoid.aspx)