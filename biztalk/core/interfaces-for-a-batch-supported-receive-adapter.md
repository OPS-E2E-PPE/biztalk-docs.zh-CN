---
title: 接收适配器的接口的支持批的 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: fa6ee780-189c-41e3-9ab0-6b869e791c0a
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 360a7b4fb3f6842795358ebe40cace7531cd2b6c
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65331663"
---
# <a name="interfaces-for-a-batch-supported-receive-adapter"></a><span data-ttu-id="abb2e-102">接收适配器的支持批的接口</span><span class="sxs-lookup"><span data-stu-id="abb2e-102">Interfaces for a Batch-Supported Receive Adapter</span></span>
<span data-ttu-id="abb2e-103">接收适配器始终将提交一批中的消息。</span><span class="sxs-lookup"><span data-stu-id="abb2e-103">A receive adapter always submits messages in a batch.</span></span> <span data-ttu-id="abb2e-104">批处理是一套可用于除提交以外的操作的数据库操作。</span><span class="sxs-lookup"><span data-stu-id="abb2e-104">A batch is a unit of database operations that you can use for actions other than submission.</span></span> <span data-ttu-id="abb2e-105">例如，接收适配器可以提交一组消息、 挂起一组不同的消息，和删除另一组在同一批中的消息。</span><span class="sxs-lookup"><span data-stu-id="abb2e-105">For example, a receive adapter can submit one set of messages, suspend a different set of messages, and delete another set of messages in the same batch.</span></span> <span data-ttu-id="abb2e-106">对同一个批处理中这些单独的操作进行分组来优化性能降至最低的数量数据库所需的往返，强烈建议。</span><span class="sxs-lookup"><span data-stu-id="abb2e-106">Grouping these separate operations in the same batch optimizes performance by minimizing the number of database round trips required and is strongly encouraged.</span></span>  
  
 <span data-ttu-id="abb2e-107">进程内和独立的接收适配器需要实现以下接口才能将消息批提交到服务器：</span><span class="sxs-lookup"><span data-stu-id="abb2e-107">In-process and isolated receive adapters need to implement the following interfaces to submit batches of messages into the server:</span></span>  
  
- <span data-ttu-id="abb2e-108">**IBTTransport**</span><span class="sxs-lookup"><span data-stu-id="abb2e-108">**IBTTransport**</span></span>  
  
- <span data-ttu-id="abb2e-109">**IBTTransportControl** （仅适用于进程内适配器）</span><span class="sxs-lookup"><span data-stu-id="abb2e-109">**IBTTransportControl** (in-process adapters only)</span></span>  
  
- <span data-ttu-id="abb2e-110">**IBTTransportConfig**</span><span class="sxs-lookup"><span data-stu-id="abb2e-110">**IBTTransportConfig**</span></span>  
  
- <span data-ttu-id="abb2e-111">**IBaseComponent**</span><span class="sxs-lookup"><span data-stu-id="abb2e-111">**IBaseComponent**</span></span>  
  
- <span data-ttu-id="abb2e-112">**IPersistPropertyBag**</span><span class="sxs-lookup"><span data-stu-id="abb2e-112">**IPersistPropertyBag**</span></span>  
  
- <span data-ttu-id="abb2e-113">**IBTBatchCallBack**</span><span class="sxs-lookup"><span data-stu-id="abb2e-113">**IBTBatchCallBack**</span></span>  
  
  <span data-ttu-id="abb2e-114">以下步骤介绍接收适配器将消息提交到服务器的执行的操作的序列。</span><span class="sxs-lookup"><span data-stu-id="abb2e-114">The following steps describe the sequence of actions that a receive adapter performs to submit messages into the server.</span></span>  
  
1. <span data-ttu-id="abb2e-115">接收适配器通过调用从传输代理获取批处理**GetBatch**方法**IBTTransportProxy**接口。</span><span class="sxs-lookup"><span data-stu-id="abb2e-115">A receive adapter obtains the batch from the transport proxy by calling the **GetBatch** method of the **IBTTransportProxy** interface.</span></span> <span data-ttu-id="abb2e-116">对其调用中**GetBatch**适配器传入一个指向其**IBTBatchCallback**接口实现。</span><span class="sxs-lookup"><span data-stu-id="abb2e-116">In its call to **GetBatch** the adapter passes in a pointer to its **IBTBatchCallback** interface implementation.</span></span>  
  
2. <span data-ttu-id="abb2e-117">适配器会将消息添加一个每次向该批次通过调用**SubmitMessage**方法**IBTTransportBatch**接口。</span><span class="sxs-lookup"><span data-stu-id="abb2e-117">An adapter adds the messages one at a time into the batch by calling the **SubmitMessage** method of the **IBTTransportBatch** interface.</span></span> <span data-ttu-id="abb2e-118">如果这是一个双向操作，例如要求-响应消息传送**SubmitResponseMessage**调用此相同接口的方法来提交响应消息。</span><span class="sxs-lookup"><span data-stu-id="abb2e-118">If this is a two-way operation such as solicit-response messaging, the **SubmitResponseMessage** method of this same interface is called to submit the response message.</span></span>  
  
3. <span data-ttu-id="abb2e-119">当所有消息都已都添加到批时，适配器调用**完成**方法**IBTTransportBatch**接口来提交到传输代理批。</span><span class="sxs-lookup"><span data-stu-id="abb2e-119">When all the messages have been added to the batch, the adapter calls the **Done** method of the **IBTTransportBatch** interface to submit the batch to the transport proxy.</span></span> <span data-ttu-id="abb2e-120">由于接收适配器是在本质上异步时，适配器可以立即获取新批开始提交其他消息之后它将调用,**完成**。</span><span class="sxs-lookup"><span data-stu-id="abb2e-120">Because receive adapters are asynchronous in nature, the adapter can immediately obtain a new batch and start submitting other messages after it calls **Done**.</span></span>  
  
4. <span data-ttu-id="abb2e-121">处理批后，消息引擎调用适配器的**BatchComplete**使用传输代理来进行实际调用的回调方法。</span><span class="sxs-lookup"><span data-stu-id="abb2e-121">After the batch has been processed, the Messaging Engine invokes the adapter's **BatchComplete** callback method using the transport proxy to make the actual call.</span></span> <span data-ttu-id="abb2e-122">一个数组**BTBatchOperationStatus**对象包含提交状态传递给适配器。</span><span class="sxs-lookup"><span data-stu-id="abb2e-122">An array of **BTBatchOperationStatus** objects containing the status of the submission is passed to the adapter.</span></span> <span data-ttu-id="abb2e-123">每个对象对应于一种操作类型，包含该操作的总体状态以及每条消息，对其执行该操作的状态。</span><span class="sxs-lookup"><span data-stu-id="abb2e-123">Each object corresponds to an operation type and contains the overall status of the operation as well as the status for each message for which the operation was performed.</span></span> <span data-ttu-id="abb2e-124">以下序列描述了该适配器需要对其执行分析的批处理的处理状态的操作：</span><span class="sxs-lookup"><span data-stu-id="abb2e-124">The following sequence describes the actions the adapter needs to perform to analyze the status of batch processing:</span></span>  
  
   1.  <span data-ttu-id="abb2e-125">检查总体批状态 HRESULT 值作为参数传递给**BatchComplete**方法。</span><span class="sxs-lookup"><span data-stu-id="abb2e-125">Check the overall batch status HRESULT value passed as a parameter to the **BatchComplete** method.</span></span> <span data-ttu-id="abb2e-126">如果失败，这意味着至少一个批处理中的操作未成功。</span><span class="sxs-lookup"><span data-stu-id="abb2e-126">If it is a failure, it means that at least one of the operations in the batch was unsuccessful.</span></span> <span data-ttu-id="abb2e-127">因此整个批作为一个实体提交失败。</span><span class="sxs-lookup"><span data-stu-id="abb2e-127">Therefore the submission of the entire batch as one entity failed.</span></span> <span data-ttu-id="abb2e-128">然后，适配器应尝试来发现有问题的消息并重新提交以批形式仅原来未造成故障的那些。</span><span class="sxs-lookup"><span data-stu-id="abb2e-128">The adapter should then try to discover the offending message(s) and resubmit as a batch only the ones that did not initially cause a failure.</span></span>  
  
        <span data-ttu-id="abb2e-129">如果总体批状态为成功，则意味着提交给传输代理的所有消息已持久都保存到磁盘。</span><span class="sxs-lookup"><span data-stu-id="abb2e-129">If the overall batch status succeeded, it means that all the messages that were given to the transport proxy were persisted to disk.</span></span> <span data-ttu-id="abb2e-130">但是，它并不意味着管道已成功处理所有消息。</span><span class="sxs-lookup"><span data-stu-id="abb2e-130">However, it does not mean that the pipeline successfully processed all the messages.</span></span> <span data-ttu-id="abb2e-131">就可以在管道中失败的消息被挂起。</span><span class="sxs-lookup"><span data-stu-id="abb2e-131">It is possible that messages that failed in the pipeline were suspended.</span></span> <span data-ttu-id="abb2e-132">对于管道中失败的消息，返回的总体批状态是成功因为数据已写入到磁盘。</span><span class="sxs-lookup"><span data-stu-id="abb2e-132">For messages that fail in the pipeline, the overall batch status returned is successful because the data was written to disk.</span></span>  
  
   2.  <span data-ttu-id="abb2e-133">检查每个操作类型中的状态`operationStatus`参数。</span><span class="sxs-lookup"><span data-stu-id="abb2e-133">Check the status for each operation type in the `operationStatus` parameter.</span></span> <span data-ttu-id="abb2e-134">如果状态为 **，则为 S_OK**，则此操作的提交成功，并且不需要进一步检查其状态。</span><span class="sxs-lookup"><span data-stu-id="abb2e-134">If the status is **S_OK**, the submission for this operation succeeded and you do not need to check the status any further.</span></span> <span data-ttu-id="abb2e-135">如果将状态设置为**BTS_S_EPM_MESSAGE_SUSPENDED**的某些消息已挂起。</span><span class="sxs-lookup"><span data-stu-id="abb2e-135">If the status is set to **BTS_S_EPM_MESSAGE_SUSPENDED** some of the messages were suspended.</span></span> <span data-ttu-id="abb2e-136">**BTS_S_EPM_SECURITY_CHECK_FAILED**表示一些消息未能中的身份验证身份验证要求的接收端口。</span><span class="sxs-lookup"><span data-stu-id="abb2e-136">**BTS_S_EPM_SECURITY_CHECK_FAILED** signifies that some messages failed authentication in an authentication-required receive port.</span></span> <span data-ttu-id="abb2e-137">如果**E_FAIL**返回任何内容，或值小于零，此操作失败，则消息提交的任何 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="abb2e-137">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission for this operation failed.</span></span>  
  
   3.  <span data-ttu-id="abb2e-138">检查各个消息的操作类型的状态。</span><span class="sxs-lookup"><span data-stu-id="abb2e-138">Check the status of individual messages for the operation type.</span></span> <span data-ttu-id="abb2e-139">对于提交操作类型，每个消息的状态设置为 **，则为 S_OK**如果提交成功。</span><span class="sxs-lookup"><span data-stu-id="abb2e-139">For the submit operation type, the status of each message is set to **S_OK** if the submission succeeded.</span></span> <span data-ttu-id="abb2e-140">**BTS_S_EPM_MESSAGE_SUSPENDED**返回消息已挂起。</span><span class="sxs-lookup"><span data-stu-id="abb2e-140">**BTS_S_EPM_MESSAGE_SUSPENDED** is returned if the message was suspended.</span></span> <span data-ttu-id="abb2e-141">**BTS_S_EPM_SECURITY_CHECK_FAILED**返回消息如果失败的身份验证要求进行身份验证的接收端口。</span><span class="sxs-lookup"><span data-stu-id="abb2e-141">**BTS_S_EPM_SECURITY_CHECK_FAILED** is returned if the message failed authentication on a receive port that requires authentication.</span></span> <span data-ttu-id="abb2e-142">**E_BTS_NO_SUBSCRIPTION**回如果发布的消息没有订户。</span><span class="sxs-lookup"><span data-stu-id="abb2e-142">**E_BTS_NO_SUBSCRIPTION** comes back if there were no subscribers for the published message.</span></span> <span data-ttu-id="abb2e-143">如果**E_FAIL**返回任何内容，或值小于零，则消息提交失败的任何 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="abb2e-143">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission failed.</span></span>  
  
   4.  <span data-ttu-id="abb2e-144">具体取决于您的适配器，您可能想要返回的消息挂起**E_FAIL**或任何失败的 HRESULT。</span><span class="sxs-lookup"><span data-stu-id="abb2e-144">Depending on your adapter, you may want to suspend messages that return **E_FAIL** or any failing HRESULT.</span></span>  
  
5. <span data-ttu-id="abb2e-145">**BatchComplete**方法需要返回任一 **，则为 S_OK**或**E_FAIL**以指示执行的结果。</span><span class="sxs-lookup"><span data-stu-id="abb2e-145">The **BatchComplete** method needs to return either **S_OK** or **E_FAIL** to indicate the result of execution.</span></span> <span data-ttu-id="abb2e-146">如果**BatchComplete**方法将返回**E_FAIL**或负的任何 HRESULT，传输代理记录一个错误。</span><span class="sxs-lookup"><span data-stu-id="abb2e-146">If the **BatchComplete** method returns **E_FAIL** or any negative HRESULT, the transport proxy logs an error.</span></span>  
  
   <span data-ttu-id="abb2e-147">下图显示了接收适配器创建支持批处理的涉及到的对象交互。</span><span class="sxs-lookup"><span data-stu-id="abb2e-147">The following figure shows the object interactions involved in creating a batch-supported receive adapter.</span></span>  
  
   <span data-ttu-id="abb2e-148">![](../core/media/ebiz-sdk-devadapter1.gif "ebiz_sdk_devadapter1")</span><span class="sxs-lookup"><span data-stu-id="abb2e-148">![](../core/media/ebiz-sdk-devadapter1.gif "ebiz_sdk_devadapter1")</span></span>  
   <span data-ttu-id="abb2e-149">接收适配器提交一批消息的工作流</span><span class="sxs-lookup"><span data-stu-id="abb2e-149">Workflow for a receive adapter submitting a batch of messages</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="abb2e-150">请参阅</span><span class="sxs-lookup"><span data-stu-id="abb2e-150">See Also</span></span>  
 <span data-ttu-id="abb2e-151">[适配器变量](../core/adapter-variables.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-151">[Adapter Variables](../core/adapter-variables.md) </span></span>  
 <span data-ttu-id="abb2e-152">[开发接收适配器](../core/developing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-152">[Developing a Receive Adapter](../core/developing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="abb2e-153">[实例化和初始化接收适配器](../core/instantiating-and-initializing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-153">[Instantiating and Initializing a Receive Adapter](../core/instantiating-and-initializing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="abb2e-154">[接收适配器的进程内的接口](../core/interfaces-for-an-in-process-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-154">[Interfaces for an In-Process Receive Adapter](../core/interfaces-for-an-in-process-receive-adapter.md) </span></span>  
 <span data-ttu-id="abb2e-155">[接口独立接收适配器](../core/interfaces-for-an-isolated-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-155">[Interfaces for an Isolated Receive Adapter](../core/interfaces-for-an-isolated-receive-adapter.md) </span></span>  
 <span data-ttu-id="abb2e-156">[接收适配器的接口的事务性批处理支持](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="abb2e-156">[Interfaces for a Transactional Batch-Supported Receive Adapter](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span></span>  
 [<span data-ttu-id="abb2e-157">同步请求-响应接收适配器的接口</span><span class="sxs-lookup"><span data-stu-id="abb2e-157">Interfaces for a Synchronous Request-Response Receive Adapter</span></span>](../core/interfaces-for-a-synchronous-request-response-receive-adapter.md)