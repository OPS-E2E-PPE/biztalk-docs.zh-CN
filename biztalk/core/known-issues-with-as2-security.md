---
title: AS2 安全的已知问题 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b291e000-630d-49a1-8e19-f76c4dfee294
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1bb633e092ed568bb3817df7be788364934be446
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22262397"
---
# <a name="known-issues-with-as2-security"></a><span data-ttu-id="1d849-102">AS2 安全的已知问题</span><span class="sxs-lookup"><span data-stu-id="1d849-102">Known Issues with AS2 Security</span></span>
<span data-ttu-id="1d849-103">本主题介绍 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] AS2 解决方案在安全方面的已知问题。</span><span class="sxs-lookup"><span data-stu-id="1d849-103">This topic describes known issues with the security of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] AS2 solutions.</span></span>  
  
## <a name="the-as2-decoder-will-not-validate-that-a-certificate-is-configured-on-the-host-or-for-the-destination-party"></a><span data-ttu-id="1d849-104">AS2 解码器将不验证在主机上是否已配置证书或是否为目标参与方已配置证书</span><span class="sxs-lookup"><span data-stu-id="1d849-104">The AS2 Decoder Will Not Validate that a Certificate Is Configured on the Host or for the Destination Party</span></span>  
 <span data-ttu-id="1d849-105">只要在证书存储区中配置了消息的私用证书，AS2 解码器就会解密该消息。</span><span class="sxs-lookup"><span data-stu-id="1d849-105">The AS2 decoder will decrypt a message as long as the private certificate for that message is configured in the certificate store.</span></span> <span data-ttu-id="1d849-106">但是，AS2 解码器将不验证解密证书是否与在主机上配置的证书相同。</span><span class="sxs-lookup"><span data-stu-id="1d849-106">However, the AS2 decoder will not validate that the decryption certificate is the same as the certificate configured on the host.</span></span> <span data-ttu-id="1d849-107">接收到的消息可使用多个证书进行加密。</span><span class="sxs-lookup"><span data-stu-id="1d849-107">The received message can be encrypted with more than one certificate.</span></span>  
  
## <a name="storing-as2-messages-in-wire-format-can-lead-to-a-security-issue"></a><span data-ttu-id="1d849-108">以传输格式存储 AS2 消息可能会导致安全问题</span><span class="sxs-lookup"><span data-stu-id="1d849-108">Storing AS2 Messages in Wire Format Can Lead to a Security Issue</span></span>  
 <span data-ttu-id="1d849-109">不使用证书时，不推荐在不可否认接收 (NRR) 数据库中以传输格式存储 AS2 消息。</span><span class="sxs-lookup"><span data-stu-id="1d849-109">When certificates are not used, storing AS2 messages in wire format in the non-repudiation receipt (NRR) database is not recommended.</span></span> <span data-ttu-id="1d849-110">这样做可能导致安全问题。</span><span class="sxs-lookup"><span data-stu-id="1d849-110">Doing so could lead to a security issue.</span></span>  
  
## <a name="messages-or-mdns-to-be-stored-in-the-nrr-database-should-be-signed"></a><span data-ttu-id="1d849-111">应对要存储在 NRR 数据库中的消息或 MDN 签名</span><span class="sxs-lookup"><span data-stu-id="1d849-111">Messages or MDNs To Be Stored in the NRR Database Should Be Signed</span></span>  
 <span data-ttu-id="1d849-112">为保证接收的不可否认性，必须对适用消息进行验证并确保适用消息的完整性。</span><span class="sxs-lookup"><span data-stu-id="1d849-112">To guarantee non-repudiation of receipt, you must establish the authentication and integrity of the applicable message.</span></span> <span data-ttu-id="1d849-113">实现此目的的推荐方法是对消息使用数字签名。</span><span class="sxs-lookup"><span data-stu-id="1d849-113">The recommended way of doing so is by using a digital signature on the message.</span></span> <span data-ttu-id="1d849-114">因此，如果将 AS2 参与方属性配置为在不可否认数据库中存储消息或 MDN，则应将 AS2 属性配置为对将存储的消息或 MDN 签名。</span><span class="sxs-lookup"><span data-stu-id="1d849-114">As a result, if you configure AS2 party properties to store messages or MDNs in the non-repudiation database, you should configure the AS2 properties to sign the messages or MDNs that you are going to store.</span></span>  
  
## <a name="biztalk-server-will-be-unable-to-decrypt-a-message-saved-in-wire-format-if-the-certificate-is-not-valid"></a><span data-ttu-id="1d849-115">如果证书无效，则 BizTalk Server 将无法对以传输格式保存的消息解密</span><span class="sxs-lookup"><span data-stu-id="1d849-115">BizTalk Server Will Be Unable to Decrypt a Message Saved in Wire Format If the Certificate Is Not Valid</span></span>  
 <span data-ttu-id="1d849-116">**症状**</span><span class="sxs-lookup"><span data-stu-id="1d849-116">**Symptom**</span></span>  
  
 <span data-ttu-id="1d849-117">BizTalk Server 无法对不可否认数据库中以传输格式保存的入站 AS2 消息解密。</span><span class="sxs-lookup"><span data-stu-id="1d849-117">BizTalk Server is unable to decrypt an inbound AS2 message that was saved in wire format in the non-repudiation database.</span></span>  
  
 <span data-ttu-id="1d849-118">**可能的原因**</span><span class="sxs-lookup"><span data-stu-id="1d849-118">**Possible Cause**</span></span>  
  
 <span data-ttu-id="1d849-119">解密消息所需的证书已过期或已被吊销。</span><span class="sxs-lookup"><span data-stu-id="1d849-119">The certificate required to decrypt the message has expired or been revoked.</span></span> <span data-ttu-id="1d849-120">如果自 AS2 消息保存在不可否认数据库以来已过去一定时间，则更有可能发生上述情况。</span><span class="sxs-lookup"><span data-stu-id="1d849-120">This is more likely to occur if a certain period of time has elapsed since the AS2 message was saved in the non-repudiation database.</span></span> <span data-ttu-id="1d849-121">如果发生这种情况，则您可能不能立即访问该消息的有效证书。</span><span class="sxs-lookup"><span data-stu-id="1d849-121">If this occurs, you may not have immediate access to a valid certificate for the message.</span></span>  
  
 <span data-ttu-id="1d849-122">**解决方法**</span><span class="sxs-lookup"><span data-stu-id="1d849-122">**Resolution**</span></span>  
  
 <span data-ttu-id="1d849-123">获取有效证书，以对消息进行解密。</span><span class="sxs-lookup"><span data-stu-id="1d849-123">Acquire a valid certificate for decrypting the message.</span></span>  
  
## <a name="the-inner-envelope-of-a-signed-as2-message-must-not-be-changed-after-the-signature-has-been-calculated"></a><span data-ttu-id="1d849-124">在计算签名后不得更改已签名的 AS2 消息的内层信封</span><span class="sxs-lookup"><span data-stu-id="1d849-124">The inner envelope of a signed AS2 message must not be changed after the signature has been calculated</span></span>  
 <span data-ttu-id="1d849-125">对 AS2 消息签名时，将根据内层信封标头和负载计算该签名。</span><span class="sxs-lookup"><span data-stu-id="1d849-125">When an AS2 message is signed, the signature is calculated based on the inner envelope headers and payload.</span></span> <span data-ttu-id="1d849-126">如果在计算签名后更改了内层信封，则该签名将受损。</span><span class="sxs-lookup"><span data-stu-id="1d849-126">If the inner envelope is changed after the signature is calculated, the signature will be corrupted.</span></span> <span data-ttu-id="1d849-127">可以更改边界标头或边界标头以外的任何对象，但不得更改边界标头以内的任何对象。</span><span class="sxs-lookup"><span data-stu-id="1d849-127">The boundary headers, or anything outside the boundary headers, can be changed, but anything within the boundary headers must not be changed.</span></span>  
  
## <a name="use-the-same-logon-for-the-in-process-host-instance-and-the-isolated-host-instance-to-ensure-that-personal-store-is-recognized"></a><span data-ttu-id="1d849-128">对进程内主机实例和独立主机实例使用相同的登录名，以确保可识别个人存储区</span><span class="sxs-lookup"><span data-stu-id="1d849-128">Use the same logon for the in-process host instance and the isolated host instance to ensure that Personal store is recognized</span></span>  
 <span data-ttu-id="1d849-129">只有在为登录凭据与主机实例关联的用户加载了用户配置文件时，个人证书存储区才可用于消息处理。</span><span class="sxs-lookup"><span data-stu-id="1d849-129">The Personal certificate store will be available for message processing only if the user profile is loaded for the user whose logon credentials are associated with the host instance.</span></span> <span data-ttu-id="1d849-130">个人存储区用于签名证书和解密证书（用户自己的私钥）。</span><span class="sxs-lookup"><span data-stu-id="1d849-130">The Personal store is used for signing and decryption certificates (the user's own private key).</span></span> <span data-ttu-id="1d849-131">默认情况下，将为进程内主机实例加载用户配置文件；但默认情况下不会为独立主机实例加载用户配置文件。</span><span class="sxs-lookup"><span data-stu-id="1d849-131">The user profile is loaded by default for the in-process host instance; however, the user profile is not loaded by default for the isolated host instance.</span></span> <span data-ttu-id="1d849-132">您可以通过应用程序为独立主机加载用户配置文件。</span><span class="sxs-lookup"><span data-stu-id="1d849-132">You can have an application load the user profile for the isolated host.</span></span> <span data-ttu-id="1d849-133">另外，也可以通过对进程内主机实例和独立主机实例使用相同的登录名来解决此问题。</span><span class="sxs-lookup"><span data-stu-id="1d849-133">Alternatively, you can work around this issue by using the same logon for the in-process host instance and the isolated host instance.</span></span>  
  
 <span data-ttu-id="1d849-134">您可以创建空服务来加载用户配置文件，而无需让应用程序来加载此文件。</span><span class="sxs-lookup"><span data-stu-id="1d849-134">Instead of having an application load the user profile, you can create an empty service to load the profile.</span></span> <span data-ttu-id="1d849-135">有关创建空的服务的信息，请参阅[如何： 创建 Windows 服务](http://go.microsoft.com/fwlink/?LinkId=196492)。</span><span class="sxs-lookup"><span data-stu-id="1d849-135">For information about creating an empty service, see [How to: Create Windows Services](http://go.microsoft.com/fwlink/?LinkId=196492).</span></span> <span data-ttu-id="1d849-136">创建服务后，打开计算机管理对话框中，打开服务的属性对话框，单击**Log On**选项卡上，选择**此帐户**，输入用于登录名隔离主机实例，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="1d849-136">After you have created the service, open the Computer Management dialog box, open the Properties dialog box for the service, click the **Log On** tab, select **This Account**, enter the logon name used for the isolated host instance, and then click **OK**.</span></span> <span data-ttu-id="1d849-137">然后您可以手动启动该服务，以加载该登录用户的用户配置文件。</span><span class="sxs-lookup"><span data-stu-id="1d849-137">You can then manually start the service to load the user profile for that logon user.</span></span>  
  
## <a name="the-key-usage-attribute-of-a-certificate-must-match-the-certificates-use"></a><span data-ttu-id="1d849-138">证书的“密钥用法”属性必须与证书的用途匹配</span><span class="sxs-lookup"><span data-stu-id="1d849-138">The Key Usage attribute of a certificate must match the certificate's use</span></span>  
 <span data-ttu-id="1d849-139">用于 AS2 传输的证书必须具有实现其用途所需的属性。</span><span class="sxs-lookup"><span data-stu-id="1d849-139">Certificates used for AS2 transport must have the attributes required for their intended use.</span></span> <span data-ttu-id="1d849-140">对于签名和签名验证，证书的“密钥用法”属性必须为“数字签名”。</span><span class="sxs-lookup"><span data-stu-id="1d849-140">For signing and signature verification, the Key Usage attribute of the certificate must be Digital Signature.</span></span> <span data-ttu-id="1d849-141">对于加密和解密，证书的“密钥用法”属性必须为“数据加密”或“密钥加密”。</span><span class="sxs-lookup"><span data-stu-id="1d849-141">For encryption and decryption, the Key Usage attribute of the certificate must be Data Encipherment or Key Encipherment.</span></span> <span data-ttu-id="1d849-142">可通过双击证书、单击“证书”对话框中的“详细信息”选项卡并检查“密钥用法”字段来验证“密钥用法”属性。</span><span class="sxs-lookup"><span data-stu-id="1d849-142">You can verify the Key Usage attribute by double-clicking the certificate, clicking the Details tab in the Certificate dialog box, and checking the Key Usage field.</span></span>  
  
## <a name="the-certificate-resolution-list-will-be-verified-for-an-outgoing-mdn-if-the-as2-to-property-is-not-set-for-the-party"></a><span data-ttu-id="1d849-143">如果没有对参与方设置 AS2-To 属性，则将为传出的 MDN 验证证书解析列表。</span><span class="sxs-lookup"><span data-stu-id="1d849-143">The certificate resolution list will be verified for an outgoing MDN if the AS2-To property is not set for the party</span></span>  
 <span data-ttu-id="1d849-144">在传出的 MDN 的默认协议中，会执行证书解析列表验证。</span><span class="sxs-lookup"><span data-stu-id="1d849-144">In the default agreement for an outgoing MDN, the certificate resolution list verification is performed.</span></span> <span data-ttu-id="1d849-145">如果您不希望执行此验证，请确保设置了正确的 AS2-To 参与方属性，以便能够解析接收方并且能够确定参与方属性。</span><span class="sxs-lookup"><span data-stu-id="1d849-145">If you do not want this verification to be performed, verify that the correct AS2-To party property is set, so the receiving party can be resolved and the party properties can be determined.</span></span> <span data-ttu-id="1d849-146">这样的话，将不使用提示验证证书解析列表的默认协议。</span><span class="sxs-lookup"><span data-stu-id="1d849-146">If so, the default agreement that prompts verification of the certificate resolution list will not be used.</span></span> <span data-ttu-id="1d849-147">您还将需要在 AS2 参与方属性的“常规”页上禁用“检查证书吊销列表”属性。</span><span class="sxs-lookup"><span data-stu-id="1d849-147">You will also need to disable the Check Certification Revocation List property on the General page of the AS2 party properties.</span></span>