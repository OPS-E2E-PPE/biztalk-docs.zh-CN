---
title: 如何创建接收调用的业务流程上的订阅 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 3423309a-cb5a-40a5-9582-6ee3ac82b538
caps.latest.revision: 9
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b4c1e32e6d14673ba0a06a45e08d25c531824e1d
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65385478"
---
# <a name="how-to-create-receive-subscriptions-at-invoked-orchestrations"></a><span data-ttu-id="2cb77-102">如何创建接收调用的业务流程上的订阅</span><span class="sxs-lookup"><span data-stu-id="2cb77-102">How to Create Receive Subscriptions at Invoked Orchestrations</span></span>
<span data-ttu-id="2cb77-103">尽管您可以将消息传递作为参数通过**启动业务流程**形状在启动业务流程，在某些情况下，你可能想要从调用方业务流程向后调用的业务流程发送消息时调用。</span><span class="sxs-lookup"><span data-stu-id="2cb77-103">Although you can pass messages as parameters through the **Start Orchestration** shape when you start an orchestration, in some scenarios you may want to send messages from the caller orchestration to the invoked orchestration after the invocation.</span></span> <span data-ttu-id="2cb77-104">例如，您可能不知道你想要在调用时传递什么的消息或其他业务流程可能需要动态地将消息发送到调用的业务流程。</span><span class="sxs-lookup"><span data-stu-id="2cb77-104">For example, you may not know what messages you want to pass at the time of invocation, or other orchestrations may need to send messages to the invoked orchestration dynamically.</span></span>  
  
 <span data-ttu-id="2cb77-105">若要将消息发送到调用的业务流程的方法是传入一个相关，因此调用的业务流程可以创建该相关帮助定义和使用该订阅，然后接收消息的订阅。</span><span class="sxs-lookup"><span data-stu-id="2cb77-105">The way to send a message to an invoked orchestration is to pass in a correlation so that the invoked orchestration can create the subscription that the correlation helps define and then receive the message by using that subscription.</span></span> <span data-ttu-id="2cb77-106">但是，您不能只需传入一个相关和预期调用的业务流程创建基于该相关订阅和接收订阅中的消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-106">However, you cannot simply pass in a correlation and expect the invoked orchestration to create the subscription based on the correlation and receive a message on the subscription.</span></span> <span data-ttu-id="2cb77-107">如果使用这种方法，从调用方业务流程向调用的业务流程发送的消息将导致错误，"找不到订户，无法路由发布的消息"。</span><span class="sxs-lookup"><span data-stu-id="2cb77-107">If you use that approach, the messages you send from the caller orchestration to the invoked orchestration will result in the error, "The published message could not be routed because no subscribers were found."</span></span> <span data-ttu-id="2cb77-108">这是由于以下原因：</span><span class="sxs-lookup"><span data-stu-id="2cb77-108">This is because of the following:</span></span>  
  
- <span data-ttu-id="2cb77-109">在调用的业务流程是一个争用条件。</span><span class="sxs-lookup"><span data-stu-id="2cb77-109">There is a race condition in the invoked orchestration.</span></span>  
  
- <span data-ttu-id="2cb77-110">没有提交点调用的业务流程将发送到 MessageBox 数据库的路由，以便它可以接收消息的订阅。</span><span class="sxs-lookup"><span data-stu-id="2cb77-110">There is no commit point for the invoked orchestration to send the subscription to the MessageBox database for routing so that it can receive the messages.</span></span>  
  
  <span data-ttu-id="2cb77-111">若要解决此问题一种方法是执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="2cb77-111">A way to resolve this problem is to perform the following steps:</span></span>  
  
1. <span data-ttu-id="2cb77-112">在调用方业务流程，你具有某个激活接收以接收消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-112">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="2cb77-113">调用方业务流程中接收消息、 初始化相关集，并将相关集和一个自相关接收直接绑定端口通过后**启动业务流程**形状。</span><span class="sxs-lookup"><span data-stu-id="2cb77-113">After you receive the message in the caller orchestration, initialize the correlation set, and then pass the correlation set and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="2cb77-114">传入的端口将变为调用的业务流程中的发送端口，并且将来将消息发送回调用方业务流程与同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-114">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2. <span data-ttu-id="2cb77-115">调用的业务流程，在发送回调用方业务流程通过自相关端口的消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-115">In the invoked orchestration, send a message back to the caller orchestration through the self-correlating port.</span></span> <span data-ttu-id="2cb77-116">这与调用方业务流程以避免出现争用情况并创建到 MessageBox 以路由中调用的业务流程的接收订阅时提供提交点同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-116">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3. <span data-ttu-id="2cb77-117">调用方业务流程接收通过自相关端口的消息，并将与调用的业务流程进行同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-117">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="2cb77-118">请注意，自相关端口接收不需要再指定相关。</span><span class="sxs-lookup"><span data-stu-id="2cb77-118">Note that self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="2cb77-119">现在可以安全地发送消息从调用方业务流程到调用的业务流程，并且调用的业务流程将收到根据相关的消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-119">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
   <span data-ttu-id="2cb77-120">尽管上述方法可以实现目标，更好的方法是传入你想要接收所基于的相关进行初始化的消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-120">Although the preceding approach can achieve the goal, a better approach is to pass in the message that initializes the correlation on which you want to receive upon.</span></span> <span data-ttu-id="2cb77-121">在与通过自相关端口调用的业务流程同步调用方业务流程，我们建议始终传递你需要对相关进行初始化的消息中。</span><span class="sxs-lookup"><span data-stu-id="2cb77-121">When you are synchronizing a caller orchestration with an invoked orchestration through a self-correlating port, we recommend that you always pass in the message that you need for initializing the correlations.</span></span> <span data-ttu-id="2cb77-122">以下步骤提供最可靠、 最高性能方法：</span><span class="sxs-lookup"><span data-stu-id="2cb77-122">The following steps provide the most reliable and highest-performance approach:</span></span>  
  
4. <span data-ttu-id="2cb77-123">在调用方业务流程，你具有某个激活接收以接收消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-123">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="2cb77-124">在收到消息后，消息传递和一个自相关接收直接绑定端口穿过**启动业务流程**形状。</span><span class="sxs-lookup"><span data-stu-id="2cb77-124">After you receive the message, pass a message and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="2cb77-125">您在传入的消息将用于初始化中调用的业务流程相关。</span><span class="sxs-lookup"><span data-stu-id="2cb77-125">The message you pass in will be used to initialize the correlation in the invoked orchestration.</span></span> <span data-ttu-id="2cb77-126">传入的端口将变为调用的业务流程中的发送端口，并且将来将消息发送回调用方业务流程与同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-126">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
5. <span data-ttu-id="2cb77-127">在调用的业务流程，初始化该相关和将消息发送回调用方业务流程。</span><span class="sxs-lookup"><span data-stu-id="2cb77-127">In the invoked orchestration, initialize the correlation and send a message back to the caller orchestration.</span></span> <span data-ttu-id="2cb77-128">这与调用方业务流程以避免出现争用情况并创建到 MessageBox 以路由中调用的业务流程的接收订阅时提供提交点同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-128">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
6. <span data-ttu-id="2cb77-129">调用方业务流程接收通过自相关端口的消息，并将与调用的业务流程进行同步。</span><span class="sxs-lookup"><span data-stu-id="2cb77-129">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="2cb77-130">请注意，自相关端口接收不需要再指定相关。</span><span class="sxs-lookup"><span data-stu-id="2cb77-130">Note that the self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="2cb77-131">现在可以安全地发送消息从调用方业务流程到调用的业务流程，并且调用的业务流程将收到根据相关的消息。</span><span class="sxs-lookup"><span data-stu-id="2cb77-131">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2cb77-132">请参阅</span><span class="sxs-lookup"><span data-stu-id="2cb77-132">See Also</span></span>  
 <span data-ttu-id="2cb77-133">[业务流程中使用的相关性](../core/using-correlations-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="2cb77-133">[Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md) </span></span>  
 [<span data-ttu-id="2cb77-134">如何使用自相关直接绑定端口</span><span class="sxs-lookup"><span data-stu-id="2cb77-134">How to Use Self-Correlating Direct Bound Ports</span></span>](../core/how-to-use-self-correlating-direct-bound-ports.md)