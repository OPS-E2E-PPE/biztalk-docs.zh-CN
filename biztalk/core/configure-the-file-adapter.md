---
title: 配置文件适配器 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- File adapters, configuring
- configuring [File adapters], about configuring File adapters
- configuring [File adapters]
ms.assetid: 1e0c7e20-80f8-469b-b423-34a2b90f9ec3
caps.latest.revision: 13
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 01d2cf8a2423d599e275ad9cc87fa30792b6db8e
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65391414"
---
# <a name="configure-the-file-adapter"></a>配置文件适配器
如何配置文件适配器，阅读提供的安全建议，并查看所需的权限。

您可以创建接收位置和发送端口使用[!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]，或以编程方式。 本主题重点[!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]控制台。 有关以编程方式的步骤，请访问[创建接收位置或以编程方式发送端口](../core/create-the-receive-location-and-send-port-programmatically.md)。

> [!IMPORTANT]
> **从开始[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]** ，可以连接到 Azure 文件共享使用文件适配器。 必须在 BizTalk Server 上装载的 Azure 存储帐户。 [开始使用 Azure 文件存储在 Windows 上](https://docs.microsoft.com/azure/storage/storage-dotnet-how-to-use-files#mount-the-file-share)列出了安装步骤。

## <a name="security-recommendations"></a>安全建议

文件适配器将文件传入和传出 BizTalk Server 从和目录。 建议您遵循这些准则以保护和部署你的环境中的文件适配器：  

-   不打开端口以连接到外围网络中的文件共享。 应在环境中使用文件适配器的高级别信任，诸如 intranet 等。 

-   在接收位置的存放目录设置加强的任意访问控制列表 (DACL)。 例如，必须设置读取、 写入、 删除文件，并删除对文件从其接收位置从其中提取消息，该目录的子文件夹和文件权限，以便只有经过授权的用户可以在此位置中存放消息。  

-   当您使用文件适配器提取关键数据时，建议使用 Internet 协议安全性 (IPSec)。  

## <a name="required-permissions"></a>所需的权限

所选的适配器处理程序的主机实例的安全上下文下运行适配器处理程序。 主机实例使用`Logon`中的属性***主机名*-主机实例属性**在 BizTalk 管理。 这`Logon`帐户必须具有对任何文件夹或共享文件适配器使用的特定权限。

处理程序所使用的主机实例用户帐户需要以下权限。 ✔ 意味着是必需的权限。 空白条目意味着不需要权限。

| 权限 | 接收处理程序 | 发送处理程序 |
| --- | --- | --- |
| 完全控制 | ✔ <br/> 在共享级别 （如果访问文件共享） |  | 
| 遍历文件夹/执行文件 |  | ✔ <br/> 在文件级别 | 
| 列出文件夹/读取数据 | ✔ <br/> 在文件级别 | ✔ <br/> 在文件级别 | 
| 读取属性 | | ✔ <br/> 在文件级别 | 
| 读取扩展的属性 | | ✔ <br/> 在文件级别 | 
| 创建文件/写入数据 | | ✔ <br/> 在文件级别 | 
| 创建文件夹/附加数据 | | ✔ <br/> 在文件级别 | 
| 删除子文件夹和文件 | ✔ <br/> 在文件级别 | ✔ <br/> 在文件级别 | 
| 读取权限 | | ✔ <br/> 在文件级别 | 
| 更改 | | ✔ <br/> 在共享级别 （如果访问文件共享） |

> [!TIP] 
> 在文件级别中，打开**高级权限**上的文件或文件夹，以查看这些权限。

> [!NOTE] 
> 只有一个接收处理程序，可以与关联的每个主机。  

## <a name="configure-the-receive-location"></a>配置接收位置

> [!NOTE]
>  执行以下过程之前，你必须已添加一个单向接收端口。 请参阅[如何创建接收端口](../core/how-to-create-a-receive-port.md)。  

1. 在 BizTalk Server 管理控制台中，依次展开“ [!INCLUDE[btsBizTalkServerAdminConsoleui](../includes/btsbiztalkserveradminconsoleui-md.md)]”、“BizTalk 组” 、“应用程序” ，然后展开要在其下创建接收位置的应用程序。  

2. 在左窗格中，单击**接收端口**节点。 随后，在右窗格中右键单击与现有接收位置关联的接收端口或要与新接收位置关联的接收端口，然后单击“属性” 。  

3. 在左窗格中**接收端口属性**对话框中，选择**接收位置**，并在右窗格中双击现有接收位置或单击**新建**到创建新接收位置。  

4. 在中**接收位置属性**对话框中**传输**部分中，选择**文件**从下拉列表中，键入，然后单击**配置**以配置接收位置的传输属性。  

5. 在中**常规**选项卡上，执行以下操作：  


   |         使用此选项         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      执行的操作                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   |--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   |    **接收文件夹**    | 必需的。 在文件系统上，网络共享中，输入文件夹的路径或文件接收处理程序的 Azure 文件共享读取文件。 可以输入的路径中直接**接收文件夹**文字框中，或选择从文件系统中使用**浏览**按钮。 在浏览文件夹时，您还可以创建新的文件夹使用**建立新文件夹**。<br /><br /> 如果使用 Azure 文件存储共享，请输入`\\yourfilestoragename.file.core.windows.net\yourfilesharename`。 <br /><br />**类型：** String <br/><br/>**注意：** 未设置**接收文件夹**属性设置为使用 NT 分布式文件系统的带符号链接的文件夹。 如果使用 NT 分布式文件系统，你可以仅使用文件夹具有直接网络路径在文件适配器接收位置。 <br /><br /> 有关此属性的限制，请参阅[限制配置文件适配器时](../core/restrictions-when-configuring-the-file-adapter.md)。 <br/><br/>**注意：** URI 发送端口或接收位置不能超过 256 个字符。 |
   |      **文件掩码**       |                                                                                                                                                                                                                                                                                                                                                                         必需的。 指定的文件掩码。 此掩码可以包含标准通配符值"\*"。<br /><br /> **默认值：** \*.xml<br /><br /> **类型：** String<br /><br /> 有关此属性的限制，请参阅[限制配置文件适配器时](../core/restrictions-when-configuring-the-file-adapter.md)。                                                                                                                                                                                                                                                                                                                                                                          |
   |    **公用地址**    |                                                                                                                                                                                                                                                                                                                                指定此位置的公共地址。 BizTalk Server 公开此地址与外部合作伙伴。<br /><br /> 如果未指定此属性，运行时引擎会将其作为替换：<br /><br /> file://\<*接收文件夹*\>/\<*文件掩码*\><br /><br /> 此属性的值需要一个适配器前缀。<br /><br /> **类型：** String<br /><br /> **最小长度：** 0<br /><br /> **最大长度：** 256                                                                                                                                                                                                                                                                                                                                |
   |     **重试次数**      |                                                                                                                                                                                                                                                                                                                                                                                                                指定尝试访问网络共享上的接收位置，如果暂时不可用的次数。<br /><br /> **默认值：** 5<br /><br /> **类型：** Long<br /><br /> **最小值：** 0<br /><br /> **最大值：** MAX_LONG                                                                                                                                                                                                                                                                                                                                                                                                                |
   | **重试间隔 （分钟）** |                                                                                                                                                                                                                                                                                                                                                                                           指定两次尝试访问网络共享上的接收位置，如果暂时不可用之间的重试间隔时间 （以分钟为单位）。<br /><br /> **默认值：** 5 分钟<br /><br /> **类型：** Long<br /><br /> **最小值：** 0<br /><br /> **最大值：** MAX_LONG                                                                                                                                                                                                                                                                                                                                                                                            |


6. 上**身份验证**选项卡上，执行以下操作：  


   |                                 使用此选项                                  |                                                                                                                                                                                                                                                                                   执行的操作                                                                                                                                                                                                                                                                                    |
   |---------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | **主机没有访问网络共享位置时使用这些凭据** |                                                                                                                                                                                                                      仅当使用网络共享或 Azure 文件共享时，才需要。 <br /><br /> **默认值：** False<br /><br /> **类型：** Boolean                                                                                                                                                                                                                      |
   |                               **用户名**                               | 如果使用网络共享，请输入有权访问该共享的用户名。 <br /><br />  如果使用 Azure 文件存储共享，输入你的存储帐户的名称。<br/><br/>**类型：** String <br /><br />**注意：** 如果映射到同一个网络共享的多个接收位置配置了备用凭据，然后必须为所有接收位置都使用相同的凭据。 Windows 不允许您对共享的网络服务器从同一台计算机进行多个连接，如果您尝试使用多个一组凭据。 |
   |                               **密码**                                |                                                                                                                                                          如果使用网络共享，请输入有权访问网络共享的帐户的密码。<br /><br />  如果使用 Azure 文件存储共享，输入存储帐户访问密钥;这是在 Azure 门户中列出。<br /><br /> **类型：** String                                                                                                                                                          |


7. 在中**批处理**选项卡上，执行以下操作：  

   |使用此选项|执行的操作|  
   |--------------|----------------|  
   |**在批处理中的消息数**|指定要在一批中提交的消息最大数量。<br /><br /> **默认值：** 5<br /><br /> **类型：** smallint<br /><br /> **最小值：** 1<br /><br /> **最大值：** 256|  
   |**最大批处理大小 （以字节为单位）**|指定批的最大总字节数。<br /><br /> **默认值：** 102400<br /><br /> **类型：** smallint<br /><br /> **最小值：** 1024<br /><br /> **最大值：** MAX_LONG|  

    文件适配器将批达到的那个值第一次，最大消息数或最大允许字节数限制。  

8. 选择 **确定**。  

9. 输入中的相应值**接收位置属性**对话框来完成接收位置的配置，然后单击**确定**以保存设置。 有关“接收位置属性”  对话框的信息，请参阅 [如何创建接收位置](../core/how-to-create-a-receive-location.md)。  

## <a name="configure-the-send-port"></a>配置发送端口

1.  在 BizTalk Server 管理控制台中，创建新的发送端口或双击某个现有发送端口以对其进行修改。 请参阅[如何创建发送端口](../core/how-to-create-a-send-port2.md)。 配置所有发送端口选项，并指定**文件**有关**类型**选项**传输**一部分**常规**选项卡。  

2.  选择**配置**按钮旁边**类型**。  

3.  在中**常规**选项卡上，执行以下操作：  

    |使用此选项|执行的操作|  
    |--------------|----------------|  
    |**目标位置**|必需的。 文件系统、 公共共享或要写入输出消息的 Azure 文件共享上输入位置的路径。 可以输入的路径中直接**目标位置**，或选择从文件系统中使用**浏览**按钮。 在浏览的文件夹中查找**浏览文件夹**对话框中，您还可以创建一个新文件夹通过单击**建立新文件夹**。<br /><br /> 如果使用 Azure 文件存储共享，请输入`\\yourfilestoragename.file.core.windows.net\yourfilesharename`。<br /><br /> **类型：** String <br /><br />**注意：** URI 发送端口或接收位置不能超过 256 个字符。|  
    |**文件名**|指定的文件发送处理程序写入消息的文件的名称。<br /><br /> 有关对此属性的限制，包括使用宏中的文件名称，请参阅[限制配置文件适配器时](../core/restrictions-when-configuring-the-file-adapter.md)。|  
    |**副本模式**|定义向文件中写入一条消息时要使用的复制模式。 有效值为<br /><br /> **追加。** 如果它存在并且文件的末尾追加一条消息，该文件发送处理程序打开一个文件。 如果文件不存在，则文件发送处理程序将创建一个新文件。<br /><br /> **覆盖**。 如果它存在并且覆盖其内容，该文件发送处理程序打开一个文件。 如果文件不存在，则文件发送处理程序将创建一个新文件。<br /><br /> **创建新的**。 如果文件不存在，则文件发送处理程序创建一个新文件，并向其中写入。 如果该文件已存在，文件发送处理程序报告错误，然后按照发送端口的通用适配器重试逻辑。 这是文件发送处理程序的默认复制模式。|  
    |**允许写入时缓存**|定义是否使用文件系统缓存到文件中写入消息时。<br /><br /> 有效选项为：<br /><br /> **False**不使用文件系统缓存。<br /><br /> **True**使用文件系统缓存。<br /><br /> **默认值：** False**重要：** 此属性设置为 **，则返回 True**可以增加存在潜在数据丢失的风险文件适配器的性能没有断电，并且不是所有数据都写入到磁盘。|  
    |**写入时使用临时文件**|定义是否将输出文件写入到临时文件，然后写操作完成后重命名该文件。 如果启用此选项，则将创建临时文件扩展名**BTS WIP**。<br /><br /> 有效选项为<br /><br /> **True**文件适配器在写入目标文件夹时创建临时文件。<br /><br /> **False**文件适配器在写入目标文件夹时不会创建临时文件。<br /><br /> **默认值：** False**注意：** 此选项才可用**CopyMode**属性设置为值为**新建**|  

4.  上**身份验证**选项卡上，执行以下操作：  

    |使用此选项|执行的操作|  
    |--------------|----------------|  
    |**主机没有访问网络共享位置时使用这些凭据**| 仅当使用网络共享或 Azure 文件共享时，才需要。 <br /><br /> **默认值：** False<br /><br /> **类型：** Boolean|  
    |**用户名**|如果使用网络共享，请输入有权访问该共享的用户名。 <br /><br />  如果使用 Azure 文件存储共享，输入你的存储帐户的名称。<br /><br /> **类型：** String|  
    |**密码**|如果使用网络共享，请输入有权访问网络共享的帐户的密码。<br /><br />  如果使用 Azure 文件存储共享，输入存储帐户访问密钥;这是在 Azure 门户中列出。<br /><br /> **类型：** String|  

5.  选择**确定**以保存设置。  

## <a name="set-the-properties-for-a-dynamic-send-port"></a>设置动态发送端口的属性

 动态发送端口不提供任何传输配置选项在 BizTalk Server 管理控制台中因为预期这些属性，将提供与消息关联的上下文属性。 可以在自定义管道或业务流程中设置这些属性。 若要在业务流程中设置消息配置属性，请执行以下操作：  

-   添加**构造消息**向业务流程的形状。  

-   配置**构造消息**形状以构造新消息。 (例如，Message_2)  

-   添加**消息赋值**形状变为**构造消息**形状。  

-   将代码添加到**消息赋值**形状初始化您构造的消息以及用于设置消息的相应的配置属性。 以下代码将初始化名为 Message_2 的构造的消息**构造消息**形状，然后设置消息的两个配置属性。 在此方案中，Message_1 最初由业务流程接收：  

    ```  
    Message_2=Message_1;  
    Message_2(FILE.CopyMode)= 0; //0=Append  
    Message_2(FILE.AllowCacheOnWrite)= true;  
    Message_2(FILE.UseTempFileOnWrite)= true;  
    ```  


## <a name="configure-the-receive-or-send-handler"></a>配置接收端口或发送处理程序

1.  在 BizTalk Server 管理控制台中，展开**BizTalk Server 管理**，展开**BizTalk 组**，展开**平台设置**，然后单击**适配器**。  

2.  在展开的适配器列表中，单击**文件**、 在右窗格中，右键单击接收或发送你想要配置的处理程序。 选择**属性**。  

3.  在中**主机名**列表中，选择要运行该处理程序的主机。  

4.  单击“确定” 。  

## <a name="more-topics-in-this-section"></a>在本部分中的更多主题

[创建文件接收位置或以编程方式发送端口](../core/create-the-receive-location-and-send-port-programmatically.md)

[文件适配器属性架构和属性](../core/file-adapter-property-schema-and-properties.md)

[配置文件适配器时的限制](../core/restrictions-when-configuring-the-file-adapter.md)

## <a name="see-also"></a>另请参阅

 [用于接收和发送服务器端口](../core/ports-for-the-receive-and-send-servers.md)   
 [最低安全用户权限](../core/minimum-security-user-rights.md)