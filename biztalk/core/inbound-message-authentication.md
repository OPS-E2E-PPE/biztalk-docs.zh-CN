---
title: 入站消息身份验证 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- messages, authenticating
- processing, inbound messages
- messages, inbound
- processing, security
- security, messages
- inbound messages
ms.assetid: 34c06283-667d-4498-8544-dea6e87f276f
caps.latest.revision: 12
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d3b9a7812b7466145a0861112948633dae8442a0
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65332102"
---
# <a name="inbound-message-authentication"></a><span data-ttu-id="63322-102">入站的消息身份验证</span><span class="sxs-lookup"><span data-stu-id="63322-102">Inbound Message Authentication</span></span>
<span data-ttu-id="63322-103">BizTalk Server 能够进行身份验证 （通过证书信息或 Windows 集成的安全性） 的消息的发送方验证消息的发件人的身份。</span><span class="sxs-lookup"><span data-stu-id="63322-103">BizTalk Server can authenticate the sender of a message (either by using the certificate information or Windows integrated security) in order to validate the identity of the sender of the message.</span></span> <span data-ttu-id="63322-104">下图显示了中的安全功能[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]可用于验证入站的消息。</span><span class="sxs-lookup"><span data-stu-id="63322-104">The following figure shows the security features in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] that you can use to authenticate inbound messages.</span></span>  
  
 <span data-ttu-id="63322-105">![入站的消息进行身份验证的安全功能](../core/media/ebiz-plan-secoverview-auth-inbound.gif "ebiz_plan_secoverview_auth_inbound")</span><span class="sxs-lookup"><span data-stu-id="63322-105">![Security features authenticating inbound messages](../core/media/ebiz-plan-secoverview-auth-inbound.gif "ebiz_plan_secoverview_auth_inbound")</span></span>  
<span data-ttu-id="63322-106">BizTalk Server 的安全功能使用入站的消息进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="63322-106">Security features BizTalk Server uses to authenticate inbound messages.</span></span>  
  
 <span data-ttu-id="63322-107">当 BizTalk Server 接收加密和签名消息时，需要以下步骤以确保发送方被识别。</span><span class="sxs-lookup"><span data-stu-id="63322-107">When BizTalk Server receives an encrypted and signed message, it takes the following steps to ensure that the sending party is recognized.</span></span>  
  
1.  <span data-ttu-id="63322-108">当消息到达 BizTalk Server 接收位置时，接收处理程序将尝试获取来自发送流程的发件人 Windows 安全 ID (SSID)。</span><span class="sxs-lookup"><span data-stu-id="63322-108">When a message arrives at a BizTalk Server receive location, the receive handler attempts to obtain the sender's Windows security ID (SSID) from the sending process.</span></span> <span data-ttu-id="63322-109">接收位置将该 ssid 往下游传递，以支持其中侦听器具有已通过身份验证已签名的消息的情况。</span><span class="sxs-lookup"><span data-stu-id="63322-109">The receive location passes the SSID downstream to support cases where the listener has already authenticated a signed message.</span></span> <span data-ttu-id="63322-110">如果客户端证书可获得的信息 （例如通过 BizTalk 消息队列或 HTTP 适配器），BizTalk Server 接收位置可以获取该证书的信息并将其传递进行更高版本上在接收管道中的参与方解析.</span><span class="sxs-lookup"><span data-stu-id="63322-110">If client-side certificate information can be obtained (for example by the BizTalk Message Queuing or HTTP adapter), the BizTalk Server receive location can obtain that certificate information and pass it along for party resolution later on in the receive pipeline.</span></span> <span data-ttu-id="63322-111">如果接收处理程序无法获取 SSID，此字段留空。</span><span class="sxs-lookup"><span data-stu-id="63322-111">If the receive handler cannot obtain the SSID, this field is left blank.</span></span>  
  
     <span data-ttu-id="63322-112">接收处理程序将消息发送到接收管道，其中对消息进行解密、 数字签名进行验证，并参与方解析管道是否参与方解析组件，则会发生。</span><span class="sxs-lookup"><span data-stu-id="63322-112">The receive handler sends the message to the receive pipeline, where the message is decrypted, the digital signature is verified, and the party resolution takes place if the pipeline has a party resolution component.</span></span> <span data-ttu-id="63322-113">如果发件人对传入消息使用签名证书，则 MIME/SMIME 解码器组件将覆盖从适配器获取的任何证书信息。</span><span class="sxs-lookup"><span data-stu-id="63322-113">If the sender used a signing certificate on the incoming message, then the MIME/SMIME decoder component overwrites any certificate information obtained from the adapter.</span></span>  
  
2.  <span data-ttu-id="63322-114">如果发件人加密消息，则 MIME/SMIME 解码器从主机实例服务帐户的个人证书存储中检索的解密证书，并使用私钥对消息进行解密。</span><span class="sxs-lookup"><span data-stu-id="63322-114">If the sender encrypted the message, the MIME/SMIME decoder retrieves the decryption certificate from the personal certificate store for the host instance service account and uses the private key to decrypt the message.</span></span>  
  
     <span data-ttu-id="63322-115">如果发件人对消息进行了签名，则 MIME/SMIME 解码器进行身份验证的数字签名验证篡改、，然后从证书存储检索证书的签名来验证签名的有效负载哈希值。</span><span class="sxs-lookup"><span data-stu-id="63322-115">If the sender signed the message, the MIME/SMIME decoder authenticates the digital signature by verifying the payload hash for signs of tampering, and then retrieving the certificate from the certificate store to verify the signature.</span></span> <span data-ttu-id="63322-116">如果签名者的公钥是消息本身，则 MIME/SMIME 解码器不会从证书存储检索证书，但使用消息中提供的公共密钥。</span><span class="sxs-lookup"><span data-stu-id="63322-116">If the public key of the signer is on the message itself, the MIME/SMIME decoder does not retrieve the certificate from the certificate store, but uses the public key that came with the message.</span></span>  
  
3.  <span data-ttu-id="63322-117">通常情况下，管道中的最后一个处理步骤是参与方解析。</span><span class="sxs-lookup"><span data-stu-id="63322-117">Usually, the final processing step in the pipeline is party resolution.</span></span> <span data-ttu-id="63322-118">使用 BizTalk 浏览器或 BizTalk Server 管理控制台中，可以创建参与方、 将参与方映射到一个签名证书，或创建参与方别名。</span><span class="sxs-lookup"><span data-stu-id="63322-118">Using BizTalk Explorer or BizTalk Server Administration console, you can create parties, map the party to a signing certificate, or create party aliases.</span></span> <span data-ttu-id="63322-119">在 BizTalk 浏览器中定义的所有参与方具有唯一的参与方标识符 (PID)。</span><span class="sxs-lookup"><span data-stu-id="63322-119">All parties you define in BizTalk Explorer have a unique party identifier (PID).</span></span> <span data-ttu-id="63322-120">BizTalk Server 获取该 PID，并将其放在消息上下文中。</span><span class="sxs-lookup"><span data-stu-id="63322-120">BizTalk Server obtains the PID and places it in the message context.</span></span> <span data-ttu-id="63322-121">BizTalk 通过以下方法之一获取 PID:</span><span class="sxs-lookup"><span data-stu-id="63322-121">BizTalk obtains the PID by one of the following methods:</span></span>  
  
    1.  <span data-ttu-id="63322-122">如果发件人签名消息，或者如果接收处理程序无法获取客户端证书，并选择选项以使用证书解析参与方，BizTalk 会使用相应的签名或查找到的客户端证书PID。</span><span class="sxs-lookup"><span data-stu-id="63322-122">If the sender signed the message or if the receive handler was able to obtain a client-side certificate, and you selected the option to resolve the party by using the certificate, then BizTalk uses the corresponding signature or client-side certificate to lookup the PID.</span></span> <span data-ttu-id="63322-123">在开始接收消息之前，必须配置与证书作为属性的参与方。</span><span class="sxs-lookup"><span data-stu-id="63322-123">You must configure the party with the certificate as a property before you start receiving its messages.</span></span> <span data-ttu-id="63322-124">有关详细信息配置参与方，请参阅[使用证书进行参与方解析](../core/using-certificates-for-party-resolution.md)。</span><span class="sxs-lookup"><span data-stu-id="63322-124">For more information how to configure the party, see [Using Certificates for Party Resolution](../core/using-certificates-for-party-resolution.md).</span></span>  
  
    2.  <span data-ttu-id="63322-125">如果发件人未在消息中，使用签名证书，选择选项使用发件人的安全 ID (SSID) 来解析参与方的参与方解析组件会使用 SSID 来查找 PID。</span><span class="sxs-lookup"><span data-stu-id="63322-125">If the sender did not use a signing certificate on the message, and you have selected the option to resolve the party by using the Sender's Security ID (SSID), the party resolution component uses the SSID to look up the PID.</span></span> <span data-ttu-id="63322-126">必须配置为使用 SSID 作为别名之前开始接收消息, 的参与方。</span><span class="sxs-lookup"><span data-stu-id="63322-126">You must configure the party to use the SSID as an alias before you start receiving its messages.</span></span> <span data-ttu-id="63322-127">有关参与方解析组件的详细信息，请参阅[参与方解析管道组件](../core/party-resolution-pipeline-component.md)。</span><span class="sxs-lookup"><span data-stu-id="63322-127">For more information about the party resolution component, see [Party Resolution Pipeline Component](../core/party-resolution-pipeline-component.md).</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="63322-128">定义参与方别名时，BizTalk Server 使用的帐户名而不是实际的 Windows SID。</span><span class="sxs-lookup"><span data-stu-id="63322-128">BizTalk Server uses the account name rather than the actual Windows SID when defining aliases for parties.</span></span>  
  
    3.  <span data-ttu-id="63322-129">如果无法解析的参与方，管道会将 PID 设置为来宾。</span><span class="sxs-lookup"><span data-stu-id="63322-129">If the party cannot be resolved, the pipeline sets the PID to Guest.</span></span>  
  
4.  <span data-ttu-id="63322-130">如果接收端口标记为必需的身份验证，并 BizTalk Server 获取了有效 PID 并将其解析的已知参与方时，将该消息会然后排队到 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="63322-130">If you marked the receive port as Authentication Required, and BizTalk Server obtained a valid PID and resolved it to a known party, the message is then queued to the MessageBox database.</span></span> <span data-ttu-id="63322-131">如果 SSID 为空或者 PID 是来宾 ID，BizTalk Server 将丢弃该消息，或将其发送到挂起队列 （具体取决于你的配置所需的身份验证属性）。</span><span class="sxs-lookup"><span data-stu-id="63322-131">If the SSID is blank or the PID is a guest ID, BizTalk Server either discards the message or sends it to the suspended queue (depending on your configuration of the Authentication Required property).</span></span> <span data-ttu-id="63322-132">作为一种方法从未知参与方接收大量消息的负面影响降至最低，可以使用所需的身份验证属性。</span><span class="sxs-lookup"><span data-stu-id="63322-132">You can use the Authentication Required property as a way of minimizing the negative effect of receiving a large quantity of messages from an unknown party.</span></span> <span data-ttu-id="63322-133">有关接收端口的身份验证选项的详细信息，请参阅[如何配置接收端口的身份验证选项](../core/how-to-configure-authentication-options-for-a-receive-port.md)。</span><span class="sxs-lookup"><span data-stu-id="63322-133">For more information about the authentication options for receive ports, see [How to Configure Authentication Options for a Receive Port](../core/how-to-configure-authentication-options-for-a-receive-port.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="63322-134">请参阅</span><span class="sxs-lookup"><span data-stu-id="63322-134">See Also</span></span>  
 <span data-ttu-id="63322-135">[进程间的消息身份验证](../core/authentication-of-messages-between-processes.md) </span><span class="sxs-lookup"><span data-stu-id="63322-135">[Authentication of Messages Between Processes](../core/authentication-of-messages-between-processes.md) </span></span>  
 <span data-ttu-id="63322-136">[出站消息保护](../core/outbound-message-protection.md) </span><span class="sxs-lookup"><span data-stu-id="63322-136">[Outbound Message Protection](../core/outbound-message-protection.md) </span></span>  
 <span data-ttu-id="63322-137">[对消息的发件人进行身份验证](../core/authenticating-the-sender-of-a-message.md) </span><span class="sxs-lookup"><span data-stu-id="63322-137">[Authenticating the Sender of a Message](../core/authenticating-the-sender-of-a-message.md) </span></span>  
 <span data-ttu-id="63322-138">[向消息收件人授权](../core/authorizing-the-receiver-of-a-message.md) </span><span class="sxs-lookup"><span data-stu-id="63322-138">[Authorizing the Receiver of a Message](../core/authorizing-the-receiver-of-a-message.md) </span></span>  
 <span data-ttu-id="63322-139">[如何配置 BizTalk Server 以便接收签名消息](../core/how-to-configure-biztalk-server-for-receiving-signed-messages.md) </span><span class="sxs-lookup"><span data-stu-id="63322-139">[How to Configure BizTalk Server for Receiving Signed Messages](../core/how-to-configure-biztalk-server-for-receiving-signed-messages.md) </span></span>  
 [<span data-ttu-id="63322-140">BizTalk Server 用于签名消息的证书</span><span class="sxs-lookup"><span data-stu-id="63322-140">Certificates that BizTalk Server Uses for Signed Messages</span></span>](../core/certificates-that-biztalk-server-uses-for-signed-messages.md)