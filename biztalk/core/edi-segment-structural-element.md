---
title: EDI 段结构元素 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 1f474a3d-004a-4981-b155-b0a5775918ba
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e1afe63e8830166c388a8d1ffc65782b6a473aa9
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65389183"
---
# <a name="edi-segment-structural-element"></a>EDI 段结构元素
段包含一个或多个数据元素，且是消息中的信息的中间单元。 每个段以三个字符的数据段标识符开头和结尾段终止符 （默认情况下为撇号 （'））。 在段中的数据元素由数据元素分隔符分隔。 数据元素分隔符为加号 （+） 默认情况下。 一个段归类为必需或可选。 可以在两个贸易合作伙伴之间或后备贸易合作伙伴协议的一部分的协议设置用于传出交换的分隔符。  
  
## <a name="nesting"></a>嵌套  
 可能会在名为层次结构关系中分组段**嵌套**。 有两个不同类型的嵌套： 显式和隐式。 任何一个交换中可以使用只有一个类型的嵌套。  
  
-   显式嵌套使用显式指示循环嵌套。 使用显式嵌套时，段标记中的第一个组件数据元素将为段代码。 它将遵循的条件组件数据元素，该值指示的级别和血小板减少症的段的重复。 用于此目的的组件数据元素的数目取决于在这段出现在消息结构的层次结构级别。 如果段将出现在级别一，会使用紧跟在段代码的组件数据元素。 如果段将出现在级别二，紧跟在段代码和下一个组件数据元素的组件数据元素将同时使用。 如果段将出现在级别三，将使用段代码之后的三个组件数据元素。 管道不能执行将数据与层次结构比较的结构验证。  
  
-   在隐式嵌套严格遵循在消息结构中指定的段的顺序。 段之间的嵌套关系是隐式，处理所需的任何进一步的迹象。  
  
## <a name="loops"></a>循环  
 一个或多个段可以作为重复**循环**事务内设置。 有两个不同类型的循环： 未绑定和绑定。  
  
### <a name="unbounded-loops"></a>未绑定的循环  
 未绑定的循环不具有唯一标识段标记的开头和结尾的循环。 未绑定的循环按照计数进行重复。 如果计数没有值，则循环将重复两次。 循环中的每个段可以一次出现在指定的顺序。  
  
 未绑定循环的开头都是唯一的第一个数据元素即可建立。 第一个元素可以出现一次且只有一次，在每个匹配项。 未绑定的循环可以嵌套在循环;如果是，内部未绑定的循环不能在与任何外部循环相同的序号位置处开始，并且不能以与任何外部循环相同的段 ID 开头。 嵌套的循环不能包含也是同一嵌套结构中任何外部循环的起始段的段。  
  
### <a name="bounded-loops"></a>绑定的循环  
 一个绑定的循环预定义的段 LS （循环开始） 开始和结束的预定义的段 LE （循环结束）。 LS 段的可选性必须与匹配的循环中的第一个段。 一个绑定的循环可以包含另一个绑定的循环。  
  
> [!NOTE]
>  一个绑定的循环在 X12 和 EDIFACT 中的显式循环是等效的。  
  
 在循环中使用绑定来解决二义性。 LS/LE 段上的要求指示符与循环的第一个段的要求指示符相匹配。 绑定会放松对某些经常重复段的使用情况结构限制。 绑定的段具有起始段 ID 没有限制。 这使同一段在启动绑定的循环和用于外部循环中，如以下示例所示：  
  
```  
AA  
LS  
BB  
CC  
LE  
BB  
```  
  
 允许存在从属循环 （循环内的循环）。 如果绑定的循环循环内进行嵌套，内部循环不能在与任何外部循环相同的序号位置处开始。 内部绑定的循环必须在相邻的外部循环之前结束。  
  
 事务集内的每个绑定的循环必须具有唯一定义 < 也 > 值的一至四个大写字母或数字组成。 建议对应的 LS 和 LE 段包含相同的唯一 < 也 > 值。 < 也 > 数据元素将其作为"常规"数据元素进行处理和验证数据类型、 最小/最大长度、 可选性等。将不执行跨段 （跨越 LS 和 LE） 验证。BizTalk Server 将验证模糊解析通过是否存在 LS 和 LE 段而不是其他。 对于数据元素规则发生冲突，但出现错误，接受的事务集和 BizTalk Server 返回 AK501 = E 和 AK2/AK3 确认中的相应评估  
  
 它也是所需的 LS/LE 段配对强制执行。 如果不匹配的事务集被拒绝由于存在内在的模糊解析问题和 AK501 = E 和 AK502 = 5 会返回到事件查看器和 997 确认。 事务集在一个或两个 LS/LE 段缺失，但事务集不是不明确，将接受存在错误和 AK501 = E 和 AK502 = 5 返回。  
  
 LS/LE 对可以是可选或必需。 但是，除非该对包含可重复的父循环中，对可以永远不会是可重复。 在任一情况下，LS/LE 对的 MaxOccurs 可为 1，但不能大于 1，这强制要求在架构验证。  
  
 EDI 拆装器和 EDI 组装器处理 LS 和 LE 段。 分析过程中，拆装器创建的 XML 节点的 LS 和 LE 段，并验证段。 在过程中进行序列化，则组装器将创建 LS 和 LE 段从 XML 节点，并对其进行验证。 如果所需的 LS 或 LE 段缺失，事务集被挂起/拒绝 AK501 = E 和 AK502 = 5。 如果 LS/LE 段存在不带相应数据元素，并且启用 EDI 验证，并出现错误和 AK501 接受的事务集 = E 和 AK502 = 5 会报告在事件查看器和 997 确认。