---
title: BizTalk Server 消息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- messages, properties
- messages, about messages
ms.assetid: 6048c191-b495-4fdc-b547-e3e322340a49
caps.latest.revision: 17
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3d59978b4c54e4245b79fb04cbb02546af8ad795
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36997614"
---
# <a name="the-biztalk-server-message"></a><span data-ttu-id="f0f14-102">BizTalk Server 消息</span><span class="sxs-lookup"><span data-stu-id="f0f14-102">The BizTalk Server Message</span></span>
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="f0f14-103"> 本质上是一个消息处理引擎。</span><span class="sxs-lookup"><span data-stu-id="f0f14-103"> is, at its core, a message-handling engine.</span></span> <span data-ttu-id="f0f14-104">若要了解 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 的详细信息，则必须先了解消息以及 BizTalk Server 将如何表示、存储和处理消息。</span><span class="sxs-lookup"><span data-stu-id="f0f14-104">To understand the details of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], it is important to understand messages and how they are represented, stored, and processed by BizTalk Server.</span></span> <span data-ttu-id="f0f14-105">对消息概念的理解将有助于了解 BizTalk Server 处理消息的方式的具体信息。</span><span class="sxs-lookup"><span data-stu-id="f0f14-105">The details of how BizTalk Server works with messages become easier to understand after you have gained an understanding of what a message is.</span></span>  
  
 <span data-ttu-id="f0f14-106">BizTalk Server 中的每条消息都可视为多部分消息，此类消息可以由零个或多个部分组成。</span><span class="sxs-lookup"><span data-stu-id="f0f14-106">Each message in BizTalk Server is considered a multi-part message and is made up of zero or more parts.</span></span> <span data-ttu-id="f0f14-107">具有一个或多个部分的消息都具有一个标识为正文部分的部分。</span><span class="sxs-lookup"><span data-stu-id="f0f14-107">Each message with one or more parts has one of these parts identified as the body part.</span></span> <span data-ttu-id="f0f14-108">每个部分均由可表示 XML 文档、平面文件、序列化的 .NET 类或其他二进制数据流的二进制数据块组成。</span><span class="sxs-lookup"><span data-stu-id="f0f14-108">Each part consists of a binary chunk of data which can represent an XML document, a flat file, a serialized .NET class, or other binary stream of data.</span></span> <span data-ttu-id="f0f14-109">您可以使用消息的正文部分来标识可用于路由的消息类型。</span><span class="sxs-lookup"><span data-stu-id="f0f14-109">You use the body part of the message to identify the type of the message that can be used for routing.</span></span>  
  
 <span data-ttu-id="f0f14-110">此处，您需要了解一个非常重要的概念，即，所有消息在 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 中都是不可改变的。</span><span class="sxs-lookup"><span data-stu-id="f0f14-110">A very important concept to understand is that all messages are immutable in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="f0f14-111">这意味着，消息构造完成后，就不能再对其执行更改操作了。</span><span class="sxs-lookup"><span data-stu-id="f0f14-111">This means that after a message is constructed, it cannot be changed.</span></span> <span data-ttu-id="f0f14-112">将消息放入 MessageBox 数据库后，即可认为对消息的构造已完成。</span><span class="sxs-lookup"><span data-stu-id="f0f14-112">A message is considered constructed after it is placed into the MessageBox database.</span></span> <span data-ttu-id="f0f14-113">若要对此类消息进行任何更改，则需要创建一条新消息，并从该点开始使用新的消息。</span><span class="sxs-lookup"><span data-stu-id="f0f14-113">Any changes to the message require that a new message is created and used from that point forward.</span></span> <span data-ttu-id="f0f14-114">这一点在业务流程设计器中表现的尤为清楚，在该设计器中，编译规则将强制您在使用消息前严格遵守有关构造消息的准则，并且不允许在消息的构造块之外对该消息进行更改。</span><span class="sxs-lookup"><span data-stu-id="f0f14-114">This is especially clear in the Orchestration Designer, where compilation rules force you to follow strict guidelines about constructing a message before using it, and do not allow the message to be altered outside of its construction block.</span></span> <span data-ttu-id="f0f14-115">若要更改消息，则必须创建一个可创建同一类型消息的构造块，将原始消息复制到新消息中，然后在关闭该构造块之前对新消息执行所需的更改。</span><span class="sxs-lookup"><span data-stu-id="f0f14-115">If you need to change the message, you must create a new construction block that creates a message of the same type, copy the original message to the new message, and then make any changes to the new message before leaving the construction block.</span></span>  
  
## <a name="message-properties"></a><span data-ttu-id="f0f14-116">消息属性</span><span class="sxs-lookup"><span data-stu-id="f0f14-116">Message Properties</span></span>  
 <span data-ttu-id="f0f14-117">除了组成消息的部分，在系统中的每个消息具有一组与它一起进入所谓的属性*消息上下文*。</span><span class="sxs-lookup"><span data-stu-id="f0f14-117">In addition to the parts that make up a message, each message in the system has a set of properties that go along with it in what is known as the *message context*.</span></span> <span data-ttu-id="f0f14-118">这些属性的值是从消息本身提取或与消息本身相关的值。</span><span class="sxs-lookup"><span data-stu-id="f0f14-118">These properties can be values extracted from or related to the message itself.</span></span> <span data-ttu-id="f0f14-119">例如，适配器将属性放入与消息接收操作相关的上下文中，例如接收消息的位置和用于接收消息的适配器类型。</span><span class="sxs-lookup"><span data-stu-id="f0f14-119">For example, adapters put properties into the context related to the receiving of a message, such as the location at which the message was received, and the type of adapter that was used to receive the message.</span></span> <span data-ttu-id="f0f14-120">属性既可以写入到上下文，或*提升*到上下文。</span><span class="sxs-lookup"><span data-stu-id="f0f14-120">Properties can either be written to the context, or *promoted* into the context.</span></span> <span data-ttu-id="f0f14-121">这两个选项之间的区别在于：升级的属性可用作消息路由中的条件，而写入的属性则不能。</span><span class="sxs-lookup"><span data-stu-id="f0f14-121">The difference between these two options is that promoted properties can be used as criteria in message routing while written properties cannot.</span></span>  
  
 <span data-ttu-id="f0f14-122">将值写入或升级到上下文中的概念与 BizTalk 编辑器中的升级属性相关，但不完全相同。</span><span class="sxs-lookup"><span data-stu-id="f0f14-122">This concept of writing or promoting values to the context is related to, but not the same as, promoting properties in the BizTalk Editor.</span></span> <span data-ttu-id="f0f14-123">在 BizTalk 编辑器中，架构中的元素和属性可以标记为升级属性或可分辨字段。</span><span class="sxs-lookup"><span data-stu-id="f0f14-123">In the BizTalk Editor, an element or attribute in a schema can be flagged as a promoted property or a distinguished field.</span></span> <span data-ttu-id="f0f14-124">如果消息架构中包含标记有 PropertyField 批注的项，则将导致管道拆装器将升级的属性放入上下文中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-124">Items that are marked with PropertyField annotations in your message schema will lead to the pipeline disassembler putting a Promoted property in the context.</span></span> <span data-ttu-id="f0f14-125">如果消息架构中包含标记有 DistinguishedField 批注的项，则将导致管道拆装器将写入的属性放入上下文中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-125">Items that are marked with DistinguishedField annotations in your message schema will lead to the pipeline disassembler putting a Written property into the context.</span></span>  
  
 <span data-ttu-id="f0f14-126">升级的属性的设计入门的设计*消息相关*: 相关联将要接收到已在运行的业务流程实例的消息的功能。</span><span class="sxs-lookup"><span data-stu-id="f0f14-126">The design for promoted properties started with the design of *message correlation*: the ability to relate a message being received to an already running orchestration instance.</span></span> <span data-ttu-id="f0f14-127">对于相关，需要定义一个或一组用于提供业务流程中消息间的链接的属性。</span><span class="sxs-lookup"><span data-stu-id="f0f14-127">For correlation, there is a need to define a property or set of properties that provide the link between messages in the orchestration.</span></span> <span data-ttu-id="f0f14-128">例如，在采购流程中，您需要根据 PurchaseOrderID 来关联消息。</span><span class="sxs-lookup"><span data-stu-id="f0f14-128">For example, in a purchasing process, you need to correlate messages based on the PurchaseOrderID.</span></span> <span data-ttu-id="f0f14-129">但是，在许多业务案例中，消息中的特定字段或属性的名称可能会不匹配。</span><span class="sxs-lookup"><span data-stu-id="f0f14-129">However, in many business cases, the name of the particular field or attribute in the messages may not match.</span></span> <span data-ttu-id="f0f14-130">采购订单架构中可能存在一个名为 POId 的元素，但辅助发票架构则有一个名为 OrderID 的元素。</span><span class="sxs-lookup"><span data-stu-id="f0f14-130">A purchase order schema might have an element named POId, while the companion invoice schema may have an element named OrderID.</span></span> <span data-ttu-id="f0f14-131">在这种情况下，若要关联已命名属性（例如 PurchaseOrderID）上的消息，则开发人员必须能够从值的源中提取出要进行关联的属性名称。</span><span class="sxs-lookup"><span data-stu-id="f0f14-131">To correlate messages on a named property such as PurchaseOrderID in this situation, the developer must be able to abstract the name of the property to be correlated on from the source of the value.</span></span> <span data-ttu-id="f0f14-132">属性架构支持此类提取操作。</span><span class="sxs-lookup"><span data-stu-id="f0f14-132">Property schemas support this abstraction.</span></span>  
  
 <span data-ttu-id="f0f14-133">一个*属性架构*使您能够在共同位置定义升级的属性并将它们引用的其他架构。</span><span class="sxs-lookup"><span data-stu-id="f0f14-133">A *property schema* enables you to define promoted properties in a common location and have them referenced by other schemas.</span></span> <span data-ttu-id="f0f14-134">与其他架构相似，属性架构也具有命名空间，但不同的是，属性架构只有定义的元素（即，没有记录和属性）。</span><span class="sxs-lookup"><span data-stu-id="f0f14-134">Like other schemas, a property schema has a namespace, but unlike other schemas, it can only have defined elements (that is, not records or attributes).</span></span> <span data-ttu-id="f0f14-135">在属性架构中定义的每个元素都具有名称和类型。</span><span class="sxs-lookup"><span data-stu-id="f0f14-135">Each element that is defined in the property schema has a name and type.</span></span> <span data-ttu-id="f0f14-136">由于可能有多个架构引用属性架构，并且由于在运行时属性架构中的信息必须对组件可用，因此与所有其他架构一样，属性架构也必须部署到 BizTalk Server 中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-136">Because the property schema may need to be referenced by more than one schema, and because the information in the property schema must be available to components at runtime, the property schema must get deployed to BizTalk Server like all other schemas.</span></span> <span data-ttu-id="f0f14-137">除了正常架构部署步骤之外，还必须提取有关升级属性的信息并将其存储在管理数据库的 bts_documentSpec 表中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-137">In addition to the normal schema deployment steps, information about the promoted properties is extracted and stored in the bts_documentSpec table in the Management database.</span></span>  
  
 <span data-ttu-id="f0f14-138">创建属性架构后，元素和属性具有相同类型 （例如。</span><span class="sxs-lookup"><span data-stu-id="f0f14-138">After a property schema has been created, elements and attributes with the same type (for example.</span></span> <span data-ttu-id="f0f14-139">整数） 可以升级为属性架构中的命名属性之一。</span><span class="sxs-lookup"><span data-stu-id="f0f14-139">integer) can be promoted as one of the named properties in the property schema.</span></span>  
  
 <span data-ttu-id="f0f14-140">**若要完成从上面的示例用例，开发人员会执行以下步骤来定义相关的所需的共享的属性。**</span><span class="sxs-lookup"><span data-stu-id="f0f14-140">**To complete the example case from above, a developer would perform the following steps to define the shared property needed for correlation.**</span></span>  
  
1. <span data-ttu-id="f0f14-141">创建属性架构并定义一个 xs:int 类型的元素，名为 PurchaseOrderId。</span><span class="sxs-lookup"><span data-stu-id="f0f14-141">Create a property schema and define an element of type xs:int named PurchaseOrderId.</span></span>  
  
2. <span data-ttu-id="f0f14-142">创建 PurchaseOrder 架构并添加一个 xs:int 类型的元素，名为 POId。</span><span class="sxs-lookup"><span data-stu-id="f0f14-142">Create a PurchaseOrder schema and add an element or attribute of type xs:int named POId.</span></span>  
  
3. <span data-ttu-id="f0f14-143">通过在 BizTalk 编辑器中使用显示升级命令，开发人员可将 POId 字段添加到升级属性列表中，并通过从该列表中选择已命名属性 PurchaseOrderId 来指明应将其升级为属性架构中定义的 PurchaseOrderId 属性。</span><span class="sxs-lookup"><span data-stu-id="f0f14-143">Using the show promotions command in the BizTalk Editor, the developer adds the POId field to the list of promoted properties and indicates that it should be promoted as the PurchaseOrderId property defined in the property schema by selecting the PurchaseOrderId named property from the list.</span></span>  
  
4. <span data-ttu-id="f0f14-144">创建发票架构并添加元素或类型 xs: int 名为 OrderId 的属性。</span><span class="sxs-lookup"><span data-stu-id="f0f14-144">Create an Invoice schema and add an element or attribute of type xs:int named OrderId.</span></span>  
  
5. <span data-ttu-id="f0f14-145">通过在 BizTalk 编辑器中使用显示升级命令，开发人员可将 OrderId 字段添加到升级属性列表中，并通过从该列表中选择已命名属性 PurchaseOrderId 来指明应将其升级为属性架构中定义的 PurchaseOrderId 属性。</span><span class="sxs-lookup"><span data-stu-id="f0f14-145">Using the show promotions command in the BizTalk Editor, the developer adds the OrderId field to the list of promoted properties and indicates that it should be promoted as the PurchaseOrderId property defined in the property schema by selecting the PurchaseOrderId named property from the list.</span></span>  
  
   <span data-ttu-id="f0f14-146">既然此定义已存在于文档架构中，管道组件就可以正确地将 OrderId 和 POId 升级为已命名属性 PurchaseOrderID，以便该属性用于路由和相关。</span><span class="sxs-lookup"><span data-stu-id="f0f14-146">Now that this definition exists in the document schemas, pipeline components can properly promote OrderId and POId as the named property PurchaseOrderID so that it can be used for routing and correlation.</span></span> <span data-ttu-id="f0f14-147">有关此升级过程的详细信息，请参阅本文档中的“消息处理”主题。</span><span class="sxs-lookup"><span data-stu-id="f0f14-147">For more details on this promotion process, see the topic "Message Processing" in this document.</span></span>  
  
   <span data-ttu-id="f0f14-148">升级属性的优点之一为已升级的元素值可用于消息上下文中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-148">One of the benefits of promoted properties is that the value of the element that is promoted is available in the context of the message.</span></span> <span data-ttu-id="f0f14-149">这意味着检索该值将非常方便，因为您无需将消息加载到内存中就可以对该消息执行 XPath 语句。</span><span class="sxs-lookup"><span data-stu-id="f0f14-149">This means that retrieving that value is inexpensive, as it does not require loading the message into memory to execute an XPath statement on the message.</span></span> <span data-ttu-id="f0f14-150">实际上，简单属性包可与键结合使用以获取该值。</span><span class="sxs-lookup"><span data-stu-id="f0f14-150">Instead, a simple property bag can be used along with a key to get the value.</span></span> <span data-ttu-id="f0f14-151">在非消息路由的情况下需要此类操作，并且，此类操作也是创建可分辨字段的原因。</span><span class="sxs-lookup"><span data-stu-id="f0f14-151">This type of behavior is desirable in situations other than message routing and is the reason for creating distinguished fields.</span></span> <span data-ttu-id="f0f14-152">升级属性是升级到消息上下文中的，而可分辨字段是写入到消息上下文中的。</span><span class="sxs-lookup"><span data-stu-id="f0f14-152">While promoted properties are promoted into the message context, distinguished fields are written into the message context.</span></span> <span data-ttu-id="f0f14-153">但是，与升级属性不同，可分辨字段没有属性架构。</span><span class="sxs-lookup"><span data-stu-id="f0f14-153">Unlike promoted properties however, there is no property schema for distinguished fields.</span></span> <span data-ttu-id="f0f14-154">这就是可分辨字段无法用于路由的原因，因而在发送端口或业务流程接收形状中该字段也不能用作筛选条件。</span><span class="sxs-lookup"><span data-stu-id="f0f14-154">This is why distinguished fields cannot be used for routing and are therefore not available as filter criteria in a send port or orchestration receive shape.</span></span> <span data-ttu-id="f0f14-155">但是，在业务流程中可分辨字段可用于在消息上下文中读取或写入值，而无需将消息加载到内存中和对值执行提取操作。</span><span class="sxs-lookup"><span data-stu-id="f0f14-155">Distinguished fields can, however, be used in orchestrations to read or write values from the message context instead of having to load the message into memory and extract the value.</span></span>  
  
   <span data-ttu-id="f0f14-156">除了可以将属性升级或写入到消息上下文，还可将消息谓词添加到消息上下文中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-156">In addition to promoting or writing properties into the message context, message predicates can also be added to the context.</span></span> <span data-ttu-id="f0f14-157">消息谓词在 BizTalk Server 中可用作安全措施，并且提供有关消息的上下文信息，这些消息谓词必须与为消息要路由到的任何主机指定的值相匹配。</span><span class="sxs-lookup"><span data-stu-id="f0f14-157">Message predicates are used as a security measure in BizTalk Server and provide contextual information about the message, which must match values specified for any host that the message is to be routed to.</span></span> <span data-ttu-id="f0f14-158">通过此安全措施，您可以按以下方式来配置 BizTalk Server 环境：允许特定主机作为可接收和处理特定消息的唯一主机。</span><span class="sxs-lookup"><span data-stu-id="f0f14-158">This security measure allows you to configure your BizTalk Server environment in such a way as to allow specific hosts to be the only hosts that can receive and process particular messages.</span></span> <span data-ttu-id="f0f14-159">例如，在 BizTalk Server 管理控制台中，使用用于进行消息解码和解密的指纹证书配置主机。</span><span class="sxs-lookup"><span data-stu-id="f0f14-159">As an example, in the BizTalk Server Administration Console, a host can be configured with the thumbprint of a certificate to use for message decoding and decryption.</span></span> <span data-ttu-id="f0f14-160">配置此属性可在 MessageBox 中为该主机创建应用程序属性。</span><span class="sxs-lookup"><span data-stu-id="f0f14-160">Configuring this property creates an application property for that host in the MessageBox.</span></span> <span data-ttu-id="f0f14-161">然后，使用此指纹接收和解密的安全消息只能路由到配置了该指纹的主机中。</span><span class="sxs-lookup"><span data-stu-id="f0f14-161">Secure messages that are received and decrypted using this thumbprint are then only routed to the hosts with the thumbprint configured.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f0f14-162">请参阅</span><span class="sxs-lookup"><span data-stu-id="f0f14-162">See Also</span></span>  
 [<span data-ttu-id="f0f14-163">运行时体系结构</span><span class="sxs-lookup"><span data-stu-id="f0f14-163">Runtime Architecture</span></span>](../core/runtime-architecture.md)