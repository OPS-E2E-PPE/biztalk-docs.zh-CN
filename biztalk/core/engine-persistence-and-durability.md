---
title: 引擎持久性和持续性 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 929047264eb395636ee7d2a5793642f12ac7e5e4
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65349400"
---
# <a name="engine-persistence-and-durability"></a><span data-ttu-id="b54b9-102">引擎持久性和持续性</span><span class="sxs-lookup"><span data-stu-id="b54b9-102">Engine Persistence and Durability</span></span>
<span data-ttu-id="b54b9-103">本部分说明 BizTalk Server 如何可靠地集成松散耦合的业务流程通过将流程状态保存到磁盘通过 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="b54b9-103">This section explains how BizTalk Server reliably integrates loosely coupled business processes by persisting process state to disk via SQL Server.</span></span> <span data-ttu-id="b54b9-104">在适当时间，利用事务保持状态的系统可保证任何流程状态是甚至发生硬件或软件发生故障时丢失。</span><span class="sxs-lookup"><span data-stu-id="b54b9-104">By persisting state at appropriate times, leveraging transactions, the system guarantees that no process state is lost even in the event of a hardware or software outage.</span></span> <span data-ttu-id="b54b9-105">这称为系统持久性。</span><span class="sxs-lookup"><span data-stu-id="b54b9-105">This is referred to as system durability.</span></span>  
  
## <a name="loosely-coupled-business-process-management"></a><span data-ttu-id="b54b9-106">松散耦合的业务流程管理</span><span class="sxs-lookup"><span data-stu-id="b54b9-106">Loosely Coupled Business Process Management</span></span>  
 <span data-ttu-id="b54b9-107">集成现有系统以执行单个逻辑业务流程需要现有系统外对流程状态的管理。</span><span class="sxs-lookup"><span data-stu-id="b54b9-107">Integrating existing systems to perform a single logical business process requires management of process state outside of the existing systems.</span></span> <span data-ttu-id="b54b9-108">业务流程是长时间运行或短生存期，必须保持独立进程状态以避免产生的系统紧密连接在一起的自定义通信路径的爆炸式增长。</span><span class="sxs-lookup"><span data-stu-id="b54b9-108">Whether the business process is long running or short lived, process state must be maintained independently in order to avoid the explosion of custom communications paths that result from tightly coupling systems together.</span></span>  
  
 <span data-ttu-id="b54b9-109">很明显，正在运行的状态必须是可靠如果业务流程非常关键的业务流程实例。</span><span class="sxs-lookup"><span data-stu-id="b54b9-109">Clearly, the state of a running business process instance must be reliable if the business process is mission critical.</span></span> <span data-ttu-id="b54b9-110">若要确保业务流程具有可靠性和持久性，BizTalk 利用 SQL Server 事务将保留处理到称为 MessageBox 数据库的数据库中的磁盘的状态和业务数据。</span><span class="sxs-lookup"><span data-stu-id="b54b9-110">To assure that business processes are reliable and durable, BizTalk leverages SQL Server transactions to persist process state and business data to disk in a database known as the MessageBox database.</span></span> <span data-ttu-id="b54b9-111">有关 MessageBox 数据库的详细信息，请参阅[MessageBox 数据库](../core/the-messagebox-database.md)。</span><span class="sxs-lookup"><span data-stu-id="b54b9-111">For more information about the MessageBox database, see [The MessageBox Database](../core/the-messagebox-database.md).</span></span>  
  
 <span data-ttu-id="b54b9-112">每条消息以及几乎最细微的业务流程实例 （例如，业务流程实例） 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]至少一次在处理期间保留在 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="b54b9-112">Every message and all but the most trivial business process instances (for example, orchestration instances) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are persisted in the MessageBox database at least once during processing.</span></span>  
  
## <a name="persistence-and-sustainability"></a><span data-ttu-id="b54b9-113">持久性和可持续发展</span><span class="sxs-lookup"><span data-stu-id="b54b9-113">Persistence and Sustainability</span></span>  
 <span data-ttu-id="b54b9-114">BizTalk Server 保存所有消息和大多数业务流程的事实会直接影响上同时实现可持续性中所述[可承受性能？](../core/what-is-sustainable-performance.md)</span><span class="sxs-lookup"><span data-stu-id="b54b9-114">The fact that BizTalk Server persists all messages and most orchestrations has a direct affect on sustainability as noted in [What Is Sustainable Performance?](../core/what-is-sustainable-performance.md)</span></span> <span data-ttu-id="b54b9-115">当消息到达 MessageBox 数据库中，它们是路由到等待的订户 （例如，业务流程和发送端口） 和排队，或已发布到 messagebox SQL 表以等待订户提取它们，并处理它们。</span><span class="sxs-lookup"><span data-stu-id="b54b9-115">As messages arrive in the MessageBox database, they are routed to waiting subscribers (for example, orchestrations and send ports) and en-queued, or published, into messagebox SQL tables to wait for subscribers to pick them up and process them.</span></span> <span data-ttu-id="b54b9-116">其中某些到达的消息激活新订阅服务器实例。</span><span class="sxs-lookup"><span data-stu-id="b54b9-116">Some of the arriving messages activate new subscriber instances.</span></span> <span data-ttu-id="b54b9-117">其他消息到达和路由，通过相关，如相关业务流程已在运行订阅服务器上的等待实例。</span><span class="sxs-lookup"><span data-stu-id="b54b9-117">Other messages arrive and are routed, via correlation, to a waiting instance of an already running subscriber such as a correlated orchestration.</span></span>  
  
 <span data-ttu-id="b54b9-118">为了使相关业务流程可继续进行处理，到达的相关的消息必须保持未阻塞状态。</span><span class="sxs-lookup"><span data-stu-id="b54b9-118">In order for correlated orchestrations to continue processing, arriving correlated messages must remain un-blocked.</span></span> <span data-ttu-id="b54b9-119">若要实现此目的，BizTalk 会尽力确保消息 （激活和相关） 会继续接收，即使在高负载下，以便等待相关消息的订户可以完成，并为多个进程运行留出空间。</span><span class="sxs-lookup"><span data-stu-id="b54b9-119">To facilitate this, BizTalk does its best to make sure messages (both activating and correlated) continue to be received, even under high load, so that subscribers waiting for correlated messages can finish and make room for more processes to run.</span></span> <span data-ttu-id="b54b9-120">这意味着可以快于可以处理并从 MessageBox 数据库，从而生成了消息积压工作中删除接收消息。</span><span class="sxs-lookup"><span data-stu-id="b54b9-120">This means it is possible to receive messages faster than they can be processed and removed from the MessageBox database, thus building up a message backlog.</span></span> <span data-ttu-id="b54b9-121">正在存储和转发技术，它是 biztalk 以提供此类型的缓冲，但是，它可能会导致问题的接收速率是否比处理速度，从而导致大量积压一致地更快。</span><span class="sxs-lookup"><span data-stu-id="b54b9-121">Being a store-and-forward technology, it is natural for BizTalk to provide this type of buffering, however, it can result in problems if the receive rate is consistently faster than the process rate indefinitely, resulting in a large backlog.</span></span>  
  
 <span data-ttu-id="b54b9-122">接收的或中创建的每条消息，BizTalk Server 不可变。</span><span class="sxs-lookup"><span data-stu-id="b54b9-122">Every message that is received by, or created within, BizTalk Server is immutable.</span></span> <span data-ttu-id="b54b9-123">也就是说，一旦它接收到的或已创建，不能更改其内容。</span><span class="sxs-lookup"><span data-stu-id="b54b9-123">That is, once it has been received or created, its content cannot be changed.</span></span> <span data-ttu-id="b54b9-124">此外，接收的消息可能具有多个订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="b54b9-124">In addition, received messages may have multiple subscribers.</span></span> <span data-ttu-id="b54b9-125">特定消息的每个订阅服务器引用该消息的同一个副本。</span><span class="sxs-lookup"><span data-stu-id="b54b9-125">Each subscriber of a particular message references the same, single copy of that message.</span></span> <span data-ttu-id="b54b9-126">虽然这种方法最小化存储，必须为每个消息保留引用计数和必须定期执行维护以消除具有引用计数为 0 的那些消息。</span><span class="sxs-lookup"><span data-stu-id="b54b9-126">While this approach minimizes storage, a ref-count must be kept for each message and maintenance must be performed periodically to get rid of those messages that have a ref count of 0.</span></span>  
  
 <span data-ttu-id="b54b9-127">如果允许足够大的积压工作来构建在 MessageBox 数据库中，（作为一组用于每个 MessageBox 数据库的 SQL 作业实现） 的数据库的维护过程将会滞后，如果没有机会赶上，最终会导致磁盘空间不足等问题。</span><span class="sxs-lookup"><span data-stu-id="b54b9-127">If a large enough backlog is allowed to build up in the MessageBox database, the maintenance processes for the database (implemented as a set of SQL Jobs for each MessageBox database) will fall behind and, if not given an opportunity to catch up, will eventually cause issues such as running out of disk space.</span></span> <span data-ttu-id="b54b9-128">若要避免这种情况下，BizTalk Server 提供了一种阻止机制，降低消息接收速率时 MessageBox 数据库积压达到为一些用户可配置的级别。</span><span class="sxs-lookup"><span data-stu-id="b54b9-128">To avoid this situation, BizTalk Server provides a throttling mechanism that slows down the message receive rate when the MessageBox database backlog gets to some user-configurable level.</span></span> <span data-ttu-id="b54b9-129">有关限制的详细信息，请参阅[优化资源使用情况通过主机阻止](../core/optimizing-resource-usage-through-host-throttling.md)。</span><span class="sxs-lookup"><span data-stu-id="b54b9-129">For more information about throttling, see [Optimizing Resource Usage Through Host Throttling](../core/optimizing-resource-usage-through-host-throttling.md).</span></span>  
  
 <span data-ttu-id="b54b9-130">给定的所有活动和流程都会影响可维持性，随着时间的推移可持续发展的主要度量都是，不允许积压无限增长。</span><span class="sxs-lookup"><span data-stu-id="b54b9-130">Given all of the activities and processes that contribute to sustainability, the primary measure of sustainability over time is that a backlog is not allowed to grow indefinitely.</span></span> <span data-ttu-id="b54b9-131">换而言之，随着时间推移，必须有一种平衡之间的高低峰值吞吐量级别，以便 MessageBox 数据库是无法保持常量和可管理的平均积压工作。</span><span class="sxs-lookup"><span data-stu-id="b54b9-131">In other words, over time, there must be a balance between the high and low peak throughput levels so that the MessageBox database is able to maintain a constant and manageable average backlog.</span></span> <span data-ttu-id="b54b9-132">积压工作的主要度量是后台处理表，该表作为公开的深度[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]性能计数器名为 biztalk: Message Box: General Counters: Spool Size。</span><span class="sxs-lookup"><span data-stu-id="b54b9-132">The primary measure of backlog is the depth of the spool table, which is exposed as a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance counter called BizTalk:Message Box:General Counters:Spool Size.</span></span> <span data-ttu-id="b54b9-133">有关此性能计数器的详细信息，请参阅[消息框性能计数器](../core/message-box-performance-counters.md)。</span><span class="sxs-lookup"><span data-stu-id="b54b9-133">For more information about this performance counter, see [Message Box Performance Counters](../core/message-box-performance-counters.md).</span></span>  
  
 <span data-ttu-id="b54b9-134">有关如何使用后台处理大小和其他计数器来确定系统可承受的最大吞吐量的详细信息，请参阅[测量最大可承受引擎吞吐量](../core/measuring-maximum-sustainable-engine-throughput.md)。</span><span class="sxs-lookup"><span data-stu-id="b54b9-134">For more information on how to use the spool size and other counters to determine the maximum throughput a system can sustain, see [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md).</span></span>  
  
## <a name="recommendations"></a><span data-ttu-id="b54b9-135">建议</span><span class="sxs-lookup"><span data-stu-id="b54b9-135">Recommendations</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] <span data-ttu-id="b54b9-136">保存所有消息和大多数业务流程，并可以保留未选中，开发可能会导致的磁盘空间不足等问题的消息积压。</span><span class="sxs-lookup"><span data-stu-id="b54b9-136">persists all messages and most orchestrations and can, left un-checked, develop a backlog of messages that can result in issues such as running out of disk space.</span></span> <span data-ttu-id="b54b9-137">积压工作的主要度量是 messagebox 后台处理表，该表作为名为性能计数器公开的深度：Biztalk: Message Box: General Counters: Spool Size。</span><span class="sxs-lookup"><span data-stu-id="b54b9-137">The primary measure of backlog is the depth of the messagebox spool table, which is exposed as a performance counter called: BizTalk:Message Box:General Counters:Spool Size.</span></span>  
  
 <span data-ttu-id="b54b9-138">当考虑可承受吞吐量，后台处理大小必须随着时间的推移维持稳定的平均值。</span><span class="sxs-lookup"><span data-stu-id="b54b9-138">When thinking about sustainable throughput, the spool size must sustain a stable average over time.</span></span> <span data-ttu-id="b54b9-139">也就是说，后台处理不能继续无限地增长未选中。</span><span class="sxs-lookup"><span data-stu-id="b54b9-139">That is, the spool cannot continue to grow un-checked indefinitely.</span></span> <span data-ttu-id="b54b9-140">在中[测量最大可承受引擎吞吐量](../core/measuring-maximum-sustainable-engine-throughput.md)，更详细地讨论此行为并确定系统可承受的最大吞吐量的方法提供利用后台处理大小和其他性能指示器。</span><span class="sxs-lookup"><span data-stu-id="b54b9-140">In [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md), this behavior is discussed in more detail and a method of determining the maximum throughput a system can sustain is provided which leverages the spool size and other performance indicators.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b54b9-141">请参阅</span><span class="sxs-lookup"><span data-stu-id="b54b9-141">See Also</span></span>  
 <span data-ttu-id="b54b9-142">[测量最大可承受引擎吞吐量](../core/measuring-maximum-sustainable-engine-throughput.md) </span><span class="sxs-lookup"><span data-stu-id="b54b9-142">[Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md) </span></span>  
 <span data-ttu-id="b54b9-143">[什么是可维持性能？](../core/what-is-sustainable-performance.md) </span><span class="sxs-lookup"><span data-stu-id="b54b9-143">[What Is Sustainable Performance?](../core/what-is-sustainable-performance.md) </span></span>  
 <span data-ttu-id="b54b9-144">[性能提示和技巧](../core/performance-tips-and-tricks.md) </span><span class="sxs-lookup"><span data-stu-id="b54b9-144">[Performance Tips and Tricks](../core/performance-tips-and-tricks.md) </span></span>  
 [<span data-ttu-id="b54b9-145">MessageBox 性能计数器</span><span class="sxs-lookup"><span data-stu-id="b54b9-145">Message Box Performance Counters</span></span>](../core/message-box-performance-counters.md)