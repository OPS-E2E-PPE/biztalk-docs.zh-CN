---
title: 如何创建自定义分析任务 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- BAM, DTS tasks
- DTS tasks
- DTS packages, tasks
- BAM, processing
ms.assetid: 6046c113-fb58-4e72-8f48-5470e52be9a8
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f8683e95373bbfa806cc9ac9ae27e90a661d006e
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36977582"
---
# <a name="how-to-create-a-custom-analysis-task"></a><span data-ttu-id="5e575-102">如何创建自定义分析任务</span><span class="sxs-lookup"><span data-stu-id="5e575-102">How to Create a Custom Analysis Task</span></span>
<span data-ttu-id="5e575-103">创建用于处理 BAM 数据的自定义 DTS 任务的最简单方法是从是 bam 自动生成的包开始，并将为所有实际的数据处理。</span><span class="sxs-lookup"><span data-stu-id="5e575-103">The easiest way to create a custom DTS task for processing BAM data is to start from the package that is auto-generated by BAM and replace all the actual data processing.</span></span>  
  
### <a name="to-create-a-custom-dts-task"></a><span data-ttu-id="5e575-104">若要创建自定义 DTS 任务</span><span class="sxs-lookup"><span data-stu-id="5e575-104">To create a custom DTS task</span></span>  
  
1. <span data-ttu-id="5e575-105">创建 BAM 定义所需的 OLAP 多维数据集。</span><span class="sxs-lookup"><span data-stu-id="5e575-105">Create a BAM Definition that requires an OLAP cube.</span></span> <span data-ttu-id="5e575-106">例如使用 Excel 向导中，并将一个 PivotTable® 报表作为非 RTA 视图。</span><span class="sxs-lookup"><span data-stu-id="5e575-106">For example use the Excel wizards, and leave one PivotTable® report as non-RTA view.</span></span>  
  
2. <span data-ttu-id="5e575-107">打开 BAM 创建的多维数据集处理的 DTS 包。</span><span class="sxs-lookup"><span data-stu-id="5e575-107">Open the DTS package for cube processing that BAM creates.</span></span> <span data-ttu-id="5e575-108">BAM 将创建一个此类包为每个视图，称为 BAM_AN_\<*视图名称*\>。</span><span class="sxs-lookup"><span data-stu-id="5e575-108">BAM creates one such package for each view, known as BAM_AN_\<*View Name*\>.</span></span>  
  
3. <span data-ttu-id="5e575-109">在 DTS 设计器中打开该包并删除除前两个步骤和最后一步外的所有步骤。</span><span class="sxs-lookup"><span data-stu-id="5e575-109">Open the Package in the DTS Designer and remove all steps except the first two steps and the last step.</span></span> <span data-ttu-id="5e575-110">您可能想要保留到主导入数据库的连接。</span><span class="sxs-lookup"><span data-stu-id="5e575-110">You may also want to keep the connection to the Primary Import database.</span></span>  
  
4. <span data-ttu-id="5e575-111">编辑第一项 ActiveX® 任务的属性。</span><span class="sxs-lookup"><span data-stu-id="5e575-111">Edit the properties of the first ActiveX® task.</span></span> <span data-ttu-id="5e575-112">删除包含 DTSGlobalVariables.Parent.Steps，所有行，因为它们是指已删除的步骤。</span><span class="sxs-lookup"><span data-stu-id="5e575-112">Remove all lines that contain DTSGlobalVariables.Parent.Steps, because they refer to the deleted steps.</span></span> <span data-ttu-id="5e575-113">该脚本开头如下：</span><span class="sxs-lookup"><span data-stu-id="5e575-113">The script begins with:</span></span>  
  
   ```  
   serverName = "<your server here>"   
   databaseName = "<your analysis database here>"  
   cubeName = "<your cube name here>"  
   ```  
  
   > [!NOTE]
   >  <span data-ttu-id="5e575-114">任务“开始数据分析”（即包中的第二个任务）非常重要，因为它赋予您的包以下功能：</span><span class="sxs-lookup"><span data-stu-id="5e575-114">The task "Begin Data Analysis" (the second task in the package) is very important because it gives your package:</span></span>  
   > 
   > - <span data-ttu-id="5e575-115">增量处理已完成的活动 （动态 SQL 视图名为 bam_ (BamView) 查看 （_v) （活动） _CompletedInstancesWindow 移动窗口</span><span class="sxs-lookup"><span data-stu-id="5e575-115">A moving window for incremental processing of the completed Activities (the dynamic SQL view named  bam_(BamView)_View(Activity)_CompletedInstancesWindow</span></span>  
   >   -   <span data-ttu-id="5e575-116">正在进行的名为 bam 的表中的活动的快照\_(BamView) 查看 （_v) （活动） _ActiveInstancesSnapshot。</span><span class="sxs-lookup"><span data-stu-id="5e575-116">A Snapshot of the Activities that are in progress - a table named  bam\_(BamView)_View(Activity)_ActiveInstancesSnapshot.</span></span>  
  
5. <span data-ttu-id="5e575-117">获取视图和表在短事务中，在此期间您插入任何数据，以便数据表示实际即时主导入数据库的快照。</span><span class="sxs-lookup"><span data-stu-id="5e575-117">Obtain the view and table in a short transaction, during which you insert no data, so that the data represents a real instantaneous snapshot of the Primary Import database.</span></span> <span data-ttu-id="5e575-118">实现一个或多个步骤执行操作的视图和表作为输入数据的实际数据转换。</span><span class="sxs-lookup"><span data-stu-id="5e575-118">Implement one or more steps to do the actual data transformations based on the view and table as input data.</span></span> <span data-ttu-id="5e575-119">如果您的分析任务不是为了填充 OLAP 多维数据集，而是执行其他操作，请记住保留您的作业最后一次提交时的时间戳，并使用将此时间戳分配给全局变量“CompletedCubeLastProcessTime”的代码来替换第一个 ActiveX 任务。</span><span class="sxs-lookup"><span data-stu-id="5e575-119">If the purpose of your analysis task is something other than filling an OLAP cube, remember to keep a timestamp of when your job committed for the last time and replace the first ActiveX task with code that assigns this timestamp to the global variable "CompletedCubeLastProcessTime".</span></span> <span data-ttu-id="5e575-120">第二个任务使用此变量来确保没有丢失的数据和任何数据处理两次在崩溃时，DTS 包的重新启动。</span><span class="sxs-lookup"><span data-stu-id="5e575-120">The second task uses this variable to make sure that there is no missed data and that no data processes twice in case of a crash and restart of the DTS package.</span></span>  
  
6. <span data-ttu-id="5e575-121">最后，必须调用最后一个任务，即“结束数据分析”。</span><span class="sxs-lookup"><span data-stu-id="5e575-121">Finally, you must call the last task, which is "end data analysis".</span></span> <span data-ttu-id="5e575-122">此任务中释放，以便他们可以存档和之外的联机时段后从主导入数据库中删除已处理的已完成的活动。</span><span class="sxs-lookup"><span data-stu-id="5e575-122">This task releases the completed activities that were processed, so that they can be archived and removed from the primary import once they are outside of the online window.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5e575-123">请参阅</span><span class="sxs-lookup"><span data-stu-id="5e575-123">See Also</span></span>  
 [<span data-ttu-id="5e575-124">使用业务活动监视</span><span class="sxs-lookup"><span data-stu-id="5e575-124">Using Business Activity Monitoring</span></span>](../core/using-business-activity-monitoring.md)