---
title: "ESB 错误处理器管道 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a57752b1-8bca-4534-9e5b-7ce721a9490a
caps.latest.revision: "3"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: ebd9a6cecf5353ab72cea0d67b06f3402fc1716a
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="the-esb-fault-processor-pipeline"></a><span data-ttu-id="4949b-102">ESB 错误处理器管道</span><span class="sxs-lookup"><span data-stu-id="4949b-102">The ESB Fault Processor Pipeline</span></span>
<span data-ttu-id="4949b-103">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]安装名为所有发送端口。使用 ESBFaultProcessor 异常发送管道。</span><span class="sxs-lookup"><span data-stu-id="4949b-103">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] installs a send port named ALL.Exceptions that uses the ESBFaultProcessor send pipeline.</span></span> <span data-ttu-id="4949b-104">图 1 显示所有的属性。异常发送端口。</span><span class="sxs-lookup"><span data-stu-id="4949b-104">Figure 1 shows the properties of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="4949b-105">![所有异常发送端口](../esb-toolkit/media/ch4-allexceptionssendport.gif "第四章第 4 AllExceptionsSendPort")</span><span class="sxs-lookup"><span data-stu-id="4949b-105">![All Exceptions Send Port](../esb-toolkit/media/ch4-allexceptionssendport.gif "Ch4-AllExceptionsSendPort")</span></span>  
  
 <span data-ttu-id="4949b-106">**图 1**</span><span class="sxs-lookup"><span data-stu-id="4949b-106">**Figure 1**</span></span>  
  
 <span data-ttu-id="4949b-107">**所有配置。异常发送端口，包括其使用 ESBFaultProcessor 管道**</span><span class="sxs-lookup"><span data-stu-id="4949b-107">**The configuration of the ALL.Exceptions send port, including its use of the ESBFaultProcessor pipeline**</span></span>  
  
 <span data-ttu-id="4949b-108">ESBFaultProcessor 管道包含以下管道组件： ESB 异常编码器、 ESB 业务活动监视 (BAM) 跟踪器和 ESB 转换。</span><span class="sxs-lookup"><span data-stu-id="4949b-108">The ESBFaultProcessor pipeline contains the following pipeline components: ESB Exception Encoder, ESB Business Activity Monitoring (BAM) Tracker, and ESB Transform.</span></span>  
  
 <span data-ttu-id="4949b-109">所有。异常发送端口订阅到所有 ESB 错误消息和生成的 BizTalk 失败消息路由机制的所有消息。</span><span class="sxs-lookup"><span data-stu-id="4949b-109">The ALL.Exceptions send port subscribes to all ESB fault messages and to all messages generated by the BizTalk Failed Message Routing mechanism.</span></span> <span data-ttu-id="4949b-110">图 2 显示的筛选器的所有属性设置。异常发送端口。</span><span class="sxs-lookup"><span data-stu-id="4949b-110">Figure 2 shows the filter property settings of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="4949b-111">![筛选器发送端口](../esb-toolkit/media/ch4-filtersendport.gif "第四章第 4 FilterSendPort")</span><span class="sxs-lookup"><span data-stu-id="4949b-111">![Filter Send Port](../esb-toolkit/media/ch4-filtersendport.gif "Ch4-FilterSendPort")</span></span>  
  
 <span data-ttu-id="4949b-112">**图 2**</span><span class="sxs-lookup"><span data-stu-id="4949b-112">**Figure 2**</span></span>  
  
 <span data-ttu-id="4949b-113">**所有筛选器属性。异常发送端口定义端口订阅**</span><span class="sxs-lookup"><span data-stu-id="4949b-113">**The filter property of the ALL.Exceptions send port defines the port subscription**</span></span>  
  
## <a name="the-fault-processor-pipeline-exception-encoder-component"></a><span data-ttu-id="4949b-114">错误处理器管道异常编码器组件</span><span class="sxs-lookup"><span data-stu-id="4949b-114">The Fault Processor Pipeline Exception Encoder Component</span></span>  
 <span data-ttu-id="4949b-115">ESB 异常编码器管道组件规范化 ESB 失败业务流程异常路由机制和 BizTalk 失败消息路由机制，可为符合 ESB 异常报告的规范消息中所生成的错误消息架构。</span><span class="sxs-lookup"><span data-stu-id="4949b-115">The ESB Exception Encoder pipeline component normalizes fault messages generated in the ESB Failed Orchestration Exception Routing mechanism and the BizTalk Failed Message Routing mechanism into canonical messages that comply with the ESB Exception Reporting schema.</span></span>  
  
 <span data-ttu-id="4949b-116">对于失败的业务流程异常路由例外的组件来丰富，并且所有错误消息属性、 XLANG 消息、 上下文属性，序列都化和**System.Exception**到一条 XML 消息的信息。</span><span class="sxs-lookup"><span data-stu-id="4949b-116">For a Failed Orchestration Exception Routing exception, the component enriches and serializes all fault message properties, XLANG messages, context properties, and **System.Exception** information into an XML message.</span></span>  
  
 <span data-ttu-id="4949b-117">对于失败的消息路由例外，该组件，添加了应用程序名称和其他环境的属性，来丰富数据和架构命名空间适用范围出站的 XML 消息内容。</span><span class="sxs-lookup"><span data-stu-id="4949b-117">For a Failed Message Routing exception, the component enriches the data by adding the application name and other ambient properties, and it applies the schema namespace to the outbound XML message content.</span></span>  
  
 <span data-ttu-id="4949b-118">（可选） ESB 异常编码器管道组件还可以应用 Microsoft InfoPath 处理到出站消息的说明。</span><span class="sxs-lookup"><span data-stu-id="4949b-118">Optionally, the ESB Exception Encoder pipeline component can also apply Microsoft InfoPath processing instructions to the outbound message.</span></span> <span data-ttu-id="4949b-119">你可以通过在设计视图中设置管道组件的属性来修改 InfoPath 说明。</span><span class="sxs-lookup"><span data-stu-id="4949b-119">You can modify the InfoPath instructions by setting the properties of the pipeline component in design view.</span></span> <span data-ttu-id="4949b-120">以下三个设计时属性会影响 ESB 异常编码器管道组件的运行时行为：</span><span class="sxs-lookup"><span data-stu-id="4949b-120">The following three design time properties affect the run-time behavior of the ESB Exception Encoder pipeline component:</span></span>  
  
-   <span data-ttu-id="4949b-121">**EscapeCDATA。**</span><span class="sxs-lookup"><span data-stu-id="4949b-121">**EscapeCDATA.**</span></span> <span data-ttu-id="4949b-122">此属性确定是否该组件将转义任何**CDATA**中找到的部分保留消息，以便可以通过 InfoPath 正确显示。</span><span class="sxs-lookup"><span data-stu-id="4949b-122">This property determines whether the component will escape any **CDATA** sections found in persisted messages so that InfoPath can display them correctly.</span></span>  
  
-   <span data-ttu-id="4949b-123">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="4949b-123">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="4949b-124">此属性具有默认值为**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="4949b-124">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span> <span data-ttu-id="4949b-125">这可以修改要自定义的出站命名空间用于持久消息。</span><span class="sxs-lookup"><span data-stu-id="4949b-125">This can be modified to use a custom outbound namespace for the persisted messages.</span></span>  
  
-   <span data-ttu-id="4949b-126">**ProcessingInstruction。**</span><span class="sxs-lookup"><span data-stu-id="4949b-126">**ProcessingInstruction.**</span></span> <span data-ttu-id="4949b-127">此属性可包含符合 ESB 异常报告错误架构任何 InfoPath 处理指令。</span><span class="sxs-lookup"><span data-stu-id="4949b-127">This property can contain any InfoPath processing instruction that complies with the ESB Exception Reporting fault schema.</span></span> <span data-ttu-id="4949b-128">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]包括符合以下处理指令的 InfoPath 模板。</span><span class="sxs-lookup"><span data-stu-id="4949b-128">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] includes an InfoPath template that conforms to the following processing instruction.</span></span>  
  
    ```  
    <?mso-infoPathSolution solutionVersion="1.0.0.346" productVersion="11.0.6565"  
    PIVersion="1.0.0.0"   
    href=file:///\\localhost\publish\Microsoft.Practices.ESB.ExceptionHandling.InfoPath.Reporting.xsn  
    name="urn:schemas-microsoft-com:office:infopath:  
    Microsoft-Practices-ESB-ExceptionHandling-InfoPath-Reporting:  
    http---schemas-microsoft-biztalk-practices-esb-com-exceptionhandling"  
    language="en-us" ?><?mso-application progid="InfoPath.Document"?>  
    ```  
  
## <a name="the-fault-processor-pipeline-bam-tracker-component"></a><span data-ttu-id="4949b-129">错误处理器管道 BAM 跟踪器组件</span><span class="sxs-lookup"><span data-stu-id="4949b-129">The Fault Processor Pipeline BAM Tracker Component</span></span>  
 <span data-ttu-id="4949b-130">ESB BAM 跟踪器管道组件从 ESB 异常编码器组件接收消息，并将所选的错误数据写入 ESB 异常 Management Framework 的安装过程中创建的 BAM 主导入表。</span><span class="sxs-lookup"><span data-stu-id="4949b-130">The ESB BAM Tracker pipeline component receives the message from the ESB Exception Encoder component and writes selected fault data to the BAM primary import tables created during the installation of the ESB Exception Management Framework.</span></span>  
  
 <span data-ttu-id="4949b-131">ESB BAM 跟踪器组件使用**GetEventStream**管道上下文将作为活动记录的以下字段添加到 BAM 主导入数据库的方法：</span><span class="sxs-lookup"><span data-stu-id="4949b-131">The ESB BAM Tracker component uses the **GetEventStream** method of the pipeline context to add the following fields as an activity record to the BAM Primary Import database:</span></span>  
  
-   <span data-ttu-id="4949b-132">**应用程序**</span><span class="sxs-lookup"><span data-stu-id="4949b-132">**Application**</span></span>  
  
-   <span data-ttu-id="4949b-133">**Description**</span><span class="sxs-lookup"><span data-stu-id="4949b-133">**Description**</span></span>  
  
-   <span data-ttu-id="4949b-134">**FaultSeverity**</span><span class="sxs-lookup"><span data-stu-id="4949b-134">**FaultSeverity**</span></span>  
  
-   <span data-ttu-id="4949b-135">**ServiceName**</span><span class="sxs-lookup"><span data-stu-id="4949b-135">**ServiceName**</span></span>  
  
-   <span data-ttu-id="4949b-136">**ErrorType**</span><span class="sxs-lookup"><span data-stu-id="4949b-136">**ErrorType**</span></span>  
  
-   <span data-ttu-id="4949b-137">**FaultCode**</span><span class="sxs-lookup"><span data-stu-id="4949b-137">**FaultCode**</span></span>  
  
-   <span data-ttu-id="4949b-138">**MachineName**</span><span class="sxs-lookup"><span data-stu-id="4949b-138">**MachineName**</span></span>  
  
-   <span data-ttu-id="4949b-139">**MessageID**</span><span class="sxs-lookup"><span data-stu-id="4949b-139">**MessageID**</span></span>  
  
-   <span data-ttu-id="4949b-140">**DateTime**</span><span class="sxs-lookup"><span data-stu-id="4949b-140">**DateTime**</span></span>  
  
-   <span data-ttu-id="4949b-141">**FaultDescription**</span><span class="sxs-lookup"><span data-stu-id="4949b-141">**FaultDescription**</span></span>  
  
-   <span data-ttu-id="4949b-142">**范围**</span><span class="sxs-lookup"><span data-stu-id="4949b-142">**Scope**</span></span>  
  
-   <span data-ttu-id="4949b-143">**FailureCategory**</span><span class="sxs-lookup"><span data-stu-id="4949b-143">**FailureCategory**</span></span>  
  
-   <span data-ttu-id="4949b-144">**FaultGenerator**</span><span class="sxs-lookup"><span data-stu-id="4949b-144">**FaultGenerator**</span></span>  
  
-   <span data-ttu-id="4949b-145">**ServiceInstanceID**</span><span class="sxs-lookup"><span data-stu-id="4949b-145">**ServiceInstanceID**</span></span>  
  
 <span data-ttu-id="4949b-146">ESB BAM 跟踪器组件使用的消息标识符 ( **MessageID**属性) 值的 ESB 错误消息作为 BAM 活动 id。</span><span class="sxs-lookup"><span data-stu-id="4949b-146">The ESB BAM Tracker component uses the message identifier (the **MessageID** property) value of the ESB fault message as the BAM activity ID.</span></span> <span data-ttu-id="4949b-147">ESB BAM 跟踪程序组件公开两个设计时属性，可设置为其运行时行为的更改：</span><span class="sxs-lookup"><span data-stu-id="4949b-147">The ESB BAM Tracker component exposes two design time properties that you can set to change its run-time behavior:</span></span>  
  
-   <span data-ttu-id="4949b-148">**启用。**</span><span class="sxs-lookup"><span data-stu-id="4949b-148">**Enabled.**</span></span> <span data-ttu-id="4949b-149">此属性确定组件是否将处理该消息并将其写入到 BAM 数据库。</span><span class="sxs-lookup"><span data-stu-id="4949b-149">This property determines whether the component will process the message and write it to the BAM database.</span></span> <span data-ttu-id="4949b-150">当设置为**False**，组件只是将消息发送到管道中的下一个组件。</span><span class="sxs-lookup"><span data-stu-id="4949b-150">When set to **False**, the component just sends the message to the next component in the pipeline.</span></span>  
  
-   <span data-ttu-id="4949b-151">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="4949b-151">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="4949b-152">此属性具有默认值为**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="4949b-152">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span>  
  
## <a name="the-fault-processor-pipeline-transform-component"></a><span data-ttu-id="4949b-153">错误处理器管道转换组件</span><span class="sxs-lookup"><span data-stu-id="4949b-153">The Fault Processor Pipeline Transform Component</span></span>  
 <span data-ttu-id="4949b-154">ESB 错误处理器管道使用 ESB 转换管道组件执行 BizTalk 映射将编码的 ESB 错误消息转换成与架构匹配 BizTalk SQL 适配器 (ExceptionSql.xsd) 的格式。</span><span class="sxs-lookup"><span data-stu-id="4949b-154">The ESB Fault Processor pipeline uses the ESB Transform pipeline component to execute a BizTalk map that translates the encoded ESB fault message into a format that matches the schema for the BizTalk SQL Adapter (ExceptionSql.xsd).</span></span> <span data-ttu-id="4949b-155">然后组件将已转换的消息传递给 SQL 适配器 ESB 管理门户数据库中插入 ESB 错误消息。</span><span class="sxs-lookup"><span data-stu-id="4949b-155">The component then passes the transformed message to the SQL Adapter, which inserts the ESB fault message into the ESB Management Portal database.</span></span>  
  
 <span data-ttu-id="4949b-156">ESB 转换管道组件公开三个可以修改，以更改其运行时行为的设计时属性：</span><span class="sxs-lookup"><span data-stu-id="4949b-156">The ESB Transform pipeline component exposes three design-time properties that can be modified to change its run-time behavior:</span></span>  
  
-   <span data-ttu-id="4949b-157">**启用。**</span><span class="sxs-lookup"><span data-stu-id="4949b-157">**Enabled.**</span></span> <span data-ttu-id="4949b-158">此属性启用或禁用该组件。</span><span class="sxs-lookup"><span data-stu-id="4949b-158">This property enables or disables the component.</span></span>  
  
-   <span data-ttu-id="4949b-159">**验证。**</span><span class="sxs-lookup"><span data-stu-id="4949b-159">**Validate.**</span></span> <span data-ttu-id="4949b-160">此属性指定是否需要验证消息。</span><span class="sxs-lookup"><span data-stu-id="4949b-160">This property specifies whether a message needs to be validated.</span></span>  
  
-   <span data-ttu-id="4949b-161">**映射名称。**</span><span class="sxs-lookup"><span data-stu-id="4949b-161">**MapName.**</span></span> <span data-ttu-id="4949b-162">此属性包含将转换 ESB 管理门户数据库中存储的消息时必须执行映射的名称。</span><span class="sxs-lookup"><span data-stu-id="4949b-162">This property contains the name of the map that must be executed to translate the message for storage in the ESB Management Portal database.</span></span> <span data-ttu-id="4949b-163">下面是默认值。</span><span class="sxs-lookup"><span data-stu-id="4949b-163">The following is the default value.</span></span>  
  
    ```  
    Microsoft.Practices.ESB.ExceptionHandling.Maps.FaultMessage_to_ExceptionSql,  
    Microsoft.Practices.ESB.ExceptionHandling.Maps,  
    Version=2.0.0.0,  
    Culture=neutral,  
    PublicKeyToken=c2c8b2b87f54180a  
    ```  
  
 <span data-ttu-id="4949b-164">所有管道组件都完成执行后，BizTalk SQL Server 数据库适配器会将错误消息插入到 ESB 管理门户数据库。</span><span class="sxs-lookup"><span data-stu-id="4949b-164">After all the pipeline components finish executing, the BizTalk SQL Server database adapter inserts the fault message into the ESB Management Portal database.</span></span>