---
title: ESB 故障处理器管道 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: a57752b1-8bca-4534-9e5b-7ce721a9490a
caps.latest.revision: 3
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1eb33c091c064c8a94939a8b9f2f0ee37f75881b
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37015425"
---
# <a name="the-esb-fault-processor-pipeline"></a><span data-ttu-id="4e745-102">ESB 故障处理器管道</span><span class="sxs-lookup"><span data-stu-id="4e745-102">The ESB Fault Processor Pipeline</span></span>
<span data-ttu-id="4e745-103">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]安装名为所有的发送端口。使用 ESBFaultProcessor 异常发送管道。</span><span class="sxs-lookup"><span data-stu-id="4e745-103">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] installs a send port named ALL.Exceptions that uses the ESBFaultProcessor send pipeline.</span></span> <span data-ttu-id="4e745-104">图 1 显示所有的属性。异常发送端口。</span><span class="sxs-lookup"><span data-stu-id="4e745-104">Figure 1 shows the properties of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="4e745-105">![所有异常发送端口](../esb-toolkit/media/ch4-allexceptionssendport.gif "Ch4-AllExceptionsSendPort")</span><span class="sxs-lookup"><span data-stu-id="4e745-105">![All Exceptions Send Port](../esb-toolkit/media/ch4-allexceptionssendport.gif "Ch4-AllExceptionsSendPort")</span></span>  
  
 <span data-ttu-id="4e745-106">**图 1**</span><span class="sxs-lookup"><span data-stu-id="4e745-106">**Figure 1**</span></span>  
  
 <span data-ttu-id="4e745-107">**所有的配置。异常发送端口，包括其使用的 ESBFaultProcessor 管道**</span><span class="sxs-lookup"><span data-stu-id="4e745-107">**The configuration of the ALL.Exceptions send port, including its use of the ESBFaultProcessor pipeline**</span></span>  
  
 <span data-ttu-id="4e745-108">ESBFaultProcessor 管道包含以下管道组件： ESB 异常编码器、 ESB 业务活动监视 (BAM) 跟踪器和 ESB 转换。</span><span class="sxs-lookup"><span data-stu-id="4e745-108">The ESBFaultProcessor pipeline contains the following pipeline components: ESB Exception Encoder, ESB Business Activity Monitoring (BAM) Tracker, and ESB Transform.</span></span>  
  
 <span data-ttu-id="4e745-109">所有。异常将发送端口订阅到所有 ESB 错误消息和生成的 BizTalk 失败消息路由机制的所有消息。</span><span class="sxs-lookup"><span data-stu-id="4e745-109">The ALL.Exceptions send port subscribes to all ESB fault messages and to all messages generated by the BizTalk Failed Message Routing mechanism.</span></span> <span data-ttu-id="4e745-110">图 2 显示的筛选器的所有属性设置。异常发送端口。</span><span class="sxs-lookup"><span data-stu-id="4e745-110">Figure 2 shows the filter property settings of the ALL.Exceptions send port.</span></span>  
  
 <span data-ttu-id="4e745-111">![筛选器发送端口](../esb-toolkit/media/ch4-filtersendport.gif "Ch4-FilterSendPort")</span><span class="sxs-lookup"><span data-stu-id="4e745-111">![Filter Send Port](../esb-toolkit/media/ch4-filtersendport.gif "Ch4-FilterSendPort")</span></span>  
  
 <span data-ttu-id="4e745-112">**图 2**</span><span class="sxs-lookup"><span data-stu-id="4e745-112">**Figure 2**</span></span>  
  
 <span data-ttu-id="4e745-113">**所有筛选器属性。异常将发送端口定义端口订阅**</span><span class="sxs-lookup"><span data-stu-id="4e745-113">**The filter property of the ALL.Exceptions send port defines the port subscription**</span></span>  
  
## <a name="the-fault-processor-pipeline-exception-encoder-component"></a><span data-ttu-id="4e745-114">故障处理器管道异常编码器组件</span><span class="sxs-lookup"><span data-stu-id="4e745-114">The Fault Processor Pipeline Exception Encoder Component</span></span>  
 <span data-ttu-id="4e745-115">ESB 异常编码器管道组件将规范化 ESB 失败，业务流程异常路由机制和 BizTalk 失败消息路由机制，可为规范化符合 ESB 异常报告的消息中生成的错误消息架构。</span><span class="sxs-lookup"><span data-stu-id="4e745-115">The ESB Exception Encoder pipeline component normalizes fault messages generated in the ESB Failed Orchestration Exception Routing mechanism and the BizTalk Failed Message Routing mechanism into canonical messages that comply with the ESB Exception Reporting schema.</span></span>  
  
 <span data-ttu-id="4e745-116">对于失败，路由业务流程的异常的异常，该组件使其更加丰富和序列化所有错误消息属性、 XLANG 消息、 上下文属性和**System.Exception**转换为 XML 消息的信息。</span><span class="sxs-lookup"><span data-stu-id="4e745-116">For a Failed Orchestration Exception Routing exception, the component enriches and serializes all fault message properties, XLANG messages, context properties, and **System.Exception** information into an XML message.</span></span>  
  
 <span data-ttu-id="4e745-117">失败消息路由的异常，该组件通过添加应用程序名称和其他环境属性来丰富数据，它适用于出站 XML 消息内容的架构命名空间。</span><span class="sxs-lookup"><span data-stu-id="4e745-117">For a Failed Message Routing exception, the component enriches the data by adding the application name and other ambient properties, and it applies the schema namespace to the outbound XML message content.</span></span>  
  
 <span data-ttu-id="4e745-118">（可选） ESB 异常编码器管道组件还可以应用 Microsoft InfoPath 处理指令到出站消息。</span><span class="sxs-lookup"><span data-stu-id="4e745-118">Optionally, the ESB Exception Encoder pipeline component can also apply Microsoft InfoPath processing instructions to the outbound message.</span></span> <span data-ttu-id="4e745-119">可以通过在设计视图中设置管道组件的属性来修改 InfoPath 指令。</span><span class="sxs-lookup"><span data-stu-id="4e745-119">You can modify the InfoPath instructions by setting the properties of the pipeline component in design view.</span></span> <span data-ttu-id="4e745-120">以下三个设计时属性会影响 ESB 异常编码器管道组件的运行时行为：</span><span class="sxs-lookup"><span data-stu-id="4e745-120">The following three design time properties affect the run-time behavior of the ESB Exception Encoder pipeline component:</span></span>  
  
- <span data-ttu-id="4e745-121">**EscapeCDATA。**</span><span class="sxs-lookup"><span data-stu-id="4e745-121">**EscapeCDATA.**</span></span> <span data-ttu-id="4e745-122">此属性确定是否该组件将转义任何**CDATA**中找到的部分保留消息，以便可通过 InfoPath 正确显示。</span><span class="sxs-lookup"><span data-stu-id="4e745-122">This property determines whether the component will escape any **CDATA** sections found in persisted messages so that InfoPath can display them correctly.</span></span>  
  
- <span data-ttu-id="4e745-123">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="4e745-123">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="4e745-124">此属性具有默认值为**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="4e745-124">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span> <span data-ttu-id="4e745-125">可以修改此保留的消息使用自定义出站命名空间。</span><span class="sxs-lookup"><span data-stu-id="4e745-125">This can be modified to use a custom outbound namespace for the persisted messages.</span></span>  
  
- <span data-ttu-id="4e745-126">**ProcessingInstruction。**</span><span class="sxs-lookup"><span data-stu-id="4e745-126">**ProcessingInstruction.**</span></span> <span data-ttu-id="4e745-127">此属性可以包含任何符合 ESB 异常报告错误架构的 InfoPath 处理指令。</span><span class="sxs-lookup"><span data-stu-id="4e745-127">This property can contain any InfoPath processing instruction that complies with the ESB Exception Reporting fault schema.</span></span> <span data-ttu-id="4e745-128">[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]包括符合以下处理指令的 InfoPath 模板。</span><span class="sxs-lookup"><span data-stu-id="4e745-128">The [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] includes an InfoPath template that conforms to the following processing instruction.</span></span>  
  
  ```  
  <?mso-infoPathSolution solutionVersion="1.0.0.346" productVersion="11.0.6565"  
  PIVersion="1.0.0.0"   
  href=file:///\\localhost\publish\Microsoft.Practices.ESB.ExceptionHandling.InfoPath.Reporting.xsn  
  name="urn:schemas-microsoft-com:office:infopath:  
  Microsoft-Practices-ESB-ExceptionHandling-InfoPath-Reporting:  
  http---schemas-microsoft-biztalk-practices-esb-com-exceptionhandling"  
  language="en-us" ?><?mso-application progid="InfoPath.Document"?>  
  ```  
  
## <a name="the-fault-processor-pipeline-bam-tracker-component"></a><span data-ttu-id="4e745-129">故障处理器管道 BAM 跟踪器组件</span><span class="sxs-lookup"><span data-stu-id="4e745-129">The Fault Processor Pipeline BAM Tracker Component</span></span>  
 <span data-ttu-id="4e745-130">ESB BAM 跟踪器管道组件从 ESB 异常编码器组件接收消息，并将所选的错误数据写入到 ESB 异常管理框架的安装过程中创建的 BAM 主导入表。</span><span class="sxs-lookup"><span data-stu-id="4e745-130">The ESB BAM Tracker pipeline component receives the message from the ESB Exception Encoder component and writes selected fault data to the BAM primary import tables created during the installation of the ESB Exception Management Framework.</span></span>  
  
 <span data-ttu-id="4e745-131">ESB BAM 跟踪器组件使用**GetEventStream**管道上下文将作为活动记录的以下字段添加到 BAM 主导入数据库的方法：</span><span class="sxs-lookup"><span data-stu-id="4e745-131">The ESB BAM Tracker component uses the **GetEventStream** method of the pipeline context to add the following fields as an activity record to the BAM Primary Import database:</span></span>  
  
- <span data-ttu-id="4e745-132">**应用程序**</span><span class="sxs-lookup"><span data-stu-id="4e745-132">**Application**</span></span>  
  
- <span data-ttu-id="4e745-133">**Description**</span><span class="sxs-lookup"><span data-stu-id="4e745-133">**Description**</span></span>  
  
- <span data-ttu-id="4e745-134">**FaultSeverity**</span><span class="sxs-lookup"><span data-stu-id="4e745-134">**FaultSeverity**</span></span>  
  
- <span data-ttu-id="4e745-135">**ServiceName**</span><span class="sxs-lookup"><span data-stu-id="4e745-135">**ServiceName**</span></span>  
  
- <span data-ttu-id="4e745-136">**错误类型**</span><span class="sxs-lookup"><span data-stu-id="4e745-136">**ErrorType**</span></span>  
  
- <span data-ttu-id="4e745-137">**FaultCode**</span><span class="sxs-lookup"><span data-stu-id="4e745-137">**FaultCode**</span></span>  
  
- <span data-ttu-id="4e745-138">**MachineName**</span><span class="sxs-lookup"><span data-stu-id="4e745-138">**MachineName**</span></span>  
  
- <span data-ttu-id="4e745-139">**消息 Id**</span><span class="sxs-lookup"><span data-stu-id="4e745-139">**MessageID**</span></span>  
  
- <span data-ttu-id="4e745-140">**DateTime**</span><span class="sxs-lookup"><span data-stu-id="4e745-140">**DateTime**</span></span>  
  
- <span data-ttu-id="4e745-141">**FaultDescription**</span><span class="sxs-lookup"><span data-stu-id="4e745-141">**FaultDescription**</span></span>  
  
- <span data-ttu-id="4e745-142">**范围**</span><span class="sxs-lookup"><span data-stu-id="4e745-142">**Scope**</span></span>  
  
- <span data-ttu-id="4e745-143">**FailureCategory**</span><span class="sxs-lookup"><span data-stu-id="4e745-143">**FailureCategory**</span></span>  
  
- <span data-ttu-id="4e745-144">**FaultGenerator**</span><span class="sxs-lookup"><span data-stu-id="4e745-144">**FaultGenerator**</span></span>  
  
- <span data-ttu-id="4e745-145">**ServiceInstanceID**</span><span class="sxs-lookup"><span data-stu-id="4e745-145">**ServiceInstanceID**</span></span>  
  
  <span data-ttu-id="4e745-146">ESB BAM 跟踪器组件使用的消息标识符 ( **MessageID**属性) 值的 ESB 错误消息作为 BAM 活动 id。</span><span class="sxs-lookup"><span data-stu-id="4e745-146">The ESB BAM Tracker component uses the message identifier (the **MessageID** property) value of the ESB fault message as the BAM activity ID.</span></span> <span data-ttu-id="4e745-147">ESB BAM 跟踪器组件公开两个设计时属性，可设置为其运行时行为的更改：</span><span class="sxs-lookup"><span data-stu-id="4e745-147">The ESB BAM Tracker component exposes two design time properties that you can set to change its run-time behavior:</span></span>  
  
- <span data-ttu-id="4e745-148">**已启用。**</span><span class="sxs-lookup"><span data-stu-id="4e745-148">**Enabled.**</span></span> <span data-ttu-id="4e745-149">此属性确定组件是否将处理该消息并将其写入到 BAM 数据库。</span><span class="sxs-lookup"><span data-stu-id="4e745-149">This property determines whether the component will process the message and write it to the BAM database.</span></span> <span data-ttu-id="4e745-150">如果设置为**False**，组件只是将消息发送到管道中的下一个组件。</span><span class="sxs-lookup"><span data-stu-id="4e745-150">When set to **False**, the component just sends the message to the next component in the pipeline.</span></span>  
  
- <span data-ttu-id="4e745-151">**FaultDocumentNamespace。**</span><span class="sxs-lookup"><span data-stu-id="4e745-151">**FaultDocumentNamespace.**</span></span> <span data-ttu-id="4e745-152">此属性具有默认值为**http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**。</span><span class="sxs-lookup"><span data-stu-id="4e745-152">This property has a default value of **http://schemas.microsoft.biztalk.practices.esb.com/exceptionhandling**.</span></span>  
  
## <a name="the-fault-processor-pipeline-transform-component"></a><span data-ttu-id="4e745-153">故障处理器管道转换组件</span><span class="sxs-lookup"><span data-stu-id="4e745-153">The Fault Processor Pipeline Transform Component</span></span>  
 <span data-ttu-id="4e745-154">ESB 故障处理器管道使用 ESB 转换管道组件执行编码的 ESB 错误消息转换为与架构匹配的 BizTalk SQL 适配器 (ExceptionSql.xsd) 格式的 BizTalk 映射。</span><span class="sxs-lookup"><span data-stu-id="4e745-154">The ESB Fault Processor pipeline uses the ESB Transform pipeline component to execute a BizTalk map that translates the encoded ESB fault message into a format that matches the schema for the BizTalk SQL Adapter (ExceptionSql.xsd).</span></span> <span data-ttu-id="4e745-155">然后，组件将转换后的消息传递到 SQL 适配器，ESB 管理门户数据库中插入 ESB 错误消息。</span><span class="sxs-lookup"><span data-stu-id="4e745-155">The component then passes the transformed message to the SQL Adapter, which inserts the ESB fault message into the ESB Management Portal database.</span></span>  
  
 <span data-ttu-id="4e745-156">ESB 转换管道组件公开三个设计时属性，可以修改以更改其运行时行为：</span><span class="sxs-lookup"><span data-stu-id="4e745-156">The ESB Transform pipeline component exposes three design-time properties that can be modified to change its run-time behavior:</span></span>  
  
- <span data-ttu-id="4e745-157">**已启用。**</span><span class="sxs-lookup"><span data-stu-id="4e745-157">**Enabled.**</span></span> <span data-ttu-id="4e745-158">此属性启用或禁用该组件。</span><span class="sxs-lookup"><span data-stu-id="4e745-158">This property enables or disables the component.</span></span>  
  
- <span data-ttu-id="4e745-159">**验证。**</span><span class="sxs-lookup"><span data-stu-id="4e745-159">**Validate.**</span></span> <span data-ttu-id="4e745-160">此属性指定是否需要验证一条消息。</span><span class="sxs-lookup"><span data-stu-id="4e745-160">This property specifies whether a message needs to be validated.</span></span>  
  
- <span data-ttu-id="4e745-161">**映射名称。**</span><span class="sxs-lookup"><span data-stu-id="4e745-161">**MapName.**</span></span> <span data-ttu-id="4e745-162">此属性包含必须在执行转换 ESB 管理门户数据库中存储的消息的映射的名称。</span><span class="sxs-lookup"><span data-stu-id="4e745-162">This property contains the name of the map that must be executed to translate the message for storage in the ESB Management Portal database.</span></span> <span data-ttu-id="4e745-163">以下是默认值。</span><span class="sxs-lookup"><span data-stu-id="4e745-163">The following is the default value.</span></span>  
  
  ```  
  Microsoft.Practices.ESB.ExceptionHandling.Maps.FaultMessage_to_ExceptionSql,  
  Microsoft.Practices.ESB.ExceptionHandling.Maps,  
  Version=2.0.0.0,  
  Culture=neutral,  
  PublicKeyToken=c2c8b2b87f54180a  
  ```  
  
  <span data-ttu-id="4e745-164">所有管道组件都完成执行后，BizTalk SQL Server 数据库适配器将错误消息插入到 ESB 管理门户数据库。</span><span class="sxs-lookup"><span data-stu-id="4e745-164">After all the pipeline components finish executing, the BizTalk SQL Server database adapter inserts the fault message into the ESB Management Portal database.</span></span>