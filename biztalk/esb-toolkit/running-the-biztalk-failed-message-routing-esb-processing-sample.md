---
title: 运行 BizTalk 故障消息路由 ESB 处理示例 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d2a536a0-cfc8-4ba3-adcd-2b8b580bff85
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 8181c426bac76885b7e06aea93c9c3bb32dc1564
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65292565"
---
# <a name="running-the-biztalk-failed-message-routing-esb-processing-sample"></a><span data-ttu-id="82961-102">运行 BizTalk 故障消息路由 ESB 处理示例</span><span class="sxs-lookup"><span data-stu-id="82961-102">Running the BizTalk Failed Message Routing ESB Processing Sample</span></span>
<span data-ttu-id="82961-103">Microsoft BizTalk 失败消息路由 ESB 处理示例演示如何使用[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]异常管理框架作为通用机制来管理、 序列化，并呈现在 BizTalk 中的所有情况下出现的异常服务器。</span><span class="sxs-lookup"><span data-stu-id="82961-103">The Microsoft BizTalk Failed Message Routing ESB Processing sample demonstrates how you can use the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] Exception Management Framework as a universal mechanism to manage, serialize, and render exceptions occurring under all conditions in BizTalk Server.</span></span> <span data-ttu-id="82961-104">这包括由 BizTalk 失败消息路由机制和容错生成的消息异常管理框架从业务流程中生成的异常。</span><span class="sxs-lookup"><span data-stu-id="82961-104">This includes exceptions generated by the BizTalk Failed Message Routing mechanism and fault messages generated by the Exception Management Framework from within an orchestration.</span></span>  
  
 <span data-ttu-id="82961-105">BizTalk 失败消息路由机制是 BizTalk Server; 错误处理功能通过使用它，在设计器可以指定作为传统的替代方法消息传送失败进行自动的处理放置的 （现在是默认） 行为失败"已挂起"队列中的消息。</span><span class="sxs-lookup"><span data-stu-id="82961-105">The BizTalk Failed Message Routing mechanism is the error-handling facility of BizTalk Server; by using it, the designer can designate automated handling of messaging failures as an alternative to the traditional (now default) behavior of placing failed messages in the "Suspended" queue.</span></span> <span data-ttu-id="82961-106">这将自动处理路由到任何订阅路由目标，例如发送端口或业务流程的错误消息。</span><span class="sxs-lookup"><span data-stu-id="82961-106">This automated handling routes an error message to any subscribing routing destination, such as a send port or an orchestration.</span></span> <span data-ttu-id="82961-107">错误消息是使用所有以前升级的属性降级和升级到消息上下文中的特定消息传送失败相关的所选属性的原始消息的克隆。</span><span class="sxs-lookup"><span data-stu-id="82961-107">The error message is a clone of the original message with all previously promoted properties demoted and with selected properties related to the specific messaging failure promoted into the message context.</span></span>  
  
 <span data-ttu-id="82961-108">若要启用的接收端口或发送端口上的 BizTalk 失败消息路由机制，请选择**失败消息启用路由功能**复选框，如图 1 中所示。</span><span class="sxs-lookup"><span data-stu-id="82961-108">To enable the BizTalk Failed Message Routing mechanism on a receive port or a send port, select the **Enable routing for failed messages** check box, as shown in Figure 1.</span></span>  
  
 <span data-ttu-id="82961-109">![已启用的路由](../esb-toolkit/media/ch6-enabledrouting.gif "Ch6 EnabledRouting")</span><span class="sxs-lookup"><span data-stu-id="82961-109">![Enabled Routing](../esb-toolkit/media/ch6-enabledrouting.gif "Ch6-EnabledRouting")</span></span>  
  
 <span data-ttu-id="82961-110">**图 1**</span><span class="sxs-lookup"><span data-stu-id="82961-110">**Figure 1**</span></span>  
  
 <span data-ttu-id="82961-111">**启用 BizTalk 失败消息路由机制**</span><span class="sxs-lookup"><span data-stu-id="82961-111">**Enabling the BizTalk Failed Message Routing mechanism**</span></span>  
  
 <span data-ttu-id="82961-112">但是，没有错误或故障发生在业务流程中的类似机制。</span><span class="sxs-lookup"><span data-stu-id="82961-112">However, there is not a similar mechanism for errors or failures occurring in an orchestration.</span></span> <span data-ttu-id="82961-113">相反，业务流程的异常处理程序中的代码可以充分利用异常管理框架 API 将模拟的 BizTalk 失败消息路由机制功能。</span><span class="sxs-lookup"><span data-stu-id="82961-113">Instead, code within the exception handler of an orchestration can take advantage of the Exception Management Framework API to emulate the functionality of the BizTalk Failed Message Routing mechanism.</span></span>  
  
 <span data-ttu-id="82961-114">在此示例中，名为 EAIProcess.RequestPort_FILE 的接收位置提取文件复制到位置 \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort。</span><span class="sxs-lookup"><span data-stu-id="82961-114">In this sample, the receive location named EAIProcess.RequestPort_FILE picks up files copied to the location \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
 <span data-ttu-id="82961-115">此外，还有一个名为所有的泛型的发送端口。Exceptions_FILE 配置为使用 GlobalFaultProcessor 管道异常管理框架的一部分安装。</span><span class="sxs-lookup"><span data-stu-id="82961-115">Additionally, there is a generic send port named ALL.Exceptions_FILE configured to use the GlobalFaultProcessor pipeline installed as part of the Exception Management Framework.</span></span> <span data-ttu-id="82961-116">此端口订阅系统中发生的所有异常，这两个 BizTalk 故障消息路由的消息和 ESB 错误消息，如图 2 中所示。</span><span class="sxs-lookup"><span data-stu-id="82961-116">This port subscribes to all exceptions occurring in the system, both BizTalk failed message routing messages and ESB fault messages, as shown in Figure 2.</span></span>  
  
 <span data-ttu-id="82961-117">![发送端口](../esb-toolkit/media/ch6-sendport.gif "Ch6-SendPort")</span><span class="sxs-lookup"><span data-stu-id="82961-117">![Send Port](../esb-toolkit/media/ch6-sendport.gif "Ch6-SendPort")</span></span>  
  
 <span data-ttu-id="82961-118">**图 2**</span><span class="sxs-lookup"><span data-stu-id="82961-118">**Figure 2**</span></span>  
  
 <span data-ttu-id="82961-119">**所有。异常的发送端口订阅用于所有类型的故障或异常**</span><span class="sxs-lookup"><span data-stu-id="82961-119">**The ALL.Exceptions send port subscription for all types of failure or exception**</span></span>  
  
 <span data-ttu-id="82961-120">异常管理框架规范化所有异常的一种格式，并将其使用位置 \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions Microsoft InfoPath 处理指令序列化。</span><span class="sxs-lookup"><span data-stu-id="82961-120">The Exception Management Framework normalizes all exceptions to a single format and serializes them using a Microsoft InfoPath processing instruction to the location \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="82961-121">安装</span><span class="sxs-lookup"><span data-stu-id="82961-121">Installation</span></span>  
 <span data-ttu-id="82961-122">所有异常管理示例都使用的相同的一套核心服务和 BizTalk 应用程序项目。</span><span class="sxs-lookup"><span data-stu-id="82961-122">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="82961-123">因此，必须安装异常管理示例项目一次可以运行所有异常管理示例。</span><span class="sxs-lookup"><span data-stu-id="82961-123">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="82961-124">有关如何安装异常管理示例的信息，请参阅[安装异常管理示例](../esb-toolkit/installing-the-exception-management-samples.md)。</span><span class="sxs-lookup"><span data-stu-id="82961-124">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="82961-125">运行示例应用程序</span><span class="sxs-lookup"><span data-stu-id="82961-125">Running the Sample Application</span></span>  
 <span data-ttu-id="82961-126">**若要运行 BizTalk 失败消息路由 ESB 处理示例**</span><span class="sxs-lookup"><span data-stu-id="82961-126">**To run the BizTalk Failed Message Routing ESB Processing sample**</span></span>  
  
1.  <span data-ttu-id="82961-127">第一次运行此示例之前，请确保，接收位置和发送端口 URL 指向 \Source\Samples\Exception Handling\Test\Filedrop 文件夹中的相应目录。</span><span class="sxs-lookup"><span data-stu-id="82961-127">Before you run this sample for the first time, make sure that the receive location and send port URL point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="82961-128">接收位置应指定文件夹 EAIProcess.RequestPort，而发送端口 URL 应指定文件夹 All_Exceptions。</span><span class="sxs-lookup"><span data-stu-id="82961-128">The receive location should specify the folder EAIProcess.RequestPort, and the send port URL should specify the folder All_Exceptions.</span></span>  
  
2.  <span data-ttu-id="82961-129">如果尚未运行 GlobalBank.ESB 应用程序，使用 BizTalk 管理控制台来启动它。</span><span class="sxs-lookup"><span data-stu-id="82961-129">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="82961-130">名为 FlatFileReceive_in.txt 文件夹 \Source\Samples\Exception Handling\Test\Data 到名为 EAIProcess.RequestPort （在 \Source\Samples\Exception Handling\Test\Filedrop 文件夹中） 的接收位置文件夹将文件复制。</span><span class="sxs-lookup"><span data-stu-id="82961-130">Copy the file named FlatFileReceive_in.txt from the folder \Source\Samples\Exception Handling\Test\Data into the receive location folder named EAIProcess.RequestPort (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span>  
  
4.  <span data-ttu-id="82961-131">此消息是一个文本文件，并且将导致异常。</span><span class="sxs-lookup"><span data-stu-id="82961-131">This message is a text file, and it will cause an exception.</span></span> <span data-ttu-id="82961-132">打开名为 All_Exceptions （\Source\Samples\Exception Handling\Test\Filedrop 文件夹） 中的文件夹，然后双击要在使用相应的模板的 InfoPath 打开的错误消息。</span><span class="sxs-lookup"><span data-stu-id="82961-132">Open the folder named All_Exceptions (in the \Source\Samples\Exception Handling\Test\Filedrop folder), and then double-click the fault message to open it into InfoPath using the appropriate template.</span></span> <span data-ttu-id="82961-133">你将看到，ESB 异常处理机制序列化内容相应地允许 InfoPath 来呈现它。</span><span class="sxs-lookup"><span data-stu-id="82961-133">You will see that the ESB Exception Handling mechanism serializes the content appropriately to allow InfoPath to render it.</span></span>  
  
5.  <span data-ttu-id="82961-134">接下来，将名为 EAIProcess.RequestPort 从文件夹 \Source\Samples\Exception Handling\Test\Data soapmessage [1].xml 文件复制接收位置文件夹中。</span><span class="sxs-lookup"><span data-stu-id="82961-134">Next, copy the file named soapmessage[1].xml from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location folder.</span></span>  
  
6.  <span data-ttu-id="82961-135">此消息是包含 CDATA 节内，一个 XML 文档，它会导致异常。</span><span class="sxs-lookup"><span data-stu-id="82961-135">This message is an XML document that contains a CDATA section, and it will cause an exception.</span></span> <span data-ttu-id="82961-136">打开 All_Exceptions 输出文件夹，然后双击要在 InfoPath 打开的错误消息。</span><span class="sxs-lookup"><span data-stu-id="82961-136">Open the All_Exceptions output folder and double-click the fault message to open it into InfoPath.</span></span> <span data-ttu-id="82961-137">你将看到，ESB 异常处理机制将序列化此内容相应地允许 InfoPath 来呈现它。</span><span class="sxs-lookup"><span data-stu-id="82961-137">You will see that the ESB Exception Handling mechanism serializes this content appropriately to allow InfoPath to render it.</span></span>  
  
7.  <span data-ttu-id="82961-138">最后，将名为 EAIProcess.RequestPort 从文件夹 \Source\Samples\Exception Handling\Test\Data Csqzav01.pdf 文件接收位置。</span><span class="sxs-lookup"><span data-stu-id="82961-138">Finally, copy the file named Csqzav01.pdf from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location.</span></span>  
  
8.  <span data-ttu-id="82961-139">此消息是 PDF 文件，并且将导致异常。</span><span class="sxs-lookup"><span data-stu-id="82961-139">This message is a PDF file, and it will cause an exception.</span></span> <span data-ttu-id="82961-140">打开 All_Exceptions 输出文件夹，然后双击要在 InfoPath 中打开的错误消息。</span><span class="sxs-lookup"><span data-stu-id="82961-140">Open the All_Exceptions output folder and double-click the fault message to open it in InfoPath.</span></span> <span data-ttu-id="82961-141">您将看到 ESB 异常处理机制进行序列化和 Base-64 编码的内容，以允许 InfoPath 来呈现它。</span><span class="sxs-lookup"><span data-stu-id="82961-141">You will see that the ESB Exception Handling mechanism serializes and Base-64 encodes the content to allow InfoPath to render it.</span></span>