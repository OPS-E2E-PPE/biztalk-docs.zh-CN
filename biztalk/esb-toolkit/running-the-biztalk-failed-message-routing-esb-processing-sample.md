---
title: 运行 BizTalk 失败消息路由 ESB 处理示例 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: d2a536a0-cfc8-4ba3-adcd-2b8b580bff85
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 81a2b225e5316d16e31d2ed2ca830387dc14048d
ms.sourcegitcommit: 3fc338e52d5dbca2c3ea1685a2faafc7582fe23a
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/01/2017
ms.locfileid: "26008798"
---
# <a name="running-the-biztalk-failed-message-routing-esb-processing-sample"></a><span data-ttu-id="c6a39-102">运行 BizTalk 失败消息路由 ESB 处理示例</span><span class="sxs-lookup"><span data-stu-id="c6a39-102">Running the BizTalk Failed Message Routing ESB Processing Sample</span></span>
<span data-ttu-id="c6a39-103">Microsoft BizTalk 失败消息路由 ESB 处理示例演示如何使用[!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)]异常管理框架作为通用机制，管理、 序列化，并呈现在 BizTalk 中的所有情况下发生的异常服务器。</span><span class="sxs-lookup"><span data-stu-id="c6a39-103">The Microsoft BizTalk Failed Message Routing ESB Processing sample demonstrates how you can use the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] Exception Management Framework as a universal mechanism to manage, serialize, and render exceptions occurring under all conditions in BizTalk Server.</span></span> <span data-ttu-id="c6a39-104">这包括由 BizTalk 失败消息路由机制和错误消息框架生成的异常管理从业务流程中生成的异常。</span><span class="sxs-lookup"><span data-stu-id="c6a39-104">This includes exceptions generated by the BizTalk Failed Message Routing mechanism and fault messages generated by the Exception Management Framework from within an orchestration.</span></span>  
  
 <span data-ttu-id="c6a39-105">BizTalk 失败消息路由机制是 BizTalk Server; 的错误处理功能通过使用它，设计器可以指定自动的处理的消息作为传统的替代方法失败 （现在默认值） 的放置的行为失败"已挂起"队列中的消息。</span><span class="sxs-lookup"><span data-stu-id="c6a39-105">The BizTalk Failed Message Routing mechanism is the error-handling facility of BizTalk Server; by using it, the designer can designate automated handling of messaging failures as an alternative to the traditional (now default) behavior of placing failed messages in the "Suspended" queue.</span></span> <span data-ttu-id="c6a39-106">这将自动处理路由到任何订阅的路由目标，如发送端口或业务流程的错误信息。</span><span class="sxs-lookup"><span data-stu-id="c6a39-106">This automated handling routes an error message to any subscribing routing destination, such as a send port or an orchestration.</span></span> <span data-ttu-id="c6a39-107">错误消息是与降级的所有以前升级的属性和提升到消息上下文与特定的消息传递失败相关的所选属性的原始消息的克隆。</span><span class="sxs-lookup"><span data-stu-id="c6a39-107">The error message is a clone of the original message with all previously promoted properties demoted and with selected properties related to the specific messaging failure promoted into the message context.</span></span>  
  
 <span data-ttu-id="c6a39-108">若要启用接收端口或发送端口上的 BizTalk 失败消息路由机制，请选择**启用路由失败消息**复选框，如图 1 中所示。</span><span class="sxs-lookup"><span data-stu-id="c6a39-108">To enable the BizTalk Failed Message Routing mechanism on a receive port or a send port, select the **Enable routing for failed messages** check box, as shown in Figure 1.</span></span>  
  
 <span data-ttu-id="c6a39-109">![启用路由](../esb-toolkit/media/ch6-enabledrouting.gif "Ch6 EnabledRouting")</span><span class="sxs-lookup"><span data-stu-id="c6a39-109">![Enabled Routing](../esb-toolkit/media/ch6-enabledrouting.gif "Ch6-EnabledRouting")</span></span>  
  
 <span data-ttu-id="c6a39-110">**图 1**</span><span class="sxs-lookup"><span data-stu-id="c6a39-110">**Figure 1**</span></span>  
  
 <span data-ttu-id="c6a39-111">**启用 BizTalk 失败消息路由机制**</span><span class="sxs-lookup"><span data-stu-id="c6a39-111">**Enabling the BizTalk Failed Message Routing mechanism**</span></span>  
  
 <span data-ttu-id="c6a39-112">但是，没有因错误或故障在业务流程中发生的类似机制。</span><span class="sxs-lookup"><span data-stu-id="c6a39-112">However, there is not a similar mechanism for errors or failures occurring in an orchestration.</span></span> <span data-ttu-id="c6a39-113">相反，异常处理程序的业务流程中的代码可以充分利用异常管理 Framework API，以模拟 BizTalk 失败消息路由机制的功能。</span><span class="sxs-lookup"><span data-stu-id="c6a39-113">Instead, code within the exception handler of an orchestration can take advantage of the Exception Management Framework API to emulate the functionality of the BizTalk Failed Message Routing mechanism.</span></span>  
  
 <span data-ttu-id="c6a39-114">在此示例中，名为 EAIProcess.RequestPort_FILE 接收位置选取复制到位置 \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort 文件。</span><span class="sxs-lookup"><span data-stu-id="c6a39-114">In this sample, the receive location named EAIProcess.RequestPort_FILE picks up files copied to the location \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
 <span data-ttu-id="c6a39-115">此外，没有名为所有泛型发送端口。Exceptions_FILE 配置为使用 GlobalFaultProcessor 管道作为异常 Management Framework 的一部分安装。</span><span class="sxs-lookup"><span data-stu-id="c6a39-115">Additionally, there is a generic send port named ALL.Exceptions_FILE configured to use the GlobalFaultProcessor pipeline installed as part of the Exception Management Framework.</span></span> <span data-ttu-id="c6a39-116">此端口订阅系统中发生的所有异常，这两个 BizTalk 失败消息将消息路由和 ESB 错误消息，如图 2 中所示。</span><span class="sxs-lookup"><span data-stu-id="c6a39-116">This port subscribes to all exceptions occurring in the system, both BizTalk failed message routing messages and ESB fault messages, as shown in Figure 2.</span></span>  
  
 <span data-ttu-id="c6a39-117">![发送端口](../esb-toolkit/media/ch6-sendport.gif "Ch6 发送端口")</span><span class="sxs-lookup"><span data-stu-id="c6a39-117">![Send Port](../esb-toolkit/media/ch6-sendport.gif "Ch6-SendPort")</span></span>  
  
 <span data-ttu-id="c6a39-118">**图 2**</span><span class="sxs-lookup"><span data-stu-id="c6a39-118">**Figure 2**</span></span>  
  
 <span data-ttu-id="c6a39-119">**所有。异常发送端口订阅的所有类型的故障或异常**</span><span class="sxs-lookup"><span data-stu-id="c6a39-119">**The ALL.Exceptions send port subscription for all types of failure or exception**</span></span>  
  
 <span data-ttu-id="c6a39-120">异常管理框架规范化到一种格式的所有异常，并序列化这些使用到位置 \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions Microsoft InfoPath 处理指令。</span><span class="sxs-lookup"><span data-stu-id="c6a39-120">The Exception Management Framework normalizes all exceptions to a single format and serializes them using a Microsoft InfoPath processing instruction to the location \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="c6a39-121">安装</span><span class="sxs-lookup"><span data-stu-id="c6a39-121">Installation</span></span>  
 <span data-ttu-id="c6a39-122">所有异常管理示例都使用的相同的一套核心服务以及 BizTalk 应用程序项目。</span><span class="sxs-lookup"><span data-stu-id="c6a39-122">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="c6a39-123">因此，你必须安装异常管理示例项目仅一次能够运行管理示例的所有异常。</span><span class="sxs-lookup"><span data-stu-id="c6a39-123">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="c6a39-124">有关如何安装异常管理示例的信息，请参阅[安装异常管理示例](../esb-toolkit/installing-the-exception-management-samples.md)。</span><span class="sxs-lookup"><span data-stu-id="c6a39-124">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="c6a39-125">运行示例应用程序</span><span class="sxs-lookup"><span data-stu-id="c6a39-125">Running the Sample Application</span></span>  
 <span data-ttu-id="c6a39-126">**若要运行 BizTalk 失败消息路由 ESB 处理示例**</span><span class="sxs-lookup"><span data-stu-id="c6a39-126">**To run the BizTalk Failed Message Routing ESB Processing sample**</span></span>  
  
1.  <span data-ttu-id="c6a39-127">首次运行此示例之前，请确保该接收位置和发送端口 URL 指向 \Source\Samples\Exception Handling\Test\Filedrop 文件夹中的相应目录。</span><span class="sxs-lookup"><span data-stu-id="c6a39-127">Before you run this sample for the first time, make sure that the receive location and send port URL point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="c6a39-128">接收位置应指定文件夹 EAIProcess.RequestPort，并发送端口 URL 应指定文件夹 All_Exceptions。</span><span class="sxs-lookup"><span data-stu-id="c6a39-128">The receive location should specify the folder EAIProcess.RequestPort, and the send port URL should specify the folder All_Exceptions.</span></span>  
  
2.  <span data-ttu-id="c6a39-129">如果 GlobalBank.ESB 应用程序尚未运行，使用 BizTalk 管理控制台来启动它。</span><span class="sxs-lookup"><span data-stu-id="c6a39-129">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="c6a39-130">将复制到名为 （在 \Source\Samples\Exception Handling\Test\Filedrop 文件夹中） 的 EAIProcess.RequestPort 接收位置文件夹名 FlatFileReceive_in.txt 为从文件夹 \Source\Samples\Exception Handling\Test\Data 的文件。</span><span class="sxs-lookup"><span data-stu-id="c6a39-130">Copy the file named FlatFileReceive_in.txt from the folder \Source\Samples\Exception Handling\Test\Data into the receive location folder named EAIProcess.RequestPort (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span>  
  
4.  <span data-ttu-id="c6a39-131">此消息是一个文本文件，文件，它将会引发异常。</span><span class="sxs-lookup"><span data-stu-id="c6a39-131">This message is a text file, and it will cause an exception.</span></span> <span data-ttu-id="c6a39-132">打开 All_Exceptions （在 \Source\Samples\Exception Handling\Test\Filedrop 文件夹中），名为的文件夹，然后双击以打开到使用适当的模板的 InfoPath 的错误消息。</span><span class="sxs-lookup"><span data-stu-id="c6a39-132">Open the folder named All_Exceptions (in the \Source\Samples\Exception Handling\Test\Filedrop folder), and then double-click the fault message to open it into InfoPath using the appropriate template.</span></span> <span data-ttu-id="c6a39-133">你将看到，ESB 异常处理机制序列化内容适当地以允许 InfoPath 呈现它。</span><span class="sxs-lookup"><span data-stu-id="c6a39-133">You will see that the ESB Exception Handling mechanism serializes the content appropriately to allow InfoPath to render it.</span></span>  
  
5.  <span data-ttu-id="c6a39-134">接下来，将名为转换为 EAIProcess.RequestPort 从文件夹 \Source\Samples\Exception Handling\Test\Data soapmessage [1].xml 文件复制接收位置文件夹。</span><span class="sxs-lookup"><span data-stu-id="c6a39-134">Next, copy the file named soapmessage[1].xml from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location folder.</span></span>  
  
6.  <span data-ttu-id="c6a39-135">此消息是包含 CDATA 节内，一个 XML 文档，它将会引发异常。</span><span class="sxs-lookup"><span data-stu-id="c6a39-135">This message is an XML document that contains a CDATA section, and it will cause an exception.</span></span> <span data-ttu-id="c6a39-136">打开 All_Exceptions 输出文件夹，然后双击以打开到 InfoPath 的错误消息。</span><span class="sxs-lookup"><span data-stu-id="c6a39-136">Open the All_Exceptions output folder and double-click the fault message to open it into InfoPath.</span></span> <span data-ttu-id="c6a39-137">你将看到，ESB 异常处理机制序列化此内容适当地以允许 InfoPath 呈现它。</span><span class="sxs-lookup"><span data-stu-id="c6a39-137">You will see that the ESB Exception Handling mechanism serializes this content appropriately to allow InfoPath to render it.</span></span>  
  
7.  <span data-ttu-id="c6a39-138">最后，将名为 EAIProcess.RequestPort 从文件夹 \Source\Samples\Exception Handling\Test\Data Csqzav01.pdf 文件复制接收位置。</span><span class="sxs-lookup"><span data-stu-id="c6a39-138">Finally, copy the file named Csqzav01.pdf from the folder \Source\Samples\Exception Handling\Test\Data into the EAIProcess.RequestPort receive location.</span></span>  
  
8.  <span data-ttu-id="c6a39-139">此消息为 PDF 文件，并且它将导致异常。</span><span class="sxs-lookup"><span data-stu-id="c6a39-139">This message is a PDF file, and it will cause an exception.</span></span> <span data-ttu-id="c6a39-140">打开 All_Exceptions 输出文件夹并双击该错误消息，以在 InfoPath 中打开它。</span><span class="sxs-lookup"><span data-stu-id="c6a39-140">Open the All_Exceptions output folder and double-click the fault message to open it in InfoPath.</span></span> <span data-ttu-id="c6a39-141">你将看到 ESB 异常处理机制序列化和 Base 64 进行编码的内容，以允许 InfoPath 呈现它。</span><span class="sxs-lookup"><span data-stu-id="c6a39-141">You will see that the ESB Exception Handling mechanism serializes and Base-64 encodes the content to allow InfoPath to render it.</span></span>