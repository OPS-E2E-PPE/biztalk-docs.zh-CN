---
title: "创建自定义适配器提供程序 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: bb93acf8-fd9d-4315-8690-f0c152a954b5
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1f70855621f03011c92be7b04b844122d98be48f
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2017
---
# <a name="creating-a-custom-adapter-provider"></a><span data-ttu-id="65e77-102">创建自定义适配器提供程序</span><span class="sxs-lookup"><span data-stu-id="65e77-102">Creating a Custom Adapter Provider</span></span>
<span data-ttu-id="65e77-103">解析程序执行，如前面几节中所述后，动态解析服务将检查结果是否为终结点 （未转换）。</span><span class="sxs-lookup"><span data-stu-id="65e77-103">After a resolver executes, as described in the previous sections, the dynamic resolution service checks whether the result is an endpoint (not a transformation).</span></span> <span data-ttu-id="65e77-104">如果它是一个终结点，服务实例适配器管理器，它是实例化的**AdapterMgr**类。</span><span class="sxs-lookup"><span data-stu-id="65e77-104">If it is an endpoint, the service instantiates the adapter manager, which is an instance of the **AdapterMgr** class.</span></span>  
  
 <span data-ttu-id="65e77-105">适配器管理器验证和修复的传输类型和出站传输位置。</span><span class="sxs-lookup"><span data-stu-id="65e77-105">The adapter manager validates and fixes the transport type and the outbound transport location.</span></span> <span data-ttu-id="65e77-106">如果传输类型仍未得到解决，并以"http"或"https"开头的 URL，适配器管理器的传输类型设为"WCF WSHttp"。</span><span class="sxs-lookup"><span data-stu-id="65e77-106">If the transport type is still not resolved, and if the URL begins with either "http" or "https", the adapter manager sets the transport type to "WCF-WSHttp".</span></span>  
  
 <span data-ttu-id="65e77-107">接下来，适配器 manager 正在验证的传输类型相当于一个有效的 Microsoft BizTalk Server 适配器，，然后返回其属性命名空间。</span><span class="sxs-lookup"><span data-stu-id="65e77-107">Next, the adapter manager verifies that the transport type equates to a valid Microsoft BizTalk Server adapter, and then it returns its property namespace.</span></span> <span data-ttu-id="65e77-108">此过程只运行一次所有适配器，并将结果存储在缓存中以避免重复的查询的其他使用同一适配器的传入消息。</span><span class="sxs-lookup"><span data-stu-id="65e77-108">This process runs only once for all adapters and stores the results in a cache to avoid repeated queries for other incoming messages that use the same adapter.</span></span>  
  
 <span data-ttu-id="65e77-109">适配器管理器使用的传输类型 (而无需"**://**"后缀) 来确定相应的适配器提供程序。</span><span class="sxs-lookup"><span data-stu-id="65e77-109">The adapter manager uses the transport type (without the "**://**" suffix) to determine the appropriate adapter provider.</span></span> <span data-ttu-id="65e77-110">适配器提供程序是必须实现的自定义程序集**IAdapterProvider**接口。</span><span class="sxs-lookup"><span data-stu-id="65e77-110">An adapter provider is a custom assembly that must implement the **IAdapterProvider** interface.</span></span> <span data-ttu-id="65e77-111">适配器提供程序使用的属性**解析**结构**字典**实例生成的冲突解决程序来设置所有启用的消息的特定于协议的属性Microsoft BizTalk Server 运行时引擎执行动态解析。</span><span class="sxs-lookup"><span data-stu-id="65e77-111">The adapter provider uses the properties of the **Resolution** structure in the **Dictionary** instance generated by the resolver to set all the protocol-specific properties of the message that enables the Microsoft BizTalk Server run-time engine to perform dynamic resolution.</span></span>  
  
 <span data-ttu-id="65e77-112">如与 （上一节中所述，） 的解析程序动态解决机制使用条目 Esb.config 配置文件中查找适配器提供程序。</span><span class="sxs-lookup"><span data-stu-id="65e77-112">Like with the resolver (described in the previous section), the dynamic resolution mechanism uses entries in the Esb.config configuration file to locate adapter providers.</span></span> <span data-ttu-id="65e77-113">下面的 XML 演示配置文件的部分。</span><span class="sxs-lookup"><span data-stu-id="65e77-113">The following XML shows the section of the configuration file.</span></span>  
  
```xml  
<adapterProviders cacheManager= "Adapter Providers Cache Manager"  absoluteExpiration="3600">  
     <adapterProvider name="WCF-WSHttp" type="Microsoft.Practices.ESB.Adapter.WcfWSHttp.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfWSHttp, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="Http,Https" />  
     <adapterProvider name="WCF-BasicHttp" type="Microsoft.Practices.ESB.Adapter.WcfBasicHttp.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfBasicHttp, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="Http,Https" />  
     <adapterProvider name="WCF-Custom" type="Microsoft.Practices.ESB.Adapter.WcfCustom.AdapterProvider, Microsoft.Practices.ESB.Adapter.WcfCustom, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="mssql" />  
     <adapterProvider name="SMTP" type="Microsoft.Practices.ESB.Adapter.SMTP.AdapterProvider, Microsoft.Practices.ESB.Adapter.SMTP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="smtp" />  
     <adapterProvider name="FTP" type="Microsoft.Practices.ESB.Adapter.FTP.AdapterProvider, Microsoft.Practices.ESB.Adapter.FTP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22">  
          <adapterConfig>  
               <add name="DefaultUsername" value="anonymous" />  
               <add name="DefaultPassword" value="" />  
          </adapterConfig>  
     </adapterProvider>  
     <adapterProvider name="MQSeries" type="Microsoft.Practices.ESB.Adapter.MQSeries.AdapterProvider, Microsoft.Practices.ESB.Adapter.MQSeries, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="MQS" adapterAssembly="MQSeries, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />  
     <adapterProvider name="FILE" type="Microsoft.Practices.ESB.Adapter.FILE.AdapterProvider, Microsoft.Practices.ESB.Adapter.FILE, Version=2.0.0.0, Culture=neutral, PublicKeyToken=c62dd63c784d6e22" moniker="File" />  
</adapterProviders>  
```  
  
## <a name="creating-a-custom-adapter-provider"></a><span data-ttu-id="65e77-114">创建自定义适配器提供程序</span><span class="sxs-lookup"><span data-stu-id="65e77-114">Creating a Custom Adapter Provider</span></span>  
 <span data-ttu-id="65e77-115">适配器管理器 (实例**AdapterMgr**类) 的配置文件中的适配器提供程序查找并加载相应的程序集。</span><span class="sxs-lookup"><span data-stu-id="65e77-115">The adapter manager (an instance of the **AdapterMgr** class) looks up the adapter provider in the configuration files and loads the appropriate assembly.</span></span> <span data-ttu-id="65e77-116">动态解决机制缓存的所有已加载的具体实现**IAdapterProvider**接口以避免重复的读取的配置信息和程序集加载时使用多个传入消息同一适配器提供程序。</span><span class="sxs-lookup"><span data-stu-id="65e77-116">The dynamic resolution mechanism caches all loaded concrete implementations of the **IAdapterProvider** interface to avoid repeated reading of configuration information and assembly loading when several incoming messages use the same adapter provider.</span></span>  
  
 <span data-ttu-id="65e77-117">最后，适配器 manager 执行**SetEndPoint**方法的具体实现**IAdapterProvider**接口，并且该管道组件将消息返回到 BizTalk消息框数据库。</span><span class="sxs-lookup"><span data-stu-id="65e77-117">Finally, the adapter manager executes the **SetEndPoint** method of the concrete implementation of the **IAdapterProvider** interface, and the pipeline component returns the message to the BizTalk Message Box database.</span></span>  
  
 <span data-ttu-id="65e77-118">**创建自定义适配器提供程序**</span><span class="sxs-lookup"><span data-stu-id="65e77-118">**To create a custom adapter provider**</span></span>  
  
1.  <span data-ttu-id="65e77-119">创建派生自一个程序集**BaseAdapterProvider**基类和包含**SetEndPoint**设置的终结点的消息上下文属性的方法。</span><span class="sxs-lookup"><span data-stu-id="65e77-119">Create an assembly that derives from the **BaseAdapterProvider** base class and contains a **SetEndPoint** method that sets the endpoint context properties of the message.</span></span>  
  
2.  <span data-ttu-id="65e77-120">通过将其添加到使用 Esb.config 配置文件中注册该适配器提供程序 **\<adapterProvider\>** 替换为作为适配器的名称元素**名称**属性，作为类的完全限定的名称**类型**属性，作为标记**标记**（应该用逗号分隔多个值） 的属性，和 （可选） 的程序集作为实际适配器**adapterAssembly**属性。</span><span class="sxs-lookup"><span data-stu-id="65e77-120">Register the adapter provider by adding it to Esb.config configuration files using an **\<adapterProvider\>** element with a name for the adapter as the **name** attribute, the fully qualified name of the class as the **type** attribute, the moniker as the **moniker** attribute (multiple values should be separated by a comma), and optionally the assembly of the actual adapter as the **adapterAssembly** attribute.</span></span>  
  
3.  <span data-ttu-id="65e77-121">在全局程序集缓存中注册新的程序集。</span><span class="sxs-lookup"><span data-stu-id="65e77-121">Register the new assembly in the global assembly cache.</span></span>