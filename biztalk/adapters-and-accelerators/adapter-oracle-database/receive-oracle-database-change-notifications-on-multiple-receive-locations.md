---
title: "接收到 Oracle 数据库更改通知上多个接收位置 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 6d273517-9527-4208-99be-97c8a92f176d
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a9eec853c133f57320b2ecca106cc497205eda28
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="receive-oracle-database-change-notifications-on-multiple-receive-locations"></a><span data-ttu-id="a0353-102">接收到 Oracle 数据库更改通知上多个接收位置</span><span class="sxs-lookup"><span data-stu-id="a0353-102">Receive Oracle Database change notifications on multiple receive locations</span></span>
<span data-ttu-id="a0353-103">在同一数据库中假设你有多个接收位置不同的 BizTalk 应用程序配置为接收同一个表 (例如 ACCOUNTACTIVITY) 的查询通知的一部分创建的其中一个方案。</span><span class="sxs-lookup"><span data-stu-id="a0353-103">Consider a scenario where you have multiple receive locations created as part of different BizTalk applications configured to receive query notifications for the same table (e.g. ACCOUNTACTIVITY) in the same database.</span></span> <span data-ttu-id="a0353-104">如果上百个记录插入到同一个表中，所有接收位置将都收到通知消息。</span><span class="sxs-lookup"><span data-stu-id="a0353-104">If a hundred records are inserted into the same table, all the receive locations will get the notification message.</span></span> <span data-ttu-id="a0353-105">若要有效地接收通知跨多个接收位置、 可以从 BizTalk 应用程序如果逐个收到通知接收位置的此类的方式调用操作、 其他接收位置不会获取相同的通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-105">To effectively receive notifications across multiple receive locations, you can call operations from your BizTalk application in such a way that if a notification is received by one receive location, the other receive location does not get the same notification.</span></span> <span data-ttu-id="a0353-106">这样，你可以有效地在多个位置上收到的负载平衡通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-106">So, you can effectively load-balance notifications received on multiple locations.</span></span>  
  
 <span data-ttu-id="a0353-107">设置负载平衡接收通知的业务流程所需的任务是与，对于相同[接收 Oracle 数据库更改通知以增量方式使用 BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="a0353-107">The tasks required to set up an orchestration to load-balance receiving notifications are same as that for [Receiving Oracle Database Change Notifications Incrementally Using BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md).</span></span> <span data-ttu-id="a0353-108">本主题列出了唯一两种方法之间的差异。</span><span class="sxs-lookup"><span data-stu-id="a0353-108">This topic lists the only the difference between the two approaches.</span></span>  
  
## <a name="load-balancing-query-notifications-across-multiple-receive-locations"></a><span data-ttu-id="a0353-109">在多个负载平衡查询通知接收位置</span><span class="sxs-lookup"><span data-stu-id="a0353-109">Load-Balancing Query Notifications Across Multiple Receive Locations</span></span>  
 <span data-ttu-id="a0353-110">如主题中[接收 Oracle 数据库更改通知以增量方式使用 BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md)，通过执行 PROCESS_RECORDS 过程配置增量的通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-110">Like in the topic [Receiving Oracle Database Change Notifications Incrementally Using BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md), you configured incremental notifications by executing a PROCESS_RECORDS procedure.</span></span> <span data-ttu-id="a0353-111">若要配置负载平衡，无法执行删除已接到通知有关的记录的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="a0353-111">To configure load-balancing, you could execute a stored procedure that deletes the records that have been notified for.</span></span> <span data-ttu-id="a0353-112">例如，考虑存储的过程 NOTIFY_LOAD_BALANCE 替换为以下定义：</span><span class="sxs-lookup"><span data-stu-id="a0353-112">For example, consider a stored procedure NOTIFY_LOAD_BALANCE with the following definition:</span></span>  
  
```  
PROCEDURE NOTIFY_LOAD_BALANCE (TABLE_DATA OUT SYS_REFCURSOR) IS  
  var int;  
BEGIN  
  SELECT TID INTO var FROM ACCOUNTACTIVITY WHERE ROWNUM = 1 FOR UPDATE;  
  OPEN TABLE_DATA FOR SELECT * FROM ACCOUNTACTIVITY WHERE TID = var;  
  DELETE FROM ACCOUNTACTIVITY WHERE TID = var;  
END NOTIFY_LOAD_BALANCE;  
```  
  
 <span data-ttu-id="a0353-113">BizTalk 应用程序的一部分执行此存储的过程时，获取删除已收到通知时该记录。</span><span class="sxs-lookup"><span data-stu-id="a0353-113">When you execute this stored procedure as part of the BizTalk application, the record for which notification is already received gets deleted.</span></span> <span data-ttu-id="a0353-114">因此，其他接收下一条记录的位置获取的通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-114">So, the other receive location gets notification for the next record.</span></span>  
  
 <span data-ttu-id="a0353-115">以下是配置负载平衡，用于接收通知时必须执行的高级步骤。</span><span class="sxs-lookup"><span data-stu-id="a0353-115">Here are the high-level steps you must perform to configure load-balancing for receiving notifications.</span></span>  
  
1.  <span data-ttu-id="a0353-116">创建架构**通知**（入站操作） 和**NOTIFY_LOAD_BALANCE**过程 （出站操作）。</span><span class="sxs-lookup"><span data-stu-id="a0353-116">Create schema for **Notification** (inbound operation) and **NOTIFY_LOAD_BALANCE** procedure (outbound operation).</span></span>  
  
2.  <span data-ttu-id="a0353-117">添加业务流程，并添加三个消息接收通知，执行过程，以及有关该过程中获取响应。</span><span class="sxs-lookup"><span data-stu-id="a0353-117">Add an orchestration and add three messages for receiving notification, executing the procedure, and getting response for the procedure.</span></span>  
  
3.  <span data-ttu-id="a0353-118">通过添加 Send 和 Receive 形状、 构造消息形状和端口创建业务流程。</span><span class="sxs-lookup"><span data-stu-id="a0353-118">Create an orchestration by adding Send and Receive shapes, Construct Message shape, and ports.</span></span> <span data-ttu-id="a0353-119">可以使用相同的示例代码用于构造一条消息，以调用 NOTIFY_LOAD_BALANCE 存储过程。</span><span class="sxs-lookup"><span data-stu-id="a0353-119">You can use the same sample code for constructing a message to invoke the NOTIFY_LOAD_BALANCE stored procedure.</span></span> <span data-ttu-id="a0353-120">请注意，尽管执行中的操作[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]管理控制台中，您必须拥有位置 C:\TestLocation\MessageIn NOTIFY_LOAD_BALANCE 过程的请求消息。</span><span class="sxs-lookup"><span data-stu-id="a0353-120">Note that while performing the operation in [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console, you must have the request message for the NOTIFY_LOAD_BALANCE procedure in the location C:\TestLocation\MessageIn.</span></span> <span data-ttu-id="a0353-121">这样做是因为在中创建业务流程的一部分调用的代码段[接收 Oracle 数据库更改通知以增量方式使用 BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md)创建根据请求在 C:\ 中存在 XML 请求消息TestLocation\MessageIn。</span><span class="sxs-lookup"><span data-stu-id="a0353-121">You do so because the code snippet you invoke as part of the orchestration created in [Receiving Oracle Database Change Notifications Incrementally Using BizTalk Server](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md) creates a request message based on the request XML present in C:\TestLocation\MessageIn.</span></span>  
  
4.  <span data-ttu-id="a0353-122">生成和部署应用程序。</span><span class="sxs-lookup"><span data-stu-id="a0353-122">Build and deploy the application.</span></span> <span data-ttu-id="a0353-123">若要演示负载平衡，你必须部署此业务流程至少具有两台不同计算机上[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]和[!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)]安装。</span><span class="sxs-lookup"><span data-stu-id="a0353-123">To demonstrate load-balancing, you must deploy this orchestration at least on two different computers that have [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[adapteroracle_short](../../includes/adapteroracle-short-md.md)] installed.</span></span>  
  
5.  <span data-ttu-id="a0353-124">在[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]两台计算机上的管理控制台指定的 WCF 自定义或 WCF OracleDB 的以下绑定属性接收位置：</span><span class="sxs-lookup"><span data-stu-id="a0353-124">In the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] Administration console on both the computers, specify the following binding properties for the WCF-Custom or WCF-OracleDB receive location:</span></span>  
  
    |<span data-ttu-id="a0353-125">绑定属性</span><span class="sxs-lookup"><span data-stu-id="a0353-125">Binding Property</span></span>|<span data-ttu-id="a0353-126">值</span><span class="sxs-lookup"><span data-stu-id="a0353-126">Value</span></span>|  
    |----------------------|-----------|  
    |<span data-ttu-id="a0353-127">**InboundOperationType**</span><span class="sxs-lookup"><span data-stu-id="a0353-127">**InboundOperationType**</span></span>|<span data-ttu-id="a0353-128">将其设置为**通知**。</span><span class="sxs-lookup"><span data-stu-id="a0353-128">Set this to **Notification**.</span></span>|  
    |<span data-ttu-id="a0353-129">**NotificationPort**</span><span class="sxs-lookup"><span data-stu-id="a0353-129">**NotificationPort**</span></span>|<span data-ttu-id="a0353-130">指定 ODP.NET 必须打开侦听从 Oracle 数据库的数据库更改通知的端口号。</span><span class="sxs-lookup"><span data-stu-id="a0353-130">Specifies the port number that ODP.NET must open to listen for database change notification from Oracle database.</span></span> <span data-ttu-id="a0353-131">将其设置为相同的端口号必须已添加到 Windows 防火墙例外列表。</span><span class="sxs-lookup"><span data-stu-id="a0353-131">Set this to the same port number that you must have added to the Windows Firewall exceptions list.</span></span> <span data-ttu-id="a0353-132">有关如何将端口添加到 Windows 防火墙例外列表的说明，请参阅[http://go.microsoft.com/fwlink/?LinkID=196959](http://go.microsoft.com/fwlink/?LinkID=196959)。</span><span class="sxs-lookup"><span data-stu-id="a0353-132">For instructions on how to add ports to Windows Firewall exceptions list, see [http://go.microsoft.com/fwlink/?LinkID=196959](http://go.microsoft.com/fwlink/?LinkID=196959).</span></span> <span data-ttu-id="a0353-133">**重要说明：**如果设置为默认值为-1，则你将需要完全禁用 Windows 防火墙，以接收通知消息。</span><span class="sxs-lookup"><span data-stu-id="a0353-133">**Important:**  If you set this to the default value of -1, you will have to completely disable Windows Firewall to receive notification messages.</span></span>|  
    |<span data-ttu-id="a0353-134">**NotificationStatement**</span><span class="sxs-lookup"><span data-stu-id="a0353-134">**NotificationStatement**</span></span>|<span data-ttu-id="a0353-135">将其设置为：</span><span class="sxs-lookup"><span data-stu-id="a0353-135">Set this to:</span></span><br /><br /> <span data-ttu-id="a0353-136">`SELECT TID,ACCOUNT,PROCESSED FROM SCOTT.ACCOUNTACTIVITY WHERE PROCESSED = ‘n’`**注意：**必须指定表名称以及架构名称。</span><span class="sxs-lookup"><span data-stu-id="a0353-136">`SELECT TID,ACCOUNT,PROCESSED FROM SCOTT.ACCOUNTACTIVITY WHERE PROCESSED = ‘n’` **Note:**  You must specify the table name along with the schema name.</span></span> <span data-ttu-id="a0353-137">例如， `SCOTT.ACCOUNTACTIVITY`。</span><span class="sxs-lookup"><span data-stu-id="a0353-137">For example, `SCOTT.ACCOUNTACTIVITY`.</span></span>|  
    |<span data-ttu-id="a0353-138">**NotifyOnListenerStart**</span><span class="sxs-lookup"><span data-stu-id="a0353-138">**NotifyOnListenerStart**</span></span>|<span data-ttu-id="a0353-139">将其设置为**True**。</span><span class="sxs-lookup"><span data-stu-id="a0353-139">Set this to **True**.</span></span>|  
  
6.  <span data-ttu-id="a0353-140">启动 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="a0353-140">Start the BizTalk application.</span></span>  
  
7.  <span data-ttu-id="a0353-141">若要开始接收通知，请将上百个记录插入 ACCOUNTACTIVITY 表。</span><span class="sxs-lookup"><span data-stu-id="a0353-141">To start receiving notifications, insert a hundred records into the ACCOUNTACTIVITY table.</span></span> <span data-ttu-id="a0353-142">在这样做，请确保请求 XML 调用 NOTIFY_LOAD_BALANCE 过程位于 C:\TestLocation\MessageIn。</span><span class="sxs-lookup"><span data-stu-id="a0353-142">While doing so, make sure the request XML for invoking the NOTIFY_LOAD_BALANCE procedure is available in C:\TestLocation\MessageIn.</span></span>  
  
8.  <span data-ttu-id="a0353-143">监视其中 BizTalk 应用程序将删除为通知消息 （在这两个计算机） 上的位置。</span><span class="sxs-lookup"><span data-stu-id="a0353-143">Monitor the location (on both the computers) where the BizTalk application will be dropping the notification messages.</span></span> <span data-ttu-id="a0353-144">你将注意到，几百个记录插入的一个位置获取一些记录的通知时其他位置获取剩余的记录的通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-144">You will notice that of the hundred records inserted, one location gets notifications for some records while the other location gets notification for the remaining records.</span></span> <span data-ttu-id="a0353-145">在一起，这两个位置将会收到数百个的所有记录的通知。</span><span class="sxs-lookup"><span data-stu-id="a0353-145">Together, both the locations will get notification for all the hundred records.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a0353-146">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a0353-146">See Also</span></span>  
 [<span data-ttu-id="a0353-147">接收以增量方式使用 BizTalk Server 的 Oracle 数据库更改通知</span><span class="sxs-lookup"><span data-stu-id="a0353-147">Receiving Oracle Database Change Notifications Incrementally Using BizTalk Server</span></span>](../../adapters-and-accelerators/adapter-oracle-database/receive-oracle-database-change-notifications-incrementally-using-biztalk-server.md)