---
title: 使用 SQL 适配器的 SQL Server 中轮询 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: c31b3cda-c05e-46db-827b-6c47a53d1a3a
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 7d01bc3d004da60b98e0132aa3c8e04442a45426
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22225845"
---
# <a name="polling-in-sql-server-using-the-sql-adapter"></a><span data-ttu-id="50cd7-102">使用 SQL 适配器的 SQL Server 中轮询</span><span class="sxs-lookup"><span data-stu-id="50cd7-102">Polling in SQL Server using the SQL adapter</span></span>
[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]<span data-ttu-id="50cd7-103">允许适配器客户端接收来自 SQL Server 数据库的数据更改消息。</span><span class="sxs-lookup"><span data-stu-id="50cd7-103"> enables adapter clients to receive data-change messages from the SQL Server database.</span></span> <span data-ttu-id="50cd7-104">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]接收"轮询基于"消息的支持其中适配器执行指定的 SQL 语句 （SELECT 语句或存储的过程），检索或更新的数据，并在结果中提供的定期到适配器客户端时间。</span><span class="sxs-lookup"><span data-stu-id="50cd7-104">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] supports receiving "polling-based" messages wherein the adapter executes a specified SQL statement (SELECT statement or stored procedure), retrieves or updates the data, and provides the result to the adapter client at regular intervals of time.</span></span>  
  
 <span data-ttu-id="50cd7-105">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]公开对轮询执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="50cd7-105">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] exposes the following operations for polling:</span></span>  
  
-   <span data-ttu-id="50cd7-106">**轮询**： 使您能够接收的 SQL Server 表或视图的定期的数据更改消息。</span><span class="sxs-lookup"><span data-stu-id="50cd7-106">**Polling**: Enables you to receive periodic data-change messages for SQL Server tables or views.</span></span> <span data-ttu-id="50cd7-107">消息不是强的类型。</span><span class="sxs-lookup"><span data-stu-id="50cd7-107">The messages are not strongly-typed.</span></span>  
  
-   <span data-ttu-id="50cd7-108">**TypedPolling**： 用于接收从 SQL Server 数据库的强类型化消息。</span><span class="sxs-lookup"><span data-stu-id="50cd7-108">**TypedPolling**: Enables you to receive strongly-typed messages from the SQL Server database.</span></span> <span data-ttu-id="50cd7-109">如果你想要映射到任何其他架构的轮询消息中的元素，则必须使用此操作。</span><span class="sxs-lookup"><span data-stu-id="50cd7-109">You must use this operation if you intend to map the elements in the polling message to any other schema.</span></span>  
  
-   <span data-ttu-id="50cd7-110">**XmlPolling**。</span><span class="sxs-lookup"><span data-stu-id="50cd7-110">**XmlPolling**.</span></span> <span data-ttu-id="50cd7-111">可以使用 SELECT 语句或存储的过程，使用 FOR XML 子句和 XML 消息的形式返回数据。</span><span class="sxs-lookup"><span data-stu-id="50cd7-111">Enables you to use SELECT statements or stored procedures that use a FOR XML clause and return data as XML messages.</span></span> <span data-ttu-id="50cd7-112">此操作返回作为 XML 消息的轮询消息。</span><span class="sxs-lookup"><span data-stu-id="50cd7-112">This operation returns the polling message as an XML message.</span></span>  
  
     <span data-ttu-id="50cd7-113">有关 FOR XML 子句的详细信息，请参阅[http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402)。</span><span class="sxs-lookup"><span data-stu-id="50cd7-113">For more information about FOR XML clause, see [http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402).</span></span>  
  
 <span data-ttu-id="50cd7-114">有关中的轮询的详细信息[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]，请参阅[从通过使用 BizTalk Server 的 SQL Server 基于接收轮询的数据更改消息](../../adapters-and-accelerators/adapter-sql/receive-polling-based-data-changed-messages-from-sql-server-using-biztalk.md)。</span><span class="sxs-lookup"><span data-stu-id="50cd7-114">For more information about polling in the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)], see [Receive Polling-based Data-changed Messages from SQL Server by Using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-polling-based-data-changed-messages-from-sql-server-using-biztalk.md).</span></span>  
  
## <a name="polling"></a><span data-ttu-id="50cd7-115">轮询</span><span class="sxs-lookup"><span data-stu-id="50cd7-115">Polling</span></span>  
 <span data-ttu-id="50cd7-116">典型轮询操作使用[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]涉及下列：</span><span class="sxs-lookup"><span data-stu-id="50cd7-116">A typical polling operation using the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] involves the following:</span></span>  
  
1.  <span data-ttu-id="50cd7-117">适配器客户端必须指定`Polling`中的入站操作作为**InboundOperationType**绑定属性。</span><span class="sxs-lookup"><span data-stu-id="50cd7-117">The adapter clients must specify `Polling` as the inbound operation in the **InboundOperationType** binding property.</span></span> <span data-ttu-id="50cd7-118">此绑定属性的默认值是`Polling`。</span><span class="sxs-lookup"><span data-stu-id="50cd7-118">The default value for this binding property is `Polling`.</span></span>  
  
2.  <span data-ttu-id="50cd7-119">适配器客户端必须指定 SQL 语句中的以便**PolledDataAvailableStatement**绑定属性，用于确定是否存在可用于轮询数据。</span><span class="sxs-lookup"><span data-stu-id="50cd7-119">The adapter clients must specify a SQL statement for the **PolledDataAvailableStatement** binding property that determines whether there is data available for polling.</span></span> <span data-ttu-id="50cd7-120">第一个返回的结果集上执行此语句的第一行的第一列包含一个整数值。</span><span class="sxs-lookup"><span data-stu-id="50cd7-120">The first column of the first row of the first result set returned on executing this statement contains an integer value.</span></span> <span data-ttu-id="50cd7-121">如果没有任何数据可用于轮询，返回值为 0 （零）。</span><span class="sxs-lookup"><span data-stu-id="50cd7-121">If there is no data available for polling, the return value is 0 (zero).</span></span> <span data-ttu-id="50cd7-122">如果没有可用的数据，则返回值是大于零。</span><span class="sxs-lookup"><span data-stu-id="50cd7-122">If there is data available, the return value is greater than zero.</span></span>  
  
3.  <span data-ttu-id="50cd7-123">适配器客户端必须指定一个轮询间隔以供**PollingIntervalInSeconds**绑定属性来定义的间隔中的语句**PolledDataAvailableStatement**绑定执行属性。</span><span class="sxs-lookup"><span data-stu-id="50cd7-123">The adapter clients must specify a polling interval for the **PollingIntervalInSeconds** binding property to define the interval at which the statement in the **PolledDataAvailableStatement** binding property is executed.</span></span> <span data-ttu-id="50cd7-124">在每个轮询间隔结束时，执行轮询的数据可用语句，并返回的结果集。</span><span class="sxs-lookup"><span data-stu-id="50cd7-124">At the end of every polling interval, the polled data available statement is executed, and the result set is returned.</span></span>  
  
4.  <span data-ttu-id="50cd7-125">适配器客户端必须为指定轮询 SQL 语句 （SELECT 语句或存储的过程） **PollingStatement**绑定属性。</span><span class="sxs-lookup"><span data-stu-id="50cd7-125">The adapter clients must specify a polling SQL statement (SELECT statement or stored procedure) for the **PollingStatement** binding property.</span></span> <span data-ttu-id="50cd7-126">如果没有可用于轮询的数据 (由**PolledDataAvailableStatement**绑定属性)，适配器执行轮询语句，以获取以及更新 （如果适用） 中的 SQL Server 数据库的数据。</span><span class="sxs-lookup"><span data-stu-id="50cd7-126">If there is data available for polling (determined by the **PolledDataAvailableStatement** binding property), the adapter executes the polling statement to obtain and update (if applicable) the data in the SQL Server database.</span></span> <span data-ttu-id="50cd7-127">当[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]用于[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]，也使用同一个事务提交邮件进行[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="50cd7-127">When the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] is used with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], the same transaction is also used to submit the message to [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
5.  <span data-ttu-id="50cd7-128">适配器客户端可以使用**PollWhileDataFound**绑定忽略轮询间隔，并持续轮询数据，和时可用的属性。</span><span class="sxs-lookup"><span data-stu-id="50cd7-128">The adapter clients can use the **PollWhileDataFound** binding property to ignore the polling interval, and continuously poll data, as and when available.</span></span>  
  
6.  <span data-ttu-id="50cd7-129">作为执行轮询语句的结果而返回的结果集为入站消息发送到适配器客户端。</span><span class="sxs-lookup"><span data-stu-id="50cd7-129">The result sets that are returned as a result of executing the polling statement are sent to the adapter client as the inbound message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="50cd7-130">XmlPolling 运算涉及轮询操作与相同的步骤。</span><span class="sxs-lookup"><span data-stu-id="50cd7-130">An XmlPolling operation involves the same steps as the Polling operation.</span></span>  
  
## <a name="strongly-typed-polling"></a><span data-ttu-id="50cd7-131">强类型轮询</span><span class="sxs-lookup"><span data-stu-id="50cd7-131">Strongly-Typed Polling</span></span>  
 <span data-ttu-id="50cd7-132">典型的强类型轮询操作使用[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]涉及下列：</span><span class="sxs-lookup"><span data-stu-id="50cd7-132">A typical strongly-typed polling operation using the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] involves the following:</span></span>  
  
1.  <span data-ttu-id="50cd7-133">适配器客户端必须指定`TypedPolling`中的入站操作作为**InboundOperationType**绑定属性。</span><span class="sxs-lookup"><span data-stu-id="50cd7-133">The adapter clients must specify `TypedPolling` as the inbound operation in the **InboundOperationType** binding property.</span></span> <span data-ttu-id="50cd7-134">此绑定属性的默认值是`Polling`。</span><span class="sxs-lookup"><span data-stu-id="50cd7-134">The default value for this binding property is `Polling`.</span></span>  
  
2.  <span data-ttu-id="50cd7-135">适配器客户端必须指定连接 URI 的一部分的入站的 ID。</span><span class="sxs-lookup"><span data-stu-id="50cd7-135">The adapter clients must specify an inbound ID as part of the connection URI.</span></span> <span data-ttu-id="50cd7-136">入站的 ID 可以是任意字符串，并附加到 TypedPolling 操作以避免命名空间冲突的标准命名空间。</span><span class="sxs-lookup"><span data-stu-id="50cd7-136">The inbound ID could be any string and is appended to the standard namespace of the TypedPolling operation to prevent namespace collisions.</span></span>  
  
3.  <span data-ttu-id="50cd7-137">余下的步骤是步骤 2-6 中前面部分所述轮询操作列出与相同的。</span><span class="sxs-lookup"><span data-stu-id="50cd7-137">The rest of the steps are same as steps 2–6 listed in the Polling operation described in the preceding section.</span></span>  
  
 <span data-ttu-id="50cd7-138">有关与轮询和强类型轮询相关的绑定属性的详细信息，请参阅[了解针对 SQL Server 适配器绑定属性的 BizTalk 适配器](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="50cd7-138">For detailed information about the binding properties related to polling and strongly-typed polling, see [Read about BizTalk Adapter for SQL Server adapter  Binding Properties](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="50cd7-139">可以作为执行轮询语句的结果而返回多个结果集。</span><span class="sxs-lookup"><span data-stu-id="50cd7-139">Multiple result sets can be returned as a result of executing the polling statement.</span></span> <span data-ttu-id="50cd7-140">如果结果集不包含任何行，任何消息被不发送到适配器客户端。</span><span class="sxs-lookup"><span data-stu-id="50cd7-140">If the result sets do not contain any rows, no messages are sent to the adapter client.</span></span>  
  
 <span data-ttu-id="50cd7-141">下图提供有关中的轮询工作流信息[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="50cd7-141">The illustration below provides information about the polling workflow in [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)].</span></span> <span data-ttu-id="50cd7-142">轮询工作流的两种方案图所示：</span><span class="sxs-lookup"><span data-stu-id="50cd7-142">Two scenarios for the polling workflow are illustrated:</span></span>  
  
1.  <span data-ttu-id="50cd7-143">时的值**PollWhileDataFound**设置为"False"（默认设置）。</span><span class="sxs-lookup"><span data-stu-id="50cd7-143">When the value of the **PollWhileDataFound** is set to “False” (default setting).</span></span>  
  
2.  <span data-ttu-id="50cd7-144">时的值**PollWhileDataFound**设置为"True"。</span><span class="sxs-lookup"><span data-stu-id="50cd7-144">When the value of the **PollWhileDataFound** is set to “True.”</span></span>  
  
 <span data-ttu-id="50cd7-145">![轮询工作流 &#40;PollWhileDataFound &#61;False &#41;] (../../adapters-and-accelerators/adapter-sql/media/15598c14-3a62-4b8d-90bf-84e004a386db.gif "15598c14-3a62-4b8d-90bf-84e004a386db") ![轮询工作流 &#40;PollWhileDataFound &#61;True &#41;] (../../adapters-and-accelerators/adapter-sql/media/c20535be-ea45-4456-8b62-4d4585cb1d8c.gif "c20535be-ea45-4456-8b62-4d4585cb1d8c")</span><span class="sxs-lookup"><span data-stu-id="50cd7-145">![Polling Workflow &#40;PollWhileDataFound &#61; False&#41;](../../adapters-and-accelerators/adapter-sql/media/15598c14-3a62-4b8d-90bf-84e004a386db.gif "15598c14-3a62-4b8d-90bf-84e004a386db") ![Polling Workflow &#40;PollWhileDataFound &#61; True&#41;](../../adapters-and-accelerators/adapter-sql/media/c20535be-ea45-4456-8b62-4d4585cb1d8c.gif "c20535be-ea45-4456-8b62-4d4585cb1d8c")</span></span>  
  
## <a name="differences-between-polling-and-query-notification"></a><span data-ttu-id="50cd7-146">轮询和查询通知之间的差异</span><span class="sxs-lookup"><span data-stu-id="50cd7-146">Differences between Polling and Query Notification</span></span>  
 <span data-ttu-id="50cd7-147">尽管轮询和查询通知这两个入站的操作，并且 SQL Server 数据库中的数据更改通知适配器客户端下, 表列出这两者之间的一些差异。</span><span class="sxs-lookup"><span data-stu-id="50cd7-147">Though polling and query notification are both inbound operations, and inform the adapter clients about the data changes in the SQL Server database, the following table lists some differences between the two.</span></span> <span data-ttu-id="50cd7-148">以下差异将帮助你决定在具体取决于你的要求操作：</span><span class="sxs-lookup"><span data-stu-id="50cd7-148">The following differences will help you decide on an operation depending on your requirements:</span></span>  
  
|<span data-ttu-id="50cd7-149">轮询</span><span class="sxs-lookup"><span data-stu-id="50cd7-149">Polling</span></span>|<span data-ttu-id="50cd7-150">查询通知</span><span class="sxs-lookup"><span data-stu-id="50cd7-150">Query Notification</span></span>|  
|-------------|------------------------|  
|<span data-ttu-id="50cd7-151">轮询启动的适配器。</span><span class="sxs-lookup"><span data-stu-id="50cd7-151">Polling is initiated by the adapter.</span></span> <span data-ttu-id="50cd7-152">适配器执行一个语句来验证是否数据可用于轮询，并随后通过执行轮询语句，如果某些数据可用于轮询开始轮询。</span><span class="sxs-lookup"><span data-stu-id="50cd7-152">The adapter executes a statement to validate whether data is available for polling, and then initiates polling by executing the polling statement if some data is available for polling.</span></span>|<span data-ttu-id="50cd7-153">通过 SQL Server 启动的查询通知。</span><span class="sxs-lookup"><span data-stu-id="50cd7-153">Query notification is initiated by SQL Server.</span></span> <span data-ttu-id="50cd7-154">只需适配器发出的通知语句指示要在该语句结果集中的更改的情况下启动通知的数据库。</span><span class="sxs-lookup"><span data-stu-id="50cd7-154">The notification statement issued by the adapter just instructs the database to initiate notification in case there is a change in the result set of the statement.</span></span>|  
|<span data-ttu-id="50cd7-155">轮询语句可用于读取或更新 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="50cd7-155">You can use the polling statement to read or update data in a SQL Server database table.</span></span>|<span data-ttu-id="50cd7-156">可以使用查询通知语句仅具有读取 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="50cd7-156">You can use the query notification statement to only read data in a SQL Server database table.</span></span>|  
|<span data-ttu-id="50cd7-157">轮询通知你有关已更改的实际数据信息。</span><span class="sxs-lookup"><span data-stu-id="50cd7-157">Polling informs you about the actual data that has changed.</span></span>|<span data-ttu-id="50cd7-158">查询通知只会通知有关类型的更改数据，例如插入、 更新和删除。</span><span class="sxs-lookup"><span data-stu-id="50cd7-158">Query notification only informs about the type of change in the data such as Insert, Update, and Delete.</span></span>|  
|<span data-ttu-id="50cd7-159">数据更改通知取决于轮询间隔，并且在每个轮询间隔的末尾，有关数据更改的适配器客户端通知。</span><span class="sxs-lookup"><span data-stu-id="50cd7-159">The data-change notification depends on the polling interval, and the adapter clients are informed about the data changes at the end of every polling interval.</span></span> <span data-ttu-id="50cd7-160">**提示：** 轮询可以为你提供更佳的吞吐量在数据更改发生连续，并且不希望为每项更改的和发生时要通知的情况下。</span><span class="sxs-lookup"><span data-stu-id="50cd7-160">**Tip:**  Polling can give you better throughput in scenarios where the data changes are happening continuously, and you do not want to be notified of each change as and when it happens.</span></span> <span data-ttu-id="50cd7-161">作为替代，你指定要在其后自最后一个的数据更改通知以来发生的所有更改的通知轮询间隔。</span><span class="sxs-lookup"><span data-stu-id="50cd7-161">Instead, you specify a polling interval after which you want to be notified of all the changes that have happened since the last data-change notification.</span></span>|<span data-ttu-id="50cd7-162">数据更改通知是即时的。</span><span class="sxs-lookup"><span data-stu-id="50cd7-162">The data-change notification is instantaneous.</span></span>|  
  
 <span data-ttu-id="50cd7-163">有关中的查询通知的详细信息[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]，请参阅[使用 BizTalk server 接收 SQL 的查询通知](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="50cd7-163">For more information about query notification in [!INCLUDE[adaptersql](../../includes/adaptersql-md.md)], see [Receive SQL Query Notifications by Using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="50cd7-164">另请参阅</span><span class="sxs-lookup"><span data-stu-id="50cd7-164">See Also</span></span>  
 <span data-ttu-id="50cd7-165">[哪些操作可以是执行使用适配器？](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span><span class="sxs-lookup"><span data-stu-id="50cd7-165">[What Operations Can be Performed Using the Adapter?](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span></span>