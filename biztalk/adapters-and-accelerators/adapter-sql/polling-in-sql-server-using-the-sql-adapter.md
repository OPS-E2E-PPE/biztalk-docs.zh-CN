---
title: 在使用 SQL 适配器的 SQL Server 中轮询 |Microsoft Docs
ms.custom: ''
ms.date: 01/18/2019
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: c31b3cda-c05e-46db-827b-6c47a53d1a3a
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia,niklase
manager: anneta
ms.openlocfilehash: 80e9251babad12915ce9d9f1ad7662ec90db4eff
ms.sourcegitcommit: 729299182b56758d01f4a4b9834616dbbdc0c014
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/01/2019
ms.locfileid: "58764561"
---
# <a name="polling-in-sql-server-using-the-sql-adapter"></a><span data-ttu-id="bb280-102">在使用 SQL 适配器的 SQL Server 中轮询</span><span class="sxs-lookup"><span data-stu-id="bb280-102">Polling in SQL Server using the SQL adapter</span></span>
[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)] <span data-ttu-id="bb280-103">允许适配器客户端接收来自 SQL Server 数据库的数据更改消息。</span><span class="sxs-lookup"><span data-stu-id="bb280-103">enables adapter clients to receive data-change messages from the SQL Server database.</span></span> <span data-ttu-id="bb280-104">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]支持接收"基于轮询的"消息其中适配器执行指定的 SQL 语句 （SELECT 语句或存储的过程），检索或更新的数据，并按固定间隔的适配器客户端提供的结果时间。</span><span class="sxs-lookup"><span data-stu-id="bb280-104">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] supports receiving "polling-based" messages wherein the adapter executes a specified SQL statement (SELECT statement or stored procedure), retrieves or updates the data, and provides the result to the adapter client at regular intervals of time.</span></span>  
  
 <span data-ttu-id="bb280-105">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]公开的轮询的以下操作：</span><span class="sxs-lookup"><span data-stu-id="bb280-105">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] exposes the following operations for polling:</span></span>  
  
- <span data-ttu-id="bb280-106">**轮询**:可以接收定期的数据更改消息的 SQL Server 表或视图。</span><span class="sxs-lookup"><span data-stu-id="bb280-106">**Polling**: Enables you to receive periodic data-change messages for SQL Server tables or views.</span></span> <span data-ttu-id="bb280-107">消息不是强的类型。</span><span class="sxs-lookup"><span data-stu-id="bb280-107">The messages are not strongly-typed.</span></span>  
  
- <span data-ttu-id="bb280-108">**TypedPolling**:可以接收来自 SQL Server 数据库的强类型化消息。</span><span class="sxs-lookup"><span data-stu-id="bb280-108">**TypedPolling**: Enables you to receive strongly-typed messages from the SQL Server database.</span></span> <span data-ttu-id="bb280-109">如果你想要将轮询消息中的元素映射到任何其他架构，则必须使用此操作。</span><span class="sxs-lookup"><span data-stu-id="bb280-109">You must use this operation if you intend to map the elements in the polling message to any other schema.</span></span>  
  
- <span data-ttu-id="bb280-110">**XmlPolling**。</span><span class="sxs-lookup"><span data-stu-id="bb280-110">**XmlPolling**.</span></span> <span data-ttu-id="bb280-111">可以使用 SELECT 语句或存储的过程使用 FOR XML 子句，并以 XML 消息形式返回数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-111">Enables you to use SELECT statements or stored procedures that use a FOR XML clause and return data as XML messages.</span></span> <span data-ttu-id="bb280-112">此操作将返回作为 XML 消息轮询消息。</span><span class="sxs-lookup"><span data-stu-id="bb280-112">This operation returns the polling message as an XML message.</span></span>  
  
   <span data-ttu-id="bb280-113">有关 FOR XML 子句的详细信息，请参阅[ http://go.microsoft.com/fwlink/?LinkId=131402 ](http://go.microsoft.com/fwlink/?LinkId=131402)。</span><span class="sxs-lookup"><span data-stu-id="bb280-113">For more information about FOR XML clause, see [http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402).</span></span>  
  
  <span data-ttu-id="bb280-114">详细了解在轮询[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]，请参阅[从 SQL Server 使用 BizTalk server 基于接收轮询的数据更改消息](../../adapters-and-accelerators/adapter-sql/receive-polling-based-data-changed-messages-from-sql-server-using-biztalk.md)。</span><span class="sxs-lookup"><span data-stu-id="bb280-114">For more information about polling in the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)], see [Receive Polling-based Data-changed Messages from SQL Server by Using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-polling-based-data-changed-messages-from-sql-server-using-biztalk.md).</span></span>  
  
## <a name="polling"></a><span data-ttu-id="bb280-115">轮询</span><span class="sxs-lookup"><span data-stu-id="bb280-115">Polling</span></span>  
 <span data-ttu-id="bb280-116">典型轮询操作使用[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]涉及以下：</span><span class="sxs-lookup"><span data-stu-id="bb280-116">A typical polling operation using the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] involves the following:</span></span>  
  
1. <span data-ttu-id="bb280-117">适配器客户端必须指定`Polling`中的入站操作**InboundOperationType**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="bb280-117">The adapter clients must specify `Polling` as the inbound operation in the **InboundOperationType** binding property.</span></span> <span data-ttu-id="bb280-118">此绑定属性的默认值是`Polling`。</span><span class="sxs-lookup"><span data-stu-id="bb280-118">The default value for this binding property is `Polling`.</span></span>  
  
2. <span data-ttu-id="bb280-119">适配器客户端必须指定 SQL 语句中的以便**PolledDataAvailableStatement**绑定属性，用于确定是否存在可用于轮询数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-119">The adapter clients must specify a SQL statement for the **PolledDataAvailableStatement** binding property that determines whether there is data available for polling.</span></span> <span data-ttu-id="bb280-120">第一个返回的结果集上执行该语句的第一行的第一列包含一个整数值。</span><span class="sxs-lookup"><span data-stu-id="bb280-120">The first column of the first row of the first result set returned on executing this statement contains an integer value.</span></span> <span data-ttu-id="bb280-121">如果没有可用于轮询的数据，返回值为 0 （零）。</span><span class="sxs-lookup"><span data-stu-id="bb280-121">If there is no data available for polling, the return value is 0 (zero).</span></span> <span data-ttu-id="bb280-122">如果没有可用的数据，则返回值是大于零。</span><span class="sxs-lookup"><span data-stu-id="bb280-122">If there is data available, the return value is greater than zero.</span></span>  
  
3. <span data-ttu-id="bb280-123">适配器客户端必须指定为一个轮询间隔**PollingIntervalInSeconds**绑定属性来定义的时间间隔中的语句**PolledDataAvailableStatement**绑定执行属性。</span><span class="sxs-lookup"><span data-stu-id="bb280-123">The adapter clients must specify a polling interval for the **PollingIntervalInSeconds** binding property to define the interval at which the statement in the **PolledDataAvailableStatement** binding property is executed.</span></span> <span data-ttu-id="bb280-124">在每个轮询间隔结束时，执行轮询的数据可用语句，并返回的结果集。</span><span class="sxs-lookup"><span data-stu-id="bb280-124">At the end of every polling interval, the polled data available statement is executed, and the result set is returned.</span></span>  
  
4. <span data-ttu-id="bb280-125">适配器客户端必须为指定的轮询 SQL 语句 （SELECT 语句或存储的过程） **PollingStatement**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="bb280-125">The adapter clients must specify a polling SQL statement (SELECT statement or stored procedure) for the **PollingStatement** binding property.</span></span> <span data-ttu-id="bb280-126">如果没有可用于轮询的数据 (由**PolledDataAvailableStatement**属性绑定)，适配器将执行轮询语句来获取和更新 （如果适用） SQL Server 数据库中的数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-126">If there is data available for polling (determined by the **PolledDataAvailableStatement** binding property), the adapter executes the polling statement to obtain and update (if applicable) the data in the SQL Server database.</span></span> <span data-ttu-id="bb280-127">当[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]用于[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]，在同一个事务还用于将消息提交给[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="bb280-127">When the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] is used with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], the same transaction is also used to submit the message to [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span>  
  
5. <span data-ttu-id="bb280-128">适配器客户端可以使用**PollWhileDataFound**属性要忽略的轮询间隔，并连续轮询数据，以及可用时绑定。</span><span class="sxs-lookup"><span data-stu-id="bb280-128">The adapter clients can use the **PollWhileDataFound** binding property to ignore the polling interval, and continuously poll data, as and when available.</span></span>  
  
6. <span data-ttu-id="bb280-129">作为执行轮询语句的结果而返回的结果集为入站消息发送到适配器客户端。</span><span class="sxs-lookup"><span data-stu-id="bb280-129">The result sets that are returned as a result of executing the polling statement are sent to the adapter client as the inbound message.</span></span>  

> [!NOTE]
>  <span data-ttu-id="bb280-130">当**UseAmbientTransaction**设置为 False， **PolledDataAvailableStatement**不调用。</span><span class="sxs-lookup"><span data-stu-id="bb280-130">When **UseAmbientTransaction** is set to False, the **PolledDataAvailableStatement** isn't called.</span></span> <span data-ttu-id="bb280-131">相反，适配器直接调用**PollingStatement**。</span><span class="sxs-lookup"><span data-stu-id="bb280-131">Instead, the adapter directly calls the **PollingStatement**.</span></span>

> [!NOTE]
>  <span data-ttu-id="bb280-132">XmlPolling 操作涉及到与轮询操作相同的步骤。</span><span class="sxs-lookup"><span data-stu-id="bb280-132">An XmlPolling operation involves the same steps as the Polling operation.</span></span>  
  
## <a name="strongly-typed-polling"></a><span data-ttu-id="bb280-133">强类型轮询</span><span class="sxs-lookup"><span data-stu-id="bb280-133">Strongly-Typed Polling</span></span>  
 <span data-ttu-id="bb280-134">典型的强类型轮询操作使用[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]涉及以下：</span><span class="sxs-lookup"><span data-stu-id="bb280-134">A typical strongly-typed polling operation using the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] involves the following:</span></span>  
  
1. <span data-ttu-id="bb280-135">适配器客户端必须指定`TypedPolling`中的入站操作**InboundOperationType**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="bb280-135">The adapter clients must specify `TypedPolling` as the inbound operation in the **InboundOperationType** binding property.</span></span> <span data-ttu-id="bb280-136">此绑定属性的默认值是`Polling`。</span><span class="sxs-lookup"><span data-stu-id="bb280-136">The default value for this binding property is `Polling`.</span></span>  
  
2. <span data-ttu-id="bb280-137">适配器客户端必须指定连接 URI 的一部分的入站的 ID。</span><span class="sxs-lookup"><span data-stu-id="bb280-137">The adapter clients must specify an inbound ID as part of the connection URI.</span></span> <span data-ttu-id="bb280-138">入站的 ID 可以是任意字符串，并追加到 TypedPolling 操作以避免命名空间冲突的标准命名空间。</span><span class="sxs-lookup"><span data-stu-id="bb280-138">The inbound ID could be any string and is appended to the standard namespace of the TypedPolling operation to prevent namespace collisions.</span></span>  
  
3. <span data-ttu-id="bb280-139">步骤 2 – 6 中前面部分中描述的轮询操作列出与相同的剩余步骤。</span><span class="sxs-lookup"><span data-stu-id="bb280-139">The rest of the steps are same as steps 2–6 listed in the Polling operation described in the preceding section.</span></span>  
  
   <span data-ttu-id="bb280-140">有关与轮询和强类型轮询的绑定属性的详细信息，请参阅[了解关于 BizTalk Adapter for SQL Server 适配器绑定属性](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="bb280-140">For detailed information about the binding properties related to polling and strongly-typed polling, see [Read about BizTalk Adapter for SQL Server adapter  Binding Properties](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bb280-141">由于执行轮询语句可以返回多个结果集。</span><span class="sxs-lookup"><span data-stu-id="bb280-141">Multiple result sets can be returned as a result of executing the polling statement.</span></span> <span data-ttu-id="bb280-142">如果结果集不包含任何行，任何消息都不发送到适配器客户端。</span><span class="sxs-lookup"><span data-stu-id="bb280-142">If the result sets do not contain any rows, no messages are sent to the adapter client.</span></span>  
  
 <span data-ttu-id="bb280-143">下图提供了有关中的轮询工作流信息[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="bb280-143">The illustration below provides information about the polling workflow in [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)].</span></span> <span data-ttu-id="bb280-144">轮询工作流的两种方案是所示：</span><span class="sxs-lookup"><span data-stu-id="bb280-144">Two scenarios for the polling workflow are illustrated:</span></span>  
  
1. <span data-ttu-id="bb280-145">时的值**PollWhileDataFound**设置为"False"（默认设置）。</span><span class="sxs-lookup"><span data-stu-id="bb280-145">When the value of the **PollWhileDataFound** is set to “False” (default setting).</span></span>  
  
2. <span data-ttu-id="bb280-146">时的值**PollWhileDataFound**设置为"True。</span><span class="sxs-lookup"><span data-stu-id="bb280-146">When the value of the **PollWhileDataFound** is set to “True.”</span></span>  
  
   <span data-ttu-id="bb280-147">![轮询工作流&#40;PollWhileDataFound &#61; False&#41;](../../adapters-and-accelerators/adapter-sql/media/15598c14-3a62-4b8d-90bf-84e004a386db.gif "15598c14-3a62-4b8d-90bf-84e004a386db") ![轮询工作流&#40;PollWhileDataFound &#61; True&#41; ](../../adapters-and-accelerators/adapter-sql/media/c20535be-ea45-4456-8b62-4d4585cb1d8c.gif "c20535be-ea45-4456-8b62-4d4585cb1d8c")</span><span class="sxs-lookup"><span data-stu-id="bb280-147">![Polling Workflow &#40;PollWhileDataFound &#61; False&#41;](../../adapters-and-accelerators/adapter-sql/media/15598c14-3a62-4b8d-90bf-84e004a386db.gif "15598c14-3a62-4b8d-90bf-84e004a386db") ![Polling Workflow &#40;PollWhileDataFound &#61; True&#41;](../../adapters-and-accelerators/adapter-sql/media/c20535be-ea45-4456-8b62-4d4585cb1d8c.gif "c20535be-ea45-4456-8b62-4d4585cb1d8c")</span></span>  
  
## <a name="differences-between-polling-and-query-notification"></a><span data-ttu-id="bb280-148">轮询查询通知之间的差异</span><span class="sxs-lookup"><span data-stu-id="bb280-148">Differences between Polling and Query Notification</span></span>  
 <span data-ttu-id="bb280-149">尽管轮询和查询通知是这两个入站的操作，并在 SQL Server 数据库中的数据更改通知适配器客户端下, 表列出了两者之间的一些差异。</span><span class="sxs-lookup"><span data-stu-id="bb280-149">Though polling and query notification are both inbound operations, and inform the adapter clients about the data changes in the SQL Server database, the following table lists some differences between the two.</span></span> <span data-ttu-id="bb280-150">以下差异将帮助你决定具体取决于您的要求操作：</span><span class="sxs-lookup"><span data-stu-id="bb280-150">The following differences will help you decide on an operation depending on your requirements:</span></span>  
  
|<span data-ttu-id="bb280-151">轮询</span><span class="sxs-lookup"><span data-stu-id="bb280-151">Polling</span></span>|<span data-ttu-id="bb280-152">查询通知</span><span class="sxs-lookup"><span data-stu-id="bb280-152">Query Notification</span></span>|  
|-------------|------------------------|  
|<span data-ttu-id="bb280-153">由适配器启动轮询。</span><span class="sxs-lookup"><span data-stu-id="bb280-153">Polling is initiated by the adapter.</span></span> <span data-ttu-id="bb280-154">适配器执行语句，以验证是否可用于轮询，然后通过执行轮询语句，如果某些数据可用于轮询启动轮询数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-154">The adapter executes a statement to validate whether data is available for polling, and then initiates polling by executing the polling statement if some data is available for polling.</span></span>|<span data-ttu-id="bb280-155">查询通知是由 SQL Server 启动。</span><span class="sxs-lookup"><span data-stu-id="bb280-155">Query notification is initiated by SQL Server.</span></span> <span data-ttu-id="bb280-156">只需在适配器发出的通知语句指示要在没有语句的结果集中的更改的情况下启动通知的数据库。</span><span class="sxs-lookup"><span data-stu-id="bb280-156">The notification statement issued by the adapter just instructs the database to initiate notification in case there is a change in the result set of the statement.</span></span>|  
|<span data-ttu-id="bb280-157">轮询语句可用于读取或更新 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-157">You can use the polling statement to read or update data in a SQL Server database table.</span></span>|<span data-ttu-id="bb280-158">可以使用查询通知语句仅读取 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-158">You can use the query notification statement to only read data in a SQL Server database table.</span></span>|  
|<span data-ttu-id="bb280-159">轮询通知您已更改的实际数据。</span><span class="sxs-lookup"><span data-stu-id="bb280-159">Polling informs you about the actual data that has changed.</span></span>|<span data-ttu-id="bb280-160">查询通知只会通知有关类型的更改数据，例如插入、 更新和删除。</span><span class="sxs-lookup"><span data-stu-id="bb280-160">Query notification only informs about the type of change in the data such as Insert, Update, and Delete.</span></span>|  
|<span data-ttu-id="bb280-161">数据更改通知取决于轮询间隔，并且适配器客户端将每个轮询间隔结束时通知数据更改。</span><span class="sxs-lookup"><span data-stu-id="bb280-161">The data-change notification depends on the polling interval, and the adapter clients are informed about the data changes at the end of every polling interval.</span></span> <span data-ttu-id="bb280-162">**提示：** 轮询可以提供更好的吞吐量中情况下，数据更改发生的连续，并且不希望为每个更改的和发生时收到通知。</span><span class="sxs-lookup"><span data-stu-id="bb280-162">**Tip:**  Polling can give you better throughput in scenarios where the data changes are happening continuously, and you do not want to be notified of each change as and when it happens.</span></span> <span data-ttu-id="bb280-163">相反，您指定要在其后自上次数据更改通知以来已发生的所有更改的通知轮询间隔。</span><span class="sxs-lookup"><span data-stu-id="bb280-163">Instead, you specify a polling interval after which you want to be notified of all the changes that have happened since the last data-change notification.</span></span>|<span data-ttu-id="bb280-164">数据更改通知是瞬间完成的。</span><span class="sxs-lookup"><span data-stu-id="bb280-164">The data-change notification is instantaneous.</span></span>|  
  
 <span data-ttu-id="bb280-165">有关详细信息中的查询通知[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]，请参阅[通过使用 BizTalk Server 接收 SQL 查询通知](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="bb280-165">For more information about query notification in [!INCLUDE[adaptersql](../../includes/adaptersql-md.md)], see [Receive SQL Query Notifications by Using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bb280-166">请参阅</span><span class="sxs-lookup"><span data-stu-id="bb280-166">See Also</span></span>  
 <span data-ttu-id="bb280-167">[哪些操作可以是执行使用适配器？](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span><span class="sxs-lookup"><span data-stu-id="bb280-167">[What Operations Can be Performed Using the Adapter?](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span></span>
