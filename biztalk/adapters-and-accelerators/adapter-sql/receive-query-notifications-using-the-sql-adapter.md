---
title: 接收查询通知使用 SQL 适配器 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 6b2ed0f0-d005-4eec-b1a6-97a0c94678dc
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 015382d92be87118f2cc7ba1c594021b5c379937
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65368299"
---
# <a name="receive-query-notifications-using-the-sql-adapter"></a><span data-ttu-id="23734-102">接收查询通知使用 SQL 适配器</span><span class="sxs-lookup"><span data-stu-id="23734-102">Receive query notifications using the SQL adapter</span></span>
<span data-ttu-id="23734-103">适配器客户端可以订阅以接收有关数据更改的查询通知中的 SQL Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="23734-103">The adapter clients can subscribe to receive query notifications about the data changes in the SQL Server database.</span></span> <span data-ttu-id="23734-104">SQL SELECT 语句或存储的过程的查询通知触发对表中指定的数据更改条件和 SQL Server 发送作为查询通知时的结果集的 SELECT 语句或存储的过程发生更改。</span><span class="sxs-lookup"><span data-stu-id="23734-104">A SQL SELECT statement or a stored procedure specifies the data-change criteria in a table for triggering of the query notifications, and the SQL Server sends query notifications as and when the result set for the SELECT statement or the stored procedure changes.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="23734-105">若要支持查询通知，适配器客户端和 SQL Server 数据库必须满足某些要求。</span><span class="sxs-lookup"><span data-stu-id="23734-105">To support query notifications, the adapter clients and the SQL Server database have to fulfill certain requirements.</span></span> <span data-ttu-id="23734-106">有关这些要求的详细信息，请参阅"启用查询通知"网址[ http://go.microsoft.com/fwlink/?LinkID=122323 ](http://go.microsoft.com/fwlink/?LinkID=122323)。</span><span class="sxs-lookup"><span data-stu-id="23734-106">For detailed information about these requirements, see “Enabling Query Notifications” at [http://go.microsoft.com/fwlink/?LinkID=122323](http://go.microsoft.com/fwlink/?LinkID=122323).</span></span>  
  
 <span data-ttu-id="23734-107">典型的查询通知涉及以下过程：</span><span class="sxs-lookup"><span data-stu-id="23734-107">A typical query notification involves the following:</span></span>  
  
- <span data-ttu-id="23734-108">适配器客户端必须指定`Notification`中的入站操作**InboundOperationType**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="23734-108">The adapter clients must specify `Notification` as the inbound operation in the **InboundOperationType** binding property.</span></span> <span data-ttu-id="23734-109">此绑定属性的默认值是`Polling`。</span><span class="sxs-lookup"><span data-stu-id="23734-109">The default value for this binding property is `Polling`.</span></span>  
  
- <span data-ttu-id="23734-110">适配器客户端必须指定一个 SQL 语句来注册中的查询通知**NotificationStatement**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="23734-110">The adapter clients must specify a SQL statement to register for query notifications in the **NotificationStatement** binding property.</span></span> <span data-ttu-id="23734-111">只要指定的 SQL 语句更改的结果集适配器客户端从 SQL Server 中获取一条通知。</span><span class="sxs-lookup"><span data-stu-id="23734-111">The adapter client gets a notification from SQL Server as soon as the result set for the specified SQL statement changes.</span></span>  
  
  > [!IMPORTANT]
  >  <span data-ttu-id="23734-112">若要接收通知，通知订阅的 SQL 语句*必须*满足特定条件。</span><span class="sxs-lookup"><span data-stu-id="23734-112">To receive notifications, the SQL statement for the notification subscription *must* meet certain criteria.</span></span> <span data-ttu-id="23734-113">有关可用于查询通知的 SQL 语句的信息，请参阅[ http://go.microsoft.com/fwlink/?LinkId=122160 ](http://go.microsoft.com/fwlink/?LinkId=122160)。</span><span class="sxs-lookup"><span data-stu-id="23734-113">For information about SQL statements that can be used for query notifications, see [http://go.microsoft.com/fwlink/?LinkId=122160](http://go.microsoft.com/fwlink/?LinkId=122160).</span></span>  
  
- <span data-ttu-id="23734-114">适配器客户端必须指定适配器是否一旦启动侦听器在向适配器客户端发送了通知**NotifyOnListenerStart**属性绑定。</span><span class="sxs-lookup"><span data-stu-id="23734-114">The adapter clients must specify whether the adapter sends a notification to the adapter clients as soon as the listener is started in the **NotifyOnListenerStart** binding property.</span></span>  
  
- <span data-ttu-id="23734-115">通知发送到作为适配器客户端和中的结果集时指定的 SQL 语句**NotificationStatement**绑定属性发生更改。</span><span class="sxs-lookup"><span data-stu-id="23734-115">The notification is sent to the adapter clients as and when the result set of the SQL statement specified in the **NotificationStatement** binding property is changed.</span></span>  
  
  <span data-ttu-id="23734-116">有关这些绑定属性的详细信息，请参阅[了解关于 BizTalk Adapter for SQL Server 适配器绑定属性](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="23734-116">For more information about these binding properties, see [Read about the BizTalk Adapter for SQL Server adapter binding properties](../../adapters-and-accelerators/adapter-sql/read-about-the-biztalk-adapter-for-sql-server-adapter-binding-properties.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="23734-117">通知订阅始终是已提交，而不考虑是否运行语句的事务已提交或回滚。</span><span class="sxs-lookup"><span data-stu-id="23734-117">The notification subscription is always committed, regardless of whether the transaction in which the statement ran was committed or rolled back.</span></span> <span data-ttu-id="23734-118">因此，通知操作可能会保证为通知订阅的查询的结果已更改。</span><span class="sxs-lookup"><span data-stu-id="23734-118">Therefore, the notification operation might not guarantee that the result of the query subscribed for notification has changed.</span></span> <span data-ttu-id="23734-119">例如，假设数据插入表行中 （为通知订阅） 在事务中，并立即通知发送到适配器通知有关的更改 （插入）。</span><span class="sxs-lookup"><span data-stu-id="23734-119">For example, suppose data is inserted in a table row (subscribed for notification) in a transaction, and immediately a notification is sent to the adapter informing about the change (insert).</span></span> <span data-ttu-id="23734-120">由于某种原因，事务将回滚，并有效地将任何数据插入到表行。</span><span class="sxs-lookup"><span data-stu-id="23734-120">Due to some reason, the transaction rolls back, and effectively no data is inserted into the table row.</span></span> <span data-ttu-id="23734-121">但是，SQL Server 不会发送到事务回滚有关适配器通知。</span><span class="sxs-lookup"><span data-stu-id="23734-121">However, the SQL Server does not send a notification to the adapter about the transaction roll back.</span></span> <span data-ttu-id="23734-122">有关 SQL Server 中的查询通知的信息，请参阅[ http://go.microsoft.com/fwlink/?LinkId=145367 ](http://go.microsoft.com/fwlink/?LinkId=145367)。</span><span class="sxs-lookup"><span data-stu-id="23734-122">For information about query notifications in SQL Server, see [http://go.microsoft.com/fwlink/?LinkId=145367](http://go.microsoft.com/fwlink/?LinkId=145367).</span></span>  
  
## <a name="differences-between-query-notification-and-polling"></a><span data-ttu-id="23734-123">查询通知和轮询之间的差异</span><span class="sxs-lookup"><span data-stu-id="23734-123">Differences between Query Notification and Polling</span></span>  
 <span data-ttu-id="23734-124">尽管查询通知和轮询是这两个入站的操作，并在 SQL Server 数据库中的数据更改通知适配器客户端下, 表列出了两者之间的一些差异。</span><span class="sxs-lookup"><span data-stu-id="23734-124">Though query notification and polling are both inbound operations, and inform the adapter clients about the data changes in the SQL Server database, the following table lists some differences between the two.</span></span> <span data-ttu-id="23734-125">以下差异将帮助你决定具体取决于您的要求操作：</span><span class="sxs-lookup"><span data-stu-id="23734-125">The following differences will help you decide on an operation depending on your requirements:</span></span>  
  
|<span data-ttu-id="23734-126">查询通知</span><span class="sxs-lookup"><span data-stu-id="23734-126">Query Notification</span></span>|<span data-ttu-id="23734-127">轮询</span><span class="sxs-lookup"><span data-stu-id="23734-127">Polling</span></span>|  
|------------------------|-------------|  
|<span data-ttu-id="23734-128">查询通知是由 SQL Server 启动。</span><span class="sxs-lookup"><span data-stu-id="23734-128">Query notification is initiated by SQL Server.</span></span> <span data-ttu-id="23734-129">只需在适配器发出的通知语句指示要在没有语句的结果集中的更改的情况下启动通知的数据库。</span><span class="sxs-lookup"><span data-stu-id="23734-129">The notification statement issued by the adapter just instructs the database to initiate notification in case there is a change in the result set of the statement.</span></span>|<span data-ttu-id="23734-130">由适配器启动轮询。</span><span class="sxs-lookup"><span data-stu-id="23734-130">Polling is initiated by the adapter.</span></span> <span data-ttu-id="23734-131">适配器执行语句，以验证是否可用于轮询，然后通过执行轮询语句，如果某些数据可用于轮询启动轮询数据。</span><span class="sxs-lookup"><span data-stu-id="23734-131">The adapter executes a statement to validate whether data is available for polling, and then initiates polling by executing the polling statement if some data is available for polling.</span></span>|  
|<span data-ttu-id="23734-132">可以使用查询通知语句仅读取 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="23734-132">You can use the query notification statement to only read data in a SQL Server database table.</span></span>|<span data-ttu-id="23734-133">轮询语句可用于读取或更新 SQL Server 数据库表中的数据。</span><span class="sxs-lookup"><span data-stu-id="23734-133">You can use the polling statement to read or update data in a SQL Server database table.</span></span>|  
|<span data-ttu-id="23734-134">查询通知只告知如 Insert、 数据更改的类型更新和删除。</span><span class="sxs-lookup"><span data-stu-id="23734-134">Query notification informs only about the type of change in the data such as Insert, Update, and Delete.</span></span>|<span data-ttu-id="23734-135">轮询通知您已更改的实际数据。</span><span class="sxs-lookup"><span data-stu-id="23734-135">Polling informs you about the actual data that has changed.</span></span>|  
|<span data-ttu-id="23734-136">数据更改通知是瞬间完成的。</span><span class="sxs-lookup"><span data-stu-id="23734-136">The data-change notification is instantaneous.</span></span>|<span data-ttu-id="23734-137">数据更改通知取决于轮询间隔，并且适配器客户端将每个轮询间隔结束时通知数据更改。</span><span class="sxs-lookup"><span data-stu-id="23734-137">The data-change notification depends on the polling interval, and the adapter clients are informed about the data changes at the end of every polling interval.</span></span> <span data-ttu-id="23734-138">**提示：** 轮询可以提供更好的吞吐量中情况下，数据更改发生的连续，并且不希望为每个更改的和发生时收到通知。</span><span class="sxs-lookup"><span data-stu-id="23734-138">**Tip:**  Polling can give you better throughput in scenarios where the data changes are happening continuously, and you do not want to be notified of each change as and when it happens.</span></span> <span data-ttu-id="23734-139">相反，您指定要在其后的发生是因为最后一个更改通知的所有更改通知的轮询间隔。</span><span class="sxs-lookup"><span data-stu-id="23734-139">Instead, you specify a polling interval after which you want to be notified of all the changes that have happened since the last change notification.</span></span>|  
  
 <span data-ttu-id="23734-140">有关详细信息中的查询通知[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]，请参阅[通过使用 BizTalk Server 接收 SQL 查询通知](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="23734-140">For more information about query notification in [!INCLUDE[adaptersql](../../includes/adaptersql-md.md)], see [Receive SQL Query Notifications by Using BizTalk Server](../../adapters-and-accelerators/adapter-sql/receive-sql-query-notifications-using-biztalk-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="23734-141">请参阅</span><span class="sxs-lookup"><span data-stu-id="23734-141">See Also</span></span>  
 <span data-ttu-id="23734-142">[哪些操作可以是执行使用适配器？](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span><span class="sxs-lookup"><span data-stu-id="23734-142">[What Operations Can be Performed Using the Adapter?](https://msdn.microsoft.com/library/cc185435(v=bts.10).aspx)</span></span>