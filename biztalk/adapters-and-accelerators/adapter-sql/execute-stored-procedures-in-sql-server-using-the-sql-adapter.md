---
title: 在使用 SQL 适配器的 SQL Server 中执行存储过程 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 245626a7-f546-4aca-90df-c0579139a872
caps.latest.revision: 16
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 65a475d8de1fc30df2e06923ad14bcba0897159e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22224053"
---
# <a name="execute-stored-procedures-in-sql-server-using-the-sql-adapter"></a><span data-ttu-id="081c5-102">在使用 SQL 适配器的 SQL Server 中执行存储过程</span><span class="sxs-lookup"><span data-stu-id="081c5-102">Execute Stored Procedures in SQL Server using the SQL adapter</span></span>
<span data-ttu-id="081c5-103">TRANSACT-SQL 和 SQL Server 中的 CLR 存储过程作为中的操作进行展示[!INCLUDE[adaptersql](../../includes/adaptersql-md.md)]下**过程**时使用的节点[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]或[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="081c5-103">The Transact-SQL and CLR stored procedures in SQL Server are surfaced as operations in [!INCLUDE[adaptersql](../../includes/adaptersql-md.md)] under the **Procedures** node while using the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] or [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)].</span></span> <span data-ttu-id="081c5-104">通过公开的操作名称[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]是 SQL Server 中的存储过程的名称相同。</span><span class="sxs-lookup"><span data-stu-id="081c5-104">The operation names exposed by the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] are the same as the name of the stored procedure in SQL Server.</span></span> <span data-ttu-id="081c5-105">存储过程中的所有参数都公开在相应的操作。</span><span class="sxs-lookup"><span data-stu-id="081c5-105">All the parameters in the stored procedure are exposed in the corresponding operation.</span></span> <span data-ttu-id="081c5-106">OUT 参数包含存储过程的返回值。</span><span class="sxs-lookup"><span data-stu-id="081c5-106">The OUT parameter contains the return value of the stored procedure.</span></span> <span data-ttu-id="081c5-107">存储过程的结果集是数据集的数组。</span><span class="sxs-lookup"><span data-stu-id="081c5-107">The result set of the stored procedure is an array of DataSet.</span></span> <span data-ttu-id="081c5-108">有关数据集的详细信息，请参阅[http://go.microsoft.com/fwlink/?LinkId=196853](http://go.microsoft.com/fwlink/?LinkId=196853)。</span><span class="sxs-lookup"><span data-stu-id="081c5-108">For more information about DataSet, see [http://go.microsoft.com/fwlink/?LinkId=196853](http://go.microsoft.com/fwlink/?LinkId=196853).</span></span> <span data-ttu-id="081c5-109">在运行时，如果作为响应消息的一部分获取的目标对象的架构信息。</span><span class="sxs-lookup"><span data-stu-id="081c5-109">The schema information of the target object is obtained as part of the response message at run time.</span></span>  
  
 <span data-ttu-id="081c5-110">但是，如果你想要获取在设计时目标对象的架构信息，则必须生成架构下的过程**Strongly-Typed 过程**中的节点[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]或[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="081c5-110">However, if you want to obtain the schema information of the target object at design time, you must generate schemas for the procedures under the **Strongly-Typed Procedures** node in the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] or [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)].</span></span> <span data-ttu-id="081c5-111">请注意，在中加以表示相同的存储的过程**过程**和**Strongly-Typed 过程**节点。</span><span class="sxs-lookup"><span data-stu-id="081c5-111">Note that the same stored procedures are surfaced under the **Procedures** and the **Strongly-Typed Procedures** node.</span></span> <span data-ttu-id="081c5-112">存储过程的返回值是强类型化，而不只是数据集的数组。</span><span class="sxs-lookup"><span data-stu-id="081c5-112">The return value of the stored procedure is strongly typed, and not just an array of DataSet.</span></span> <span data-ttu-id="081c5-113">由于在设计时是可用的架构信息，可用于存储过程的架构映射到不同的操作的另一个架构。</span><span class="sxs-lookup"><span data-stu-id="081c5-113">As the schema information is available at the design time, you can use it to map the schema of the stored procedure to another schema for a different operation.</span></span> <span data-ttu-id="081c5-114">例如，你可以映射有关在数据库表上执行插入操作生成的架构的强类型过程生成的架构。</span><span class="sxs-lookup"><span data-stu-id="081c5-114">For example, you can map the schema generated for a strongly-typed procedure to the schema generated for the Insert operation on a database table.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="081c5-115">你将不能查看在设计时为强类型的存储过程的架构信息，如果：</span><span class="sxs-lookup"><span data-stu-id="081c5-115">You will not be able to view the schema information at design time for a strongly-typed stored procedure if:</span></span>  
>   
>  -   <span data-ttu-id="081c5-116">您正在使用游标，这是另一个存储过程，返回值作为输入参数为强类型的存储过程。</span><span class="sxs-lookup"><span data-stu-id="081c5-116">You are using a cursor, which is a return value of another stored procedure, as the input parameter for the strongly-typed stored procedure.</span></span>  
> -   <span data-ttu-id="081c5-117">它是执行某些操作对表的 CLR 存储过程。</span><span class="sxs-lookup"><span data-stu-id="081c5-117">It is a CLR stored procedure that performs some operations on a table.</span></span>  
  
## <a name="support-for-stored-procedures-with-for-xml-clause"></a><span data-ttu-id="081c5-118">支持使用 FOR XML 子句的存储过程</span><span class="sxs-lookup"><span data-stu-id="081c5-118">Support for Stored Procedures with FOR XML Clause</span></span>  
 <span data-ttu-id="081c5-119">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]还使您能够执行具有带 FOR XML 子句的 SELECT 语句的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="081c5-119">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] also enables you to execute stored procedures that have a SELECT statement with a FOR XML clause.</span></span> <span data-ttu-id="081c5-120">FOR XML 子句用于 SELECT 语句中将结果作为 XML 返回而不是行集。</span><span class="sxs-lookup"><span data-stu-id="081c5-120">A FOR XML clause is used in a SELECT statement to return the results as XML instead of a rowset.</span></span> <span data-ttu-id="081c5-121">有关 FOR XML 子句的详细信息，请参阅[http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402)。</span><span class="sxs-lookup"><span data-stu-id="081c5-121">For more information about the FOR XML clause, see [http://go.microsoft.com/fwlink/?LinkId=131402](http://go.microsoft.com/fwlink/?LinkId=131402).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="081c5-122">"本机"[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]适用于[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]支持仅这些存储过程返回 XML，这就是，具有 FOR XML 子句的 SELECT 语句中。</span><span class="sxs-lookup"><span data-stu-id="081c5-122">The “native” [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] available with [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] supports only those stored procedures that return XML, that is, have the FOR XML clause in the SELECT statement.</span></span> <span data-ttu-id="081c5-123">使用带有 FOR XML 子句的存储过程的支持，可以执行这些存储的过程使用基于 WCF 的[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]而不必对存储的过程定义中进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="081c5-123">With the support for stored procedures with FOR XML clause, you can execute these stored procedures using the WCF-based [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] without making any changes to the stored procedure definition.</span></span>  
  
## <a name="support-for-stored-procedures-with-temporary-tables"></a><span data-ttu-id="081c5-124">支持与临时表的存储过程</span><span class="sxs-lookup"><span data-stu-id="081c5-124">Support for Stored Procedures with Temporary Tables</span></span>  
 <span data-ttu-id="081c5-125">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]使您能够生成元数据包含在其定义中的临时表的存储过程。</span><span class="sxs-lookup"><span data-stu-id="081c5-125">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] enables you to generate metadata for stored procedures that contain temporary tables in their definitions.</span></span> <span data-ttu-id="081c5-126">但是，对于此类存储过程必须生成元数据通过选择的存储的过程只能从**过程**节点，同时使用[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]或[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="081c5-126">However, for such stored procedures you must generate metadata by selecting the stored procedures only from the **Procedures** node, while using the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] or [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span> <span data-ttu-id="081c5-127">适配器不支持从在此类存储过程生成的元数据**Strongly-Typed 过程**节点。</span><span class="sxs-lookup"><span data-stu-id="081c5-127">The adapter does not support generating metadata for such stored procedures from under the **Strongly-Typed Procedures** node.</span></span>  
  
## <a name="support-for-result-sets-containing-columns-without-names-or-with-same-names"></a><span data-ttu-id="081c5-128">支持结果集包含列没有名称或相同的名称</span><span class="sxs-lookup"><span data-stu-id="081c5-128">Support for Result Sets Containing Columns Without Names or With Same Names</span></span>  
 <span data-ttu-id="081c5-129">下表列出了[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]处理无名称和存储的过程和强类型的存储的过程中的结果集的相同名称的列。</span><span class="sxs-lookup"><span data-stu-id="081c5-129">The following table lists how the [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] handles columns without names and same names in the result sets for stored procedures and strongly-typed stored procedures.</span></span>  
  
|<span data-ttu-id="081c5-130">结果集包含...</span><span class="sxs-lookup"><span data-stu-id="081c5-130">Result set contains…</span></span>|<span data-ttu-id="081c5-131">存储过程</span><span class="sxs-lookup"><span data-stu-id="081c5-131">Stored Procedure</span></span>|<span data-ttu-id="081c5-132">强类型的存储的过程</span><span class="sxs-lookup"><span data-stu-id="081c5-132">Strongly-Typed Stored Procedure</span></span>|  
|--------------------------|----------------------|--------------------------------------|  
|<span data-ttu-id="081c5-133">**没有名称的列**</span><span class="sxs-lookup"><span data-stu-id="081c5-133">**Columns without names**</span></span>|<span data-ttu-id="081c5-134">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]按以下方式生成的列的名称： 为而没有列生成唯一 ID (GUID)"-"（连字符），然后此 GUID 字符串具有前缀"C"因为生成的 GUID 可能以数字开头，但 XML 标记名称不能和。</span><span class="sxs-lookup"><span data-stu-id="081c5-134">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] generates a name for the column in the following way: a unique ID (GUID) is generated for the column without "-" (hyphen), and then the GUID string is prefixed by "C" because the generated GUID might start with a digit but an XML tag name cannot.</span></span>|<span data-ttu-id="081c5-135">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]会生成以下名称的列:"UnNamedColumn [column_index]"，从该位置 column_index 开始从"0"。</span><span class="sxs-lookup"><span data-stu-id="081c5-135">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] generates the following name for the column: “UnNamedColumn[column_index]”,  where column_index starts from ‘0’.</span></span>|  
|<span data-ttu-id="081c5-136">**具有相同名称的列**</span><span class="sxs-lookup"><span data-stu-id="081c5-136">**Columns with same names**</span></span>|<span data-ttu-id="081c5-137">以外的第一个列的名称以"_"（下划线） 和随机 GUID 而没有将追加"-"（连字符）。</span><span class="sxs-lookup"><span data-stu-id="081c5-137">The names of the columns other than the first one are appended with “_” (underscore) followed by a random GUID without "-" (hyphen).</span></span> <span data-ttu-id="081c5-138">例如:"\_[GUID]"。</span><span class="sxs-lookup"><span data-stu-id="081c5-138">For example: “\_[GUID]”.</span></span>|<span data-ttu-id="081c5-139">[!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)]不支持具有相同名称的列中的结果集，并在引发异常。</span><span class="sxs-lookup"><span data-stu-id="081c5-139">The [!INCLUDE[adaptersqlshort](../../includes/adaptersqlshort-md.md)] does not support columns with same names in the result sets, and throws an exception.</span></span> <span data-ttu-id="081c5-140">**重要说明：** 必须确保在结果集中的列名称具有唯一的名称。</span><span class="sxs-lookup"><span data-stu-id="081c5-140">**Important:**  You must ensure that the column names in a result set have unique names.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="081c5-141">一般情况下，建议，在结果中的所有列都设置的存储过程和强类型的存储的过程必须命名为，并且具有唯一的名称。</span><span class="sxs-lookup"><span data-stu-id="081c5-141">In general, it is recommended that all the columns in a result set for stored procedures and strongly-typed stored procedures must be named, and have unique names.</span></span>  
  
 <span data-ttu-id="081c5-142">有关详细信息：</span><span class="sxs-lookup"><span data-stu-id="081c5-142">For more information about:</span></span>  
  
-   <span data-ttu-id="081c5-143">如何执行存储的过程，请参阅[在 SQL Server 使用 BizTalk Server 中执行存储的过程](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-in-sql-server-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="081c5-143">How to execute stored procedures, see [Execute stored procedures in SQL Server using BizTalk Server](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-in-sql-server-using-biztalk-server.md).</span></span>  
  
-   <span data-ttu-id="081c5-144">如何执行存储的过程具有 FOR XML 子句，请参阅[执行存储的过程具有 FOR XML 子句中使用 BizTalk Server 的 SQL Server](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-having-a-for-xml-clause-in-sql-server-using-biztalk.md)。</span><span class="sxs-lookup"><span data-stu-id="081c5-144">How to execute stored procedures having a FOR XML clause, see [Execute stored procedures having a FOR XML clause in SQL Server using BizTalk Server](../../adapters-and-accelerators/adapter-sql/execute-stored-procedures-having-a-for-xml-clause-in-sql-server-using-biztalk.md).</span></span>  
  
-   <span data-ttu-id="081c5-145">消息的存储过程的架构，请参阅[过程和函数的消息架构](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md)。</span><span class="sxs-lookup"><span data-stu-id="081c5-145">Message schemas for the stored procedures, see [Message Schemas for Procedures and Functions](../../adapters-and-accelerators/adapter-sql/message-schemas-for-procedures-and-functions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="081c5-146">另请参阅</span><span class="sxs-lookup"><span data-stu-id="081c5-146">See Also</span></span>  
 [<span data-ttu-id="081c5-147">连接到 SAP 系统使用适配器</span><span class="sxs-lookup"><span data-stu-id="081c5-147">Connect to an SAP system using the adapter</span></span>](../../adapters-and-accelerators/adapter-sap/connect-to-an-sap-system-using-the-adapter.md)