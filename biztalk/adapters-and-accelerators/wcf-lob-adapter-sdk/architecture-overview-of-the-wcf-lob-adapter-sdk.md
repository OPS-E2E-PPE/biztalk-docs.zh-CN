---
title: WCF LOB 适配器 SDK 的体系结构概述 |Microsoft Docs
description: 介绍了处理程序，信道实现、 连接管理、 元数据，和使用 WCF LOB 适配器 SDK 中的 WSDL
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: dbd9b63c-54a4-4f63-b3a8-8600f6009a74
caps.latest.revision: 21
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: de1214859a94a05271d2cabc931dcf9531cdcf0c
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65364003"
---
# <a name="architecture-overview-of-the-wcf-lob-adapter-sdk"></a><span data-ttu-id="7224c-103">WCF LOB 适配器 SDK 的体系结构概述</span><span class="sxs-lookup"><span data-stu-id="7224c-103">Architecture overview of the WCF LOB Adapter SDK</span></span>
<span data-ttu-id="7224c-104">[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] WCF 通道模型的基础上构建并提供适配器开发人员能够创建于具有大型的动态元数据的业务线系统的适配器设计时和运行时扩展。</span><span class="sxs-lookup"><span data-stu-id="7224c-104">The [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is built on top of the WCF Channel Model and provides design-time and run-time extensions for adapter developers to create adapters to line-of-business systems that have large and dynamic metadata.</span></span> <span data-ttu-id="7224c-105">创建使用的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供给使用者为自定义 WCF 绑定。</span><span class="sxs-lookup"><span data-stu-id="7224c-105">An adapter created using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is surfaced to the consumer as a custom WCF binding.</span></span> <span data-ttu-id="7224c-106">下图显示了内部体系结构和 WCF LOB 适配器 SDK 的主要组件。</span><span class="sxs-lookup"><span data-stu-id="7224c-106">The following figure shows the internal architecture and main components of WCF LOB Adapter SDK.</span></span>  
  
 <span data-ttu-id="7224c-107">![](../../adapters-and-accelerators/wcf-lob-adapter-sdk/media/7183bded-465e-45b9-af78-fbb87cf2df92.gif "7183bded-465e-45b9-af78-fbb87cf2df92")</span><span class="sxs-lookup"><span data-stu-id="7224c-107">![](../../adapters-and-accelerators/wcf-lob-adapter-sdk/media/7183bded-465e-45b9-af78-fbb87cf2df92.gif "7183bded-465e-45b9-af78-fbb87cf2df92")</span></span>  
  
## <a name="handlers"></a><span data-ttu-id="7224c-108">处理程序</span><span class="sxs-lookup"><span data-stu-id="7224c-108">Handlers</span></span>  
 <span data-ttu-id="7224c-109">*处理程序*定义适配器支持的消息交换模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-109">*Handler* defines the message exchange patterns supported by the adapter.</span></span>  
  
 <span data-ttu-id="7224c-110">下表总结了可用的处理程序类型，其功能和[!INCLUDE[nextref_btsWinCommFoundation](../../includes/nextref-btswincommfoundation-md.md)]它们映射到的频道。</span><span class="sxs-lookup"><span data-stu-id="7224c-110">The following table summarizes the available handler types, their function, and the [!INCLUDE[nextref_btsWinCommFoundation](../../includes/nextref-btswincommfoundation-md.md)] channel(s) they map to.</span></span>  
  
|<span data-ttu-id="7224c-111">**处理程序类型**</span><span class="sxs-lookup"><span data-stu-id="7224c-111">**Handler Type**</span></span>|<span data-ttu-id="7224c-112">**函数**</span><span class="sxs-lookup"><span data-stu-id="7224c-112">**Function**</span></span>|<span data-ttu-id="7224c-113">**映射到 WCF 通道**</span><span class="sxs-lookup"><span data-stu-id="7224c-113">**Maps to WCF Channels**</span></span>|  
|---|---|---|  
|`Microsoft.ServiceModel.Channels.Common.IOutboundHandler`|<span data-ttu-id="7224c-114">支持单向发送或请求/响应模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-114">Supports one-way send or request/response pattern.</span></span>|<span data-ttu-id="7224c-115">IOutputChannel,</span><span class="sxs-lookup"><span data-stu-id="7224c-115">IOutputChannel,</span></span><br /><br /> <span data-ttu-id="7224c-116">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-116">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IAsyncOutboundHandler`|<span data-ttu-id="7224c-117">支持异步单向发送或请求/响应模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-117">Supports asynchronous one-way send or request/response pattern.</span></span>|<span data-ttu-id="7224c-118">IOutputChannel,</span><span class="sxs-lookup"><span data-stu-id="7224c-118">IOutputChannel,</span></span><br /><br /> <span data-ttu-id="7224c-119">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-119">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IInboundHandler`|<span data-ttu-id="7224c-120">支持单向接收或答复模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-120">Supports one-way receive or reply patterns.</span></span>|<span data-ttu-id="7224c-121">IInputChannel,</span><span class="sxs-lookup"><span data-stu-id="7224c-121">IInputChannel,</span></span><br /><br /> <span data-ttu-id="7224c-122">IReplyChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-122">IReplyChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IAsyncInboundHandler`|<span data-ttu-id="7224c-123">支持的单向方法的异步变体接收或答复模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-123">Supports asynchronous variants of methods one-way receive or reply patterns.</span></span>|<span data-ttu-id="7224c-124">IInputChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-124">IInputChannel</span></span><br /><br /> <span data-ttu-id="7224c-125">IReplyChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-125">IReplyChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataBrowseHandler`|<span data-ttu-id="7224c-126">支持的目标系统上的元数据浏览。</span><span class="sxs-lookup"><span data-stu-id="7224c-126">Supports browsing of metadata on the target system.</span></span>|<span data-ttu-id="7224c-127">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-127">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataSearchHandler`|<span data-ttu-id="7224c-128">支持搜索的目标系统上的元数据。</span><span class="sxs-lookup"><span data-stu-id="7224c-128">Supports searching of metadata on the target system.</span></span>|<span data-ttu-id="7224c-129">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-129">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataResolverHandler`|<span data-ttu-id="7224c-130">支持从目标系统的元数据检索。</span><span class="sxs-lookup"><span data-stu-id="7224c-130">Supports retrieval of metadata from the target system.</span></span>|<span data-ttu-id="7224c-131">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="7224c-131">IRequestChannel</span></span>|  
  
## <a name="channel-implementation"></a><span data-ttu-id="7224c-132">信道实现</span><span class="sxs-lookup"><span data-stu-id="7224c-132">Channel implementation</span></span>  
 <span data-ttu-id="7224c-133">使用生成的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]基本上是传输通道 (System.ServiceModel.Channels.IServiceListner)。</span><span class="sxs-lookup"><span data-stu-id="7224c-133">An adapter built using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is basically a transport channel (System.ServiceModel.Channels.IServiceListner).</span></span> <span data-ttu-id="7224c-134">使用生成的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供给使用者为 WCF 绑定，该绑定用于创建通道堆栈。</span><span class="sxs-lookup"><span data-stu-id="7224c-134">An adapter built using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is surfaced to the consumer as a WCF binding, where the binding is used to create the channel stack.</span></span> <span data-ttu-id="7224c-135">此绑定可被视为与其他预定义的 WCF 绑定 BasicHttpBinding、 WsHttpBinding 和 NetTcpBinding，如对等，可以通过 app.config 或在代码中的客户端应用程序时设置调用的服务。</span><span class="sxs-lookup"><span data-stu-id="7224c-135">This binding can be considered a peer to other predefined WCF bindings such as BasicHttpBinding, WsHttpBinding, and NetTcpBinding, and can be set via app.config or in code by the client application when calling a service.</span></span> <span data-ttu-id="7224c-136">此绑定包含绑定元素，与适配器正在从 T:System.ServiceModel.Channels.TransportBindingElement 类派生的键绑定元素的有序的集。</span><span class="sxs-lookup"><span data-stu-id="7224c-136">This binding contains an ordered set of binding elements, with the adapter being the key binding element that derives from the T:System.ServiceModel.Channels.TransportBindingElement class.</span></span> <span data-ttu-id="7224c-137">在出站方案中，[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]运行时使用的通道工厂创建的适配器 （即，传输通道）。</span><span class="sxs-lookup"><span data-stu-id="7224c-137">In an outbound scenario, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] runtime uses a channel factory to create the adapter (that is, the transport channel).</span></span> <span data-ttu-id="7224c-138">在入站方案中，[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]运行时使用的通道侦听器为传入通道在服务应用程序中。</span><span class="sxs-lookup"><span data-stu-id="7224c-138">In an inbound scenario, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] runtime makes use of channel listeners for incoming channels in a service application.</span></span>  <span data-ttu-id="7224c-139">运行时以及设计时的消息通过此组件。</span><span class="sxs-lookup"><span data-stu-id="7224c-139">Both run-time as well as design-time messages pass through this component.</span></span>  
  
## <a name="connection-factory-connection-and-connection-uri-builder"></a><span data-ttu-id="7224c-140">连接工厂、 连接和连接 URI 生成器</span><span class="sxs-lookup"><span data-stu-id="7224c-140">Connection factory, connection, and connection URI builder</span></span>  
 <span data-ttu-id="7224c-141">*ConnectionFactory*提供用于创建基于 URI 和用户凭据的连接的工厂模式。</span><span class="sxs-lookup"><span data-stu-id="7224c-141">*ConnectionFactory* provides a factory pattern for creating connections based on URI and user credentials.</span></span> <span data-ttu-id="7224c-142">有关详细信息，请参阅 `Microsoft.ServiceModel.Channels.Common.IConnectionFactory` 。</span><span class="sxs-lookup"><span data-stu-id="7224c-142">For more information, see `Microsoft.ServiceModel.Channels.Common.IConnectionFactory`.</span></span>  
  
 <span data-ttu-id="7224c-143">*连接*定义与目标系统中，低级别通信协定和封装的本机通信 Api 和连接句柄。</span><span class="sxs-lookup"><span data-stu-id="7224c-143">*Connection* defines a low-level communication contract with the target system, and encapsulates native communication APIs and connection handles.</span></span> <span data-ttu-id="7224c-144">有关详细信息，请参阅 `Microsoft.ServiceModel.Channels.Common.IConnection` 。</span><span class="sxs-lookup"><span data-stu-id="7224c-144">For more information, see `Microsoft.ServiceModel.Channels.Common.IConnection`.</span></span>  
  
 <span data-ttu-id="7224c-145">*连接 Uri 生成器*允许适配器使用者以编程方式生成连接 Uri 特定不知情的情况下的语法。</span><span class="sxs-lookup"><span data-stu-id="7224c-145">The *Connection Uri Builder* allows adapter consumers to programmatically build connection URIs without specific knowledge of syntax.</span></span> <span data-ttu-id="7224c-146">有关详细信息，请参阅 `Microsoft.ServiceModel.Channels.Common.ConnectionUri` 。</span><span class="sxs-lookup"><span data-stu-id="7224c-146">For more information, see `Microsoft.ServiceModel.Channels.Common.ConnectionUri`.</span></span>  
  
## <a name="connection-management"></a><span data-ttu-id="7224c-147">连接管理</span><span class="sxs-lookup"><span data-stu-id="7224c-147">Connection management</span></span>  
 <span data-ttu-id="7224c-148">*连接管理*负责的生存期管理的适配器的连接。</span><span class="sxs-lookup"><span data-stu-id="7224c-148">*Connection management* is responsible for the lifetime management of the connections of an adapter.</span></span> <span data-ttu-id="7224c-149">它在内部保留连接的池供使用。</span><span class="sxs-lookup"><span data-stu-id="7224c-149">It internally keeps a pool of the connections ready for use.</span></span> <span data-ttu-id="7224c-150">此连接池是凭据和基于 URI 的。</span><span class="sxs-lookup"><span data-stu-id="7224c-150">This connection pool is credential and URI-based.</span></span> <span data-ttu-id="7224c-151">该凭据包含用户名和密码用于定义连接的安全上下文下运行。</span><span class="sxs-lookup"><span data-stu-id="7224c-151">The credential contains a user name and password that define the security context the connection runs under.</span></span>  
  
 <span data-ttu-id="7224c-152">当使用相同的凭据和 URI 时，在同一个连接工厂下的打开的任何通道如果已存在一个可用获取连接池中的线程。</span><span class="sxs-lookup"><span data-stu-id="7224c-152">When the same credentials and URI are used, any channel being opened under the same connection factory obtains the connection from the pool if there is one available already.</span></span>  
  
 <span data-ttu-id="7224c-153">连接池管理器保留多少个到该 URI，而不考虑凭据并跨通道工厂的边界的打开连接的记录。</span><span class="sxs-lookup"><span data-stu-id="7224c-153">Connection pool manager keeps records of how many open connections there are to that URI regardless of the credentials and across the boundaries of the channel factory.</span></span> <span data-ttu-id="7224c-154">例如，在一个系统中，您可以有两个用户有不同的凭据，这意味着连接到系统的两个通道工厂。</span><span class="sxs-lookup"><span data-stu-id="7224c-154">For example, in one system, you can have two users who have different credentials, which means there are two channel factories connecting to the system.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7224c-155">该适配器可能会受到限制，它可以支持的连接数方面通常受系统资源限制。</span><span class="sxs-lookup"><span data-stu-id="7224c-155">The adapter may be limited with respect to the number of connections it can support, generally limited by system resources.</span></span>  
  
 <span data-ttu-id="7224c-156">若要帮助配置连接池设置，适配器开发人员[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供了两个类`Microsoft.ServiceModel.Channels.Common.ConnectionPoolSettings`和`Microsoft.ServiceModel.Channels.Common.ConnectionManagerSettings`。</span><span class="sxs-lookup"><span data-stu-id="7224c-156">To help adapter developers configure the connection pool settings, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] provides two classes, `Microsoft.ServiceModel.Channels.Common.ConnectionPoolSettings` and `Microsoft.ServiceModel.Channels.Common.ConnectionManagerSettings`.</span></span>  
  
## <a name="metadata-management"></a><span data-ttu-id="7224c-157">元数据管理</span><span class="sxs-lookup"><span data-stu-id="7224c-157">Metadata management</span></span>  
 <span data-ttu-id="7224c-158">*元数据管理*负责的面向对象的表示形式的目标系统的元数据缓存。</span><span class="sxs-lookup"><span data-stu-id="7224c-158">*Metadata management* is responsible for the object-oriented representation of the caching of the metadata for the target system.</span></span> <span data-ttu-id="7224c-159">元数据可以保存在常见的缓存可访问跨所有凭据，也可以是缓存的每个凭据基础。</span><span class="sxs-lookup"><span data-stu-id="7224c-159">Metadata can be held in a common cache accessible across all credentials, or it can be cached per credential basis.</span></span>  
  
 <span data-ttu-id="7224c-160">元数据生命周期开始其设计时定义和在运行时通过使用情况将继续。</span><span class="sxs-lookup"><span data-stu-id="7224c-160">The metadata life cycle begins with its design-time definitions and continues through usage during runtime.</span></span> <span data-ttu-id="7224c-161">在设计时，适配器开发人员必须标识组的操作，并必须生成必要的 WSDL 和客户端代理。</span><span class="sxs-lookup"><span data-stu-id="7224c-161">At design time, adapter developers must identify the set of operations, and must generate the necessary WSDL and client side proxy.</span></span> <span data-ttu-id="7224c-162">在运行时，基于适配器框架的适配器使用的预定义的元数据来解释从目标系统调用返回的消息。</span><span class="sxs-lookup"><span data-stu-id="7224c-162">At runtime, the Adapter Framework-based adapters use the predefined metadata to interpret the messages returned from the target system calls.</span></span>  
  
 <span data-ttu-id="7224c-163">为了配置元数据设置适配器编写人员，适配器框架提供了三个类： `Microsoft.ServiceModel.Channels.Common.CacheSettings`，`Microsoft.ServiceModel.Channels.Common.MetadataSettings`和`Microsoft.ServiceModel.Channels.Common.CommonCacheSettings`。</span><span class="sxs-lookup"><span data-stu-id="7224c-163">To help adapter writers configure the metadata setting, the Adapter Framework provides three classes, `Microsoft.ServiceModel.Channels.Common.CacheSettings`, `Microsoft.ServiceModel.Channels.Common.MetadataSettings` and `Microsoft.ServiceModel.Channels.Common.CommonCacheSettings`.</span></span>  
  
## <a name="wsdl-builder"></a><span data-ttu-id="7224c-164">WSDL 生成器</span><span class="sxs-lookup"><span data-stu-id="7224c-164">WSDL builder</span></span>  
 <span data-ttu-id="7224c-165">*WSDL 生成器*提供自动生成的 WSDL，从 WCF LOB 适配器 SDK 的内部元数据对象模型 （需要自定义 WSDL 生成的情况下可以覆盖）。</span><span class="sxs-lookup"><span data-stu-id="7224c-165">*WSDL Builder* provides automatic WSDL generation from the WCF LOB Adapter SDK's internal metadata object model (it can be overridden for scenarios that require custom WSDL generation).</span></span>  
  
 <span data-ttu-id="7224c-166">请参阅`Microsoft.ServiceModel.Channels.Common.IWsdlRetrieval`有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="7224c-166">See `Microsoft.ServiceModel.Channels.Common.IWsdlRetrieval` for more information.</span></span>  
  
## <a name="metadata-browsesearch"></a><span data-ttu-id="7224c-167">元数据浏览/搜索</span><span class="sxs-lookup"><span data-stu-id="7224c-167">Metadata browse/search</span></span>  
 <span data-ttu-id="7224c-168">*元数据浏览/搜索*允许浏览和搜索所有 LOB 元数据。</span><span class="sxs-lookup"><span data-stu-id="7224c-168">*Metadata browse/search* allows for browsing and searching all LOB metadata.</span></span>  
  
 <span data-ttu-id="7224c-169">有关详细信息，请参阅 `Microsoft.ServiceModel.Channels.IMetadataRetrievalContract` 。</span><span class="sxs-lookup"><span data-stu-id="7224c-169">For more information, see `Microsoft.ServiceModel.Channels.IMetadataRetrievalContract`.</span></span>  
  
## <a name="metadata-generation"></a><span data-ttu-id="7224c-170">元数据生成</span><span class="sxs-lookup"><span data-stu-id="7224c-170">Metadata generation</span></span>  
 <span data-ttu-id="7224c-171">*元数据生成*允许为客户端 （用于出站方案） 生成代码并根据选择的适配器使用者的操作 （用于入站方案） 的服务。</span><span class="sxs-lookup"><span data-stu-id="7224c-171">*Metadata generation* allows for generating code for the client (for outbound scenarios) and for the service (for inbound scenarios) based on operations selected by the adapter consumer.</span></span> <span data-ttu-id="7224c-172">即使我们建议适配器使用者使用的工具[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] ([!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]发生 BizTalk 应用程序时)，则[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供一个公共接口`Microsoft.ServiceModel.Channels.MetadataRetrievalClient.GetMetadata%2A`检索System.Web.Services.Description.ServiceDescription，它表示 Web 服务描述语言 (WSDL) 包含有关所选的操作和类型的信息。</span><span class="sxs-lookup"><span data-stu-id="7224c-172">Even though we recommend that adapter consumers use the tools [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] ([!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] in case of BizTalk applications), the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] provides a public interface `Microsoft.ServiceModel.Channels.MetadataRetrievalClient.GetMetadata%2A` to retrieve the System.Web.Services.Description.ServiceDescription, which represents a Web Service Description Language (WSDL) containing information about selected operations and types.</span></span> <span data-ttu-id="7224c-173">适配器编写人员请使用为该元数据对象模型[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]包括类派生自`Microsoft.ServiceModel.Channels.Common.OperationMetadata`和`Microsoft.ServiceModel.Channels.Common.TypeMetadata`来描述每个操作和类型的详细信息。</span><span class="sxs-lookup"><span data-stu-id="7224c-173">Adapter writers make use of the metadata object model for the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] that includes classes derived from `Microsoft.ServiceModel.Channels.Common.OperationMetadata` and `Microsoft.ServiceModel.Channels.Common.TypeMetadata` to describe the details of each operation and type.</span></span>  
  