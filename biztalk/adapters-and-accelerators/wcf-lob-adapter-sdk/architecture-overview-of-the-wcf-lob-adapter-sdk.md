---
title: "WCF LOB 适配器 SDK 的体系结构概述 |Microsoft 文档"
description: "处理程序、 通道实现，连接管理、 元数据，以及使用 WCF LOB 适配器 SDK 中的 WSDL 的简介"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: dbd9b63c-54a4-4f63-b3a8-8600f6009a74
caps.latest.revision: "21"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bd86d2104fff0e227d9cdda4c9fb3faf1ea7cb84
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="architecture-overview-of-the-wcf-lob-adapter-sdk"></a><span data-ttu-id="e481a-103">WCF LOB 适配器 SDK 的体系结构概述</span><span class="sxs-lookup"><span data-stu-id="e481a-103">Architecture overview of the WCF LOB Adapter SDK</span></span>
<span data-ttu-id="e481a-104">[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]构建于 WCF 通道模型之上，并提供适配器开发人员创建到包含大型的动态元数据的业务线系统的适配器的设计时和运行时扩展。</span><span class="sxs-lookup"><span data-stu-id="e481a-104">The [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is built on top of the WCF Channel Model and provides design-time and run-time extensions for adapter developers to create adapters to line-of-business systems that have large and dynamic metadata.</span></span> <span data-ttu-id="e481a-105">使用创建的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供给使用者为自定义 WCF 绑定。</span><span class="sxs-lookup"><span data-stu-id="e481a-105">An adapter created using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is surfaced to the consumer as a custom WCF binding.</span></span> <span data-ttu-id="e481a-106">下图显示了内部体系结构和 WCF LOB 适配器 SDK 的主要组件。</span><span class="sxs-lookup"><span data-stu-id="e481a-106">The following figure shows the internal architecture and main components of WCF LOB Adapter SDK.</span></span>  
  
 ![](../../adapters-and-accelerators/wcf-lob-adapter-sdk/media/7183bded-465e-45b9-af78-fbb87cf2df92.gif "7183bded-465e-45b9-af78-fbb87cf2df92")  
  
## <a name="handlers"></a><span data-ttu-id="e481a-107">处理程序</span><span class="sxs-lookup"><span data-stu-id="e481a-107">Handlers</span></span>  
 <span data-ttu-id="e481a-108">*处理程序*定义适配器支持的消息交换模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-108">*Handler* defines the message exchange patterns supported by the adapter.</span></span>  
  
 <span data-ttu-id="e481a-109">下表总结了可用的处理程序类型，其函数，与[!INCLUDE[nextref_btsWinCommFoundation](../../includes/nextref-btswincommfoundation-md.md)]它们映射到的通道。</span><span class="sxs-lookup"><span data-stu-id="e481a-109">The following table summarizes the available handler types, their function, and the [!INCLUDE[nextref_btsWinCommFoundation](../../includes/nextref-btswincommfoundation-md.md)] channel(s) they map to.</span></span>  
  
|<span data-ttu-id="e481a-110">**处理程序类型**</span><span class="sxs-lookup"><span data-stu-id="e481a-110">**Handler Type**</span></span>|<span data-ttu-id="e481a-111">**函数**</span><span class="sxs-lookup"><span data-stu-id="e481a-111">**Function**</span></span>|<span data-ttu-id="e481a-112">**映射到 WCF 通道**</span><span class="sxs-lookup"><span data-stu-id="e481a-112">**Maps to WCF Channels**</span></span>|  
|---|---|---|  
|`Microsoft.ServiceModel.Channels.Common.IOutboundHandler`|<span data-ttu-id="e481a-113">支持单向发送或请求/响应模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-113">Supports one-way send or request/response pattern.</span></span>|<span data-ttu-id="e481a-114">IOutputChannel，</span><span class="sxs-lookup"><span data-stu-id="e481a-114">IOutputChannel,</span></span><br /><br /> <span data-ttu-id="e481a-115">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-115">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IAsyncOutboundHandler`|<span data-ttu-id="e481a-116">支持异步单向发送或请求/响应模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-116">Supports asynchronous one-way send or request/response pattern.</span></span>|<span data-ttu-id="e481a-117">IOutputChannel，</span><span class="sxs-lookup"><span data-stu-id="e481a-117">IOutputChannel,</span></span><br /><br /> <span data-ttu-id="e481a-118">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-118">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IInboundHandler`|<span data-ttu-id="e481a-119">支持单向接收或答复模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-119">Supports one-way receive or reply patterns.</span></span>|<span data-ttu-id="e481a-120">IInputChannel，</span><span class="sxs-lookup"><span data-stu-id="e481a-120">IInputChannel,</span></span><br /><br /> <span data-ttu-id="e481a-121">IReplyChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-121">IReplyChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IAsyncInboundHandler`|<span data-ttu-id="e481a-122">支持的单向方法的异步变体接收或答复模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-122">Supports asynchronous variants of methods one-way receive or reply patterns.</span></span>|<span data-ttu-id="e481a-123">IInputChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-123">IInputChannel</span></span><br /><br /> <span data-ttu-id="e481a-124">IReplyChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-124">IReplyChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataBrowseHandler`|<span data-ttu-id="e481a-125">支持的目标系统上的元数据浏览。</span><span class="sxs-lookup"><span data-stu-id="e481a-125">Supports browsing of metadata on the target system.</span></span>|<span data-ttu-id="e481a-126">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-126">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataSearchHandler`|<span data-ttu-id="e481a-127">支持搜索的目标系统上的元数据。</span><span class="sxs-lookup"><span data-stu-id="e481a-127">Supports searching of metadata on the target system.</span></span>|<span data-ttu-id="e481a-128">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-128">IRequestChannel</span></span>|  
|`Microsoft.ServiceModel.Channels.Common.IMetadataResolverHandler`|<span data-ttu-id="e481a-129">支持从目标系统的元数据检索。</span><span class="sxs-lookup"><span data-stu-id="e481a-129">Supports retrieval of metadata from the target system.</span></span>|<span data-ttu-id="e481a-130">IRequestChannel</span><span class="sxs-lookup"><span data-stu-id="e481a-130">IRequestChannel</span></span>|  
  
## <a name="channel-implementation"></a><span data-ttu-id="e481a-131">通道实现</span><span class="sxs-lookup"><span data-stu-id="e481a-131">Channel implementation</span></span>  
 <span data-ttu-id="e481a-132">使用生成的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]基本上是传输通道 (System.ServiceModel.Channels.IServiceListner)。</span><span class="sxs-lookup"><span data-stu-id="e481a-132">An adapter built using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is basically a transport channel (System.ServiceModel.Channels.IServiceListner).</span></span> <span data-ttu-id="e481a-133">使用生成的适配器[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供给使用者为 WCF 绑定，其中使用绑定创建通道堆栈。</span><span class="sxs-lookup"><span data-stu-id="e481a-133">An adapter built using the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] is surfaced to the consumer as a WCF binding, where the binding is used to create the channel stack.</span></span> <span data-ttu-id="e481a-134">此绑定可被视为的其他预定义的 WCF 绑定，如 BasicHttpBinding、 WsHttpBinding 和 NetTcpBinding，对等方，并可以通过 app.config 或在代码中通过设置客户端应用程序在调用服务时。</span><span class="sxs-lookup"><span data-stu-id="e481a-134">This binding can be considered a peer to other predefined WCF bindings such as BasicHttpBinding, WsHttpBinding, and NetTcpBinding, and can be set via app.config or in code by the client application when calling a service.</span></span> <span data-ttu-id="e481a-135">此绑定包含绑定元素，与适配器正在从 T:System.ServiceModel.Channels.TransportBindingElement 类派生的键绑定元素的有序的集。</span><span class="sxs-lookup"><span data-stu-id="e481a-135">This binding contains an ordered set of binding elements, with the adapter being the key binding element that derives from the T:System.ServiceModel.Channels.TransportBindingElement class.</span></span> <span data-ttu-id="e481a-136">在出站方案中，[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]运行时使用的通道工厂以创建适配器 （即，传输通道）。</span><span class="sxs-lookup"><span data-stu-id="e481a-136">In an outbound scenario, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] runtime uses a channel factory to create the adapter (that is, the transport channel).</span></span> <span data-ttu-id="e481a-137">在入站方案中，[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]运行时使用的通道侦听器为传入通道在服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="e481a-137">In an inbound scenario, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] runtime makes use of channel listeners for incoming channels in a service application.</span></span>  <span data-ttu-id="e481a-138">运行时间以及设计时消息都会通过此组件。</span><span class="sxs-lookup"><span data-stu-id="e481a-138">Both run-time as well as design-time messages pass through this component.</span></span>  
  
## <a name="connection-factory-connection-and-connection-uri-builder"></a><span data-ttu-id="e481a-139">连接工厂、 连接和连接 URI 生成器</span><span class="sxs-lookup"><span data-stu-id="e481a-139">Connection factory, connection, and connection URI builder</span></span>  
 <span data-ttu-id="e481a-140">*ConnectionFactory*提供用于创建基于 URI 和用户凭据的连接的工厂模式。</span><span class="sxs-lookup"><span data-stu-id="e481a-140">*ConnectionFactory* provides a factory pattern for creating connections based on URI and user credentials.</span></span> <span data-ttu-id="e481a-141">有关详细信息，请参阅`Microsoft.ServiceModel.Channels.Common.IConnectionFactory`。</span><span class="sxs-lookup"><span data-stu-id="e481a-141">For more information, see `Microsoft.ServiceModel.Channels.Common.IConnectionFactory`.</span></span>  
  
 <span data-ttu-id="e481a-142">*连接*定义与目标系统中，低级别的通信协定和封装本机通信 Api 和连接句柄。</span><span class="sxs-lookup"><span data-stu-id="e481a-142">*Connection* defines a low-level communication contract with the target system, and encapsulates native communication APIs and connection handles.</span></span> <span data-ttu-id="e481a-143">有关详细信息，请参阅`Microsoft.ServiceModel.Channels.Common.IConnection`。</span><span class="sxs-lookup"><span data-stu-id="e481a-143">For more information, see `Microsoft.ServiceModel.Channels.Common.IConnection`.</span></span>  
  
 <span data-ttu-id="e481a-144">*连接 Uri 生成器*允许适配器使用者能够以编程方式生成连接 Uri 特定不知情的情况下的语法。</span><span class="sxs-lookup"><span data-stu-id="e481a-144">The *Connection Uri Builder* allows adapter consumers to programmatically build connection URIs without specific knowledge of syntax.</span></span> <span data-ttu-id="e481a-145">有关详细信息，请参阅`Microsoft.ServiceModel.Channels.Common.ConnectionUri`。</span><span class="sxs-lookup"><span data-stu-id="e481a-145">For more information, see `Microsoft.ServiceModel.Channels.Common.ConnectionUri`.</span></span>  
  
## <a name="connection-management"></a><span data-ttu-id="e481a-146">连接管理</span><span class="sxs-lookup"><span data-stu-id="e481a-146">Connection management</span></span>  
 <span data-ttu-id="e481a-147">*连接管理*负责的生存期管理的适配器的连接。</span><span class="sxs-lookup"><span data-stu-id="e481a-147">*Connection management* is responsible for the lifetime management of the connections of an adapter.</span></span> <span data-ttu-id="e481a-148">它在内部将保留连接的池可供使用。</span><span class="sxs-lookup"><span data-stu-id="e481a-148">It internally keeps a pool of the connections ready for use.</span></span> <span data-ttu-id="e481a-149">此连接池是凭据和基于 URI 的。</span><span class="sxs-lookup"><span data-stu-id="e481a-149">This connection pool is credential and URI-based.</span></span> <span data-ttu-id="e481a-150">凭据包含的用户名称和定义的安全上下文连接的密码在其下运行。</span><span class="sxs-lookup"><span data-stu-id="e481a-150">The credential contains a user name and password that define the security context the connection runs under.</span></span>  
  
 <span data-ttu-id="e481a-151">当使用相同的凭据和 URI 时，在相同的连接工厂下打开任何通道如果已存在一个可用获取连接池中的线程。</span><span class="sxs-lookup"><span data-stu-id="e481a-151">When the same credentials and URI are used, any channel being opened under the same connection factory obtains the connection from the pool if there is one available already.</span></span>  
  
 <span data-ttu-id="e481a-152">连接池管理器将保留与该 URI，而不考虑凭据以及与通道工厂在边界之间有多少打开连接的记录。</span><span class="sxs-lookup"><span data-stu-id="e481a-152">Connection pool manager keeps records of how many open connections there are to that URI regardless of the credentials and across the boundaries of the channel factory.</span></span> <span data-ttu-id="e481a-153">例如，在一个系统中，你可以有两个用户具有不同的凭据，这意味着两个连接到系统的通道工厂。</span><span class="sxs-lookup"><span data-stu-id="e481a-153">For example, in one system, you can have two users who have different credentials, which means there are two channel factories connecting to the system.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e481a-154">适配器可能会受到某些限制，它可以支持的连接数方面通常受系统资源限制。</span><span class="sxs-lookup"><span data-stu-id="e481a-154">The adapter may be limited with respect to the number of connections it can support, generally limited by system resources.</span></span>  
  
 <span data-ttu-id="e481a-155">若要帮助适配器开发人员配置连接池设置，[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供两个类，`Microsoft.ServiceModel.Channels.Common.ConnectionPoolSettings`和`Microsoft.ServiceModel.Channels.Common.ConnectionManagerSettings`。</span><span class="sxs-lookup"><span data-stu-id="e481a-155">To help adapter developers configure the connection pool settings, the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] provides two classes, `Microsoft.ServiceModel.Channels.Common.ConnectionPoolSettings` and `Microsoft.ServiceModel.Channels.Common.ConnectionManagerSettings`.</span></span>  
  
## <a name="metadata-management"></a><span data-ttu-id="e481a-156">元数据管理</span><span class="sxs-lookup"><span data-stu-id="e481a-156">Metadata management</span></span>  
 <span data-ttu-id="e481a-157">*元数据管理*负责面向对象的表示形式的目标系统的元数据缓存。</span><span class="sxs-lookup"><span data-stu-id="e481a-157">*Metadata management* is responsible for the object-oriented representation of the caching of the metadata for the target system.</span></span> <span data-ttu-id="e481a-158">元数据可容纳在常见的缓存中访问跨所有凭据，也可以是缓存的每个凭据基础。</span><span class="sxs-lookup"><span data-stu-id="e481a-158">Metadata can be held in a common cache accessible across all credentials, or it can be cached per credential basis.</span></span>  
  
 <span data-ttu-id="e481a-159">元数据生命周期开头其设计时定义，并在运行时期间继续通过使用情况。</span><span class="sxs-lookup"><span data-stu-id="e481a-159">The metadata life cycle begins with its design-time definitions and continues through usage during runtime.</span></span> <span data-ttu-id="e481a-160">在设计时，适配器开发人员必须确定的一组操作，并必须生成必要的 WSDL 和客户端代理。</span><span class="sxs-lookup"><span data-stu-id="e481a-160">At design time, adapter developers must identify the set of operations, and must generate the necessary WSDL and client side proxy.</span></span> <span data-ttu-id="e481a-161">在运行时，基于适配器框架的适配器使用的预定义的元数据来解释从目标系统调用返回的消息。</span><span class="sxs-lookup"><span data-stu-id="e481a-161">At runtime, the Adapter Framework-based adapters use the predefined metadata to interpret the messages returned from the target system calls.</span></span>  
  
 <span data-ttu-id="e481a-162">为了帮助配置元数据设置的适配器编写器，适配器框架，提供了三个类， `Microsoft.ServiceModel.Channels.Common.CacheSettings`，`Microsoft.ServiceModel.Channels.Common.MetadataSettings`和`Microsoft.ServiceModel.Channels.Common.CommonCacheSettings`。</span><span class="sxs-lookup"><span data-stu-id="e481a-162">To help adapter writers configure the metadata setting, the Adapter Framework provides three classes, `Microsoft.ServiceModel.Channels.Common.CacheSettings`, `Microsoft.ServiceModel.Channels.Common.MetadataSettings` and `Microsoft.ServiceModel.Channels.Common.CommonCacheSettings`.</span></span>  
  
## <a name="wsdl-builder"></a><span data-ttu-id="e481a-163">WSDL 生成器</span><span class="sxs-lookup"><span data-stu-id="e481a-163">WSDL builder</span></span>  
 <span data-ttu-id="e481a-164">*WSDL 生成器*提供自动 WSDL 生成从 WCF LOB 适配器 SDK 中的内部元数据对象模型 （它可以为需要自定义 WSDL 生成的方案中覆盖）。</span><span class="sxs-lookup"><span data-stu-id="e481a-164">*WSDL Builder* provides automatic WSDL generation from the WCF LOB Adapter SDK's internal metadata object model (it can be overridden for scenarios that require custom WSDL generation).</span></span>  
  
 <span data-ttu-id="e481a-165">请参阅`Microsoft.ServiceModel.Channels.Common.IWsdlRetrieval`有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="e481a-165">See `Microsoft.ServiceModel.Channels.Common.IWsdlRetrieval` for more information.</span></span>  
  
## <a name="metadata-browsesearch"></a><span data-ttu-id="e481a-166">元数据浏览/搜索</span><span class="sxs-lookup"><span data-stu-id="e481a-166">Metadata browse/search</span></span>  
 <span data-ttu-id="e481a-167">*元数据浏览/搜索*允许用于浏览和搜索所有 LOB 元数据。</span><span class="sxs-lookup"><span data-stu-id="e481a-167">*Metadata browse/search* allows for browsing and searching all LOB metadata.</span></span>  
  
 <span data-ttu-id="e481a-168">有关详细信息，请参阅`Microsoft.ServiceModel.Channels.IMetadataRetrievalContract`。</span><span class="sxs-lookup"><span data-stu-id="e481a-168">For more information, see `Microsoft.ServiceModel.Channels.IMetadataRetrievalContract`.</span></span>  
  
## <a name="metadata-generation"></a><span data-ttu-id="e481a-169">元数据生成</span><span class="sxs-lookup"><span data-stu-id="e481a-169">Metadata generation</span></span>  
 <span data-ttu-id="e481a-170">*元数据生成*允许客户端 （用于出站方案） 的生成代码以及根据选择的适配器使用者的操作 （用于入站方案） 服务。</span><span class="sxs-lookup"><span data-stu-id="e481a-170">*Metadata generation* allows for generating code for the client (for outbound scenarios) and for the service (for inbound scenarios) based on operations selected by the adapter consumer.</span></span> <span data-ttu-id="e481a-171">即使我们建议适配器使用者使用的工具[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] ([!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]发生 BizTalk 应用程序时)，则[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]提供一个公共接口`Microsoft.ServiceModel.Channels.MetadataRetrievalClient.GetMetadata%2A`检索System.Web.Services.Description.ServiceDescription，它表示 Web 服务描述语言 (WSDL) 包含有关所选的操作和类型的信息。</span><span class="sxs-lookup"><span data-stu-id="e481a-171">Even though we recommend that adapter consumers use the tools [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] ([!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)] in case of BizTalk applications), the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] provides a public interface `Microsoft.ServiceModel.Channels.MetadataRetrievalClient.GetMetadata%2A` to retrieve the System.Web.Services.Description.ServiceDescription, which represents a Web Service Description Language (WSDL) containing information about selected operations and types.</span></span> <span data-ttu-id="e481a-172">适配器编写器常犯的元数据对象模型的使用[!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)]包括派生自的类`Microsoft.ServiceModel.Channels.Common.OperationMetadata`和`Microsoft.ServiceModel.Channels.Common.TypeMetadata`来描述每个操作和类型的详细信息。</span><span class="sxs-lookup"><span data-stu-id="e481a-172">Adapter writers make use of the metadata object model for the [!INCLUDE[afproductnameshort](../../includes/afproductnameshort-md.md)] that includes classes derived from `Microsoft.ServiceModel.Channels.Common.OperationMetadata` and `Microsoft.ServiceModel.Channels.Common.TypeMetadata` to describe the details of each operation and type.</span></span>  
  