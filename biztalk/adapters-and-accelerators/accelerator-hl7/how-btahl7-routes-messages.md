---
title: BTAHL7 如何路由消息 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- routing, about routing
- routing, messages
- messages, routing
- BTAHL7, message routing
ms.assetid: 555696c7-6023-44eb-b13d-cf7527bbc92f
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 6b4223648bc62cf748640a9528a831deafdafa2c
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65292933"
---
# <a name="how-btahl7-routes-messages"></a><span data-ttu-id="ea243-102">BTAHL7 如何路由消息</span><span class="sxs-lookup"><span data-stu-id="ea243-102">How BTAHL7 Routes Messages</span></span>
<span data-ttu-id="ea243-103">Microsoft BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) 利用的消息处理功能的 Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]，而且还在特定于 HL7 消息传送要求多种扩展它。</span><span class="sxs-lookup"><span data-stu-id="ea243-103">Microsoft BizTalk Accelerator for HL7 ([!INCLUDE[btaBTAHL71.3abbrevnonumber](../../includes/btabtahl71-3abbrevnonumber-md.md)]) leverages the message processing capabilities of Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)], but also extends it in several ways that are specific to HL7 messaging requirements.</span></span>  

## <a name="routing-overview"></a><span data-ttu-id="ea243-104">路由概述</span><span class="sxs-lookup"><span data-stu-id="ea243-104">Routing overview</span></span>

<span data-ttu-id="ea243-105">HL7 从业务线 (LOB) 系统接收消息，并可能会收到它们使用 MLLP 适配器。</span><span class="sxs-lookup"><span data-stu-id="ea243-105">HL7 receives messages from a Line of Business (LOB) system, and may receive them using the MLLP adapter.</span></span> <span data-ttu-id="ea243-106">LOB 系统连接到处的 MLLP 适配器上[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]通过 TCP 端口，然后向处的 MLLP 适配器发送消息。</span><span class="sxs-lookup"><span data-stu-id="ea243-106">The LOB system connects to MLLP adapter on [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] over a TCP port, and then sends messages to the MLLP adapter.</span></span>

<span data-ttu-id="ea243-107">在中**[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)]和较旧版本**，HL7 MLLP 接收远程 LOB 系统连接到 MLLP 传输适配器等待。</span><span class="sxs-lookup"><span data-stu-id="ea243-107">In **[!INCLUDE[bts2013r2_md](../../includes/bts2013r2-md.md)] and older versions**, the HL7 MLLP receive transport adapter waits for the remote LOB system to connect to MLLP.</span></span> <span data-ttu-id="ea243-108">LOB 系统远程 LOB 系统连接后，将使用为 MLLP 的消息发送[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="ea243-108">Once the remote LOB system connects, the LOB system sends the messages using MLLP to the [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="ea243-109">具体来说：</span><span class="sxs-lookup"><span data-stu-id="ea243-109">Specifically:</span></span> 

1. <span data-ttu-id="ea243-110">远程 LOB 系统连接到本地处的 MLLP 适配器[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]使用 TCP 端口</span><span class="sxs-lookup"><span data-stu-id="ea243-110">The remote LOB system connects to the MLLP adapter on the local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] using a TCP port</span></span> 
2. <span data-ttu-id="ea243-111">BTA4HL7 的接收位置处的 MLLP 适配器接受连接</span><span class="sxs-lookup"><span data-stu-id="ea243-111">The BTA4HL7 receive location with MLLP Adapter accepts the connection</span></span> 
3. <span data-ttu-id="ea243-112">远程 LOB 系统将一个或多个消息传递</span><span class="sxs-lookup"><span data-stu-id="ea243-112">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="ea243-113">断开与远程 LOB 系统的连接</span><span class="sxs-lookup"><span data-stu-id="ea243-113">The remote LOB system disconnects</span></span>

<span data-ttu-id="ea243-114">在中**[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)]和更高版本**、 由处的 MLLP 适配器，启动与 LOB 系统的连接，并为 MLLP 的 LOB 系统推送消息接收。</span><span class="sxs-lookup"><span data-stu-id="ea243-114">In **[!INCLUDE[bts2016_md](../../includes/bts2016-md.md)] and newer versions**, the connection to the LOB system is initiated by the MLLP adapter, and then the LOB system pushes messages to the MLLP receive.</span></span> <span data-ttu-id="ea243-115">换而言之，远程 LOB 系统等待向 MLLP 发送消息传递之前的连接。</span><span class="sxs-lookup"><span data-stu-id="ea243-115">In other words, the remote LOB system waits for the connection before sending messagings to MLLP.</span></span> <span data-ttu-id="ea243-116">具体来说：</span><span class="sxs-lookup"><span data-stu-id="ea243-116">Specifically:</span></span> 

1. <span data-ttu-id="ea243-117">本地[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]连接到远程 LOB 系统使用的 TCP 端口</span><span class="sxs-lookup"><span data-stu-id="ea243-117">The local [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] connects to the remote LOB system using a TCP port</span></span> 
2. <span data-ttu-id="ea243-118">BTA4HL7 的接收位置处的 MLLP 适配器启动连接</span><span class="sxs-lookup"><span data-stu-id="ea243-118">The BTA4HL7 receive location with MLLP adapter initiates the connection</span></span> 
3. <span data-ttu-id="ea243-119">远程 LOB 系统将一个或多个消息传递</span><span class="sxs-lookup"><span data-stu-id="ea243-119">The remote LOB system delivers one or more messages</span></span> 
4. <span data-ttu-id="ea243-120">断开与远程 LOB 系统的连接</span><span class="sxs-lookup"><span data-stu-id="ea243-120">The remote LOB system disconnects</span></span> 

<span data-ttu-id="ea243-121">用于向后兼容性，可以使用原始的默认行为，远程 LOB 系统会启动连接。</span><span class="sxs-lookup"><span data-stu-id="ea243-121">For backwards-compatibility, you can use the original default behavior where the remote LOB system initiates the connections.</span></span> <span data-ttu-id="ea243-122">此选项是可在 MLLP 中配置接收位置属性。</span><span class="sxs-lookup"><span data-stu-id="ea243-122">This option is configurable in the MLLP receive location properties.</span></span> 
 
<span data-ttu-id="ea243-123">一旦收到 HL7 消息，然后提交到 HL7 接收管道。</span><span class="sxs-lookup"><span data-stu-id="ea243-123">Once the HL7 message is received, it is then submitted to an HL7 receive pipeline.</span></span> <span data-ttu-id="ea243-124">在此管道中，HL7 反汇编程序将分析该消息，并将验证根据相应的架构定义和验证配置的消息。</span><span class="sxs-lookup"><span data-stu-id="ea243-124">Within this pipeline, the HL7 disassembler will parse the message, and will validate the message according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="ea243-125">在此情况下，确认消息可能是 HL7 生成 （成功或错误），根据消息和相关确认配置的有效性。</span><span class="sxs-lookup"><span data-stu-id="ea243-125">At this point, an HL7 acknowledgment message may be generated (success or error), according to the validity of the message and the relevant acknowledgment configuration.</span></span> <span data-ttu-id="ea243-126">在这里，管道将提交的消息实例和可选确认到 MessageBox 数据库，以进一步处理和路由。</span><span class="sxs-lookup"><span data-stu-id="ea243-126">From here, the pipeline will submit the message instance and optional acknowledgment to the MessageBox database for further processing and routing.</span></span>  
  
 <span data-ttu-id="ea243-127">在 MessageBox 数据库中，收到的消息实例后[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]检查基于筛选器的订阅，并将消息路由到一个或多个通过 HL7 发送管道的发送端口 （可能是 MLLP 端口）。</span><span class="sxs-lookup"><span data-stu-id="ea243-127">Once a message instance arrives in the MessageBox database, [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] checks filter-based subscriptions and routes the message to one or more send ports (possibly MLLP ports) through an HL7 send pipeline.</span></span> <span data-ttu-id="ea243-128">发送管道可能会验证消息实例根据相应的架构定义和验证配置。</span><span class="sxs-lookup"><span data-stu-id="ea243-128">The send pipeline may validate the message instances according to the appropriate schema definition and validation configuration.</span></span> <span data-ttu-id="ea243-129">除了验证，则可以重写的传出消息的 MSH 段中的某些字段值。</span><span class="sxs-lookup"><span data-stu-id="ea243-129">In addition to validation, it is possible to override certain field values in the MSH segment of the outgoing message.</span></span> <span data-ttu-id="ea243-130">如果多个端口已订阅的一条消息，并且每个接收应用程序的 MSH 段值内的唯一期望这种重写功能特别有用。</span><span class="sxs-lookup"><span data-stu-id="ea243-130">This override ability is especially useful if multiple ports have subscribed to a message and each receiving application has unique expectations within the MSH segment values.</span></span>  
  
 <span data-ttu-id="ea243-131">当然，所有其他[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]发送和接收端口功能将可供 HL7 消息，以及可能是唯一的选择的端口类型，如 MLLP 发送端口参数的某些功能。</span><span class="sxs-lookup"><span data-stu-id="ea243-131">Of course, all of the other [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] send and receive port capabilities will be available to HL7 messages, along with some capabilities that may be unique to the selected port type, such as MLLP send-port parameters.</span></span> <span data-ttu-id="ea243-132">相关示例[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]功能是能够将转换映射应用于出站消息。</span><span class="sxs-lookup"><span data-stu-id="ea243-132">An example of the relevant [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] capabilities would be the ability to apply a transformation map to an outbound message.</span></span>  
  
## <a name="how-routing-works"></a><span data-ttu-id="ea243-133">路由的工作原理</span><span class="sxs-lookup"><span data-stu-id="ea243-133">How Routing Works</span></span>

<span data-ttu-id="ea243-134">[!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)]路由 HL7 消息根据订阅的 MessageBox 数据库会管理实例。</span><span class="sxs-lookup"><span data-stu-id="ea243-134">The [!INCLUDE[btaBTAHL7NoNumber_md](../../includes/btabtahl7nonumber-md.md)] routes HL7 message instances according to subscriptions that the MessageBox database manages.</span></span> <span data-ttu-id="ea243-135">这些订阅的每个发送端口使用你定义的筛选器。</span><span class="sxs-lookup"><span data-stu-id="ea243-135">These subscriptions use filters that you define for each send port.</span></span> <span data-ttu-id="ea243-136">示例筛选器可能包括路由基于在接收端口 ID 和/或 HL7 消息类型 (ADT ^ A03，例如) 和/或发送应用程序 （MSH3.1 值）。</span><span class="sxs-lookup"><span data-stu-id="ea243-136">Example filters might include routing based on receive port ID and/or HL7 message type (ADT^A03, for example) and/or sending application (MSH3.1 value).</span></span>  
  
 <span data-ttu-id="ea243-137">除了需要设置[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]订阅，您需要执行一些特定于 HL7 的消息传送配置将影响 HL7 消息实例作为[!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)]将其路由。</span><span class="sxs-lookup"><span data-stu-id="ea243-137">In addition to setting up [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] subscriptions, you need to perform some HL7-specific messaging configuration that will affect HL7 message instances as [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] routes them.</span></span> <span data-ttu-id="ea243-138">此附加配置，可应用唯一 HL7 验证规则、 自动生成的确认和重写 MSH 值的功能。</span><span class="sxs-lookup"><span data-stu-id="ea243-138">This additional configuration enables you to apply unique HL7 validation rules, automatic generation of acknowledgments, and the ability to override MSH values.</span></span> [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] <span data-ttu-id="ea243-139">应用此配置在参与方级别。</span><span class="sxs-lookup"><span data-stu-id="ea243-139">applies this configuration at the party level.</span></span> <span data-ttu-id="ea243-140">您需要定义参与方在 BizTalk 资源管理器并执行中的相关的 HL7 配置[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]配置资源管理器。</span><span class="sxs-lookup"><span data-stu-id="ea243-140">You need to define parties within BizTalk Explorer and perform the related HL7 configuration within [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] Configuration Explorer.</span></span>  
  
 <span data-ttu-id="ea243-141">若要将唯一 HL7 消息传送配置 （例如，验证或 MSH 替代） 应用于多个订阅的消息的发送端口，需要创建参与方之间的关联和发送端口。</span><span class="sxs-lookup"><span data-stu-id="ea243-141">To apply unique HL7 messaging configuration (for example, validation or MSH overrides) to multiple send ports that subscribe to a message, you need to create associations between parties and send ports.</span></span> <span data-ttu-id="ea243-142">为在 BizTalk 浏览器中的参与方属性配置参与方发送端口关联。</span><span class="sxs-lookup"><span data-stu-id="ea243-142">You configure party-to-send port associations as party properties within BizTalk Explorer.</span></span>  
  
 <span data-ttu-id="ea243-143">如果您不需要将消息路由 HL7 到多个发送端口，或将唯一 HL7 处理配置应用到多个发送端口，可以排除将参与方与发送端口相关联的步骤。</span><span class="sxs-lookup"><span data-stu-id="ea243-143">If you do not need to route HL7 messages to multiple send ports, or apply unique HL7 processing configuration to multiple send ports, you can eliminate the step of associating parties with send ports.</span></span> <span data-ttu-id="ea243-144">在这种情况下，[!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)]将参与方相关联的 HL7 消息 (MSH 3.1) 中的接收应用程序字段通过其 HL7 消息配置。</span><span class="sxs-lookup"><span data-stu-id="ea243-144">In this case, [!INCLUDE[HL7_CurrentVersion_abbrev_md](../../includes/hl7-currentversion-abbrev-md.md)] associates the party with its HL7 messaging configuration through the receiving application field in the HL7 message (MSH 3.1).</span></span> <span data-ttu-id="ea243-145">这种情况下是最可能出现在 HL7 interrogative （请求/响应） 消息交换。</span><span class="sxs-lookup"><span data-stu-id="ea243-145">This situation is most likely to occur in an HL7 interrogative (request/response) message exchange.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ea243-146">请参阅</span><span class="sxs-lookup"><span data-stu-id="ea243-146">See Also</span></span>  
 [<span data-ttu-id="ea243-147">消息验证</span><span class="sxs-lookup"><span data-stu-id="ea243-147">Message Validation</span></span>](../../adapters-and-accelerators/accelerator-hl7/message-validation.md)