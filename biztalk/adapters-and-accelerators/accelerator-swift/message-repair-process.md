---
title: 消息修复进程 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- repairing messages
- errors, messages
- messages, errors
- validating, messages
- messages, validating
ms.assetid: 87b97cec-5796-4684-bcf0-53285aca7ee2
caps.latest.revision: 7
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 6f9f42b23a7849c918f583946fd2c8e7cace4bf8
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65377211"
---
# <a name="message-repair-process"></a><span data-ttu-id="4759d-102">消息修复进程</span><span class="sxs-lookup"><span data-stu-id="4759d-102">Message Repair Process</span></span>
<span data-ttu-id="4759d-103">默认情况下， [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] MessageBox 数据库的挂起队列中挂起失败的消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-103">By default, [!INCLUDE[btsBizTalkServerNoVersion](../../includes/btsbiztalkservernoversion-md.md)] suspends failed messages in the suspended queue of the MessageBox database.</span></span> <span data-ttu-id="4759d-104">此过程处理独立于成功的消息失败的消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-104">This process handles failed messages separately from successful messages.</span></span> <span data-ttu-id="4759d-105">使用此默认的机制，但是，可以检索失败的消息并修复它们的能力有限。</span><span class="sxs-lookup"><span data-stu-id="4759d-105">Using this default mechanism, however, you have a limited ability to retrieve failed messages and repair them.</span></span> <span data-ttu-id="4759d-106">消息修复和新提交的功能[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]使[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户修复一条消息并将其重新提交。</span><span class="sxs-lookup"><span data-stu-id="4759d-106">The Message Repair and New Submission feature of [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] enables an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user to repair a message and resubmit it.</span></span> <span data-ttu-id="4759d-107">另一个[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]然后，用户可以验证修复，并且第三个可以批准修复。</span><span class="sxs-lookup"><span data-stu-id="4759d-107">Another [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user can then verify the repairs, and a third can approve the repairs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4759d-108">在此上下文中，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户是在部门修复工作流中执行角色的用户。</span><span class="sxs-lookup"><span data-stu-id="4759d-108">In this context, an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user is a user that performs a role in a departmental repair workflow.</span></span> <span data-ttu-id="4759d-109">此 A4SWIFT 用户是定义，并且关联中的配置文件 Web 客户端的用户链接的证书。</span><span class="sxs-lookup"><span data-stu-id="4759d-109">This A4SWIFT user is defined, and associated with a certificate, in the Users link of the Profile Web Client.</span></span> <span data-ttu-id="4759d-110">这[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户不是与相同[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]用户帐户，如中所定义[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户组中[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]计算机管理实用程序。</span><span class="sxs-lookup"><span data-stu-id="4759d-110">This [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user is not the same as a [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] user account, as defined in the [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] Users group in the [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] Computer Management utility.</span></span> <span data-ttu-id="4759d-111">作为工作的人员[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户必须具有[!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)]用户帐户，以便提交一条消息时，他们可以使用该帐户的证书。</span><span class="sxs-lookup"><span data-stu-id="4759d-111">The person functioning as an [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user must have a [!INCLUDE[btsWinNoVersion](../../includes/btswinnoversion-md.md)] user account so that they can use that account's certificates when submitting a message.</span></span> <span data-ttu-id="4759d-112">但是，此人也可以用作其他[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]用户： repairer、 验证、 审批者或创建者。</span><span class="sxs-lookup"><span data-stu-id="4759d-112">However, that person can also serve as other [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] users: repairer, verifier, approver, or creator.</span></span> <span data-ttu-id="4759d-113">有关详细信息，请参阅[创建部门和角色用于消息修复和新提交](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md)。</span><span class="sxs-lookup"><span data-stu-id="4759d-113">For more information, see [Creating Departments and Roles for Message Repair and New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md).</span></span>  
  
 <span data-ttu-id="4759d-114">借助此修复工作流，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]不会挂起失败的消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-114">With this repair workflow, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] does not suspend a failed message.</span></span> <span data-ttu-id="4759d-115">它在失败的消息中，执行其他处理，然后会将消息放入 MessageBox 中，就像一样成功消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-115">It performs additional processing on the failed message, and then drops the message into the MessageBox, just as it would a successful message.</span></span> <span data-ttu-id="4759d-116">修复业务流程放置到消息[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]MRSR 站点，在用户能够在其函数[!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)]窗体。</span><span class="sxs-lookup"><span data-stu-id="4759d-116">The repair orchestration drops the message into the [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] MRSR site, where users can perform their functions in [!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)] forms.</span></span>  
  
## <a name="message-validation"></a><span data-ttu-id="4759d-117">消息验证</span><span class="sxs-lookup"><span data-stu-id="4759d-117">Message Validation</span></span>  
 <span data-ttu-id="4759d-118">消息修复和新提交将发送到用于修复 MRSR 站点以下的验证失败的任何消息：</span><span class="sxs-lookup"><span data-stu-id="4759d-118">Message Repair and New Submission sends any message failing the following validation to MRSR site for repair:</span></span>  
  
- <span data-ttu-id="4759d-119">执行的平面文件分析器 （未分析消息） 的结构验证</span><span class="sxs-lookup"><span data-stu-id="4759d-119">Structural validation performed by the flat file parser (unparsed messages)</span></span>  
  
- <span data-ttu-id="4759d-120">执行的验证读取器的 XML 的数据验证</span><span class="sxs-lookup"><span data-stu-id="4759d-120">Data validation performed by the XML validating reader</span></span>  
  
- <span data-ttu-id="4759d-121">执行由业务规则引擎 (BRE) 的 SWIFT 网络和使用情况的规则验证</span><span class="sxs-lookup"><span data-stu-id="4759d-121">SWIFT network and usage rule validation performed by the Business Rule Engine (BRE)</span></span>  
  
  [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] <span data-ttu-id="4759d-122">收集随 SWIFT 消息的错误集合对象中的验证过程中遇到任何错误。</span><span class="sxs-lookup"><span data-stu-id="4759d-122">collects any errors encountered during validation in an error collection object that travels with the SWIFT message.</span></span> <span data-ttu-id="4759d-123">修复过程包括到 XML 中，并将其附加到错误过程中的消息序列化的错误信息。</span><span class="sxs-lookup"><span data-stu-id="4759d-123">The repair process includes serializing error information into XML and attaching it to the message as an error part.</span></span> <span data-ttu-id="4759d-124">这种处理还包括将标记一个已升级的属性，指示消息未通过验证的消息 ([!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]_Failed = = True)，并报告该错误的另一个已提升的属性的每个验证阶段计数。</span><span class="sxs-lookup"><span data-stu-id="4759d-124">This processing also includes marking the message with a promoted property that indicates that the message has failed validation ([!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]_Failed==True), and another promoted property that reports the error counts for each validation stage.</span></span> <span data-ttu-id="4759d-125">生成的多部分消息由以下内容组成：</span><span class="sxs-lookup"><span data-stu-id="4759d-125">The resulting multipart message consists of the following:</span></span>  
  
- <span data-ttu-id="4759d-126">包含失败的消息正文部分</span><span class="sxs-lookup"><span data-stu-id="4759d-126">A body part containing the failed message</span></span>  
  
- <span data-ttu-id="4759d-127">错误部分，其中包含错误集合 XML</span><span class="sxs-lookup"><span data-stu-id="4759d-127">An error part containing the error-collection XML</span></span>  
  
- <span data-ttu-id="4759d-128">升级的属性，该值指示故障状态</span><span class="sxs-lookup"><span data-stu-id="4759d-128">Promoted properties indicating the failure state</span></span>  
  
## <a name="message-repair"></a><span data-ttu-id="4759d-129">消息修复</span><span class="sxs-lookup"><span data-stu-id="4759d-129">Message Repair</span></span>  
 <span data-ttu-id="4759d-130">MRSRDepartmentPolicy 将 MRSRDepartmentRule 业务规则确定哪个部门将处理失败的消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-130">The MRSRDepartmentRule business rule within the MRSRDepartmentPolicy determines which department will handle the failed message.</span></span> <span data-ttu-id="4759d-131">消息修复业务流程首先修复工作流将消息路由到与该部门中的修复角色相关联的收件箱。</span><span class="sxs-lookup"><span data-stu-id="4759d-131">The message repair orchestration starts the repair workflow by routing the message to an inbox associated with the repair role in the department.</span></span> <span data-ttu-id="4759d-132">[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]执行修复角色的用户打开中的消息[!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)]窗体中，修复该消息，然后对进行签名并将其提交。</span><span class="sxs-lookup"><span data-stu-id="4759d-132">The [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] user performing the repair role opens the message in the [!INCLUDE[btsInpathNoVersion](../../includes/btsinpathnoversion-md.md)] form, repairs the message, and then signs and submits it.</span></span> <span data-ttu-id="4759d-133">业务流程将修复后的消息路由到的每个修复、 重新生成密钥验证或审批角色和工作流已成功完成后，将消息路由到发送端口。</span><span class="sxs-lookup"><span data-stu-id="4759d-133">The orchestration routes the repaired message to each of the repair, rekey verification, or approval roles, and after the workflow has successfully completed, routes the message to the send port.</span></span>  
  
 <span data-ttu-id="4759d-134">除了验证[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]检查消息以确定以下各项上的签名：</span><span class="sxs-lookup"><span data-stu-id="4759d-134">In addition to validation, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] checks the signatures on the message to determine the following:</span></span>  
  
- <span data-ttu-id="4759d-135">修复工作流中的用户属于同一部门</span><span class="sxs-lookup"><span data-stu-id="4759d-135">The users in the repair workflow belong to the same department</span></span>  
  
- <span data-ttu-id="4759d-136">每个用户具有只需一次签名</span><span class="sxs-lookup"><span data-stu-id="4759d-136">Each user has signed just once</span></span>  
  
- <span data-ttu-id="4759d-137">将对应于用户的角色的序列匹配定义该部门的工作流中的序列</span><span class="sxs-lookup"><span data-stu-id="4759d-137">The sequence of roles corresponding to the users matches the sequence in the workflow defined for that department</span></span>  
  
  <span data-ttu-id="4759d-138">有关部门的详细信息，请参阅[创建部门和角色用于消息修复和新提交](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md)。</span><span class="sxs-lookup"><span data-stu-id="4759d-138">For more information about departments, see [Creating Departments and Roles for Message Repair and New Submission](../../adapters-and-accelerators/accelerator-swift/creating-departments-and-roles-for-message-repair-and-new-submission.md).</span></span>  
  
  [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] <span data-ttu-id="4759d-139">此外可以修复未分析的消息。</span><span class="sxs-lookup"><span data-stu-id="4759d-139">also enables you to repair unparsed messages.</span></span> <span data-ttu-id="4759d-140">但是，[!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)]修复未分析消息上执行不同的处理。</span><span class="sxs-lookup"><span data-stu-id="4759d-140">However, [!INCLUDE[btaA4SWIFT2.3abbrevnonumber](../../includes/btaa4swift2-3abbrevnonumber-md.md)] performs different processing on a repaired unparsed message.</span></span> <span data-ttu-id="4759d-141">有关详细信息，请参阅[修复未分析消息](../../adapters-and-accelerators/accelerator-swift/repairing-unparsed-messages.md)。</span><span class="sxs-lookup"><span data-stu-id="4759d-141">For more information, see [Repairing Unparsed Messages](../../adapters-and-accelerators/accelerator-swift/repairing-unparsed-messages.md).</span></span>