---
title: "对 tRFCs SAP 中的操作 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- RFCs, invoking transactional RFCs in an SAP System
- TID database
- transactional RFCs
- tRFCs, receiving inbound iransactional RFC calls from an SAP system
- tRFCs
- GUID parameter
- RFCs, processing inbound
- RfcConfirmTransID
- transaction ID (TID)
- tRFC Operations
- IDOCS, receiving IDOCs as a tRFC server
- adapters, operations on tRFCs
- RFC, invoking an RFC
ms.assetid: d6a5c515-d6aa-4b70-9c23-32d1dd94d473
caps.latest.revision: "5"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 4eac8dab219e46dc569b604a63e195f4613eb344
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2017
---
# <a name="operations-on-trfcs-in-sap"></a><span data-ttu-id="85b44-102">对 tRFCs SAP 中的操作</span><span class="sxs-lookup"><span data-stu-id="85b44-102">Operations on tRFCs in SAP</span></span>
<span data-ttu-id="85b44-103">事务 Rfc (tRFCs) 是工作的调用 (LUW) 逻辑单元的一部分的 Rfc。</span><span class="sxs-lookup"><span data-stu-id="85b44-103">Transactional RFCs (tRFCs) are RFCs that are invoked as part of a logical unit of work (LUW).</span></span> <span data-ttu-id="85b44-104">在 SAP 系统上，LUW 包含所有完成的业务或编程任务所需的步骤。</span><span class="sxs-lookup"><span data-stu-id="85b44-104">On an SAP system, an LUW contains all of the steps necessary to complete a business or programming task.</span></span> <span data-ttu-id="85b44-105">TRFC 表示一种调用 RFC;它不是一个唯一的 SAP 项目。</span><span class="sxs-lookup"><span data-stu-id="85b44-105">A tRFC represents a way of invoking an RFC; it is not a unique SAP artifact.</span></span>  
  
 <span data-ttu-id="85b44-106">你可以使用[!INCLUDE[adaptersap](../../includes/adaptersap-md.md)]tRFC 客户端，而且作为 tRFC 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-106">You can use the [!INCLUDE[adaptersap](../../includes/adaptersap-md.md)] both as a tRFC client and as a tRFC server.</span></span>  
  
-   <span data-ttu-id="85b44-107">**作为 tRFC 客户端**，适配器使应用程序以调用在 SAP 系统上 LUW 单个 RFC。</span><span class="sxs-lookup"><span data-stu-id="85b44-107">**As a tRFC client**, the adapter enables your application to invoke a single RFC in an LUW on the SAP system.</span></span> <span data-ttu-id="85b44-108">这可保证 RFC 一次性仅的执行。</span><span class="sxs-lookup"><span data-stu-id="85b44-108">This guarantees one-time only execution of the RFC.</span></span> <span data-ttu-id="85b44-109">它并不意味着事务行为。</span><span class="sxs-lookup"><span data-stu-id="85b44-109">It does not imply transactional behavior.</span></span>  
  
-   <span data-ttu-id="85b44-110">**为 tRFC 服务器**，该适配器可用于接收 LUW 内的多个 Rfc。</span><span class="sxs-lookup"><span data-stu-id="85b44-110">**As a tRFC server**, the adapter enables you to receive multiple RFCs inside an LUW.</span></span> <span data-ttu-id="85b44-111">适配器支持事务的上下文; 中的入站的 tRFC 调用这就是提交，并且支持汇总后行为。</span><span class="sxs-lookup"><span data-stu-id="85b44-111">The adapter supports inbound tRFC calls in a transactional context; that is commit and roll back behavior are supported.</span></span>  
  
## <a name="trfc-operations"></a><span data-ttu-id="85b44-112">tRFC 操作</span><span class="sxs-lookup"><span data-stu-id="85b44-112">tRFC Operations</span></span>  
 <span data-ttu-id="85b44-113">TRFC 表示一种调用 RFC;它不是一个单独的 SAP 项目。</span><span class="sxs-lookup"><span data-stu-id="85b44-113">A tRFC implies a way of invoking an RFC; it is not a separate SAP artifact.</span></span> <span data-ttu-id="85b44-114">因此，SAP 系统 （为其适配器可以检索元数据） 上的每个 RFC 还呈现为通过 tRFC [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="85b44-114">Therefore, every RFC on the SAP system (for which the adapter can retrieve metadata) is also surfaced as a tRFC by the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="85b44-115">tRFCs 中加以表示按 RFC 名称作为 TRFC 元数据类别节点下的操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-115">tRFCs are surfaced by RFC name as operations under the TRFC metadata category node.</span></span> <span data-ttu-id="85b44-116">(你可以浏览或搜索在 tRFCs **TRFC**节点使用时[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]或[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。)</span><span class="sxs-lookup"><span data-stu-id="85b44-116">(You can browse or search for tRFCs under the **TRFC** node when you use the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] or the [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].)</span></span>  
  
 <span data-ttu-id="85b44-117">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]上 tRFCs 支持以下：</span><span class="sxs-lookup"><span data-stu-id="85b44-117">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] supports the following on tRFCs:</span></span>  
  
-   <span data-ttu-id="85b44-118">导入参数</span><span class="sxs-lookup"><span data-stu-id="85b44-118">IMPORT parameters</span></span>  
  
-   <span data-ttu-id="85b44-119">更改的参数 （支持仅更改参数的输入的端）</span><span class="sxs-lookup"><span data-stu-id="85b44-119">CHANGING parameters (only the input side of the CHANGING parameter is supported)</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="85b44-120">以便为其不返回任何输出值 （导出或更改参数），将以异步方式执行 tRFCs。</span><span class="sxs-lookup"><span data-stu-id="85b44-120">tRFCs are executed asynchronously, so no output values (EXPORT or CHANGING parameters) are returned for them.</span></span>  
  
 <span data-ttu-id="85b44-121">GUID 参数显示通过 tRFC 操作的适配器中。</span><span class="sxs-lookup"><span data-stu-id="85b44-121">A GUID parameter is surfaced by the adapter for tRFC operations.</span></span> <span data-ttu-id="85b44-122">此 GUID 映射到 SAP 事务 ID (TID) 与 tRFC 的适配器。</span><span class="sxs-lookup"><span data-stu-id="85b44-122">This GUID is mapped by the adapter to the SAP transaction ID (TID) that is associated with the tRFC.</span></span> <span data-ttu-id="85b44-123">你可以使用此 GUID 参数为：</span><span class="sxs-lookup"><span data-stu-id="85b44-123">You can use this GUID parameter to:</span></span>  
  
-   <span data-ttu-id="85b44-124">确认 tRFC tRFC 客户端调用中的 SAP 系统上。</span><span class="sxs-lookup"><span data-stu-id="85b44-124">Confirm the tRFC on the SAP system in tRFC client calls.</span></span> <span data-ttu-id="85b44-125">通过调用 RfcConfirmTransId 操作执行此操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-125">You do this by invoking the RfcConfirmTransId operation.</span></span> <span data-ttu-id="85b44-126">这是特殊操作显示要确认 TID SAP 系统上的适配器。</span><span class="sxs-lookup"><span data-stu-id="85b44-126">This is a special operation surfaced by the adapter to confirm a TID on the SAP system.</span></span>  
  
-   <span data-ttu-id="85b44-127">获取实际用于从 tRFC 客户端和 tRFC 服务器方案中的适配器 tRFC 的 SAP TID。</span><span class="sxs-lookup"><span data-stu-id="85b44-127">Get the actual SAP TID used for a tRFC from the adapter in both tRFC client and tRFC server scenarios.</span></span> <span data-ttu-id="85b44-128">通过调用 SAP 的实用工具方法，ConvertGuidToTid 执行此操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-128">You do this by invoking the SAP utility method, ConvertGuidToTid.</span></span>  
  
 <span data-ttu-id="85b44-129">有关这些操作的详细信息，请参阅[特殊操作](../../adapters-and-accelerators/adapter-sap/special-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-129">For more information about these operations, see [Special Operations](../../adapters-and-accelerators/adapter-sap/special-operations.md).</span></span> <span data-ttu-id="85b44-130">有关消息结构和用于 tRFCs 适配器的 SOAP 操作的详细信息，请参阅[trfc 操作的消息架构](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-130">For more information about the message structures and SOAP actions used for tRFCs by the adapter, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="invoking-transactional-rfcs-in-an-sap-system"></a><span data-ttu-id="85b44-131">调用中某个 SAP 系统的事务性 Rfc</span><span class="sxs-lookup"><span data-stu-id="85b44-131">Invoking Transactional RFCs in an SAP System</span></span>  
 <span data-ttu-id="85b44-132">通常情况下，使用 tRFCs 来执行单个 LUW; 内的一个或多个 RFC 调用但是，由于在 SAP RFC SDK 中，限制[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]支持仅每 LUW 单个 tRFC。</span><span class="sxs-lookup"><span data-stu-id="85b44-132">Typically, tRFCs are used to execute one or more RFC calls inside a single LUW; however, due to limitations in the SAP RFC SDK, the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] supports only a single tRFC per LUW.</span></span> <span data-ttu-id="85b44-133">为此，适配器会创建每个 tRFC LUW (SAP TID)。</span><span class="sxs-lookup"><span data-stu-id="85b44-133">For this reason, the adapter creates an LUW (SAP TID) for each tRFC.</span></span> <span data-ttu-id="85b44-134">对于此类客户端，SAP 作为一种机制来确保在"一次性"执行 RFC 定义 LUW，并不意味着提交和基于回滚的事务。</span><span class="sxs-lookup"><span data-stu-id="85b44-134">For such clients, SAP defines an LUW as a mechanism to guarantee "one-time" execution of the RFC and does not imply commit and rollback-based transactions.</span></span>  
  
 <span data-ttu-id="85b44-135">以下步骤总结了在 RFC 客户端调用使用执行的任务[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="85b44-135">The following steps summarize the tasks that are performed in an RFC client call using the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="85b44-136">由适配器客户端上，执行这些步骤中的一部分，并且一些执行适配器。</span><span class="sxs-lookup"><span data-stu-id="85b44-136">Some of these steps are performed by the adapter client, and some are performed by the adapter.</span></span>  
  
1.  <span data-ttu-id="85b44-137">适配器客户端发送 tRFC 操作的请求消息。</span><span class="sxs-lookup"><span data-stu-id="85b44-137">The adapter client sends a request message for the tRFC operation.</span></span> <span data-ttu-id="85b44-138">适配器客户端可以根据需要提供此消息中的 GUID。</span><span class="sxs-lookup"><span data-stu-id="85b44-138">The adapter client can optionally supply a GUID in this message.</span></span>  
  
2.  <span data-ttu-id="85b44-139">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]接收请求消息，并使用 RFC SDK 以获取从 SAP 系统的事务 ID (TID)。</span><span class="sxs-lookup"><span data-stu-id="85b44-139">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] receives the request message and uses the RFC SDK to get a transaction ID (TID) from the SAP system.</span></span> <span data-ttu-id="85b44-140">如果请求消息中包含一个 GUID，该适配器将此 GUID 映射到 SAP TID;否则为该适配器创建新的 GUID，并将其映射到 SAP TID</span><span class="sxs-lookup"><span data-stu-id="85b44-140">If the request message contains a GUID, the adapter maps this GUID to the SAP TID; otherwise, the adapter creates a new GUID and maps it to the SAP TID</span></span>  
  
3.  <span data-ttu-id="85b44-141">适配器使用 TID 进行 tRFC 调用到 SAP 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-141">The adapter uses the TID to make the tRFC call to the SAP server.</span></span> <span data-ttu-id="85b44-142">TID 的状态标记为**已完成**SAP 系统上。</span><span class="sxs-lookup"><span data-stu-id="85b44-142">The status of the TID is marked as **FINISHED** on the SAP system.</span></span>  
  
4.  <span data-ttu-id="85b44-143">适配器到适配器客户端的响应消息中返回的 GUID （即映射到 TID）。</span><span class="sxs-lookup"><span data-stu-id="85b44-143">The adapter returns the GUID (that is mapped to the TID) to the adapter client in the response message.</span></span>  
  
5.  <span data-ttu-id="85b44-144">适配器客户端时，将调用该适配器上的 RfcConfirmTransID 操作替换为上一步骤返回的 GUID。</span><span class="sxs-lookup"><span data-stu-id="85b44-144">The adapter client invokes the RfcConfirmTransID operation on the adapter with the GUID returned in the previous step.</span></span>  
  
6.  <span data-ttu-id="85b44-145">适配器使用 RfcConfirmTransID 请求消息中的 GUID 来标识 SAP TID，并确认 SAP 系统的 tRFC 调用。</span><span class="sxs-lookup"><span data-stu-id="85b44-145">The adapter uses the GUID in the RfcConfirmTransID request message to identify the SAP TID and confirms the tRFC call on the SAP system.</span></span> <span data-ttu-id="85b44-146">这将导致要从其数据库中删除 TID 条目的 SAP 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-146">This causes the SAP server to delete the TID entry from its database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="85b44-147">tRFC 客户端调用不返回导出或更改参数。</span><span class="sxs-lookup"><span data-stu-id="85b44-147">tRFC client calls do not return EXPORT or CHANGING parameters.</span></span>  
  
 <span data-ttu-id="85b44-148">有关详细信息：</span><span class="sxs-lookup"><span data-stu-id="85b44-148">For more information about:</span></span>  
  
-   <span data-ttu-id="85b44-149">调用 tRFC 使用 BizTalk Server 中，请参阅[调用 SAP 使用 BizTalk Server 中的 tRFCs](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-149">Invoking a tRFC using BizTalk Server, see [Invoke tRFCs in SAP using BizTalk Server](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-biztalk-server.md).</span></span>  
  
-   <span data-ttu-id="85b44-150">调用 tRFC 使用 WCF 服务模型时，请参阅[调用中使用 WCF 服务模型的 SAP tRFCs](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-the-wcf-service-model.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-150">Invoking a tRFC using the WCF service model, see [Invoke tRFCs in SAP using the WCF Service Model](../../adapters-and-accelerators/adapter-sap/invoke-trfcs-in-sap-using-the-wcf-service-model.md).</span></span>  
  
-   <span data-ttu-id="85b44-151">消息结构和用于调用 tRFC SOAP 操作，请参阅[trfc 操作的消息架构](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-151">Message structures and SOAP action for invoking a tRFC, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="receiving-inbound-transactional-rfc-calls-from-an-sap-system"></a><span data-ttu-id="85b44-152">从 SAP 系统的接收入站事务 RFC 调用</span><span class="sxs-lookup"><span data-stu-id="85b44-152">Receiving Inbound Transactional RFC Calls from an SAP System</span></span>  
 <span data-ttu-id="85b44-153">可以将用作 tRFC 服务器适配器从 SAP 接收 tRFCs。</span><span class="sxs-lookup"><span data-stu-id="85b44-153">You can use the adapter as a tRFC server to receive tRFCs from SAP.</span></span> <span data-ttu-id="85b44-154">为 tRFC 服务器，当适配器收到 tRFC，它将调用你的应用程序上的相应 tRFC 操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-154">As a tRFC server, when the adapter receives a tRFC, it invokes the corresponding tRFC operation on your application.</span></span> <span data-ttu-id="85b44-155">当它充当 tRFC 服务器时，该适配器将支持以下功能：</span><span class="sxs-lookup"><span data-stu-id="85b44-155">The adapter supports the following functionality when it acts as a tRFC server:</span></span>  
  
-   <span data-ttu-id="85b44-156">（由 SAP TID 标识） LUW 可以包含多个 tRFCs （RFC 调用）。</span><span class="sxs-lookup"><span data-stu-id="85b44-156">An LUW (identified by a SAP TID) can contain multiple tRFCs (RFC calls).</span></span>  
  
-   <span data-ttu-id="85b44-157">适配器创建为每个 SAP TID 可提交的事务。</span><span class="sxs-lookup"><span data-stu-id="85b44-157">The adapter creates a committable transaction for each SAP TID.</span></span> <span data-ttu-id="85b44-158">应用程序代码可以在此事务中登记。</span><span class="sxs-lookup"><span data-stu-id="85b44-158">Your application code can enlist in this transaction.</span></span>  
  
-   <span data-ttu-id="85b44-159">支持提交和回滚。</span><span class="sxs-lookup"><span data-stu-id="85b44-159">Commit and roll back are supported.</span></span>  
  
 <span data-ttu-id="85b44-160">本部分的其余部分提供有关将适配器用作 tRFC 服务器的常规信息。</span><span class="sxs-lookup"><span data-stu-id="85b44-160">The rest of this section provides general information about using the adapter as a tRFC server.</span></span> <span data-ttu-id="85b44-161">有关详细信息：</span><span class="sxs-lookup"><span data-stu-id="85b44-161">For more specific information about:</span></span>  
  
-   <span data-ttu-id="85b44-162">接收入站的 tRFC 呼叫，使用 BizTalk Server 中，请参阅[接收入站 tRFC 来自 SAP 使用 BizTalk Server 调用](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-from-sap-using-biztalk-server.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-162">Receiving a inbound tRFC calls using BizTalk Server, see [Receive Inbound tRFC Calls from SAP using BizTalk Server](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-from-sap-using-biztalk-server.md).</span></span>  
  
-   <span data-ttu-id="85b44-163">接收入站的 tRFC 呼叫，使用 WCF 服务模型，请参阅[接收入站 tRFC 调用中使用 WCF 服务模型的 SAP](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-in-sap-using-the-wcf-service-model.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-163">Receiving a inbound tRFC calls using the WCF service model, see [Receive Inbound tRFC Calls in SAP using the WCF Service Model](../../adapters-and-accelerators/adapter-sap/receive-inbound-trfc-calls-in-sap-using-the-wcf-service-model.md).</span></span>  
  
### <a name="the-tid-database"></a><span data-ttu-id="85b44-164">TID 数据库</span><span class="sxs-lookup"><span data-stu-id="85b44-164">The TID Database</span></span>  
 <span data-ttu-id="85b44-165">适配器时它充当 tRFC 服务器时，使用 SQL Server 数据库 — TID 数据库-管理事务收到来自 SAP 系统的 Id。</span><span class="sxs-lookup"><span data-stu-id="85b44-165">When it acts as a tRFC server, the adapter uses a SQL Server database—the TID database—to manage the transaction IDs that it receives from the SAP system.</span></span> <span data-ttu-id="85b44-166">例如，它使用 TID 数据库来帮助管理呼叫从 SAP 系统以提交、 回滚，并确认 TID。</span><span class="sxs-lookup"><span data-stu-id="85b44-166">For example, it uses the TID database to help manage calls from the SAP system to commit, rollback, and confirm the TID.</span></span> <span data-ttu-id="85b44-167">适配器还存储它会创建并将与 TID 数据库中每个 SAP TID 相关联的 GUID。</span><span class="sxs-lookup"><span data-stu-id="85b44-167">The adapter also stores the GUID that it creates and associates with each SAP TID in the TID database.</span></span>  
  
### <a name="prerequisites"></a><span data-ttu-id="85b44-168">先决条件</span><span class="sxs-lookup"><span data-stu-id="85b44-168">Prerequisites</span></span>  
 <span data-ttu-id="85b44-169">对于作为 tRFC 服务器运行的适配器，必须确保在以下情况成立：</span><span class="sxs-lookup"><span data-stu-id="85b44-169">For the adapter to perform as a tRFC server, you must ensure that the following are true:</span></span>  
  
-   <span data-ttu-id="85b44-170">RFC 必须声明 SAP 系统上。</span><span class="sxs-lookup"><span data-stu-id="85b44-170">The RFC must be declared on the SAP system.</span></span> <span data-ttu-id="85b44-171">这是因此该适配器可以检索元数据描述从 SAP 系统的 RFC。</span><span class="sxs-lookup"><span data-stu-id="85b44-171">This is so the adapter can retrieve metadata that describes the RFC from the SAP system.</span></span> <span data-ttu-id="85b44-172">RFC 实际是在你的应用程序中实现的。</span><span class="sxs-lookup"><span data-stu-id="85b44-172">The RFC is actually implemented in your application.</span></span>  
  
-   <span data-ttu-id="85b44-173">适配器必须注册上的 SAP 网关的 RFC 目标。</span><span class="sxs-lookup"><span data-stu-id="85b44-173">The adapter must register with an RFC destination on an SAP gateway.</span></span> <span data-ttu-id="85b44-174">注册基于逻辑名称称为程序 id。</span><span class="sxs-lookup"><span data-stu-id="85b44-174">The registration is based on a logical name called a program ID.</span></span> <span data-ttu-id="85b44-175">提供连接 URI 指定的程序 ID 中的参数 SAP 网关和此注册的 SAP 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-175">You supply parameters in the connection URI to specify the program ID, SAP gateway, and SAP server for this registration.</span></span>  
  
-   <span data-ttu-id="85b44-176">必须在 SQL Server 中创建 TID 数据库。</span><span class="sxs-lookup"><span data-stu-id="85b44-176">The TID database must be created in SQL Server.</span></span> <span data-ttu-id="85b44-177">若要执行此操作，必须运行安装程序安装的 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="85b44-177">To do this, you must run a SQL script that is installed by the setup.</span></span> <span data-ttu-id="85b44-178">SQL 脚本通常安装在\<安装驱动器\>: files\microsoft [!INCLUDE[adapterpacknoversion](../../includes/adapterpacknoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="85b44-178">The SQL script is typically installed at \<installation drive\>:\Program Files\Microsoft [!INCLUDE[adapterpacknoversion](../../includes/adapterpacknoversion-md.md)].</span></span> <span data-ttu-id="85b44-179">有关详细信息，请参阅[安装 BizTalk 适配器包](http://msdn.microsoft.com/library/2ae27db5-b11b-42c3-a568-e2331badf80e)。</span><span class="sxs-lookup"><span data-stu-id="85b44-179">For more information see, [Installing the BizTalk Adapter Pack](http://msdn.microsoft.com/library/2ae27db5-b11b-42c3-a568-e2331badf80e).</span></span>  
  
-   <span data-ttu-id="85b44-180">**TidDatabaseConnectionString**绑定属性必须设置为 TID 数据库的 SQL 数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b44-180">The **TidDatabaseConnectionString** binding property must be set to the SQL database connection string for the TID database.</span></span> <span data-ttu-id="85b44-181">有关详细信息**TidDatabaseConnectionString**绑定属性，请参阅[了解针对 mySAP Business Suite 绑定属性的 BizTalk 适配器](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-181">For more information about the **TidDatabaseConnectionString** binding property, see [Read about BizTalk Adapter for mySAP Business Suite binding properties](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="85b44-182">设置**TidDatabaseConnectionString**绑定属性配置的适配器以充当 tRFC 服务器，而不是 RFC 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-182">Setting the **TidDatabaseConnectionString** binding property configures the adapter to act as a tRFC server rather than as an RFC server.</span></span> <span data-ttu-id="85b44-183">如果**TidDatabaseConnectionString**绑定属性设置和连接 URI 中指定的 RFC 目标，该适配器可作为 tRFC 服务器对于 RFC 目标中的传入调用。</span><span class="sxs-lookup"><span data-stu-id="85b44-183">If the **TidDatabaseConnectionString** binding property is set and you specify an RFC destination in the connection URI, the adapter acts as a tRFC server for incoming calls from the RFC destination.</span></span> <span data-ttu-id="85b44-184">如果未设置此绑定属性，该适配器将充当 RFC 服务器。</span><span class="sxs-lookup"><span data-stu-id="85b44-184">If this binding property is not set, the adapter acts as an RFC server.</span></span>  
  
### <a name="how-the-adapter-processes-inbound-trfcs"></a><span data-ttu-id="85b44-185">如何适配器进程入站 tRFCs</span><span class="sxs-lookup"><span data-stu-id="85b44-185">How the Adapter Processes Inbound tRFCs</span></span>  
 <span data-ttu-id="85b44-186">以下步骤总结了 RFC 客户端调用使用执行的任务[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="85b44-186">The following steps summarize the tasks that are performed by the RFC client call using the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)].</span></span> <span data-ttu-id="85b44-187">由适配器客户端上，执行这些步骤中的一部分，并且一些执行适配器。</span><span class="sxs-lookup"><span data-stu-id="85b44-187">Some of these steps are performed by the adapter client, and some are performed by the adapter.</span></span>  
  
1.  <span data-ttu-id="85b44-188">已用于插入适配器的 SAP 系统调用，以查询是否 TID。</span><span class="sxs-lookup"><span data-stu-id="85b44-188">The SAP system calls into the adapter to enquire whether a TID has already been used.</span></span> <span data-ttu-id="85b44-189">适配器返回对 SAP 系统的相应响应。</span><span class="sxs-lookup"><span data-stu-id="85b44-189">The adapter returns the appropriate response to the SAP system.</span></span> <span data-ttu-id="85b44-190">如果新 TID，该适配器将创建可提交的事务。</span><span class="sxs-lookup"><span data-stu-id="85b44-190">If the TID is new, the adapter creates a committable transaction.</span></span> <span data-ttu-id="85b44-191">此事务用于以事务性方式保留到 TID 数据库 TID，当 SAP 程序执行提交 （提交工作）。</span><span class="sxs-lookup"><span data-stu-id="85b44-191">This transaction is used to persist the TID to the TID database in a transactional manner when the SAP program performs a commit (COMMIT WORK).</span></span> <span data-ttu-id="85b44-192">它还公开对处理入站的 tRFCs 的应用程序代码。</span><span class="sxs-lookup"><span data-stu-id="85b44-192">It is also exposed to application code that handles the inbound tRFCs.</span></span> <span data-ttu-id="85b44-193">此外，适配器会创建一个 GUID，它将与 SAP TID 相关联。</span><span class="sxs-lookup"><span data-stu-id="85b44-193">Additionally, the adapter creates a GUID that it associates with the SAP TID.</span></span>  
  
2.  <span data-ttu-id="85b44-194">SAP 系统会将一个或多个事务 Rfc 发送到适配器中。</span><span class="sxs-lookup"><span data-stu-id="85b44-194">The SAP system sends one or more transactional RFCs to the adapter.</span></span> <span data-ttu-id="85b44-195">为每个 tRFC 适配器时，将调用你的应用程序上的相应 tRFC 操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-195">For each tRFC, the adapter invokes the appropriate tRFC operation on your application.</span></span> <span data-ttu-id="85b44-196">适配器将向每个操作应用程序的步骤 1 中创建的事务流动。</span><span class="sxs-lookup"><span data-stu-id="85b44-196">The adapter flows the transaction created in step 1 to your application for each operation.</span></span> <span data-ttu-id="85b44-197">适配器传递操作的请求消息中的步骤 1 中创建的 GUID。</span><span class="sxs-lookup"><span data-stu-id="85b44-197">The adapter passes the GUID created in step 1 in the request message for the operation.</span></span>  
  
3.  <span data-ttu-id="85b44-198">SAP 系统会将提交 LUW （提交工作）。</span><span class="sxs-lookup"><span data-stu-id="85b44-198">SAP system commits the LUW (COMMIT WORK).</span></span> <span data-ttu-id="85b44-199">适配器尝试提交与 SAP TID （步骤 1 中创建） 关联的事务。</span><span class="sxs-lookup"><span data-stu-id="85b44-199">The adapter tries to commit the transaction associated with the SAP TID (created in step 1).</span></span>  
  
    1.  <span data-ttu-id="85b44-200">如果任何步骤 2 中的调用，该事务已中止 （由你的应用程序），当适配器尝试提交事务时就会出错。</span><span class="sxs-lookup"><span data-stu-id="85b44-200">If the transaction was aborted (by your application) during any of the calls in step 2, then an error occurs when the adapter tries to commit the transaction.</span></span> <span data-ttu-id="85b44-201">向 SAP 返回的错误。</span><span class="sxs-lookup"><span data-stu-id="85b44-201">The error is returned to SAP.</span></span> <span data-ttu-id="85b44-202">转到步骤 4。</span><span class="sxs-lookup"><span data-stu-id="85b44-202">Go to step 4.</span></span>  
  
    2.  <span data-ttu-id="85b44-203">如果提交成功，则 TID 现在是 TID 数据库中。</span><span class="sxs-lookup"><span data-stu-id="85b44-203">If the commit is successful, the TID is now in the TID database.</span></span> <span data-ttu-id="85b44-204">转到步骤 5。</span><span class="sxs-lookup"><span data-stu-id="85b44-204">Go to step 5.</span></span>  
  
4.  <span data-ttu-id="85b44-205">如果错误发生在步骤 3，或如果 SAP 回滚 LUW (RESTART_OF_BACKGROUNDTASK) 而不是提交它，该适配器回滚事务。</span><span class="sxs-lookup"><span data-stu-id="85b44-205">If an error occurred in step 3, or if SAP rolls back the LUW (RESTART_OF_BACKGROUNDTASK) instead of committing it, the adapter rolls back the transaction.</span></span> <span data-ttu-id="85b44-206">在这种情况下 TID 将永远不会保留到 TID 数据库。</span><span class="sxs-lookup"><span data-stu-id="85b44-206">In this case the TID is never persisted to the TID database.</span></span>  
  
5.  <span data-ttu-id="85b44-207">SAP 系统确认 TID。</span><span class="sxs-lookup"><span data-stu-id="85b44-207">The SAP system confirms the TID.</span></span> <span data-ttu-id="85b44-208">适配器 TID 从数据库中删除 TID （假设步骤 3 已成功完成并 TID TID 数据库中存在。</span><span class="sxs-lookup"><span data-stu-id="85b44-208">The adapter removes the TID from the TID database (assuming that step 3 completed successfully and the TID exists in the TID database.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="85b44-209">如果尝试连接到 TID 数据库在 tRFC 服务器操作期间发生错误，错误代码指示来自 SAP 的传入调用未处理[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]返回到 SAP。</span><span class="sxs-lookup"><span data-stu-id="85b44-209">If an error occurs attempting to connect to the TID Database during a tRFC server operation, an error code indicating that the incoming call from SAP was not processed by the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] is returned to SAP.</span></span>  
  
### <a name="receiving-idocs-as-a-trfc-server"></a><span data-ttu-id="85b44-210">为 tRFC 服务器接收到的 Idoc</span><span class="sxs-lookup"><span data-stu-id="85b44-210">Receiving IDOCs as a tRFC server</span></span>  
 <span data-ttu-id="85b44-211">你使用[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]RFC 服务器或 tRFC 服务器以接收到的 Idoc 从 SAP 系统。</span><span class="sxs-lookup"><span data-stu-id="85b44-211">You use the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] as either an RFC server or a tRFC server to receive IDOCs from the SAP system.</span></span> <span data-ttu-id="85b44-212">在任一情况下，你必须设置**ReceiveIdocFormat**绑定属性，以指定在其中适配器应发出到你的应用程序的 IDOC 数据的格式。</span><span class="sxs-lookup"><span data-stu-id="85b44-212">In either case, you must set the **ReceiveIdocFormat** binding property to specify the format in which the adapter should emit the IDOC data to your application.</span></span> <span data-ttu-id="85b44-213">有关与适配器接收到的 Idoc 的详细信息，请参阅[SAP 中的 Idoc 上的操作](../../adapters-and-accelerators/adapter-sap/operations-on-idocs-in-sap.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-213">For more information about receiving IDOCs with the adapter, see [Operations on IDOCs in SAP](../../adapters-and-accelerators/adapter-sap/operations-on-idocs-in-sap.md).</span></span> <span data-ttu-id="85b44-214">有关详细信息[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]绑定属性，请参阅[了解针对 mySAP Business Suite 绑定属性的 BizTalk 适配器](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-214">For more information about the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] binding properties, see [Read about BizTalk Adapter for mySAP Business Suite binding properties](../../adapters-and-accelerators/adapter-sap/read-about-biztalk-adapter-for-mysap-business-suite-binding-properties.md).</span></span>  
  
## <a name="special-trfc-operations"></a><span data-ttu-id="85b44-215">特殊 tRFC 操作</span><span class="sxs-lookup"><span data-stu-id="85b44-215">Special tRFC Operations</span></span>  
 <span data-ttu-id="85b44-216">[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]还可以执行某些 SAP 系统上的特殊 tRFC 操作。</span><span class="sxs-lookup"><span data-stu-id="85b44-216">The [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] can also perform certain special tRFC operations on the SAP system.</span></span> <span data-ttu-id="85b44-217">此类的一个操作是 RfcConfirmTransID。</span><span class="sxs-lookup"><span data-stu-id="85b44-217">One such operation is RfcConfirmTransID.</span></span>  
  
-   <span data-ttu-id="85b44-218">**RfcConfirmTransID。**</span><span class="sxs-lookup"><span data-stu-id="85b44-218">**RfcConfirmTransID.**</span></span> <span data-ttu-id="85b44-219">在调用此操作[!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)]以确认 tRFC 到 SAP 服务器所做的调用。</span><span class="sxs-lookup"><span data-stu-id="85b44-219">You invoke this operation on the [!INCLUDE[adaptersap_short](../../includes/adaptersap-short-md.md)] to confirm tRFC calls made to the SAP server.</span></span> <span data-ttu-id="85b44-220">RfcConfirmTransID 可能需要在其中使用该适配器将 Idoc 发送到与 tRFC 的 SAP 服务器的情况下。</span><span class="sxs-lookup"><span data-stu-id="85b44-220">RfcConfirmTransID might be required in scenarios where the adapter is used to send IDOCs to the SAP server as a tRFC.</span></span> <span data-ttu-id="85b44-221">操作都可用下**TRFC**节点时使用[!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)]和[!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="85b44-221">The operation is available under the **TRFC** node when using the [!INCLUDE[addadapterservrefshort](../../includes/addadapterservrefshort-md.md)] and [!INCLUDE[consumeadapterservshort](../../includes/consumeadapterservshort-md.md)].</span></span>  
  
 <span data-ttu-id="85b44-222">有关消息结构和 RfcConfirmTransID 操作的 SOAP 操作的详细信息，请参阅[trfc 操作的消息架构](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="85b44-222">For more information about the message structure and SOAP action for the RfcConfirmTransID operation, see [Message Schemas for tRFC Operations](../../adapters-and-accelerators/adapter-sap/message-schemas-for-trfc-operations.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="85b44-223">另请参阅</span><span class="sxs-lookup"><span data-stu-id="85b44-223">See Also</span></span>  
 [<span data-ttu-id="85b44-224">连接到 SAP 系统使用适配器</span><span class="sxs-lookup"><span data-stu-id="85b44-224">Connect to an SAP system using the adapter</span></span>](../../adapters-and-accelerators/adapter-sap/connect-to-an-sap-system-using-the-adapter.md)