---
title: 后配置数据库 Optimizations2 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 609eda22-8399-4b7c-b860-21b495d2f68d
caps.latest.revision: 17
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 168323f1e7dfdbb796fe29e0025c5d2a6f40c957
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
ms.locfileid: "22302661"
---
# <a name="post-configuration-database-optimizations"></a><span data-ttu-id="a5438-102">后配置数据库优化</span><span class="sxs-lookup"><span data-stu-id="a5438-102">Post-Configuration Database Optimizations</span></span>
<span data-ttu-id="a5438-103">除了按照中的建议之外[预配置数据库 Optimizations2](../technical-guides/pre-configuration-database-optimizations2.md)，应遵循的几个步骤来优化 SQL Server 上的 BizTalk Server 数据库性能*后*BizTalk Server 已安装且已被配置 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="a5438-103">In addition to following the recommendations in [Pre-Configuration Database Optimizations2](../technical-guides/pre-configuration-database-optimizations2.md), several steps should be followed to optimize BizTalk Server database performance on SQL Server *after* BizTalk Server has been installed and the BizTalk Server databases have been configured.</span></span> <span data-ttu-id="a5438-104">本主题提供这些优化的列表。</span><span class="sxs-lookup"><span data-stu-id="a5438-104">This topic provides a list of these optimizations.</span></span>  
  
## <a name="consider-setting-the-text-in-row-table-option-on-specific-messagebox-database-tables"></a><span data-ttu-id="a5438-105">请考虑设置特定的 MessageBox 数据库表上的 text in row 表选项</span><span class="sxs-lookup"><span data-stu-id="a5438-105">Consider setting the 'text in row' table option on specific MessageBox database tables</span></span>  
 <span data-ttu-id="a5438-106">SQL Server 提供了一个名为的表选项**一行中的文本**来声明的类型的字段的内容**文本**， **ntext**，或**映像**其维度的比 (8 Kb) 中的数据页的较小的数据必须存储在数据行。</span><span class="sxs-lookup"><span data-stu-id="a5438-106">SQL Server provides a table option called **text in row** to declare that the contents of the fields of type **text**, **ntext**, or **image** data whose dimensions are smaller than those of a data page (8Kb) must be stored in a data row.</span></span> <span data-ttu-id="a5438-107">通过设置此选项在 BizTalkMsgBoxDb 表 （部分表、 假脱机表和 DynamicStateInfo 表），你可以使用具有小上下文和具有小持久性大小的业务流程的小消息时提高消息吞吐量。</span><span class="sxs-lookup"><span data-stu-id="a5438-107">By setting this option on BizTalkMsgBoxDb tables (Parts table, Spool table and DynamicStateInfo Tables) , you can increase message throughput when working with small messages which have a small context and orchestrations that have a small persistence size.</span></span>  
  
-   <span data-ttu-id="a5438-108">**部件表**： 当消息大小小于 8 kb 的数据页的尺寸时，应用**一行中的文本**在部件表上的表选项可能会导致 BizTalk Server 性能改善。</span><span class="sxs-lookup"><span data-stu-id="a5438-108">**Parts Table**: When the message size is smaller than the dimensions of a data page that are of 8kb, applying the **text in row** table option on the Parts table can lead to BizTalk Server performance improvement.</span></span> <span data-ttu-id="a5438-109">部件表包含以下字段：</span><span class="sxs-lookup"><span data-stu-id="a5438-109">The Parts table contains the following fields:</span></span>  
  
    -   <span data-ttu-id="a5438-110">**ImgPart**： 包含消息部分或消息部分片段。</span><span class="sxs-lookup"><span data-stu-id="a5438-110">**ImgPart**: Contains a message part or message part fragment.</span></span>  
  
    -   <span data-ttu-id="a5438-111">**ImgPropBag**： 包含消息一部分属性包。</span><span class="sxs-lookup"><span data-stu-id="a5438-111">**ImgPropBag**: Contains the message part property bag.</span></span>  
  
     <span data-ttu-id="a5438-112">这样一来，针对 MessageBox，循环内 BizTalk 主机运行的消息代理可以检索一批消息从部件表通过读取少量的页面。</span><span class="sxs-lookup"><span data-stu-id="a5438-112">This way, when looping against the MessageBox, the Message Agent running within a BizTalk host can retrieve a batch of messages from the Parts table by reading small amount of pages.</span></span> <span data-ttu-id="a5438-113">具体取决于特定方案和硬件配置中，此方法可以降低 CPU 使用率在 SQL Server 和 BizTalk Server 中，并提供在延迟和吞吐量方面的重大进步。</span><span class="sxs-lookup"><span data-stu-id="a5438-113">Depending on the specific scenario and hardware configuration, this technique can reduce CPU utilization both on the SQL Server and BizTalk Server, and provide a significant improvement in terms of latency and throughput.</span></span>  
  
-   <span data-ttu-id="a5438-114">**假脱机表**： 当消息上下文的平均大小小于 8 kb，启用**一行中的文本**假脱机表上的表选项可帮助你从沿 MessageBox 中读取消息时减少访问次数与其上下文。</span><span class="sxs-lookup"><span data-stu-id="a5438-114">**Spool Table**: When the average size of the message context is less than 8 kb, enabling the **text in row** table option on the Spool table helps you reduce the number of accesses when reading messages from the MessageBox along with their context.</span></span> <span data-ttu-id="a5438-115">若要将此选项应用于假脱机表中，必须消除不必要的上下文属性和可分辨的字段，以减少的大小小于 8 Kb 的消息上下文。</span><span class="sxs-lookup"><span data-stu-id="a5438-115">To apply this option to the Spool table, you must eliminate unnecessary context properties and distinguished fields to reduce the size of the message context lower than 8 Kb.</span></span>  
  
-   <span data-ttu-id="a5438-116">**DynamicStateInfo 表**这些表，一个用于每个主机，包含类型为 image 调用 imgData 包含二进制序列化的业务流程状态，在执行过程中遇到持久点时的字段。</span><span class="sxs-lookup"><span data-stu-id="a5438-116">**DynamicStateInfo Tables** These tables, one for each host, contain a field of type image called imgData that contains binary-serialized orchestration state when they encounter a persistence point during their execution.</span></span> <span data-ttu-id="a5438-117">当在主机出现内的业务流程的内部状态不太小的一次序列化其大小为不超过 8 kb，**一行中的文本**技术可以成功应用于 DynamicStateInfo_HostA 表。</span><span class="sxs-lookup"><span data-stu-id="a5438-117">When the internal state of orchestrations within a host HostA is so small that its size once serialized is less than 8 kb, the **text in row** technique can successfully be applied to the DynamicStateInfo_HostA table.</span></span> <span data-ttu-id="a5438-118">因此，我们建议你保留的内部状态的业务流程越小越好。</span><span class="sxs-lookup"><span data-stu-id="a5438-118">Therefore we recommend that you keep the internal state of orchestrations as small as possible.</span></span> <span data-ttu-id="a5438-119">该技术可以显著减少 XLANG 引擎进行序列化、 保留、 反序列化和还原发生持久性点时的业务流程的内部状态所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="a5438-119">This technique can significantly reduce the time that is spent by the XLANG Engine to serialize, persist, de-serialize and restore the internal state of an orchestration in case of persistence point.</span></span>  
  
 <span data-ttu-id="a5438-120">我们在我们的检验测试中使用以下设置：</span><span class="sxs-lookup"><span data-stu-id="a5438-120">We used the following settings in our lab tests:</span></span>  
  
-   <span data-ttu-id="a5438-121">EXEC sp_tableoption N'Spool，text in row'，"6000"</span><span class="sxs-lookup"><span data-stu-id="a5438-121">EXEC sp_tableoption N'Spool', 'text in row', '6000'</span></span>  
  
-   <span data-ttu-id="a5438-122">EXEC sp_tableoption N'Parts'，'text in row，"6000"</span><span class="sxs-lookup"><span data-stu-id="a5438-122">EXEC sp_tableoption N'Parts', 'text in row', '6000'</span></span>  
  
## <a name="define-auto-growth-settings-for-biztalk-server-databases-to-a-fixed-value-instead-of-a-percentage-value"></a><span data-ttu-id="a5438-123">定义 BizTalk Server 数据库的自动增长设置为固定值而不是百分比值</span><span class="sxs-lookup"><span data-stu-id="a5438-123">Define auto-growth settings for BizTalk Server databases to a fixed value instead of a percentage value</span></span>  
  
-   <span data-ttu-id="a5438-124">SQL Server 数据库自动增长是一个阻止操作，这会影响 BizTalk Server 数据库性能。</span><span class="sxs-lookup"><span data-stu-id="a5438-124">SQL Server database auto-growth is a blocking operation, which hinders BizTalk Server database performance.</span></span> <span data-ttu-id="a5438-125">因此务必分配足够的空间提前要最大程度减少数据库自动增长的匹配项的 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="a5438-125">Therefore it is important to allocate sufficient space for the BizTalk Server databases in advance to minimize the occurrence of database auto-growth.</span></span>  
  
-   <span data-ttu-id="a5438-126">数据库自动增长应设置为固定数量的兆字节而不是百分比 (指定文件增长等手段**中兆字节为单位**)。</span><span class="sxs-lookup"><span data-stu-id="a5438-126">Database auto-growth should be set to a fixed number of megabytes instead of to a percentage (specify file growth **In Megabytes**).</span></span> <span data-ttu-id="a5438-127">这应这样做是为了，如果自动增长发生，它会以测得的方式。</span><span class="sxs-lookup"><span data-stu-id="a5438-127">This should be done so that, if auto-growth occurs, it does so in a measured fashion.</span></span> <span data-ttu-id="a5438-128">这将减少过多的数据库增长的可能性。</span><span class="sxs-lookup"><span data-stu-id="a5438-128">This reduces the likelihood of excessive database growth.</span></span> <span data-ttu-id="a5438-129">BizTalk Server 数据库的增长增量通常应为不低于 100 MB。</span><span class="sxs-lookup"><span data-stu-id="a5438-129">The growth increment for BizTalk Server databases should generally be no lower than 100 MB.</span></span>  
  
## <a name="pre-size-biztalk-server-databases-to-appropriate-size-with-multiple-data-files"></a><span data-ttu-id="a5438-130">预先大小 BizTalk Server 数据库迁移到具有多个数据文件的适当大小</span><span class="sxs-lookup"><span data-stu-id="a5438-130">Pre-size BizTalk Server databases to appropriate size with multiple data files</span></span>  
 <span data-ttu-id="a5438-131">当 SQL Server 会增加文件的大小时，它必须首先初始化的新空间，然后才能使用。</span><span class="sxs-lookup"><span data-stu-id="a5438-131">When SQL Server increases the size of a file, it must first initialize the new space before it can be used.</span></span> <span data-ttu-id="a5438-132">这是涉及使用空页填充新的空间的阻止操作。</span><span class="sxs-lookup"><span data-stu-id="a5438-132">This is a blocking operation that involves filling the new space with empty pages.</span></span> <span data-ttu-id="a5438-133">SQL Server 2005 或更高版本运行 Windows Server 2003 或更高版本支持"即时文件初始化。"</span><span class="sxs-lookup"><span data-stu-id="a5438-133">SQL Server 2005 or later running on Windows Server 2003 or later supports “instant file initialization.”</span></span> <span data-ttu-id="a5438-134">这可以极大地降低文件增长操作的性能影响。</span><span class="sxs-lookup"><span data-stu-id="a5438-134">This can greatly reduce the performance impact of a file growth operation.</span></span> <span data-ttu-id="a5438-135">有关详细信息，请参阅[数据库文件初始化](http://go.microsoft.com/fwlink/?LinkId=132063)(http://go.microsoft.com/fwlink/?LinkId=132063) SQL Server 联机丛书中。</span><span class="sxs-lookup"><span data-stu-id="a5438-135">For more information, see [Database File Initialization](http://go.microsoft.com/fwlink/?LinkId=132063) (http://go.microsoft.com/fwlink/?LinkId=132063) in the SQL Server books online.</span></span> <span data-ttu-id="a5438-136">本主题提供用于启用即时文件初始化步骤。</span><span class="sxs-lookup"><span data-stu-id="a5438-136">This topic provides steps for enabling instant file initialization.</span></span>  
  
 <span data-ttu-id="a5438-137">以下列表描述了在我们的检验测试中使用的 BizTalk Server 数据库配置：</span><span class="sxs-lookup"><span data-stu-id="a5438-137">The following list describes the BizTalk Server database configurations used in our lab tests:</span></span>  
  
-   <span data-ttu-id="a5438-138">**BizTalk DTADB （BizTalk 跟踪数据库文件）：** 具有的文件大小为 100 MB 增长的 2048 MB 和 1024 MB 的日志文件，100 MB 增长数据文件。</span><span class="sxs-lookup"><span data-stu-id="a5438-138">**BizTalk DTADB (BizTalk Tracking database files):** Data file having a file size of 2048 MB with 100 MB growth and a log file of 1024 MB with 100 MB growth.</span></span>  
  
-   <span data-ttu-id="a5438-139">**BizTalkMgmtdb （BizTalk 管理数据库文件）：** 具有 100 MB 增长 512 MB 的文件大小和 100 MB 增长 512 MB 的日志文件的数据文件。</span><span class="sxs-lookup"><span data-stu-id="a5438-139">**BizTalkMgmtdb (BizTalk Management database files):** Data file having a file size of 512 MB with 100 MB growth and a log file of 512 MB with 100 MB growth.</span></span>  
  
-   <span data-ttu-id="a5438-140">**SSODB:** 具有 100 MB 增长 512 MB 的文件大小和 100 MB 增长 512 MB 的日志文件的数据文件。</span><span class="sxs-lookup"><span data-stu-id="a5438-140">**SSODB:** Data file having a file size of 512 MB with 100 MB growth and a log file of 512 MB with 100 MB growth.</span></span>  
  
-   <span data-ttu-id="a5438-141">**BizTalkMsgBoxDb （BizTalk MessageBox 数据库）：** 8 个数据文件，每个都有 100 MB 增长的 2 GB 的文件大小和 100 MB 增长 20 GB 的日志文件。</span><span class="sxs-lookup"><span data-stu-id="a5438-141">**BizTalkMsgBoxDb (BizTalk MessageBox databases):** 8 data files, each having a file size of 2 GB with 100 MB growth and a log file of 20 GB with 100 MB growth.</span></span> <span data-ttu-id="a5438-142">由于 BizTalk MessageBox 数据库都是最活跃的我们建议你将放置数据文件和事务日志文件上专用的驱动器，以减少磁盘 I/O 争用问题的可能性。</span><span class="sxs-lookup"><span data-stu-id="a5438-142">Because the BizTalk MessageBox databases are the most active, we recommend you place the data files and transaction log files on dedicated drives to reduce the likelihood of problems with disk I/O contention.</span></span> <span data-ttu-id="a5438-143">在我们实验室环境中，我们使用一个驱动器的以下各项：</span><span class="sxs-lookup"><span data-stu-id="a5438-143">In our lab environment, we used one drive for each of the following:</span></span>  
  
    -   <span data-ttu-id="a5438-144">MessageBox 数据文件</span><span class="sxs-lookup"><span data-stu-id="a5438-144">MessageBox data files</span></span>  
  
    -   <span data-ttu-id="a5438-145">MessageBox 事务日志文件</span><span class="sxs-lookup"><span data-stu-id="a5438-145">MessageBox transaction log files</span></span>  
  
 <span data-ttu-id="a5438-146">以下 SQL 脚本可以用于预大小 BizTalkMsgBoxDb 它最初具有驱动器 J (J:\BizTalkMsgBoxDb.mdf) 上数据文件和 K (K:\BizTalkMsgBoxDb_log 盘上日志文件。LDF):</span><span class="sxs-lookup"><span data-stu-id="a5438-146">The following SQL script can be used to pre-size BizTalkMsgBoxDb which initially has a data file on drive J (J:\BizTalkMsgBoxDb.mdf) and a log file on drive K (K:\BizTalkMsgBoxDb_log.LDF):</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a5438-147">此脚本是提供的"按原样，"旨在演示或教学目的，，要使用您自己承担。</span><span class="sxs-lookup"><span data-stu-id="a5438-147">This script is provided “as is,” is intended for demo or educational purposes only, and is to be used at your own risk.</span></span> <span data-ttu-id="a5438-148">使用此脚本不支持由 Microsoft 和 Microsoft 则没有此脚本的适用性的保证。</span><span class="sxs-lookup"><span data-stu-id="a5438-148">Use of this script is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this script.</span></span>  
  
```  
EXEC dbo.sp_helpdb BizTalkMsgBoxDb  
ALTER DATABASE BizTalkMsgBoxDb MODIFY FILE (NAME = BizTalkMsgBoxDb , FILENAME = 'J:\BizTalkMsgBoxDb.mdf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_2 , FILENAME = 'J:\BizTalkMsgBoxDb_2.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_3 , FILENAME = 'J:\BizTalkMsgBoxDb_3.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_4 , FILENAME = 'J:\BizTalkMsgBoxDb_4.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_5 , FILENAME = 'J:\BizTalkMsgBoxDb_5.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_6 , FILENAME = 'J:\BizTalkMsgBoxDb_6.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_7 , FILENAME = 'J:\BizTalkMsgBoxDb_7.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
ALTER DATABASE BizTalkMsgBoxDb ADD FILE    (NAME = BizTalkMsgBoxDb_8 , FILENAME = 'J:\BizTalkMsgBoxDb_8.ndf' , SIZE = 2GB , FILEGROWTH = 100MB)  
GO  
ALTER DATABASE BizTalkMsgBoxDb MODIFY FILE (NAME = BizTalkMsgBoxDb_log , FILENAME = 'K:\BizTalkMsgBoxDb_log.LDF', SIZE =  20GB , FILEGROWTH = 100MB)  
GO  
```  
  
## <a name="move-the-backup-biztalk-server-output-directory-to-a-dedicated-lun"></a><span data-ttu-id="a5438-149">将备份 BizTalk Server 输出目录移动到的专用 LUN</span><span class="sxs-lookup"><span data-stu-id="a5438-149">Move the Backup BizTalk Server output directory to a dedicated LUN</span></span>  
 <span data-ttu-id="a5438-150">将备份 BizTalk （完全安装选项和日志备份） 输出目录移动到的专用 LUN，然后编辑要指向的专用 LUN 的备份的 BizTalk Server 作业。</span><span class="sxs-lookup"><span data-stu-id="a5438-150">Move the Backup BizTalk (Full and Log backup) output directory to a dedicated LUN, and then edit the Backup BizTalk Server job to point to the dedicated LUN.</span></span> <span data-ttu-id="a5438-151">从中移动到的专用 LUN 的备份 BizTalk Server 输出目录将减少磁盘 I/O 争用，通过编写到另一个磁盘与作业运行作业时进行读取。</span><span class="sxs-lookup"><span data-stu-id="a5438-151">Moving the Backup BizTalk Server output directory to a dedicated LUN will reduce disk I/O contention when the job is running by writing to a different disk than the job is reading from.</span></span> <span data-ttu-id="a5438-152">有关配置 BizTalk Server 中备份作业的详细信息请参阅[如何配置备份 BizTalk Server 作业](http://go.microsoft.com/fwlink/?LinkID=153813)(http://go.microsoft.com/fwlink/?LinkID=153813) BizTalk Server 2010 帮助中。</span><span class="sxs-lookup"><span data-stu-id="a5438-152">For more information about configuring the Backup BizTalk Server job see [How to Configure the Backup BizTalk Server Job](http://go.microsoft.com/fwlink/?LinkID=153813) (http://go.microsoft.com/fwlink/?LinkID=153813) in BizTalk Server 2010 help.</span></span>  
  
## <a name="verify-that-the-biztalk-server-sql-agent-jobs-are-running"></a><span data-ttu-id="a5438-153">请验证正在运行 BizTalk Server SQL 代理作业</span><span class="sxs-lookup"><span data-stu-id="a5438-153">Verify that the BizTalk Server SQL Agent Jobs are running</span></span>  
 <span data-ttu-id="a5438-154">BizTalk Server 包括执行重要的功能使你的服务器操作和正常运行的多个 SQL Server 代理作业。</span><span class="sxs-lookup"><span data-stu-id="a5438-154">BizTalk Server includes several SQL Server Agent jobs that perform important functions to keep your servers operational and healthy.</span></span> <span data-ttu-id="a5438-155">你应监视这些作业的运行状况，并确保它们正在运行且未发生错误。</span><span class="sxs-lookup"><span data-stu-id="a5438-155">You should monitor the health of these jobs and ensure they are running without errors.</span></span> <span data-ttu-id="a5438-156">BizTalk Server 中的性能问题的最常见原因之一是 BizTalk Server SQL 代理作业不运行，这反过来会导致 MessageBox 和跟踪数据库增长未选中状态。</span><span class="sxs-lookup"><span data-stu-id="a5438-156">One of the most common causes of performance problems in BizTalk Server is the BizTalk Server SQL Agent Jobs are not running, which in turn can cause the MessageBox and Tracking databases to grow unchecked.</span></span> <span data-ttu-id="a5438-157">请按照以下步骤来确保 BizTalk 服务器 SQL 代理作业运行正常操作：</span><span class="sxs-lookup"><span data-stu-id="a5438-157">Follow these steps to ensure the BizTalk Server SQL Agent Jobs are running without problems:</span></span>  
  
1.  <span data-ttu-id="a5438-158">**验证 SQL Server 代理服务是否正在运行**。</span><span class="sxs-lookup"><span data-stu-id="a5438-158">**Verify that the SQL Server Agent service is running**.</span></span>  
  
2.  <span data-ttu-id="a5438-159">**验证是否已启用由 BizTalk 服务器安装的 SQL Server 代理作业和成功运行**。</span><span class="sxs-lookup"><span data-stu-id="a5438-159">**Verify that the SQL Server Agent jobs installed by BizTalk Server are enabled and running successfully**.</span></span>  
    <span data-ttu-id="a5438-160">BizTalk Server SQL Server 代理作业至关重要： 如果它们未运行，随着时间的推移将降低系统性能。</span><span class="sxs-lookup"><span data-stu-id="a5438-160">The BizTalk Server SQL Server Agent jobs are crucial: if they are not running, system performance will degrade over time.</span></span>  
  
3.  <span data-ttu-id="a5438-161">**验证 BizTalk Server SQL Server 代理作业是否完成及时**。</span><span class="sxs-lookup"><span data-stu-id="a5438-161">**Verify that the BizTalk Server SQL Server Agent jobs are completing in a timely manner**.</span></span>   
    <span data-ttu-id="a5438-162">设置 Microsoft System Center Operations Manager 的最新版本，以监视作业。</span><span class="sxs-lookup"><span data-stu-id="a5438-162">Set up the most recent version of Microsoft System Center Operations Manager to monitor the jobs.</span></span>  
    <span data-ttu-id="a5438-163">你应注意的特定于某些作业的计划：</span><span class="sxs-lookup"><span data-stu-id="a5438-163">You should be aware of schedules that are particular to certain jobs:</span></span>  
  
    -   <span data-ttu-id="a5438-164">默认情况下，MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 作业是连续运行。</span><span class="sxs-lookup"><span data-stu-id="a5438-164">The MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb job runs continuously by default.</span></span> <span data-ttu-id="a5438-165">监视软件应考虑此计划，并且不生成警告。</span><span class="sxs-lookup"><span data-stu-id="a5438-165">Monitoring software should take this schedule into account and not produce warnings.</span></span>  
  
    -   <span data-ttu-id="a5438-166">MessageBox_Message_Cleanup_BizTalkMsgBoxDb 作业未启用或计划，但它会启动 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 作业每隔 10 秒。</span><span class="sxs-lookup"><span data-stu-id="a5438-166">The MessageBox_Message_Cleanup_BizTalkMsgBoxDb job is not enabled or scheduled, but it is started by the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb job every 10 seconds.</span></span> <span data-ttu-id="a5438-167">因此，此作业不应启用、 计划，或手动启动。</span><span class="sxs-lookup"><span data-stu-id="a5438-167">Therefore, this job should not be enabled, scheduled, or manually started.</span></span>  
  
4.  <span data-ttu-id="a5438-168">**验证是否已正确配置 SQL Server 代理服务的启动类型**。</span><span class="sxs-lookup"><span data-stu-id="a5438-168">**Verify that the Startup type of the SQL Server Agent service is configured correctly**.</span></span>  
    <span data-ttu-id="a5438-169">验证使用配置的 SQL Server 代理服务**启动类型**的**自动**除非的 SQL Server 代理服务配置为在 Windows Server 群集上的群集资源。</span><span class="sxs-lookup"><span data-stu-id="a5438-169">Verify the SQL Server Agent service is configured with a **Startup type** of **Automatic** unless the SQL Server Agent service is configured as a cluster resource on a Windows Server cluster.</span></span> <span data-ttu-id="a5438-170">如果 SQL Server 代理服务配置为群集资源，则应配置**启动类型**作为**手动**因为该服务将由群集服务。</span><span class="sxs-lookup"><span data-stu-id="a5438-170">If the SQL Server Agent service is configured as a cluster resource, then you should configure the **Startup type** as **Manual** because the service will be managed by the Cluster service.</span></span>  
  
## <a name="configure-purging-and-archiving-of-tracking-data"></a><span data-ttu-id="a5438-171">配置清除和存档的跟踪数据</span><span class="sxs-lookup"><span data-stu-id="a5438-171">Configure Purging and Archiving of Tracking Data</span></span>  
 <span data-ttu-id="a5438-172">请按照下列步骤以确保清除和归档的跟踪数据已正确配置：</span><span class="sxs-lookup"><span data-stu-id="a5438-172">Follow these steps to ensure that purging and archiving of tracking data is configured correctly:</span></span>  
  
1.  <span data-ttu-id="a5438-173">确保 SQL 代理作业"DTA 清除和存档"正确配置和启用，并且已成功完成。</span><span class="sxs-lookup"><span data-stu-id="a5438-173">Ensure the SQL Agent job “DTA Purge and Archive” is properly configured, enabled, and successfully completing.</span></span> <span data-ttu-id="a5438-174">有关详细信息，请参阅[如何配置 DTA 清除和存档作业](http://go.microsoft.com/fwlink/?LinkID=153814)(http://go.microsoft.com/fwlink/?LinkID=153814) BizTalk Server 文档中。</span><span class="sxs-lookup"><span data-stu-id="a5438-174">For more information, see [How to Configure the DTA Purge and Archive Job](http://go.microsoft.com/fwlink/?LinkID=153814) (http://go.microsoft.com/fwlink/?LinkID=153814) in the BizTalk Server documentation.</span></span>  
  
2.  <span data-ttu-id="a5438-175">确保作业能够快速生成传入的跟踪数据清除的跟踪数据。</span><span class="sxs-lookup"><span data-stu-id="a5438-175">Ensure the job is able to purge the tracking data as fast as the incoming tracking data is generated.</span></span> <span data-ttu-id="a5438-176">有关详细信息，请参阅[测量最大的可持续跟踪吞吐量](http://go.microsoft.com/fwlink/?LinkID=153815)(http://go.microsoft.com/fwlink/?LinkID=153815) BizTalk Server 文档中。</span><span class="sxs-lookup"><span data-stu-id="a5438-176">For more information, see [Measuring Maximum Sustainable Tracking Throughput](http://go.microsoft.com/fwlink/?LinkID=153815) (http://go.microsoft.com/fwlink/?LinkID=153815) in the BizTalk Server documentation.</span></span>  
  
3.  <span data-ttu-id="a5438-177">查看软清除和硬清除参数，以确保你保存数据的最佳总时间。</span><span class="sxs-lookup"><span data-stu-id="a5438-177">Review the soft purge and hard purge parameters to ensure you are keeping data for the optimal length of time.</span></span> <span data-ttu-id="a5438-178">有关详细信息，请参阅[存档和清除 BizTalk 跟踪数据库](http://go.microsoft.com/fwlink/?LinkID=153816)(http://go.microsoft.com/fwlink/?LinkID=153816) BizTalk Server 文档中。</span><span class="sxs-lookup"><span data-stu-id="a5438-178">For more information, see [Archiving and Purging the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153816) (http://go.microsoft.com/fwlink/?LinkID=153816) in the BizTalk Server documentation.</span></span>  
  
4.  <span data-ttu-id="a5438-179">如果你只需以清除旧数据并不需要对其进行存档第一次，更改 SQL 代理作业调用存储的过程"dtasp_PurgeTrackingDatabase。"</span><span class="sxs-lookup"><span data-stu-id="a5438-179">If you only need to purge the old data and do not need to archive it first, change the SQL Agent job to call the stored procedure “dtasp_PurgeTrackingDatabase.”</span></span> <span data-ttu-id="a5438-180">有关详细信息，请参阅[如何清除数据从 BizTalk 跟踪数据库](http://go.microsoft.com/fwlink/?LinkID=153817)(http://go.microsoft.com/fwlink/?LinkID=153817) BizTalk Server 文档中。</span><span class="sxs-lookup"><span data-stu-id="a5438-180">For more information, see [How to Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153817) (http://go.microsoft.com/fwlink/?LinkID=153817) in the BizTalk Server documentation.</span></span>  
  
## <a name="monitor-and-reduce-dtc-log-file-disk-io-contention"></a><span data-ttu-id="a5438-181">监视和减少 DTC 日志文件磁盘 I/O 争用</span><span class="sxs-lookup"><span data-stu-id="a5438-181">Monitor and reduce DTC log file disk I/O contention</span></span>  
 <span data-ttu-id="a5438-182">分布式事务处理协调器 (DTC) 日志文件可以成为大型事务环境中的磁盘 I/O 瓶颈。</span><span class="sxs-lookup"><span data-stu-id="a5438-182">The Distributed Transaction Coordinator (DTC) log file can become a disk I/O bottleneck in transaction-intensive environments.</span></span> <span data-ttu-id="a5438-183">这在使用支持事务，如 SQL Server、 MSMQ 或 MQSeries，或在多 MessageBox 环境中的适配器时尤其如此。</span><span class="sxs-lookup"><span data-stu-id="a5438-183">This is especially true when using adapters that support transactions, such as SQL Server, MSMQ, or MQSeries, or in a multi-MessageBox environment.</span></span> <span data-ttu-id="a5438-184">事务的适配器使用 DTC 事务，以及多 MessageBox 环境广泛利用 DTC 事务。</span><span class="sxs-lookup"><span data-stu-id="a5438-184">Transactional adapters use DTC transactions, and multi-MessageBox environments make extensive use of DTC transactions.</span></span> <span data-ttu-id="a5438-185">若要确保 DTC 日志文件不会成为磁盘 I/O 瓶颈，则应该监视磁盘 DTC 日志文件驻留在 SQL Server 数据库服务器上的磁盘 I/O 使用情况。</span><span class="sxs-lookup"><span data-stu-id="a5438-185">To ensure the DTC log file does not become a disk I/O bottleneck, you should monitor the disk I/O usage for the disk where the DTC log file resides on the SQL Server database servers.</span></span> <span data-ttu-id="a5438-186">如果磁盘 DTC 日志文件所在的磁盘 I/O 使用情况变得过多，请考虑将 DTC 日志文件移到更快的磁盘。</span><span class="sxs-lookup"><span data-stu-id="a5438-186">If disk I/O usage for the disk where the DTC log file resides becomes excessive, consider moving the DTC log file to a faster disk.</span></span> <span data-ttu-id="a5438-187">在环境中在群集 SQL Server，这是不尽可能考虑因为日志文件已将共享的驱动器，可能会具有多个轴的快速 SAN 驱动器上。</span><span class="sxs-lookup"><span data-stu-id="a5438-187">In an environment where SQL Server is clustered, this is not as much of a concern because the log file will already be on a shared drive, which will likely be a fast SAN drive with multiple spindles.</span></span> <span data-ttu-id="a5438-188">不过仍应监视磁盘 I/O 使用情况。</span><span class="sxs-lookup"><span data-stu-id="a5438-188">You should nevertheless still monitor the disk I/O usage.</span></span> <span data-ttu-id="a5438-189">这是因为它可能成为瓶颈在非群集环境或 DTC 日志文件时与其他占用大量磁盘的文件的共享磁盘上。</span><span class="sxs-lookup"><span data-stu-id="a5438-189">This is because it can become a bottleneck in non-clustered environments or when the DTC log file is on a shared disk with other disk-intensive files.</span></span>  
  
## <a name="separate-the-messagebox-and-tracking-databases"></a><span data-ttu-id="a5438-190">单独的 MessageBox 和跟踪数据库</span><span class="sxs-lookup"><span data-stu-id="a5438-190">Separate the MessageBox and Tracking Databases</span></span>  
 <span data-ttu-id="a5438-191">由于 BizTalk MessageBox 和 BizTalk 跟踪数据库中最活跃的我们建议将数据文件和事务日志文件放置于其中每种上专用的驱动器，以减少磁盘 I/O 争用问题的可能性。</span><span class="sxs-lookup"><span data-stu-id="a5438-191">Because the BizTalk MessageBox and BizTalk Tracking databases are the most active, we recommend you place the data files and transaction log files for each of these on dedicated drives to reduce the likelihood of problems with disk I/O contention.</span></span> <span data-ttu-id="a5438-192">例如，您将需要为 MessageBox 和 BizTalk 跟踪数据库文件的四个驱动器，一个驱动器的以下各项：</span><span class="sxs-lookup"><span data-stu-id="a5438-192">For example, you would need four drives for the MessageBox and BizTalk Tracking database files, one drive for each of the following:</span></span>  
  
-   <span data-ttu-id="a5438-193">MessageBox 数据文件</span><span class="sxs-lookup"><span data-stu-id="a5438-193">MessageBox data files</span></span>  
  
-   <span data-ttu-id="a5438-194">MessageBox 事务日志文件</span><span class="sxs-lookup"><span data-stu-id="a5438-194">MessageBox transaction log files</span></span>  
  
-   <span data-ttu-id="a5438-195">BizTalk 跟踪 (DTA) 数据文件</span><span class="sxs-lookup"><span data-stu-id="a5438-195">BizTalk Tracking (DTA) data files</span></span>  
  
-   <span data-ttu-id="a5438-196">BizTalk 跟踪 (DTA) 事务日志文件</span><span class="sxs-lookup"><span data-stu-id="a5438-196">BizTalk Tracking (DTA) transaction log files</span></span>  
  
 <span data-ttu-id="a5438-197">分隔 BizTalk MessageBox 和 BizTalk 跟踪数据库和分离数据库文件和事务日志文件在不同的物理磁盘上被视为减少磁盘 I/O 争用的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="a5438-197">Separating the BizTalk MessageBox and BizTalk Tracking databases and separating the database files and transaction log files on different physical disks are considered best practices for reducing disk I/O contention.</span></span> <span data-ttu-id="a5438-198">请尝试以尽可能跨多个物理磁盘轴磁盘 I/O。</span><span class="sxs-lookup"><span data-stu-id="a5438-198">Try to spread the disk I/O across as many physical spindles as possible.</span></span> <span data-ttu-id="a5438-199">此外可以减少磁盘 I/O 争用，通过将 BizTalk 跟踪数据库放置在专用的 SQL 服务器;但是，你仍应遵循上面方面分隔数据文件和事务日志文件的做法。</span><span class="sxs-lookup"><span data-stu-id="a5438-199">You can also reduce disk I/O contention by placing the BizTalk Tracking database on a dedicated SQL Server; however, you should still follow the practices above with regards to separating data files and transaction log files.</span></span>  
  
## <a name="optimize-filegroups-for-the-biztalk-server-databases"></a><span data-ttu-id="a5438-200">优化文件组的 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="a5438-200">Optimize filegroups for the BizTalk Server databases</span></span>  
 <span data-ttu-id="a5438-201">按照中的步骤[Databases2 优化文件组](../technical-guides/optimizing-filegroups-for-the-databases2.md)和[BizTalk Server 数据库优化](http://go.microsoft.com/fwlink/?LinkId=101578)白皮书 ([http://go.microsoft.com/fwlink/?LinkId = 101578](http://go.microsoft.com/fwlink/?LinkId=101578)) 来创建其他文件组和 BizTalk Server 数据库文件。</span><span class="sxs-lookup"><span data-stu-id="a5438-201">Follow the steps in [Optimizing Filegroups for the Databases2](../technical-guides/optimizing-filegroups-for-the-databases2.md) and the [BizTalk Server Database Optimization](http://go.microsoft.com/fwlink/?LinkId=101578) white paper ([http://go.microsoft.com/fwlink/?LinkId=101578](http://go.microsoft.com/fwlink/?LinkId=101578)) to create additional filegroups and files for the BizTalk Server databases.</span></span> <span data-ttu-id="a5438-202">这会大大增加从单个磁盘配置的 BizTalk Server 数据库的性能。</span><span class="sxs-lookup"><span data-stu-id="a5438-202">This will greatly increase the performance of the BizTalk Server databases from a single disk configuration.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a5438-203">另请参阅</span><span class="sxs-lookup"><span data-stu-id="a5438-203">See Also</span></span>  
 [<span data-ttu-id="a5438-204">优化数据库性能</span><span class="sxs-lookup"><span data-stu-id="a5438-204">Optimizing Database Performance</span></span>](../technical-guides/optimizing-database-performance.md)