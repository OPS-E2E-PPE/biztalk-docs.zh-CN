---
title: 优化文件组的数据库 |Microsoft 文档
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 8d7fa4c9-e504-4f43-a308-517a4a574c26
caps.latest.revision: 10
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 9333a88817e96b52ffe186f0a6a598b225ef5202
ms.sourcegitcommit: 36350889f318e1f7e0ac9506dc8df794d475bda6
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/20/2018
---
# <a name="optimizing-filegroups-for-the-databases"></a><span data-ttu-id="29706-102">数据库优化文件组</span><span class="sxs-lookup"><span data-stu-id="29706-102">Optimizing Filegroups for the Databases</span></span>
<span data-ttu-id="29706-103">文件输入/输出 (I/O) 争用经常是限制因素或在生产 BizTalk Server 环境中的形成瓶颈。</span><span class="sxs-lookup"><span data-stu-id="29706-103">File input/output (I/O) contention is frequently a limiting factor, or bottleneck, in a production BizTalk Server environment.</span></span> <span data-ttu-id="29706-104">BizTalk Server 是一个非常数据库密集型应用程序和 BizTalk Server 使用的 SQL Server 数据库又是非常文件 I/O 密集型。</span><span class="sxs-lookup"><span data-stu-id="29706-104">BizTalk Server is a very database intensive application and in turn, the SQL Server database used by BizTalk Server is very file I/O intensive.</span></span> <span data-ttu-id="29706-105">本主题介绍如何更好地利用的文件和文件组功能的 SQL Server，以最少的匹配项的文件 I/O 争用并提高 BizTalk Server 解决方案的整体性能。</span><span class="sxs-lookup"><span data-stu-id="29706-105">This topic describes how to make optimal use of the files and filegroups feature of SQL Server to minimize the occurrence of file I/O contention and improve the overall performance of a BizTalk Server solution.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="29706-106">概述</span><span class="sxs-lookup"><span data-stu-id="29706-106">Overview</span></span>  
 <span data-ttu-id="29706-107">每个 BizTalk Server 解决方案将最终会遇到文件 I/O 争用，随着提高吞吐量。</span><span class="sxs-lookup"><span data-stu-id="29706-107">Every BizTalk Server solution will eventually encounter file I/O contention as throughput is increased.</span></span> <span data-ttu-id="29706-108">I/O 子系统或存储引擎是任何关系数据库的一个关键组件。</span><span class="sxs-lookup"><span data-stu-id="29706-108">The I/O subsystem, or storage engine, is a key component of any relational database.</span></span> <span data-ttu-id="29706-109">成功的数据库实现通常要求在项目的初期阶段进行仔细的规划。</span><span class="sxs-lookup"><span data-stu-id="29706-109">A successful database implementation typically requires careful planning at the early stages of a project.</span></span> <span data-ttu-id="29706-110">此规划应考虑下列事项：</span><span class="sxs-lookup"><span data-stu-id="29706-110">This planning should include consideration of the following issues:</span></span>  
  
-   <span data-ttu-id="29706-111">使用哪种类型的磁盘硬件，如 RAID（独立磁盘冗余阵列）设备。</span><span class="sxs-lookup"><span data-stu-id="29706-111">What type of disk hardware to use, such as RAID (redundant array of independent disks) devices.</span></span> 
  
-   <span data-ttu-id="29706-112">如何在使用文件和文件组的磁盘上的数据分配。</span><span class="sxs-lookup"><span data-stu-id="29706-112">How to apportion data on the disks using files and filegroups.</span></span> <span data-ttu-id="29706-113">有关使用 SQL Server 中的文件和文件组的详细信息，请参阅[Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups)。</span><span class="sxs-lookup"><span data-stu-id="29706-113">For more information about using files and filegroups in SQL Server, see [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups).</span></span>
  
-   <span data-ttu-id="29706-114">实现在访问数据时提高性能的最佳索引设计。</span><span class="sxs-lookup"><span data-stu-id="29706-114">Implementing the optimal index design for improving performance when accessing data.</span></span> <span data-ttu-id="29706-115">有关设计索引的详细信息，请参阅[设计索引](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide)。</span><span class="sxs-lookup"><span data-stu-id="29706-115">For more information about designing indexes, see [Designing Indexes](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide).</span></span>
  
-   <span data-ttu-id="29706-116">如何设置 SQL Server 配置参数，以获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="29706-116">How to set SQL Server configuration parameters for optimal performance.</span></span> <span data-ttu-id="29706-117">为 SQL Server 设置最佳的配置参数的详细信息，请参阅[服务器配置选项](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server)。</span><span class="sxs-lookup"><span data-stu-id="29706-117">For more information about setting optimal configuration parameters for SQL Server, see [Server Configuration Options](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server).</span></span>
  
 <span data-ttu-id="29706-118">BizTalk Server 的主要设计目标之一是确保消息的**永远不会**丢失。</span><span class="sxs-lookup"><span data-stu-id="29706-118">One of the primary design goals of BizTalk Server is to ensure that a message is **never** lost.</span></span> <span data-ttu-id="29706-119">为了缓解消息丢失的可能性，消息频繁写入到 MessageBox 数据库中，处理消息。</span><span class="sxs-lookup"><span data-stu-id="29706-119">In order to mitigate the possibility of message loss, messages are frequently written to the MessageBox database as the message is processed.</span></span> <span data-ttu-id="29706-120">时由业务流程处理消息，则会将消息写入到 MessageBox 数据库在业务流程中每个持久性点。</span><span class="sxs-lookup"><span data-stu-id="29706-120">When messages are processed by an orchestration, the message is written to the MessageBox database at every persistence point in the orchestration.</span></span> <span data-ttu-id="29706-121">这些持久性点导致 MessageBox 写入物理磁盘的消息和相关的状态。</span><span class="sxs-lookup"><span data-stu-id="29706-121">These persistence points cause the MessageBox to write the message and related state to physical disk.</span></span> <span data-ttu-id="29706-122">在更高的吞吐量，此持久性可能导致大量的磁盘争用，且可能成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="29706-122">At higher throughputs, this persistence can result in considerable disk contention and can potentially become a bottleneck.</span></span>  
  
 <span data-ttu-id="29706-123">进行最佳使用的文件和 SQL Server 中的文件组功能已被证实将有效地满足文件 IO 瓶颈，并改进在 BizTalk Server 解决方案中的整体性能。</span><span class="sxs-lookup"><span data-stu-id="29706-123">Making optimal use of the files and filegroups feature in SQL Server has been shown to effectively address File IO bottlenecks and improve overall performance in BizTalk Server solutions.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-124">此优化仅应由有经验的 SQL Server 数据库管理员和 BizTalk Server 数据库已正确备份仅后的全部完成。</span><span class="sxs-lookup"><span data-stu-id="29706-124">This optimization should only be done by an experienced SQL Server database administrator and only after all BizTalk Server databases have been properly backed up.</span></span> <span data-ttu-id="29706-125">应该在 BizTalk Server 环境中的所有 SQL Server 计算机上执行此优化。</span><span class="sxs-lookup"><span data-stu-id="29706-125">This optimization should be performed on all SQL Server computers in the BizTalk Server environment.</span></span>  
  
 <span data-ttu-id="29706-126">SQL Server 文件和文件组可用来提高数据库性能，因为此功能允许多个磁盘，跨多个磁盘控制器，要创建数据库或 RAID （独立磁盘冗余阵列） 系统。</span><span class="sxs-lookup"><span data-stu-id="29706-126">SQL Server files and filegroups can be used to improve database performance because this functionality allows a database to be created across multiple disks, multiple disk controllers, or RAID (redundant array of independent disks) systems.</span></span> <span data-ttu-id="29706-127">例如，如果计算机上有四个磁盘，那么可以创建一个由三个数据文件和一个日志文件组成的数据库，每个磁盘上放置一个文件。</span><span class="sxs-lookup"><span data-stu-id="29706-127">For example, if your computer has four disks, you can create a database that is made up of three data files and one log file, with one file on each disk.</span></span> <span data-ttu-id="29706-128">根据访问数据时，四个读/写磁头可以同时访问并行中的数据。</span><span class="sxs-lookup"><span data-stu-id="29706-128">As data is accessed, four read/write heads can concurrently access the data in parallel.</span></span> <span data-ttu-id="29706-129">这极大地加快数据库操作。</span><span class="sxs-lookup"><span data-stu-id="29706-129">This speeds up database operations significantly.</span></span> <span data-ttu-id="29706-130">有关实现 SQL Server 磁盘的硬件解决方案的详细信息，请参阅[数据库性能](http://go.microsoft.com/fwlink/?LinkID=71419)(http://go.microsoft.com/fwlink/?LinkID=71419) SQL Server 联机丛书中。</span><span class="sxs-lookup"><span data-stu-id="29706-130">For more information about implementing hardware solutions for SQL Server disks, see [Database Performance](http://go.microsoft.com/fwlink/?LinkID=71419) (http://go.microsoft.com/fwlink/?LinkID=71419) in the SQL Server Books Online.</span></span>  
  
 <span data-ttu-id="29706-131">此外，文件和文件组中启用数据放置，因为可以在特定的文件组中创建表。</span><span class="sxs-lookup"><span data-stu-id="29706-131">Additionally, files and filegroups enable data placement, because tables can be created in specific filegroups.</span></span> <span data-ttu-id="29706-132">这提高了性能，因为对于给定的表的所有文件 i/o 操作可以都定向到特定的磁盘。</span><span class="sxs-lookup"><span data-stu-id="29706-132">This improves performance, because all file I/O for a given table can be directed at a specific disk.</span></span> <span data-ttu-id="29706-133">例如，常用的表可以放置中的文件组，位于一个磁盘上的文件和其他不太常访问的表，在数据库可以位于另一个文件，位于第二个磁盘上的组中的不同文件。</span><span class="sxs-lookup"><span data-stu-id="29706-133">For example, a heavily used table can be placed on a file in a filegroup, located on one disk, and the other less heavily accessed tables in the database can be located on different files in another filegroup, located on a second disk.</span></span>  
  
 <span data-ttu-id="29706-134">中的大量详细地讨论了文件 I/O 瓶颈[数据库层中的瓶颈](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="29706-134">File I/O bottlenecks are discussed in considerable detail in [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span> <span data-ttu-id="29706-135">文件 I/O （磁盘 I/O） 是瓶颈的最常见指示器是"物理磁盘： 平均磁盘队列长度"计数器的值。</span><span class="sxs-lookup"><span data-stu-id="29706-135">The most common indicator that file I/O (disk I/O) is a bottleneck is the value of the “Physical Disk:Average Disk Queue Length” counter.</span></span> <span data-ttu-id="29706-136">在"物理磁盘： 平均磁盘队列长度"计数器的值大于大约 3 上的任何运行 SQL Server 计算机的任何给定磁盘，然后文件 I/O 可能是瓶颈。</span><span class="sxs-lookup"><span data-stu-id="29706-136">When the value of the “Physical Disk:Average Disk Queue Length” counter is greater than about 3 for any given disk on any of the computers running SQL Server, then file I/O is likely a bottleneck.</span></span>  
  
 <span data-ttu-id="29706-137">如果应用文件组优化不能解决文件 I/O 瓶颈问题，可能需要通过添加其他物理计算机或 SAN 驱动器增加磁盘子系统的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="29706-137">If applying file or filegroup optimization doesn't resolve a file I/O bottleneck problem, it may be necessary to increase the throughput of the disk subsystem by adding additional physical or SAN drives.</span></span>  
  
 <span data-ttu-id="29706-138">本主题介绍如何手动应用文件和文件组优化，但这些优化也可以编写脚本。</span><span class="sxs-lookup"><span data-stu-id="29706-138">This topic describes how to manually apply file and filegroup optimizations, but these optimizations can also be scripted.</span></span> <span data-ttu-id="29706-139">中提供了一个示例 SQL 脚本[BizTalk Server MessageBox 数据库文件组 SQL 脚本](../technical-guides/biztalk-server-messagebox-database-filegroups-sql-script.md)。</span><span class="sxs-lookup"><span data-stu-id="29706-139">A sample SQL script is provided in [BizTalk Server MessageBox Database Filegroups SQL Script](../technical-guides/biztalk-server-messagebox-database-filegroups-sql-script.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-140">请务必注意，此脚本将需要进行修改以便适应文件、 文件组，以及任何给定的 BizTalk Server 解决方案所使用的 SQL Server 数据库的磁盘配置。</span><span class="sxs-lookup"><span data-stu-id="29706-140">It is important to note that this script would need to be modified to accommodate the file, filegroup, and disk configuration used by the SQL Server databases for any given BizTalk Server solution.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-141">本主题还介绍如何创建多个文件和 BizTalk MessageBox 数据库文件组。</span><span class="sxs-lookup"><span data-stu-id="29706-141">This topic also describes how to create multiple files and filegroups for the BizTalk MessageBox database.</span></span> <span data-ttu-id="29706-142">建议的文件和 BizTalk Server 数据库的所有文件组的穷举列表，请参阅"附录 B"的[BizTalk Server 数据库优化](http://go.microsoft.com/fwlink/?LinkID=101578)白皮书 (http://go.microsoft.com/fwlink/?LinkID=101578)。</span><span class="sxs-lookup"><span data-stu-id="29706-142">For an exhaustive list of recommended files and filegroups for all of the BizTalk Server databases, see “Appendix B” of the [BizTalk Server Database Optimization](http://go.microsoft.com/fwlink/?LinkID=101578) white paper (http://go.microsoft.com/fwlink/?LinkID=101578).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-143">即使[BizTalk Server 数据库优化](http://go.microsoft.com/fwlink/?LinkID=101578)白皮书 (http://go.microsoft.com/fwlink/?LinkID=101578)写入数组时带[!INCLUDE[btsbiztalkserver2006r2](../includes/btsbiztalkserver2006r2-md.md)]记住情况下，同一原则适用于 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="29706-143">Even though the [BizTalk Server Database Optimization](http://go.microsoft.com/fwlink/?LinkID=101578) white paper (http://go.microsoft.com/fwlink/?LinkID=101578) was written with [!INCLUDE[btsbiztalkserver2006r2](../includes/btsbiztalkserver2006r2-md.md)] in mind, the same principles apply to BizTalk Server.</span></span>  
  
## <a name="databases-created-with-a-default-biztalk-server-configuration"></a><span data-ttu-id="29706-144">使用 BizTalk Server 配置的默认创建的数据库</span><span class="sxs-lookup"><span data-stu-id="29706-144">Databases created with a default BizTalk Server configuration</span></span>  
 <span data-ttu-id="29706-145">具体取决于时多达 13 不同数据库中配置 BizTalk Server 中，可能在 SQL Server 中创建的所有这些数据库在默认文件组中创建启用功能。</span><span class="sxs-lookup"><span data-stu-id="29706-145">Depending on which features are enabled when configuring BizTalk Server, up to 13 different databases may be created in SQL Server and all of these databases are created in the default filegroup.</span></span> <span data-ttu-id="29706-146">SQL Server 的默认文件组是主文件组，除非使用 ALTER DATABASE 命令更改默认文件组。</span><span class="sxs-lookup"><span data-stu-id="29706-146">The default filegroup for SQL Server is the PRIMARY filegroup unless the default filegroup is changed by using the ALTER DATABASE command.</span></span> <span data-ttu-id="29706-147">下表列出了如果配置 BizTalk Server 时启用所有功能在 SQL Server 中创建的数据库。</span><span class="sxs-lookup"><span data-stu-id="29706-147">The following table lists the databases that are created in SQL Server if all features are enabled when configuring BizTalk Server.</span></span>  
  
### <a name="biztalk-server-databases"></a><span data-ttu-id="29706-148">BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-148">BizTalk Server Databases</span></span>  
  
||||  
|-|-|-|  
|<span data-ttu-id="29706-149">**数据库**</span><span class="sxs-lookup"><span data-stu-id="29706-149">**Database**</span></span>|<span data-ttu-id="29706-150">**默认数据库名称**</span><span class="sxs-lookup"><span data-stu-id="29706-150">**Default Database Name**</span></span>|<span data-ttu-id="29706-151">**Description**</span><span class="sxs-lookup"><span data-stu-id="29706-151">**Description**</span></span>|  
|<span data-ttu-id="29706-152">配置数据库</span><span class="sxs-lookup"><span data-stu-id="29706-152">Configuration database</span></span>|<span data-ttu-id="29706-153">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="29706-153">BizTalkMgmtDb</span></span>|<span data-ttu-id="29706-154">中央元数据信息存储在 BizTalk Server 组中的 BizTalk Server 的所有实例。</span><span class="sxs-lookup"><span data-stu-id="29706-154">The central meta-information store for all instances of BizTalk Server in the BizTalk Server group.</span></span>|  
|<span data-ttu-id="29706-155">BizTalk MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-155">BizTalk MessageBox database</span></span>|<span data-ttu-id="29706-156">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="29706-156">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="29706-157">存储订阅谓词。</span><span class="sxs-lookup"><span data-stu-id="29706-157">Stores subscriptions predicates.</span></span> <span data-ttu-id="29706-158">它是一个主机平台，并为每个 BizTalk Server 主机中保留队列和状态表。</span><span class="sxs-lookup"><span data-stu-id="29706-158">It is a host platform, and keeps queues and state tables for each BizTalk Server host.</span></span> <span data-ttu-id="29706-159">MessageBox 数据库还存储消息和消息属性。</span><span class="sxs-lookup"><span data-stu-id="29706-159">The MessageBox database also stores the messages and message properties.</span></span>|  
|<span data-ttu-id="29706-160">BizTalk 跟踪数据库</span><span class="sxs-lookup"><span data-stu-id="29706-160">BizTalk Tracking database</span></span>|<span data-ttu-id="29706-161">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="29706-161">BizTalkDTADb</span></span>|<span data-ttu-id="29706-162">存储业务和运行状况监视由 BizTalk Server 跟踪引擎跟踪数据。</span><span class="sxs-lookup"><span data-stu-id="29706-162">Stores business and health monitoring data tracked by the BizTalk Server tracking engine.</span></span>|  
|<span data-ttu-id="29706-163">BAM 分析数据库</span><span class="sxs-lookup"><span data-stu-id="29706-163">BAM Analysis database</span></span>|<span data-ttu-id="29706-164">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="29706-164">BAMAnalysis</span></span>|<span data-ttu-id="29706-165">有关业务活动以保持聚合的历史数据的 SQL Server Analysis Services 数据库。</span><span class="sxs-lookup"><span data-stu-id="29706-165">SQL Server Analysis Services database that keeps the aggregated historical data for Business Activities.</span></span>|  
|<span data-ttu-id="29706-166">BAM 星型架构数据库</span><span class="sxs-lookup"><span data-stu-id="29706-166">BAM Star Schema database</span></span>|<span data-ttu-id="29706-167">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="29706-167">BAMStarSchema</span></span>|<span data-ttu-id="29706-168">转换为进行 OLAP 处理业务活动监视中收集的数据。</span><span class="sxs-lookup"><span data-stu-id="29706-168">Transforms the data collected from Business Activity Monitoring for OLAP Processing.</span></span> <span data-ttu-id="29706-169">使用 BAM 分析数据库时，此数据库是必需的。</span><span class="sxs-lookup"><span data-stu-id="29706-169">This database is required when using the BAM Analysis database.</span></span>|  
|<span data-ttu-id="29706-170">BAM 主导入数据库</span><span class="sxs-lookup"><span data-stu-id="29706-170">BAM Primary Import database</span></span>|<span data-ttu-id="29706-171">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="29706-171">BAMPrimaryImport</span></span>|<span data-ttu-id="29706-172">存储在活动实例后发生的事件的业务活动，然后查询进度和数据。</span><span class="sxs-lookup"><span data-stu-id="29706-172">Stores the events from Business Activities and then queries for the progress and data after activity instances.</span></span> <span data-ttu-id="29706-173">此数据库还执行实时聚合。</span><span class="sxs-lookup"><span data-stu-id="29706-173">This database also performs real-time aggregations.</span></span>|  
|<span data-ttu-id="29706-174">BAM 存档数据库</span><span class="sxs-lookup"><span data-stu-id="29706-174">BAM Archive database</span></span>|<span data-ttu-id="29706-175">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="29706-175">BAMArchive</span></span>|<span data-ttu-id="29706-176">存储订阅谓词。</span><span class="sxs-lookup"><span data-stu-id="29706-176">Stores subscription predicates.</span></span> <span data-ttu-id="29706-177">BAM 存档数据库最小化 BAM 主导入数据库中的业务活动数据的累计。</span><span class="sxs-lookup"><span data-stu-id="29706-177">The BAM Archive database minimizes the accumulation of Business Activity data in the BAM Primary Import database.</span></span>|  
|<span data-ttu-id="29706-178">SSO 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-178">SSO database</span></span>|<span data-ttu-id="29706-179">SSODB</span><span class="sxs-lookup"><span data-stu-id="29706-179">SSODB</span></span>|<span data-ttu-id="29706-180">安全地存储配置的信息接收位置。</span><span class="sxs-lookup"><span data-stu-id="29706-180">Securely stores the configuration information for receive locations.</span></span> <span data-ttu-id="29706-181">存储有关 SSO affiliate 应用程序，以及所有关联应用程序的加密的用户凭据。</span><span class="sxs-lookup"><span data-stu-id="29706-181">Stores information for SSO affiliate applications, as well as the encrypted user credentials to all the affiliate applications.</span></span>|  
|<span data-ttu-id="29706-182">规则引擎数据库</span><span class="sxs-lookup"><span data-stu-id="29706-182">Rule Engine database</span></span>|<span data-ttu-id="29706-183">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="29706-183">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="29706-184">存储库：</span><span class="sxs-lookup"><span data-stu-id="29706-184">Repository for:</span></span><br /><br /> <span data-ttu-id="29706-185">-策略，它是相关的规则集。</span><span class="sxs-lookup"><span data-stu-id="29706-185">-   Policies, which are sets of related rules.</span></span><br /><span data-ttu-id="29706-186">-词汇，它们是在规则中的数据引用的用户友好的特定于域的名称的集合。</span><span class="sxs-lookup"><span data-stu-id="29706-186">-   Vocabularies, which are collections of user-friendly, domain-specific names for data references in rules.</span></span>|  
|<span data-ttu-id="29706-187">BizTalk 基本 EDI 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-187">BizTalk Base EDI database</span></span>|<span data-ttu-id="29706-188">BizTalkEDIDb</span><span class="sxs-lookup"><span data-stu-id="29706-188">BizTalkEDIDb</span></span>|<span data-ttu-id="29706-189">将存储 EDI 文档跟踪和处理数据。</span><span class="sxs-lookup"><span data-stu-id="29706-189">Stores EDI document tracking and processing data.</span></span>|  
|<span data-ttu-id="29706-190">工作流服务管理数据库</span><span class="sxs-lookup"><span data-stu-id="29706-190">Human Workflow Services Administration database</span></span>|<span data-ttu-id="29706-191">BizTalkHwsDb</span><span class="sxs-lookup"><span data-stu-id="29706-191">BizTalkHwsDb</span></span>|<span data-ttu-id="29706-192">存储 BizTalk 工作流服务所需的管理信息。</span><span class="sxs-lookup"><span data-stu-id="29706-192">Stores administrative information required by the BizTalk Human Workflow Services.</span></span>|  
|<span data-ttu-id="29706-193">贸易合作伙伴管理数据库</span><span class="sxs-lookup"><span data-stu-id="29706-193">Trading Partner Management database</span></span>|<span data-ttu-id="29706-194">TPM</span><span class="sxs-lookup"><span data-stu-id="29706-194">TPM</span></span>|<span data-ttu-id="29706-195">贸易合作伙伴数据业务活动服务 (BAS) 的存储。</span><span class="sxs-lookup"><span data-stu-id="29706-195">Stores trading partner data for Business Activity Services (BAS).</span></span>|  
|<span data-ttu-id="29706-196">跟踪 Analysis Server 管理数据库</span><span class="sxs-lookup"><span data-stu-id="29706-196">Tracking Analysis Server Administration database</span></span>|<span data-ttu-id="29706-197">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="29706-197">BizTalkAnalysisDb</span></span>|<span data-ttu-id="29706-198">存储业务和运行状况监视 OLAP 多维数据集。</span><span class="sxs-lookup"><span data-stu-id="29706-198">Stores both business and health monitoring OLAP cubes.</span></span>|  
  
## <a name="separation-of-data-files-and-log-files"></a><span data-ttu-id="29706-199">数据文件和日志文件的分离</span><span class="sxs-lookup"><span data-stu-id="29706-199">Separation of data files and log files</span></span>  
 <span data-ttu-id="29706-200">如前所述，默认 BizTalk Server 配置 MessageBox 数据库会置于单个文件中的默认文件组中。</span><span class="sxs-lookup"><span data-stu-id="29706-200">As noted earlier, a default BizTalk Server configuration places the MessageBox Database into a single file in the default filegroup.</span></span> <span data-ttu-id="29706-201">默认情况下，MessageBox 数据库的数据和事务日志放置在相同的驱动器和路径。</span><span class="sxs-lookup"><span data-stu-id="29706-201">By default, the data and transaction logs for the MessageBox database are placed on the same drive and path.</span></span> <span data-ttu-id="29706-202">这样做是为了适应单磁盘系统。</span><span class="sxs-lookup"><span data-stu-id="29706-202">This is done to accommodate systems with a single disk.</span></span> <span data-ttu-id="29706-203">单个文件/文件组/磁盘配置是**不是最佳选择**在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="29706-203">A single file/filegroup/disk configuration is **not optimal** in a production environment.</span></span> <span data-ttu-id="29706-204">为了获得最佳性能，数据文件和日志文件应置于单独磁盘上。</span><span class="sxs-lookup"><span data-stu-id="29706-204">For optimal performance, the data files and log files should be placed on separate disks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-205">日志文件不包括在文件组内。</span><span class="sxs-lookup"><span data-stu-id="29706-205">Log files are never part of a filegroup.</span></span> <span data-ttu-id="29706-206">日志空间与数据空间分开管理。</span><span class="sxs-lookup"><span data-stu-id="29706-206">Log space is managed separately from data space.</span></span>  
  
## <a name="the-8020-rule-of-distributing-biztalk-server-databases"></a><span data-ttu-id="29706-207">80/20 规则分发 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-207">The 80/20 rule of distributing BizTalk Server databases</span></span>  
 <span data-ttu-id="29706-208">在大多数 BizTalk Server 解决方案中，由于磁盘 I/O 争用或数据库争用的主要来源是争用的 BizTalk Server MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="29706-208">The main source of contention in most BizTalk Server solutions, either because of disk I/O contention or database contention, is the BizTalk Server MessageBox database.</span></span> <span data-ttu-id="29706-209">这是在单个和多 MessageBox 方案 true。</span><span class="sxs-lookup"><span data-stu-id="29706-209">This is true in both single and multi-MessageBox scenarios.</span></span> <span data-ttu-id="29706-210">它是合理的假定，80%的值的分发 BizTalk 数据库将派生自优化的 MessageBox 数据文件和日志文件。</span><span class="sxs-lookup"><span data-stu-id="29706-210">It is reasonable to assume that as much as 80% of the value of distributing BizTalk databases will be derived from optimizing the MessageBox data files and log file.</span></span> <span data-ttu-id="29706-211">详细描述下面的示例方案侧重于优化 MessageBox 数据库的数据文件。</span><span class="sxs-lookup"><span data-stu-id="29706-211">The sample scenario detailed below is focused on optimizing the data files for a MessageBox database.</span></span> <span data-ttu-id="29706-212">根据需要然后可以为其他数据库遵循这些步骤。</span><span class="sxs-lookup"><span data-stu-id="29706-212">These steps can then be followed for other databases as needed.</span></span> <span data-ttu-id="29706-213">例如，如果解决方案需要广泛的跟踪，也可优化跟踪数据库。</span><span class="sxs-lookup"><span data-stu-id="29706-213">For example, if the solution requires extensive tracking, the Tracking database can also be optimized.</span></span>  
  
## <a name="manually-adding-files-to-the-messagebox-database-step-by-step"></a><span data-ttu-id="29706-214">手动将文件添加到 MessageBox 数据库，分步</span><span class="sxs-lookup"><span data-stu-id="29706-214">Manually adding files to the MessageBox database, step-by-step</span></span>  
 <span data-ttu-id="29706-215">本主题的此部分介绍可后接手动将文件添加到 MessageBox 数据库的步骤。</span><span class="sxs-lookup"><span data-stu-id="29706-215">This section of the topic describes the steps that can be followed to manually add files to the MessageBox database.</span></span> <span data-ttu-id="29706-216">在此示例中添加三个文件组，并随后将文件添加到每个文件组，以针对 MessageBox 中将文件分发在多个磁盘。</span><span class="sxs-lookup"><span data-stu-id="29706-216">In this example three filegroups are added and then a file is added to each filegroup to distribute the files for the MessageBox across multiple disks.</span></span>
  
### <a name="manually-adding-files-to-the-messagebox-database-on-sql-server"></a><span data-ttu-id="29706-217">手动将文件添加到 SQL Server 上的 MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="29706-217">Manually adding files to the MessageBox database on SQL Server</span></span>
   
1.  <span data-ttu-id="29706-218">打开**SQL Server Management Studio**以显示**连接到服务器**对话框。</span><span class="sxs-lookup"><span data-stu-id="29706-218">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
     <span data-ttu-id="29706-219">![SQL Server 登录名屏幕](../technical-guides/media/sqlserver2008r2-loginscreen.gif "SQLServer2008R2 登录画面")</span><span class="sxs-lookup"><span data-stu-id="29706-219">![SQL Server Login screen](../technical-guides/media/sqlserver2008r2-loginscreen.gif "SQLServer2008R2-Loginscreen")</span></span>  
  
2.  <span data-ttu-id="29706-220">在**服务器名称**编辑框**连接到服务器**对话框框中，输入保存 BizTalk Server MessageBox 数据库的 SQL Server 实例的名称，单击**连接**以显示 SQL Server Management Studio。</span><span class="sxs-lookup"><span data-stu-id="29706-220">In the **Server name** edit box of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases and click **Connect** to display SQL Server Management Studio.</span></span> <span data-ttu-id="29706-221">在**对象资源管理器**窗格中的 SQL Server Management Studio，展开**数据库**若要查看数据库的 SQL Server 的此实例。</span><span class="sxs-lookup"><span data-stu-id="29706-221">In the **Object Explorer** pane of SQL Server Management Studio, expand **Databases** to view the databases for this instance of SQL Server.</span></span>  
  
     <span data-ttu-id="29706-222">![SQL Server 2005 Management Studio、 对象资源管理器](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span><span class="sxs-lookup"><span data-stu-id="29706-222">![SQL Server 2005 Management Studio, Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span></span>  
  
3.  <span data-ttu-id="29706-223">右键单击要添加文件，然后单击到数据库**属性**以显示**数据库属性**对话框中的数据库。</span><span class="sxs-lookup"><span data-stu-id="29706-223">Right-click the database to which to add the files, and then click **Properties** to display the **Database Properties** dialog box for the database.</span></span>  
  
     <span data-ttu-id="29706-224">![SQL Server 2005 数据库属性对话框中](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span><span class="sxs-lookup"><span data-stu-id="29706-224">![SQL Server 2005 Database Properties dialog box](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span></span>  
  
4.  <span data-ttu-id="29706-225">在**数据库属性**对话框中，选择**文件组**页。</span><span class="sxs-lookup"><span data-stu-id="29706-225">In the **Database Properties** dialog box, select the **Filegroups** page.</span></span> <span data-ttu-id="29706-226">若要创建的 BizTalkMsgBoxDb 数据库的其他文件组，请单击**添加**。</span><span class="sxs-lookup"><span data-stu-id="29706-226">To create additional filegroups for the BizTalkMsgBoxDb databases, click **Add** .</span></span> <span data-ttu-id="29706-227">在下面的示例中，添加三个其他文件组。</span><span class="sxs-lookup"><span data-stu-id="29706-227">In the following example, three additional filegroups are added.</span></span>  
  
     <span data-ttu-id="29706-228">![SQL Server 2005 中，向数据库添加文件组](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span><span class="sxs-lookup"><span data-stu-id="29706-228">![SQL Server 2005, adding filegroups to a database](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span></span>  
  
5.  <span data-ttu-id="29706-229">在 **“数据库属性”** 对话框中，选择 **“文件”** 页。</span><span class="sxs-lookup"><span data-stu-id="29706-229">In the **Database Properties** dialog box, select the **Files** page.</span></span>  
  
     <span data-ttu-id="29706-230">若要创建要添加到文件组的其他文件，请单击**添加**，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="29706-230">To create additional files to add to the filegroups, click **Add** , and then click **OK**.</span></span> <span data-ttu-id="29706-231">MessageBox 数据库现在分布在多个磁盘，将提供的单个磁盘配置有显著的性能优势。</span><span class="sxs-lookup"><span data-stu-id="29706-231">The MessageBox database is now distributed across multiple disks, which will provide a significant performance advantage over a single disk configuration.</span></span>  
  
     <span data-ttu-id="29706-232">在下面的示例中，为每个以前创建的文件组创建一个文件和每个文件放置在单独的磁盘上。</span><span class="sxs-lookup"><span data-stu-id="29706-232">In the following example, a file is created for each of the filegroups that were created earlier and each file is placed on a separate disk.</span></span>  
  
     <span data-ttu-id="29706-233">![SQL Server 2005 中，将文件添加到文件组](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span><span class="sxs-lookup"><span data-stu-id="29706-233">![SQL Server 2005, adding files to a filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span></span>  
  
## <a name="sample-sql-script-for-adding-filegroups-and-files-to-the-biztalk-messagebox-database"></a><span data-ttu-id="29706-234">用于将文件组和文件添加到 BizTalk MessageBox 数据库示例 SQL 脚本</span><span class="sxs-lookup"><span data-stu-id="29706-234">Sample SQL script for adding filegroups and files to the BizTalk MessageBox database</span></span>  
 <span data-ttu-id="29706-235">本指南包括有关将文件组和文件添加到 BizTalk Server MessageBox 数据库的 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="29706-235">This guide includes an SQL script for adding filegroups and files to the BizTalk Server MessageBox database.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="29706-236">SQL Server 按顺序将写入其日志文件，因为没有任何性能优势，实现通过创建针对 SQL Server 数据库的多个日志文件。</span><span class="sxs-lookup"><span data-stu-id="29706-236">Because SQL Server writes to its log files sequentially, there is no performance advantage realized by creating multiple log files for a SQL Server database.</span></span>  
  
 <span data-ttu-id="29706-237">若要运行此脚本，请按照下列步骤：</span><span class="sxs-lookup"><span data-stu-id="29706-237">To run this script, follow these steps:</span></span>  
  
1.  <span data-ttu-id="29706-238">打开**SQL Server Management Studio**以显示**连接到服务器**对话框。</span><span class="sxs-lookup"><span data-stu-id="29706-238">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
2.  <span data-ttu-id="29706-239">在**服务器名称**编辑框**连接到服务器**对话框框中，输入保存 BizTalk Server MessageBox 数据库的 SQL Server 实例的名称，单击**连接**可显示 SQL Server Management Studio 对话框。</span><span class="sxs-lookup"><span data-stu-id="29706-239">In the **Server name** edit box of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases and click **Connect** to display the SQL Server Management Studio dialog box.</span></span>  
  
3.  <span data-ttu-id="29706-240">在 SQL Server Management Studio 中，单击**文件**菜单上，指向**新建**，然后单击**使用当前连接查询**若要启动 SQL 查询编辑器。</span><span class="sxs-lookup"><span data-stu-id="29706-240">In SQL Server Management Studio, click the **File** menu, point to **New**, and then click **Query with Current Connection** to start the SQL Query Editor.</span></span>  
  
4.  <span data-ttu-id="29706-241">将示例脚本从复制[BizTalk Server MessageBox 数据库文件组 SQL 脚本](../technical-guides/biztalk-server-messagebox-database-filegroups-sql-script.md)到查询编辑器中。</span><span class="sxs-lookup"><span data-stu-id="29706-241">Copy the sample script from [BizTalk Server MessageBox Database Filegroups SQL Script](../technical-guides/biztalk-server-messagebox-database-filegroups-sql-script.md) into the Query Editor.</span></span>  
  
5.  <span data-ttu-id="29706-242">编辑脚本以匹配你的 BizTalk 服务器环境中的参数并执行脚本。</span><span class="sxs-lookup"><span data-stu-id="29706-242">Edit the parameters in the script to match your BizTalk Server environment, and execute the script.</span></span>  
  
 <span data-ttu-id="29706-243">脚本的优点是，脚本可以快速执行多个任务，并确切地说，可重现而减少人为错误的可能性。</span><span class="sxs-lookup"><span data-stu-id="29706-243">The advantage to scripting is that scripts can perform multiple tasks quickly, can be reproduced precisely, and reduce the possibility of human error.</span></span> <span data-ttu-id="29706-244">脚本的缺点是脚本的执行编写不正确可能会导致严重的问题，可能需要的 BizTalk Server 数据库，以便从从头开始重新配置。</span><span class="sxs-lookup"><span data-stu-id="29706-244">The disadvantage of scripting is that the execution of an incorrectly written script can potentially cause serious problems that could require the BizTalk Server databases to be re-configured from scratch.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="29706-245">它最重要的是，SQL 脚本如本指南中的示例脚本进行彻底的测试之前正在执行在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="29706-245">It is of utmost importance that SQL scripts such as the sample script in this guide are thoroughly tested before being executed in a production environment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="29706-246">另请参阅</span><span class="sxs-lookup"><span data-stu-id="29706-246">See Also</span></span>  
 [<span data-ttu-id="29706-247">优化数据库性能</span><span class="sxs-lookup"><span data-stu-id="29706-247">Optimizing Database Performance</span></span>](../technical-guides/optimizing-database-performance.md)