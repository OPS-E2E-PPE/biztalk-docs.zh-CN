---
title: "缩放 BizTalk Server 数据库的扩展 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 18853ceb-7975-4c30-878f-6b162005f795
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e3116b7aae087e74ade089c8020a7d35c883cd2e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="scaling-out-the-biztalk-server-databases"></a><span data-ttu-id="62b29-102">向外扩展 BizTalk Server Database</span><span class="sxs-lookup"><span data-stu-id="62b29-102">Scaling Out the BizTalk Server Databases</span></span>
<span data-ttu-id="62b29-103">若要提供的高可用性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库，配置正在运行的两台计算机[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]或[!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)]Windows 群集中。</span><span class="sxs-lookup"><span data-stu-id="62b29-103">To provide high availability for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, configure two computers that are running [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] or [!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)] in a Windows cluster.</span></span> <span data-ttu-id="62b29-104">这些计算机可以运行在主动/主动、 主动/被动或 （需要三台计算机） 的主动/主动/被动冗余配置并可以将数据存储在共享的驱动器 (如 RAID 1 + 0 SCSI 磁盘阵列) 或存储区域网络 (SAN)。</span><span class="sxs-lookup"><span data-stu-id="62b29-104">These computers can run in an active/active, active/passive, or active/active/passive (requires three computers) configuration for redundancy and can store data on a shared drive (such as a RAID 1+0 SCSI disk array) or storage area network (SAN).</span></span>  
  
 <span data-ttu-id="62b29-105">如果[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]出于任何原因服务变得不可用，数据库群集将资源从活动的计算机传输到被动的计算机。</span><span class="sxs-lookup"><span data-stu-id="62b29-105">If the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] service becomes unavailable for any reason, the database cluster transfers resources from the active computer to the passive computer.</span></span> <span data-ttu-id="62b29-106">在此故障转移过程中，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]服务实例遇到数据库连接失败，并自动重新启动以重新连接到数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-106">During this failover process, the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] service instances experience database connection failures and automatically restart to reconnect to the databases.</span></span> <span data-ttu-id="62b29-107">采用故障转移期间传输的资源后，正在运行的数据库计算机（即前面提到的被动计算机）将开始处理数据库连接。</span><span class="sxs-lookup"><span data-stu-id="62b29-107">The functioning database computer (previously the passive computer) begins processing the database connections after assuming the resources during failover.</span></span>  
  
 <span data-ttu-id="62b29-108">群集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库已在[群集 BizTalk Server Databases2](../technical-guides/clustering-the-biztalk-server-databases2.md)。</span><span class="sxs-lookup"><span data-stu-id="62b29-108">Clustering the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases is discussed in [Clustering the BizTalk Server Databases2](../technical-guides/clustering-the-biztalk-server-databases2.md).</span></span> <span data-ttu-id="62b29-109">本部分重点介绍向外扩展[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库以提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="62b29-109">This section focuses on scaling out the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases to provide high availability.</span></span>  
  
## <a name="providing-high-availability-for-the-biztalk-messagebox-database"></a><span data-ttu-id="62b29-110">BizTalk MessageBox 数据库提供高可用性</span><span class="sxs-lookup"><span data-stu-id="62b29-110">Providing High Availability for the BizTalk MessageBox Database</span></span>  
 <span data-ttu-id="62b29-111">本部分提供有关如何配置以实现高可用性的 BizTalk MessageBox 数据库信息。</span><span class="sxs-lookup"><span data-stu-id="62b29-111">This section provides information about to configure BizTalk MessageBox database for high availability.</span></span>  
  
### <a name="running-multiple-messagebox-databases"></a><span data-ttu-id="62b29-112">运行多个 MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="62b29-112">Running Multiple MessageBox Databases</span></span>  
 <span data-ttu-id="62b29-113">若要增强的可伸缩性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库和地址 MessageBox 数据库上的高 CPU 利用率[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]计算机，你可以配置[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]来跨多个 MessageBox 数据库中存储数据。</span><span class="sxs-lookup"><span data-stu-id="62b29-113">To enhance the scalability of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases and to address high CPU utilization on the MessageBox database [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] computer, you can configure [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to store data across multiple MessageBox databases.</span></span> <span data-ttu-id="62b29-114">运行配置向导时创建第一个 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-114">You create the first MessageBox database when you run the Configuration Wizard.</span></span> <span data-ttu-id="62b29-115">此 MessageBox 数据库为主 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-115">This MessageBox database is the master MessageBox database.</span></span> <span data-ttu-id="62b29-116">没有单个主 MessageBox 数据库你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]部署。</span><span class="sxs-lookup"><span data-stu-id="62b29-116">There is a single master MessageBox database in your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] deployment.</span></span> <span data-ttu-id="62b29-117">主 MessageBox 数据库包含主订阅信息，并将消息路由到相应的 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-117">The master MessageBox database contains the master subscription information and routes messages to the appropriate MessageBox database.</span></span> <span data-ttu-id="62b29-118">通常情况下，你想要专门 master 的 MessageBox 数据库，以实现仅用于路由，并且让其他 MessageBox 数据库进行处理。</span><span class="sxs-lookup"><span data-stu-id="62b29-118">Typically, you want to dedicate the master MessageBox database to do routing only and let the other MessageBox databases do the processing.</span></span> <span data-ttu-id="62b29-119">为了 MessageBox 数据库来实现仅用于路由，请选择**禁用新消息发布**从 BizTalk 管理控制台中的 MessageBox 属性。</span><span class="sxs-lookup"><span data-stu-id="62b29-119">To make a MessageBox database to do routing only, select **Disable new message publication** from the MessageBox properties in BizTalk Administration console.</span></span>  
  
 <span data-ttu-id="62b29-120">处理流程的 MessageBox 数据库的一个示例是，如下所示：</span><span class="sxs-lookup"><span data-stu-id="62b29-120">An example of MessageBox database processing flow is as follows:</span></span>  
  
1.  <span data-ttu-id="62b29-121">当主 MessageBox 数据库接收到新的激活消息（业务流程的崭新实例或订阅消息）时，主 MessageBox 数据库会将该激活消息分发给下一个可用的 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-121">When the master MessageBox database receives a new activation message—a brand new instance of a business process or a subscription message—the master MessageBox database distributes the activation message to the next available MessageBox database.</span></span> <span data-ttu-id="62b29-122">例如，如果您有一个主 MessageBox 数据库和两个 MessageBox 数据库，主 MessageBox 数据库会将第一个激活消息路由到 MessageBox 数据库 1、将第二个激活消息路由到 MessageBox 数据库 2、将第三个激活消息路由到 MessageBox 数据库 1，然后按循环法模式依此类推。</span><span class="sxs-lookup"><span data-stu-id="62b29-122">For example, if you have one master MessageBox database and two MessageBox databases, the master MessageBox database routes the first activation message to MessageBox database 1, the second activation message to MessageBox database 2, the third activation message to MessageBox database 1, and so on in a round-robin pattern.</span></span> <span data-ttu-id="62b29-123">主 MessageBox 数据库使用内置逻辑来提供负载平衡，因此不需要其他的负载平衡机制。</span><span class="sxs-lookup"><span data-stu-id="62b29-123">The master MessageBox database uses built-in logic to load balance, and does not need additional load-balancing mechanisms.</span></span>  
  
2.  <span data-ttu-id="62b29-124">当主 MessageBox 数据库将激活消息路由到特定 MessageBox 数据库（例如，MessageBox 数据库 1）后，业务流程将进入内存并运行。</span><span class="sxs-lookup"><span data-stu-id="62b29-124">After the master MessageBox database routes the activation message to a particular MessageBox database (for example, MessageBox database 1), the business process goes into memory and runs.</span></span>  
  
3.  <span data-ttu-id="62b29-125">如果业务流程必须等待一条消息，并且等待时间的长度超过几秒钟，业务流程将保留回 MessageBox 数据库 1。</span><span class="sxs-lookup"><span data-stu-id="62b29-125">If the business process has to wait for a message, and the wait time is longer than several seconds, the business process is persisted back into MessageBox database 1.</span></span> <span data-ttu-id="62b29-126">业务流程正在等待相关消息。</span><span class="sxs-lookup"><span data-stu-id="62b29-126">The business process is waiting for a correlation message.</span></span>  
  
4.  <span data-ttu-id="62b29-127">在相关消息到达 master MessageBox 数据库时，消息引擎将执行包含的相关消息 （在此示例中，MessageBox 1） 的状态的 MessageBox 数据库在数据库中的查找操作。</span><span class="sxs-lookup"><span data-stu-id="62b29-127">When the correlation message arrives at the master MessageBox database, the Message Engine does a lookup operation in the database for the MessageBox database that contains the state for the correlation message (in this example, MessageBox 1).</span></span> <span data-ttu-id="62b29-128">Master MessageBox 数据库将邮件传递到 MessageBox 数据库包含业务流程。</span><span class="sxs-lookup"><span data-stu-id="62b29-128">The master MessageBox database delivers the message to the MessageBox database that contains the business process.</span></span>  
  
5.  <span data-ttu-id="62b29-129">业务流程将恢复到内存中以便继续处理直到完成或它必须等待另一个相关消息。</span><span class="sxs-lookup"><span data-stu-id="62b29-129">The business process is brought back into memory to continue processing until it finishes or until it has to wait for another correlation message.</span></span>  
  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="62b29-130">存储在 MessageBox 数据库中，所有的状态以及每个 MessageBox 数据库包含不同业务流程的状态的信息。</span><span class="sxs-lookup"><span data-stu-id="62b29-130"> stores all the states in the MessageBox databases, and each MessageBox database contains state information for different business processes.</span></span> <span data-ttu-id="62b29-131">为实现可靠性，必须群集所有 MessageBox 数据库，包括主 MessageBox 数据库和辅助 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-131">For reliability, you must cluster all the MessageBox databases, including the master and secondary MessageBox databases.</span></span>  
  
 <span data-ttu-id="62b29-132">若要配置多个 MessageBox 数据库，你可以使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]以添加正在运行的计算机的管理控制台[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="62b29-132">To configure multiple MessageBox databases, you use the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console to add the computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)].</span></span> <span data-ttu-id="62b29-133">从管理角度来看，您只需添加新的 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-133">From an administration perspective, you only have to add new MessageBox databases.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="62b29-134">自动处理激活消息的轮循机制分布，并将相关消息发送到正确的 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-134"> automatically handles the round-robin distribution of activation messages and sends correlation messages to the correct MessageBox databases.</span></span>  
  
 <span data-ttu-id="62b29-135">如果在你的环境中配置多个 MessageBox 数据库应创建的三个 MessageBox 数据库至少你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]组，并且你应禁用在 master 数据库中的 MessageBox 发布消息。</span><span class="sxs-lookup"><span data-stu-id="62b29-135">If you configure multiple MessageBox databases in your environment you should create a minimum of three MessageBox databases for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group and you should disable message publication on the master MessageBox database.</span></span> <span data-ttu-id="62b29-136">此建议进行因为添加其他 MessageBox 数据库可能会产生开销 MessageBox 数据库之间路由消息的主 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-136">This recommendation is made because adding additional MessageBox databases incurs overhead by the master MessageBox database for routing messages between the MessageBox databases.</span></span> <span data-ttu-id="62b29-137">如果仅配置两个 MessageBox 数据库然后大部分其他 MessageBox 数据库中获得的好处是通过使用的邮件路由的主 MessageBox 数据库的开销偏移量。</span><span class="sxs-lookup"><span data-stu-id="62b29-137">If you only configure two MessageBox databases then most of the benefit gained by the additional MessageBox database is offset by the overhead consumed by the master MessageBox database for message routing.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="62b29-138">存储在 MessageBox 数据库中，所有的状态以及每个 MessageBox 数据库包含不同业务流程的状态的信息。</span><span class="sxs-lookup"><span data-stu-id="62b29-138"> stores all the states in the MessageBox databases, and each MessageBox database contains state information for different business processes.</span></span> <span data-ttu-id="62b29-139">为实现可靠性，必须群集所有 MessageBox 数据库，包括主 MessageBox 数据库和辅助 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-139">For reliability, you must cluster all the MessageBox databases, including the master and secondary MessageBox databases.</span></span>  
  
### <a name="providing-high-availability-for-multiple-messagebox-databases"></a><span data-ttu-id="62b29-140">取保多个 MessageBox 数据库高度可用</span><span class="sxs-lookup"><span data-stu-id="62b29-140">Providing High Availability for Multiple MessageBox Databases</span></span>  
 <span data-ttu-id="62b29-141">添加到 MessageBox 数据库时你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]部署能够提高可伸缩性，它不提供高可用性，因为每个 MessageBox 数据库是唯一且独立的并且可能是单点故障你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境。</span><span class="sxs-lookup"><span data-stu-id="62b29-141">While adding MessageBox databases to your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] deployment improves scalability, it does not provide high availability because each MessageBox database is unique and independent and is potentially a single point of failure for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="62b29-142">若要添加冗余，则需要为每个 MessageBox 数据库配置一个服务器群集。</span><span class="sxs-lookup"><span data-stu-id="62b29-142">To add redundancy involves configuring a server cluster for each MessageBox database.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="62b29-143">将数据分布在多个 MessageBox 数据库中,，因此数据库不共享数据或其他方式不带有服务器群集提供冗余。</span><span class="sxs-lookup"><span data-stu-id="62b29-143"> distributes data across the multiple MessageBox databases, so the databases do not share data or otherwise provide redundancy without server clustering.</span></span>  
  
## <a name="providing-high-availability-for-the-biztalk-tracking-database"></a><span data-ttu-id="62b29-144">确保 BizTalk 跟踪数据库高度可用</span><span class="sxs-lookup"><span data-stu-id="62b29-144">Providing High Availability for the BizTalk Tracking Database</span></span>  
 <span data-ttu-id="62b29-145">根据您的特定部署的要求，你可能想要隔离到单独的 BizTalk 跟踪数据库，从而提高性能跟踪[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]计算机，通过创建一个单独 BizTalk 主机专用于跟踪的主机。</span><span class="sxs-lookup"><span data-stu-id="62b29-145">Depending on the requirements of your particular deployment, you might want to enhance performance for tracking by isolating the BizTalk Tracking database onto a separate [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] computer and by creating a separate BizTalk Host dedicated to host tracking.</span></span> <span data-ttu-id="62b29-146">下图显示了两个主机实例和群集的数据库的专用的跟踪主机。</span><span class="sxs-lookup"><span data-stu-id="62b29-146">The following figure shows a dedicated tracking host with two host instances and clustered databases.</span></span>  
  
 <span data-ttu-id="62b29-147">![向外扩展跟踪 database](../technical-guides/media/4fc1d448-2a6c-4cea-ac17-96c1263dfb68.gif "4fc1d448-2a6c-4cea-ac17-96c1263dfb68")</span><span class="sxs-lookup"><span data-stu-id="62b29-147">![Scaling out the tracking databases](../technical-guides/media/4fc1d448-2a6c-4cea-ac17-96c1263dfb68.gif "4fc1d448-2a6c-4cea-ac17-96c1263dfb68")</span></span>  
  
 <span data-ttu-id="62b29-148">如果你的部署具有高吞吐量，并且涉及跟踪大量的这些消息的数据，跟踪开销可能会占用大量的正在运行的计算机上的资源[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="62b29-148">If your deployment has high throughput and involves tracking lots of data for these messages, the tracking overhead could potentially consume lots of resources on the computer that is running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="62b29-149">如果出现这种情况而且以后继续传入消息的速率很高，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]达到某个点时，它无法处理新消息，因为跟踪消息所需的资源来运行其他所需的资源比[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]组件 （如接收消息并将它们保存到 MessageBox 数据库）。</span><span class="sxs-lookup"><span data-stu-id="62b29-149">If this situation occurs and a high rate of incoming messages continues, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] reaches a point where it cannot process new messages because the resources required to track messages are greater than the resources required to run the other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] components (such as receiving messages and persisting them to the MessageBox database).</span></span>  
  
 <span data-ttu-id="62b29-150">为了提高性能和安全性，建议您将一台不包含其他任何项目（例如接收位置、业务流程或管道）的主机专用于跟踪，并且禁止从接收主机、处理主机和发送主机进行跟踪。</span><span class="sxs-lookup"><span data-stu-id="62b29-150">To improve performance and security, we recommend that you dedicate a host for tracking that does not contain any other items (such as receive locations, orchestrations, or pipelines) and that you disable tracking from the receiving, processing, and sending hosts.</span></span> <span data-ttu-id="62b29-151">若要确保跟踪主机高度可用，请创建跟踪主机的多个主机实例。</span><span class="sxs-lookup"><span data-stu-id="62b29-151">To provide high availability for the tracking host, create more than one host instance of the tracking host.</span></span> <span data-ttu-id="62b29-152">有关创建跟踪主机的详细信息，请参阅[如何创建新的主机](http://go.microsoft.com/fwlink/?LinkId=156825)(http://go.microsoft.com/fwlink/?LinkId=156825) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]帮助。</span><span class="sxs-lookup"><span data-stu-id="62b29-152">For more information about creating a tracking host, see [How to Create a New Host](http://go.microsoft.com/fwlink/?LinkId=156825) (http://go.microsoft.com/fwlink/?LinkId=156825) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
 <span data-ttu-id="62b29-153">对于每个 MessageBox 数据库，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]使用只有一个跟踪要将消息从 MessageBox 数据库移到 BizTalk 跟踪数据库 (BizTalkDTADb) 的主机实例。</span><span class="sxs-lookup"><span data-stu-id="62b29-153">For each MessageBox database, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] uses only one tracking host instance to move messages from the MessageBox database to the BizTalk Tracking database (BizTalkDTADb).</span></span> <span data-ttu-id="62b29-154">如果其他计算机运行的跟踪主机中，实例[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]外的每个 MessageBox 数据库添加到跟踪主机的单独实例的处理方式自动缩放。</span><span class="sxs-lookup"><span data-stu-id="62b29-154">If additional computers run instances of the tracking host, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] automatically scales out the handling of each MessageBox database to a separate instance of the tracking host.</span></span> <span data-ttu-id="62b29-155">如果 MessageBox 数据库数大于跟踪主机实例数，则一个或多个跟踪主机实例将为多个 MessageBox 数据库提供服务。</span><span class="sxs-lookup"><span data-stu-id="62b29-155">If the number of MessageBox databases is larger than the number of tracking host instances, one or more tracking host instances will service more than one MessageBox database.</span></span>  
  
 <span data-ttu-id="62b29-156">若要为 BizTalk 跟踪数据库提供高可用性，使用 Windows 群集配置正在运行的两个数据库计算机[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]主动/被动配置中。</span><span class="sxs-lookup"><span data-stu-id="62b29-156">To provide high availability for the BizTalk Tracking database, use Windows Clustering to configure two database computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] in an active/passive configuration.</span></span>  
  
## <a name="providing-high-availability-for-the-bam-databases"></a><span data-ttu-id="62b29-157">确保 BAM 数据库高度可用</span><span class="sxs-lookup"><span data-stu-id="62b29-157">Providing High Availability for the BAM Databases</span></span>  
 <span data-ttu-id="62b29-158">*业务活动监视*(BAM) 提供到独立的 IT 实现或跨异类 IT 实现的业务流程的可见性。</span><span class="sxs-lookup"><span data-stu-id="62b29-158">*Business Activity Monitoring* (BAM) provides visibility into business processes independent of the IT implementation or across a heterogeneous IT implementation.</span></span> <span data-ttu-id="62b29-159">BAM[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库 （BAM 星型架构数据库、 BAM 主导入数据库和 BAM 存档数据库） 和 BAM 分析数据库存储不同于操作的监视数据的业务活动数据。</span><span class="sxs-lookup"><span data-stu-id="62b29-159">The BAM [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases (BAM Star Schema database, BAM Primary Import database, and BAM Archive database) and the BAM Analysis database store the business activity data that is different from the operational monitoring data.</span></span> <span data-ttu-id="62b29-160">下图显示 BAM 数据库基础结构。</span><span class="sxs-lookup"><span data-stu-id="62b29-160">The following diagram shows the BAM database infrastructure.</span></span>  
  
 <span data-ttu-id="62b29-161">![BAM 数据库基础结构](../technical-guides/media/769c3b7c-fe16-4260-967e-6af003c4f08d.gif "769c3b7c-fe16-4260-967e-6af003c4f08d")</span><span class="sxs-lookup"><span data-stu-id="62b29-161">![BAM database infrastructure](../technical-guides/media/769c3b7c-fe16-4260-967e-6af003c4f08d.gif "769c3b7c-fe16-4260-967e-6af003c4f08d")</span></span>  
  
 <span data-ttu-id="62b29-162">为确保 BAM 基础结构高度可用，执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="62b29-162">To make sure your BAM infrastructure is highly available, do the following:</span></span>  
  
-   <span data-ttu-id="62b29-163">**群集 BAM 主导入数据库和 BAM 分析数据库。**</span><span class="sxs-lookup"><span data-stu-id="62b29-163">**Cluster the BAM Primary Import database and the BAM Analysis database.**</span></span> <span data-ttu-id="62b29-164">BAM 主导入数据库是业务活动监视系统的中心。</span><span class="sxs-lookup"><span data-stu-id="62b29-164">The BAM Primary Import database is the center of the Business Activity Monitoring system.</span></span> <span data-ttu-id="62b29-165">因此，通过使用 Windows 群集来确保此数据库高度可用并遵循以下两条建议以防止此数据库被填满是十分重要的。</span><span class="sxs-lookup"><span data-stu-id="62b29-165">It is therefore important that you make this database highly available by using Windows Clustering and that you follow the next two recommendations to prevent this database from filling up.</span></span> <span data-ttu-id="62b29-166">BAM 分析数据库是存储业务分析员用于生成活动聚合和 OLAP 多维数据集的数据的 Analysis Services 数据库。因此，此数据库的任何故障都会影响业务分析员的工作效率。</span><span class="sxs-lookup"><span data-stu-id="62b29-166">The BAM Analysis database is an Analysis Services database that stores the data that business analysts use to build activity aggregations and OLAP cubes, and therefore any downtime of this database affects their productivity.</span></span> <span data-ttu-id="62b29-167">虽然不需要群集 BAM 存档数据库，但我们建议你监视事件日志中的错误，当 SQL Server Integration Services (SSIS) 包运行以确保已成功，传输数据和监视数据库的大小以便你可将其替换在它之前填充向上。</span><span class="sxs-lookup"><span data-stu-id="62b29-167">While you do not have to cluster the BAM Archive database, we recommend that you monitor the event log for errors when the SQL Server Integration Services (SSIS) packages run to make sure the data has been transferred successfully, and to monitor the size of the database so that you can replace it before it fills up.</span></span>  
  
-   <span data-ttu-id="62b29-168">**定义联机窗口。**</span><span class="sxs-lookup"><span data-stu-id="62b29-168">**Define an online window.**</span></span> <span data-ttu-id="62b29-169">要允许更好的性能并避免停机时间，BAM 分区 BAM 主导入数据库中的数据到表时此活动已完成基于时间戳。</span><span class="sxs-lookup"><span data-stu-id="62b29-169">To allow for better performance and avoid downtime, BAM partitions the data in the BAM Primary Import database into tables based on the timestamp when the activity was completed.</span></span> <span data-ttu-id="62b29-170">BAM 通过定期将另一个相同格式的空表与已完成的表进行交换来实现此操作。</span><span class="sxs-lookup"><span data-stu-id="62b29-170">BAM achieves this by regularly swapping the completed table with another empty table of identical format.</span></span> <span data-ttu-id="62b29-171">BAM 完成此操作后，尽管 BAM 会在联机时段中定义的时间内保留旧分区，但其他已完成的活动将进入新分区（表）。</span><span class="sxs-lookup"><span data-stu-id="62b29-171">After BAM does this, the additional completed activities go into the new partition (table), while BAM keeps the old partitions for the time defined in the online window.</span></span> <span data-ttu-id="62b29-172">必须定义联机时段以确保 BAM 主导入数据库中的分区数不会变得过大。</span><span class="sxs-lookup"><span data-stu-id="62b29-172">You must define an online window to make sure the number of partitions in the BAM Primary Import database does not grow too large.</span></span> <span data-ttu-id="62b29-173">有关计划联机 windows 的详细信息，请参阅[存档主导入数据库数据](http://go.microsoft.com/fwlink/?LinkId=156826)(http://go.microsoft.com/fwlink/?LinkId=156826) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]帮助。</span><span class="sxs-lookup"><span data-stu-id="62b29-173">For more information about scheduling online windows, see [Archiving Primary Import Database Data](http://go.microsoft.com/fwlink/?LinkId=156826) (http://go.microsoft.com/fwlink/?LinkId=156826) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
-   <span data-ttu-id="62b29-174">**计划定期运行的 SSIS 包。**</span><span class="sxs-lookup"><span data-stu-id="62b29-174">**Schedule SSIS packages to run periodically.**</span></span> <span data-ttu-id="62b29-175">定义联机时段可确保 BAM 主导入数据库不会被旧活动分区填满。</span><span class="sxs-lookup"><span data-stu-id="62b29-175">Defining an online window makes sure your BAM Primary Import database does not fill up with old activity partitions.</span></span> <span data-ttu-id="62b29-176">您还必须安排 SSIS 包来定期运行以创建新分区的活动数据并将数据从 BAM 主导入数据库中旧的分区移动到 BAM 存档数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-176">You must also schedule SSIS packages to run periodically to create a new partition for the activity data and to move the data from the old partitions in the BAM Primary Import database into the BAM Archive database.</span></span> <span data-ttu-id="62b29-177">有关计划 SSIS 包的详细信息，请参阅[计划 SQL Server Integration Services 包](http://go.microsoft.com/fwlink/?LinkId=156827)(http://go.microsoft.com/fwlink/?LinkId=156827) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]帮助。</span><span class="sxs-lookup"><span data-stu-id="62b29-177">For more information about scheduling SSIS packages, see [Scheduling SQL Server Integration Services Packages](http://go.microsoft.com/fwlink/?LinkId=156827) (http://go.microsoft.com/fwlink/?LinkId=156827) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
-   <span data-ttu-id="62b29-178">**小心地选择小型集的数据项 （检查点），并避免定义活动时包括不必要的数据的项目。**</span><span class="sxs-lookup"><span data-stu-id="62b29-178">**Carefully choose small sets of data items (checkpoints), and avoid including unnecessary data items when defining an activity.**</span></span>  
  
-   <span data-ttu-id="62b29-179">**了解计划和实时聚合设计你的聚合时权衡。**</span><span class="sxs-lookup"><span data-stu-id="62b29-179">**Understand the trade-offs between scheduled and real-time aggregations when you design your aggregations.**</span></span> <span data-ttu-id="62b29-180">由自动维护实时聚合[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]触发，并具有零滞后时间。</span><span class="sxs-lookup"><span data-stu-id="62b29-180">Real-time aggregations are automatically maintained by [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] triggers and have zero latency.</span></span> <span data-ttu-id="62b29-181">它们非常适合用于某些任务关键型低延迟方案中，但它们会产生一定的性能开销每当事件正在写入到 BAM 主导入数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-181">They are ideal for some mission-critical low-latency scenarios, but they incur a performance cost whenever the events are being written to the BAM Primary Import database.</span></span> <span data-ttu-id="62b29-182">计划的聚合依赖于计划立方 SSIS 程序包来更新其聚合数据。</span><span class="sxs-lookup"><span data-stu-id="62b29-182">Scheduled aggregations rely on scheduled cubing SSIS packages to update their aggregation data.</span></span> <span data-ttu-id="62b29-183">其延迟是等于或大于 SSIS 计划间隔，但是总体它们具有较小的性能影响 BAM 主导入数据库。</span><span class="sxs-lookup"><span data-stu-id="62b29-183">Their latency is equal to or greater than the SSIS schedule interval, but overall they have a smaller performance impact on the BAM Primary Import database.</span></span>  
  
-   <span data-ttu-id="62b29-184">**如果你选择计划的聚合，请确保您计划 cubing SSIS 比存档 SSIS 更频繁地运行。**</span><span class="sxs-lookup"><span data-stu-id="62b29-184">**If you choose scheduled aggregations, make sure you schedule the cubing SSIS to run more frequently than the archiving SSIS.**</span></span> <span data-ttu-id="62b29-185">这是因为存档 SSIS 将不会移动并且已针对计划聚合到 BAM 存档数据库处理的活动数据。</span><span class="sxs-lookup"><span data-stu-id="62b29-185">This is because the archiving SSIS will not move the activity data that has been processed for scheduled aggregation to the BAM Archive database.</span></span>  
  
-   <span data-ttu-id="62b29-186">**启用 BAM 事件总线服务中获取故障转移功能的多台计算机。**</span><span class="sxs-lookup"><span data-stu-id="62b29-186">**Enable the BAM Event Bus service in multiple computers to obtain failover functionality.**</span></span>  
  
## <a name="providing-high-availability-for-the-other-biztalk-server-databases"></a><span data-ttu-id="62b29-187">确保其他 BizTalk Server 数据库高度可用</span><span class="sxs-lookup"><span data-stu-id="62b29-187">Providing High Availability for the Other BizTalk Server Databases</span></span>  
 <span data-ttu-id="62b29-188">若要让其他提供高可用性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库，配置正在运行的两台计算机[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]Windows 群集中。</span><span class="sxs-lookup"><span data-stu-id="62b29-188">To provide high availability for the other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, configure two computers that are running [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] in a Windows cluster.</span></span> <span data-ttu-id="62b29-189">这些计算机可以运行冗余的主动/主动或主动/被动配置中，可以在共享的驱动器上存储数据 (如 RAID 1 + 0 SCSI 磁盘阵列) 或存储区域网络 (SAN)。</span><span class="sxs-lookup"><span data-stu-id="62b29-189">These computers can run in an active/active or active/passive configuration for redundancy and can store data on a shared drive (such as a RAID 1+0 SCSI disk array) or storage area network (SAN).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="62b29-190">另请参阅</span><span class="sxs-lookup"><span data-stu-id="62b29-190">See Also</span></span>  
 [<span data-ttu-id="62b29-191">群集 BizTalk Server Databases2</span><span class="sxs-lookup"><span data-stu-id="62b29-191">Clustering the BizTalk Server Databases2</span></span>](../technical-guides/clustering-the-biztalk-server-databases2.md)