---
title: "步骤 5： 执行步骤负载模式测试以确定最大可持续吞吐量 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8056ced6-1f04-4be2-878a-48a427a93dad
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 8f9794634b5a782ef6d9bce4e819e759fd47ba1a
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="step-5-perform-step-load-pattern-tests-to-determine-maximum-sustainable-throughput"></a><span data-ttu-id="905a9-102">步骤 5： 执行步骤负载模式测试以确定最大可持续吞吐量</span><span class="sxs-lookup"><span data-stu-id="905a9-102">Step 5: Perform Step Load Pattern Tests to Determine Maximum Sustainable Throughput</span></span>
<span data-ttu-id="905a9-103">确定 BizTalk Server 解决方案与 Visual Studio 负载测试的最大可持续吞吐量 (MST) 的最简单方法是执行分级负载模式并比较每秒到每秒处理的总文档接收的总文档.</span><span class="sxs-lookup"><span data-stu-id="905a9-103">The simplest method for determining the Maximum Sustainable Throughput (MST) of a BizTalk Server solution with Visual Studio load testing is to perform a step load pattern and compare the total Documents received per second to the total Document processed per second.</span></span> <span data-ttu-id="905a9-104">只要每秒处理的平均总文档是大于或等于每秒的测试的持续时间接收的平均总文档，然后考虑负载可持续。</span><span class="sxs-lookup"><span data-stu-id="905a9-104">As long as the average total documents processed per second is greater than or equal to the average total documents received per second for the duration of the test, then the load is considered sustainable.</span></span> <span data-ttu-id="905a9-105">如果每个接收的总文档的平均值第二个是大于每秒的测试持续时间内处理的平均总文档则负载不会被视为可持续的并且这将出现的值中的相应增长BizTalk:Message Box: General Counters\Spool 大小计数器。</span><span class="sxs-lookup"><span data-stu-id="905a9-105">If the average total documents received per second is greater than the average total documents processed per second for the duration of the test, then the load is not considered sustainable, and this will be evidenced by a corresponding growth in the value of the BizTalk:Message Box:General Counters\Spool Size counter.</span></span> <span data-ttu-id="905a9-106">随着时间推移，当 BizTalk 服务器应用程序收到多个文档不是它可以处理，未处理的文档将累积在 MessageBox 数据库中，将最终引入限制条件，并大幅降低性能BizTalk Server 应用程序。</span><span class="sxs-lookup"><span data-stu-id="905a9-106">Over time, when a BizTalk Server application receives more documents than it can process, the unprocessed documents will accumulate in the MessageBox database, which will eventually induce a throttling condition and significantly degrade the performance of the BizTalk Server application.</span></span>  
  
## <a name="configure-the-load-test-with-a-step-load-pattern-appropriate-for-your-application"></a><span data-ttu-id="905a9-107">使用分级负载模式适用于你的应用程序配置负载测试</span><span class="sxs-lookup"><span data-stu-id="905a9-107">Configure the Load Test with a Step Load Pattern Appropriate for your Application</span></span>  
 <span data-ttu-id="905a9-108">按照本主题中的步骤[步骤 3： 创建负载测试对执行多个单元测试同时](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md)创建负载测试使用分级负载模式。</span><span class="sxs-lookup"><span data-stu-id="905a9-108">Follow the steps in the topic [Step 3: Create a Load Test to Perform Multiple Unit Tests Simultaneously](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md) to create a load test that uses a step load pattern.</span></span> <span data-ttu-id="905a9-109">影响及时处理文档 BizTalk 服务器应用程序的能力的因素包括：</span><span class="sxs-lookup"><span data-stu-id="905a9-109">Factors that impact the ability of the BizTalk Server Application to process documents in a timely fashion include:</span></span>  
  
-   <span data-ttu-id="905a9-110">**你的组中的 BizTalk Server 计算机的数量**-其他 BizTalk 服务器提供额外的处理能力。</span><span class="sxs-lookup"><span data-stu-id="905a9-110">**Number of BizTalk Server computers in your group** - Additional BizTalk Servers provide additional processing ability.</span></span>  
  
-   <span data-ttu-id="905a9-111">**正在处理的消息大小**-更大的消息需要额外的处理资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-111">**Size of the messages being processed** - Larger messages require additional processing resources.</span></span>  
  
-   <span data-ttu-id="905a9-112">**文档映射量执行**-映射都要求额外的处理资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-112">**Amount of document mapping performed** -Mapping requires additional processing resources.</span></span>  
  
-   <span data-ttu-id="905a9-113">**接收或发送应用程序所需的管道**。</span><span class="sxs-lookup"><span data-stu-id="905a9-113">**Receive or send pipelines required by the application**.</span></span> <span data-ttu-id="905a9-114">-复杂的管道需要额外的处理资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-114">- Complex pipelines require additional processing resources.</span></span>  
  
-   <span data-ttu-id="905a9-115">**适配器和/或 BizTalk Server 应用程序使用的快捷键**– 某些适配器和/或快捷键需要比其他更多处理资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-115">**Adapters and/or Accelerators used by the BizTalk Server application** – Some adapters and/or accelerators require more processing resources than others.</span></span>  
  
-   <span data-ttu-id="905a9-116">**所需的消息跟踪量**– 消息跟踪，则占用大量资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-116">**Amount of Message tracking required** – Message tracking is resource intensive.</span></span>  
  
-   <span data-ttu-id="905a9-117">**在 BizTalk Server 应用程序中运行的业务流程的数量和复杂度**– 业务流程可以是消耗大量的资源。</span><span class="sxs-lookup"><span data-stu-id="905a9-117">**Number of and complexity of Orchestrations running in the BizTalk Server Application** – Orchestrations can be very resource intensive.</span></span>  
  
 <span data-ttu-id="905a9-118">在配置步骤负载模式测试时，修改为指定的值**开始用户计数**和**最大用户计数**以确保为开始用户计数可轻松地为指定的消息数由 BizTalk Server 应用程序这段时间和同样，最大用户计数为指定的消息数高于 BizTalk Server 应用程序可以处理随着时间的推移。</span><span class="sxs-lookup"><span data-stu-id="905a9-118">When configuring the Step Load Pattern Test, modify the values specified for **Start user count** and **Maximum user count** to ensure that the number of messages specified for Start user count can be easily handled by the BizTalk Server application over time and likewise, the number of messages specified for Maximum user count is more than the BizTalk Server application can handle over time.</span></span> <span data-ttu-id="905a9-119">请参阅[添加负载测试和配置的负载测试方案、 计数器集和运行设置](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_StepLoadTest)有关编辑负载测试的负载模式设置信息。</span><span class="sxs-lookup"><span data-stu-id="905a9-119">See [Add a Load Test and Configure the Load Test Scenario, Counter Sets, and Run Settings](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_StepLoadTest) for information about editing the load pattern settings for the load test.</span></span>  
  
## <a name="ensure-that-the-correct-test-settings-are-used-for-the-step-pattern-load-test"></a><span data-ttu-id="905a9-120">确保为步骤模式负载测试使用正确的测试设置</span><span class="sxs-lookup"><span data-stu-id="905a9-120">Ensure that the Correct Test Settings are Used for the Step Pattern Load Test</span></span>  
 <span data-ttu-id="905a9-121">配置负载测试，以使用**测试设置**在中创建[将测试设置文件添加到解决方案来运行测试和远程收集数据](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_TestSettings)。</span><span class="sxs-lookup"><span data-stu-id="905a9-121">Configure the Load Test to use the **Test Settings** that you created in [Add A Test Settings File to the Solution to Run Tests and Collect Data Remotely](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_TestSettings).</span></span>  
  
## <a name="configure-the-load-test-with-the-appropriate-performance-counters-and-run-the-step-pattern-load-test"></a><span data-ttu-id="905a9-122">为负载测试配置使用适当的性能计数器和运行步骤模式负载测试</span><span class="sxs-lookup"><span data-stu-id="905a9-122">Configure the Load Test with the Appropriate Performance Counters and run the Step Pattern Load Test</span></span>  
 <span data-ttu-id="905a9-123">按照中的步骤[添加自定义计数器集到度量值 BizTalk Server 关键绩效指标 (KPI)](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_BTSCounters)添加必要的 BizTalk Server 性能计数器用于测量 BizTalk Server 的性能应用程序，并确定在哪个点 BizTalk Server 应用程序是否不再能够维护创建负载测试代理的消息负载。</span><span class="sxs-lookup"><span data-stu-id="905a9-123">Follow the steps in [Add a Custom Counter Set to Measure BizTalk Server Key Performance Indicators (KPI)](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_BTSCounters) to add the necessary BizTalk Server performance counters which can be used to measure the performance of the BizTalk Server Application and determine at what point the BizTalk Server Application is no longer able to maintain the message load created by the Load Test Agents.</span></span> <span data-ttu-id="905a9-124">这将通过显示 BizTalk:Message Box: General Counters\Spool 大小计数器更多价值的假脱机表中的消息的积压工作的累算出现。</span><span class="sxs-lookup"><span data-stu-id="905a9-124">This will be evidenced by the accrual of a backlog of messages in the Spool table as seen by an increased value for the BizTalk:Message Box:General Counters\Spool Size counter.</span></span> <span data-ttu-id="905a9-125">如果此计数器的值开始显著增加然后你可能已超过 MST BizTalk 服务器应用程序。</span><span class="sxs-lookup"><span data-stu-id="905a9-125">If the value for this counter begins to increase significantly then you have likely exceeded the MST of your BizTalk Server Application.</span></span> <span data-ttu-id="905a9-126">当您确定此时 BizTalk Server 应用程序不再能够处理多条消息为接收，记下文档 received/Sec 发生此情况时的消息数。</span><span class="sxs-lookup"><span data-stu-id="905a9-126">Once you have determined the number of messages at which the BizTalk Server Application is no longer able to process as many messages as it is receiving, make a note of the Documents received/Sec when this occurs.</span></span> <span data-ttu-id="905a9-127">务必要记下此值，因为主题[步骤 6： 执行常量负载模式测试验证最大可持续吞吐量](../technical-guides/step-6-complete-load-pattern-tests-to-verify-maximum-sustainable-throughput.md)将介绍如何运行"常量用户计数"值常量模式负载测试这就是某种程度上小于最大可持续文档秒接收的值。</span><span class="sxs-lookup"><span data-stu-id="905a9-127">It is important to make a note of this value because the topic [Step 6: Perform Constant Load Pattern Tests to Verify Maximum Sustainable Throughput](../technical-guides/step-6-complete-load-pattern-tests-to-verify-maximum-sustainable-throughput.md) will describe how to run a constant pattern load test with a “Constant User Count” value that is somewhat smaller than the maximum sustainable Documents received/Sec value.</span></span> <span data-ttu-id="905a9-128">这样做是为了验证 BizTalk Server 应用程序能够随着时间的推移处理这个数量的消息。</span><span class="sxs-lookup"><span data-stu-id="905a9-128">This is done to verify that the BizTalk Server Application is capable of processing this number of messages over time.</span></span> <span data-ttu-id="905a9-129">若要查看的计数器集的值，首先通过右击测试名称 (例如 BTS_Messaging_Step) 启动负载测试，然后单击**运行测试**菜单选项。</span><span class="sxs-lookup"><span data-stu-id="905a9-129">To view values for counter sets, first start the load test by right-clicking the test name (e.g. BTS_Messaging_Step) and then click the **Run Test** menu option.</span></span> <span data-ttu-id="905a9-130">性能计数器进行了初始化，在负载测试开始后，Visual Studio 会自动切换到窗口使你可以同时显示从 1 到 4 的关系图的关系图窗口的焦点。</span><span class="sxs-lookup"><span data-stu-id="905a9-130">After Performance counters are initialized and the load test begins, Visual Studio will automatically switch focus to the Graphs window which allows you to display from 1 to 4 graphs simultaneously.</span></span> <span data-ttu-id="905a9-131">如果你感兴趣只能查看为关键绩效指标的主要中定义[添加自定义计数器集到度量值 BizTalk Server 关键绩效指标 (KPI)](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_BTSCounters)，单击**面板**下拉列表中从负载测试菜单列表并选择的选项**一个面板**。</span><span class="sxs-lookup"><span data-stu-id="905a9-131">If you are primarily interested in only viewing key performance indicators, as defined in [Add a Custom Counter Set to Measure BizTalk Server Key Performance Indicators (KPI)](../technical-guides/step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously.md#BKMK_BTSCounters), click the **Panels** dropdown list from the Load test menu and select the option for **One Panel**.</span></span> <span data-ttu-id="905a9-132">然后单击图表并选择顶部的下拉列表**关键指标**实时显示关键性能指标所指示的值。</span><span class="sxs-lookup"><span data-stu-id="905a9-132">Then click the drop-down list at the top of the chart and select **Key Indicators** to display values for the key Performance indicators in real time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="905a9-133">因为某些默认计数器值将显示在**关键指标**图形，并因为你可能希望显示添加到你的自定义计数器集的计数器值，你可能想要通过手动删除每个启动中显示的计数器**关键指标**图形，然后手动从自定义计数器集添加计数器。</span><span class="sxs-lookup"><span data-stu-id="905a9-133">Because certain default counter values will be displayed in the **Key Indicators** graph and because you will probably want to display counter values that you added to your custom counter set, you may want to start by manually deleting each of the counters displayed in the **Key Indicators** graph and then manually add counters from your custom counter set(s).</span></span> <span data-ttu-id="905a9-134">例如，至少，你想要至少将计数器添加下表中到关系图中，以确定 BizTalk Server 环境如何很好地处理负载，并可能会出现任何瓶颈：</span><span class="sxs-lookup"><span data-stu-id="905a9-134">For example, at the least, you would want to add at least the counters in the table below to your graph to determine how well the BizTalk Server environment is handling the load, and where any bottlenecks may be occurring:</span></span>  
  
|<span data-ttu-id="905a9-135">计数器类别</span><span class="sxs-lookup"><span data-stu-id="905a9-135">Counter Category</span></span>|<span data-ttu-id="905a9-136">计数器</span><span class="sxs-lookup"><span data-stu-id="905a9-136">Counter</span></span>|<span data-ttu-id="905a9-137">实例</span><span class="sxs-lookup"><span data-stu-id="905a9-137">Instance</span></span>|<span data-ttu-id="905a9-138">Computer</span><span class="sxs-lookup"><span data-stu-id="905a9-138">Computer</span></span>|  
|----------------------|-------------|--------------|--------------|  
|<span data-ttu-id="905a9-139">BizTalk:Message Box:General Counters </span><span class="sxs-lookup"><span data-stu-id="905a9-139">BizTalk:Message Box:General Counters</span></span>|<span data-ttu-id="905a9-140">假脱机大小</span><span class="sxs-lookup"><span data-stu-id="905a9-140">Spool Size</span></span>|<span data-ttu-id="905a9-141">*BizTalk Server 消息框数据库*:*保存 BizTalk Server 消息框数据库的 SQL Server 实例*</span><span class="sxs-lookup"><span data-stu-id="905a9-141">*BizTalk Server Message Box database*:*SQL Server Instance that houses the BizTalk Server Message Box database*</span></span>|<span data-ttu-id="905a9-142">任何组中具有 BizTalk Server 管理控制台的 BizTalk 服务器安装。</span><span class="sxs-lookup"><span data-stu-id="905a9-142">Any BizTalk Server in the group with the BizTalk Server Administration Console installed.</span></span>|  
|<span data-ttu-id="905a9-143">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-143">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-144">Documents received/Sec</span><span class="sxs-lookup"><span data-stu-id="905a9-144">Documents received/Sec</span></span>|<span data-ttu-id="905a9-145">RxHost （或接收主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-145">RxHost (or name of the receive host)</span></span>|<span data-ttu-id="905a9-146">*BizTalk Server 组中的 BizTalk Server 计算机 #1*</span><span class="sxs-lookup"><span data-stu-id="905a9-146">*BizTalk Server Computer#1 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-147">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-147">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-148">Documents received/Sec</span><span class="sxs-lookup"><span data-stu-id="905a9-148">Documents received/Sec</span></span>|<span data-ttu-id="905a9-149">RxHost （或接收主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-149">RxHost (or name of the receive host)</span></span>|<span data-ttu-id="905a9-150">*BizTalk Server 组中的 BizTalk Server 计算机 #2*</span><span class="sxs-lookup"><span data-stu-id="905a9-150">*BizTalk Server Computer#2 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-151">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-151">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-152">Documents received/Sec</span><span class="sxs-lookup"><span data-stu-id="905a9-152">Documents received/Sec</span></span>|<span data-ttu-id="905a9-153">RxHost （或接收主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-153">RxHost (or name of the receive host)</span></span>|<span data-ttu-id="905a9-154">*BizTalk Server 组中的 BizTalk Server 计算机 #n*</span><span class="sxs-lookup"><span data-stu-id="905a9-154">*BizTalk Server Computer#n in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-155">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-155">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-156">处理的文档数/秒</span><span class="sxs-lookup"><span data-stu-id="905a9-156">Documents processed/Sec</span></span>|<span data-ttu-id="905a9-157">TxHost （或发送主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-157">TxHost (or name of the send host)</span></span>|<span data-ttu-id="905a9-158">*BizTalk Server 组中的 BizTalk Server 计算机 #1*</span><span class="sxs-lookup"><span data-stu-id="905a9-158">*BizTalk Server Computer#1 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-159">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-159">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-160">处理的文档数/秒</span><span class="sxs-lookup"><span data-stu-id="905a9-160">Documents processed/Sec</span></span>|<span data-ttu-id="905a9-161">TxHost （或发送主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-161">TxHost (or name of the send host)</span></span>|<span data-ttu-id="905a9-162">*BizTalk Server 组中的 BizTalk Server 计算机 #2*</span><span class="sxs-lookup"><span data-stu-id="905a9-162">*BizTalk Server Computer#2 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-163">BizTalk:Messaging</span><span class="sxs-lookup"><span data-stu-id="905a9-163">BizTalk:Messaging</span></span>|<span data-ttu-id="905a9-164">处理的文档数/秒</span><span class="sxs-lookup"><span data-stu-id="905a9-164">Documents processed/Sec</span></span>|<span data-ttu-id="905a9-165">TxHost （或发送主机的名称）</span><span class="sxs-lookup"><span data-stu-id="905a9-165">TxHost (or name of the send host)</span></span>|<span data-ttu-id="905a9-166">*BizTalk Server 组中的 BizTalk Server 计算机 #n*</span><span class="sxs-lookup"><span data-stu-id="905a9-166">*BizTalk Server Computer#n in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-167">处理器</span><span class="sxs-lookup"><span data-stu-id="905a9-167">Processor</span></span>|<span data-ttu-id="905a9-168">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="905a9-168">% Processor Time</span></span>|<span data-ttu-id="905a9-169">_Total</span><span class="sxs-lookup"><span data-stu-id="905a9-169">_Total</span></span>|<span data-ttu-id="905a9-170">*BizTalk Server 组中的 BizTalk Server 计算机 #1*</span><span class="sxs-lookup"><span data-stu-id="905a9-170">*BizTalk Server Computer#1 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-171">处理器</span><span class="sxs-lookup"><span data-stu-id="905a9-171">Processor</span></span>|<span data-ttu-id="905a9-172">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="905a9-172">% Processor Time</span></span>|<span data-ttu-id="905a9-173">_Total</span><span class="sxs-lookup"><span data-stu-id="905a9-173">_Total</span></span>|<span data-ttu-id="905a9-174">*BizTalk Server 组中的 BizTalk Server 计算机 #2*</span><span class="sxs-lookup"><span data-stu-id="905a9-174">*BizTalk Server Computer#2 in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-175">处理器</span><span class="sxs-lookup"><span data-stu-id="905a9-175">Processor</span></span>|<span data-ttu-id="905a9-176">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="905a9-176">% Processor Time</span></span>|<span data-ttu-id="905a9-177">_Total</span><span class="sxs-lookup"><span data-stu-id="905a9-177">_Total</span></span>|<span data-ttu-id="905a9-178">*BizTalk Server 组中的 BizTalk Server 计算机 #n*</span><span class="sxs-lookup"><span data-stu-id="905a9-178">*BizTalk Server Computer#n in the BizTalk Server Group*</span></span>|  
|<span data-ttu-id="905a9-179">处理器</span><span class="sxs-lookup"><span data-stu-id="905a9-179">Processor</span></span>|<span data-ttu-id="905a9-180">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="905a9-180">% Processor Time</span></span>|<span data-ttu-id="905a9-181">_Total</span><span class="sxs-lookup"><span data-stu-id="905a9-181">_Total</span></span>|<span data-ttu-id="905a9-182">*保存的 BizTalk Server 数据库的 SQL Server 实例*</span><span class="sxs-lookup"><span data-stu-id="905a9-182">*SQL Server instance that houses the BizTalk Server databases*</span></span>|