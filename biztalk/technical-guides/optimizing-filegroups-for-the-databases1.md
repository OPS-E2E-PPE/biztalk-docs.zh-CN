---
title: 优化数据库文件组 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f7dbed4d-95d6-4a41-a69e-737a6f2f5a82
caps.latest.revision: 8
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e48e475d3f8daf36cb6860393a4c4ff031a10e5a
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37003654"
---
# <a name="optimizing-filegroups-for-the-databases"></a><span data-ttu-id="16390-102">优化文件组的数据库</span><span class="sxs-lookup"><span data-stu-id="16390-102">Optimizing Filegroups for the Databases</span></span>
<span data-ttu-id="16390-103">文件输入/输出 (I/O) 争用通常是限制因素或瓶颈，在生产 BizTalk Server 环境中。</span><span class="sxs-lookup"><span data-stu-id="16390-103">File input/output (I/O) contention is frequently a limiting factor, or bottleneck, in a production BizTalk Server environment.</span></span> <span data-ttu-id="16390-104">BizTalk Server 是一个非常数据库密集型应用程序和 BizTalk Server 使用的 SQL Server 数据库又是大量占用非常文件 I/O。</span><span class="sxs-lookup"><span data-stu-id="16390-104">BizTalk Server is a very database intensive application and in turn, the SQL Server database used by BizTalk Server is very file I/O intensive.</span></span>  
  
 <span data-ttu-id="16390-105">本主题介绍如何以最佳方式使用的文件和文件组功能的 SQL Server 以最小化的匹配项的文件 I/O 争用和提高 BizTalk Server 解决方案的整体性能。</span><span class="sxs-lookup"><span data-stu-id="16390-105">This topic describes how to make optimal use of the files and filegroups feature of SQL Server to minimize the occurrence of file I/O contention and improve the overall performance of a BizTalk Server solution.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="16390-106">概述</span><span class="sxs-lookup"><span data-stu-id="16390-106">Overview</span></span>  
 <span data-ttu-id="16390-107">每个 BizTalk Server 解决方案将最终会遇到文件 I/O 争用，如增加吞吐量。</span><span class="sxs-lookup"><span data-stu-id="16390-107">Every BizTalk Server solution will eventually encounter file I/O contention as throughput is increased.</span></span> <span data-ttu-id="16390-108">I/O 子系统或存储引擎是任意关系数据库的关键组件。</span><span class="sxs-lookup"><span data-stu-id="16390-108">The I/O subsystem, or storage engine, is a key component of any relational database.</span></span> <span data-ttu-id="16390-109">成功的数据库实现通常要求在项目的初期阶段进行仔细的规划。</span><span class="sxs-lookup"><span data-stu-id="16390-109">A successful database implementation typically requires careful planning at the early stages of a project.</span></span> <span data-ttu-id="16390-110">此规划应考虑下列事项：</span><span class="sxs-lookup"><span data-stu-id="16390-110">This planning should include consideration of the following issues:</span></span>  
  
- <span data-ttu-id="16390-111">使用哪种类型的磁盘硬件，如 RAID（独立磁盘冗余阵列）设备。</span><span class="sxs-lookup"><span data-stu-id="16390-111">What type of disk hardware to use, such as RAID (redundant array of independent disks) devices.</span></span> 
  
- <span data-ttu-id="16390-112">如何使用文件和文件组的磁盘上的数据分配。</span><span class="sxs-lookup"><span data-stu-id="16390-112">How to apportion data on the disks using files and filegroups.</span></span> <span data-ttu-id="16390-113">有关使用 SQL Server 中的文件和文件组的详细信息，请参阅[数据库文件和文件组](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups)。</span><span class="sxs-lookup"><span data-stu-id="16390-113">For more information about using files and filegroups in SQL Server, see [Database Files and Filegroups](https://docs.microsoft.com/sql/relational-databases/databases/database-files-and-filegroups).</span></span>
  
- <span data-ttu-id="16390-114">实现用于访问数据时提高性能的最佳索引设计。</span><span class="sxs-lookup"><span data-stu-id="16390-114">Implementing the optimal index design for improving performance when accessing data.</span></span> <span data-ttu-id="16390-115">关于设计索引的详细信息，请参阅[设计索引](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide)。</span><span class="sxs-lookup"><span data-stu-id="16390-115">For more information about designing indexes, see [Designing Indexes](https://docs.microsoft.com/sql/relational-databases/sql-server-index-design-guide).</span></span>
  
- <span data-ttu-id="16390-116">如何设置 SQL Server 以获得最佳性能的配置参数。</span><span class="sxs-lookup"><span data-stu-id="16390-116">How to set SQL Server configuration parameters for optimal performance.</span></span> <span data-ttu-id="16390-117">为 SQL Server 设置最佳的配置参数的详细信息，请参阅[服务器配置选项](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server)。</span><span class="sxs-lookup"><span data-stu-id="16390-117">For more information about setting optimal configuration parameters for SQL Server, see [Server Configuration Options](https://docs.microsoft.com/sql/database-engine/configure-windows/server-configuration-options-sql-server).</span></span> 
  
  <span data-ttu-id="16390-118">BizTalk Server 的主要设计目标之一是确保消息**永远不会**丢失。</span><span class="sxs-lookup"><span data-stu-id="16390-118">One of the primary design goals of BizTalk Server is to ensure that a message is **never** lost.</span></span> <span data-ttu-id="16390-119">为了缓解问题消息丢失的可能性，消息通常会写入到 MessageBox 数据库，处理消息。</span><span class="sxs-lookup"><span data-stu-id="16390-119">In order to mitigate the possibility of message loss, messages are frequently written to the MessageBox database as the message is processed.</span></span> <span data-ttu-id="16390-120">当业务流程处理消息时，会将消息写入到 MessageBox 数据库在业务流程中每个暂留点。</span><span class="sxs-lookup"><span data-stu-id="16390-120">When messages are processed by an Orchestration, the message is written to the MessageBox database at every persistence point in the orchestration.</span></span> <span data-ttu-id="16390-121">这些持久化点会导致 MessageBox，以将消息和相关的状态写入物理磁盘。</span><span class="sxs-lookup"><span data-stu-id="16390-121">These persistence points cause the MessageBox to write the message and related state to physical disk.</span></span> <span data-ttu-id="16390-122">在更高的吞吐量，此持久性相当大的磁盘争用情况，并可能会成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="16390-122">At higher throughputs, this persistence can result in considerable disk contention and can potentially become a bottleneck.</span></span>  
  
  <span data-ttu-id="16390-123">进行最佳使用的文件和 SQL Server 中的文件组功能已被证实将有效地解决文件 IO 瓶颈并改进 BizTalk Server 解决方案中的整体性能。</span><span class="sxs-lookup"><span data-stu-id="16390-123">Making optimal use of the files and filegroups feature in SQL Server has been shown to effectively address File IO bottlenecks and improve overall performance in BizTalk Server solutions.</span></span> <span data-ttu-id="16390-124">仅应由有经验的 SQL Server 数据库管理员和 BizTalk Server 数据库已正确备份仅后所有完成这种优化。</span><span class="sxs-lookup"><span data-stu-id="16390-124">This optimization should only be done by an experienced SQL Server database administrator and only after all BizTalk Server databases have been properly backed up.</span></span> <span data-ttu-id="16390-125">应在 BizTalk Server 环境中的所有 SQL Server 计算机上执行此优化。</span><span class="sxs-lookup"><span data-stu-id="16390-125">This optimization should be performed on all SQL Server computers in the BizTalk Server environment.</span></span>  
  
  <span data-ttu-id="16390-126">若要提高数据库性能，因为此功能可让数据库将创建跨多个磁盘的多个磁盘控制器或 RAID （独立磁盘冗余阵列） 系统，可以利用 SQL Server 文件和文件组。</span><span class="sxs-lookup"><span data-stu-id="16390-126">SQL Server files and filegroups can be utilized to improve database performance because this functionality allows a database be created across multiple disks, multiple disk controllers, or RAID (redundant array of independent disks) systems.</span></span> <span data-ttu-id="16390-127">例如，如果计算机上有四个磁盘，那么可以创建一个由三个数据文件和一个日志文件组成的数据库，每个磁盘上放置一个文件。</span><span class="sxs-lookup"><span data-stu-id="16390-127">For example, if your computer has four disks, you can create a database that is made up of three data files and one log file, with one file on each disk.</span></span> <span data-ttu-id="16390-128">访问数据时，四个读/写磁头可以同时访问数据并行。</span><span class="sxs-lookup"><span data-stu-id="16390-128">As data is accessed, four read/write heads can concurrently access the data in parallel.</span></span> <span data-ttu-id="16390-129">这极大地加快数据库操作。</span><span class="sxs-lookup"><span data-stu-id="16390-129">This speeds up database operations significantly.</span></span> <span data-ttu-id="16390-130">有关实现为 SQL Server 磁盘硬件解决方案的详细信息，请参阅"数据库的性能"SQL Server 联机丛书中位于[ http://go.microsoft.com/fwlink/?LinkID=71419 ](http://go.microsoft.com/fwlink/?LinkID=71419)。</span><span class="sxs-lookup"><span data-stu-id="16390-130">For more information about implementing hardware solutions for SQL Server disks, see “Database Performance” in the SQL Server Books online at [http://go.microsoft.com/fwlink/?LinkID=71419](http://go.microsoft.com/fwlink/?LinkID=71419).</span></span>  
  
  <span data-ttu-id="16390-131">此外，文件和文件组允许数据布局，因为可以在特定的文件组中创建表。</span><span class="sxs-lookup"><span data-stu-id="16390-131">Additionally, files and filegroups enable data placement, because tables can be created in specific filegroups.</span></span> <span data-ttu-id="16390-132">这提高了性能，因为给定表的所有文件 I/O 可以都定向到特定的磁盘。</span><span class="sxs-lookup"><span data-stu-id="16390-132">This improves performance, because all file I/O for a given table can be directed at a specific disk.</span></span> <span data-ttu-id="16390-133">例如，经常使用的表可以放在位于一个磁盘上的文件组中的文件，并且在数据库中的其他不常访问的表可以位于另一个文件，位于第二个磁盘上的组中的不同文件。</span><span class="sxs-lookup"><span data-stu-id="16390-133">For example, a heavily used table can be placed on a file in a filegroup, located on one disk, and the other less heavily accessed tables in the database can be located on different files in another filegroup, located on a second disk.</span></span>  
  
  <span data-ttu-id="16390-134">中相当详细地讨论了文件 IO 瓶颈[数据库层的瓶颈](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="16390-134">File IO bottlenecks are discussed in considerable detail in [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span> <span data-ttu-id="16390-135">文件 I/O (磁盘 I/O) 是一个瓶颈的最常见的指示符"物理磁盘： Average Disk Queue Length"计数器的值。</span><span class="sxs-lookup"><span data-stu-id="16390-135">The most common indicator that File I/O (Disk I/O) is a bottleneck is the value of the “Physical Disk:Average Disk Queue Length” counter.</span></span> <span data-ttu-id="16390-136">当"物理磁盘： Average Disk Queue Length"计数器的值大于约 3 在任何 SQL 服务器上任何给定的磁盘时，然后文件 I/O 可能是瓶颈。</span><span class="sxs-lookup"><span data-stu-id="16390-136">When the value of the “Physical Disk:Average Disk Queue Length” counter is greater than about 3 for any given disk on any of the SQL Servers, then file I/O is likely a bottleneck.</span></span>  
  
  <span data-ttu-id="16390-137">如果将应用文件组的优化不能解决文件 I/O 瓶颈问题，然后它可能需要通过添加额外的物理或 SAN 驱动器增加磁盘子系统的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="16390-137">If applying file or filegroup optimization doesn't resolve a file I/O bottleneck problem, then it may be necessary to increase the throughput of the disk subsystem by adding additional physical or SAN drives.</span></span>  
  
  <span data-ttu-id="16390-138">本主题介绍了如何手动应用文件和文件组的优化，但这些优化也可编写脚本。</span><span class="sxs-lookup"><span data-stu-id="16390-138">This topic describes how to manually apply file and filegroup optimizations but these optimizations can also be scripted.</span></span> <span data-ttu-id="16390-139">在本主题末尾提供了一个示例 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="16390-139">A sample SQL script is provided at the end of this topic.</span></span> <span data-ttu-id="16390-140">请务必注意此脚本需要修改以适应文件、 文件组，以及任何给定的 BizTalk Server 解决方案所使用的 SQL Server 数据库的磁盘配置。</span><span class="sxs-lookup"><span data-stu-id="16390-140">It is important to note that this script would need to be modified to accommodate the file, filegroup, and disk configuration used by the SQL Server database(s) for any given BizTalk Server solution.</span></span>  
  
 
## <a name="databases-created-with-a-default-biztalk-server-configuration"></a><span data-ttu-id="16390-141">使用默认的 BizTalk Server 配置创建的数据库</span><span class="sxs-lookup"><span data-stu-id="16390-141">Databases created with a default BizTalk Server configuration</span></span>  
 <span data-ttu-id="16390-142">具体取决于可能在 SQL Server 中创建多达 13 不同数据库中配置 BizTalk Server 和所有这些数据库的默认文件组中创建时启用功能。</span><span class="sxs-lookup"><span data-stu-id="16390-142">Depending on which features are enabled when configuring BizTalk Server, up to 13 different databases may be created in SQL Server and all of these databases are created in the default file group.</span></span> <span data-ttu-id="16390-143">SQL Server 的默认文件组是主文件组，除非使用 ALTER DATABASE 命令更改默认文件组。</span><span class="sxs-lookup"><span data-stu-id="16390-143">The default filegroup for SQL Server is the PRIMARY filegroup unless the default filegroup is changed by using the ALTER DATABASE command.</span></span> <span data-ttu-id="16390-144">下表列出了配置 BizTalk Server 时，会启用所有功能，如果在 SQL Server 中创建的数据库。</span><span class="sxs-lookup"><span data-stu-id="16390-144">The table below lists the databases that are created in SQL Server if all features are enabled when configuring BizTalk Server.</span></span>  
  
### <a name="biztalk-server-databases"></a><span data-ttu-id="16390-145">BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="16390-145">BizTalk Server Databases</span></span>  
  
||||  
|-|-|-|  
|<span data-ttu-id="16390-146">**“数据库”**</span><span class="sxs-lookup"><span data-stu-id="16390-146">**Database**</span></span>|<span data-ttu-id="16390-147">**默认数据库名称**</span><span class="sxs-lookup"><span data-stu-id="16390-147">**Default Database Name**</span></span>|<span data-ttu-id="16390-148">**Description**</span><span class="sxs-lookup"><span data-stu-id="16390-148">**Description**</span></span>|  
|<span data-ttu-id="16390-149">配置数据库</span><span class="sxs-lookup"><span data-stu-id="16390-149">Configuration database</span></span>|<span data-ttu-id="16390-150">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="16390-150">BizTalkMgmtDb</span></span>|<span data-ttu-id="16390-151">中央元信息存储在 BizTalk Server 组中的 BizTalk Server 的所有实例。</span><span class="sxs-lookup"><span data-stu-id="16390-151">The central meta-information store for all instances of BizTalk Server in the BizTalk Server group.</span></span>|  
|<span data-ttu-id="16390-152">BizTalk MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="16390-152">BizTalk MessageBox database</span></span>|<span data-ttu-id="16390-153">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="16390-153">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="16390-154">存储订阅谓词。</span><span class="sxs-lookup"><span data-stu-id="16390-154">Stores subscriptions predicates.</span></span> <span data-ttu-id="16390-155">它是一个主机平台，并使每个 BizTalk Server 主机的队列和状态表。</span><span class="sxs-lookup"><span data-stu-id="16390-155">It is a host platform, and keeps queues and state tables for each BizTalk Server host.</span></span> <span data-ttu-id="16390-156">MessageBox 数据库还存储消息和消息属性。</span><span class="sxs-lookup"><span data-stu-id="16390-156">The MessageBox database also stores the messages and message properties.</span></span>|  
|<span data-ttu-id="16390-157">BizTalk 跟踪数据库</span><span class="sxs-lookup"><span data-stu-id="16390-157">BizTalk Tracking database</span></span>|<span data-ttu-id="16390-158">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="16390-158">BizTalkDTADb</span></span>|<span data-ttu-id="16390-159">存储业务和运行状况监视 BizTalk Server 跟踪引擎所跟踪的数据。</span><span class="sxs-lookup"><span data-stu-id="16390-159">Stores business and health monitoring data tracked by the BizTalk Server tracking engine.</span></span>|  
|<span data-ttu-id="16390-160">BAM 分析数据库</span><span class="sxs-lookup"><span data-stu-id="16390-160">BAM Analysis database</span></span>|<span data-ttu-id="16390-161">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="16390-161">BAMAnalysis</span></span>|<span data-ttu-id="16390-162">保留业务活动的聚合历史数据的 SQL Server Analysis Services 数据库。</span><span class="sxs-lookup"><span data-stu-id="16390-162">SQL Server Analysis Services database that keeps the aggregated historical data for Business Activities.</span></span>|  
|<span data-ttu-id="16390-163">BAM 星型架构数据库</span><span class="sxs-lookup"><span data-stu-id="16390-163">BAM Star Schema database</span></span>|<span data-ttu-id="16390-164">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="16390-164">BAMStarSchema</span></span>|<span data-ttu-id="16390-165">将转换为进行 OLAP 处理从业务活动监视收集的数据。</span><span class="sxs-lookup"><span data-stu-id="16390-165">Transforms the data collected from Business Activity Monitoring for OLAP Processing.</span></span> <span data-ttu-id="16390-166">使用 BAM 分析数据库时，此数据库是必需的。</span><span class="sxs-lookup"><span data-stu-id="16390-166">This database is required when using the BAM Analysis database.</span></span>|  
|<span data-ttu-id="16390-167">BAM 主导入数据库</span><span class="sxs-lookup"><span data-stu-id="16390-167">BAM Primary Import database</span></span>|<span data-ttu-id="16390-168">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="16390-168">BAMPrimaryImport</span></span>|<span data-ttu-id="16390-169">活动实例后存储来自业务活动，然后查询的进度和数据的事件。</span><span class="sxs-lookup"><span data-stu-id="16390-169">Stores the events from Business Activities and then queries for the progress and data after activity instances.</span></span> <span data-ttu-id="16390-170">此数据库还会执行实时聚合。</span><span class="sxs-lookup"><span data-stu-id="16390-170">This database also performs real-time aggregations.</span></span>|  
|<span data-ttu-id="16390-171">BAM 存档数据库</span><span class="sxs-lookup"><span data-stu-id="16390-171">BAM Archive database</span></span>|<span data-ttu-id="16390-172">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="16390-172">BAMArchive</span></span>|<span data-ttu-id="16390-173">存储订阅谓词。</span><span class="sxs-lookup"><span data-stu-id="16390-173">Stores subscription predicates.</span></span> <span data-ttu-id="16390-174">BAM 存档数据库最大程度减少 BAM 主导入数据库中的业务活动数据的累计。</span><span class="sxs-lookup"><span data-stu-id="16390-174">The BAM Archive database minimizes the accumulation of Business Activity data in the BAM Primary Import database.</span></span>|  
|<span data-ttu-id="16390-175">SSO 数据库</span><span class="sxs-lookup"><span data-stu-id="16390-175">SSO database</span></span>|<span data-ttu-id="16390-176">SSODB</span><span class="sxs-lookup"><span data-stu-id="16390-176">SSODB</span></span>|<span data-ttu-id="16390-177">安全地存储配置信息的接收位置。</span><span class="sxs-lookup"><span data-stu-id="16390-177">Securely stores the configuration information for receive locations.</span></span> <span data-ttu-id="16390-178">将信息存储为 SSO 关联应用程序，以及所有关联应用程序的加密的用户凭据。</span><span class="sxs-lookup"><span data-stu-id="16390-178">Stores information for SSO affiliate applications, as well as the encrypted user credentials to all the affiliate applications.</span></span>|  
|<span data-ttu-id="16390-179">规则引擎数据库</span><span class="sxs-lookup"><span data-stu-id="16390-179">Rule Engine database</span></span>|<span data-ttu-id="16390-180">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="16390-180">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="16390-181">存储库：</span><span class="sxs-lookup"><span data-stu-id="16390-181">Repository for:</span></span><br /><br /> <span data-ttu-id="16390-182">-策略，这是一组相关的规则。</span><span class="sxs-lookup"><span data-stu-id="16390-182">-   Policies, which are sets of related rules.</span></span><br /><span data-ttu-id="16390-183">-词汇，即是规则中的数据引用的用户友好的特定于域的名称的集合。</span><span class="sxs-lookup"><span data-stu-id="16390-183">-   Vocabularies, which are collections of user-friendly, domain-specific names for data references in rules.</span></span>|  
|<span data-ttu-id="16390-184">跟踪分析服务器管理数据库</span><span class="sxs-lookup"><span data-stu-id="16390-184">Tracking Analysis Server Administration database</span></span>|<span data-ttu-id="16390-185">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="16390-185">BizTalkAnalysisDb</span></span>|<span data-ttu-id="16390-186">存储业务和运行状况监视 OLAP 多维数据集。</span><span class="sxs-lookup"><span data-stu-id="16390-186">Stores both business and health monitoring OLAP cubes.</span></span>|  
  
## <a name="separation-of-data-files-and-log-files"></a><span data-ttu-id="16390-187">分离的数据文件和日志文件</span><span class="sxs-lookup"><span data-stu-id="16390-187">Separation of data files and log files</span></span>  
 <span data-ttu-id="16390-188">如上文所述，默认的 BizTalk Server 配置 MessageBox 数据库将置于默认文件组中的一个文件中。</span><span class="sxs-lookup"><span data-stu-id="16390-188">As noted above, a default BizTalk Server configuration places the MessageBox Database into a single file in the default filegroup.</span></span> <span data-ttu-id="16390-189">默认情况下，MessageBox 数据库的数据和事务日志放置在相同的驱动器和路径。</span><span class="sxs-lookup"><span data-stu-id="16390-189">By default, the data and transaction logs for the MessageBox database are placed on the same drive and path.</span></span> <span data-ttu-id="16390-190">这样做是为了适应单磁盘系统。</span><span class="sxs-lookup"><span data-stu-id="16390-190">This is done to accommodate systems with a single disk.</span></span> <span data-ttu-id="16390-191">单个文件/文件组/磁盘配置**不是最佳选择**在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="16390-191">A single file/filegroup/disk configuration is **not optimal** in a production environment.</span></span> <span data-ttu-id="16390-192">为了获得最佳性能，数据文件和日志文件应放置在不同的磁盘上。</span><span class="sxs-lookup"><span data-stu-id="16390-192">For optimal performance, the data files and log files should be placed on separate disks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="16390-193">日志文件不包括在文件组内。</span><span class="sxs-lookup"><span data-stu-id="16390-193">Log files are never part of a filegroup.</span></span> <span data-ttu-id="16390-194">日志空间与数据空间分开管理。</span><span class="sxs-lookup"><span data-stu-id="16390-194">Log space is managed separately from data space.</span></span>  
  
## <a name="the-8020-rule-of-distributing-biztalk-server-databases"></a><span data-ttu-id="16390-195">将 BizTalk Server 数据库分发的 80/20 规则</span><span class="sxs-lookup"><span data-stu-id="16390-195">The 80/20 rule of distributing BizTalk Server databases</span></span>  
 <span data-ttu-id="16390-196">在大多数 BizTalk Server 解决方案中，由于磁盘 I/O 争用或数据库争用的主要来源是争用的 BizTalk Server MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="16390-196">The main source of contention in most BizTalk Server solutions, either because of disk I/O contention or database contention, is the BizTalk Server MessageBox database.</span></span> <span data-ttu-id="16390-197">这是在单个和多 MessageBox 的情况下，则返回 true。</span><span class="sxs-lookup"><span data-stu-id="16390-197">This is true in both single and multi-MessageBox scenarios.</span></span> <span data-ttu-id="16390-198">它有理由假定 80%的值的分布 BizTalk 数据库，将派生自优化的 MessageBox 数据文件和日志文件。</span><span class="sxs-lookup"><span data-stu-id="16390-198">It is reasonable to assume that as much as 80% of the value of distributing BizTalk databases will be derived from optimizing the MessageBox data files and log file.</span></span> <span data-ttu-id="16390-199">下面详细介绍了在示例方案侧重于优化 MessageBox 数据库的数据文件。</span><span class="sxs-lookup"><span data-stu-id="16390-199">The sample scenario detailed below is focused on optimizing the data files for a MessageBox database.</span></span> <span data-ttu-id="16390-200">这些然后可以执行步骤的其他数据库根据需要例如，如果解决方案需要大量跟踪，则还可以优化跟踪数据库。</span><span class="sxs-lookup"><span data-stu-id="16390-200">These steps can then be followed for other databases as needed, for example, if the solution requires extensive tracking, then the Tracking database can also be optimized.</span></span>  
  
## <a name="manually-adding-files-to-the-messagebox-database-step-by-step"></a><span data-ttu-id="16390-201">手动将文件添加到 MessageBox 数据库，分步</span><span class="sxs-lookup"><span data-stu-id="16390-201">Manually adding files to the MessageBox database, step-by-step</span></span>  
 <span data-ttu-id="16390-202">本部分介绍可手动将文件添加到 MessageBox 数据库的步骤。</span><span class="sxs-lookup"><span data-stu-id="16390-202">This section describes the steps that can be followed to manually add files to the MessageBox database.</span></span> <span data-ttu-id="16390-203">在此示例中添加三个文件组，然后将文件添加到每个文件组，以跨多个磁盘为 MessageBox 分发文件。</span><span class="sxs-lookup"><span data-stu-id="16390-203">In this example three filegroups are added and then a file is added to each filegroup to distribute the files for the MessageBox across multiple disks.</span></span>   
  
> [!NOTE]  
>  <span data-ttu-id="16390-204">为了完成本指南中的性能测试，通过使用将作为 BizTalk Server 性能优化指南的一部分发布的脚本优化了文件组。</span><span class="sxs-lookup"><span data-stu-id="16390-204">For purposes of the performance testing done for this guide, filegroups were optimized through the use of a script which will be published as part of the BizTalk Server Performance Optimizations Guide.</span></span> <span data-ttu-id="16390-205">出于参考目的提供了下面的步骤。</span><span class="sxs-lookup"><span data-stu-id="16390-205">The steps below are provided for reference purposes only.</span></span>  
  
### <a name="manually-adding-files-to-the-messagebox-database-on-sql-server"></a><span data-ttu-id="16390-206">手动将文件添加到 SQL Server 上的 MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="16390-206">Manually adding files to the MessageBox database on SQL Server</span></span>
  
1. <span data-ttu-id="16390-207">打开**SQL Server Management Studio**以显示**连接到服务器**对话框。</span><span class="sxs-lookup"><span data-stu-id="16390-207">Open **SQL Server Management Studio** to display the **Connect to Server** dialog box.</span></span>  
  
     <span data-ttu-id="16390-208">![SQL Server 管理登录屏幕](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span><span class="sxs-lookup"><span data-stu-id="16390-208">![SQL Server Administration login screen](../technical-guides/media/641a03f4-362c-4dde-8c9d-ac313d8881e3.gif "641a03f4-362c-4dde-8c9d-ac313d8881e3")</span></span>  
  
2.  <span data-ttu-id="16390-209">在中**服务器名称**字段**连接到服务器**对话框中，输入包含 BizTalk Server MessageBox 数据库的 SQL Server 实例的名称，然后单击**连接**按钮以显示**Microsoft SQL Server Management Studio**对话框。</span><span class="sxs-lookup"><span data-stu-id="16390-209">In the **Server name** field of the **Connect to Server** dialog box, enter the name of the SQL Server instance that houses the BizTalk Server MessageBox databases, and then click the **Connect** button to display the **Microsoft SQL Server Management Studio** dialog box.</span></span>  
  
     <span data-ttu-id="16390-210">在中**对象资源管理器**窗格中的 SQL Server Management Studio 中，展开**数据库**若要查看数据库的 SQL Server 实例。</span><span class="sxs-lookup"><span data-stu-id="16390-210">In the **Object Explorer** pane of SQL Server Management Studio, expand **Databases** to view the databases for this instance of SQL Server.</span></span>  
  
     <span data-ttu-id="16390-211">![SQL Server Management Studio、 对象资源管理器](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span><span class="sxs-lookup"><span data-stu-id="16390-211">![SQL Server Management Studio, Object Explorer](../technical-guides/media/81f13912-fedc-48c3-9669-c18863e637b1.gif "81f13912-fedc-48c3-9669-c18863e637b1")</span></span>  
  
3.  <span data-ttu-id="16390-212">右键单击要为其添加文件，然后单击数据库**属性**以显示**数据库属性**数据库对话框。</span><span class="sxs-lookup"><span data-stu-id="16390-212">Right-click the database for which to add the files, and then click **Properties** to display the **Database Properties** dialog box for the database.</span></span>  
  
     <span data-ttu-id="16390-213">![SQL Server 数据库属性对话框](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span><span class="sxs-lookup"><span data-stu-id="16390-213">![SQL Server Database Properties dialog box](../technical-guides/media/82ae7c11-5b3a-4312-876c-70876abdd65c.gif "82ae7c11-5b3a-4312-876c-70876abdd65c")</span></span>  
  
4.  <span data-ttu-id="16390-214">在中**数据库属性**对话框中，选择**文件组**页。</span><span class="sxs-lookup"><span data-stu-id="16390-214">In the **Database Properties** dialog box, select the **Filegroups** page.</span></span> <span data-ttu-id="16390-215">单击**添加**按钮以创建 BizTalkMsgBoxDb 数据库的其他文件组。</span><span class="sxs-lookup"><span data-stu-id="16390-215">Click the **Add** button to create additional filegroups for the BizTalkMsgBoxDb databases.</span></span> <span data-ttu-id="16390-216">在以下示例中，添加三个其他文件组。</span><span class="sxs-lookup"><span data-stu-id="16390-216">In the example below, three additional filegroups are added.</span></span>  
  
     <span data-ttu-id="16390-217">![SQL Server，向数据库添加文件组](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span><span class="sxs-lookup"><span data-stu-id="16390-217">![SQL Server, adding filegroups to a database](../technical-guides/media/6be47c0e-06c3-45d9-bce2-a42453da7d19.gif "6be47c0e-06c3-45d9-bce2-a42453da7d19")</span></span>  
  
5.  <span data-ttu-id="16390-218">在 **“数据库属性”** 对话框中，选择 **“文件”** 页。</span><span class="sxs-lookup"><span data-stu-id="16390-218">In the **Database Properties** dialog box, select the **Files** page.</span></span>  
  
     <span data-ttu-id="16390-219">单击**外**按钮以创建要添加到的文件组的其他文件，然后单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="16390-219">Click the **Add** button to create additional files to add to the filegroups, and then click **OK**.</span></span> <span data-ttu-id="16390-220">MessageBox 数据库现在分布在多个磁盘，它将提供性能优势明显超过单个磁盘配置。</span><span class="sxs-lookup"><span data-stu-id="16390-220">The MessageBox database is now distributed across multiple disks, which will provide a significant performance advantage over a single disk configuration.</span></span>  
  
     <span data-ttu-id="16390-221">在下面的示例中，为每个前面创建的文件组创建一个文件和每个文件都放置在单独的磁盘。</span><span class="sxs-lookup"><span data-stu-id="16390-221">In the example below, a file is created for each of the filegroups that were created earlier and each file is placed on a separate disk.</span></span>  
  
     <span data-ttu-id="16390-222">![SQL Server，将文件添加到文件组](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span><span class="sxs-lookup"><span data-stu-id="16390-222">![SQL Server, adding files to a filegroup](../technical-guides/media/d5d5c5df-d483-4f01-8128-f98228de51b9.gif "d5d5c5df-d483-4f01-8128-f98228de51b9")</span></span>  
  
## <a name="sample-sql-script-for-adding-filegroups-and-files-to-the-biztalk-messagebox-database"></a><span data-ttu-id="16390-223">用于将文件组和文件添加到 BizTalk MessageBox 数据库的示例 SQL 脚本</span><span class="sxs-lookup"><span data-stu-id="16390-223">Sample SQL script for adding filegroups and files to the BizTalk MessageBox database</span></span>  
 <span data-ttu-id="16390-224">下面的示例 SQL 脚本执行手动完成上一节中的相同任务。</span><span class="sxs-lookup"><span data-stu-id="16390-224">The sample SQL script below performs the same tasks that were completed manually in the previous section.</span></span>  
<span data-ttu-id="16390-225">此示例脚本假定存在通过 J.的非重复逻辑驱动器 G该脚本创建文件组和每个文件组的文件，并将 J 驱动器上的日志文件。</span><span class="sxs-lookup"><span data-stu-id="16390-225">This sample script assumes the existence of distinct logical drives G through J. The script creates filegroups and files for each filegroup and places the log files on the J drive.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="16390-226">SQL Server 按顺序写入其日志文件，因为意识到通过创建针对 SQL Server 数据库的多个日志文件没有的性能优势。</span><span class="sxs-lookup"><span data-stu-id="16390-226">Because SQL Server writes to its log files sequentially, there is no performance advantage realized by creating multiple log files for a SQL Server database.</span></span>  
  
```  
-- Filegroup changes are made using the master database  
USE [master]  
GO  
  
-- Script-wide declarations  
DECLARE @CommandBuffer nvarchar(2048)  
DECLARE @FG1_Path nvarchar(1024)  
DECLARE @FG2_Path nvarchar(1024)  
DECLARE @FG3_Path nvarchar(1024)  
DECLARE @Log_Path nvarchar(1024)  
  
-- Set the default path for all filegroups  
SET @FG1_Path = N'G:\BizTalkMsgBoxDATA\'  
SET @FG2_Path = N'H:\BizTalkMsgBoxDATA\'  
SET @FG3_Path = N'I:\BizTalkMsgBoxDATA\'  
SET @Log_Path = N'J:\BizTalkMsgBoxLog\'  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG1]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG1_Path +   
N'BizTalkMsgBoxDb_FG1.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG1]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG2]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG2_Path +   
N'BizTalkMsgBoxDb_FG2.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG2]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] ADD FILEGROUP [BTS_MsgBox_FG3]  
SET @CommandBuffer = N'ALTER DATABASE [BizTalkMsgBoxDb] ADD FILE ( NAME = N''BizTalkMsgBoxDb_FG1'', FILENAME = N''' + @FG3_Path +   
N'BizTalkMsgBoxDb_FG3.ndf'' , SIZE = 102400KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB ) TO FILEGROUP [BTS_MsgBox_FG3]'  
EXECUTE (@CommandBuffer)  
  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILE ( NAME = N'BizTalkMsgBoxDb_log', SIZE = 10240KB , MAXSIZE = UNLIMITED, FILEGROWTH = 10240KB )  
  
GO -- Completes the previous batch, as necessary  
```  
  
 <span data-ttu-id="16390-227">下面的示例 SQL 脚本可用来将特定的文件组设置为默认文件组：</span><span class="sxs-lookup"><span data-stu-id="16390-227">The sample SQL script below could be used to set a particular filegroup as the default filegroup:</span></span>  
  
```  
USE [BizTalkMsgBoxDb]  
GO  
declare @isdefault bit  
SELECT @isdefault=convert(bit, (status & 0x10)) FROM sysfilegroups WHERE groupname=N'BTS_MsgBox_FG1'  
if(@isdefault=0)  
ALTER DATABASE [BizTalkMsgBoxDb] MODIFY FILEGROUP [BTS_MsgBox_FG1] DEFAULT  
GO  
```  
  
 <span data-ttu-id="16390-228">对脚本编写的优点是脚本可以执行多个任务快速、 准确地说，可重现和减少人为错误的可能性。</span><span class="sxs-lookup"><span data-stu-id="16390-228">The advantage to scripting is that scripts can perform multiple tasks quickly, can be reproduced precisely, and reduce the possibility of human error.</span></span> <span data-ttu-id="16390-229">脚本的缺点是脚本的，编写不正确的执行可能会导致严重的问题，可能需要重新配置从零开始的 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="16390-229">The disadvantage of scripting is that the execution of an incorrectly written script can potentially cause serious problems that could require the BizTalk Server databases to be re-configured from scratch.</span></span> <span data-ttu-id="16390-230">因此，它是最重要的 SQL 脚本，如本主题中列出的示例脚本进行全面测试才能在生产环境中正在执行。</span><span class="sxs-lookup"><span data-stu-id="16390-230">Therefore, it is of utmost importance that SQL scripts such as the sample script listed in this topic are thoroughly tested before being executed in a production environment.</span></span>