---
title: SQL Server 设置不能更改 |Microsoft Docs
description: 最大并行度，自动创建统计信息自动更新统计信息和重新生成在 BizTalk Server 中的索引
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 4b383bfb-c3d9-47d4-b294-f6be94302734
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 60479097dc9e56c2bc0c525d0de7d7a33afccaa5
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36978262"
---
# <a name="sql-server-settings-that-should-not-be-changed"></a><span data-ttu-id="58d83-103">不应更改的 SQL Server 设置</span><span class="sxs-lookup"><span data-stu-id="58d83-103">SQL Server Settings That Should Not Be Changed</span></span>
<span data-ttu-id="58d83-104">设置时[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]期间的操作准备情况过程[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]，您应该对以下设置进行更改。</span><span class="sxs-lookup"><span data-stu-id="58d83-104">When setting up [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] during the operational readiness procedures for [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], you should not make changes to the following settings.</span></span>  
  
## <a name="sql-server-max-degree-of-parallelism"></a><span data-ttu-id="58d83-105">SQL Server 最大并行度</span><span class="sxs-lookup"><span data-stu-id="58d83-105">SQL Server Max Degree of Parallelism</span></span>  
 <span data-ttu-id="58d83-106">最大并行度 (MDOP) 的设置为"1"在配置期间[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]有关[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]个实例托管[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="58d83-106">Max Degree of Parallelism (MDOP) is set to “1” during the configuration of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] for the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance(s) that host the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox database(s).</span></span> <span data-ttu-id="58d83-107">这是[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例级别设置。</span><span class="sxs-lookup"><span data-stu-id="58d83-107">This is a [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance-level setting.</span></span> <span data-ttu-id="58d83-108">从"1"的值不应更改此设置。</span><span class="sxs-lookup"><span data-stu-id="58d83-108">This setting should not be changed from the value of “1”.</span></span> <span data-ttu-id="58d83-109">此设置更改为"1"之外的任何内容可以对产生明显的负面影响[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]存储过程和性能。</span><span class="sxs-lookup"><span data-stu-id="58d83-109">Changing this to anything other than “1” can have a significant negative impact on the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] stored procedures and performance.</span></span> <span data-ttu-id="58d83-110">如果更改的实例的并行度设置[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]将产生负面影响在其执行其他数据库应用程序上的[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例，应创建一个单独的实例[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]专用于承载[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库。</span><span class="sxs-lookup"><span data-stu-id="58d83-110">If changing the parallelism setting for an instance of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] will have an adverse effect on other database applications that are being executed on the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance, you should create a separate instance of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] dedicated to hosting the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span>  
  
 <span data-ttu-id="58d83-111">并行查询通常最适合于批处理和决策支持工作负荷。</span><span class="sxs-lookup"><span data-stu-id="58d83-111">Parallel queries are generally best suited to batch processing and decision support workloads.</span></span> <span data-ttu-id="58d83-112">它们通常不是一个事务处理环境，其中有许多较短的快速查询正在并行运行这种情况屡见不鲜。</span><span class="sxs-lookup"><span data-stu-id="58d83-112">They are typically not desirable in a transaction processing environment where you have many short, fast queries running in parallel.</span></span> <span data-ttu-id="58d83-113">此外，更改会导致查询性能不佳或甚至使用死锁设置有时会导致查询计划以更改，MDOP[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]查询。</span><span class="sxs-lookup"><span data-stu-id="58d83-113">In addition, changing the MDOP setting sometimes causes the query plan to be changed, which leads to poor query performance or even deadlocks with the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] queries.</span></span>  
  
 <span data-ttu-id="58d83-114">[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]存储的过程提供正确的连接，并尽可能以尝试使查询优化器很少，将计划更改锁定提示。</span><span class="sxs-lookup"><span data-stu-id="58d83-114">The [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] stored procedures provide the correct joins and lock hints wherever possible in order to try to keep the query optimizer from doing much work and changing the plan.</span></span> <span data-ttu-id="58d83-115">这些存储的过程通过构建查询，以便查询优化器执行不相关的最大程度地提供一致的查询执行。</span><span class="sxs-lookup"><span data-stu-id="58d83-115">These stored procedures provide consistent query executions by constructing the queries such that the query optimizer is taken out of the picture as much as possible.</span></span>  
  
 <span data-ttu-id="58d83-116">有关详细信息，请参阅[KB 899000: BizTalk Server 使用的 SQL Server 实例的并行度设置](https://support.microsoft.com/help/899000/the-parallelism-setting-for-the-instance-of-sql-server-when-you-config)。</span><span class="sxs-lookup"><span data-stu-id="58d83-116">For more information, see [KB 899000: Parallelism setting for SQL Server instance used by BizTalk Server](https://support.microsoft.com/help/899000/the-parallelism-setting-for-the-instance-of-sql-server-when-you-config).</span></span>  
  
## <a name="sql-server-statistics-on-the-messagebox-database"></a><span data-ttu-id="58d83-117">在 MessageBox 数据库上的 SQL Server 统计信息</span><span class="sxs-lookup"><span data-stu-id="58d83-117">SQL Server Statistics on the MessageBox Database</span></span>  
 <span data-ttu-id="58d83-118">默认情况下关闭的以下选项[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]MessageBox 数据库时创建它：</span><span class="sxs-lookup"><span data-stu-id="58d83-118">The following options are turned off by default in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox database when it is created:</span></span>  
  
- <span data-ttu-id="58d83-119">自动创建统计信息</span><span class="sxs-lookup"><span data-stu-id="58d83-119">Auto create statistics</span></span>  
  
- <span data-ttu-id="58d83-120">自动更新统计信息</span><span class="sxs-lookup"><span data-stu-id="58d83-120">Auto update statistics</span></span>  
  
  <span data-ttu-id="58d83-121">不要启用这些选项对 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="58d83-121">Do not enable these options on MessageBox databases.</span></span> <span data-ttu-id="58d83-122">启用"自动创建统计信息"和"自动更新统计信息"选项可能导致不良查询执行延迟，尤其是在高负荷环境。</span><span class="sxs-lookup"><span data-stu-id="58d83-122">Enabling the "auto create statistics" and "auto update statistics" options can cause undesirable query execution delays, especially in a high-load environment.</span></span>  
  
  <span data-ttu-id="58d83-123">此外，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]存储的过程具有完全联接和查询中指定的锁提示。</span><span class="sxs-lookup"><span data-stu-id="58d83-123">In addition, the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] stored procedures have exact joins and lock hints specified on the queries.</span></span> <span data-ttu-id="58d83-124">这样做是为了确保最佳查询计划可供[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]中的查询[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="58d83-124">This is done to ensure that the optimal query plan is used by the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] queries in [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="58d83-125">已知的分布区和预期的查询的结果;已知的大约行数返回。</span><span class="sxs-lookup"><span data-stu-id="58d83-125">The distributions and expected results for the queries are known; the approximate number of rows returned is known.</span></span> <span data-ttu-id="58d83-126">通常不需要统计信息。</span><span class="sxs-lookup"><span data-stu-id="58d83-126">Statistics are generally not needed.</span></span>  
  
  <span data-ttu-id="58d83-127">有关详细信息，请参阅以下 Microsoft 知识库文章：</span><span class="sxs-lookup"><span data-stu-id="58d83-127">For more information, see the following Microsoft Knowledge Base articles:</span></span>  
  
- <span data-ttu-id="58d83-128">**912262**—["自动更新统计信息选项的自动创建统计信息选项和作为 BizTalk Server BizTalkMsgBoxDB 数据库宿主的 SQL Server 数据库实例中关闭的并行度设置"](https://support.microsoft.com/help/912262/the-auto-update-statistics-option-the-auto-create-statistics-option-an).</span><span class="sxs-lookup"><span data-stu-id="58d83-128">**912262**—["The auto update statistics option, the auto create statistics option, and the Parallelism setting are turned off in the SQL Server database instance that hosts the BizTalk Server BizTalkMsgBoxDB database"](https://support.microsoft.com/help/912262/the-auto-update-statistics-option-the-auto-create-statistics-option-an).</span></span>  
  
- <span data-ttu-id="58d83-129">**917845**—["你遇到阻止，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库死锁条件或其他 SQL Server 问题"](https://support.microsoft.com/help/917845/you-experience-blocking--deadlock-conditions--or-other-sql-server-issu)。</span><span class="sxs-lookup"><span data-stu-id="58d83-129">**917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](https://support.microsoft.com/help/917845/you-experience-blocking--deadlock-conditions--or-other-sql-server-issu).</span></span>  
  
## <a name="changes-to-the-messagebox-database"></a><span data-ttu-id="58d83-130">对 MessageBox 数据库的更改</span><span class="sxs-lookup"><span data-stu-id="58d83-130">Changes to the MessageBox Database</span></span>  
 <span data-ttu-id="58d83-131">MessageBox 数据库应视为非 Microsoft 应用程序源代码。</span><span class="sxs-lookup"><span data-stu-id="58d83-131">The MessageBox database should be treated like non-Microsoft application source code.</span></span> <span data-ttu-id="58d83-132">也就是说，您应不"调整"对表、 索引、 存储的过程和大多数 SQL Server 数据库设置的更改通过 MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="58d83-132">That is, you should not “tweak” the MessageBox database via changes to tables, indexes, stored procedures, and most SQL Server database settings.</span></span> <span data-ttu-id="58d83-133">在 BizTalk 核心引擎的网络日志的详细信息，请参阅[和与 MessageBox 数据库服务器不能做](http://go.microsoft.com/fwlink/p/?LinkId=101577)。</span><span class="sxs-lookup"><span data-stu-id="58d83-133">For more information, in the BizTalk Core Engine's WebLog, see [What you can and can't do with the MessageBox Database server](http://go.microsoft.com/fwlink/p/?LinkId=101577).</span></span>  
  
## <a name="default-settings-for-the-database-index-rebuilds-and-defragmentation"></a><span data-ttu-id="58d83-134">数据库索引重新生成和碎片整理的默认设置</span><span class="sxs-lookup"><span data-stu-id="58d83-134">Default Settings for the Database Index Rebuilds and Defragmentation</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="58d83-135"> 不支持磁盘碎片整理的索引。</span><span class="sxs-lookup"><span data-stu-id="58d83-135"> does not support defragmenting indexes.</span></span> <span data-ttu-id="58d83-136">"DBCC INDEXDEFRAG"和"ALTER INDEX...</span><span class="sxs-lookup"><span data-stu-id="58d83-136">“DBCC INDEXDEFRAG” and “ALTER INDEX …</span></span> <span data-ttu-id="58d83-137">重新组织..."</span><span class="sxs-lookup"><span data-stu-id="58d83-137">REORGANIZE …”</span></span> <span data-ttu-id="58d83-138">不受支持，因为它们使用页锁定，这可能导致阻塞和死锁[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="58d83-138">are not supported since they use page locking, which can cause blocking and deadlocks with [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="58d83-139"> 执行支持数据库索引重新生成 （"DBCC DBREINDEX"和"ALTER INDEX...</span><span class="sxs-lookup"><span data-stu-id="58d83-139"> does support database index rebuilds (“DBCC DBREINDEX” and “ALTER INDEX …</span></span> <span data-ttu-id="58d83-140">重新生成..."），但它们仅应执行在维护时段时[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]未处理的数据。</span><span class="sxs-lookup"><span data-stu-id="58d83-140">REBUILD …”), but they should only be done during maintenance windows when [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is not processing data.</span></span> <span data-ttu-id="58d83-141">索引重新生成时[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]正在处理的数据不受支持。</span><span class="sxs-lookup"><span data-stu-id="58d83-141">Index rebuilds while [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is processing data are not supported.</span></span>  
  
 <span data-ttu-id="58d83-142">有关详细信息，请参阅[KB 917845： 体验阻塞，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库死锁条件或其他 SQL Server 问题"](https://support.microsoft.com/help/917845/you-experience-blocking--deadlock-conditions--or-other-sql-server-issu)。</span><span class="sxs-lookup"><span data-stu-id="58d83-142">For more information, see [KB 917845: You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](https://support.microsoft.com/help/917845/you-experience-blocking--deadlock-conditions--or-other-sql-server-issu).</span></span>  
  
 <span data-ttu-id="58d83-143">索引碎片不太多的性能问题的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]因为它将针对 DSS 系统或执行索引扫描的 OLTP 系统。</span><span class="sxs-lookup"><span data-stu-id="58d83-143">Index fragmentation is not as much of a performance issue for [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] as it would be for a DSS system or an OLTP system that performs index scans.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="58d83-144"> 执行极具选择性的查询和更新和[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]存储的过程并不会导致表扫描或索引扫描。</span><span class="sxs-lookup"><span data-stu-id="58d83-144"> does very selective queries and updates and [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] stored procedures should not cause table or index scans.</span></span>  
  
 
## <a name="see-also"></a><span data-ttu-id="58d83-145">请参阅</span><span class="sxs-lookup"><span data-stu-id="58d83-145">See Also</span></span>  
 [<span data-ttu-id="58d83-146">清单：配置 SQL Server</span><span class="sxs-lookup"><span data-stu-id="58d83-146">Checklist: Configuring SQL Server</span></span>](~/technical-guides/checklist-configuring-sql-server.md)
