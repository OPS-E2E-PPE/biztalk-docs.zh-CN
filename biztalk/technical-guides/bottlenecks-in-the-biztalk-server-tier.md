---
title: "BizTalk Server 层中的瓶颈 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 3ad36897-4e4a-43b9-9cb7-0bf22bd954fb
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1ce311461f4273b057c65913d3024f8092f87d1e
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="bottlenecks-in-the-biztalk-server-tier"></a><span data-ttu-id="28318-102">BizTalk Server 层中的瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-102">Bottlenecks in the BizTalk Server Tier</span></span>
<span data-ttu-id="28318-103">BizTalk 层可分为以下功能区域：</span><span class="sxs-lookup"><span data-stu-id="28318-103">The BizTalk tier can be divided into the following functional areas:</span></span>  
  
-   <span data-ttu-id="28318-104">接收</span><span class="sxs-lookup"><span data-stu-id="28318-104">Receiving</span></span>  
  
-   <span data-ttu-id="28318-105">处理</span><span class="sxs-lookup"><span data-stu-id="28318-105">Processing</span></span>  
  
-   <span data-ttu-id="28318-106">传输</span><span class="sxs-lookup"><span data-stu-id="28318-106">Transmitting</span></span>  
  
-   <span data-ttu-id="28318-107">跟踪</span><span class="sxs-lookup"><span data-stu-id="28318-107">Tracking</span></span>  
  
-   <span data-ttu-id="28318-108">其他</span><span class="sxs-lookup"><span data-stu-id="28318-108">Other</span></span>  
  
 <span data-ttu-id="28318-109">这些区域，如果系统资源 （CPU、 内存和磁盘） 似乎饱和，通过向上缩放平台升级服务器，或缩小基于你的应用程序的特征。</span><span class="sxs-lookup"><span data-stu-id="28318-109">For these areas, if the system resources (CPU, memory, and disk) appear to be saturated, upgrade the server by scaling the platform up or out based on the characteristics of your application.</span></span> <span data-ttu-id="28318-110">如果系统资源不饱和，请执行本部分中介绍的这些步骤。</span><span class="sxs-lookup"><span data-stu-id="28318-110">If the system resources are not saturated, perform the steps described in this section.</span></span>  
  
## <a name="bottlenecks-in-the-receive-location"></a><span data-ttu-id="28318-111">接收位置的瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-111">Bottlenecks in the receive location</span></span>  
 <span data-ttu-id="28318-112">如果消息建立在接收位置 （例如，文件接收文件夹占用多），这表明系统不能以足够快的速度消减数据以跟不上传入的负载。</span><span class="sxs-lookup"><span data-stu-id="28318-112">If messages build up at the receive location (for example, file receive folder grows large), this indicates that the system is unable to absorb data fast enough to keep up with the incoming load.</span></span> <span data-ttu-id="28318-113">这是因为内部限制。</span><span class="sxs-lookup"><span data-stu-id="28318-113">This is due to internal throttling.</span></span> <span data-ttu-id="28318-114">也就是说，BizTalk Server 接收的速率减少到如果订阅服务器无法处理数据快速数据库表中的足够导致积压工作构建。</span><span class="sxs-lookup"><span data-stu-id="28318-114">That is, BizTalk Server reduces the receiving rate if the subscribers are unable to process data fast enough causing backlog buildup in the database tables.</span></span> <span data-ttu-id="28318-115">如果瓶颈由硬件限制，请尝试按比例增加。</span><span class="sxs-lookup"><span data-stu-id="28318-115">If the bottleneck is caused by hardware limitations, try scaling up.</span></span> <span data-ttu-id="28318-116">有关向上扩展的详细信息，请参阅 BizTalk Server 2010 文档中的以下主题：</span><span class="sxs-lookup"><span data-stu-id="28318-116">For more information about scaling up, see the following topics in the BizTalk Server 2010 documentation:</span></span>  
  
-   <span data-ttu-id="28318-117">[BizTalk Server 层向上扩展](http://go.microsoft.com/fwlink/?LinkId=158073)(http://go.microsoft.com/fwlink/?LinkId=158073)。</span><span class="sxs-lookup"><span data-stu-id="28318-117">[Scaling Up the BizTalk Server Tier](http://go.microsoft.com/fwlink/?LinkId=158073) (http://go.microsoft.com/fwlink/?LinkId=158073).</span></span>  
  
-   <span data-ttu-id="28318-118">[按比例增加 SQL Server 层](http://go.microsoft.com/fwlink/?LinkId=158077)(http://go.microsoft.com/fwlink/?LinkId=158077)。</span><span class="sxs-lookup"><span data-stu-id="28318-118">[Scaling Up the SQL Server Tier](http://go.microsoft.com/fwlink/?LinkId=158077) (http://go.microsoft.com/fwlink/?LinkId=158077).</span></span>  
  
 <span data-ttu-id="28318-119">还有可能要横向扩展通过将主机实例 （服务器） 添加到主机映射到接收处理程序。</span><span class="sxs-lookup"><span data-stu-id="28318-119">It is also possible to scale out by adding a host instance (server) to the host mapped to the receive handler.</span></span> <span data-ttu-id="28318-120">有关向外扩展的详细信息，请参阅 BizTalk Server 2010 文档中的以下主题：</span><span class="sxs-lookup"><span data-stu-id="28318-120">For more information about scaling out, see the following topics in the BizTalk Server 2010 documentation:</span></span>  
  
-   <span data-ttu-id="28318-121">[BizTalk Server 层向外缩放](http://go.microsoft.com/fwlink/?LinkId=158076)(http://go.microsoft.com/fwlink/?LinkId=158076)。</span><span class="sxs-lookup"><span data-stu-id="28318-121">[Scaling Out the BizTalk Server Tier](http://go.microsoft.com/fwlink/?LinkId=158076) (http://go.microsoft.com/fwlink/?LinkId=158076).</span></span>  
  
-   <span data-ttu-id="28318-122">[SQL Server 层向外缩放](http://go.microsoft.com/fwlink/?LinkId=158075)(http://go.microsoft.com/fwlink/?LinkId=158075)。</span><span class="sxs-lookup"><span data-stu-id="28318-122">[Scaling Out the SQL Server Tier](http://go.microsoft.com/fwlink/?LinkId=158075) (http://go.microsoft.com/fwlink/?LinkId=158075).</span></span>  
  
 <span data-ttu-id="28318-123">使用性能监视器来监视系统上的资源使用。</span><span class="sxs-lookup"><span data-stu-id="28318-123">Use Perfmon to monitor the resource use on the system.</span></span> <span data-ttu-id="28318-124">确认外部接收位置不是导致瓶颈的原因至关重要。</span><span class="sxs-lookup"><span data-stu-id="28318-124">It is important to confirm that the external receive location is not the cause of the bottleneck.</span></span> <span data-ttu-id="28318-125">例如，确认是否由于高的磁盘 I/O 饱和远程文件共享、 承载远程传出队列的服务器未达到饱和，或客户端用来生成 HTTP 负载不会耗尽在线程上。</span><span class="sxs-lookup"><span data-stu-id="28318-125">For example, confirm whether the remote file share is saturated due to high disk I/O, the server hosting the remote outgoing queue is not saturated, or the client used to generate HTTP load is not starved on threads.</span></span>  
  
## <a name="processing-bottlenecks"></a><span data-ttu-id="28318-126">处理瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-126">Processing bottlenecks</span></span>  
 <span data-ttu-id="28318-127">如果主机队列 – Length 性能计数器攀升到 5，则指示不足够快的速度完成业务流程。</span><span class="sxs-lookup"><span data-stu-id="28318-127">If the Host Queue – Length performance counter is climbing, it indicates that the orchestrations are not completing fast enough.</span></span> <span data-ttu-id="28318-128">有关详细信息，请参阅本主题中的 Perfmon 计数器表。</span><span class="sxs-lookup"><span data-stu-id="28318-128">For more information, see the Perfmon counter table in this topic.</span></span> <span data-ttu-id="28318-129">这可能是由于内存争用或 CPU 饱和所致。</span><span class="sxs-lookup"><span data-stu-id="28318-129">This could be due to memory contention or CPU saturation.</span></span>  
  
 <span data-ttu-id="28318-130">如果业务流程服务器是瓶颈，请使用 Perfmon 来标识来源。</span><span class="sxs-lookup"><span data-stu-id="28318-130">If the orchestration servers are the bottleneck, use Perfmon to identify the source.</span></span>  
  
 <span data-ttu-id="28318-131">如果服务器受到 CPU 的约束，请考虑以下情况：</span><span class="sxs-lookup"><span data-stu-id="28318-131">If the server is CPU bound, consider the following:</span></span>  
  
-   <span data-ttu-id="28318-132">如果复杂工作流，请考虑将拆分到多个较小的业务流程业务流程</span><span class="sxs-lookup"><span data-stu-id="28318-132">If the workflow is complex, consider splitting the orchestration into multiple smaller orchestrations</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="28318-133">将一个业务流程拆分成多个工作流可能会导致额外的延迟并使复杂性增加。</span><span class="sxs-lookup"><span data-stu-id="28318-133">Splitting an orchestration into multiple workflows can cause additional latency and add complexity.</span></span> <span data-ttu-id="28318-134">多个工作流也会导致增加在发布到和从 BizTalkMsgBoxDb，使用的消息数对数据库带来额外的压力。</span><span class="sxs-lookup"><span data-stu-id="28318-134">Multiple workflows can also cause an increase in the number of messages published to and consumed from the BizTalkMsgBoxDb, putting additional pressure on the database.</span></span>  
  
-   <span data-ttu-id="28318-135">如果你使用复杂的地图，请考虑是否可以将它们移到接收/发送端口。</span><span class="sxs-lookup"><span data-stu-id="28318-135">If you use complex maps, consider whether they can be moved to the Receive/Send ports.</span></span> <span data-ttu-id="28318-136">请务必验证哪些端口可以额外的带宽。</span><span class="sxs-lookup"><span data-stu-id="28318-136">Be sure to verify which ports have additional bandwidth.</span></span>  
  
-   <span data-ttu-id="28318-137">请考虑按比例增加硬件或通过配置额外的处理服务器向外扩展。</span><span class="sxs-lookup"><span data-stu-id="28318-137">Consider scaling up the hardware or scaling out by configuring an additional processing server.</span></span>  
  
## <a name="transmitting-bottlenecks"></a><span data-ttu-id="28318-138">传输瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-138">Transmitting bottlenecks</span></span>  
 <span data-ttu-id="28318-139">如果服务器承载发送适配器饱和对资源 （例如，磁盘、 内存或 CPU），请考虑向上扩展的服务器或向外缩放到其他主机服务器发送。</span><span class="sxs-lookup"><span data-stu-id="28318-139">If the server hosting the send adapters is saturated on resources (for example, disk, memory, or CPU), consider scaling-up the server or scaling-out to additional send host servers.</span></span> <span data-ttu-id="28318-140">如果目标（位于 BizTalk 外部）接收数据的速度不够快，发送层则可能成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="28318-140">The sending tier could become the bottleneck if the destination (external to BizTalk) is unable to receive data fast enough.</span></span> <span data-ttu-id="28318-141">这将会导致消息在 MessageBox 数据库（应用程序 SendHostQ）中累积。</span><span class="sxs-lookup"><span data-stu-id="28318-141">This will cause messages to buildup in the MessageBox database (Application SendHostQ).</span></span>  
  
 <span data-ttu-id="28318-142">如果所有终结点的拓扑的范围内，找出在目标位置的原因。</span><span class="sxs-lookup"><span data-stu-id="28318-142">If all the endpoints are within the scope of the topology, isolate the cause at the destination.</span></span> <span data-ttu-id="28318-143">例如，确定 HTTP 位置是否以最佳方式配置为接收负载。</span><span class="sxs-lookup"><span data-stu-id="28318-143">For example, determine if the HTTP location is optimally configured to receive load.</span></span> <span data-ttu-id="28318-144">如果没有，请考虑向外扩展。此外确定是否由于过多输出消息传递方式 BizTalk 增长目标。</span><span class="sxs-lookup"><span data-stu-id="28318-144">If not, consider scaling out. Also determine if the destination is growing due to excessive output messages delivered by BizTalk.</span></span> <span data-ttu-id="28318-145">如果是，你可能需要用于存档和清除目标消息的维护计划。</span><span class="sxs-lookup"><span data-stu-id="28318-145">If yes, you might need a maintenance plan to archive and purge the destination messages.</span></span> <span data-ttu-id="28318-146">大量的目标文件夹中的文件会严重影响 BizTalk 服务能够将数据提交到磁盘驱动器。</span><span class="sxs-lookup"><span data-stu-id="28318-146">Large numbers of files in a destination folder can severely impact the ability of the BizTalk service to commit data to the disk drive.</span></span>  
  
## <a name="tracking-bottlenecks"></a><span data-ttu-id="28318-147">跟踪瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-147">Tracking bottlenecks</span></span>  
 <span data-ttu-id="28318-148">跟踪主机实例负责将从 MessageBox 数据库 （TrackingData 表） 的业务活动监视 (BAM) 和运行状况和活动跟踪 (HAT) 数据移到 BizTalk 跟踪和/或 BAM 主导入数据库表。</span><span class="sxs-lookup"><span data-stu-id="28318-148">The Tracking host instance is responsible for moving the Business Activity Monitoring (BAM) and Health and Activity Tracking (HAT) data from the MessageBox database (TrackingData table) to the BizTalk Tracking and/or BAM Primary Import database tables.</span></span> <span data-ttu-id="28318-149">如果配置了多个 MessageBox 数据库，跟踪托管实例使用每个 MessageBox 数据库的四个线程。</span><span class="sxs-lookup"><span data-stu-id="28318-149">If multiple MessageBox databases are configured, the tracking host instance uses four threads per MessageBox database.</span></span>  
  
 <span data-ttu-id="28318-150">很有可能跟踪主机实例是 CPU 绑定。</span><span class="sxs-lookup"><span data-stu-id="28318-150">It is possible that the Tracking host instance is CPU bound.</span></span> <span data-ttu-id="28318-151">如果是，请考虑向上扩展服务器，或通过配置一台服务器与主机跟踪启用横向扩展。</span><span class="sxs-lookup"><span data-stu-id="28318-151">If it is, consider scaling-up the server or scale-out by configuring an additional server with Host Tracking enabled.</span></span> <span data-ttu-id="28318-152">多个主机实例将自动加载平衡多个消息框配置的数据库。</span><span class="sxs-lookup"><span data-stu-id="28318-152">The multiple host instances will automatically load balance for the multiple MessageBox databases configured.</span></span> <span data-ttu-id="28318-153">有关缩放的详细信息，请参阅主题[缩放你的解决方案](http://go.microsoft.com/fwlink/?LinkId=158078)(http://go.microsoft.com/fwlink/?LinkId=158078)。</span><span class="sxs-lookup"><span data-stu-id="28318-153">For more information about scaling, see the topic [Scaling Your Solutions](http://go.microsoft.com/fwlink/?LinkId=158078) (http://go.microsoft.com/fwlink/?LinkId=158078).</span></span>  
  
 <span data-ttu-id="28318-154">如果 MessageBox 数据库中的 TrackingData 表增长大，它通常是因为经过配置之后，导致的 BizTalk 跟踪和/或 BAM 主增长 BizTalk 跟踪和/或 BAM 主导入数据库上的数据维护作业未运行导入数据库。</span><span class="sxs-lookup"><span data-stu-id="28318-154">If the TrackingData table in the MessageBox database grows large, it is usually because the data maintenance jobs on the BizTalk Tracking and/or BAM Primary Import database are not running as configured, causing growth of the BizTalk Tracking and/or BAM Primary Import databases.</span></span> <span data-ttu-id="28318-155">这些数据库增长得太大后它可以在跟踪主机能够将数据插入 TrackingData 表上产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="28318-155">After these databases grow too large it can have a negative impact on the ability of the Tracking host to insert data into the TrackingData table.</span></span> <span data-ttu-id="28318-156">这将导致要备份的 MessageBox 数据库表中的跟踪的数据。</span><span class="sxs-lookup"><span data-stu-id="28318-156">This causes tracked data to back up in the MessageBox database tables.</span></span> <span data-ttu-id="28318-157">TrackingData 表的增长会导致限制，以启动。</span><span class="sxs-lookup"><span data-stu-id="28318-157">The growth of the TrackingData table cause throttling to start.</span></span>  
  
 <span data-ttu-id="28318-158">你应仅启用最小跟踪所需的应用程序，因为这将减少记录的数据量，并降低跟踪瓶颈的风险。</span><span class="sxs-lookup"><span data-stu-id="28318-158">You should only enable the minimum tracking required for your application, as this will reduce the amount of data logged and lower the risk of tracking bottlenecks.</span></span> <span data-ttu-id="28318-159">有关禁用跟踪设置，如业务流程和发送/接收端口的各项的信息，请参阅[如何禁用跟踪](http://go.microsoft.com/fwlink/?LinkId=160064)(http://go.microsoft.com/fwlink/?LinkId=160064)。</span><span class="sxs-lookup"><span data-stu-id="28318-159">For information about disabling tracking settings for individual items such as orchestrations and send/receive ports, see [How to Disable Tracking](http://go.microsoft.com/fwlink/?LinkId=160064) (http://go.microsoft.com/fwlink/?LinkId=160064).</span></span>  
  
## <a name="other"></a><span data-ttu-id="28318-160">其他</span><span class="sxs-lookup"><span data-stu-id="28318-160">Other</span></span>  
 <span data-ttu-id="28318-161">配置部署拓扑结构，以使不同的功能运行在专用的独立主机实例中。</span><span class="sxs-lookup"><span data-stu-id="28318-161">Configure the deployment topology such that different functionality runs in dedicated isolated host instances.</span></span> <span data-ttu-id="28318-162">这种方式每个主机实例获取自己的 （例如上一个 32 位系统、 2 GB 虚拟内存地址空间、 句柄、 线程）, 的资源集。</span><span class="sxs-lookup"><span data-stu-id="28318-162">This way each host instance gets its own set of resources (for example, on a 32-bit system, 2GB virtual memory address space, handles, threads).</span></span> <span data-ttu-id="28318-163">该服务器是否具有足够的 CPU 预留空间和内存来承载多个主机实例，可以将它们配置为在同一台物理计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="28318-163">If the server is has sufficient CPU headroom and memory to host multiple host instances, they can be configured to run on the same physical computer.</span></span> <span data-ttu-id="28318-164">如果没有，请考虑通过将功能移动到专用的服务器向外扩展。</span><span class="sxs-lookup"><span data-stu-id="28318-164">If not, consider scaling out by moving the functionality to dedicated servers.</span></span> <span data-ttu-id="28318-165">在多个服务器上运行相同的功能也可用于提供高可用性的配置。</span><span class="sxs-lookup"><span data-stu-id="28318-165">Running the same functionality on multiple servers also serves to provide a highly available configuration.</span></span>  
  
## <a name="biztalk-system-performance-counters"></a><span data-ttu-id="28318-166">BizTalk 系统性能计数器</span><span class="sxs-lookup"><span data-stu-id="28318-166">BizTalk system performance counters</span></span>  
  
|<span data-ttu-id="28318-167">对象</span><span class="sxs-lookup"><span data-stu-id="28318-167">Object</span></span>|<span data-ttu-id="28318-168">实例</span><span class="sxs-lookup"><span data-stu-id="28318-168">Instance</span></span>|<span data-ttu-id="28318-169">计数器</span><span class="sxs-lookup"><span data-stu-id="28318-169">Counter</span></span>|<span data-ttu-id="28318-170">监视目的</span><span class="sxs-lookup"><span data-stu-id="28318-170">Monitoring Purpose</span></span>|  
|------------|--------------|-------------|------------------------|  
|<span data-ttu-id="28318-171">处理器</span><span class="sxs-lookup"><span data-stu-id="28318-171">Processor</span></span>|<span data-ttu-id="28318-172">_Total</span><span class="sxs-lookup"><span data-stu-id="28318-172">_Total</span></span>|<span data-ttu-id="28318-173">% Processor Time</span><span class="sxs-lookup"><span data-stu-id="28318-173">% Processor Time</span></span>|<span data-ttu-id="28318-174">资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-174">Resource Contention</span></span>|  
|<span data-ttu-id="28318-175">处理</span><span class="sxs-lookup"><span data-stu-id="28318-175">Process</span></span>|<span data-ttu-id="28318-176">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="28318-176">BTSNTSvc</span></span>|<span data-ttu-id="28318-177">Virtual Bytes</span><span class="sxs-lookup"><span data-stu-id="28318-177">Virtual Bytes</span></span>|<span data-ttu-id="28318-178">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="28318-178">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="28318-179">处理</span><span class="sxs-lookup"><span data-stu-id="28318-179">Process</span></span>|<span data-ttu-id="28318-180">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="28318-180">BTSNTSvc</span></span>|<span data-ttu-id="28318-181">Private Bytes</span><span class="sxs-lookup"><span data-stu-id="28318-181">Private Bytes</span></span>|<span data-ttu-id="28318-182">内存泄漏/膨胀</span><span class="sxs-lookup"><span data-stu-id="28318-182">Memory Leak/Bloat</span></span>|  
|<span data-ttu-id="28318-183">处理</span><span class="sxs-lookup"><span data-stu-id="28318-183">Process</span></span>|<span data-ttu-id="28318-184">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="28318-184">BTSNTSvc</span></span>|<span data-ttu-id="28318-185">Handle Count</span><span class="sxs-lookup"><span data-stu-id="28318-185">Handle Count</span></span>|<span data-ttu-id="28318-186">资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-186">Resource Contention</span></span>|  
|<span data-ttu-id="28318-187">处理</span><span class="sxs-lookup"><span data-stu-id="28318-187">Process</span></span>|<span data-ttu-id="28318-188">BTSNTSvc</span><span class="sxs-lookup"><span data-stu-id="28318-188">BTSNTSvc</span></span>|<span data-ttu-id="28318-189">线程计数</span><span class="sxs-lookup"><span data-stu-id="28318-189">Thread Count</span></span>|<span data-ttu-id="28318-190">资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-190">Resource Contention</span></span>|  
|<span data-ttu-id="28318-191">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="28318-191">Physical Disk</span></span>|<span data-ttu-id="28318-192">_ 实例</span><span class="sxs-lookup"><span data-stu-id="28318-192">_Instance</span></span>|<span data-ttu-id="28318-193">% Idle Time</span><span class="sxs-lookup"><span data-stu-id="28318-193">% Idle Time</span></span>|<span data-ttu-id="28318-194">资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-194">Resource Contention</span></span>|  
|<span data-ttu-id="28318-195">物理磁盘</span><span class="sxs-lookup"><span data-stu-id="28318-195">Physical Disk</span></span>|<span data-ttu-id="28318-196">_ 实例</span><span class="sxs-lookup"><span data-stu-id="28318-196">_Instance</span></span>|<span data-ttu-id="28318-197">Average Disk Queue Length</span><span class="sxs-lookup"><span data-stu-id="28318-197">Average Disk Queue Length</span></span>|<span data-ttu-id="28318-198">资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-198">Resource Contention</span></span>|  
  
### <a name="cpu-contention"></a><span data-ttu-id="28318-199">CPU 争用</span><span class="sxs-lookup"><span data-stu-id="28318-199">CPU contention</span></span>  
 <span data-ttu-id="28318-200">如果处理器已饱和; 你可以通过将接收从发送成员和业务流程分离片段应用程序。</span><span class="sxs-lookup"><span data-stu-id="28318-200">If the processor is saturated, you can fragment the application by separating the receiving from the sending and orchestration.</span></span> <span data-ttu-id="28318-201">若要执行此操作，创建单独的主机、 映射到特定功能 （接收/发送/业务流程/跟踪） 主机和将专用的服务器添加到这些单独的主机。</span><span class="sxs-lookup"><span data-stu-id="28318-201">To do this, create separate hosts, map the hosts to specific functionality (receive/send/orchestrations/tracking) and add dedicated servers to these separate hosts.</span></span> <span data-ttu-id="28318-202">业务流程功能通常是大量占用 CPU。</span><span class="sxs-lookup"><span data-stu-id="28318-202">Orchestration functionality is often CPU-intensive.</span></span> <span data-ttu-id="28318-203">如果你配置系统，以便在单独的专用服务器上执行业务流程，这可以帮助提高总体系统的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="28318-203">If you configure the system so the orchestrations execute on a separate dedicated server, this can help improve overall system throughput.</span></span>  
  
 <span data-ttu-id="28318-204">如果部署多个业务流程，可以将它们登记到不同的专用的 orchestration 主机。</span><span class="sxs-lookup"><span data-stu-id="28318-204">If multiple orchestrations are deployed, you can enlist them to different dedicated orchestration hosts.</span></span> <span data-ttu-id="28318-205">将不同的物理服务器映射到专用的业务流程主机可确保不同业务流程隔离，并不会在同一物理地址空间或在同一服务器上的共享资源。</span><span class="sxs-lookup"><span data-stu-id="28318-205">Mapping different physical servers to the dedicated orchestration hosts ensures that the different orchestrations are isolated and do not contend for shared resources either in the same physical address space or on the same server.</span></span>  
  
 <span data-ttu-id="28318-206">停止未使用的主机实例。</span><span class="sxs-lookup"><span data-stu-id="28318-206">Stop unused host instances.</span></span> <span data-ttu-id="28318-207">未使用的主机实例可以通过定期检查要处理的邮件 MessageBox 争用 CPU 和内存资源。</span><span class="sxs-lookup"><span data-stu-id="28318-207">Unused host instances can compete for CPU and memory resources by regularly checking the MessageBox for messages to process.</span></span> <span data-ttu-id="28318-208">此外，未使用的停止接收位置、 发送端口和业务流程。</span><span class="sxs-lookup"><span data-stu-id="28318-208">Additionally, stop unused receive locations, send ports, and orchestrations.</span></span>  
  
### <a name="spool-table-growth"></a><span data-ttu-id="28318-209">假脱机表增长</span><span class="sxs-lookup"><span data-stu-id="28318-209">Spool table growth</span></span>  
 <span data-ttu-id="28318-210">下游瓶颈和/或资源争用可能导致假脱机启动过度增长，并降低总体性能。</span><span class="sxs-lookup"><span data-stu-id="28318-210">Downstream bottlenecks and/or resource contention can cause the spool to start growing excessively and reduce overall performance.</span></span> <span data-ttu-id="28318-211">有关详细信息，请参阅"假脱机表增长"[如何标识 MessageBox Database1 的瓶颈](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md)。</span><span class="sxs-lookup"><span data-stu-id="28318-211">For more information, see “Spool Table Growth” in [How to Identify Bottlenecks in the MessageBox Database1](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md).</span></span>  
  
### <a name="memory-starvation"></a><span data-ttu-id="28318-212">内存资源不足</span><span class="sxs-lookup"><span data-stu-id="28318-212">Memory starvation</span></span>  
 <span data-ttu-id="28318-213">高吞吐量情况可能会增加对系统内存的要求。</span><span class="sxs-lookup"><span data-stu-id="28318-213">High throughput scenarios can have increased demand on system memory.</span></span> <span data-ttu-id="28318-214">由于受限制的 32 位进程可以使用的内存量，建议分隔到单独的主机实例的接收/进程/发送功能，以便每个主机接收其自己的 2 GB 地址空间。</span><span class="sxs-lookup"><span data-stu-id="28318-214">Since a 32-bit process is limited by the amount of memory it can consume, it is recommended to separate the receive/process/send functionality into separate host instances such that each host receives its own 2GB address space.</span></span> <span data-ttu-id="28318-215">此外，如果在同一台物理服务器上运行多个主机实例，你可以升级到 4/8 GB 内存，以避免从实际内存交换到磁盘的数据。</span><span class="sxs-lookup"><span data-stu-id="28318-215">In addition, if multiple host instances are running on the same physical server, you can upgrade to 4/8GB memory to avoid swapping data to disk from real memory.</span></span> <span data-ttu-id="28318-216">长时间运行的业务流程可以存放到分配的内存更长。</span><span class="sxs-lookup"><span data-stu-id="28318-216">Long running orchestrations can hold onto allocated memory longer.</span></span> <span data-ttu-id="28318-217">这可能导致内存膨胀和限制，以启动。</span><span class="sxs-lookup"><span data-stu-id="28318-217">This can cause memory bloat and throttling to start.</span></span> <span data-ttu-id="28318-218">大型消息也会导致高内存消耗。</span><span class="sxs-lookup"><span data-stu-id="28318-218">Large messages can also cause high memory consumption.</span></span>  
  
 <span data-ttu-id="28318-219">你可以轻松地通过降低处理大消息时发生内存膨胀问题**内部消息队列大小**和**每个 CPU 进程内消息**特定主机的值。</span><span class="sxs-lookup"><span data-stu-id="28318-219">You can ease the memory bloat problem that occurs when large messages are processed by lowering the **Internal Message Queue Size** and **In-process Messages per CPU** values for the specific host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="28318-220">如果延迟是个问题，将更改为**内部消息队列大小**和**每个 CPU 进程内消息**根据这可能会增加系统的端到端延迟进行多加小心。</span><span class="sxs-lookup"><span data-stu-id="28318-220">If latency is a concern, changes to **Internal Message Queue Size** and **In-process Messages per CPU** should be made with caution as this may increase end-to-end latency of the system.</span></span>  
  
### <a name="disk-contention"></a><span data-ttu-id="28318-221">磁盘争用</span><span class="sxs-lookup"><span data-stu-id="28318-221">Disk contention</span></span>  
 <span data-ttu-id="28318-222">如果磁盘发生饱和问题 （例如，大量的文件/MSMQ 传输），请考虑升级到多个轴和条带化 RAID 10 具有的磁盘。</span><span class="sxs-lookup"><span data-stu-id="28318-222">If the disks are saturated (for example, with a large number of FILE/MSMQ transports), consider upgrading to multiple spindles and striping the disks with RAID 10.</span></span> <span data-ttu-id="28318-223">此外，无论是使用文件传输，务必确保接收和发送文件夹执行不增长到超过 50000 文件。</span><span class="sxs-lookup"><span data-stu-id="28318-223">In addition, whenever using the FILE transport, it is important to ensure that the receive and send folders do not grow larger than 50,000 files.</span></span>  
  
 <span data-ttu-id="28318-224">接收文件夹会变得大如果 BizTalk 服务器还会传入数据限制到系统。</span><span class="sxs-lookup"><span data-stu-id="28318-224">The receive folder can grow large if BizTalk Server throttles incoming data into the system.</span></span> <span data-ttu-id="28318-225">请务必将数据从发送文件夹移动，以便此文件夹中的增长不会影响 BizTalk Server 用于编写额外的数据的功能。</span><span class="sxs-lookup"><span data-stu-id="28318-225">It is important to move data from the send folder so that growth in this folder does not impact the ability of BizTalk Server to write additional data.</span></span> <span data-ttu-id="28318-226">对于非事务性 MSMQ 队列，它被建议远程创建接收队列，以便在 BizTalk Server 上有所减少的磁盘争用。</span><span class="sxs-lookup"><span data-stu-id="28318-226">For non-transactional MSMQ queues, it is recommended to remotely create the receive queues so that disk contention is reduced on the BizTalk Server.</span></span>  
  
 <span data-ttu-id="28318-227">远程非事务性队列配置还提供了高可用性驻留此队列的远程服务器可以群集化。</span><span class="sxs-lookup"><span data-stu-id="28318-227">The remote non-transactional queue configuration also provides high availability as the remote server hosting the queue can be clustered.</span></span>  
  
### <a name="other-system-resource-contention"></a><span data-ttu-id="28318-228">其他系统资源争用</span><span class="sxs-lookup"><span data-stu-id="28318-228">Other system resource contention</span></span>  
 <span data-ttu-id="28318-229">根据传输的类型，可能需要配置系统资源，如为 HTTP （例如，MaxIOThreads，MaxWorkerThreads） 的 IIS。</span><span class="sxs-lookup"><span data-stu-id="28318-229">Depending on the type of transport, it may be necessary to configure system resources like IIS for HTTP (for example, MaxIOThreads, MaxWorkerThreads).</span></span>  
  
 <span data-ttu-id="28318-230">使用 ASP.NET 2.0 和 ASP.Net 4 中， \<processModel autoConfig ="true"/ > machine.config 文件中的设置将自动配置为获得最佳性能的以下设置：</span><span class="sxs-lookup"><span data-stu-id="28318-230">With ASP.NET 2.0 and ASP.Net 4, the \<processModel autoConfig="true"/> setting in the machine.config file will automatically configure the following settings for optimal performance:</span></span>  
  
-   <span data-ttu-id="28318-231">最大工作线程</span><span class="sxs-lookup"><span data-stu-id="28318-231">Maximum Worker Threads</span></span>  
  
-   <span data-ttu-id="28318-232">最大 IO 线程</span><span class="sxs-lookup"><span data-stu-id="28318-232">Maximum IO Threads</span></span>  
  
-   <span data-ttu-id="28318-233">httpRuntime 元素 minFreeThreads 特性</span><span class="sxs-lookup"><span data-stu-id="28318-233">minFreeThreads attribute of the httpRuntime element</span></span>  
  
-   <span data-ttu-id="28318-234">httpRuntime 元素 minLocalRequestFreeThreads 特性</span><span class="sxs-lookup"><span data-stu-id="28318-234">minLocalRequestFreeThreads attribute of the httpRuntime element</span></span>  
  
-   <span data-ttu-id="28318-235">maxConnection 属性\<connectionManagement > 元素 （网络设置）</span><span class="sxs-lookup"><span data-stu-id="28318-235">maxConnection attribute of the \<connectionManagement> Element (Network Settings) element</span></span>  
  
 <span data-ttu-id="28318-236">有关配置会影响适配器性能的参数的详细信息，请参阅[ASP.NET processModel 元素的配置设置](http://go.microsoft.com/fwlink/?LinkId=158080)(http://go.microsoft.com/fwlink/?LinkId=158080)。</span><span class="sxs-lookup"><span data-stu-id="28318-236">For more information about configuring parameters that affect adapter performance, see [ASP.NET Configuration Settings for the processModel Element](http://go.microsoft.com/fwlink/?LinkId=158080) (http://go.microsoft.com/fwlink/?LinkId=158080).</span></span>  
  
 <span data-ttu-id="28318-237">有关可能会影响 BizTalk Server 适配器的配置设置的详细信息，请参阅[配置参数会影响适配器性能](http://go.microsoft.com/fwlink/?LinkID=154200)(http://go.microsoft.com/fwlink/?LinkID=154200)。</span><span class="sxs-lookup"><span data-stu-id="28318-237">For more information about configuration settings that can affect BizTalk Server adapters, see [Configuration Parameters that Affect Adapter Performance](http://go.microsoft.com/fwlink/?LinkID=154200) (http://go.microsoft.com/fwlink/?LinkID=154200).</span></span>  
  
 <span data-ttu-id="28318-238">除了优化你的 BizTalk Server 应用程序，在同一台服务器上运行其他 ASP.NET 应用程序可以对总体性能产生影响。</span><span class="sxs-lookup"><span data-stu-id="28318-238">In addition to optimizing your BizTalk Server applications, other ASP.NET applications running on the same server can have an affect on overall performance.</span></span> <span data-ttu-id="28318-239">请务必优化所有 ASP.NET 应用程序，为了减少系统资源的需求。</span><span class="sxs-lookup"><span data-stu-id="28318-239">It is important to optimize all of your ASP.NET applications to reduce demand on system resources.</span></span> <span data-ttu-id="28318-240">有关详细信息，请参阅[ASP.NET 性能](http://go.microsoft.com/fwlink/?LinkId=158081)(http://go.microsoft.com/fwlink/?LinkId=158081)。</span><span class="sxs-lookup"><span data-stu-id="28318-240">For more information, see [ASP.NET Performance](http://go.microsoft.com/fwlink/?LinkId=158081) (http://go.microsoft.com/fwlink/?LinkId=158081).</span></span>  
  
 <span data-ttu-id="28318-241">为最高的性能配置时，请考虑优化其他外部系统，如消息传递引擎 （消息队列，MQSeries）、 应用程序、 数据库、 Active Directory 等的总体 BizTalk 解决方案的一部分。</span><span class="sxs-lookup"><span data-stu-id="28318-241">When configuring for maximum performance, consider optimizing other external systems such as messaging engines (Message Queuing, MQSeries), applications, databases, Active Directory, etc. that are part of your overall BizTalk solution.</span></span> <span data-ttu-id="28318-242">在任何其他这些外部系统的性能瓶颈可以产生负面影响对 BizTalk 解决方案。</span><span class="sxs-lookup"><span data-stu-id="28318-242">Performance bottlenecks in any of these other external systems can have a negative effect on your BizTalk solution.</span></span>  
  
### <a name="downstream-bottlenecks"></a><span data-ttu-id="28318-243">下游瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-243">Downstream bottlenecks</span></span>  
 <span data-ttu-id="28318-244">如果下游系统不能从 BizTalk 接收数据速度不够快，则此输出数据将备份 BizTalk 数据库中。</span><span class="sxs-lookup"><span data-stu-id="28318-244">If the downstream system is unable to receive data fast enough from BizTalk, this output data will back up in the BizTalk databases.</span></span> <span data-ttu-id="28318-245">这导致膨胀、 导致限制，以启动、 收缩接收管道中，和影响 BizTalk 系统的整体吞吐量。</span><span class="sxs-lookup"><span data-stu-id="28318-245">This results in bloat, causes throttling to start, shrinks the receive pipe, and impacts the overall throughput of the BizTalk system.</span></span> <span data-ttu-id="28318-246">此直接指示是假脱机表增长。</span><span class="sxs-lookup"><span data-stu-id="28318-246">A direct indication of this is Spool table growth.</span></span> <span data-ttu-id="28318-247">有关瓶颈和假脱机表的详细信息，请参阅[如何标识 MessageBox Database1 的瓶颈](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md)。</span><span class="sxs-lookup"><span data-stu-id="28318-247">For more information about bottlenecks and the Spool table, see [How to Identify Bottlenecks in the MessageBox Database1](../technical-guides/how-to-identify-bottlenecks-in-the-messagebox-database1.md).</span></span>  
  
### <a name="throttling-impact"></a><span data-ttu-id="28318-248">限制的影响</span><span class="sxs-lookup"><span data-stu-id="28318-248">Throttling impact</span></span>  
 <span data-ttu-id="28318-249">限制将最终开始保护系统免受到达不可恢复的状态。</span><span class="sxs-lookup"><span data-stu-id="28318-249">Throttling will eventually start to protect the system from reaching an unrecoverable state.</span></span> <span data-ttu-id="28318-250">因此，你可以使用限制验证系统是否运行正常并发现问题的源。</span><span class="sxs-lookup"><span data-stu-id="28318-250">Thus, you can use throttling to verify whether the system is functioning normally and discover the source of the problem.</span></span> <span data-ttu-id="28318-251">确定从限制状态瓶颈的原因后，分析的其他性能计数器以确定问题的源。</span><span class="sxs-lookup"><span data-stu-id="28318-251">After you identify the cause of the bottleneck from the throttling state, analyze the other performance counters to determine the source of the problem.</span></span> <span data-ttu-id="28318-252">例如，在 MessageBox 数据库上的大量争用可能由于高 CPU 使用率，引起过度分页到磁盘上由内存不足情况引起的。</span><span class="sxs-lookup"><span data-stu-id="28318-252">For example, high contention on the MessageBox database could be due to high CPU use, caused by excessively paging to disk that is caused by low memory conditions.</span></span> <span data-ttu-id="28318-253">在 MessageBox 数据库上的大量争用还可能引起由于饱和磁盘驱动器的高锁争用。</span><span class="sxs-lookup"><span data-stu-id="28318-253">High contention on the MessageBox database could also be caused by high lock contention due to saturated disk drives.</span></span> <span data-ttu-id="28318-254">虽然偶尔限制并不严重的威胁： 性能时，持久限制可以指示更重要的基本问题。</span><span class="sxs-lookup"><span data-stu-id="28318-254">While occasional throttling is not a significant threat to performance, persistent throttling can indicate a more significant underlying problem.</span></span> <span data-ttu-id="28318-255">有关将在其中 BizTalk Server 使用限制这些条件的详细信息，请参阅[如何 BizTalk Server 实现主机限制](http://go.microsoft.com/fwlink/?LinkID=155286)(http://go.microsoft.com/fwlink/?LinkID=155286)。</span><span class="sxs-lookup"><span data-stu-id="28318-255">For more information about those conditions where BizTalk Server will use throttling, see [How BizTalk Server Implements Host Throttling](http://go.microsoft.com/fwlink/?LinkID=155286) (http://go.microsoft.com/fwlink/?LinkID=155286).</span></span>  
  
 <span data-ttu-id="28318-256">了解 BizTalk Server 限制可以如何帮助管理可用资源的使用和最大程度减少资源争用的详细信息，请参阅[优化资源使用通过主机限制](http://go.microsoft.com/fwlink/?LinkID=155770)(http://go.microsoft.com/fwlink/?LinkID=155770)。</span><span class="sxs-lookup"><span data-stu-id="28318-256">For more information about how BizTalk Server throttling can help manage the use of available resources and minimize resource contention, see [Optimizing Resource Usage Through Host Throttling](http://go.microsoft.com/fwlink/?LinkID=155770) (http://go.microsoft.com/fwlink/?LinkID=155770).</span></span>  
  
## <a name="biztalk-application-counters"></a><span data-ttu-id="28318-257">BizTalk 应用程序计数器</span><span class="sxs-lookup"><span data-stu-id="28318-257">BizTalk application counters</span></span>  
  
|<span data-ttu-id="28318-258">对象</span><span class="sxs-lookup"><span data-stu-id="28318-258">Object</span></span>|<span data-ttu-id="28318-259">实例</span><span class="sxs-lookup"><span data-stu-id="28318-259">Instance</span></span>|<span data-ttu-id="28318-260">计数器</span><span class="sxs-lookup"><span data-stu-id="28318-260">Counter</span></span>|<span data-ttu-id="28318-261">Description</span><span class="sxs-lookup"><span data-stu-id="28318-261">Description</span></span>|  
|------------|--------------|-------------|-----------------|  
|<span data-ttu-id="28318-262">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="28318-262">BizTalk Messaging</span></span>|<span data-ttu-id="28318-263">RxHost</span><span class="sxs-lookup"><span data-stu-id="28318-263">RxHost</span></span>|<span data-ttu-id="28318-264">Documents received/sec</span><span class="sxs-lookup"><span data-stu-id="28318-264">Documents Received/Sec</span></span>|<span data-ttu-id="28318-265">传入速率</span><span class="sxs-lookup"><span data-stu-id="28318-265">Incoming Rate</span></span>|  
|<span data-ttu-id="28318-266">BizTalk 消息传送</span><span class="sxs-lookup"><span data-stu-id="28318-266">BizTalk Messaging</span></span>|<span data-ttu-id="28318-267">TxHost</span><span class="sxs-lookup"><span data-stu-id="28318-267">TxHost</span></span>|<span data-ttu-id="28318-268">Documents processed/Sec</span><span class="sxs-lookup"><span data-stu-id="28318-268">Documents Processed/Sec</span></span>|<span data-ttu-id="28318-269">传出速率</span><span class="sxs-lookup"><span data-stu-id="28318-269">Outgoing Rate</span></span>|  
|<span data-ttu-id="28318-270">XLANG/s 业务流程</span><span class="sxs-lookup"><span data-stu-id="28318-270">XLANG/s Orchestrations</span></span>|<span data-ttu-id="28318-271">PxHost</span><span class="sxs-lookup"><span data-stu-id="28318-271">PxHost</span></span>|<span data-ttu-id="28318-272">Orchestrations Completed/Sec.</span><span class="sxs-lookup"><span data-stu-id="28318-272">Orchestrations Completed/Sec.</span></span>|<span data-ttu-id="28318-273">处理速率</span><span class="sxs-lookup"><span data-stu-id="28318-273">Processing Rate</span></span>|  
|<span data-ttu-id="28318-274">BizTalk: MessageBox： 常规计数器</span><span class="sxs-lookup"><span data-stu-id="28318-274">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="28318-275">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="28318-275">MsgBoxName</span></span>|<span data-ttu-id="28318-276">假脱机大小</span><span class="sxs-lookup"><span data-stu-id="28318-276">Spool Size</span></span>|<span data-ttu-id="28318-277">所有主机队列的累积大小</span><span class="sxs-lookup"><span data-stu-id="28318-277">Cumulative size of all Host Queues</span></span>|  
|<span data-ttu-id="28318-278">BizTalk: MessageBox： 常规计数器</span><span class="sxs-lookup"><span data-stu-id="28318-278">BizTalk : MessageBox: General Counters</span></span>|<span data-ttu-id="28318-279">MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="28318-279">MsgBoxName</span></span>|<span data-ttu-id="28318-280">Tracking Data Size</span><span class="sxs-lookup"><span data-stu-id="28318-280">Tracking Data Size</span></span>|<span data-ttu-id="28318-281">MessageBox 上 TrackingData 表的大小</span><span class="sxs-lookup"><span data-stu-id="28318-281">Size of TrackingData table on the MessageBox</span></span>|  
|<span data-ttu-id="28318-282">BizTalk:MessageBox:主机计数器</span><span class="sxs-lookup"><span data-stu-id="28318-282">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="28318-283">PxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="28318-283">PxHost:MsgBoxName</span></span>|<span data-ttu-id="28318-284">Host Queue - Length</span><span class="sxs-lookup"><span data-stu-id="28318-284">Host Queue - Length</span></span>|<span data-ttu-id="28318-285">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="28318-285">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="28318-286">BizTalk:MessageBox:主机计数器</span><span class="sxs-lookup"><span data-stu-id="28318-286">BizTalk:MessageBox:Host Counters</span></span>|<span data-ttu-id="28318-287">TxHost:MsgBoxName</span><span class="sxs-lookup"><span data-stu-id="28318-287">TxHost:MsgBoxName</span></span>|<span data-ttu-id="28318-288">Host Queue - Length</span><span class="sxs-lookup"><span data-stu-id="28318-288">Host Queue - Length</span></span>|<span data-ttu-id="28318-289">特定主机队列中的消息数</span><span class="sxs-lookup"><span data-stu-id="28318-289">Number of messages in the specific Host Queue</span></span>|  
|<span data-ttu-id="28318-290">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="28318-290">BizTalk:Message Agent</span></span>|<span data-ttu-id="28318-291">RxHost</span><span class="sxs-lookup"><span data-stu-id="28318-291">RxHost</span></span>|<span data-ttu-id="28318-292">Database Size</span><span class="sxs-lookup"><span data-stu-id="28318-292">Database Size</span></span>|<span data-ttu-id="28318-293">发布 (PxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="28318-293">Size of publishing (PxHost) Queue</span></span>|  
|<span data-ttu-id="28318-294">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="28318-294">BizTalk:Message Agent</span></span>|<span data-ttu-id="28318-295">PxHost</span><span class="sxs-lookup"><span data-stu-id="28318-295">PxHost</span></span>|<span data-ttu-id="28318-296">Database Size</span><span class="sxs-lookup"><span data-stu-id="28318-296">Database Size</span></span>|<span data-ttu-id="28318-297">发布 (TxHost) 队列的大小</span><span class="sxs-lookup"><span data-stu-id="28318-297">Size of publishing (TxHost) Queue</span></span>|  
|<span data-ttu-id="28318-298">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="28318-298">BizTalk:Message Agent</span></span>|<span data-ttu-id="28318-299">HostName</span><span class="sxs-lookup"><span data-stu-id="28318-299">HostName</span></span>|<span data-ttu-id="28318-300">Message delivery throttling state</span><span class="sxs-lookup"><span data-stu-id="28318-300">Message Delivery Throttling State</span></span>|<span data-ttu-id="28318-301">影响 XLANG 和出站传输</span><span class="sxs-lookup"><span data-stu-id="28318-301">Affects XLANG and Outbound transports</span></span>|  
|<span data-ttu-id="28318-302">BizTalk：消息代理</span><span class="sxs-lookup"><span data-stu-id="28318-302">BizTalk:Message Agent</span></span>|<span data-ttu-id="28318-303">HostName</span><span class="sxs-lookup"><span data-stu-id="28318-303">HostName</span></span>|<span data-ttu-id="28318-304">限制状态消息发布</span><span class="sxs-lookup"><span data-stu-id="28318-304">Message Publishing Throttling State</span></span>|<span data-ttu-id="28318-305">影响 XLANG 和入站传输</span><span class="sxs-lookup"><span data-stu-id="28318-305">Affects XLANG and Inbound transports</span></span>|  
  
### <a name="where-do-i-start"></a><span data-ttu-id="28318-306">应该从何处开始？</span><span class="sxs-lookup"><span data-stu-id="28318-306">Where do I start?</span></span>  
 <span data-ttu-id="28318-307">监视**消息传递限制状态**和**消息发布限制状态**对于每个主机实例是启动的好时机。</span><span class="sxs-lookup"><span data-stu-id="28318-307">Monitoring the **Message Delivery Throttling State** and the **Message Publishing Throttling State** for each host instance is a good place to start.</span></span> <span data-ttu-id="28318-308">如果这些计数器的值不为零，这表明限制 BizTalk 系统中，你可以进一步分析瓶颈的原因。</span><span class="sxs-lookup"><span data-stu-id="28318-308">If the value of these counters is not zero, this indicates throttling in the BizTalk system and you can further analyze the cause of the bottleneck.</span></span> <span data-ttu-id="28318-309">有关的其他性能计数器的说明，请参阅[数据库层中的瓶颈](../technical-guides/bottlenecks-in-the-database-tier.md)。</span><span class="sxs-lookup"><span data-stu-id="28318-309">For descriptions on the other performance counters, see [Bottlenecks in the Database Tier](../technical-guides/bottlenecks-in-the-database-tier.md).</span></span>  
  
## <a name="orchestration-engine-performance-counters"></a><span data-ttu-id="28318-310">业务流程引擎性能计数器</span><span class="sxs-lookup"><span data-stu-id="28318-310">Orchestration engine performance counters</span></span>  
 <span data-ttu-id="28318-311">我们强烈建议你精细优化业务流程运行时设置，因为连续业务流程 dehydration\rehydration 和持久性点可以产生严重影响整体性能。</span><span class="sxs-lookup"><span data-stu-id="28318-311">We strongly recommend that you fine tune orchestration runtime settings because continuous orchestration dehydration\rehydration and persistence points can have a severe impact on overall performance.</span></span>  <span data-ttu-id="28318-312">测试可能包含多个持久性点和事务的作用域的复杂业务流程时，必须使用以下计数器。</span><span class="sxs-lookup"><span data-stu-id="28318-312">You must use the following counters when testing complex orchestrations that may contain multiple persistence points and transactional scopes.</span></span>  
  
|<span data-ttu-id="28318-313">计数器</span><span class="sxs-lookup"><span data-stu-id="28318-313">Counter</span></span>|<span data-ttu-id="28318-314">注释</span><span class="sxs-lookup"><span data-stu-id="28318-314">Comments</span></span>|  
|-------------|--------------|  
|<span data-ttu-id="28318-315">Orchestrations dehydrated/sec</span><span class="sxs-lookup"><span data-stu-id="28318-315">Orchestrations dehydrated/sec</span></span>|<span data-ttu-id="28318-316">平均每秒冻结的业务流程数。</span><span class="sxs-lookup"><span data-stu-id="28318-316">Average number dehydrated per second.</span></span>|  
|<span data-ttu-id="28318-317">Orchestrations rehydrated/sec</span><span class="sxs-lookup"><span data-stu-id="28318-317">Orchestrations rehydrated/sec</span></span>|<span data-ttu-id="28318-318">平均每秒解除冻结的业务流程数。</span><span class="sxs-lookup"><span data-stu-id="28318-318">Average number rehydrated per second.</span></span>|  
|<span data-ttu-id="28318-319">Persistence points/sec</span><span class="sxs-lookup"><span data-stu-id="28318-319">Persistence points/sec</span></span>|<span data-ttu-id="28318-320">平均每秒持久化业务流程实例的次数。</span><span class="sxs-lookup"><span data-stu-id="28318-320">Average number of orchestration instances persisted per second.</span></span>|  
|<span data-ttu-id="28318-321">Orchestrations resident in memory</span><span class="sxs-lookup"><span data-stu-id="28318-321">Orchestrations resident in memory</span></span>|<span data-ttu-id="28318-322">当前以主机实例为宿主的业务流程实例的数量。</span><span class="sxs-lookup"><span data-stu-id="28318-322">Number of orchestration instances currently hosted by the host instance.</span></span>|  
|<span data-ttu-id="28318-323">Orchestrations completed/sec</span><span class="sxs-lookup"><span data-stu-id="28318-323">Orchestrations completed/sec</span></span>|<span data-ttu-id="28318-324">平均每秒完成的业务流程数。</span><span class="sxs-lookup"><span data-stu-id="28318-324">Average number completed per second.</span></span>|  
|<span data-ttu-id="28318-325">Orchestrations suspended/sec</span><span class="sxs-lookup"><span data-stu-id="28318-325">Orchestrations suspended/sec</span></span>|<span data-ttu-id="28318-326">平均每秒挂起的业务流程数。</span><span class="sxs-lookup"><span data-stu-id="28318-326">Average number suspended per second.</span></span>|  
|<span data-ttu-id="28318-327">Transactional scopes committed/sec</span><span class="sxs-lookup"><span data-stu-id="28318-327">Transactional scopes committed/sec</span></span>|<span data-ttu-id="28318-328">平均每秒提交的事务作用域数。</span><span class="sxs-lookup"><span data-stu-id="28318-328">Average number committed per second.</span></span>|  
|<span data-ttu-id="28318-329">Transactional scopes aborted/sec</span><span class="sxs-lookup"><span data-stu-id="28318-329">Transactional scopes aborted/sec</span></span>|<span data-ttu-id="28318-330">平均每秒中止的事务作用域数。</span><span class="sxs-lookup"><span data-stu-id="28318-330">Average number aborted per second.</span></span>|  
|<span data-ttu-id="28318-331">Transactional scopes compensated/sec</span><span class="sxs-lookup"><span data-stu-id="28318-331">Transactional scopes compensated/sec</span></span>|<span data-ttu-id="28318-332">平均每秒补偿的事务作用域数。</span><span class="sxs-lookup"><span data-stu-id="28318-332">Average number compensated per second.</span></span>|  
  
## <a name="backlog-buildup"></a><span data-ttu-id="28318-333">积压工作构建</span><span class="sxs-lookup"><span data-stu-id="28318-333">Backlog buildup</span></span>  
 <span data-ttu-id="28318-334">1-1 部署对于方案 1 的消息 1 的消息中接收结果的位置处理和传输时，如果传出速率不等于的传入速率，没有囤积系统中。</span><span class="sxs-lookup"><span data-stu-id="28318-334">For a 1-1 deployment scenario where 1 message received results in 1 message processed and transmitted, if the outgoing rate does not equal the incoming rate, there is a backlog in the system.</span></span> <span data-ttu-id="28318-335">在此情况下，你可以监视假脱机大小。</span><span class="sxs-lookup"><span data-stu-id="28318-335">In this situation, you can monitor the Spool Size.</span></span> <span data-ttu-id="28318-336">在确定传出速率瓶颈的原因，每次运行单一的用例方案。</span><span class="sxs-lookup"><span data-stu-id="28318-336">When determining the cause of bottlenecks in outgoing rate, run a single use-case scenario at a time.</span></span> <span data-ttu-id="28318-337">隔离业务流程，接收位置，并发送到单独的主机的位置。</span><span class="sxs-lookup"><span data-stu-id="28318-337">Isolate orchestrations, receive locations, and send locations to separate hosts.</span></span>  
  
 <span data-ttu-id="28318-338">将 BizTalk:Message 框： 主机计数器添加到你要监视一台主机的性能监视器日志。</span><span class="sxs-lookup"><span data-stu-id="28318-338">Add the BizTalk:Message Box:Host Counters to your Performance Monitor log to monitor a host.</span></span> <span data-ttu-id="28318-339">主机队列的长度： 计数器可跟踪的特定主机队列中的消息总数。</span><span class="sxs-lookup"><span data-stu-id="28318-339">The Host Queue - Length: counter tracks the total number of messages in a particular host queue.</span></span> <span data-ttu-id="28318-340">如果一个或多个这些计数器将继续增长段时间后，让特别注意的这些主机执行的项目。</span><span class="sxs-lookup"><span data-stu-id="28318-340">If one or more of these counters continues grow over time, give particular attention to the artifacts executed by those hosts.</span></span>  
  
 <span data-ttu-id="28318-341">如果假脱机以线性方式增长，确定哪些应用程序队列负责假脱机增长。</span><span class="sxs-lookup"><span data-stu-id="28318-341">If the Spool is growing linearly, determine which Application Queue is responsible for the Spool growth.</span></span>  
  
 <span data-ttu-id="28318-342">如果没有任何应用程序队列增长和假脱机将不断变大，这可能意味着清除作业是否无法保持同步。</span><span class="sxs-lookup"><span data-stu-id="28318-342">If none of the Application Queues are growing and the Spool continues to grow, it could mean that the purge jobs are unable to keep up.</span></span> <span data-ttu-id="28318-343">如果代理未运行或没有 SQL Server 上的其他系统资源争用，将发生这种情况。</span><span class="sxs-lookup"><span data-stu-id="28318-343">This occurs if the agent is not running or there is other system resource contention on the SQL Server.</span></span>  
  
 <span data-ttu-id="28318-344">如果应用程序队列之一在不断增长，诊断这种增长的原因。</span><span class="sxs-lookup"><span data-stu-id="28318-344">If one of the Application Queues is growing, diagnose the cause of this growth.</span></span> <span data-ttu-id="28318-345">监视无法清空特定的应用程序队列的系统上的系统资源 （例如，业务流程主机-Q 增长由于服务器上的 CPU 资源不足）。</span><span class="sxs-lookup"><span data-stu-id="28318-345">Monitor the system resources on the system that is unable to drain the specific Application Queue (for example, Orchestration Host-Q is growing due to CPU starvation on the server).</span></span> <span data-ttu-id="28318-346">此外，请验证的特定主机实例的限制计数器的值。</span><span class="sxs-lookup"><span data-stu-id="28318-346">In addition, verify the values of the throttling counter for the specific host instance.</span></span>  
  
 <span data-ttu-id="28318-347">如果 BizTalk:Messsage 代理 Message Delivery Throttling State 和消息发布限制状态性能计数器不为零，则检查此值以确认限制的原因 （例如，内存超过了阈值，正在进行的消息计数太最高价、，依此类推）。</span><span class="sxs-lookup"><span data-stu-id="28318-347">If the BizTalk:Messsage Agent Message Delivery Throttling State and Message Publishing Throttling State performance counters are not zero, check the value to confirm the reason for throttling (for example, memory threshold exceeded, in-flight message count too high, and so on).</span></span>  
  
## <a name="stand-alone-profiler"></a><span data-ttu-id="28318-348">独立探查器</span><span class="sxs-lookup"><span data-stu-id="28318-348">Stand-Alone Profiler</span></span>  
 <span data-ttu-id="28318-349">你可以使用性能计数器检测在高级别瓶颈的位置。</span><span class="sxs-lookup"><span data-stu-id="28318-349">You can use performance counters to detect the location of the bottleneck at a high level.</span></span> <span data-ttu-id="28318-350">但是，一旦缩小，你可能需要检查多个代码密切来帮助简化问题。</span><span class="sxs-lookup"><span data-stu-id="28318-350">However, once narrowed down, you might need to examine the code more closely to help ease the problem.</span></span> <span data-ttu-id="28318-351">独立探查器附带使用 Visual Studio 2010 可以是一个非常有帮助的工具，以帮助诊断代码其中花费大部分其周期。</span><span class="sxs-lookup"><span data-stu-id="28318-351">The Stand-Alone Profiler that ships with Visual Studio 2010 can be a very helpful tool to help diagnose where the code is spending most of its cycles.</span></span> <span data-ttu-id="28318-352">有关详细信息，请参阅</span><span class="sxs-lookup"><span data-stu-id="28318-352">For more information, see</span></span>  
  
## <a name="l2l3-cache"></a><span data-ttu-id="28318-353">L2/L3 缓存</span><span class="sxs-lookup"><span data-stu-id="28318-353">L2/L3 cache</span></span>  
 <span data-ttu-id="28318-354">从硬件的角度看，可以通过使用板载 CPU 缓存中获得的最大优势。</span><span class="sxs-lookup"><span data-stu-id="28318-354">From a hardware perspective, you can gain the biggest benefits by using the onboard CPU cache.</span></span> <span data-ttu-id="28318-355">较高的 CPU 高速缓存可增加高速缓存命中率，减少系统在内存和磁盘之间读/写数据页的需要。</span><span class="sxs-lookup"><span data-stu-id="28318-355">Higher CPU cache helps increase cache hit rate reducing the need for the system to page data in and out of memory to disk.</span></span>  
  
## <a name="64-bit-performance-bottlenecks"></a><span data-ttu-id="28318-356">64 位性能瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-356">64-Bit performance bottlenecks</span></span>  
 <span data-ttu-id="28318-357">64 位系统的性能表现可能不如 32 位系统获得的性能。</span><span class="sxs-lookup"><span data-stu-id="28318-357">Performance on 64-bit systems may appear lower than what can be achieved on 32-bit systems.</span></span> <span data-ttu-id="28318-358">这是可能出于几个原因，最重要的一个是内存。</span><span class="sxs-lookup"><span data-stu-id="28318-358">This is possible for a few reasons, the most important one being memory.</span></span>  
  
 <span data-ttu-id="28318-359">具有 2 GB 的内存的 32 位系统上的性能测量和比较的结果具有 2 GB 的内存的类似 64 位系统不比较相同的操作。</span><span class="sxs-lookup"><span data-stu-id="28318-359">Measuring performance on a 32-bit system with 2 GB of memory and comparing the results to a similar 64-bit system with 2 GB of memory is not comparing the same thing.</span></span> <span data-ttu-id="28318-360">64 位系统将显示为磁盘 i/o 绑定 （低 %磁盘空闲时间和高的磁盘队列长度） 和 CPU 限制 （最大 CPU 和高上下文切换）。</span><span class="sxs-lookup"><span data-stu-id="28318-360">The 64-bit system will appear to be disk-I/O bound (low % Disk Idle time & high Disk Queue Length) and CPU bound (max CPU and high context switching).</span></span> <span data-ttu-id="28318-361">但是，这是不是因为在 64 位系统上执行文件 I/O 开销更大。</span><span class="sxs-lookup"><span data-stu-id="28318-361">However, this is not because performing file I/O on a 64-bit system is more expensive.</span></span>  
  
 <span data-ttu-id="28318-362">64 位系统是更多内存密集型 （64 位寻址） 这将导致占用的大部分 2 GB 的可用内存的操作系统。</span><span class="sxs-lookup"><span data-stu-id="28318-362">The 64-bit system is more memory intensive (64-bit addressing) which results in the operating system consuming most of the 2 GB available memory.</span></span> <span data-ttu-id="28318-363">在此情况下，大多数其他操作会导致分页到磁盘的强调文件子系统。</span><span class="sxs-lookup"><span data-stu-id="28318-363">When this happens, most other operations cause paging to disk which stresses the file subsystem.</span></span> <span data-ttu-id="28318-364">因此，系统花费 CPU 周期分页的内存的输入/输出这两个数据和它的代码，并且受成本高的磁盘延迟。</span><span class="sxs-lookup"><span data-stu-id="28318-364">Therefore, the system spends CPU cycles paging in/out of memory both data and code and is impacted by the high disk latency cost.</span></span> <span data-ttu-id="28318-365">它表现为更多的磁盘争用和更多的 CPU 占用。</span><span class="sxs-lookup"><span data-stu-id="28318-365">This manifests itself as both higher disk contention and higher CPU consumption.</span></span>  
  
 <span data-ttu-id="28318-366">为了解决此问题的方法是来向上扩展服务器通过升级内存。</span><span class="sxs-lookup"><span data-stu-id="28318-366">The way to alleviate this problem is to scale-up the server by upgrading the memory.</span></span> <span data-ttu-id="28318-367">向上扩展到 8 GB 是主意，但是，添加更多的内存将不会帮助提高吞吐量，除非源的问题是由于内存不足造成的 CPU 资源不足。</span><span class="sxs-lookup"><span data-stu-id="28318-367">Scaling-up to 8 GB is idea, however, adding more memory will not help improve throughput unless the source of the problem is CPU starvation due to low memory conditions.</span></span>  
  
## <a name="using-bam-to-identify-bottlenecks-and-high-latency-issues"></a><span data-ttu-id="28318-368">使用 BAM 确定瓶颈和高延迟问题</span><span class="sxs-lookup"><span data-stu-id="28318-368">Using BAM to identify bottlenecks and high-latency issues</span></span>  
 <span data-ttu-id="28318-369">重要延迟较低时，你可以使用 BAM 以测量系统完成 BizTalk Server 系统中的每个阶段所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="28318-369">When low-latency is important, you can use BAM to measure the time the system takes to complete each stage within the BizTalk Server system.</span></span> <span data-ttu-id="28318-370">你可以使用 HAT 调试消息的状态和诊断的路由的消息中的问题的根源，但可以使用 BAM 来跟踪各种点通过消息流。</span><span class="sxs-lookup"><span data-stu-id="28318-370">Although you can use HAT to debug the state of messages and diagnose the source of problems in routing messages, you can use BAM to track various points through the message flow.</span></span> <span data-ttu-id="28318-371">通过创建跟踪配置文件用于定义与延续的活动 BAM，您可以衡量系统来帮助跟踪工作流进程中成本最高的阶段的不同部分之间的延迟。</span><span class="sxs-lookup"><span data-stu-id="28318-371">By creating a BAM tracking profile that defines an activity with continuations, you can measure latency between different parts of the system to help track the most expensive stages within the workflow process.</span></span>  
  
 <span data-ttu-id="28318-372">可以使用中 HAT Orchestration 调试器查询的挂起的实例，恢复在调试模式下，实例并添加适当的断点使用技术的详细信息视图。</span><span class="sxs-lookup"><span data-stu-id="28318-372">You can use Orchestration Debugger in HAT to query a suspended instance, resume the instance in debug mode, and add appropriate breakpoints using the Technical Details View.</span></span> <span data-ttu-id="28318-373">这些操作允许您分步跟踪活动和调试消息。</span><span class="sxs-lookup"><span data-stu-id="28318-373">This will enable you to trace the activities and debug messages step by step.</span></span>  
  
 <span data-ttu-id="28318-374">可以设置断点来跟踪以下事件：</span><span class="sxs-lookup"><span data-stu-id="28318-374">You can set breakpoints to track the following events:</span></span>  
  
-   <span data-ttu-id="28318-375">业务流程的启动和结束</span><span class="sxs-lookup"><span data-stu-id="28318-375">The start and finish of an orchestration</span></span>  
  
-   <span data-ttu-id="28318-376">形状的启动和结束</span><span class="sxs-lookup"><span data-stu-id="28318-376">The start and finish of a shape</span></span>  
  
-   <span data-ttu-id="28318-377">消息的发送或接收</span><span class="sxs-lookup"><span data-stu-id="28318-377">The sending or receipt of a message</span></span>  
  
-   <span data-ttu-id="28318-378">异常</span><span class="sxs-lookup"><span data-stu-id="28318-378">Exceptions</span></span>  
  
 <span data-ttu-id="28318-379">在每个断点，您可以查看有关局部变量、消息及其属性、端口和角色链接的信息。</span><span class="sxs-lookup"><span data-stu-id="28318-379">At each breakpoint, you can examine information about local variables, messages and their properties, ports, and role links.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="28318-380">另请参阅</span><span class="sxs-lookup"><span data-stu-id="28318-380">See Also</span></span>  
 [<span data-ttu-id="28318-381">查找并消除瓶颈</span><span class="sxs-lookup"><span data-stu-id="28318-381">Finding and Eliminating Bottlenecks</span></span>](../technical-guides/finding-and-eliminating-bottlenecks.md)