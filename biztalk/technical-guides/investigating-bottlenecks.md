---
title: 调查瓶颈 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 2ab8e485-ffe5-4f71-9ce2-f72c0c939e5d
caps.latest.revision: 6
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 35bb2b4c9d8eef862b2a0b009802b3bd5801320e
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65294809"
---
# <a name="investigating-bottlenecks"></a>调查瓶颈
本主题介绍用于调查瓶颈的建议的过程。  
  
## <a name="what-is-the-source-of-the-problem"></a>问题的根源是什么？  
 瓶颈的根源可能是硬件或软件相关。 当资源得到充分利用时，通常是瓶颈的指示。 通过硬件限制、 软件配置效率低下，或两者，则可能会导致瓶颈。  
  
 确定瓶颈是一个渐进的过程，因此缓解一个问题可能会导致下一个发现。 本主题的目标是科学地确定和缓解这些瓶颈。 很可能以峰值的时间短时间内执行的系统。 但是，为了可承受吞吐量只能作为其执行速度最慢的组件快速处理系统。  
  
## <a name="using-an-iterative-approach-to-testing"></a>使用测试迭代方法  
 瓶颈可能的终结点 （进入/退出） 的系统或中间 （业务流程/数据库）。 瓶颈后，使用结构化的方法来标识源。 减轻瓶颈后，务必要测量其性能以确保，新的瓶颈不引入了其他位置在系统中。  
  
 确定并修复瓶颈的过程应以迭代方式完成。 改变一次只有一个参数，每个测试运行期间，重复相同的步骤，然后进行衡量性能，以验证单个修改的影响。 一次变化多个参数可能会掩盖更改的效果。  
  
 例如，更改参数 1 可能会提高性能。 但是，通过更改参数 1 更改了参数 2 一起使用可能造成不利影响并且抵消更改参数 1 的好处。 这会导致 net 零效果，并且会导致效果的改变参数 1 假负和假阳性上改变参数 2 的效果。  
  
## <a name="testing-consistency"></a>测试一致性  
 应进行更改设置后测量性能有利于验证更改的效果。  
  
-   **硬件-** 使用一致的硬件，因为改变硬件可以导致不一致的行为，并产生误导性结果。 例如，不会使用一台便携式计算机来测试 BizTalk 解决方案的性能。  
  
-   **测试运行持续时间-** 度量值的固定的最短期限以确保结果的可承受性能。 运行时间较长的测试还将确保系统已进行过初始热启动/突增期间其中填充所有缓存、 数据库表已达到预期的计数和限制足够时间进行一次调整吞吐量预定义的命中阈值。 此方法将有助于发现最佳可承受吞吐量。  
  
-   **测试参数 –** 不改变测试参数从测试运行到测试运行。 例如，改变映射复杂性和/或文档大小可能产生不同的吞吐量和延迟结果。  
  
-   **清除状态-** 测试完成后，确保在运行下一个测试之前是干净的测试环境的状态。 例如，历史数据可以累积会影响运行时吞吐量在数据库中。 回收服务实例有助于释放缓存的资源，例如内存、 数据库连接和线程。 在测试环境中，你可能想要创建和执行 bts_CleanupMsgbox 存储过程中所述[如何从 MessageBox 数据库在测试环境中手动清除数据](http://go.microsoft.com/fwlink/?LinkId=158064)(http://go.microsoft.com/fwlink/?LinkId=158064)。 此脚本旨在运行之间返回到全新状态与消息框的 BizTalk Server 测试环境。 该脚本删除所有正在运行的实例，并包括状态、 消息和订阅，这些实例的所有信息，但保留所有激活订阅，因此不需要重新登记业务流程或发送端口。 请注意，此工具不支持在生产系统上。  
  
-   **性能测试和优化-** 此测试类别的目标是最大化性能和吞吐量的应用程序，并查找您的系统的最大可承受吞吐量 (MST)。  有关规划和测量最大可承受性能的详细信息请参阅[规划可持续性能](http://go.microsoft.com/fwlink/?LinkId=158065)(http://go.microsoft.com/fwlink/?LinkId=158065)和[可承受性能？](http://go.microsoft.com/fwlink/?LinkId=132304) (http://go.microsoft.com/fwlink/?LinkId=132304).  
  
     MST 是一个系统可以无限期地处理在生产环境中的消息流量的最高负载。 转到生产环境前，所有 BizTalk 应用程序应进行都测试的性能和吞吐量。 至少应运行测试用例表示的最常见的使用方案的一组有代表性。 我们建议根据预期负载测试并在一个单独的环境与生产环境的特征匹配的峰值负载。 此环境中应具有的所有安装并且正在运行，如监视代理和防病毒软件公司的标准服务。  
  
-   我们还建议在以及正在运行的其他 BizTalk 应用程序的生产环境中测试新的 BizTalk 应用程序在同一硬件上。 这些其他 BizTalk 应用程序将额外的负载放在 BizTalk Server、 SQL Server、 网络 I/O 和磁盘 I/O。 此外，一个 BizTalk 应用程序可能会导致另一个用来限制 （当后台处理深度量变得过大，例如）。 所有 BizTalk 应用程序应都为性能 / 之前的压力测试到生产环境。 此外，应确定需要多长时间的峰值负载从恢复的系统。 如果系统没有完全从此峰值负载下一步的峰值负载发生之前，您已有问题。 系统将获取更多并进一步隐藏，并且永远不会为能够完全恢复。  
  
## <a name="expectations-throughput-vs-latency"></a>期望： 吞吐量与延迟  
 您可以预计一定的吞吐量和/或从已部署系统的滞后时间。 尝试同时实现高吞吐量和低延迟会在系统上的对立的需求。 您可以使用合理的滞后时间期望获得最佳吞吐量。 随着吞吐量提高，压力 （例如，高 CPU 占用率、 更多的磁盘 i/o 争用、 内存压力和更高版本的锁争用） 系统增大时。 这种情况下可以对延迟时间产生负面影响。 若要发现最佳系统容量，我们建议您识别并最大程度减少任何瓶颈。  
  
 已完成的数据库中驻留的实例可能会造成瓶颈。 发生瓶颈后，可能会降低性能。 让系统足够时间来排出可以帮助解决此问题。 发现出现积压的原因并帮助解决此问题很重要。  
  
 若要发现积压的原因，可以分析历史数据和监视性能计数器 （为了发现使用模式和诊断积压的根源）。 通常情况下，当以批处理方式每晚定期处理数据量很大，则会发生积压工作。 你可能会发现可以发现的系统，并且能够从积压中恢复的容量。 此信息可以帮助您评估处理过载情况以及缓冲区的空间量的硬件要求，以容纳系统为处理不可预见的峰值吞吐量。  
  
 监视性能计数器可以帮助区分在运行时可能会出现的潜在瓶颈。 但是，当我们怀疑 CPU 或内存瓶颈的原因可能是构成解决方案的自定义组件之一，我们强烈建议你使用分析工具这种 Visual Studio Profiler 或性能 ANTS Profiler 性能测试期间若要缩小范围，并区分明确地生成问题的类。 很明显，分析应用程序会影响性能。 因此，这些测试应致力于 individuating 这些组件，从而导致内存消耗、 CPU 利用率或延迟，并且应丢弃这些测试期间收集的数字。  
  
 优化系统以最佳可承受吞吐量要求用户深入了解部署的应用程序、 优势和劣势的系统和使用模式的特定方案。 将在生产环境中使用发现瓶颈和预测最佳可承受吞吐量颇有自信地是通过符合什么的拓扑结构进行彻底的测试的唯一方法。 当针对特定用例运行负载测试和压力测试，隔离到单独的主机实例 （接收位置、 发送端口，业务流程） 的单个项目和设置在性能监视器工具中的右计数器是至关重要的缩小瓶颈的原因。  
  
 本部分中的其他主题引导您完成定义该拓扑的过程，并提供有关如何降低和避免瓶颈的指导。  
  
## <a name="scaling"></a>缩放  
 瓶颈可能已部署的拓扑的各个阶段。 某些瓶颈可通过向上扩展或横向扩展环境进行寻址。 纵向扩展是升级现有计算机的过程。 例如，可以在 BizTalk Server 计算机从四处理器计算机升级到八处理器计算机，以及替换现有的 Cpu 和添加更多的 RAM。 这种方式，可提高资源密集型任务，例如文档分析和映射。 向外扩展是将服务器添加到你的部署的过程。 扩展或横向扩展的决定取决于瓶颈和正在配置的应用程序的类型。 应用程序需要将从头开始构建，才能利用扩展或横向扩展。以下指南介绍如何更改硬件部署拓扑基于遇到的瓶颈。  
  
 **向上扩展**上运行的 BizTalk 解决方案的方式升级硬件 （适用于示例中，添加 CPU 和内存）。 您应考虑纵向扩展时 1） 向外扩展成本十分高昂或 2） 向外扩展将帮助解决瓶颈。 例如，可以显著减少所用的时间转换和处理大消息，如果更快的计算机上运行任务。  
  
 **向外扩展**应用程序平台将 BizTalk 节点添加到 BizTalk Server 组和使用它们来运行解决方案的一个或多个部分组成。 应在 1） 需要隔离发送、 接收、 处理、 跟踪主机或 2） 时向外扩展内存、 I/O 或网络 I/O 资源透支的一台服务器。 负载可以分布在多个服务器;但是，将新节点添加到 BizTalk Server 组可以提高在 MessageBox 数据库上的锁争用现象。  
  
 因此应纵向扩展或横向扩展？ 纵向扩展你的平台可以减少的 BizTalk 解决方案的延迟，因为它使单个任务 （例如，消息映射） 运行得更快。 向外扩展可以提高最大可承受 throughtput 和您的 BizTalk 解决方案的可扩展性，因为它允许您以工作负荷分散到多台计算机。  
  
## <a name="see-also"></a>请参阅  
 [查找并消除瓶颈](../technical-guides/finding-and-eliminating-bottlenecks.md)