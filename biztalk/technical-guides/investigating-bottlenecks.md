---
title: "调查瓶颈 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 2ab8e485-ffe5-4f71-9ce2-f72c0c939e5d
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e34d01bbfafd1a05f87fff5cda2b21764d43f42b
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="investigating-bottlenecks"></a>调查瓶颈
本主题介绍用于调查瓶颈的建议的过程。  
  
## <a name="what-is-the-source-of-the-problem"></a>问题的源是什么？  
 瓶颈的根源可能是硬件或软件相关。 当资源得到充分利用时，它通常是瓶颈的相对值。 通过硬件限制、 低效软件配置，或两个，则可能导致瓶颈。  
  
 确定瓶颈是一个渐进式的过程，因此缓解一个问题可能导致发现下一个过程。 本主题的目标就是帮助您科学地确定和缓解这些瓶颈。 系统有可能在短期内以峰值执行。 但为了可承受吞吐量，系统只能按其执行速度最慢的组件的最快速度进行处理。  
  
## <a name="using-an-iterative-approach-to-testing"></a>使用测试迭代方法  
 瓶颈可以出现在终结点 （输入/退出） 的系统或中间 （orchestration/数据库）。 独立瓶颈后，使用结构化的方法来标识源。 可以简化瓶颈后，务必来测量其性能以确保，新瓶颈不引入了其他位置在系统中。  
  
 以迭代方式应进行确定并修复瓶颈的过程。 改变一次只有一个参数，在每个测试运行，期间重复相同的步骤，然后度量性能，以验证单个修改的影响。 一次变化多个参数可能会掩盖更改结果。  
  
 例如，更改参数 1 可能会提高性能。 但是，与更改参数 1 更改参数 2 结合无法造成不利影响并且 negate 更改参数 1 的好处。 这指向 net 零效果并导致中在不同的参数 1 的效果假负和假阳性上不同参数 2 的效果。  
  
## <a name="testing-consistency"></a>测试的一致性  
 应进行更改设置后测量性能特征来验证更改的效果。  
  
-   **硬件-**使用一致的硬件，因为不同的硬件可以导致不一致的行为，并且生成误导性结果。 例如，不会使用便携式计算机来测试 BizTalk 解决方案的性能。  
  
-   **测试运行持续时间-**测量固定的最短期限以确保结果的可持续的性能。 运行更长时间测试还确保系统已通过段，其中的所有缓存进行都填充，数据库表已达到预期的计数和限制给定足够的时间，可以一次调节吞吐量，以预定义的初始热/提升阈值，则命中。 此方法将有助于发现最佳可承受吞吐量。  
  
-   **测试参数 –**不发生更改从测试运行将测试运行的测试参数。 例如，改变映射复杂性和/或文档大小可能产生不同的吞吐量和延迟结果。  
  
-   **清除状态-**测试已完成后，请确保在运行下一步的测试之前已清理测试环境的状态。 例如，影响运行时吞吐量数据库中的生成可以历史数据。 回收服务实例有助于释放内存、 数据库连接等线程缓存的资源。 在测试环境中，你可能想要创建和执行 bts_CleanupMsgbox 存储过程中所述[如何手动清除数据从测试环境中的 MessageBox 数据库](http://go.microsoft.com/fwlink/?LinkId=158064)(http://go.microsoft.com/fwlink/?LinkId=158064)。 此脚本旨在运行之间返回到消息框方面的新状态的 BizTalk Server 测试环境。 该脚本删除所有正在运行的实例以及所有信息包括状态、 消息以及订阅，这些实例，但保留所有激活订阅，因此不需要重新登记你业务流程或发送端口。 请注意，此工具不支持在生产系统上。  
  
-   **性能测试和优化-**此测试类别的目标是能够最大程度提高性能和吞吐量的你的应用程序，并查找你的系统的最大可持续吞吐量 (MST)。  有关规划和最大可持续性能测量的详细信息请参阅[持续性能规划](http://go.microsoft.com/fwlink/?LinkId=158065)(http://go.microsoft.com/fwlink/?LinkId=158065) 和[什么是可持续的性能？](http://go.microsoft.com/fwlink/?LinkId=132304) (http://go.microsoft.com/fwlink/?LinkId=132304)。  
  
     MST 是一个系统可以无限期地处理在生产环境中的消息流量的最高负载。 在投入生产之前，所有的 BizTalk 应用程序应进行测试的性能和吞吐量。 至少，你应运行一组代表表示最常见的使用方案的测试用例。 我们建议对预期的负载测试和峰值负载在匹配的生产环境的特征的单独环境中。 此环境应具有的所有公司的标准服务安装和运行，如监视代理和防病毒软件。  
  
-   我们还建议在生产环境旁边运行其他 BizTalk 应用程序中测试新的 BizTalk 应用程序相同的硬件上。 这些其他 BizTalk 应用程序放在 BizTalk Server、 SQL Server、 网络 I/O 和磁盘 I/O 上的额外的负载。 此外，一个 BizTalk 应用程序可能会导致另一个用来限制 （当假脱机深度获取太大，例如）。 所有的 BizTalk 应用程序应性能 / 压力之前测试到生产环境。 此外，你应该确定时间系统来恢复从峰值负载。 如果系统未完全恢复从峰值负载下, 一步的峰值负载发生之前，你已遇到了问题。 系统将获取更多和进一步隐藏，并将永远无法完全恢复。  
  
## <a name="expectations-throughput-vs-latency"></a>预期： 吞吐量与延迟  
 你可以期望了一定数量的吞吐量和/或从已部署的系统的延迟。 尝试同时实现高吞吐量和低延迟在系统上放置对立的需求。 使用合理的滞后时间，则可能会获得最佳吞吐量。 提高了吞吐量，压力 （例如，更高的 CPU 占用率、 更高的磁盘-/ O 争用、 内存压力和更高版本的锁争用） 系统增大。 这种情况下可以减少延迟产生负面影响。 若要发现的系统的最佳容量，我们建议你确定并最大程度减少任何瓶颈。  
  
 已完成的实例驻留在数据库中可能会导致瓶颈。 出现瓶颈时，可能会降低性能。 提供系统足够时间来排出可以帮助解决此问题。 发现的积压工作构建的原因并帮助解决此问题很重要。  
  
 若要发现的积压工作的原因，你可以分析的历史数据和监视性能计数器 （以发现使用模式并诊断积压工作的源）。 通常情况下，当以批处理方式夜处理大量数据，则会发生积压工作。 你可能发现可以发现的系统，并且能够从积压工作中恢复的容量。 此信息可以帮助你可用于估计用于处理 overdrive 方案和的缓冲区空间量的硬件要求以适应系统以应对出现未预见的峰值吞吐量中。  
  
 监视性能计数器可以帮助区分在运行时也可能会发生的潜在瓶颈。 但是，当我们怀疑 CPU 或内存瓶颈的原因可能是一个自定义组件构成解决方案，我们强烈建议你使用分析工具此类的 Visual Studio 探查器或蚂蚁性能探查器性能测试期间若要缩小范围，并区分明确地生成问题的类。 显然，分析应用程序会影响性能。 因此，这些测试应致力于 individuating 这些组件，从而导致内存消耗、 CPU 使用率或延迟，并且应丢弃这些测试期间收集的数字。  
  
 要获得最佳可持续吞吐量需要丰富的优化系统了解部署的应用程序、 优点和缺点，系统，以及使用方式的特定方案。 发现瓶颈和准确预测最佳可承受吞吐量的唯一方式就是通过对非常契合生产中使用情况的拓扑结构进行全面测试。 当针对特定用例中运行负载测试和压力测试，隔离到单独的主机实例 （接收位置，发送端口业务流程） 的单个项目和设置在性能监视器工具中的右计数器至关重要缩小瓶颈的原因。  
  
 本部分中的其他主题指导你完成定义该拓扑的过程，并提供指导如何降低和避免瓶颈。  
  
## <a name="scaling"></a>缩放  
 瓶颈可以出现在各个阶段的部署拓扑。 可以通过向上缩放或横向扩展环境寻址某些瓶颈。 向上扩展是升级现有的计算机的过程。 例如，可以升级从四处理器计算机 BizTalk Server 计算机到八个处理器的计算机，以及替换现有的 Cpu 和添加更多的 RAM。 这种方式，可以加快占用大量资源的任务，例如文档分析和映射。 向外扩展是将服务器添加到你的部署的过程。 若要向上或向外缩放的决策取决于瓶颈和正在配置的应用程序的类型。 应用程序需要构建从头，才能利用的增加或扩大。以下指南说明如何更改基于遇到瓶颈的硬件部署拓扑。  
  
 **向上缩放**上运行 BizTalk 解决方案的方式升级的硬件 （例如，添加 CPU 和内存）。 你应查看 1） 向外扩展是过于昂贵或 2） 向外扩展将不会帮助解决瓶颈时向上扩展。 例如，你可以显著减少所用的时间转换和处理大消息，如果你更快的计算机上运行任务。  
  
 **向外扩展**将 BizTalk 节点添加到 BizTalk Server 组和使用它们来运行的解决方案的一个或多个部分的应用程序平台组成。 你应该查看向外扩展，当 1） 你需要以隔离发送、 接收，处理、 跟踪主机或者 2） 当内存，I/O 或网络 I/O 资源将达到最大值出对单台服务器。 负载可以跨多个服务器;但是，将新节点添加到 BizTalk Server 组可以增加 MessageBox 数据库上的锁争用。  
  
 因此应向上扩展或向外扩展？ 按比例增加你的平台可以减少 BizTalk 解决方案的延迟，因为它使单个任务 （例如，消息映射） 运行得更快。 向外扩展可以提高最大可持续吞吐量和 BizTalk 解决方案的可伸缩性因为它可让你能够将工作负荷散布到多台计算机。  
  
## <a name="see-also"></a>另请参阅  
 [查找并消除瓶颈](../technical-guides/finding-and-eliminating-bottlenecks.md)