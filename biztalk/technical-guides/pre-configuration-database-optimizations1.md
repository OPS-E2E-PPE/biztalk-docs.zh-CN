---
title: "预配置数据库 Optimizations1 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: ebd0b32a-490d-4db2-a1fc-bf3bef93aeea
caps.latest.revision: "9"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3c1333f956afc4411ff8b105c777214467155ae7
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="pre-configuration-database-optimizations"></a><span data-ttu-id="d5514-102">预配置数据库优化</span><span class="sxs-lookup"><span data-stu-id="d5514-102">Pre-Configuration Database Optimizations</span></span>
<span data-ttu-id="d5514-103">BizTalk Server 是极占用大量数据库的应用程序可能需要在创建 Microsoft SQL Server 中的最多 13 单独数据库。</span><span class="sxs-lookup"><span data-stu-id="d5514-103">BizTalk Server is an extremely database-intensive application that may require the creation of up to 13 separate databases in Microsoft SQL Server.</span></span> <span data-ttu-id="d5514-104">由于 SQL Server 在任何 BizTalk Server 环境中所扮演的重要角色，它是一项极其重要，SQL Server 配置/优化以获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="d5514-104">Because of the critical role that SQL Server plays in any BizTalk Server environment, it is of paramount importance that SQL Server is configured/tuned for optimal performance.</span></span> <span data-ttu-id="d5514-105">如果 SQL Server 不优化很好地运行，然后使用 BizTalk Server 的数据库将成为瓶颈和 BizTalk Server 环境的整体性能将会降低。</span><span class="sxs-lookup"><span data-stu-id="d5514-105">If SQL Server is not tuned to perform well, then the databases used by BizTalk Server will become a bottleneck and the overall performance of the BizTalk Server environment will suffer.</span></span> <span data-ttu-id="d5514-106">本主题介绍在安装 BizTalk Server 并配置 BizTalk Server 数据库之前，应遵循的几个 SQL Server 性能优化。</span><span class="sxs-lookup"><span data-stu-id="d5514-106">This topic describes several SQL Server performance optimizations that should be followed before installing BizTalk Server and configuring the BizTalk Server databases.</span></span>  
  
## <a name="set-ntfs-file-allocation-unit"></a><span data-ttu-id="d5514-107">设置 NTFS 文件分配单元</span><span class="sxs-lookup"><span data-stu-id="d5514-107">Set NTFS File Allocation Unit</span></span>  
 <span data-ttu-id="d5514-108">SQL Server 将在其数据存储**扩展盘区**，这是组的八个 8k 页。</span><span class="sxs-lookup"><span data-stu-id="d5514-108">SQL Server stores its data in **Extents**, which are groups of eight 8K pages.</span></span> <span data-ttu-id="d5514-109">因此，若要优化磁盘性能，NTFS 分配单元大小设置为 64 KB 最佳做法文章预部署 I/O 最佳实践"在 SQL Server 的"磁盘配置最佳做法"部分中所述[http://go.microsoft.com/fwlink/？LinkId = 140818](http://go.microsoft.com/fwlink/?LinkId=140818)。</span><span class="sxs-lookup"><span data-stu-id="d5514-109">Therefore, to optimize disk performance, set the NTFS Allocation Unit size to 64KB as described in the “Disk Configuration Best Practices” section of the SQL Server best practices article “Predeployment I/O Best Practices” available at [http://go.microsoft.com/fwlink/?LinkId=140818](http://go.microsoft.com/fwlink/?LinkId=140818).</span></span> <span data-ttu-id="d5514-110">有关 SQL Server 页和区的详细信息请参阅[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]联机丛书主题[了解页和区](http://go.microsoft.com/fwlink/?LinkId=148939)(超链接"http://go.microsoft.com/fwlink/?LinkId=148939"http://go.microsoft.com/fwlink/?LinkId=148939)。</span><span class="sxs-lookup"><span data-stu-id="d5514-110">For more information about SQL Server pages and extents see the [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] Books Online topic [Understanding Pages and Extents](http://go.microsoft.com/fwlink/?LinkId=148939) ( HYPERLINK "http://go.microsoft.com/fwlink/?LinkId=148939" http://go.microsoft.com/fwlink/?LinkId=148939).</span></span>  
  
## <a name="database-planning-considerations"></a><span data-ttu-id="d5514-111">数据库的规划注意事项</span><span class="sxs-lookup"><span data-stu-id="d5514-111">Database planning considerations</span></span>  
 <span data-ttu-id="d5514-112">我们建议你托管你[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]快速存储 （例如，快速 SAN 磁盘或快速 SCSI 磁盘） 上的数据库。</span><span class="sxs-lookup"><span data-stu-id="d5514-112">We recommend that you host your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases on fast storage (for example, fast SAN disks or fast SCSI disks).</span></span> <span data-ttu-id="d5514-113">我们建议而不是 RAID 5 RAID 10 (1 + 0)，因为 raid 5 是写入速度要慢。</span><span class="sxs-lookup"><span data-stu-id="d5514-113">We recommend RAID 10 (1+0) instead of RAID 5 because raid 5 is slower at writing.</span></span> <span data-ttu-id="d5514-114">较新的 SAN 磁盘具有非常大的内存缓存，在这些情况下，RAID 选择不是那么重要。</span><span class="sxs-lookup"><span data-stu-id="d5514-114">Newer SAN disks have very large memory caches, so in these cases, the RAID selection is not as important.</span></span> <span data-ttu-id="d5514-115">若要提高性能，数据库和其日志文件可以位于不同的物理磁盘。</span><span class="sxs-lookup"><span data-stu-id="d5514-115">To increase performance, databases and their log files can reside on different physical disks.</span></span>  
  
## <a name="install-the-latest-service-pack-and-cumulative-updates-for-sql-server"></a><span data-ttu-id="d5514-116">为 SQL Server 安装的最新 service pack 和累积更新</span><span class="sxs-lookup"><span data-stu-id="d5514-116">Install the latest service pack and cumulative updates for SQL Server</span></span>  
 <span data-ttu-id="d5514-117">为 SQL Server 2005 和 SQL Server 2008，以及最新的.NET Framework service pack 安装最新的 service pack 和最新的累积更新。</span><span class="sxs-lookup"><span data-stu-id="d5514-117">Install the latest service packs and the latest cumulative updates for SQL Server 2005 and SQL Server 2008 as well as the latest .NET Framework service packs.</span></span>  
  
## <a name="install-sql-service-packs-on-both-biztalk-server-and-sql-server"></a><span data-ttu-id="d5514-118">在 BizTalk Server 和 SQL Server 上安装 SQL Service Pack</span><span class="sxs-lookup"><span data-stu-id="d5514-118">Install SQL Service Packs on both BizTalk Server and SQL Server</span></span>  
 <span data-ttu-id="d5514-119">安装时 SQL Server service pack，还在 BizTalk Server 计算机上安装 service pack。</span><span class="sxs-lookup"><span data-stu-id="d5514-119">When installing service packs for SQL Server, also install the service pack on the BizTalk Server computer.</span></span> <span data-ttu-id="d5514-120">BizTalk Server 使用的 SQL Server service pack 更新的 SQL 客户端组件。</span><span class="sxs-lookup"><span data-stu-id="d5514-120">BizTalk Server uses SQL Client components that are updated by the SQL Server service packs.</span></span>  
  
## <a name="consider-implementing-the-sql-server-2008-data-collector-and-management-data-warehouse"></a><span data-ttu-id="d5514-121">请考虑实施的 SQL Server 2008 数据收集器和管理数据仓库</span><span class="sxs-lookup"><span data-stu-id="d5514-121">Consider implementing the SQL Server 2008 Data Collector and Management Data Warehouse</span></span>  
 <span data-ttu-id="d5514-122">SQL Server 2008 还包含新的使用数据收集器和管理数据仓库收集环境/数据库性能相关的数据以进行测试和趋势分析。</span><span class="sxs-lookup"><span data-stu-id="d5514-122">SQL Server 2008 accommodates the use of the new Data Collector and Management Data Warehouse to collect environment/database performance related data for test and trend analysis.</span></span> <span data-ttu-id="d5514-123">数据收集器保持到指定的管理数据仓库收集的所有数据。</span><span class="sxs-lookup"><span data-stu-id="d5514-123">The Data Collector persists all collected data to the specified Management Data Warehouse.</span></span> <span data-ttu-id="d5514-124">虽然这不是一种性能优化，这将是可用于分析的任何性能问题。</span><span class="sxs-lookup"><span data-stu-id="d5514-124">While this is not a performance optimization, this will be useful for analysis of any performance issues.</span></span>  
  
## <a name="grant-the-account-which-is-used-for-sql-server-the-windows-lock-pages-in-memory-privilege"></a><span data-ttu-id="d5514-125">授予用于针对 SQL Server Windows 锁定页内存特权的帐户</span><span class="sxs-lookup"><span data-stu-id="d5514-125">Grant the account which is used for SQL Server the Windows Lock Pages In Memory privilege</span></span>  
 <span data-ttu-id="d5514-126">授予 Windows"锁定内存页"权限的 SQL Server 服务帐户。</span><span class="sxs-lookup"><span data-stu-id="d5514-126">Grant the Windows “Lock Pages in Memory” privilege to the SQL Server service account.</span></span> <span data-ttu-id="d5514-127">这应为了防止出 SQL Server 进程的缓冲池内存分页 Windows 操作系统通过锁定在物理内存中缓冲池分配的内存。</span><span class="sxs-lookup"><span data-stu-id="d5514-127">This should be done to prevent the Windows operating system from paging out the buffer pool memory of the SQL Server process by locking memory that is allocated for the buffer pool in physical memory.</span></span> <span data-ttu-id="d5514-128">有关详细信息，请在参阅 Microsoft 知识库文章 914483"如何减少的 64 位版本的 SQL Server 2005 的缓冲池内存分页" [http://go.microsoft.com/fwlink/?LinkId=148948](http://go.microsoft.com/fwlink/?LinkId=148948)。</span><span class="sxs-lookup"><span data-stu-id="d5514-128">For more information, see Microsoft Knowledge Base article 914483 “How to reduce paging of buffer pool memory in the 64-bit version of SQL Server 2005” at [http://go.microsoft.com/fwlink/?LinkId=148948](http://go.microsoft.com/fwlink/?LinkId=148948).</span></span>  
  
## <a name="grant-the-semanagevolumename-right-to-the-sql-server-service-account"></a><span data-ttu-id="d5514-129">授予 SQL Server 服务帐户从右到 SE_MANAGE_VOLUME_NAME</span><span class="sxs-lookup"><span data-stu-id="d5514-129">Grant the SE_MANAGE_VOLUME_NAME right to the SQL Server Service account</span></span>  
 <span data-ttu-id="d5514-130">确保运行 SQL Server 服务的帐户具有"执行卷维护任务"Windows 特权，或确保它属于安全组的作用。</span><span class="sxs-lookup"><span data-stu-id="d5514-130">Ensure the account running the SQL Server service has the “Perform Volume Maintenance Tasks” Windows privilege or ensure it belongs to a security group which does.</span></span> <span data-ttu-id="d5514-131">这将允许确保最佳性能，如果数据库必须自动增长的即时文件初始化。</span><span class="sxs-lookup"><span data-stu-id="d5514-131">This will allow instant file initialization ensuring optimum performance if a database has to auto-grow.</span></span>  
  
## <a name="set-min-and-max-server-memory"></a><span data-ttu-id="d5514-132">设置最小值和最大服务器内存</span><span class="sxs-lookup"><span data-stu-id="d5514-132">Set Min and Max Server Memory</span></span>  
 <span data-ttu-id="d5514-133">运行的计算机[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]应将专用于运行 SQL Server 的 BizTalk Server 数据库，将该主机。</span><span class="sxs-lookup"><span data-stu-id="d5514-133">The computers running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] that host the BizTalk Server databases should be dedicated to running SQL Server.</span></span> <span data-ttu-id="d5514-134">我们建议的"min server memory"和"最大服务器内存"选项卡上的每个 SQL Server 实例设置为指定的固定要分配给 SQL Server 的内存量。</span><span class="sxs-lookup"><span data-stu-id="d5514-134">We recommend that the “min server memory” and “max server memory” options on each SQL Server instance are set to specify the fixed amount of memory to allocate to SQL Server.</span></span> <span data-ttu-id="d5514-135">在这种情况下，应将设置为"min server memory"和"最大服务器内存"为相同的值 （等于最大的 SQL Server 将使用的物理内存量）。</span><span class="sxs-lookup"><span data-stu-id="d5514-135">In this case, you should set the “min server memory” and “max server memory” to the same value (equal to the maximum amount of physical memory that SQL Server will use).</span></span> <span data-ttu-id="d5514-136">这将减少开销，否则将使用 SQL server 动态地管理这些值。</span><span class="sxs-lookup"><span data-stu-id="d5514-136">This will reduce overhead that would otherwise be used by SQL Server dynamically managing these values.</span></span> <span data-ttu-id="d5514-137">若要指定要分配给 SQL Server 的内存固定的量每个 SQL Server 计算机上运行以下 T-SQL 命令：</span><span class="sxs-lookup"><span data-stu-id="d5514-137">Run the following T-SQL commands on each SQL Server computer to specify the fixed amount of memory to allocate to SQL Server:</span></span>  
  
```  
sp_configure ‘Max Server memory (MB)’,(max size in MB)  
sp_configure ‘Min Server memory (MB)’,(min size in MB)  
```  
  
 <span data-ttu-id="d5514-138">为 SQL Server 设置的内存量之前，请通过减去所需的总物理内存从 Windows Server 的内存确定适当的内存设置。</span><span class="sxs-lookup"><span data-stu-id="d5514-138">Before you set the amount of memory for SQL Server, determine the appropriate memory setting by subtracting the memory required for Windows Server from the total physical memory.</span></span> <span data-ttu-id="d5514-139">这是内存的最大可以为 SQL Server 分配量。</span><span class="sxs-lookup"><span data-stu-id="d5514-139">This is the maximum amount of memory you can assign to SQL Server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d5514-140">如果该主机在运行 SQL Server 的计算机的 BizTalk Server 数据库也承载企业单一登录在主密钥服务器，然后你可能需要调整此值，以确保有足够的内存可用于运行 Enterprise 上单一登录服务。</span><span class="sxs-lookup"><span data-stu-id="d5514-140">If the computer(s) running SQL Server that host the BizTalk Server databases also host the Enterprise Single Sign-On Master Secret Server, then you may need to adjust this value to ensure that there is sufficient memory available to run the Enterprise Single Sign-On Service.</span></span> <span data-ttu-id="d5514-141">它不是一种常见的做法，在 SQL Server 群集，以便提供高可用性的主密钥服务器上运行企业单一登录服务的群集的实例。</span><span class="sxs-lookup"><span data-stu-id="d5514-141">It is not an uncommon practice to run a clustered instance of the Enterprise Single Sign-On service on a SQL Server cluster to provide high availability for the Master Secret Server.</span></span> <span data-ttu-id="d5514-142">有关群集企业单一登录在主密钥服务器的详细信息，请参阅主题"如何群集主机密服务器"中[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]文档[http://go.microsoft.com/fwlink/?LinkID=106874](http://go.microsoft.com/fwlink/?LinkID=106874)。</span><span class="sxs-lookup"><span data-stu-id="d5514-142">For more information about clustering the Enterprise Single Sign-On Master Secret Server, see the topic “How to Cluster the Master Secret Server” in the [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]documentation at [http://go.microsoft.com/fwlink/?LinkID=106874](http://go.microsoft.com/fwlink/?LinkID=106874).</span></span>  
  
## <a name="split-the-tempdb-database-into-multiple-data-files-of-equal-size-on-each-sql-server-instance-used-by-biztalk-server"></a><span data-ttu-id="d5514-143">将 tempdb 数据库拆分为多个大小相等的 BizTalk Server 使用的每个 SQL Server 实例上的数据文件</span><span class="sxs-lookup"><span data-stu-id="d5514-143">Split the tempdb database into multiple data files of equal size on each SQL Server instance used by BizTalk Server</span></span>  
 <span data-ttu-id="d5514-144">确保用于 tempdb 数据文件为相等的大小非常重要，因为按比例填充算法使用[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]取决于数据文件的大小。</span><span class="sxs-lookup"><span data-stu-id="d5514-144">Ensuring that the data files used for the tempdb are of equal size is critical because the proportional fill algorithm used by [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] is based on the size of the data files.</span></span> <span data-ttu-id="d5514-145">此算法将尝试确保[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]与成比例的可用空间的每个文件保留在该文件，以便到达几乎同时在其最大容量的填充。</span><span class="sxs-lookup"><span data-stu-id="d5514-145">This algorithm attempts to ensure that [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] fills each file in proportion to the free space left in that file so that they reach their maximum capacity at about the same time.</span></span> <span data-ttu-id="d5514-146">如果数据文件创建不相等的大小，按比例填充算法将使用多个 GAM 分配，而无需分配所有的文件，从而与将创建多个数据文件的目的之间分配的最大文件。</span><span class="sxs-lookup"><span data-stu-id="d5514-146">If data files are created with unequal sizes, the proportional fill algorithm will use the largest file more for GAM allocations rather than spreading the allocations between all the files, thereby defeating the purpose of creating multiple data files.</span></span> <span data-ttu-id="d5514-147">Tempdb 数据库的数据文件数应配置为至少等于分配给 SQL Server 的处理器数。</span><span class="sxs-lookup"><span data-stu-id="d5514-147">The number of data files for the tempdb database should be configured to be at least equal to the number of processors assigned for SQL Server.</span></span>  
  
## <a name="enable-trace-flag-t1118-as-a-startup-parameter-for-all-instances-of-sql-server"></a><span data-ttu-id="d5514-148">启用跟踪标志 T1118 作为引导参数的 SQL Server 的所有实例</span><span class="sxs-lookup"><span data-stu-id="d5514-148">Enable Trace Flag T1118 as a startup parameter for all instances of SQL Server</span></span>  
 <span data-ttu-id="d5514-149">实现跟踪标志-T1118 可帮助减少争用跨 SQL Server 实例删除几乎所有的单页分配。</span><span class="sxs-lookup"><span data-stu-id="d5514-149">Implementing Trace Flag –T1118 helps reduce contention across the SQL Server instances by removing almost all single page allocations.</span></span> <span data-ttu-id="d5514-150">有关详细信息，请参阅 Microsoft 知识库文章 328551"PRB： 并发增强功能 tempdb 数据库的"在[http://go.microsoft.com/fwlink/?LinkID=103713](http://go.microsoft.com/fwlink/?LinkID=103713)。</span><span class="sxs-lookup"><span data-stu-id="d5514-150">For more information, see Microsoft Knowledge Base article 328551 "PRB: Concurrency enhancements for the tempdb database" at [http://go.microsoft.com/fwlink/?LinkID=103713](http://go.microsoft.com/fwlink/?LinkID=103713).</span></span>  
  
## <a name="do-not-change-default-sql-server-settings-for-max-degree-of-parallelism-sql-server-statistics-or-database-index-rebuilds-and-defragmentation"></a><span data-ttu-id="d5514-151">不更改默认的最大并行度、 SQL Server 统计信息或数据库索引重新生成和碎片整理度的 SQL Server 设置</span><span class="sxs-lookup"><span data-stu-id="d5514-151">Do not change default SQL Server settings for max degree of parallelism, SQL Server statistics, or database index rebuilds and defragmentation</span></span>  
 <span data-ttu-id="d5514-152">如果 SQL Server 实例将承载 BizTalk Server 数据库，则某些 SQL Server 设置应不会更改。</span><span class="sxs-lookup"><span data-stu-id="d5514-152">If a SQL Server instance will house BizTalk Server databases, then certain SQL Server settings should not be changed.</span></span> <span data-ttu-id="d5514-153">具体而言，SQL Server 最大并行度，MessageBox 数据库和数据库索引的设置的 SQL Server 统计信息将重新生成并不应修改碎片整理。</span><span class="sxs-lookup"><span data-stu-id="d5514-153">Specifically, the SQL Server max degree of parallelism, the SQL Server statistics on the MessageBox database, and the settings for the database index rebuilds and defragmentation should not be modified.</span></span> <span data-ttu-id="d5514-154">详细信息，请参阅主题"SQL Server 设置，不应更改"在 BizTalk Server 操作指南中[http://go.microsoft.com/fwlink/?LinkId=114358](http://go.microsoft.com/fwlink/?LinkId=114358)。</span><span class="sxs-lookup"><span data-stu-id="d5514-154">For more information, see the topic “SQL Server Settings That Should Not Be Changed” in the BizTalk Server Operations Guide at [http://go.microsoft.com/fwlink/?LinkId=114358](http://go.microsoft.com/fwlink/?LinkId=114358).</span></span>