---
title: "清单： HYPER-V 上测量性能 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f32c95f4-a4eb-412b-9fa7-140e80b85e5a
caps.latest.revision: "13"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 806f1efb67205771a1e202c8bafd77a493d584e4
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="checklist-measuring-performance-on-hyper-v"></a>清单： HYPER-V 上测量性能
虽然大部分分析性能的来宾操作系统安装在 HYPER-V 虚拟机性能的原则是与分析的物理计算机上安装操作系统的性能相同，许多集合方法都是不同的结果。 计算的性能时，应作为快速参考使用以下章节你[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]HYPER-V 虚拟机上安装来宾操作系统上运行的解决方案。  
  
## <a name="measuring-disk-io-performance"></a>测量磁盘 I/O 性能  
 使用以下性能监视器计数器测量 HYPER-V 虚拟机上安装来宾操作系统上的磁盘 I/O 性能：  
  
|步骤|参考|  
|----------|---------------|  
|**度量值在 HYPER-V 主机操作系统上的磁盘延迟**– 在 HYPER-V 主机操作系统上的磁盘性能的最佳初始指示器获取通过使用"\Logical \Avg 磁盘 （*）。Disk sec/Read"和"\Logical 磁盘 (\*) \Avg。Disk sec/Write"性能监视器计数器。 这些性能监视器计数器测量读取和写入操作时间，以响应的操作系统的时间的量。 作为一个常规的经验法则，平均响应时间大于时间被视为非最优。 作为一个常规的经验法则，平均响应时间大于时间被视为非最优。 这依赖于典型查找单个 7200 RPM 磁盘驱动器，而无需缓存的时间。 建议的物理磁盘性能监视器计数器与逻辑磁盘使用，因为 Windows 应用程序和服务利用表示为呈现给操作系统的物理磁盘 (LUN) 可以是其中的驱动器号的逻辑驱动器组成磁盘阵列中的多个物理磁盘驱动器。 使用以下规则的经验法则，在衡量使用 \Logical 磁盘的 HYPER-V 主机操作系统上的磁盘延迟 (\*) \Avg。磁盘 sec/Read 或 \Logical 磁盘 (\*) \Avg。磁盘 sec/Write 性能监视器计数器：<br /><br /> 这依赖于典型查找单个 7200 RPM 磁盘驱动器，而无需缓存的时间。 建议的物理磁盘性能监视器计数器与逻辑磁盘使用，因为 Windows 应用程序和服务利用表示为呈现给操作系统的物理磁盘 (LUN) 可以是其中的驱动器号的逻辑驱动器组成磁盘阵列中的多个物理磁盘驱动器。 使用以下规则的经验法则，在衡量使用 \Logical 磁盘的 HYPER-V 主机操作系统上的磁盘延迟 (\*) \Avg。磁盘 sec/Read 或 \Logical 磁盘 (\*) \Avg。磁盘 sec/Write 性能监视器计数器：<br /><br /> -1 毫秒到时间 = 正常<br />-时间到毫秒 = 警告或监视器<br />-26ms年或更高版本 = 严重，性能将会受到不利影响**注意：**在非虚拟化环境中安装的物理磁盘提供更好的性能比访问通过 HYPER-V 主机操作系统的磁盘。 如果磁盘性能对你的应用程序的总体性能绝对至关重要，请考虑托管在仅物理硬件上的磁盘。 **注意：**评估磁盘 I/O 性能时，请确保配置防病毒软件扫描的任何磁盘分区的计算中排除。 防病毒扫描造成可能会产生负面影响性能和倾斜测试结果的开销。 <br /><br /> **度量值在来宾操作系统上的磁盘延迟**– 可以使用用于测量响应时间的 HYPER-V 主机操作系统所使用的磁盘相同的性能监视器计数器测量响应时间的来宾操作系统所使用的磁盘系统。|有关磁盘性能分析的详细信息，请参阅以下资源：<br /><br /> -"的 HYPER-V 中运行 SQL Server 的性能开销"部分中的"运行 SQL Server 2008 in a HYPER-V 环境 – 最佳做法和性能注意事项"白皮书，网址[http://go.microsoft.com/fwlink/?LinkId=144622](http://go.microsoft.com/fwlink/?LinkId=144622)。<br />-允许在磁盘密集型问题[http://go.microsoft.com/fwlink/?LinkId=120947](http://go.microsoft.com/fwlink/?LinkId=120947)。<br />SQL 服务器预部署 I/O 最佳实践在[http://go.microsoft.com/fwlink/?LinkId=120948](http://go.microsoft.com/fwlink/?LinkId=120948)。<br />-"I/O 瓶颈"部分"在 SQL Server 2008" 白皮书中的故障排除性能问题[http://go.microsoft.com/fwlink/?LinkID=202135](http://go.microsoft.com/fwlink/?LinkID=202135)。<br />-如何确定磁盘性能瓶颈使用在 Microsoft 服务器性能审查程序 (SPA) 工具[http://go.microsoft.com/fwlink/?LinkID=98096](http://go.microsoft.com/fwlink/?LinkID=98096)。|  
  
## <a name="measuring-memory-performance"></a>内存性能测量  
 使用以下性能监视器计数器测量的可用内存的来宾操作系统的 HYPER-V 虚拟机上安装的性能的影响：  
  
|步骤|参考|  
|----------|---------------|  
|**度量值在 HYPER-V 主机操作系统上的可用内存**– 可以在监视"\Memory\Available MBytes"性能监视器计数器来确定可用于 HYPER-V 主机操作系统的物理内存量物理计算机。 此计数器报告可用于主机操作系统的可用物理内存量。 评估可用于主机操作系统的可用物理内存时，请使用以下规则的经验法则：<br /><br /> <ul><li>**\Memory\Available Mbytes** – Available MBytes 测量到的计算机上安装的物理内存百分比的计算机上，运行的进程可用的物理内存量。 测量此性能监视器计数器的值时，将应用以下原则：<br /><br /> <ul><li>可用内存的 50%或更 = 正常</li><li>25%的可用内存 = 监视器</li><li>可用内存的 10%= 警告</li><li>小于 5%的可用内存 = 严重，性能将会受到不利影响</li></ul></li><li>**\Memory\Pages/sec** – 此性能监视器计数器测量从读取或写入磁盘为解决强制分页错误页的速率。 若要解决强制分页错误，操作系统必须交换到磁盘，对性能造成负面影响的内存中的内容。 较高数量的可用物理内存不足的相关中每秒的页可能表示物理内存不足。 测量此性能监视器计数器的值时，将应用以下原则：<br /><br /> <ul><li>少于 500 个 = 正常</li><li>500-1000年 = 监视器或警告</li><li>大于 1000年 = 严重，性能将会受到不利影响</li></ul></li></ul><br /> **测量来宾操作系统上的可用内存**– 可以使用用来测量内存可用于 HYPER-V 主机操作系统相同的性能监视器计数器测量可供来宾操作系统的内存。|详细信息的影响的可用物理内存对应用程序服务器性能，请参阅 Exchange Server 2003 帮助主题"排除出内存密集型问题"在[http://go.microsoft.com/fwlink/?LinkId=121056](http://go.microsoft.com/fwlink/?LinkId=121056)。|  
  
## <a name="measuring-network-performance"></a>测量的网络性能  
 HYPER-V 允许来宾计算机，以共享相同的物理网络适配器。 虽然这可帮助整合硬件，请注意不要 saturate 物理适配器。 使用以下方法来确保网络使用 HYPER-V 虚拟机的网络的运行状况：  
  
|步骤|参考|  
|----------|---------------|  
|**测试网络延迟**|每个虚拟机，以确保足够的网络延迟执行 ping 操作。 本地区域在网络上，预计会收到小于 1ms 响应时间。|  
|**测试数据包丢失**|使用 pathping.exe 实用工具测试虚拟机之间的数据包丢失。 Pathping.exe 测量网络上的数据包丢失，并可与所有版本的[!INCLUDE[btsWinNoVersion](../includes/btswinnoversion-md.md)]由于[!INCLUDE[btsWin2kSvr](../includes/btswin2ksvr-md.md)]。 Pathping.exe 发出的每个网络节点的 100 个 ping 请求突然增加，并计算返回多少 ping。 在局域网上应从 pathping.exe 实用工具的 ping 请求不会丢失。|  
|**测试网络文件传输**|将复制的虚拟机之间有 100 MB 的文件和度量值的完成复制所需的时间长度。 在正常 100m 位 （兆比特） 网络有 100 MB （兆字节） 的文件应复制在 10 到 20 秒。 在正常 1Gbit 网络上，有 100 MB 的文件应在大约 3 到 5 秒钟内将复制。 在这些参数之外的复制时间是网络问题的指示。 网络适配器具有"自动检测到"时发生较差网络传输的一个常见原因的 10 MB 半双工网络以防止网络适配器将充分利用可用带宽。|  
|**在 HYPER-V 主机操作系统上的度量值网络利用率**|使用以下性能监视器计数器测量网络利用率对 HYPER-V 主机操作系统：<br /><br /> **\Network 接口 (\*) \Bytes Total/sec** – 的网络使用率百分比计算 8 以将其转换为 bits 乘以 Bytes Total/sec，将结果乘以 100，然后除以网络适配器的当前带宽。 使用以下阈值评估网络带宽利用率：<br /><br /> -少于 40%的使用的接口 = 正常<br />-41%-64%使用的接口的 = 监视器或警告<br />-65 100%的使用的接口 = 严重，性能将会受到不利影响<br /><br /> **\Network 接口 (\*) \Output 队列长度**– 输出队列长度测量的网络适配器上等待的线程数。 如果有 2 个以上线程在等待上的网络适配器，网络可能成为瓶颈。 此常见原因是较差网络延迟和/或在网络上的高冲突率。 使用以下阈值评估输出队列长度：<br /><br /> -0 = 正常<br />-1-2 = 监视器或警告<br />-Greater than 2 = 严重，性能将会受到不利影响。<br /><br /> 确保解决方案中的所有计算机 （物理和虚拟） 的网络适配器都配置为最大传输单位 (MTU) 使用相同的值。 有关配置 MTU 值的详细信息，请参阅"附录 a: TCP/IP 配置参数"在[http://go.microsoft.com/fwlink/?LinkId=113716](http://go.microsoft.com/fwlink/?LinkId=113716)。<br /><br /> 如果为单位的 2 或更高输出队列长度，请考虑将一个或多个物理网络适配器添加到承载虚拟机的物理计算机并将绑定用到这些物理网络适配器的来宾操作系统的网络适配器。|  
|**在来宾操作系统上的度量值网络利用率**|如果 HYPER-V 根分区上的网络适配器正忙于由上面提到的性能监视器计数器，则可以考虑使用"\Hyper-V 虚拟网络适配器 （*） \Bytes/sec"性能监视器计数器以确定哪些虚拟网络适配器使用的大多数网络使用率。|  
  
 有关网络性能分析的详细信息，请参阅"章 15-测量.NET 应用程序性能"在[http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073)。  
  
## <a name="measuring-processor-performance"></a>测量处理器性能  
 使用以下方法来评估在 HYPER-V 虚拟机上安装来宾操作系统上的处理器性能：  
  
-   **测量来宾操作系统处理器使用率-**传统上，处理器性能可以测量使用"\Processor(*)\\%Processor Time"性能监视器计数器。 这不是通过评估的来宾操作系统的处理器使用率，因为 HYPER-V 测量并报告此值相对于分配给虚拟机的处理器数的准确计数器。 如果多个处理器被分配给正在运行的虚拟机多于实际存在于物理计算机上，为每个来宾操作系统返回的值"\Processor (\*)\\%Processor Time"性能监视器计数器较低，即使处理器使用率实际上是瓶颈。 这是因为虚拟处理器使用的物理处理器，在一种轮循机制的方式。 每个虚拟处理器将尝试并分配本身的共享总体系统资源，因此在 4 物理处理器系统中，每个虚拟处理器会按默认尝试利用 25%的系统资源。 如果 8 个虚拟处理器，以便共同创建这意味着虚拟处理器将尝试利用的服务器的 CPU 容量的 200%。 在这种情况下，每个虚拟处理器将报告由低利用率"\Processor (\*)\\%Processor Time"（相对于期望的级别） 的性能监视器计数器和过多的上下文之间切换虚拟处理器将导致每个虚拟机的性能不佳。 在此方案中，请考虑减少分配给主机操作系统上的 HYPER-V 虚拟机的虚拟处理器数。HYPER-V 提供了虚拟机监控程序要监视的逻辑和虚拟处理器的性能的性能对象。 逻辑处理器与关联直接的处理器或物理计算机安装的内核数。 例如，在物理计算机上安装 2 个四核处理器将关联到 8 个逻辑处理器。 虚拟处理器是虚拟机实际使用的内容，并在虚拟处理器根和子分区中的所有执行都发生。  
  
     HYPER-V 提供了虚拟机监控程序要监视的逻辑和虚拟处理器的性能的性能对象。 逻辑处理器与关联直接的处理器或物理计算机安装的内核数。 例如，在物理计算机上安装 2 个四核处理器将关联到 8 个逻辑处理器。 虚拟处理器是虚拟机实际使用的内容，并在虚拟处理器根和子分区中的所有执行都发生。  
  
     若要准确测量来宾操作系统的处理器使用率，请使用"逻辑 processor （_total HYPER-V 虚拟机监控程序） %总运行时间"HYPER-V 主机操作系统上的性能监视器计数器。 使用以下阈值来评估来宾操作系统系统处理器使用率使用"逻辑 processor （_total HYPER-V 虚拟机监控程序） %总运行时间"性能监视器计数器：  
  
    -   使用小于 60%= 正常  
  
    -   60%-89%使用 = 监视器或警告  
  
    -   90%-100%使用 = 严重，性能将会受到不利影响  
  
     若要解决处理器的 HYPER-V 环境上的来宾操作系统的性能，最好是为主机操作系统所报告的值之间的平衡努力"\Hyper-V 虚拟机监控程序逻辑 processor （_total)\\%total 运行时间"(LPTR) 和"虚拟 processor （_total \Hyper-V 虚拟机监控程序)\\%总运行时间"(VPTR)。 如果 LPTR 是高还是低 VPTR 然后验证是否不超过物理计算机上以物理方式可分配给虚拟机的多个处理器。 使用"虚拟机监控程序虚拟 Processor(*) \Hyper-V\\来宾运行时间百分比"计数器，来确定哪些虚拟处理器占用 CPU 和取消分配虚拟处理器的虚拟机作为适当配置的一对一映射到逻辑处理器的虚拟处理器。 有关配置虚拟处理器到逻辑处理器的一对一映射的详细信息，请参阅中的"优化处理器性能"部分[清单： HYPER-V 上优化性能](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)。 如果 VPTR 是高还是低 LPTR 请考虑分配到虚拟机的其他处理器，如果有可用的逻辑处理器和其他处理器支持的来宾操作系统。 在其中 VPTR 是高的情况下，LPTR 较低，有可用的逻辑处理器分配，但其他处理器不支持来宾操作系统，请考虑通过将其他虚拟机添加到物理计算机向外扩展和分配到这些虚拟机可用的处理器。 VPTR 和 LPTR 都很高的情况下，配置推送限制的物理计算机并且应考虑通过将另一台物理计算机和其他 HYPER-V 虚拟机添加到环境向外扩展。 下面的流程图描述了在 HYPER-V 环境中的处理器性能进行故障排除时应使用的过程。  
  
     如果 VPTR 很高且 LPTR 较低，请考虑分配到虚拟机的其他处理器，如果有可用的逻辑处理器和其他处理器支持的来宾操作系统。 在其中 VPTR 是高的情况下，LPTR 较低，有可用的逻辑处理器分配，但其他处理器不支持来宾操作系统，请考虑通过将其他虚拟机添加到物理计算机向外扩展和分配到这些虚拟机可用的处理器。 VPTR 和 LPTR 都很高的情况下，配置推送限制的物理计算机并且应考虑通过将另一台物理计算机和其他 HYPER-V 虚拟机添加到环境向外扩展。 下面的流程图描述了在 HYPER-V 环境中的处理器性能进行故障排除时应使用的过程。  
  
     ![故障排除超的 CPU 性能和 #45;V](../technical-guides/media/623fdcd6-e80b-4ba9-bf46-5d9b92b6612b.gif "623fdcd6-e80b-4ba9-bf46-5d9b92b6612b")  
在 HYPER-V 环境中的故障排除 CPU 性能  
  
    > [!NOTE]  
    >  **来宾操作系统处理器没有物理处理器/内核数设置相关性**– 虚拟机监控程序确定如何物理资源使用。 在处理器使用率的情况下虚拟机监控程序会安排对的线程窗体中的物理处理器的来宾处理器时间。 这意味着在处理器负荷的虚拟机将分布在物理计算机的处理器。 此外，虚拟机不能超过配置的逻辑处理器，例如，如果单个虚拟机配置为在一台具有 8 处理器内核，物理计算机上运行带有 2 个逻辑处理器数的处理器使用率则虚拟机不能超过配置的逻辑处理器 （在本例中 2 处理器） 数的处理器容量。  
  
-   **测量总体的处理器使用率的 HYPER-V 环境中使用 HYPER-V 性能监视计数器-**对于测量处理器使用率，主机操作系统逻辑上查看作为另一个来宾操作系统. 因此，"\Processor(*)\\%Processor Time"监视器计数器可测量的主机操作系统仅处理器使用率。 若要测量总的物理处理器使用率的主机操作系统和所有来宾操作系统，请使用"虚拟机监控程序逻辑 processor （_total) \Hyper-V\\%total 运行时间"性能监视器计数器。 此计数器测量所用的运行这两个主机操作系统的处理器时间的总百分比和所有来宾操作系统。  
  
     使用以下阈值来评估的 HYPER-V 环境使用的总体处理器利用率"\Hyper-V 虚拟机监控程序逻辑 processor （_total)\\%总运行时间"性能监视器计数器：  
  
    -   使用小于 60%= 正常  
  
    -   60%-89%使用 = 监视器或警告  
  
    -   90%-100%使用 = 严重，性能将会受到不利影响  
  
     有关处理器使用率详细信息中，查看以下资源：  
  
    -   "如何： 标识导致高用户模式 CPU 瓶颈的出现针对服务器应用程序在生产环境中的函数"在[http://go.microsoft.com/fwlink/?LinkID=107047](http://go.microsoft.com/fwlink/?LinkID=107047)。  
  
    -   在的"章 15-测量.NET 应用程序性能" [http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073)。