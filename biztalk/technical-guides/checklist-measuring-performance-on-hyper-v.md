---
title: 清单：Hyper V 上测量性能 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f32c95f4-a4eb-412b-9fa7-140e80b85e5a
caps.latest.revision: 13
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d2c38bb38f3bf519ff7b82e9dff02f57e3d61106
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65399318"
---
# <a name="checklist-measuring-performance-on-hyper-v"></a><span data-ttu-id="b0664-102">清单：Hyper V 上测量性能</span><span class="sxs-lookup"><span data-stu-id="b0664-102">Checklist: Measuring Performance on Hyper-V</span></span>
<span data-ttu-id="b0664-103">虽然大部分分析性能的来宾操作系统安装上的 HYPER-V 虚拟机性能的原则是与分析的物理计算机上安装操作系统的性能相同，许多集合方法都是不同的结果。</span><span class="sxs-lookup"><span data-stu-id="b0664-103">While most of the principles of analyzing performance of a guest operating system installed on a Hyper-V virtual machine performance are the same as analyzing the performance of an operating system installed on a physical machine, many of the collection methods are different.</span></span> <span data-ttu-id="b0664-104">评估您的 HYPER-V 虚拟机上安装来宾操作系统上运行的 BizTalk Server 解决方案的性能时，以下各节应用作快速参考。</span><span class="sxs-lookup"><span data-stu-id="b0664-104">The sections below should be used as a quick reference when evaluating performance of your BizTalk Server solution running on a guest operating system installed on a Hyper-V virtual machine.</span></span>  

## <a name="measuring-disk-io-performance"></a><span data-ttu-id="b0664-105">衡量磁盘 I/O 性能</span><span class="sxs-lookup"><span data-stu-id="b0664-105">Measuring Disk I/O Performance</span></span>  
 <span data-ttu-id="b0664-106">使用下列性能监视器计数器来测量在 HYPER-V 虚拟机上安装来宾操作系统上的磁盘 I/O 性能：</span><span class="sxs-lookup"><span data-stu-id="b0664-106">Use the following performance monitor counters to measure disk I/O performance on a guest operating system installed on a Hyper-V virtual machine:</span></span>  


|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <span data-ttu-id="b0664-107">步骤</span><span class="sxs-lookup"><span data-stu-id="b0664-107">Step</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span data-ttu-id="b0664-108">参考</span><span class="sxs-lookup"><span data-stu-id="b0664-108">Reference</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b0664-109">**度量值的 HYPER-V 主机操作系统上的磁盘延迟**-在 HYPER-V 主机操作系统上的磁盘性能的最佳初始指标通过使用"\Logical 磁盘 (*) \Avg。Disk sec/Read"和"\Logical 磁盘 (\*) \Avg。Disk sec/Write"性能监视器计数器。这些性能监视器计数器来测量的读取和写入操作要花费的时间响应操作系统时间量。作为常规经验，平均响应时间大于时间被视为不够理想。作为常规经验，平均响应时间大于时间被视为不够理想。这基于典型查找单个 7200 RPM 磁盘驱动器，而无需缓存的时间。建议的物理磁盘性能监视器计数器与逻辑磁盘使用，因为 Windows 应用程序和服务利用表示为驱动器号提供给操作系统的物理磁盘 (LUN) 可以是其中的逻辑驱动器包含磁盘阵列中的多个物理磁盘驱动器。在测量磁盘延迟使用 \Logical 磁盘的 HYPER-V 主机操作系统上使用以下规则的经验法则 (\*) \Avg。磁盘秒数/读取或 \Logical 磁盘 (\*) \Avg。Disk sec/Write 性能监视器计数器：<br /><br />这基于典型查找单个 7200 RPM 磁盘驱动器，而无需缓存的时间。建议的物理磁盘性能监视器计数器与逻辑磁盘使用，因为 Windows 应用程序和服务利用表示为驱动器号提供给操作系统的物理磁盘 (LUN) 可以是其中的逻辑驱动器包含磁盘阵列中的多个物理磁盘驱动器。在测量磁盘延迟使用 \Logical 磁盘的 HYPER-V 主机操作系统上使用以下规则的经验法则 (\*) \Avg。磁盘秒数/读取或 \Logical 磁盘 (\*) \Avg。磁盘秒数/写入性能监视器计数器：<br /> <br /> -1 毫秒到时间 = 正常<br />-时间到为 25 ms = 警告或监视<br />-26ms年或更高版本 = 严重，性能会受到不利影响\* \*注意：*\*在非虚拟化环境中安装的物理磁盘提供更好的性能比通过 HYPER-V 主机操作系统访问的磁盘。</span><span class="sxs-lookup"><span data-stu-id="b0664-109">**Measure disk latency on a Hyper-V host operating system** – The best initial indicator of disk performance on a Hyper-V host operating system is obtained by using the “\Logical Disk(*)\Avg. Disk sec/Read” and “\Logical Disk(\*)\Avg. Disk sec/Write” performance monitor counters. These performance monitor counters measure the amount of time that read and write operations take to respond to the operating system. As a general rule of thumb, average response times greater than 15ms are considered sub-optimal. As a general rule of thumb, average response times greater than 15ms are considered sub-optimal. This is based on the typical seek time of a single 7200 RPM disk drive without cache. The use of logical disk versus physical disk performance monitor counters is recommended because Windows applications and services utilize logical drives represented as drive letters wherein the physical disk (LUN) presented to the operating system can be comprised of multiple physical disk drives in a disk array. Use the following rule of thumb when measuring disk latency on the Hyper-V host operating system using the \Logical Disk(\*)\Avg. Disk sec/Read or \Logical Disk(\*)\Avg. Disk sec/Write performance monitor counters:<br /><br /> This is based on the typical seek time of a single 7200 RPM disk drive without cache. The use of logical disk versus physical disk performance monitor counters is recommended because Windows applications and services utilize logical drives represented as drive letters wherein the physical disk (LUN) presented to the operating system can be comprised of multiple physical disk drives in a disk array. Use the following rule of thumb when measuring disk latency on the Hyper-V host operating system using the \Logical Disk(\*)\Avg. Disk sec/Read or \Logical Disk(\*)\Avg. Disk sec/Write performance monitor counters:<br /><br /> -   1ms to 15ms  = Healthy<br />-   15ms to 25ms = Warning or Monitor<br />-   26ms or greater = Critical, performance will be adversely affected \*\*Note:*\*  Physical disks installed on a non-virtualized environment offer better performance than disks accessed through a Hyper-V host operating system.</span></span> <span data-ttu-id="b0664-110">如果磁盘性能非常重要的应用程序的整体性能，请考虑托管磁盘仅物理硬件上。</span><span class="sxs-lookup"><span data-stu-id="b0664-110">If disk performance is absolutely critical to the overall performance of your application, consider hosting disks on physical hardware only.</span></span> <span data-ttu-id="b0664-111">**注意：** 评估磁盘 I/O 性能时，请确保配置防病毒软件扫描的任何计算的磁盘分区中排除。</span><span class="sxs-lookup"><span data-stu-id="b0664-111">**Note:**  When evaluating disk I/O performance, ensure that you configure antivirus software to exclude scanning of any disk partitions that are being evaluated.</span></span> <span data-ttu-id="b0664-112">防病毒扫描引入了对产生负面影响性能和倾斜的测试结果的开销。</span><span class="sxs-lookup"><span data-stu-id="b0664-112">Antivirus scanning introduces overhead that can negatively impact performance and skew test results.</span></span> <br /><br /> <span data-ttu-id="b0664-113">**测量来宾操作系统上的磁盘延迟**– 可以使用用于测量响应时间的 HYPER-V 主机操作系统所用的磁盘的相同性能监视器计数器测量所用的来宾操作系统磁盘响应时间系统。</span><span class="sxs-lookup"><span data-stu-id="b0664-113">**Measure disk latency on guest operating systems** – Response times of the disks used by the guest operating systems can be measured using the same performance monitor counters used to measure response times of the disks used by the Hyper-V host operating system.</span></span> | <span data-ttu-id="b0664-114">有关磁盘性能分析的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="b0664-114">For more information about disk performance analysis, see the following resources:</span></span><br /><br /> <span data-ttu-id="b0664-115">-"的 HYPER-V 中运行 SQL Server 的性能开销"部分中的"运行 SQL Server 2008 in a HYPER-V 环境 – 最佳实践和性能注意事项"白皮书，网址[ http://go.microsoft.com/fwlink/?LinkId=144622 ](http://go.microsoft.com/fwlink/?LinkId=144622)。</span><span class="sxs-lookup"><span data-stu-id="b0664-115">-   “Performance Overhead of Running SQL Server in Hyper-V” section of “Running SQL Server 2008 in a Hyper-V Environment – Best Practices and Performance Considerations” whitepaper at [http://go.microsoft.com/fwlink/?LinkId=144622](http://go.microsoft.com/fwlink/?LinkId=144622).</span></span><br /><span data-ttu-id="b0664-116">-不再在绑定磁盘问题[ http://go.microsoft.com/fwlink/?LinkId=120947 ](http://go.microsoft.com/fwlink/?LinkId=120947)。</span><span class="sxs-lookup"><span data-stu-id="b0664-116">-   Ruling Out Disk-Bound Problems at [http://go.microsoft.com/fwlink/?LinkId=120947](http://go.microsoft.com/fwlink/?LinkId=120947).</span></span><br /><span data-ttu-id="b0664-117">在 SQL Server 预部署 I/O 最佳实践[ http://go.microsoft.com/fwlink/?LinkId=120948 ](http://go.microsoft.com/fwlink/?LinkId=120948)。</span><span class="sxs-lookup"><span data-stu-id="b0664-117">-   SQL Server Predeployment I/O Best Practices at [http://go.microsoft.com/fwlink/?LinkId=120948](http://go.microsoft.com/fwlink/?LinkId=120948).</span></span><br /><span data-ttu-id="b0664-118">-"I/O 瓶颈"部分中的"在 SQL Server 2008" 白皮书中提供的性能问题故障排除[ http://go.microsoft.com/fwlink/?LinkID=202135 ](http://go.microsoft.com/fwlink/?LinkID=202135)。</span><span class="sxs-lookup"><span data-stu-id="b0664-118">-   “I/O Bottlenecks” section of the “Troubleshooting Performance Problems in SQL Server 2008” whitepaper available at [http://go.microsoft.com/fwlink/?LinkID=202135](http://go.microsoft.com/fwlink/?LinkID=202135).</span></span><br /><span data-ttu-id="b0664-119">-如何确定磁盘性能瓶颈使用在 Microsoft 服务器性能顾问 (SPA) 工具[ http://go.microsoft.com/fwlink/?LinkID=98096 ](http://go.microsoft.com/fwlink/?LinkID=98096)。</span><span class="sxs-lookup"><span data-stu-id="b0664-119">-   How to Identify a Disk Performance Bottleneck Using the Microsoft Server Performance Advisor (SPA) Tool at [http://go.microsoft.com/fwlink/?LinkID=98096](http://go.microsoft.com/fwlink/?LinkID=98096).</span></span> |

## <a name="measuring-memory-performance"></a><span data-ttu-id="b0664-120">测量内存性能</span><span class="sxs-lookup"><span data-stu-id="b0664-120">Measuring Memory Performance</span></span>  
 <span data-ttu-id="b0664-121">使用下列性能监视器计数器以衡量性能的 HYPER-V 虚拟机上安装来宾操作系统上的可用内存的影响：</span><span class="sxs-lookup"><span data-stu-id="b0664-121">Use the following performance monitor counters to measure the impact of available memory on the performance of a guest operating system installed on a Hyper-V virtual machine:</span></span>  

|<span data-ttu-id="b0664-122">步骤</span><span class="sxs-lookup"><span data-stu-id="b0664-122">Step</span></span>|<span data-ttu-id="b0664-123">参考</span><span class="sxs-lookup"><span data-stu-id="b0664-123">Reference</span></span>|  
|----------|---------------|  
|<span data-ttu-id="b0664-124">**度量值的 HYPER-V 主机操作系统上的可用内存**-可通过监视"\Memory\Available MBytes"性能监视器计数器来确定可用的 HYPER-V 主机操作系统的物理内存量物理计算机。</span><span class="sxs-lookup"><span data-stu-id="b0664-124">**Measure available memory on the Hyper-V host operating system** – The amount of physical memory available to the Hyper-V host operating system can be determined by monitoring the “\Memory\Available MBytes” performance monitor counter on the physical computer.</span></span> <span data-ttu-id="b0664-125">此计数器报告供主机操作系统的可用物理内存量。</span><span class="sxs-lookup"><span data-stu-id="b0664-125">This counter reports the amount of free physical memory available to the host operating system.</span></span> <span data-ttu-id="b0664-126">评估可用于主机操作系统的可用物理内存时，请使用以下规则的经验法则：</span><span class="sxs-lookup"><span data-stu-id="b0664-126">Use the following rules of thumb when evaluating available physical memory available to the host operating system:</span></span><br /><br /> <ul><li><span data-ttu-id="b0664-127">**\Memory\Available Mbytes** – Available MBytes 测量可安装在计算机上的物理内存的百分比的计算机上，运行的进程的物理内存量。</span><span class="sxs-lookup"><span data-stu-id="b0664-127">**\Memory\Available Mbytes** – Available MBytes measures the amount of physical memory available to processes running on the computer, as a percentage of physical memory installed on the computer.</span></span> <span data-ttu-id="b0664-128">在测量此性能监视器计数器的值时，应考虑下列准则：</span><span class="sxs-lookup"><span data-stu-id="b0664-128">The following guidelines apply when measuring the value of this performance monitor counter:</span></span><br /><br /> <ul><li><span data-ttu-id="b0664-129">内存可用的 50%或更多 = 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-129">50% of free memory available or more = Healthy</span></span></li><li><span data-ttu-id="b0664-130">25%的内存可用 = 监视</span><span class="sxs-lookup"><span data-stu-id="b0664-130">25% of free memory available = Monitor</span></span></li><li><span data-ttu-id="b0664-131">10%的内存可用 = 警告</span><span class="sxs-lookup"><span data-stu-id="b0664-131">10% of free memory available = Warning</span></span></li><li><span data-ttu-id="b0664-132">小于 5%的内存可用 = 关键，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="b0664-132">Less than 5% of free memory available = Critical, performance will be adversely affected</span></span></li></ul></li><li><span data-ttu-id="b0664-133">**\Memory\Pages/sec** – 此性能监视器计数器测量从读取或写入磁盘为解决强制分页错误页的速率。</span><span class="sxs-lookup"><span data-stu-id="b0664-133">**\Memory\Pages/sec** – This performance monitor counter measures the rate at which pages are read from or written to disk to resolve hard page faults.</span></span> <span data-ttu-id="b0664-134">若要解决强制分页错误，操作系统必须更换内存到磁盘，性能有负面影响的内容。</span><span class="sxs-lookup"><span data-stu-id="b0664-134">To resolve hard page faults, the operating system must swap the contents of memory to disk, which negatively impacts performance.</span></span> <span data-ttu-id="b0664-135">大量的页面每秒在可用物理内存不足可能表示物理内存不足。</span><span class="sxs-lookup"><span data-stu-id="b0664-135">A high number of pages per second in correlation with low available physical memory may indicate a lack of physical memory.</span></span> <span data-ttu-id="b0664-136">在测量此性能监视器计数器的值时，应考虑下列准则：</span><span class="sxs-lookup"><span data-stu-id="b0664-136">The following guidelines apply when measuring the value of this performance monitor counter:</span></span><br /><br /> <ul><li><span data-ttu-id="b0664-137">少于 500 = 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-137">Less than 500 = Healthy</span></span></li><li><span data-ttu-id="b0664-138">500-1000年 = 监视或注意</span><span class="sxs-lookup"><span data-stu-id="b0664-138">500 - 1000 = Monitor or Caution</span></span></li><li><span data-ttu-id="b0664-139">大于 1000年 = 严重，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="b0664-139">Greater than 1000 = Critical, performance will be adversely affected</span></span></li></ul></li></ul><br /> <span data-ttu-id="b0664-140">**测量来宾操作系统上的可用内存**– 适用于来宾操作系统的内存可用于度量可用的 HYPER-V 主机操作系统的内存的相同性能监视器计数器进行度量。</span><span class="sxs-lookup"><span data-stu-id="b0664-140">**Measure available memory on the guest operating system** – Memory that is available to the guest operating systems can be measured with the same performance monitor counters used to measure memory available to the Hyper-V host operating system.</span></span>|<span data-ttu-id="b0664-141">有关详细信息影响可用物理内存的应用程序服务器性能，查看 Exchange Server 2003 帮助主题"排除出受内存限制时出现问题[ http://go.microsoft.com/fwlink/?LinkId=121056 ](http://go.microsoft.com/fwlink/?LinkId=121056)。</span><span class="sxs-lookup"><span data-stu-id="b0664-141">For more information about the impact of available physical memory on application server performance, see the Exchange Server 2003 Help topic “Ruling Out Memory-Bound Problems” at [http://go.microsoft.com/fwlink/?LinkId=121056](http://go.microsoft.com/fwlink/?LinkId=121056).</span></span>|  

## <a name="measuring-network-performance"></a><span data-ttu-id="b0664-142">测量的网络性能</span><span class="sxs-lookup"><span data-stu-id="b0664-142">Measuring Network Performance</span></span>  
 <span data-ttu-id="b0664-143">HYPER-V 允许来宾计算机，以共享相同的物理网络适配器。</span><span class="sxs-lookup"><span data-stu-id="b0664-143">Hyper-V allows guest computers to share the same physical network adapter.</span></span> <span data-ttu-id="b0664-144">虽然这可帮助整合硬件，请注意不饱和的物理适配器。</span><span class="sxs-lookup"><span data-stu-id="b0664-144">While this helps to consolidate hardware, take care not to saturate the physical adapter.</span></span> <span data-ttu-id="b0664-145">使用以下方法以确保 HYPER-V 虚拟机使用的网络的运行状况：</span><span class="sxs-lookup"><span data-stu-id="b0664-145">Use the following methods to ensure the health of the network used by the Hyper-V virtual machines:</span></span>  


|                                 <span data-ttu-id="b0664-146">步骤</span><span class="sxs-lookup"><span data-stu-id="b0664-146">Step</span></span>                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               <span data-ttu-id="b0664-147">参考</span><span class="sxs-lookup"><span data-stu-id="b0664-147">Reference</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                       <span data-ttu-id="b0664-148">**测试网络延迟**</span><span class="sxs-lookup"><span data-stu-id="b0664-148">**Test network latency**</span></span>                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <span data-ttu-id="b0664-149">Ping 每个虚拟机，以确保足够的网络延迟。</span><span class="sxs-lookup"><span data-stu-id="b0664-149">Ping each virtual machine to ensure adequate network latency.</span></span> <span data-ttu-id="b0664-150">在局域网，预计可以收到不超过 1 毫秒响应时间。</span><span class="sxs-lookup"><span data-stu-id="b0664-150">On local area networks, expect to receive less than 1ms response times.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                       <span data-ttu-id="b0664-151">**数据包丢失的测试**</span><span class="sxs-lookup"><span data-stu-id="b0664-151">**Test for packet loss**</span></span>                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span data-ttu-id="b0664-152">使用 pathping.exe 实用工具来测试虚拟机之间的数据包丢失。</span><span class="sxs-lookup"><span data-stu-id="b0664-152">Use the pathping.exe utility to test packet loss between virtual machines.</span></span> <span data-ttu-id="b0664-153">Pathping.exe 测量网络上的数据包丢失，并可与所有版本的[!INCLUDE[btsWinNoVersion](../includes/btswinnoversion-md.md)]由于[!INCLUDE[btsWin2kSvr](../includes/btswin2ksvr-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="b0664-153">Pathping.exe measures packet loss on the network and is available with all versions of [!INCLUDE[btsWinNoVersion](../includes/btswinnoversion-md.md)] since [!INCLUDE[btsWin2kSvr](../includes/btswin2ksvr-md.md)].</span></span> <span data-ttu-id="b0664-154">Pathping.exe 发出的每个网络节点到 100 个 ping 请求突然增加，并计算返回多少 ping。</span><span class="sxs-lookup"><span data-stu-id="b0664-154">Pathping.exe sends out a burst of 100 ping requests to each network node and calculates how many pings are returned.</span></span> <span data-ttu-id="b0664-155">在局域网上应该不会丢失从 pathping.exe 实用工具的 ping 请求。</span><span class="sxs-lookup"><span data-stu-id="b0664-155">On local area networks there should be no loss of ping requests from the pathping.exe utility.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                   <span data-ttu-id="b0664-156">**测试网络文件传输**</span><span class="sxs-lookup"><span data-stu-id="b0664-156">**Test network file transfers**</span></span>                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span data-ttu-id="b0664-157">将复制的虚拟机之间有 100 MB 的文件和度量值以完成复制所需的时间长度。</span><span class="sxs-lookup"><span data-stu-id="b0664-157">Copy a 100MB file between virtual machines and measure the length of time required to complete the copy.</span></span> <span data-ttu-id="b0664-158">在正常 100m 位 （兆位） 网络 100 MB （兆字节） 文件应复制在 10 到 20 秒内。</span><span class="sxs-lookup"><span data-stu-id="b0664-158">On a healthy 100Mbit (megabit) network, a 100MB (megabyte) file should copy in 10 to 20 seconds.</span></span> <span data-ttu-id="b0664-159">在正常 1g 比特网络中，有 100 MB 的文件应在约 3 到 5 秒内将复制。</span><span class="sxs-lookup"><span data-stu-id="b0664-159">On a healthy 1Gbit network, a 100MB file should copy in about 3 to 5 seconds.</span></span> <span data-ttu-id="b0664-160">这些参数之外的复制时间均表示有网络问题。</span><span class="sxs-lookup"><span data-stu-id="b0664-160">Copy times outside of these parameters are indicative of a network problem.</span></span> <span data-ttu-id="b0664-161">较差网络传输的一个常见原因发生时的网络适配器具有"自动检测到"这样可防止网络适配器充分利用可用带宽的 10 MB 半双工网络。</span><span class="sxs-lookup"><span data-stu-id="b0664-161">One common cause of poor network transfers occurs when the network adapter has “auto detected” a 10MB half-duplex network which prevents the network adapter from taking full advantage of available bandwidth.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="b0664-162">**度量值的 HYPER-V 主机操作系统上的网络利用率**</span><span class="sxs-lookup"><span data-stu-id="b0664-162">**Measure network utilization on the Hyper-V host operating system**</span></span> | <span data-ttu-id="b0664-163">使用下列性能监视器计数器来测量网络利用率的 HYPER-V 主机操作系统上：</span><span class="sxs-lookup"><span data-stu-id="b0664-163">Use the following performance monitor counters to measure network utilization on the Hyper-V host operating system:</span></span><br /><br /> <span data-ttu-id="b0664-164">**\Network 接口 (\*) \Bytes Total/sec** – 网络使用率的百分比计算 8 来将其转换为位乘以字节总数/秒，将结果乘以 100，则网络适配器被除的当前带宽。</span><span class="sxs-lookup"><span data-stu-id="b0664-164">**\Network Interface(\*)\Bytes Total/sec** – The percentage of network utilization is calculated by multiplying Bytes Total/sec by 8 to convert it to bits, multiply the result by 100, then divide by the network adapter’s current bandwidth.</span></span> <span data-ttu-id="b0664-165">使用以下阈值来评估网络带宽利用率：</span><span class="sxs-lookup"><span data-stu-id="b0664-165">Use the following thresholds to evaluate network bandwidth utilization:</span></span><br /><br /> <span data-ttu-id="b0664-166">-小于 40%的使用的接口 = 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-166">-   Less than 40% of the interface consumed = Healthy</span></span><br /><span data-ttu-id="b0664-167">： 使用的接口 41%-64%= 监视或注意</span><span class="sxs-lookup"><span data-stu-id="b0664-167">-   41%-64% of the interface consumed = Monitor or Caution</span></span><br /><span data-ttu-id="b0664-168">-使用的接口的 65 100%= 关键，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="b0664-168">-   65-100% of the interface consumed = Critical, performance will be adversely affected</span></span><br /><br /> <span data-ttu-id="b0664-169">**\Network 接口 (\*) \Output 队列长度**– 输出队列长度测量的网络适配器上等待的线程数。</span><span class="sxs-lookup"><span data-stu-id="b0664-169">**\Network Interface(\*)\Output Queue Length** – The output queue length measures the number of threads waiting on the network adapter.</span></span> <span data-ttu-id="b0664-170">如果有 2 个以上线程在等待上的网络适配器，则网络可能是瓶颈。</span><span class="sxs-lookup"><span data-stu-id="b0664-170">If there are more than 2 threads waiting on the network adapter, then the network may be a bottleneck.</span></span> <span data-ttu-id="b0664-171">此常见原因是较差的网络延迟和/或在网络上的高冲突率。</span><span class="sxs-lookup"><span data-stu-id="b0664-171">Common causes of this are poor network latency and/or high collision rates on the network.</span></span> <span data-ttu-id="b0664-172">使用以下阈值评估输出队列长度：</span><span class="sxs-lookup"><span data-stu-id="b0664-172">Use the following thresholds to evaluate output queue length:</span></span><br /><br /> <span data-ttu-id="b0664-173">-0 = 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-173">-   0 = Healthy</span></span><br /><span data-ttu-id="b0664-174">-1-2 = 监视或注意</span><span class="sxs-lookup"><span data-stu-id="b0664-174">-   1-2 = Monitor or Caution</span></span><br /><span data-ttu-id="b0664-175">-大于 2 = 严重，性能将受到负面影响。</span><span class="sxs-lookup"><span data-stu-id="b0664-175">-   Greater than 2 = Critical, performance will be adversely affected.</span></span><br /><br /> <span data-ttu-id="b0664-176">请确保该解决方案中的所有计算机 （物理和虚拟） 网络适配器都配置为使用最大传输单元 (MTU) 相同的值。</span><span class="sxs-lookup"><span data-stu-id="b0664-176">Ensure that the network adapters for all computers (physical and virtual) in the solution are configured to use the same value for maximum transmission unit (MTU).</span></span> <span data-ttu-id="b0664-177">有关配置 MTU 值的详细信息，请参阅"附录 a:TCP/IP 配置参数"处[ http://go.microsoft.com/fwlink/?LinkId=113716 ](http://go.microsoft.com/fwlink/?LinkId=113716)。</span><span class="sxs-lookup"><span data-stu-id="b0664-177">For more information about configuring the MTU value, see “Appendix A: TCP/IP Configuration Parameters” at [http://go.microsoft.com/fwlink/?LinkId=113716](http://go.microsoft.com/fwlink/?LinkId=113716).</span></span><br /><br /> <span data-ttu-id="b0664-178">如果测量输出队列长度为 2 或更大，请考虑将一个或多个物理网络适配器添加到托管虚拟机的物理计算机并将绑定到这些物理网络适配器的来宾操作系统使用的网络适配器。</span><span class="sxs-lookup"><span data-stu-id="b0664-178">If an output queue length of 2 or more is measured, consider adding one or more physical network adapters to the physical computer that hosts the virtual machines and bind the network adapters used by the guest operating systems to these physical network adapters.</span></span> |
|    <span data-ttu-id="b0664-179">**度量值在来宾操作系统上的网络利用率**</span><span class="sxs-lookup"><span data-stu-id="b0664-179">**Measure network utilization on the guest operating systems**</span></span>    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span data-ttu-id="b0664-180">如果上面提到的性能监视器计数器所示的 HYPER-V 根分区上的网络适配器正在使用，请考虑使用"\Hyper-V 虚拟网络适配器 (\*) \Bytes/sec"性能监视器计数器以确定哪个虚拟网络适配器占用大多数网络利用率。</span><span class="sxs-lookup"><span data-stu-id="b0664-180">If a network adapter on the Hyper-V root partition is busy as indicated by the performance monitor counters mentioned above, then consider using the "\Hyper-V Virtual Network Adapter(\*)\Bytes/sec" performance monitor counter to identify which virtual network adapters are consuming the most network utilization.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

 <span data-ttu-id="b0664-181">有关网络性能分析的详细信息，请参阅"一章 15-度量.NET 应用程序性能"网址[ http://go.microsoft.com/fwlink/?LinkId=121073 ](http://go.microsoft.com/fwlink/?LinkId=121073)。</span><span class="sxs-lookup"><span data-stu-id="b0664-181">For more information about network performance analysis, see “Chapter 15 - Measuring .NET Application Performance” at [http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073).</span></span>  

## <a name="measuring-processor-performance"></a><span data-ttu-id="b0664-182">测量处理器性能</span><span class="sxs-lookup"><span data-stu-id="b0664-182">Measuring Processor Performance</span></span>  
 <span data-ttu-id="b0664-183">使用以下方法来评估在 HYPER-V 虚拟机上安装来宾操作系统上的处理器性能：</span><span class="sxs-lookup"><span data-stu-id="b0664-183">Use the following methods to evaluate processor performance on a guest operating system installed on a Hyper-V virtual machine:</span></span>  

- <span data-ttu-id="b0664-184">**来宾操作系统的处理器使用率的度量值**传统上，处理器的性能可以测量使用"\Processor(\*)\\%Processor Time"性能监视器计数器。</span><span class="sxs-lookup"><span data-stu-id="b0664-184">**Measure guest operating system processor utilization -** Traditionally, processor performance can be measured using the “\Processor(\*)\\% Processor Time” performance monitor counter.</span></span> <span data-ttu-id="b0664-185">这不是准确计数器但评估的来宾操作系统的处理器使用率，因为 HYPER-V 测量并报告此值相对于分配给虚拟机的处理器的数目。</span><span class="sxs-lookup"><span data-stu-id="b0664-185">This is not an accurate counter for evaluating processor utilization of a guest operating system though because Hyper-V measures and reports this value relative to the number of processors allocated to the virtual machine.</span></span> <span data-ttu-id="b0664-186">如果多个处理器分配给多于实际存在于物理计算机上运行的虚拟机中，为每个来宾操作系统返回的值"\Processor (\*)\\%Processor Time"性能监视器计数器很低，即使处理器使用率实际上是一个瓶颈。</span><span class="sxs-lookup"><span data-stu-id="b0664-186">If more processors are allocated to running virtual machines than are actually present on the physical computer, the value returned by each guest operating system for the “\Processor(\*)\\% Processor Time” performance monitor counter will be low, even if in fact processor utilization is a bottleneck.</span></span> <span data-ttu-id="b0664-187">这是因为虚拟处理器利用物理处理器以轮循机制的方式。</span><span class="sxs-lookup"><span data-stu-id="b0664-187">This occurs because the virtual processors utilize the physical processors in a round-robin fashion.</span></span> <span data-ttu-id="b0664-188">每个虚拟处理器会尝试并分配本身的整体系统资源的共享以便在 4 个物理处理器系统中，每个虚拟处理器将按默认尝试利用 25%的系统资源。</span><span class="sxs-lookup"><span data-stu-id="b0664-188">Each virtual processor will try and allocate itself a share of overall system resources, so in a 4 physical processor system, each virtual processor will by default try to utilize 25% of the system resources.</span></span> <span data-ttu-id="b0664-189">如果 8 个虚拟处理器以共同创建了这意味着虚拟处理器将尝试利用服务器的 CPU 容量的 200%。</span><span class="sxs-lookup"><span data-stu-id="b0664-189">If 8 virtual processors are created this means that collectively the virtual processors will attempt to utilize 200% of the server CPU capacity.</span></span> <span data-ttu-id="b0664-190">在这种情况下，每个虚拟处理器将报告由低利用率"\Processor (\*)\\%Processor Time"（相对于其需要的级别） 的性能监视器计数器和过多的上下文之间进行切换虚拟处理器会为每个虚拟机的性能不佳。</span><span class="sxs-lookup"><span data-stu-id="b0664-190">In this case, each virtual processor will report a low utilization as measured by the “\Processor(\*)\\% Processor Time” performance monitor counter (relative to the level it expects) and the excessive context switching between the virtual processors will result in poor performance for each virtual machine.</span></span> <span data-ttu-id="b0664-191">在此方案中，请考虑减少分配给主机操作系统上的 HYPER-V 虚拟机的虚拟处理器的数量。HYPER-V 提供了虚拟机监控程序性能对象，以监视逻辑和虚拟处理器的性能。</span><span class="sxs-lookup"><span data-stu-id="b0664-191">In this scenario, consider reducing the number of virtual processors allocated to Hyper-V virtual machines on the host operating system.Hyper-V provides hypervisor performance objects to monitor the performance of both logical and virtual processors.</span></span> <span data-ttu-id="b0664-192">逻辑处理器关联直接到处理器或物理计算机安装的核心的数目。</span><span class="sxs-lookup"><span data-stu-id="b0664-192">A logical processor correlates directly to the number of processors or cores that are installed on the physical computer.</span></span> <span data-ttu-id="b0664-193">例如，物理计算机上安装的 2 个四核处理器将关联到 8 个逻辑处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-193">For example, 2 quad core processors installed on the physical computer would correlate to 8 logical processors.</span></span> <span data-ttu-id="b0664-194">虚拟处理器的虚拟机实际使用什么，并在虚拟处理器根和子分区中的所有执行都时发生。</span><span class="sxs-lookup"><span data-stu-id="b0664-194">Virtual processors are what the virtual machines actually use, and all execution in the root and child partitions occurs in virtual processors.</span></span>  

   <span data-ttu-id="b0664-195">HYPER-V 提供了虚拟机监控程序性能对象，以监视逻辑和虚拟处理器的性能。</span><span class="sxs-lookup"><span data-stu-id="b0664-195">Hyper-V provides hypervisor performance objects to monitor the performance of both logical and virtual processors.</span></span> <span data-ttu-id="b0664-196">逻辑处理器关联直接到处理器或物理计算机安装的核心的数目。</span><span class="sxs-lookup"><span data-stu-id="b0664-196">A logical processor correlates directly to the number of processors or cores that are installed on the physical computer.</span></span> <span data-ttu-id="b0664-197">例如，物理计算机上安装的 2 个四核处理器将关联到 8 个逻辑处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-197">For example, 2 quad core processors installed on the physical computer would correlate to 8 logical processors.</span></span> <span data-ttu-id="b0664-198">虚拟处理器的虚拟机实际使用什么，并在虚拟处理器根和子分区中的所有执行都时发生。</span><span class="sxs-lookup"><span data-stu-id="b0664-198">Virtual processors are what the virtual machines actually use, and all execution in the root and child partitions occurs in virtual processors.</span></span>  

   <span data-ttu-id="b0664-199">若要准确测量来宾操作系统的处理器使用率，请使用"逻辑 processor （_total 的 HYPER-V 虚拟机监控程序） %总运行时间"上的 HYPER-V 主机操作系统的性能监视器计数器。</span><span class="sxs-lookup"><span data-stu-id="b0664-199">To accurately measure the processor utilization of a guest operating system, use the “Hyper-V Hypervisor Logical Processor(_Total)% Total Run Time” performance monitor counter on the Hyper-V host operating system.</span></span> <span data-ttu-id="b0664-200">使用以下阈值来评估来宾操作系统系统处理器使用率使用"逻辑 processor （_total 的 HYPER-V 虚拟机监控程序） %总运行时间"性能监视器计数器：</span><span class="sxs-lookup"><span data-stu-id="b0664-200">Use the following thresholds to evaluate guest operating system processor utilization using the “Hyper-V Hypervisor Logical Processor(_Total)% Total Run Time” performance monitor counter:</span></span>  

  - <span data-ttu-id="b0664-201">使用小于 60%= 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-201">Less than 60% consumed = Healthy</span></span>  

  - <span data-ttu-id="b0664-202">60%-89 消耗 %= 监视或注意</span><span class="sxs-lookup"><span data-stu-id="b0664-202">60% - 89% consumed = Monitor or Caution</span></span>  

  - <span data-ttu-id="b0664-203">90%-100%使用 = 严重，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="b0664-203">90% - 100% consumed = Critical, performance will be adversely affected</span></span>  

    <span data-ttu-id="b0664-204">若要排查的来宾操作系统上的 HYPER-V 环境的处理器性能，最好是为主机操作系统所报告的值之间的平衡而努力"\Hyper-V 虚拟机监控程序逻辑 processor （_total)\\%总运行时间"(LPTR) 和"虚拟 processor （_total \Hyper-V 虚拟机监控程序)\\%总运行时间"(VPTR)。</span><span class="sxs-lookup"><span data-stu-id="b0664-204">To troubleshoot processor performance of guest operating systems on a Hyper-V environment, it is best to strive for a balance between the values reported by the host operating system for “\Hyper-V Hypervisor Logical Processor(_Total)\\% Total Run Time” (LPTR) and “\Hyper-V Hypervisor Virtual Processor(_Total)\\% Total Run Time” (VPTR).</span></span> <span data-ttu-id="b0664-205">如果 LPTR 是高还是低 VPTR 然后验证是否不超过物理计算机上以物理方式可分配给虚拟机的处理器越多。</span><span class="sxs-lookup"><span data-stu-id="b0664-205">If LPTR is high and VPTR is low then verify that there are not more processors allocated to virtual machines than are physically available on the physical computer.</span></span> <span data-ttu-id="b0664-206">使用"虚拟机监控程序虚拟 Processor(\*) \Hyper-V\\来宾运行时间百分比"计数器，以确定哪些虚拟处理器占用 CPU 并解除分配虚拟处理器的虚拟机作为在适当配置的一对一映射虚拟处理器到逻辑处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-206">Use the “\Hyper-V Hypervisor Virtual Processor(\*)\\%Guest Run Time” counters to determine which virtual Processors are consuming CPU and de-allocate virtual processors from virtual machines as appropriate to configure a one to one mapping of virtual processors to logical processors.</span></span> <span data-ttu-id="b0664-207">有关配置虚拟处理器到逻辑处理器的一对一映射的详细信息，请参阅中的"优化处理器性能"部分[核对清单：Hyper V 上优化性能](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)。</span><span class="sxs-lookup"><span data-stu-id="b0664-207">For more information about configuring a one to one mapping of virtual processors to logical processors, see the “Optimizing Processor Performance” section in [Checklist: Optimizing Performance on Hyper-V](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md).</span></span> <span data-ttu-id="b0664-208">如果 VPTR 是高还是低 LPTR 请考虑分配给虚拟机的附加处理器，如果有可用逻辑处理器和额外的处理器支持的来宾操作系统。</span><span class="sxs-lookup"><span data-stu-id="b0664-208">If VPTR is high and LPTR is low then consider allocating additional processors to virtual machines if there are available logical processors and if additional processors are supported by the guest operating system.</span></span> <span data-ttu-id="b0664-209">在 VPTR 是高的情况下，LPTR 较低，没有可用逻辑处理器分配，但额外的处理器不支持的来宾操作系统，请考虑向外扩展通过将其他虚拟机添加到物理计算机和分配到这些虚拟机可用的处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-209">In the case where VPTR is high, LPTR is low, there are available logical processors to allocate, but additional processors are not supported by the guest operating system, consider scaling out by adding additional virtual machines to the physical computer and allocating available processors to these virtual machines.</span></span> <span data-ttu-id="b0664-210">VPTR 和 LPTR 较高的情况下，在配置推送的物理计算机的限制，并应考虑向外扩展通过将另一台物理计算机和其他 HYPER-V 虚拟机添加到环境。</span><span class="sxs-lookup"><span data-stu-id="b0664-210">In the case where both VPTR and LPTR are high, the configuration is pushing the limits of the physical computer and should consider scaling out by adding another physical computer and additional Hyper-V virtual machines to the environment.</span></span> <span data-ttu-id="b0664-211">下面的流程图描述的 HYPER-V 环境中的处理器性能故障排除时，应使用的过程。</span><span class="sxs-lookup"><span data-stu-id="b0664-211">The flowchart below describes the process that should be used when troubleshooting processor performance in a Hyper-V environment.</span></span>  

    <span data-ttu-id="b0664-212">如果 VPTR 较高并且 LPTR 较低，请考虑分配给虚拟机的附加处理器，如果有可用逻辑处理器和额外的处理器支持的来宾操作系统。</span><span class="sxs-lookup"><span data-stu-id="b0664-212">If VPTR is high and LPTR is low, then consider allocating additional processors to virtual machines if there are available logical processors and if additional processors are supported by the guest operating system.</span></span> <span data-ttu-id="b0664-213">在 VPTR 是高的情况下，LPTR 较低，没有可用逻辑处理器分配，但额外的处理器不支持的来宾操作系统，请考虑向外扩展通过将其他虚拟机添加到物理计算机和分配到这些虚拟机可用的处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-213">In the case where VPTR is high, LPTR is low, there are available logical processors to allocate, but additional processors are not supported by the guest operating system, consider scaling out by adding additional virtual machines to the physical computer and allocating available processors to these virtual machines.</span></span> <span data-ttu-id="b0664-214">VPTR 和 LPTR 较高的情况下，在配置推送的物理计算机的限制，并应考虑向外扩展通过将另一台物理计算机和其他 HYPER-V 虚拟机添加到环境。</span><span class="sxs-lookup"><span data-stu-id="b0664-214">In the case where both VPTR and LPTR are high, the configuration is pushing the limits of the physical computer and should consider scaling out by adding another physical computer and additional Hyper-V virtual machines to the environment.</span></span> <span data-ttu-id="b0664-215">下面的流程图描述的 HYPER-V 环境中的处理器性能故障排除时，应使用的过程。</span><span class="sxs-lookup"><span data-stu-id="b0664-215">The flowchart below describes the process that should be used when troubleshooting processor performance in a Hyper-V environment.</span></span>  

    <span data-ttu-id="b0664-216">![在超 CPU 性能故障排除&#45;V](../technical-guides/media/623fdcd6-e80b-4ba9-bf46-5d9b92b6612b.gif "623fdcd6-e80b-4ba9-bf46-5d9b92b6612b")</span><span class="sxs-lookup"><span data-stu-id="b0664-216">![Troubleshooting CPU Performance on Hyper&#45;V](../technical-guides/media/623fdcd6-e80b-4ba9-bf46-5d9b92b6612b.gif "623fdcd6-e80b-4ba9-bf46-5d9b92b6612b")</span></span>  
    <span data-ttu-id="b0664-217">在 HYPER-V 环境中的 CPU 性能故障排除</span><span class="sxs-lookup"><span data-stu-id="b0664-217">Troubleshooting CPU performance in a Hyper-V Environment</span></span>  

  > [!NOTE]  
  >  <span data-ttu-id="b0664-218">**来宾操作系统的处理器不具有组关联到物理处理器/核心**– 虚拟机监控程序确定如何物理资源使用。</span><span class="sxs-lookup"><span data-stu-id="b0664-218">**Guest operating system processors do not have a set affinity to physical processors/cores** – The hypervisor determines how physical resources are used.</span></span> <span data-ttu-id="b0664-219">在处理器利用率的情况下在虚拟机监控程序计划线程的窗体中物理处理器的来宾处理器时间。</span><span class="sxs-lookup"><span data-stu-id="b0664-219">In the case of processor utilization, the hypervisor schedules the guest processor time to physical processor in the form of threads.</span></span> <span data-ttu-id="b0664-220">这意味着虚拟机的处理器负载将分布在物理计算机的处理器。</span><span class="sxs-lookup"><span data-stu-id="b0664-220">This means the processor load of virtual machines will be spread across the processors of the physical computer.</span></span> <span data-ttu-id="b0664-221">此外，虚拟机不能超过配置的例如，如果一台虚拟机配置为使用 2 个逻辑处理器 8 处理器/核心的使用的物理计算机上运行的逻辑处理器数的处理器使用率则虚拟机不能超过配置的逻辑处理器 （在这种情况下 2 个处理器） 的数目的处理器能力。</span><span class="sxs-lookup"><span data-stu-id="b0664-221">Furthermore, virtual machines cannot exceed the processor utilization of the configured number of logical processors, for example if a single virtual machine is configured to run with 2 logical processors on a physical computer with 8 processors/cores, then the virtual machine cannot exceed the processor capacity of the number of configured logical processors (in this case 2 processors).</span></span>  

- <span data-ttu-id="b0664-222">**测量总处理器使用率的在 HYPER-V 环境中使用的 HYPER-V 性能监视计数器-** 为了测量处理器使用率，主机操作系统逻辑上被视为只是另一个来宾操作系统.</span><span class="sxs-lookup"><span data-stu-id="b0664-222">**Measure overall processor utilization of the Hyper-V environment using Hyper-V performance monitor counters -** For purposes of measuring processor utilization, the host operating system is logically viewed as just another guest operating system.</span></span> <span data-ttu-id="b0664-223">因此，"\Processor(\*)\\%Processor Time"监视器计数器测量主机操作系统系统的处理器使用率。</span><span class="sxs-lookup"><span data-stu-id="b0664-223">Therefore, the “\Processor(\*)\\% Processor Time” monitor counter measures the processor utilization of the host operating system only.</span></span> <span data-ttu-id="b0664-224">若要测量总物理处理器使用率的主机操作系统和所有来宾操作系统，请使用"\Hyper-V 虚拟机监控程序逻辑 processor （_total)\\%总运行时间"性能监视器计数器。</span><span class="sxs-lookup"><span data-stu-id="b0664-224">To measure total physical processor utilization of the host operating system and all guest operating systems, use the “\Hyper-V Hypervisor Logical Processor(_Total)\\% Total Run Time” performance monitor counter.</span></span> <span data-ttu-id="b0664-225">此计数器测量由处理器运行这两个主机操作系统所用时间的总百分比和所有来宾操作系统。</span><span class="sxs-lookup"><span data-stu-id="b0664-225">This counter measures the total percentage of time spent by the processor running the both the host operating system and all guest operating systems.</span></span>  

   <span data-ttu-id="b0664-226">使用以下阈值评估的 HYPER-V 环境使用的处理器总体利用率"\Hyper-V 虚拟机监控程序逻辑 processor （_total)\\%总运行时间"性能监视器计数器：</span><span class="sxs-lookup"><span data-stu-id="b0664-226">Use the following thresholds to evaluate overall processor utilization of the Hyper-V environment using the “\Hyper-V Hypervisor Logical Processor(_Total)\\% Total Run Time” performance monitor counter:</span></span>  

  - <span data-ttu-id="b0664-227">使用小于 60%= 正常</span><span class="sxs-lookup"><span data-stu-id="b0664-227">Less than 60% consumed = Healthy</span></span>  

  - <span data-ttu-id="b0664-228">60%-89 消耗 %= 监视或注意</span><span class="sxs-lookup"><span data-stu-id="b0664-228">60% - 89% consumed = Monitor or Caution</span></span>  

  - <span data-ttu-id="b0664-229">90%-100%使用 = 严重，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="b0664-229">90% - 100% consumed = Critical, performance will be adversely affected</span></span>  

    <span data-ttu-id="b0664-230">有关处理器使用率的详细信息查看以下资源：</span><span class="sxs-lookup"><span data-stu-id="b0664-230">For more information about processor utilization review the following resources:</span></span>  

  - <span data-ttu-id="b0664-231">"如何：标识在生产环境中导致服务器应用程序高用户模式 CPU 瓶颈的函数"处[ http://go.microsoft.com/fwlink/?LinkID=107047 ](http://go.microsoft.com/fwlink/?LinkID=107047)。</span><span class="sxs-lookup"><span data-stu-id="b0664-231">“How To: Identify Functions causing a High User-mode CPU Bottleneck for Server Applications in a Production Environment” at [http://go.microsoft.com/fwlink/?LinkID=107047](http://go.microsoft.com/fwlink/?LinkID=107047).</span></span>  

  - <span data-ttu-id="b0664-232">"第 15 章-测量.NET 应用程序性能"处[ http://go.microsoft.com/fwlink/?LinkId=121073 ](http://go.microsoft.com/fwlink/?LinkId=121073)。</span><span class="sxs-lookup"><span data-stu-id="b0664-232">“Chapter 15 - Measuring .NET Application Performance” at [http://go.microsoft.com/fwlink/?LinkId=121073](http://go.microsoft.com/fwlink/?LinkId=121073).</span></span>
