---
title: 清单：维护和故障排除 BizTalk Server 数据库 |Microsoft Docs
description: 请参阅帮助维护你的 BizTalk Server 数据库，包括自动更新统计信息，最大并行度，请重新生成索引的最佳做法、 查找锁和块，检查数据库的大小，使用跟踪、 启用 SQL Server 代理作业、 检查挂起的实例，并检查磁盘性能。 有关 BizTalk 终止符工具还读取。
ms.custom: ''
ms.date: 06/11/2018
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: a52e16eb86215ca977ff05b87a3c1baf556b0982
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65294803"
---
# <a name="checklist-maintaining-and-troubleshooting-biztalk-server-databases"></a><span data-ttu-id="29f3d-104">清单：维护和故障排除 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="29f3d-104">Checklist: Maintaining and Troubleshooting BizTalk Server Databases</span></span>
<span data-ttu-id="29f3d-105">BizTalk Server 数据库和它们的运行状况对于成功的 BizTalk Server 数据库邮件环境而言非常重要。</span><span class="sxs-lookup"><span data-stu-id="29f3d-105">BizTalk Server databases and their health are very important for a successful BizTalk Server database messaging environment.</span></span> <span data-ttu-id="29f3d-106">本主题列出了维护或故障排除 BizTalk Server 数据库时必须遵循的步骤。</span><span class="sxs-lookup"><span data-stu-id="29f3d-106">This topic lists the steps that you must follow when maintaining or troubleshooting the BizTalk Server databases.</span></span>  
  
-   [<span data-ttu-id="29f3d-107">维护 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="29f3d-107">Maintaining BizTalk Server Databases</span></span>](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [<span data-ttu-id="29f3d-108">BizTalk Server 数据库进行故障排除</span><span class="sxs-lookup"><span data-stu-id="29f3d-108">Troubleshooting BizTalk Server Databases</span></span>](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## <a name="maintaining-biztalk-server-databases"></a><span data-ttu-id="29f3d-109">维护 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="29f3d-109">Maintaining BizTalk Server Databases</span></span>  
  
|<span data-ttu-id="29f3d-110">步骤</span><span class="sxs-lookup"><span data-stu-id="29f3d-110">Steps</span></span>|<span data-ttu-id="29f3d-111">参考</span><span class="sxs-lookup"><span data-stu-id="29f3d-111">Reference</span></span>|  
|---|---|  
|<span data-ttu-id="29f3d-112">禁用**自动更新统计信息**并**自动创建统计信息**选项 （仅适用于 BizTalk Server MessageBox 数据库）。</span><span class="sxs-lookup"><span data-stu-id="29f3d-112">Disable the **Auto Update Statistics** and **Auto Create Statistics** options (applies only to BizTalk Server MessageBox databases).</span></span> | <span data-ttu-id="29f3d-113">**注意：** 默认情况下为 BizTalk Server 配置的一部分完成这些设置。</span><span class="sxs-lookup"><span data-stu-id="29f3d-113">**Note:**  These settings are done by default as part of the BizTalk Server configuration.</span></span> <span data-ttu-id="29f3d-114">不应该对这些设置进行更改。</span><span class="sxs-lookup"><span data-stu-id="29f3d-114">You should not make changes to these settings.</span></span> <br/><br/> <span data-ttu-id="29f3d-115">若要查看这些设置将被禁用，请在 SQL Server 中执行以下存储的过程：</span><span class="sxs-lookup"><span data-stu-id="29f3d-115">To see if these settings are disabled, execute the following stored procedures in SQL Server:</span></span><br/><br/> <span data-ttu-id="29f3d-116">SELECT DATABASEPROPERTYEX('BizTalkMsgBoxDB', 'IsAutoCreateStatistics') AS IsAutoCreateStatistics</span><span class="sxs-lookup"><span data-stu-id="29f3d-116">SELECT DATABASEPROPERTYEX('BizTalkMsgBoxDB', 'IsAutoCreateStatistics') AS IsAutoCreateStatistics</span></span><br/><span data-ttu-id="29f3d-117">SELECT DATABASEPROPERTYEX('BizTalkMsgBoxDB', 'IsAutoUpdateStatistics') AS IsAutoUpdateStatistics</span><span class="sxs-lookup"><span data-stu-id="29f3d-117">SELECT DATABASEPROPERTYEX('BizTalkMsgBoxDB', 'IsAutoUpdateStatistics') AS IsAutoUpdateStatistics</span></span><br/><br/><span data-ttu-id="29f3d-118">返回的值应为**0**以指示设置处于禁用状态。</span><span class="sxs-lookup"><span data-stu-id="29f3d-118">The values returned should be **0** to indicate the setting is disabled.</span></span> <span data-ttu-id="29f3d-119">如果**0**是未返回，通过执行以下命令在 SQL Server 中禁用该设置：</span><span class="sxs-lookup"><span data-stu-id="29f3d-119">If **0** is not returned, disable the setting by executing the following in SQL Server:</span></span><br/><br/><span data-ttu-id="29f3d-120">ALTER DATABASE BizTalkMsgBoxDB SET AUTO_CREATE_STATISTICS OFF</span><span class="sxs-lookup"><span data-stu-id="29f3d-120">ALTER DATABASE BizTalkMsgBoxDB SET AUTO_CREATE_STATISTICS OFF</span></span><br/><span data-ttu-id="29f3d-121">ALTER DATABASE BizTalkMsgBoxDB SET AUTO_UPDATE_STATISTICS OFF</span><span class="sxs-lookup"><span data-stu-id="29f3d-121">ALTER DATABASE BizTalkMsgBoxDB SET AUTO_UPDATE_STATISTICS OFF</span></span><br/><br/> <span data-ttu-id="29f3d-122">有关这些设置的详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="29f3d-122">For more information about these settings, see:</span></span><br/><br/> <span data-ttu-id="29f3d-123">-   **917845**—["你遇到阻止，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库死锁条件或其他 SQL Server 问题"](http://go.microsoft.com/fwlink/?LinkId=153429)</span><span class="sxs-lookup"><span data-stu-id="29f3d-123">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429)</span></span><br /><span data-ttu-id="29f3d-124">-   **912262**—["自动更新统计信息选项的自动创建统计信息选项和作为 BizTalk Server BizTalkMsgBoxDB 数据库宿主的 SQL Server 数据库实例中关闭的并行度设置"](http://go.microsoft.com/fwlink/?LinkId=153430)</span><span class="sxs-lookup"><span data-stu-id="29f3d-124">-   **912262**—["The auto update statistics option, the auto create statistics option, and the Parallelism setting are turned off in the SQL Server database instance that hosts the BizTalk Server BizTalkMsgBoxDB database"](http://go.microsoft.com/fwlink/?LinkId=153430)</span></span>|  
|<span data-ttu-id="29f3d-125">设置最大并行度属性</span><span class="sxs-lookup"><span data-stu-id="29f3d-125">Set the Max Degree of Parallelism property</span></span>|<span data-ttu-id="29f3d-126">**注意：** 默认情况下为 BizTalk Server 配置的一部分完成这些设置。</span><span class="sxs-lookup"><span data-stu-id="29f3d-126">**Note:**  These settings are done by default as part of the BizTalk Server configuration.</span></span> <span data-ttu-id="29f3d-127">不应该对这些设置进行更改。</span><span class="sxs-lookup"><span data-stu-id="29f3d-127">You should not make changes to these settings.</span></span> <br /><br /> <span data-ttu-id="29f3d-128">设置最大并行度**run_value**并**config_value**值一 (1) 上承载 BizTalk Server Messagebox 数据库的 SQL Server 实例的属性。</span><span class="sxs-lookup"><span data-stu-id="29f3d-128">Set the Max Degree of Parallelism **run_value** and **config_value** properties to a value of one (1) on the SQL Server instances that host the BizTalk Server Messagebox databases.</span></span> <span data-ttu-id="29f3d-129">若要检查最大并行度设置，请执行以下存储过程针对主 SQL Server 数据库中：</span><span class="sxs-lookup"><span data-stu-id="29f3d-129">To check the Max Degree of Parallelism setting, execute the following stored procedure against the Master database in SQL Server:</span></span><br /><br /> <span data-ttu-id="29f3d-130">exec sp_configure 'max degree of parallelism'</span><span class="sxs-lookup"><span data-stu-id="29f3d-130">exec sp_configure 'max degree of parallelism'</span></span><br /><br /> <span data-ttu-id="29f3d-131">如果**run_value**并**config_value**是未设置为值一 (1)，在 SQL Server 中执行以下存储的过程：</span><span class="sxs-lookup"><span data-stu-id="29f3d-131">If the **run_value** and **config_value** are not set to a value of one (1), execute the following stored procedure in SQL Server:</span></span><br /><br /> <span data-ttu-id="29f3d-132">exec sp_configure 'max degree of parallelism'、 '1' 的重新配置的重写</span><span class="sxs-lookup"><span data-stu-id="29f3d-132">exec sp_configure 'max degree of parallelism', '1'                 reconfigure with override</span></span><br /><br /> <span data-ttu-id="29f3d-133">最大并行度设置如何影响 BizTalk Server 的详细信息，请参阅以下 Microsoft 知识库文章：</span><span class="sxs-lookup"><span data-stu-id="29f3d-133">For more information about how the Max Degree of Parallelism setting affects BizTalk Server, see the following Microsoft Knowledge Base articles:</span></span><br /><br /> <span data-ttu-id="29f3d-134">-   **899000**—["配置 BizTalk Server 时的 SQL server 实例的并行度设置"](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-134">-   **899000**—["The Parallelism setting for the instance of SQL Server when you configure BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432).</span></span><br /><span data-ttu-id="29f3d-135">-   **917845**—["你遇到阻止，死锁条件或其他 SQL Server 问题，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-135">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span>|  
|<span data-ttu-id="29f3d-136">确定当重新生成 BizTalk Server 索引</span><span class="sxs-lookup"><span data-stu-id="29f3d-136">Determine when you can rebuild BizTalk Server indexes</span></span>|<span data-ttu-id="29f3d-137">群集化大部分 BizTalk Server 数据库中的索引 (索引 ID:1).</span><span class="sxs-lookup"><span data-stu-id="29f3d-137">Most of the indexes in BizTalk Server databases are clustered (index ID: 1).</span></span> <span data-ttu-id="29f3d-138">DBCC SHOWCONTIG 命令可以用于显示 BizTalk Server 数据库中表的碎片信息。</span><span class="sxs-lookup"><span data-stu-id="29f3d-138">The DBCC SHOWCONTIG command can be used to display fragmentation information for tables in the BizTalk Server databases.</span></span> <span data-ttu-id="29f3d-139">这些索引是基于 GUID 的是正常的碎片发生。</span><span class="sxs-lookup"><span data-stu-id="29f3d-139">These indexes are GUID-based so it is normal for fragmentation to occur.</span></span> <span data-ttu-id="29f3d-140">DBCC SHOWCONTIG 的扫描密度值是否小于 30%，可以在停机期间重新生成索引。</span><span class="sxs-lookup"><span data-stu-id="29f3d-140">If the Scan Density value of DBCC SHOWCONTIG is less than 30%, the indexes can be rebuilt during downtime.</span></span> <span data-ttu-id="29f3d-141">在 BizTalk Server 数据库中的多个表包含使用数据类型定义不能执行联机索引的列。</span><span class="sxs-lookup"><span data-stu-id="29f3d-141">Many tables in the BizTalk Server databases contain columns that use DataType definitions where online indexing cannot be done.</span></span> <span data-ttu-id="29f3d-142">因此，BizTalk Server 数据库中的表应永远不会重新生成索引时 BizTalk 正在处理的数据。</span><span class="sxs-lookup"><span data-stu-id="29f3d-142">Therefore, the indexes for tables in the BizTalk Server databases should never be rebuilt while BizTalk is processing data.</span></span> <span data-ttu-id="29f3d-143">有关如何重新生成 BizTalk 索引的详细信息，请参阅以下 Microsoft 知识库文章：</span><span class="sxs-lookup"><span data-stu-id="29f3d-143">For more information on how to rebuild the BizTalk indexes, see the following Microsoft Knowledge Base article:</span></span><br /><br /> <span data-ttu-id="29f3d-144">-   **917845**—["你遇到阻止，死锁条件或其他 SQL Server 问题，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-144">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span><br /><br /> <span data-ttu-id="29f3d-145">**注意：** Sys.dm_db_index_physical_stats 函数还可用于查找 SQL Server 中的碎片信息。</span><span class="sxs-lookup"><span data-stu-id="29f3d-145">**Note:**  You can also use the sys.dm_db_index_physical_stats function to look for fragmentation information in SQL Server.</span></span> <span data-ttu-id="29f3d-146">有关详细信息，请参阅[sys.dm_db_index_physical_stats (TRANSACT-SQL)](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-146">For more information, see [sys.dm_db_index_physical_stats (Transact-SQL)](https://docs.microsoft.com/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql).</span></span>|  
|<span data-ttu-id="29f3d-147">监视数据库的锁、 块或死锁</span><span class="sxs-lookup"><span data-stu-id="29f3d-147">Monitor the database for locks, blocks, or deadlocks</span></span>|<span data-ttu-id="29f3d-148">它是锁和块以使用 BizTalk Server 的 SQL Server 数据库上发生的预期的行为。</span><span class="sxs-lookup"><span data-stu-id="29f3d-148">It is an expected behavior for locks and blocks to occur on the SQL Server databases used by BizTalk Server.</span></span> <span data-ttu-id="29f3d-149">但是，它不需要具有这些锁或要持续长时间内的块。</span><span class="sxs-lookup"><span data-stu-id="29f3d-149">However, it is not expected to have these locks or blocks to continue for an extended period of time.</span></span> <span data-ttu-id="29f3d-150">扩展阻塞和死锁的 SQL Server 使用的 BizTalk Server 数据库进行的潜在问题的指示器。</span><span class="sxs-lookup"><span data-stu-id="29f3d-150">Extended blocking and deadlocking on the SQL Server databases used by BizTalk Server are indicators of a potential problem.</span></span> <span data-ttu-id="29f3d-151">当前的已知原因死锁和阻止在 BizTalk Server 使用的 SQL Server 数据库上，查看以下 Microsoft 知识库文章：</span><span class="sxs-lookup"><span data-stu-id="29f3d-151">For the current known causes of deadlocking and blocking on the SQL Server databases used by BizTalk Server, review the following Microsoft Knowledge Base article:</span></span><br /><br /> <span data-ttu-id="29f3d-152">-   **917845**—["你遇到阻止，死锁条件或其他 SQL Server 问题，当您尝试连接到 BizTalk Server 中在 BizTalkMsgBoxDb 数据库"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-152">-   **917845**—["You experience blocking, deadlock conditions, or other SQL Server issues when you try to connect to the BizTalkMsgBoxDb database in BizTalk Server"](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).</span></span>|  
|<span data-ttu-id="29f3d-153">监视数据库和表的大小</span><span class="sxs-lookup"><span data-stu-id="29f3d-153">Monitor the size of databases and tables</span></span>|<span data-ttu-id="29f3d-154">BizTalk Server Messagebox 数据库的大小通常应不超过大约为 5 GB。</span><span class="sxs-lookup"><span data-stu-id="29f3d-154">The size of the BizTalk Server Messagebox database should typically be no more than approximately 5GB.</span></span>  <span data-ttu-id="29f3d-155">在 BizTalkMsgBoxDb 数据库不应包含任何数据，并应被视为一个缓冲区，直到处理或移至 BizTalkDTADb 数据库数据。</span><span class="sxs-lookup"><span data-stu-id="29f3d-155">The BizTalkMsgBoxDb database should not be holding any data, and should be considered a buffer until the data is processed or moved to the BizTalkDTADb database.</span></span> <span data-ttu-id="29f3d-156">具有一个功能强大的 SQL Server 后端以及大量长时间运行的业务流程的环境可能具有 BizTalkMsgBoxDb 数据库大小超过 5 GB。</span><span class="sxs-lookup"><span data-stu-id="29f3d-156">An environment with a powerful SQL Server backend and numerous long running orchestrations may have a BizTalkMsgBoxDb database larger than 5GB.</span></span> <span data-ttu-id="29f3d-157">任何长时间运行的业务流程的大容量环境应具有 BizTalk Server Messagebox 数据库远小于 5 GB。</span><span class="sxs-lookup"><span data-stu-id="29f3d-157">A high volume environment with no long-running orchestrations should have a BizTalk Server Messagebox database much smaller than 5GB.</span></span> <span data-ttu-id="29f3d-158">BizTalk Server 跟踪数据库可能大不相同的大小，但如果查询性能会显著降低，然后跟踪数据库可能是太大。</span><span class="sxs-lookup"><span data-stu-id="29f3d-158">The BizTalk Server tracking database can vary greatly in size but if query performance decreases dramatically, then the tracking database is probably too large.</span></span> <span data-ttu-id="29f3d-159">根据经验，BizTalk Server 跟踪数据库大小超过 15 到 20 GB 被视为太大，可能会对性能产生不利影响。</span><span class="sxs-lookup"><span data-stu-id="29f3d-159">As a rule of thumb, a BizTalk Server tracking database larger than 15-20 GB is considered too large and may adversely impact performance.</span></span> <span data-ttu-id="29f3d-160">以下问题可能是由 BizTalk Server 数据库过大引起：</span><span class="sxs-lookup"><span data-stu-id="29f3d-160">The following issues may be attributable to BizTalk Server databases that are too large:</span></span><br /><br /> <span data-ttu-id="29f3d-161">BizTalk Server Messagebox 数据库会不断增大时 （而不仅仅是日志文件） 的数据大小仍然很大。</span><span class="sxs-lookup"><span data-stu-id="29f3d-161">-   The BizTalk Server Messagebox database continues to grow while the data size (not just the log file) remains large.</span></span> <span data-ttu-id="29f3d-162">BizTalk Server 需要更长的时间比平时要处理甚至简单的消息流方案。</span><span class="sxs-lookup"><span data-stu-id="29f3d-162">BizTalk Server takes a longer time than normal to process even a simple message flow scenario.</span></span><br /><span data-ttu-id="29f3d-163">组中心查询需要比平时更长时间，可能甚至会超时。</span><span class="sxs-lookup"><span data-stu-id="29f3d-163">-   Group Hub queries take a longer time than normal and may even timeout.</span></span><br /><span data-ttu-id="29f3d-164">-数据库日志文件永远不会被截断。</span><span class="sxs-lookup"><span data-stu-id="29f3d-164">-   The database log file never gets truncated.</span></span><br /><span data-ttu-id="29f3d-165">-BizTalk SQL 代理作业运行速度慢于正常运行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-165">-   The BizTalk SQL Agent jobs run slower than normal.</span></span><br /><span data-ttu-id="29f3d-166">-某些表是相当大或过多的行比较正常状态。</span><span class="sxs-lookup"><span data-stu-id="29f3d-166">-   Some tables are considerably large or have too many rows compared to normal.</span></span><br /><br /> <span data-ttu-id="29f3d-167">BizTalk Server 数据库会变得大几个原因：</span><span class="sxs-lookup"><span data-stu-id="29f3d-167">The BizTalk Server databases can become large for several reasons including:</span></span><br /><br /> <span data-ttu-id="29f3d-168">BizTalk SQL 代理作业未运行</span><span class="sxs-lookup"><span data-stu-id="29f3d-168">-   BizTalk SQL Agent Jobs not running</span></span><br /><span data-ttu-id="29f3d-169">-过多挂起的消息或服务实例</span><span class="sxs-lookup"><span data-stu-id="29f3d-169">-   Excessive suspended message or service instances</span></span><br /><span data-ttu-id="29f3d-170">-磁盘故障</span><span class="sxs-lookup"><span data-stu-id="29f3d-170">-   Disk failures</span></span><br /><span data-ttu-id="29f3d-171">的高级别的跟踪</span><span class="sxs-lookup"><span data-stu-id="29f3d-171">-   High levels of tracking</span></span><br /><span data-ttu-id="29f3d-172">BizTalk 服务器的限制</span><span class="sxs-lookup"><span data-stu-id="29f3d-172">-   BizTalk Server throttling</span></span><br /><span data-ttu-id="29f3d-173">的 SQL Server 性能不佳</span><span class="sxs-lookup"><span data-stu-id="29f3d-173">-   Poor SQL Server performance</span></span><br /><span data-ttu-id="29f3d-174">-网络延迟问题</span><span class="sxs-lookup"><span data-stu-id="29f3d-174">-   Network latency issues</span></span><br /><br /> <span data-ttu-id="29f3d-175">同样，您可以在表中具有过多的行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-175">Similarly, you can have too many rows in a table.</span></span> <span data-ttu-id="29f3d-176">没有任何组过多的行数。</span><span class="sxs-lookup"><span data-stu-id="29f3d-176">There is no set number of rows that are too many.</span></span> <span data-ttu-id="29f3d-177">此外，此数量的行的表中存储的数据类型而异。</span><span class="sxs-lookup"><span data-stu-id="29f3d-177">Additionally, this number of rows varies by what kind of data is stored in the table.</span></span> <span data-ttu-id="29f3d-178">例如， *dta_DebugTrace*可能有超过 1 百万个行的表具有过多的行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-178">For example, a *dta_DebugTrace* table that has more than 1 million rows probably has too many rows.</span></span> <span data-ttu-id="29f3d-179">一个*HostNameQ_Suspended*可能具有多个 200,000 个行的表具有过多的行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-179">A *HostNameQ_Suspended* table that has more than 200,000 rows probably has too many rows.</span></span><br /><br /> <span data-ttu-id="29f3d-180">请确保您知道预期在您的环境来确定是否发生数据问题。</span><span class="sxs-lookup"><span data-stu-id="29f3d-180">Make sure that you know what is expected in your environment to determine whether a data issue is occurring.</span></span>|  
|<span data-ttu-id="29f3d-181">启用 BizTalk Server 主机上的跟踪</span><span class="sxs-lookup"><span data-stu-id="29f3d-181">Enable tracking on BizTalk Server host</span></span>|<span data-ttu-id="29f3d-182">默认情况下，默认主机上启用跟踪。</span><span class="sxs-lookup"><span data-stu-id="29f3d-182">By default, tracking is enabled on the default host.</span></span> <span data-ttu-id="29f3d-183">BizTalk 要求**允许主机跟踪**检查一台主机上的选项。</span><span class="sxs-lookup"><span data-stu-id="29f3d-183">BizTalk requires the **Allow Host Tracking** option be checked on a single HOST.</span></span> <span data-ttu-id="29f3d-184">跟踪数据解码服务 (TDDS) 启用跟踪后，将跟踪移动到 BizTalk Server 跟踪数据库的事件数据从 BizTalk Server Messagebox 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-184">When tracking is enabled, the Tracking Data Decode Service (TDDS) moves the tracking event data from the BizTalk Server Messagebox database to the BizTalk Server tracking database.</span></span> <span data-ttu-id="29f3d-185">如果没有 BizTalk Server 主机配置为具有选项**允许主机跟踪**或如果跟踪主机已停止，则 TDDS 将不会运行并且 BizTalk Server Messagebox 数据库中的 TrackingData_x_x 表将增长未选中状态。</span><span class="sxs-lookup"><span data-stu-id="29f3d-185">If no BizTalk Server hosts are configured with the option to **Allow Host Tracking** or if the tracking host is stopped, then TDDS will not run and the TrackingData_x_x tables in the BizTalk Server Messagebox database will grow unchecked.</span></span> <span data-ttu-id="29f3d-186">因此，应将专用的 BizTalk Server 主机配置选项**允许主机跟踪**。</span><span class="sxs-lookup"><span data-stu-id="29f3d-186">Therefore, a dedicated BizTalk Server host should be configured with the option to **Allow Host Tracking**.</span></span> <span data-ttu-id="29f3d-187">有关配置专用的跟踪主机的详细信息请参阅[配置专用跟踪主机](~/technical-guides/configuring-a-dedicated-tracking-host.md)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-187">For more information about configuring a dedicated tracking host see [Configuring a Dedicated Tracking Host](~/technical-guides/configuring-a-dedicated-tracking-host.md).</span></span> <span data-ttu-id="29f3d-188">**注意：** 若要允许 TDDS 维护在大容量方案中的新跟踪事件，可以创建一个跟踪主机的多个实例，但不是超过一台主机应该配置对其进行跟踪。</span><span class="sxs-lookup"><span data-stu-id="29f3d-188">**Note:**  To allow TDDS to maintain new tracking events in high volume scenarios, you can create multiple instances of a single tracking host but no more than one host should be configured for tracking.</span></span>|  
|<span data-ttu-id="29f3d-189">使用正确的 BizTalk SQL Server 代理作业</span><span class="sxs-lookup"><span data-stu-id="29f3d-189">Use the correct BizTalk SQL Server Agent jobs</span></span>|<span data-ttu-id="29f3d-190">BizTalk Server SQL 代理作业的执行是用于管理 BizTalk Server 数据库以及保持最佳性能至关重要。</span><span class="sxs-lookup"><span data-stu-id="29f3d-190">Execution of the BizTalk Server SQL Agent jobs are crucial for managing the BizTalk Server databases and for maintaining optimal performance.</span></span><br /><br /> <span data-ttu-id="29f3d-191">-**备份 BizTalk Server** SQL Server 代理作业是唯一受支持的方法，BizTalk Server 数据库备份。</span><span class="sxs-lookup"><span data-stu-id="29f3d-191">-   The  **Backup BizTalk Server** SQL Server Agent job is the only supported method to back up the BizTalk Server databases.</span></span> <span data-ttu-id="29f3d-192">此作业需要将所有 BizTalk Server 数据库都设置为使用完整恢复模式。</span><span class="sxs-lookup"><span data-stu-id="29f3d-192">This job requires you to set up all BizTalk Server databases to use a Full Recovery Model.</span></span> <span data-ttu-id="29f3d-193">你应配置 BizTalk Server 环境中正常运行此作业。</span><span class="sxs-lookup"><span data-stu-id="29f3d-193">You should configure this job for a healthy BizTalk Server environment.</span></span> <span data-ttu-id="29f3d-194">SQL Server 方法可用于备份 BizTalk Server 数据库，只有 SQL Server 服务已停止，并且所有 BizTalk Server 进程已都停止。</span><span class="sxs-lookup"><span data-stu-id="29f3d-194">You can use the SQL Server methods to back up the BizTalk Server databases only if the SQL Server service is stopped and if all BizTalk Server processes are stopped.</span></span> <span data-ttu-id="29f3d-195">**注意：**     有关配置 SQL 代理备份 BizTalk Server 作业时使用 SQL Server 完整恢复模式的详细信息，请参阅[日志传送](http://go.microsoft.com/fwlink/?LinkId=153450)(http://go.microsoft.com/fwlink/?LinkId=153450)或[备份完整恢复模式下的](http://go.microsoft.com/fwlink/?LinkId=156509)(http://go.microsoft.com/fwlink/?LinkId=156509).</span><span class="sxs-lookup"><span data-stu-id="29f3d-195">**Note:**      For more information about using the SQL Server full recovery model when configuring the SQL Agent Backup BizTalk Server job, see [Log Shipping](http://go.microsoft.com/fwlink/?LinkId=153450) (http://go.microsoft.com/fwlink/?LinkId=153450) or [Backup Under the Full Recovery Model](http://go.microsoft.com/fwlink/?LinkId=156509) (http://go.microsoft.com/fwlink/?LinkId=156509).</span></span><br /><span data-ttu-id="29f3d-196">- **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb**旨在无限期地运行 SQL Server 代理作业。</span><span class="sxs-lookup"><span data-stu-id="29f3d-196">-   The **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job is designed to run indefinitely.</span></span> <span data-ttu-id="29f3d-197">因此 SQL 代理作业历史记录可能不表示此 SQL 代理作业已成功完成;此行为是默认设置。</span><span class="sxs-lookup"><span data-stu-id="29f3d-197">As a result the SQL Agent job history may not indicate that this SQL Agent job has successfully completed; this behavior is by design.</span></span> <span data-ttu-id="29f3d-198">如果故障，该作业将在 1 分钟内重新启动并继续运行减弱。</span><span class="sxs-lookup"><span data-stu-id="29f3d-198">If there is a failure, the job will restart within 1 minute and continue running unabated.</span></span> <span data-ttu-id="29f3d-199">因此，通常可以忽略此作业的失败通知。</span><span class="sxs-lookup"><span data-stu-id="29f3d-199">Therefore, failure notifications for this job can typically be ignored.</span></span> <span data-ttu-id="29f3d-200">如果 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server 代理作业的作业历史记录指示是不断失败并重新启动此作业的失败/重新启动循环的原因的进一步调查可能需要。</span><span class="sxs-lookup"><span data-stu-id="29f3d-200">If the job history for the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent job indicates that this job is constantly failing and restarting then further investigation into the cause of the failure/restart cycle may be required.</span></span><br /><span data-ttu-id="29f3d-201">- **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server 代理作业是唯一不应手动启用因为它由 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 作业启动的作业。</span><span class="sxs-lookup"><span data-stu-id="29f3d-201">-   The **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** SQL Server Agent job is the only job that should not be manually enabled because it is initiated by the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb job.</span></span><br /><span data-ttu-id="29f3d-202">- **DTA 清除和存档**SQL Server 代理作业通过清除和存档跟踪的消息来维护 BizTalk Server 跟踪数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-202">-   The **DTA Purge and Archive** SQL Server Agent job maintains the BizTalk Server tracking database by purging and archiving tracked messages.</span></span> <span data-ttu-id="29f3d-203">此作业读取表中的每一行，并将每个行，以确定是否应删除该记录的时间戳进行比较。</span><span class="sxs-lookup"><span data-stu-id="29f3d-203">This job reads every row in the table and compares the timestamp of each row to determine if the record should be removed.</span></span> <span data-ttu-id="29f3d-204">**注意：** 故障排除时 BizTalk Server SQL Server 代理作业，请验证 MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb 除外的所有 SQL 代理作业都完成未出现错误。</span><span class="sxs-lookup"><span data-stu-id="29f3d-204">**Note:**  When troubleshooting the BizTalk Server SQL Server Agent jobs, verify that all SQL Agent jobs except the MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb are completing without errors.</span></span> <br /><br /> <span data-ttu-id="29f3d-205">有关在 SQL Server 中使用 BizTalk Server SQL 代理作业的详细信息：</span><span class="sxs-lookup"><span data-stu-id="29f3d-205">For more information about the BizTalk Server SQL Agent Jobs used in SQL Server:</span></span><br /><br /> <span data-ttu-id="29f3d-206">-请参阅[数据库结构和作业](http://go.microsoft.com/fwlink/?LinkId=153451)(http://go.microsoft.com/fwlink/?LinkId=153451)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-206">-   See [Database Structure and Jobs](http://go.microsoft.com/fwlink/?LinkId=153451) (http://go.microsoft.com/fwlink/?LinkId=153451).</span></span><br /><span data-ttu-id="29f3d-207">-请参阅[在 BizTalk Server 中的说明的 SQL Server 代理作业](http://go.microsoft.com/fwlink/?LinkId=153452)(http://go.microsoft.com/fwlink/?LinkId=153452)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-207">-   See [Description of the SQL Server Agent jobs in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452).</span></span>|  
|<span data-ttu-id="29f3d-208">监视和终止挂起的实例</span><span class="sxs-lookup"><span data-stu-id="29f3d-208">Monitor and terminate suspended instances</span></span>|<span data-ttu-id="29f3d-209">服务实例可能已挂起 （可恢复） 或挂起 （不可恢复）。</span><span class="sxs-lookup"><span data-stu-id="29f3d-209">Service instances can be suspended (resumable) or suspended (not resumable).</span></span> <span data-ttu-id="29f3d-210">这些服务实例可以是消息传送、 业务流程或端口。</span><span class="sxs-lookup"><span data-stu-id="29f3d-210">These service instances may be Messaging, Orchestration, or Port.</span></span> <span data-ttu-id="29f3d-211">BizTalk Server 通过使用组中心页，在 BizTalk Server 管理控制台或通过使用 Terminate.vbs 脚本将要终止和删除这些实例。</span><span class="sxs-lookup"><span data-stu-id="29f3d-211">BizTalk Server accommodates termination and removal of these instances by using the Group Hub page in the BizTalk Server Administration Console or through the use of the Terminate.vbs script.</span></span> <span data-ttu-id="29f3d-212">有关 Terminate.vbs 脚本的详细信息，请参阅[删除挂起的服务实例](http://go.microsoft.com/fwlink/?LinkId=153453)(http://go.microsoft.com/fwlink/?LinkId=153453)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-212">For more information about the Terminate.vbs script, see [Removing Suspended Service Instance](http://go.microsoft.com/fwlink/?LinkId=153453) (http://go.microsoft.com/fwlink/?LinkId=153453).</span></span> <span data-ttu-id="29f3d-213">**提示：** 终止符工具还可用于删除挂起的实例。</span><span class="sxs-lookup"><span data-stu-id="29f3d-213">**Tip:**  You can also use the Terminator tool to remove suspended instances.</span></span> <span data-ttu-id="29f3d-214">[终止符工具](http://go.microsoft.com/fwlink/?LinkId=151931)位于[ http://go.microsoft.com/fwlink/?LinkId=151931 ](http://go.microsoft.com/fwlink/?LinkId=151931)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-214">The [Terminator tool](http://go.microsoft.com/fwlink/?LinkId=151931) is available at [http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931).</span></span> <span data-ttu-id="29f3d-215">使用此工具不受 Microsoft，因此 Microsoft 不保证此程序的适用性。</span><span class="sxs-lookup"><span data-stu-id="29f3d-215">Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="29f3d-216">使用此程序是完全由您自己承担。</span><span class="sxs-lookup"><span data-stu-id="29f3d-216">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="29f3d-217">术语"孤立"和"僵尸电脑"通常互换使用。</span><span class="sxs-lookup"><span data-stu-id="29f3d-217">The terms "orphans” and "zombies" are often used interchangeably.</span></span> <span data-ttu-id="29f3d-218">孤立或僵停消息是不具有关联的服务实例，通常由于服务实例已终止之前收到了消息的消息。</span><span class="sxs-lookup"><span data-stu-id="29f3d-218">An orphaned or zombie message is a message that does not have an associated service instance, typically because the service instance has terminated before the message was received.</span></span> <span data-ttu-id="29f3d-219">孤立或僵停服务是一种服务，没有任何关联的消息。</span><span class="sxs-lookup"><span data-stu-id="29f3d-219">An orphaned or zombie service is a service that does not have any associated messages.</span></span> <span data-ttu-id="29f3d-220">请参阅有关僵停消息和服务的详细信息了解在 BizTalk Server 中的实例[BizTalk Server 中的僵停](http://go.microsoft.com/fwlink/?LinkId=153454)(http://go.microsoft.com/fwlink/?LinkId=153454)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-220">For more information about zombie messages and service instances in BizTalk Server see [Zombies in BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454).</span></span>|  
|<span data-ttu-id="29f3d-221">监视的性能计数器**PhysicalDisk**性能对象</span><span class="sxs-lookup"><span data-stu-id="29f3d-221">Monitor the performance counters of the **PhysicalDisk** performance object</span></span>|<span data-ttu-id="29f3d-222">BizTalk Server 在一分钟内对 SQL 服务器发出大量的较短的非常快速的事务。</span><span class="sxs-lookup"><span data-stu-id="29f3d-222">BizTalk Server makes a large number of short, very quick transactions to SQL Server within one minute.</span></span> <span data-ttu-id="29f3d-223">如果 SQL Server 不能承受此活动，可能会遇到 BizTalk Server 性能问题。</span><span class="sxs-lookup"><span data-stu-id="29f3d-223">If the SQL Server cannot sustain this activity, you may experience BizTalk Server performance issues.</span></span> <span data-ttu-id="29f3d-224">监视器**avg.Disk sec/Read**， **avg.Disk sec/Transfer**，和**avg.Disk sec/Write**中的性能监视器计数器**PhysicalDisk**性能对象。</span><span class="sxs-lookup"><span data-stu-id="29f3d-224">Monitor the **Avg. Disk sec/Read**, **Avg. Disk sec/Transfer**, and **Avg. Disk sec/Write** performance monitor counters in the **PhysicalDisk** performance object.</span></span> <span data-ttu-id="29f3d-225">最佳值是小于 10 毫秒 （毫秒）。</span><span class="sxs-lookup"><span data-stu-id="29f3d-225">The optimal value is less than 10 ms (milliseconds).</span></span> <span data-ttu-id="29f3d-226">一个或更大的 20 毫秒的值被视为性能不佳。</span><span class="sxs-lookup"><span data-stu-id="29f3d-226">A value of 20 ms or larger is considered poor performance.</span></span><br /><br /><span data-ttu-id="29f3d-227">-对于 BizTalk Server 数据库的高可用性的详细信息，请参阅[的 BizTalk Server 数据库提供高可用性](../core/providing-high-availability-for-biztalk-server-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-227">-   For more information about BizTalk Server database high availability, see [Providing High Availability for BizTalk Server Databases](../core/providing-high-availability-for-biztalk-server-databases.md).</span></span>|  
|<span data-ttu-id="29f3d-228">执行 BizTalk Server 数据库的最佳方案。</span><span class="sxs-lookup"><span data-stu-id="29f3d-228">Follow best practices for BizTalk Server databases.</span></span>|<span data-ttu-id="29f3d-229">请参阅[维护 BizTalk Server 数据库的最佳实践](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-229">See [Best Practices for Maintaining BizTalk Server Databases](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md).</span></span>|  
  
<a name="BKMK_Troubleshoot"></a>   
## <a name="troubleshooting-biztalk-server-databases"></a><span data-ttu-id="29f3d-230">BizTalk Server 数据库进行故障排除</span><span class="sxs-lookup"><span data-stu-id="29f3d-230">Troubleshooting BizTalk Server Databases</span></span>  
 <span data-ttu-id="29f3d-231">执行以下任务来排查与 BizTalk Server 数据库的任何问题。</span><span class="sxs-lookup"><span data-stu-id="29f3d-231">Perform the following tasks to troubleshoot any issues with BizTalk Server databases.</span></span>  
  
|<span data-ttu-id="29f3d-232">步骤</span><span class="sxs-lookup"><span data-stu-id="29f3d-232">Steps</span></span>|<span data-ttu-id="29f3d-233">参考</span><span class="sxs-lookup"><span data-stu-id="29f3d-233">Reference</span></span>|  
|-----------|---------------|  
|<span data-ttu-id="29f3d-234">确保所有必需的 BizTalk SQL Server 代理作业已启用并正在运行</span><span class="sxs-lookup"><span data-stu-id="29f3d-234">Ensure all required BizTalk SQL Server Agent jobs are enabled and running</span></span>|<span data-ttu-id="29f3d-235">所有 BizTalk SQL Server 代理都作业除外**MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb**作业应已成功为启用并正在运行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-235">All the BizTalk SQL Server Agent jobs except the **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** job should be enabled and running successfully.</span></span> <span data-ttu-id="29f3d-236">请勿禁用任何其他作业。</span><span class="sxs-lookup"><span data-stu-id="29f3d-236">Do not disable any other job.</span></span><br /><br /> <span data-ttu-id="29f3d-237">如果发生故障，使用**查看历史记录**查看错误信息，并相应地进行解决失败的 SQL Server 中的选项。</span><span class="sxs-lookup"><span data-stu-id="29f3d-237">If a failure occurs, use the **View History** option in SQL Server to view the error information, and then troubleshoot the failure accordingly.</span></span> <span data-ttu-id="29f3d-238">请记住， **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server 代理作业将无限期运行。</span><span class="sxs-lookup"><span data-stu-id="29f3d-238">Remember that the **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** SQL Server Agent job runs infinitely.</span></span> <span data-ttu-id="29f3d-239">因此，您只应考虑如果作业历史记录报告的作业不断失败并重新启动。</span><span class="sxs-lookup"><span data-stu-id="29f3d-239">Therefore, you should only be concerned if the job history reports that the job constantly fails and restarts.</span></span>|  
|<span data-ttu-id="29f3d-240">使用 MsgBoxViewer 工具来分析 BizTalk MessageBox 和其他数据库</span><span class="sxs-lookup"><span data-stu-id="29f3d-240">Use the MsgBoxViewer tool to analyze the BizTalk MessageBox and other databases</span></span>|<span data-ttu-id="29f3d-241">**重要提示：** 使用此工具不受 Microsoft，因此 Microsoft 不保证此程序的适用性。</span><span class="sxs-lookup"><span data-stu-id="29f3d-241">**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="29f3d-242">使用此程序是完全由您自己承担。</span><span class="sxs-lookup"><span data-stu-id="29f3d-242">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="29f3d-243">MsgBoxViewer 工具是可从[ http://go.microsoft.com/fwlink/?LinkId=151930 ](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-243">The MsgBoxViewer tool is available from [http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930).</span></span> <span data-ttu-id="29f3d-244">MsgBoxViewer 工具可用于故障排除，因为它提供了 HTML 报表，其中提供了详细表的大小和行计数信息。</span><span class="sxs-lookup"><span data-stu-id="29f3d-244">The MsgBoxViewer tool is useful for troubleshooting because it provides an HTML report that has detailed information about table sizes and the row count.</span></span> <span data-ttu-id="29f3d-245">报表还可以帮助确定是否限制 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="29f3d-245">The report can also help determine whether BizTalk Server is throttling.</span></span> <span data-ttu-id="29f3d-246">此外，该工具提供了 BizTalk Server 数据库和 BizTalk Server 配置的快照。</span><span class="sxs-lookup"><span data-stu-id="29f3d-246">Additionally, the tool provides a snapshot of the BizTalk Server databases and the BizTalk Server configuration.</span></span><br /><br /> <span data-ttu-id="29f3d-247">当 BizTalk Server 运行时比平常慢，运行 MsgBoxViewer 工具中，单击在上选择的所有查询**可选查询**选项卡，然后查看生成的 HTML 报告的任何问题。</span><span class="sxs-lookup"><span data-stu-id="29f3d-247">When BizTalk Server is running slower than usual, run the MsgBoxViewer tool, click to select all queries on the **Optional Queries** tab, and then review the generated HTML report for any problems.</span></span> <span data-ttu-id="29f3d-248">**摘要报表**部分列出了中以红色的黄色和潜在问题的警告。</span><span class="sxs-lookup"><span data-stu-id="29f3d-248">The **Summary Report** section lists warnings in yellow and potential problems in red.</span></span><br /><br /> <span data-ttu-id="29f3d-249">此外，可以使用 MsgBoxViewer 工具来确定哪些表的最大，并且具有大多数记录。</span><span class="sxs-lookup"><span data-stu-id="29f3d-249">Additionally, you can use the MsgBoxViewer tool to determine which tables are the largest and have the most records.</span></span> <span data-ttu-id="29f3d-250">通常发展中的表的列表以及有关如何管理这些表的说明，请参阅[不断增长的大型 BizTalk Server 数据库表](~/technical-guides/large-growing-biztalk-server-database-tables.md)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-250">For a list of tables that typically grow the larges and for instructions on how to manage those tables, see [Large-growing BizTalk Server Database Tables](~/technical-guides/large-growing-biztalk-server-database-tables.md).</span></span>|  
|<span data-ttu-id="29f3d-251">使用终结器工具来解决问题，如果任何，标识由 MsgBoxViewer 工具</span><span class="sxs-lookup"><span data-stu-id="29f3d-251">Use the Terminator tool to resolve issues, if any, identified by the MsgBoxViewer tool</span></span>|<span data-ttu-id="29f3d-252">**重要提示：** 使用此工具不受 Microsoft，因此 Microsoft 不保证此程序的适用性。</span><span class="sxs-lookup"><span data-stu-id="29f3d-252">**Important:**  Use of this tool is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this programs.</span></span> <span data-ttu-id="29f3d-253">使用此程序是完全由您自己承担。</span><span class="sxs-lookup"><span data-stu-id="29f3d-253">Use of this program is entirely at your own risk.</span></span> <br /><br /> <span data-ttu-id="29f3d-254">运行终结器工具，网址[终止符](http://go.microsoft.com/fwlink/?LinkId=151931)(http://go.microsoft.com/fwlink/?LinkId=151931)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-254">Run the Terminator tool available at [Terminator](http://go.microsoft.com/fwlink/?LinkId=151931) (http://go.microsoft.com/fwlink/?LinkId=151931).</span></span> <span data-ttu-id="29f3d-255">此工具使用户能够轻松地解决由 BizTalk MsgBoxViewer 工具标识的任何问题。</span><span class="sxs-lookup"><span data-stu-id="29f3d-255">This tool enables users to easily resolve any issues identified by the BizTalk MsgBoxViewer tool.</span></span> <span data-ttu-id="29f3d-256">有关如何与 BizTalk MsgBoxViewer 工具集成终止符工具的详细信息，请参阅[使用 BizTalk 终止符，以解决问题由 BizTalk MsgBoxViewer](http://go.microsoft.com/fwlink/?LinkId=151932) (http://go.microsoft.com/fwlink/?LinkId=151932)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-256">For more information on how the Terminator tool integrates with the BizTalk MsgBoxViewer tool, see [Using BizTalk Terminator to resolve issues identified by BizTalk MsgBoxViewer](http://go.microsoft.com/fwlink/?LinkId=151932) (http://go.microsoft.com/fwlink/?LinkId=151932).</span></span>|  
|<span data-ttu-id="29f3d-257">调查死锁方案</span><span class="sxs-lookup"><span data-stu-id="29f3d-257">Investigate deadlock scenarios</span></span>|<span data-ttu-id="29f3d-258">在死锁方案中，启用 SQL Server 上的 DBCC 跟踪死锁信息写入到 SQLERROR 日志。</span><span class="sxs-lookup"><span data-stu-id="29f3d-258">In a deadlock scenario, enable DBCC tracing on the SQL Server so that the deadlock information is written to the SQLERROR log.</span></span><br /><br /> <span data-ttu-id="29f3d-259">在 SQL Server 中，执行以下语句以启用对死锁情况的 DBCC 跟踪：</span><span class="sxs-lookup"><span data-stu-id="29f3d-259">In SQL Server, execute the following statement to enable DBCC tracing for deadlock scenarios:</span></span><br /><br /> <span data-ttu-id="29f3d-260">DBCC TRACEON (1222，-1)</span><span class="sxs-lookup"><span data-stu-id="29f3d-260">DBCC TRACEON (1222,-1)</span></span><br /><br /> <span data-ttu-id="29f3d-261">您还可以使用 PSSDIAG 实用工具上收集数据**Lock: Deadlock**事件并**Lock: Deadlock Chain**事件。</span><span class="sxs-lookup"><span data-stu-id="29f3d-261">You can also use the PSSDIAG utility to collect data on the **Lock:Deadlock** event and the **Lock:Deadlock Chain** event.</span></span> <span data-ttu-id="29f3d-262">有关 PSSDIAG 实用工具的详细信息，请参阅[PSSDIAG 数据收集实用程序](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-262">For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).</span></span><br /><br /> <span data-ttu-id="29f3d-263">在 BizTalkMsgBoxDB 数据库是大容量和高事务的联机事务处理 (OLTP) 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-263">The BizTalkMsgBoxDB database is a high-volume and high-transaction Online Transaction Processing (OLTP) database.</span></span> <span data-ttu-id="29f3d-264">使用此类数据库中，某些死锁，但此死锁由 BizTalk Server 引擎在内部处理。</span><span class="sxs-lookup"><span data-stu-id="29f3d-264">With such databases, some deadlocking is expected and this deadlocking is handled internally by the BizTalk Server engine.</span></span> <span data-ttu-id="29f3d-265">在这种情况，在错误日志中不列出了任何错误。</span><span class="sxs-lookup"><span data-stu-id="29f3d-265">When this behavior occurs, no errors are listed in the error logs.</span></span> <span data-ttu-id="29f3d-266">当研究死锁情况时，必须与事件日志中的死锁错误相关正在调查的输出中死锁。</span><span class="sxs-lookup"><span data-stu-id="29f3d-266">When you investigate a deadlock scenario, the deadlock that you are investigating in the output must be correlated with a deadlock error in the event logs.</span></span>|  
|<span data-ttu-id="29f3d-267">查找阻塞的进程</span><span class="sxs-lookup"><span data-stu-id="29f3d-267">Look for blocked processes</span></span>|<span data-ttu-id="29f3d-268">可以使用 SQL Server 中的活动监视器获取锁定的系统进程的服务器进程标识符 (SPID)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-268">You can use Activity Monitor in SQL Server to obtain the server process identifier (SPID) of a locking system process.</span></span> <span data-ttu-id="29f3d-269">然后，可以运行 SQL Profiler，以确定在锁定 SPID 中执行的 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="29f3d-269">You can then run the SQL Profiler to determine the SQL statement that is executing in the locking SPID.</span></span> <span data-ttu-id="29f3d-270">PSSDIAG 实用工具可用于对 SQL Server 中的锁定和阻塞问题进行故障排除。</span><span class="sxs-lookup"><span data-stu-id="29f3d-270">You can use the PSSDIAG utility to troubleshoot locking and blocking issues in SQL Server.</span></span> <span data-ttu-id="29f3d-271">该实用工具捕获具有阻止脚本已启用的所有 TRANSACT-SQL 事件。</span><span class="sxs-lookup"><span data-stu-id="29f3d-271">The utility captures all the Transact-SQL events that have the blocking script enabled.</span></span> <span data-ttu-id="29f3d-272">有关 PSSDIAG 实用工具的详细信息，请参阅[PSSDIAG 数据收集实用程序](http://go.microsoft.com/fwlink/?LinkId=153627)(http://go.microsoft.com/fwlink/?LinkId=153627)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-272">For more information about the PSSDIAG utility, see [PSSDIAG data collection utility](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).</span></span><br /><br /> <span data-ttu-id="29f3d-273">在 SQL Server，您可以指定**阻塞的进程阈值**设置，以确定时间超过指定阈值时阻塞 SPID 或 Spid 的进程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-273">In SQL Server, you can specify the **blocked process threshold** setting to determine which SPID or SPIDs are blocking longer than the threshold that you specify.</span></span> <span data-ttu-id="29f3d-274">Blocked 的 process threshold 选项的详细信息，请参阅[阻塞的进程阈值选项](http://go.microsoft.com/fwlink/?LinkId=153628)(http://go.microsoft.com/fwlink/?LinkId=153628)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-274">For more information about the blocked process threshold option, see [blocked process threshold Option](http://go.microsoft.com/fwlink/?LinkId=153628) (http://go.microsoft.com/fwlink/?LinkId=153628).</span></span> <span data-ttu-id="29f3d-275">**注意：** 遇到锁定时或在 SQL Server 中的存在阻塞性问题，我们建议你与 Microsoft 客户支持服务联系。</span><span class="sxs-lookup"><span data-stu-id="29f3d-275">**Note:**  When you experience a locking or blocking issue in SQL Server, we recommend that you contact Microsoft Customer Support Services.</span></span> <span data-ttu-id="29f3d-276">Microsoft 客户支持服务可以帮助你配置了正确的 PSSDiag 实用程序选项。</span><span class="sxs-lookup"><span data-stu-id="29f3d-276">Microsoft Customer Support Services can help you configure the correct PSSDiag utility options.</span></span>|  
|<span data-ttu-id="29f3d-277">删除所有不需要的数据</span><span class="sxs-lookup"><span data-stu-id="29f3d-277">Delete all unwanted data</span></span>|<span data-ttu-id="29f3d-278">如果数据库已成熟到可以变得太大，并且在数据库中包含的数据将不需要过更长，首选的方法是删除数据。</span><span class="sxs-lookup"><span data-stu-id="29f3d-278">If the databases have grown to become too large and if the data contained in the databases will not be required any longer, the preferred method is to delete the data.</span></span> <span data-ttu-id="29f3d-279">**注意：** 不要使用此方法在任何环境中数据的业务关键或如果需要的数据。</span><span class="sxs-lookup"><span data-stu-id="29f3d-279">**Caution:**  Do not use this method in any environment where the data is business critical or if the data is needed.</span></span> <br /><br /> <span data-ttu-id="29f3d-280">**若要清除 BizTalkMsgBox 数据库**</span><span class="sxs-lookup"><span data-stu-id="29f3d-280">**To purge the BizTalkMsgBox database**</span></span><br /> <span data-ttu-id="29f3d-281">1.下载并安装在该终结器工具[Biztalk 终止符](http://go.microsoft.com/fwlink/?LinkId=220869)(http://go.microsoft.com/fwlink/?LinkId=220869)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-281">1.  Download and install the Terminator tool at [Biztalk Terminator](http://go.microsoft.com/fwlink/?LinkId=220869) (http://go.microsoft.com/fwlink/?LinkId=220869).</span></span><br /><span data-ttu-id="29f3d-282">2.按照本主题中的步骤[如何从 MessageBox 数据库的测试环境中手动清除数据](http://go.microsoft.com/fwlink/?LinkID=158064)(http://go.microsoft.com/fwlink/?LinkID=158064) BizTalk MessageBox 数据库中创建 bts_CleanupMsgbox 存储过程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-282">2.  Follow the steps in the topic [How to Manually Purge Data from the MessageBox Database in a Test Environment](http://go.microsoft.com/fwlink/?LinkID=158064) (http://go.microsoft.com/fwlink/?LinkID=158064) to create the bts_CleanupMsgbox stored procedure in the BizTalk MessageBox database.</span></span><br /><span data-ttu-id="29f3d-283">3.使用终止符工具执行 bts_CleanupMsgbox 存储过程，并清除 BizTalk MessageBox 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-283">3.  Use the Terminator tool to execute the bts_CleanupMsgbox stored procedure and purge the BizTalk MessageBox database.</span></span> <span data-ttu-id="29f3d-284">警告：    不要运行 BizTalk Server 在生产服务器上运行 bts_CleanupMsgbox 存储过程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-284">**Warning:**      Do not run the bts_CleanupMsgbox stored procedure on a production server that is running BizTalk Server.</span></span> <span data-ttu-id="29f3d-285">只应在测试环境中运行 bts_CleanupMsgbox 存储过程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-285">You should only run the bts_CleanupMsgbox stored procedure in a test environment.</span></span> <span data-ttu-id="29f3d-286">不支持运行 bts_CleanupMsgbox 存储的过程在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="29f3d-286">Running the bts_CleanupMsgbox stored procedure in a production environment is not supported.</span></span><br /><span data-ttu-id="29f3d-287">4.重新启动所有主机和 BizTalk Server 服务。</span><span class="sxs-lookup"><span data-stu-id="29f3d-287">4.  Restart all hosts and BizTalk Server services.</span></span><br /><br /> <span data-ttu-id="29f3d-288">**若要清除 BizTalkDTADb 数据库**</span><span class="sxs-lookup"><span data-stu-id="29f3d-288">**To purge the BizTalkDTADb database**</span></span><br /> <ul><li><span data-ttu-id="29f3d-289">**方法 1**</span><span class="sxs-lookup"><span data-stu-id="29f3d-289">**Method 1**</span></span><br /><br /> <ol><li><span data-ttu-id="29f3d-290">备份所有 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-290">Back up all BizTalk Server databases.</span></span></li><li><span data-ttu-id="29f3d-291">执行**dtasp_PurgeAllCompletedTrackingData**存储过程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-291">Execute the **dtasp_PurgeAllCompletedTrackingData** stored procedure.</span></span> <span data-ttu-id="29f3d-292">有关该存储过程的详细信息，请参阅[如何从 BizTalk 跟踪数据库手动清除数据](http://go.microsoft.com/fwlink/?LinkId=153635)(http://go.microsoft.com/fwlink/?LinkId=153635)。</span><span class="sxs-lookup"><span data-stu-id="29f3d-292">For more information about the stored procedure, see [How to Manually Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkId=153635) (http://go.microsoft.com/fwlink/?LinkId=153635).</span></span></li></ol></li><li><span data-ttu-id="29f3d-293">**方法 2**。</span><span class="sxs-lookup"><span data-stu-id="29f3d-293">**Method 2**.</span></span> <span data-ttu-id="29f3d-294">仅当 BizTalkDTADb 数据库包含多个未完成的实例，则必须删除使用此选项。</span><span class="sxs-lookup"><span data-stu-id="29f3d-294">Use this option only if the BizTalkDTADb database contains many incomplete instances that must be removed.</span></span><br /><br /> <ol><li><span data-ttu-id="29f3d-295">备份所有 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-295">Back up all BizTalk Server databases.</span></span></li><li><span data-ttu-id="29f3d-296">停止所有 BizTalk 主机、 服务和自定义独立的适配器。</span><span class="sxs-lookup"><span data-stu-id="29f3d-296">Stop all BizTalk hosts, services, and custom isolated adapters.</span></span> <span data-ttu-id="29f3d-297">如果使用 HTTP 或 SOAP 适配器后，重新启动 IIS 服务。</span><span class="sxs-lookup"><span data-stu-id="29f3d-297">If you use HTTP or the SOAP adapter, restart the IIS services.</span></span></li><li><span data-ttu-id="29f3d-298">执行**dtasp_CleanHMData** BizTalkDTADb 数据库中存储过程。</span><span class="sxs-lookup"><span data-stu-id="29f3d-298">Execute the **dtasp_CleanHMData** stored procedure on the BizTalkDTADb database.</span></span></li><li><span data-ttu-id="29f3d-299">重新启动所有主机和 BizTalk Server 服务。</span><span class="sxs-lookup"><span data-stu-id="29f3d-299">Restart all hosts and BizTalk Server services.</span></span></li></ol></li></ul> <span data-ttu-id="29f3d-300">**注意：** 如果必须必须跟踪数据，备份 BizTalkDTADb 数据库中，将数据库还原到另一个 SQL Server，，然后清除原始 BizTalkDTADb 数据库。</span><span class="sxs-lookup"><span data-stu-id="29f3d-300">**Note:**  If you must have the tracking data, back up the BizTalkDTADb database, restore the database to another SQL Server, and then purge the original BizTalkDTADb database.</span></span>|  
  
 <span data-ttu-id="29f3d-301">如果需要分析 MsgBoxViewer 数据或 PSSDIAG 输出的帮助，请联系 Microsoft 客户支持服务。</span><span class="sxs-lookup"><span data-stu-id="29f3d-301">If you want help analyzing the MsgBoxViewer data or PSSDIAG output, contact Microsoft Customer Support Services.</span></span> <span data-ttu-id="29f3d-302">请联系客户支持服务部门之前，压缩 MsgBoxViewer 数据、 PSSDIAG 输出和已更新的事件日志 （.evt 文件）。</span><span class="sxs-lookup"><span data-stu-id="29f3d-302">Before you contact Customer Support Services, compress the MsgBoxViewer data, the PSSDIAG output, and the updated event logs (.evt files).</span></span> <span data-ttu-id="29f3d-303">您可能需要将发送这些文件复制到 BizTalk Server 支持工程师。</span><span class="sxs-lookup"><span data-stu-id="29f3d-303">You may have to send these files to a BizTalk Server support engineer.</span></span>
  
## <a name="next"></a><span data-ttu-id="29f3d-304">Next</span><span class="sxs-lookup"><span data-stu-id="29f3d-304">Next</span></span>
  
-   [<span data-ttu-id="29f3d-305">维护 BizTalk Server 数据库的最佳做法</span><span class="sxs-lookup"><span data-stu-id="29f3d-305">Best Practices for Maintaining BizTalk Server Databases</span></span>](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [<span data-ttu-id="29f3d-306">大量增长的 BizTalk Server 数据库表</span><span class="sxs-lookup"><span data-stu-id="29f3d-306">Large-growing BizTalk Server Database Tables</span></span>](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [<span data-ttu-id="29f3d-307">用于故障排除的工具和实用程序</span><span class="sxs-lookup"><span data-stu-id="29f3d-307">Tools and Utilities for Troubleshooting</span></span>](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## <a name="see-also"></a><span data-ttu-id="29f3d-308">请参阅</span><span class="sxs-lookup"><span data-stu-id="29f3d-308">See Also</span></span>  
 [<span data-ttu-id="29f3d-309">不可更改的 SQL Server 设置</span><span class="sxs-lookup"><span data-stu-id="29f3d-309">SQL Server Settings That Should Not Be Changed</span></span>](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)
