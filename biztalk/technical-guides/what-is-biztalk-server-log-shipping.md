---
title: "什么 BizTalk Server 日志传送？ | Microsoft Docs"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 79a2088a-ff36-4590-97c9-51d5bb245486
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c886bb4d32fa082c2c4c865a45b28133ce4a3aa0
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="what-is-biztalk-server-log-shipping"></a><span data-ttu-id="c6254-103">什么 BizTalk Server 日志传送？</span><span class="sxs-lookup"><span data-stu-id="c6254-103">What Is BizTalk Server Log Shipping?</span></span>
[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]<span data-ttu-id="c6254-104">灾难恢复过程围绕 BizTalk 日志传送。</span><span class="sxs-lookup"><span data-stu-id="c6254-104"> disaster recovery procedures are built around BizTalk log shipping.</span></span> <span data-ttu-id="c6254-105">BizTalk 日志传送通过连续将事务日志更新应用于的灾难恢复站点数据库，简化了发生灾难时的数据库还原。</span><span class="sxs-lookup"><span data-stu-id="c6254-105">BizTalk log shipping simplifies database restoration in the event of a disaster by continuously applying transaction log updates to the disaster recovery site databases.</span></span>  
  
 <span data-ttu-id="c6254-106">而的 BizTalk 日志传送依赖于使用类似的准则[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]日志传送，[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]不支持日志传送[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库备份作为备份 BizTalk Server SQL 代理作业的一部分。</span><span class="sxs-lookup"><span data-stu-id="c6254-106">While BizTalk log shipping is based on similar principles as [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] log shipping, [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] log shipping is not supported for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases backed up as part of the Backup BizTalk Server SQL Agent Job.</span></span>  
  
## <a name="how-does-biztalk-log-shipping-work"></a><span data-ttu-id="c6254-107">BizTalk 日志传送工作方式是怎样的？</span><span class="sxs-lookup"><span data-stu-id="c6254-107">How Does BizTalk Log Shipping Work?</span></span>  
 <span data-ttu-id="c6254-108">BizTalk 中的日志传送函数方式类似于[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]日志传送。</span><span class="sxs-lookup"><span data-stu-id="c6254-108">BizTalk log shipping functions in a manner similar to [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] log shipping.</span></span> <span data-ttu-id="c6254-109">生产[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]组配置为备份[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库到 UNC 位置。</span><span class="sxs-lookup"><span data-stu-id="c6254-109">The production [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group is configured to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases to a UNC location.</span></span> <span data-ttu-id="c6254-110">默认情况下，备份 BizTalk SQL 代理作业执行完整备份每隔一小时和每隔 15 分钟的日志备份。</span><span class="sxs-lookup"><span data-stu-id="c6254-110">By default, the Backup BizTalk SQL Agent job performs a full backup every hour and a log backup every 15 minutes.</span></span> <span data-ttu-id="c6254-111">备份 BizTalk Server 作业实现逻辑以自动启动完整备份，如果检测到备份失败。</span><span class="sxs-lookup"><span data-stu-id="c6254-111">The Backup BizTalk Server job implements logic to automatically start a full backup if a backup failure is detected.</span></span>  
  
 <span data-ttu-id="c6254-112">当灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例所配置的 BizTalk 日志传送，由备份 BizTalk Server SQL 代理作业还原在灾难恢复站点上每隔 15 分钟默认情况下创建的备份文件。</span><span class="sxs-lookup"><span data-stu-id="c6254-112">When the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances are configured for BizTalk log shipping, the backup files created by the Backup BizTalk Server SQL Agent job are restored at the disaster recovery site every 15 minutes by default.</span></span> <span data-ttu-id="c6254-113">备份文件将通过网络复制 SQL 还原命令。</span><span class="sxs-lookup"><span data-stu-id="c6254-113">The backup files are copied over the network by a SQL RESTORE command.</span></span> <span data-ttu-id="c6254-114">在以下情况下仅复制完整备份文件：</span><span class="sxs-lookup"><span data-stu-id="c6254-114">Full backup files are copied only in the following situations:</span></span>  
  
-   <span data-ttu-id="c6254-115">BizTalk 登录时首次配置传送</span><span class="sxs-lookup"><span data-stu-id="c6254-115">When BizTalk log shipping is first configured</span></span>  
  
-   <span data-ttu-id="c6254-116">当新数据库添加到备份 BizTalk Server 作业。</span><span class="sxs-lookup"><span data-stu-id="c6254-116">When a new database is added to the Backup BizTalk Server job.</span></span>  
  
-   <span data-ttu-id="c6254-117">在灾难恢复站点时还原失败</span><span class="sxs-lookup"><span data-stu-id="c6254-117">When a RESTORE failure occurs at the disaster recovery site</span></span>  
  
 <span data-ttu-id="c6254-118">每个[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]在灾难恢复站点的实例作为 BizTalk 日志传送还原生产上承载数据库的一部分单独配置[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例。</span><span class="sxs-lookup"><span data-stu-id="c6254-118">Each [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance at the disaster recovery site is configured individually as part of BizTalk log shipping to restore databases hosted on a production [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instance.</span></span> <span data-ttu-id="c6254-119">当[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例配置为 BizTalk Server 日志传送和**BTS 日志传送还原数据库**作业是否已启用， **BTS 日志传送还原数据库**作业将连接到对生产 BizTalk 管理数据库[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]组。</span><span class="sxs-lookup"><span data-stu-id="c6254-119">When a [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance is configured for BizTalk Server log shipping and the **BTS Log Shipping Restore Databases** job is enabled, the **BTS Log Shipping Restore Databases** job will connect to the BizTalk Management database on the production [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] group.</span></span>  
  
 <span data-ttu-id="c6254-120">如上面所述，当首次配置目标服务器的完整数据库备份还原到目标服务器。</span><span class="sxs-lookup"><span data-stu-id="c6254-120">As described above, when the destination server is first configured the full database backup is restored to the destination server.</span></span> <span data-ttu-id="c6254-121">大多数情况下还原仅日志时**BTS 日志传送还原数据库**作业运行。</span><span class="sxs-lookup"><span data-stu-id="c6254-121">Most of the time only the logs are restored when the **BTS Log Shipping Restore Databases** job runs.</span></span>  
  
 <span data-ttu-id="c6254-122">查看灾难恢复时[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]Management Studio 中，数据库将显示在"加载"状态。</span><span class="sxs-lookup"><span data-stu-id="c6254-122">When viewing the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances with [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] Management Studio, the databases will be displayed in a “Loading” state.</span></span> <span data-ttu-id="c6254-123">这是因为备份集中的最后一个日志永远不会自动还原。</span><span class="sxs-lookup"><span data-stu-id="c6254-123">This is because the last log in a backup set is never restored automatically.</span></span> <span data-ttu-id="c6254-124">一旦新的日志不可用，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]日志传送还原到最新日志的下一步。</span><span class="sxs-lookup"><span data-stu-id="c6254-124">Once a new log is available, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] log shipping restores the next to last log.</span></span> <span data-ttu-id="c6254-125">当发生了灾难恢复事件和灾难恢复站点必须处于联机状态、 使用 STOPATMARK 命令将数据库恢复还原最后一个日志和数据库将不再显示为处于"加载"状态。</span><span class="sxs-lookup"><span data-stu-id="c6254-125">When a disaster recovery event occurs and the disaster recovery site must be brought online, the last log is restored using the STOPATMARK command to recover the databases and the databases will no longer be displayed as being in a “Loading” state.</span></span>