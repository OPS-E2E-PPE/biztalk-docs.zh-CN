---
title: 步骤 3： 创建负载测试，以同时执行多个单元测试 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: b5dd7e31-7188-4edf-9513-ea2725950b47
caps.latest.revision: 19
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: d946c48c1bcaca420347771e73089e5535ab1229
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "37002702"
---
# <a name="step-3-create-a-load-test-to-perform-multiple-unit-tests-simultaneously"></a>步骤 3： 创建负载测试，以同时执行多个单元测试
负载测试运行多个实例的一个或多个单元测试，以便您可以衡量应用程序的性能和处理负载的能力。 Visual Studio 2010 负载测试的主要组件包括：  
  
- **方案**– 负载测试配置测试的负载模式、 测试组合模型、 测试组合、 网络组合和 Web 浏览器组合的其中的部分。 方案适应模拟复杂真实工作负载配置文件的复杂性。 对于所有的全面列表负载测试方案属性，请参阅[负载测试方案属性](http://go.microsoft.com/fwlink/?LinkId=208327)(http://go.microsoft.com/fwlink/?LinkId=208327)。  
  
- **计数器集**– 负载测试在其中创建特定的分组或"设置"性能计数器的负载测试运行时要收集的部分。 默认情况下提供多个预定义的计数器集，可以添加自定义计数器集。 例如，若要评估网络可以创建自定义计数器的性能设置、 添加相关的网络性能计数器和将其保存到可用的计数器集的列表。 有关创建和保存的负载测试计数器集的详细信息请参阅[指定在负载测试中的计算机的计数器集](http://go.microsoft.com/fwlink/?LinkId=208328)(http://go.microsoft.com/fwlink/?LinkId=208328)。  
  
- **运行设置**– 运行设置定义负载测试的多个方面，包括测试持续时间，在负载测试期间都与各种计算机的计数器集各种测试验证选项和测试结果存储选项。 您可以创建并存储为每个负载测试，多个运行的设置，然后选择运行测试时要使用的特定设置。 使用新建负载测试向导创建负载测试时，将向负载测试添加初始运行设置。 所有负载测试运行设置属性的完整列表请参阅[负载测试运行设置属性](http://go.microsoft.com/fwlink/?LinkId=208329)(http://go.microsoft.com/fwlink/?LinkId=208329)。  
  
  使用新建负载测试向导中，使用负载测试编辑器编辑和分析负载测试分析器中创建负载测试。 在 Microsoft Visual Studio 旗舰版中包含所有这些工具。 有关创建和编辑 Visual Studio 2010 Ultimate edition 中的负载测试的详细信息请参阅[创建和编辑负载测试](http://go.microsoft.com/fwlink/?LinkId=208308)(http://go.microsoft.com/fwlink/?LinkId=208308)。  
  
  按照以下部分，以添加负载中的步骤测试对测试项目中所述[步骤 1： 创建单元测试将文档提交到 BizTalk Server](../technical-guides/step-1-create-a-unit-test-to-submit-documents-to-biztalk-server.md)。 这些步骤还介绍了如何配置**方案**，**计数器集**，并**运行设置**为负载测试。  
  
##  <a name="BKMK_StepLoadTest"></a> 添加一个负载测试和配置负载测试方案、 计数器集，并运行设置  
 本主题介绍如何使用**新建负载测试向导**若要将负载添加到测试项目的测试，以及如何配置负载测试以满足特定需求。  
  
### <a name="use-the-new-load-test-wizard-to-add-a-load-test-to-the-test-project"></a>使用新建负载测试向导将负载测试添加到测试项目  
 请按照下列步骤以将负载测试添加到测试项目使用新建负载测试向导。  
  
1.  打开**负载测试**如果已打开的 Visual Studio 2010 中的解决方案。  
  
2.  将文件夹添加到 BTSLoad 项目中;此文件夹将包含此项目的一部分创建的任何负载测试。 在解决方案资源管理器，右键单击 BTSLoad 项目，指向**外**，然后单击**新文件夹**。 突出显示的文本的文件夹图标**NewFolder1**将显示在 BTSLoad 项目下，类型**LoadTests**更改突出显示的文本并按 Enter 键以完成创建的文件夹 C:\Projects\LoadTest\BTSLoad\LoadTests。  
  
3.  在解决方案资源管理器，右键单击**BTSLoad**项目，指向**添加**，然后单击**负载测试**启动**新建负载测试向导**.  
  
4.  单击“下一步” 。  
  
5.  上**编辑负载测试方案的设置**页**输入负载测试方案的名称：** 类型**BTS_Messaging_Step**。 下**思考时间配置文件**选择**不使用思考时间**，然后单击**下一步**。  
  
6.  上**编辑负载模式设置为负载测试方案**页上，选择**阶跃负载**，输入以下值，然后单击**下一步**。  
  
    -   **开始用户计数：** 30 位用户  
  
    -   **单步持续时间：** 60 秒  
  
    -   **单步用户计数：** 10 个用户  
  
    -   **最大用户计数**有 80 个用户  
  
    > [!NOTE]  
    >  应用分级负载模式的设置时应计算所需的所有步骤将增加完成的时间量。 例如，使用负载测试上面指定的负载模式设置将需要 5 分钟时间才能完成每 60 秒的所有步骤的增量时从 30 上升到 80 个用户。 新建负载测试向导将使用指定的负载测试的长度的选项显示的最后一页，其中之一将是**负载测试持续时间**。 如果已具有为计算时所需的所有步骤才能完成，则它是一种简单的任务输入值 （在本例中为 5 分钟） 的增量**负载测试持续时间**。  
  
7.  上**选择负载测试测试组合模型**页上，选择**基于虚拟用户数**，然后单击**下一步**。  
  
8.  上**将测试添加到负载测试方案并编辑测试组合**页上，单击**添加**按钮。  
  
9. 下**可用测试**双击**BTSMessaging**并**BTSMessaging2**以将这些单元测试添加到列表**选定的测试**。 单击**确定**，然后单击**下一步**。  
  
10. 上**添加到负载测试方案的网络类型并编辑网络组合**页面上确定**网络类型**设置为**LAN**与**分发**的**100%** ，然后单击**下一步**。  
  
11. 上**指定要在负载测试运行期间使用计数器集监视的计算机**页上，单击**下一步**。  
  
    > [!NOTE]  
    >  不将计算机添加到负载测试在此时间。 新建负载测试向导只允许您将计算机与预定义的计数器集相关联，并且此负载测试需要这两者预定义的使用和*自定义*计数器集。 在完成该向导并保存负载测试后可以编辑负载测试添加自定义计数器集和配置负载测试来监视使用预定义的计算机*和*自定义计数器集。  
  
     上**查看和编辑运行负载测试的设置**页上，输入以下值：  
  
    1.  选择**负载测试持续时间**。  
  
    2.  **预热持续时间 (hh mm ss)** 30 秒  
  
    3.  **运行持续时间 (hh mm ss)** 5 分钟  
  
        > [!NOTE]  
        >  为分配的时间**运行持续时间**应等于所需的所有步骤才能完成步骤 5 更高版本或 5 分钟，对于此示例中所述的增量的时间量。  
  
    4.  **采样率**5 秒  
  
    5.  **说明**（可选） 输入负载测试此处的说明。  
  
    6.  **测试未通过时保存日志**，则返回 True  
  
    7.  **验证级别**低-调用标记为低的验证规则  
  
12. 单击**完成**以关闭新建负载测试向导。  
  
13. 单击**文件**菜单，然后选择**保存\<负载测试名称\>作为.loadtest**。  
  
    > [!NOTE]  
    >  在此示例中，<Load Test Name>将是由 Visual Studio 2010 中，通常 loadtestx.loadtest，分配给负载测试文件的名称，除非已手动更改的文件的名称。  
  
14. 将文件保存到前面创建的 C:\Projects\LoadTest\BTSLoad\LoadTests 目录。 可能会很有用的方案; 使用的名称保存该文件在此示例中的方案的名称是 BTS_Messaging_Step 因此 loadtest 文件将另存为 C:\Projects\LoadTest\BTSLoad\LoadTests\BTS_Messaging_Step.loadtest。  
  
###  <a name="BKMK_BTSCounters"></a> 添加自定义计数器集来衡量 BizTalk Server 关键性能指标 (KPI)  
 请按照下列步骤来添加计数器集与度量值用于确定最大可承受吞吐量 (MST) 的 BizTalk Server 应用程序所需的 BizTalk Server KPI 的性能计数器：  
  
1. 在解决方案资源管理器中双击在负载测试在上一节，以在负载测试编辑器中查看负载测试中创建。  
  
2. 在负载测试编辑器中，单击以展开**计数器集**。 请注意，BizTalk Server 没有预定义的计数器集，因此必须将"BizTalk Server"计数器集添加到计数器的列表的自定义设置。  
  
3. 右键单击**计数器集**，然后选择**添加自定义计数器集**。 默认情况下，此操作将创建自定义计数器集名称**Custom1**。  
  
4. 右键单击**Custom1**计数器集和选择**属性**若要将焦点设置到**属性**Custom1 计数器集的对话框。  
  
5. 双击名称**Custom1**中**属性**对话框中，键入**BizTalk** ，然后按 ENTER 键，若要重命名自定义计数器设置为**BizTalk**.  
  
6. 在负载测试编辑器中，右键单击**BizTalk**计数器集和选择**添加计数器**。  
  
7. 下**计算机**，BizTalk Server 组，以显示包含 BizTalk Server 性能计数器的性能监视器类别中键入一个 BizTalk Server 计算机的名称。  
  
   > [!IMPORTANT]
   >  若要确保列出了所有 BizTalk Server 性能类别和性能计数器，可能需要完全限定的域名 （或 IP 地址） 中的类型的 BizTalk Server 组中，您可能还需要上启动以下主机的实例BizTalk Server 计算机。  
   > 
   > - 绑定到将在负载测试期间运行的业务流程的 BizTalk 主机的实例。  
   >   -   配置为发送或接收处理程序将在负载测试期间运行的适配器的 BizTalk 主机的实例。  
  
8. BizTalk Server 提供了一个相当广泛的一组性能计数器。 用于确定 BizTalk Server 的最大可承受性能 (MST) 的应用程序只需添加以下 BizTalk Server 性能计数器来**BizTalk**自定义计数器集：  
  
   |性能类别|性能计数器|  
   |--------------------------|-------------------------|  
   |处理器|_Total 计数器实例的处理器时间百分比。|  
   |Biztalk: Message 框的作用： 常规计数器|后台处理大小 *\<BizTalk MessageBox 数据库名称\>*:*\<SQL Server 实例名称\>* 计数器实例。 **注意：***\<BizTalk MessageBox 数据库名称\>* 并 *\<SQL Server 实例名称\>* 是只是占位符BizTalk MessageBox 数据库和存储 BizTalk MessageBox 数据库的 SQL Server 实例的实际名称。 应使用 BizTalk MessageBox 数据库和关联的 SQL Server 实例的实际名称替换这些占位符。|  
   |BizTalk:Messaging|文档接收数/秒的接收主机计数器实例。<br /><br /> 记录每秒处理的传输主机计数器实例。|  
   |BizTalk：消息代理|文档的消息送达传入速率接收主机。|  
   |BizTalk：消息代理|消息发布传出速率文档传输主机。|  
   |XLANG/s 业务流程|业务流程每秒完成的业务流程处理主机。|  
  
### <a name="modify-run-settings-to-map-counter-sets-to-appropriate-computers"></a>修改将计数器集映射到合适的计算机的运行的设置  
 请按照下列步骤以将映射与负载测试的合适的计算机的相应的计数器集：  
  
1.  在中**负载测试编辑器**，右键单击**运行设置**，然后选择**管理计数器集**。  
  
2.  单击**将计算机添加**将一台新计算机添加到列表。 具有突出显示的文本的图标**新的计算机**将显示在下面**要监视的计算机和计数器集**。 通过键入你想要添加到列表中的计算机的名称替换突出显示的文本。  
  
3.  之后将计算机添加到列表中，单击此项可展开可用的计数器集的列表，然后单击以选择一个或多个可用的计数器设置将与计算机关联的计数器集。  
  
4.  重复步骤 2 和 3，直到已与要收集性能数据的所有计算机关联计数器集。  
  
###  <a name="BKMK_TestSettings"></a> 将测试设置文件添加到解决方案后，若要运行测试并远程收集数据  
 若要配置要使用你在中创建的测试控制器和测试代理计算机的负载测试[步骤 2： 配置负载测试控制器和代理计算机](../technical-guides/step-2-configure-load-test-controller-and-agent-computers.md)，按照中的步骤[添加远程执行的测试设置或到你的解决方案的数据收集](http://go.microsoft.com/fwlink/?LinkId=209182)(http://go.microsoft.com/fwlink/?LinkId=209182)如下所示：  
  
1.  对于步骤 3 中，输入名称**BizTalkLoadTest**  
  
2.  忽略第 6 步，因为已在步骤 3 中输入的名称。  
  
3.  对于步骤 7 中，输入"这些是默认的远程测试运行的测试设置"下**说明**。  
  
4.  对于步骤 8 中，选择默认命名方案。  
  
5.  对于步骤 9 下,**测试执行方法**选择**远程执行**下**控制器**选择测试控制器计算机并使其余属性保留在**角色**页面，其默认设置。  
  
6.  步骤 24，请选择**以默认主机中运行**，选择**主机类型**的**默认**，然后在**32 或 64 位进程中运行测试**，选择选项**64 位计算机上的 64 位进程中运行测试**。  
  
7.  对于步骤 25，选择**将单个测试标记为失败的执行时间超过**并保留所选的 30 分钟的默认值。  
  
8.  对于步骤 27b，选中复选框**测试目录中的程序集使用加载上下文**，然后单击**另存为**。  
  
9. 在**另存为**对话框框中，验证名称**BizTalkLoadTest**旁边输入**文件名**，然后单击**保存**。 您现在测试设置文件添加到你的解决方案。