---
title: "群集 BizTalk Server Databases2 |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1b68bc3f-c0c4-4050-8ca3-df6dd1927637
caps.latest.revision: "3"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 4c84f8f6ef26c567a1bbac44df078f2df58ca9da
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="clustering-the-biztalk-server-databases"></a><span data-ttu-id="cc386-102">群集的 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="cc386-102">Clustering the BizTalk Server Databases</span></span>
<span data-ttu-id="cc386-103">如果 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 数据库不可用，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] 环境将无法正常运行。</span><span class="sxs-lookup"><span data-stu-id="cc386-103">If the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases become unavailable, the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment will not function correctly.</span></span> <span data-ttu-id="cc386-104">若要提供高可用性，你可以创建的 Microsoft[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]适用于群集[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库，如下图中所示。</span><span class="sxs-lookup"><span data-stu-id="cc386-104">To provide high availability, you can create a Microsoft [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] cluster for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, as shown in the following figure.</span></span>  
  
 <span data-ttu-id="cc386-105">![BizTalk Server 数据库层](../core/media/tdi-highava-sqlcluster.gif "TDI_HighAva_SQLCluster")</span><span class="sxs-lookup"><span data-stu-id="cc386-105">![BizTalk Server Database Tier](../core/media/tdi-highava-sqlcluster.gif "TDI_HighAva_SQLCluster")</span></span>  
  
 <span data-ttu-id="cc386-106">若要创建高度可用的解决方案，以便[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库，你必须具有至少两台计算机运行[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]和群集上的共享的磁盘阵列。</span><span class="sxs-lookup"><span data-stu-id="cc386-106">To create a highly available solution for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, you must have at least two computers that are running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] and a shared disk array in the cluster.</span></span>  
  
## <a name="clustering-options"></a><span data-ttu-id="cc386-107">聚类分析选项</span><span class="sxs-lookup"><span data-stu-id="cc386-107">Clustering Options</span></span>  
 <span data-ttu-id="cc386-108">确定最佳的群集配置为[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]来满足业务需求的数据库。</span><span class="sxs-lookup"><span data-stu-id="cc386-108">Determine the best cluster configuration for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases for your business needs.</span></span> <span data-ttu-id="cc386-109">下面是选项的列表：</span><span class="sxs-lookup"><span data-stu-id="cc386-109">Here is a list of the options:</span></span>  
  
-   <span data-ttu-id="cc386-110">**主动/被动**。</span><span class="sxs-lookup"><span data-stu-id="cc386-110">**Active/passive**.</span></span> <span data-ttu-id="cc386-111">高可用性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库通常包含在主动/被动服务器群集配置中配置的两个或多个数据库计算机。</span><span class="sxs-lookup"><span data-stu-id="cc386-111">High availability for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases typically consists of two or more database computers configured in an active/passive server cluster configuration.</span></span> <span data-ttu-id="cc386-112">这些计算机共享公共的磁盘资源 (如 RAID 1 + 0 SCSI 磁盘阵列或存储区域网络) 和使用 Windows 群集提供备份的冗余和容错能力。</span><span class="sxs-lookup"><span data-stu-id="cc386-112">These computers share a common disk resource (such as a RAID 1+0 SCSI disk array or storage area network) and use Windows Clustering to provide backup redundancy and fault tolerance.</span></span>  
  
-   <span data-ttu-id="cc386-113">**主动/主动**。</span><span class="sxs-lookup"><span data-stu-id="cc386-113">**Active/active**.</span></span> <span data-ttu-id="cc386-114">Windows 群集和[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]让你运行[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]在主动/主动模式下的群集的每个节点都是"活动"并正在运行一个或多个[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例。</span><span class="sxs-lookup"><span data-stu-id="cc386-114">Windows Clustering and [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] allow you to run [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] in Active/Active mode where each node of the cluster is “active” and running one or more [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances.</span></span> <span data-ttu-id="cc386-115">例如，这将使你能够上一个节点和所有其他的 MessageBox 数据库[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]另一个节点上的数据库。</span><span class="sxs-lookup"><span data-stu-id="cc386-115">For example, this would allow you to have the MessageBox database on one node and all other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases on the other node.</span></span> <span data-ttu-id="cc386-116">这样您就可以最大化群集硬件使用率，但主动/主动[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]配置应谨慎使用。</span><span class="sxs-lookup"><span data-stu-id="cc386-116">This allows you to maximize cluster hardware usage, but an active/active [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] configuration should be used with care.</span></span>  
  
     <span data-ttu-id="cc386-117">可以每个节点同时处理的负载的所有[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例期间[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]群集节点故障转移方案？</span><span class="sxs-lookup"><span data-stu-id="cc386-117">Can each node simultaneously handle the load of all [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances during a [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] cluster node failover scenario?</span></span> <span data-ttu-id="cc386-118">是否有足够的 CPU 资源？</span><span class="sxs-lookup"><span data-stu-id="cc386-118">Are there enough CPU resources?</span></span> <span data-ttu-id="cc386-119">是否有足够的内存？</span><span class="sxs-lookup"><span data-stu-id="cc386-119">Is there sufficient memory?</span></span> <span data-ttu-id="cc386-120">有关网络带宽的新增功能？</span><span class="sxs-lookup"><span data-stu-id="cc386-120">What about network bandwidth?</span></span> <span data-ttu-id="cc386-121">如何为磁盘 I/O 争用？</span><span class="sxs-lookup"><span data-stu-id="cc386-121">How about disk I/O contention?</span></span>  
  
     <span data-ttu-id="cc386-122">这些是需要以确定如果主动/主动回答的问题的一些[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]群集最适合你的 BizTalk 应用程序。</span><span class="sxs-lookup"><span data-stu-id="cc386-122">These are just some of the questions that need to be answered in order to determine if an active/active [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] cluster is right for your BizTalk applications.</span></span> <span data-ttu-id="cc386-123">如果确定，一个节点不能处理所有[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例故障转移方案中的，一种替代方法是使用主动/主动/被动群集。</span><span class="sxs-lookup"><span data-stu-id="cc386-123">If it is determined that one node cannot handle all [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances in a failover scenario, an alternative is to use active/active/passive clustering.</span></span>  
  
-   <span data-ttu-id="cc386-124">**主动/主动/被动**。</span><span class="sxs-lookup"><span data-stu-id="cc386-124">**Active/active/passive**.</span></span> <span data-ttu-id="cc386-125">运行时进程写入到 BizTalk 管理数据库、 MessageBox 数据库、 跟踪 Analysis Services 数据库、 BAM 分析数据库、 BAM 星型架构数据库、 BAM 主导入数据库和 BAM 存档数据库。</span><span class="sxs-lookup"><span data-stu-id="cc386-125">The run-time processes write to the BizTalk Management database, MessageBox databases, Tracking Analysis Services database, BAM Analysis database, BAM Star Schema database, BAM Primary Import database, and BAM Archive database.</span></span> <span data-ttu-id="cc386-126">因此，这些数据库是特别重要，如果灾难发生，并且确定群集的数据库时，必须具有更高的优先级。</span><span class="sxs-lookup"><span data-stu-id="cc386-126">Therefore, these databases are especially important if a disaster occurs, and must have greater priority when determining what databases to cluster.</span></span> <span data-ttu-id="cc386-127">仅用户或工具写入其他数据库。</span><span class="sxs-lookup"><span data-stu-id="cc386-127">Only users or tools write to the other databases.</span></span> <span data-ttu-id="cc386-128">对于 MessageBox 数据库中，你可以考虑具有主动/主动/被动或主动/主动/主动/被动配置，以便最大程度减少所需的硬件。</span><span class="sxs-lookup"><span data-stu-id="cc386-128">For the MessageBox databases, you can consider an active/active/passive or active/active/active/passive configuration to minimize the hardware needed.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]<span data-ttu-id="cc386-129">和[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]Standard Edition 支持 2 节点故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="cc386-129"> and [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)] Standard Edition supports 2-node failover clusters.</span></span> <span data-ttu-id="cc386-130">如果你决定使用上的主动/主动/被动配置[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]或[!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]，您必须使用的企业版[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="cc386-130">If you decide to use the active/active/passive configuration on [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)] or [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)], you must use the Enterprise Edition of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span>  
  
## <a name="procedures-for-clustering-the-databases"></a><span data-ttu-id="cc386-131">群集数据库的过程</span><span class="sxs-lookup"><span data-stu-id="cc386-131">Procedures for Clustering the Databases</span></span>  
 <span data-ttu-id="cc386-132">请确保在开始群集之前满足以下先决条件[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库。</span><span class="sxs-lookup"><span data-stu-id="cc386-132">Make sure you meet the following prerequisites before you start clustering the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases.</span></span>  
  
-   <span data-ttu-id="cc386-133">当你创建的域组你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境中，你必须创建全局域帐户。</span><span class="sxs-lookup"><span data-stu-id="cc386-133">When you create the domain groups for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment, you must create global domain accounts.</span></span>  
  
-   <span data-ttu-id="cc386-134">配置[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]群集安装和配置之前[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="cc386-134">Configure the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] cluster before you install and configure [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="cc386-135">有关群集的详细信息[!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)]，请参阅[Getting Started with SQL Server 2008 R2 故障转移群集](http://go.microsoft.com/fwlink/?LinkId=156820)(http://go.microsoft.com/fwlink/?LinkId=156820)。</span><span class="sxs-lookup"><span data-stu-id="cc386-135">For more information about clustering [!INCLUDE[btsSQLServer2008R2](../includes/btssqlserver2008r2-md.md)], see [Getting Started with SQL Server 2008 R2 Failover Clustering](http://go.microsoft.com/fwlink/?LinkId=156820) (http://go.microsoft.com/fwlink/?LinkId=156820).</span></span>  
  
-   <span data-ttu-id="cc386-136">如果你要创建群集的主密钥服务器，请首先配置该服务器。</span><span class="sxs-lookup"><span data-stu-id="cc386-136">If you are also clustering the master secret server, configure that server first.</span></span> <span data-ttu-id="cc386-137">为企业单一登录高可用性的详细信息，请参阅[主密钥服务器的高可用性](../technical-guides/high-availability-for-the-master-secret-server.md)。</span><span class="sxs-lookup"><span data-stu-id="cc386-137">For more information about high availability for Enterprise Single Sign-On, see [High Availability for the Master Secret Server](../technical-guides/high-availability-for-the-master-secret-server.md).</span></span>  
  
#### <a name="to-run-the-biztalk-server-configuration-wizard"></a><span data-ttu-id="cc386-138">运行 BizTalk Server 配置向导</span><span class="sxs-lookup"><span data-stu-id="cc386-138">To run the BizTalk Server Configuration Wizard</span></span>  
  
1.  <span data-ttu-id="cc386-139">在运行时服务器上安装 [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="cc386-139">Install [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] on a runtime server.</span></span>  
  
2.  <span data-ttu-id="cc386-140">启动[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]配置程序。</span><span class="sxs-lookup"><span data-stu-id="cc386-140">Launch the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Configuration program.</span></span> <span data-ttu-id="cc386-141">单击**启动**，指向**程序**，指向**Microsoft [!INCLUDE[btsBizTalkServer2006r3ui](../includes/btsbiztalkserver2006r3ui-md.md)]** ，然后单击**BizTalk Server 配置**。</span><span class="sxs-lookup"><span data-stu-id="cc386-141">Click **Start**, point to **Programs**, point to **Microsoft [!INCLUDE[btsBizTalkServer2006r3ui](../includes/btsbiztalkserver2006r3ui-md.md)]**, and then click **BizTalk Server Configuration**.</span></span>  
  
3.  <span data-ttu-id="cc386-142">若要应用自定义配置，请按照本文[使用自定义配置管理器](http://go.microsoft.com/fwlink/?LinkId=156822)(http://go.microsoft.com/fwlink/?LinkId=156822) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]帮助。</span><span class="sxs-lookup"><span data-stu-id="cc386-142">To apply a custom configuration, follow the steps in [Working with the Custom Configuration Manager](http://go.microsoft.com/fwlink/?LinkId=156822) (http://go.microsoft.com/fwlink/?LinkId=156822) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span> <span data-ttu-id="cc386-143">若要为 BizTalk Server 数据库输入中的 SQL Server 群集的名称指定 SQL Server 群集**数据库**配置的对话框。</span><span class="sxs-lookup"><span data-stu-id="cc386-143">To specify the SQL Server cluster for the BizTalk Server databases enter the name of the SQL Server cluster in the **Databases** dialog of the configuration.</span></span>  
  
4.  <span data-ttu-id="cc386-144">完成[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]按照中的说明配置[自定义配置](http://go.microsoft.com/fwlink/?LinkId=156823)(http://go.microsoft.com/fwlink/?LinkId=156823) 中[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]帮助。</span><span class="sxs-lookup"><span data-stu-id="cc386-144">Complete the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration by following the instructions in [Custom Configuration](http://go.microsoft.com/fwlink/?LinkId=156823) (http://go.microsoft.com/fwlink/?LinkId=156823) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Help.</span></span>  
  
 <span data-ttu-id="cc386-145">有关群集的详细信息[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]数据库，请参阅[通过使用 Windows Server 2008 故障转移群集或 Windows Server 2003 服务器群集的 BizTalk Server 中改进容错功能](http://go.microsoft.com/fwlink/?LinkId=156819)(http://go.microsoft.com/fwlink/?LinkId=156819)。</span><span class="sxs-lookup"><span data-stu-id="cc386-145">For more information about clustering [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, see [Improving Fault Tolerance in BizTalk Server by Using a Windows Server 2008 Failover Cluster or Windows Server 2003 Server Cluster](http://go.microsoft.com/fwlink/?LinkId=156819) (http://go.microsoft.com/fwlink/?LinkId=156819).</span></span>  
  
## <a name="behavior-of-biztalk-host-instances-during-sql-server-failover"></a><span data-ttu-id="cc386-146">在 SQL Server 故障转移期间的 BizTalk 主机实例的行为</span><span class="sxs-lookup"><span data-stu-id="cc386-146">Behavior of BizTalk Host Instances During SQL Server Failover</span></span>  
 <span data-ttu-id="cc386-147">有关详细信息行为 BizTalk 主机实例的 SQL Server 故障转移期间，请参阅[行为的 BizTalk Server 主机实例在 SQL Server 故障转移期间](http://go.microsoft.com/fwlink/?LinkId=151287)(http://go.microsoft.com/fwlink/?LinkId=151287)。</span><span class="sxs-lookup"><span data-stu-id="cc386-147">For more information about behavior of BizTalk host instances during SQL Server failover, see [Behavior of BizTalk Server Host Instances during SQL Server Failover](http://go.microsoft.com/fwlink/?LinkId=151287) (http://go.microsoft.com/fwlink/?LinkId=151287).</span></span>  
  
## <a name="using-sql-server-database-mirroring"></a><span data-ttu-id="cc386-148">使用 SQL Server 数据库镜像</span><span class="sxs-lookup"><span data-stu-id="cc386-148">Using SQL Server Database Mirroring</span></span>  
 <span data-ttu-id="cc386-149">有关使用 SQL Server 数据库镜像与 BizTalk Server 数据库群集的详细信息，请参阅[使用的 SQL Server 数据库镜像或卷影复制服务](http://go.microsoft.com/fwlink/?LinkId=151288)(http://go.microsoft.com/fwlink/?LinkId = 151288) 在 BizTalk Server 帮助中。</span><span class="sxs-lookup"><span data-stu-id="cc386-149">For more information about using SQL Server database mirroring with respect to BizTalk Server database clustering, see [Use of SQL Server database mirroring or the Volume Shadow Copy service](http://go.microsoft.com/fwlink/?LinkId=151288) (http://go.microsoft.com/fwlink/?LinkId=151288) in BizTalk Server help.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cc386-150">另请参阅</span><span class="sxs-lookup"><span data-stu-id="cc386-150">See Also</span></span>  
 [<span data-ttu-id="cc386-151">向外扩展 BizTalk Server Database</span><span class="sxs-lookup"><span data-stu-id="cc386-151">Scaling Out the BizTalk Server Databases</span></span>](../technical-guides/scaling-out-the-biztalk-server-databases.md)