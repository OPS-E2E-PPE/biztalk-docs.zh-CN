---
title: 主密钥服务器的高可用性 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 9b99cb04-61a5-41cc-a409-35897c17b789
caps.latest.revision: 4
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c27f5ad770f2127dfaecd9551cdfa37b18e6748b
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65277201"
---
# <a name="high-availability-for-the-master-secret-server"></a><span data-ttu-id="ebc59-102">主密钥服务器的高可用性</span><span class="sxs-lookup"><span data-stu-id="ebc59-102">High Availability for the Master Secret Server</span></span>
<span data-ttu-id="ebc59-103">即使您不使用企业单一登录 (SSO) 功能来映射凭据和单一登录，SSO 将是整个 Microsoft BizTalk Server 基础结构的关键部分，因为[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]使用 SSO 帮助确保信息的端口配置。</span><span class="sxs-lookup"><span data-stu-id="ebc59-103">Even if you do not use the Enterprise Single Sign-On (SSO) functionality for mapping credentials and single sign-on, SSO is a critical part of the overall Microsoft BizTalk Server infrastructure, because [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] uses SSO to help secure information for port configuration.</span></span> <span data-ttu-id="ebc59-104">端口配置数据加密，并存储在 SSO 数据库中。</span><span class="sxs-lookup"><span data-stu-id="ebc59-104">The port configuration data is encrypted and stored in the SSO database.</span></span> <span data-ttu-id="ebc59-105">每个 BizTalk server 提供用于加密和解密的端口配置数据使用了 SSO 服务服务 (ENTSSO.exe)。</span><span class="sxs-lookup"><span data-stu-id="ebc59-105">Each BizTalk server has an SSO service (ENTSSO.exe) that is used for encrypting and decrypting the port configuration data.</span></span>  
  
 <span data-ttu-id="ebc59-106">SSO 服务启动时，它从主密钥服务器检索加密密钥。</span><span class="sxs-lookup"><span data-stu-id="ebc59-106">When an SSO service starts up, it retrieves the encryption key from the master secret server.</span></span> <span data-ttu-id="ebc59-107">此加密密钥称为主密钥。</span><span class="sxs-lookup"><span data-stu-id="ebc59-107">This encryption key is called the master secret.</span></span> <span data-ttu-id="ebc59-108">主密钥服务器是另一个具有附加的子服务维护并分发主密钥的 SSO 服务。</span><span class="sxs-lookup"><span data-stu-id="ebc59-108">The master secret server is another SSO service that has an additional subservice that maintains and distributes the master secret.</span></span> <span data-ttu-id="ebc59-109">检索主密钥后，SSO 服务将其缓存。</span><span class="sxs-lookup"><span data-stu-id="ebc59-109">After a master secret is retrieved, the SSO service caches it.</span></span> <span data-ttu-id="ebc59-110">每隔 60 秒，SSO 服务主密钥服务器与同步主密钥。</span><span class="sxs-lookup"><span data-stu-id="ebc59-110">Every 60 seconds, the SSO service synchronizes the master secret with the master secret server.</span></span>  
  
 <span data-ttu-id="ebc59-111">如果主密钥服务器失败，并且 SSO 服务检测到一个其刷新的时间间隔中的故障，SSO 服务和服务器失败，包括凭据解密之前运行的所有运行时操作已成功继续。</span><span class="sxs-lookup"><span data-stu-id="ebc59-111">If the master secret server fails, and the SSO service detects the failure in one of its refresh intervals, the SSO service and all run-time operations that were running before the server failed, including decryption of credentials, continue successfully.</span></span> <span data-ttu-id="ebc59-112">但是，无法加密新的凭据或端口配置数据。</span><span class="sxs-lookup"><span data-stu-id="ebc59-112">However, you cannot encrypt new credentials or port configuration data.</span></span> <span data-ttu-id="ebc59-113">因此，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境具有主密钥服务器的可用性的依赖关系。</span><span class="sxs-lookup"><span data-stu-id="ebc59-113">Therefore, the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment has a dependency on the availability of the master secret server.</span></span>  
  
## <a name="making-the-master-secret-server-available"></a><span data-ttu-id="ebc59-114">提供对主密钥服务器</span><span class="sxs-lookup"><span data-stu-id="ebc59-114">Making the Master Secret Server Available</span></span>  
 <span data-ttu-id="ebc59-115">为 SSO 系统的可用性，因此的[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境中，它是关键您备份主密钥，只要它生成。</span><span class="sxs-lookup"><span data-stu-id="ebc59-115">For availability of the SSO system, and therefore of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment, it is critical that you back up the master secret as soon as it is generated.</span></span> <span data-ttu-id="ebc59-116">如果您丢失主密钥，则会丢失 SSO 系统将通过使用该主密钥加密的数据。</span><span class="sxs-lookup"><span data-stu-id="ebc59-116">If you lose it, you lose the data that the SSO system encrypted by using that master secret.</span></span> <span data-ttu-id="ebc59-117">有关备份主密钥的详细信息，请参阅[如何返回主密钥](http://go.microsoft.com/fwlink/?LinkID=151934)(<http://go.microsoft.com/fwlink/?LinkID=151934>) 在 BizTalk Server 帮助。</span><span class="sxs-lookup"><span data-stu-id="ebc59-117">For more information about backing up the master secret, see [How to Back Up the Master Secret](http://go.microsoft.com/fwlink/?LinkID=151934) (<http://go.microsoft.com/fwlink/?LinkID=151934>) in BizTalk Server Help.</span></span>  
  
 <span data-ttu-id="ebc59-118">您可以进行主密钥服务器可通过两种方式：</span><span class="sxs-lookup"><span data-stu-id="ebc59-118">You can make the master secret server available in two ways:</span></span>  
  
- <span data-ttu-id="ebc59-119">**可用，但不是高度可用**。</span><span class="sxs-lookup"><span data-stu-id="ebc59-119">**Available, but not highly available**.</span></span> <span data-ttu-id="ebc59-120">可以创建要在主密钥服务器变得不可用，并且你可以手动升级另一台 SSO 服务器主密钥服务器和还原此服务器上的主密钥时通知你的 Microsoft System Center Operations Manager 事件。</span><span class="sxs-lookup"><span data-stu-id="ebc59-120">You can create a Microsoft System Center Operations Manager event to notify you when the master secret server becomes unavailable, and you can then manually promote another SSO server to master secret server and restore the master secret on this server.</span></span>  
  
   <span data-ttu-id="ebc59-121">尽管此配置不具有高可用性，但可能会令人满意，在大多数情况下，与扩展接收、 发送和处理主机保持一致。</span><span class="sxs-lookup"><span data-stu-id="ebc59-121">Although this configuration is not highly available, it can be satisfactory for most scenarios and it is consistent with scaling out the receiving, sending, and processing hosts.</span></span>  
  
- <span data-ttu-id="ebc59-122">**高度可用**。</span><span class="sxs-lookup"><span data-stu-id="ebc59-122">**Highly available**.</span></span> <span data-ttu-id="ebc59-123">若要为主密钥服务器提供冗余，在单独的主密钥服务器群集上使用 Windows 群集或现有数据库群集上配置主密钥服务器。</span><span class="sxs-lookup"><span data-stu-id="ebc59-123">To provide redundancy for the master secret server, use Windows Clustering on a separate master secret server cluster, or configure the master secret server on an existing database cluster.</span></span> <span data-ttu-id="ebc59-124">主密钥服务器提供的服务不会占用很多资源，并通常不会影响数据库的功能或数据库群集上安装时的性能。</span><span class="sxs-lookup"><span data-stu-id="ebc59-124">The services provided by the master secret server do not consume many resources, and typically do not affect database functionality or performance when installed on a database cluster.</span></span> <span data-ttu-id="ebc59-125">下图显示了如何使在主密钥服务器高度可用。</span><span class="sxs-lookup"><span data-stu-id="ebc59-125">The following figure shows how you can make the master secret server highly available.</span></span>  
  
   <span data-ttu-id="ebc59-126">![高度可用的主密钥服务器](../core/media/tdi-highava-msscluster.gif "TDI_HighAva_MSSCluster")</span><span class="sxs-lookup"><span data-stu-id="ebc59-126">![Highly Available Master Secret Server](../core/media/tdi-highava-msscluster.gif "TDI_HighAva_MSSCluster")</span></span>  
  
   <span data-ttu-id="ebc59-127">虽然此配置是高度可用，但它需要额外的硬件资源。</span><span class="sxs-lookup"><span data-stu-id="ebc59-127">While this configuration is highly available, it requires additional hardware resources.</span></span> <span data-ttu-id="ebc59-128">有关 sso 的高可用性安装选项的详细信息，请参阅[高可用性 SSO 安装选项](http://go.microsoft.com/fwlink/?LinkId=156838)(http://go.microsoft.com/fwlink/?LinkId=156838) BizTalk Server 帮助中。</span><span class="sxs-lookup"><span data-stu-id="ebc59-128">For more information about high-availability installation options for SSO, see [High-Availability SSO Installation Options](http://go.microsoft.com/fwlink/?LinkId=156838) (http://go.microsoft.com/fwlink/?LinkId=156838) in BizTalk Server Help.</span></span>  
  
   <span data-ttu-id="ebc59-129">本部分包括有关在上将 SSO 主密钥服务器配置为高度可用群集资源的详细的信息[!INCLUDE[btsWinSvrNoVersion](../includes/btswinsvrnoversion-md.md)]群集。</span><span class="sxs-lookup"><span data-stu-id="ebc59-129">This section includes detailed information about configuring the SSO master secret server as a highly available cluster resource on a [!INCLUDE[btsWinSvrNoVersion](../includes/btswinsvrnoversion-md.md)] cluster.</span></span>  
  
  > [!NOTE]
  >  <span data-ttu-id="ebc59-130">若要减少高度可用的解决方案的硬件资源，可以添加在主密钥服务器为群集资源中你[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]群集。</span><span class="sxs-lookup"><span data-stu-id="ebc59-130">To reduce the hardware resources for a highly available solution, you can add the master secret server as a cluster resource in your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] cluster.</span></span> <span data-ttu-id="ebc59-131">请注意，您不需要购买其他[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]许可证安装的 SSO 服务在运行 SQL Server 的计算机上。</span><span class="sxs-lookup"><span data-stu-id="ebc59-131">Note that you do not need to purchase additional [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] licenses to install the SSO service on the computer running the SQL Server.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="ebc59-132">本节内容</span><span class="sxs-lookup"><span data-stu-id="ebc59-132">In This Section</span></span>  
  
-   [<span data-ttu-id="ebc59-133">聚类分析主密钥服务器</span><span class="sxs-lookup"><span data-stu-id="ebc59-133">Clustering the Master Secret Server</span></span>](../technical-guides/clustering-the-master-secret-server.md)  
  
-   [<span data-ttu-id="ebc59-134">手动指定新主密钥服务器</span><span class="sxs-lookup"><span data-stu-id="ebc59-134">Designating a New Master Secret Server Manually</span></span>](../technical-guides/designating-a-new-master-secret-server-manually.md)  
  
## <a name="see-also"></a><span data-ttu-id="ebc59-135">请参阅</span><span class="sxs-lookup"><span data-stu-id="ebc59-135">See Also</span></span>  
 <span data-ttu-id="ebc59-136">[规划高 Availability2](../technical-guides/planning-for-high-availability2.md) </span><span class="sxs-lookup"><span data-stu-id="ebc59-136">[Planning for High Availability2](../technical-guides/planning-for-high-availability2.md) </span></span>  
 <span data-ttu-id="ebc59-137">[BizTalk 主机的的高可用性](../technical-guides/high-availability-for-biztalk-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="ebc59-137">[High Availability for BizTalk Hosts](../technical-guides/high-availability-for-biztalk-hosts.md) </span></span>  
 [<span data-ttu-id="ebc59-138">数据库的高可用性</span><span class="sxs-lookup"><span data-stu-id="ebc59-138">High Availability for Databases</span></span>](../technical-guides/high-availability-for-databases.md)