---
title: 系统级瓶颈 |Microsoft Docs
ms.custom: ''
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 0bdff435-76eb-495f-9fb6-1f1acef3921e
caps.latest.revision: 11
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 1c736cb7de384edadac1c7b4c0fd840e8d4e7cac
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65400681"
---
# <a name="system-level-bottlenecks"></a><span data-ttu-id="7ee37-102">系统级瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-102">System-Level Bottlenecks</span></span>
<span data-ttu-id="7ee37-103">本主题介绍如何解决常见的系统级瓶颈可能会影响 BizTalk Server 解决方案的性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-103">This topic describes how to address common system-level bottlenecks that can impact the performance of a BizTalk Server solution.</span></span>  
  
## <a name="creating-a-snapshot-of-the-baseline-configuration"></a><span data-ttu-id="7ee37-104">创建基线配置的快照</span><span class="sxs-lookup"><span data-stu-id="7ee37-104">Creating a snapshot of the baseline configuration</span></span>  
 <span data-ttu-id="7ee37-105">收集以下信息可以为您提供可用于帮助更正系统级瓶颈中的基线配置的快照。</span><span class="sxs-lookup"><span data-stu-id="7ee37-105">Gathering the following information can provide you with a snapshot of the baseline configuration that you can use to assist in correcting system-level bottlenecks.</span></span>  
  
### <a name="gather-documentation"></a><span data-ttu-id="7ee37-106">收集文档</span><span class="sxs-lookup"><span data-stu-id="7ee37-106">Gather documentation</span></span>  
 <span data-ttu-id="7ee37-107">查看体系结构和方案的基础结构的文档。</span><span class="sxs-lookup"><span data-stu-id="7ee37-107">Review the documentation of the architecture and infrastructure of your scenario.</span></span>  
  
### <a name="run-the-baseline-security-analyzer"></a><span data-ttu-id="7ee37-108">运行基准安全分析器</span><span class="sxs-lookup"><span data-stu-id="7ee37-108">Run the Baseline Security Analyzer</span></span>  
 <span data-ttu-id="7ee37-109">请执行以下步骤来运行基准安全分析器：</span><span class="sxs-lookup"><span data-stu-id="7ee37-109">Follow these steps to run the Baseline Security Analyzer:</span></span>  
  
1.  <span data-ttu-id="7ee37-110">下载[Microsoft Baseline Security Analyzer 2.2](http://go.microsoft.com/fwlink/?LinKID=204006) (http://go.microsoft.com/fwlink/?LinkId=204006)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-110">Download the [Microsoft Baseline Security Analyzer 2.2](http://go.microsoft.com/fwlink/?LinKID=204006) (http://go.microsoft.com/fwlink/?LinkId=204006).</span></span>  
  
2.  <span data-ttu-id="7ee37-111">使用域管理员帐户，登录到承载 BizTalk Server 和 SQL Server 计算机在同一网络上的计算机。</span><span class="sxs-lookup"><span data-stu-id="7ee37-111">Using a domain administrator account, log on to a computer on the same network that is hosting the BizTalk Server and SQL Server computers.</span></span>  
  
3.  <span data-ttu-id="7ee37-112">在当前计算机 （例如，一个 BizTalk Server 计算机或单独的计算机） 上安装 Microsoft Baseline Security Analyzer。</span><span class="sxs-lookup"><span data-stu-id="7ee37-112">Install the Microsoft Baseline Security Analyzer on the current computer (for example, one of the BizTalk Server computers or a separate computer).</span></span>  
  
4.  <span data-ttu-id="7ee37-113">执行单独的扫描 (**开始扫描**)，指定为参数的名称或每个 BizTalk Server 和 SQL Server 计算机的 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="7ee37-113">Execute a separate scan (**Start Scan**), specifying as a parameter the name or the IP address of each BizTalk Server and SQL Server computer.</span></span>  
  
5.  <span data-ttu-id="7ee37-114">%Userprofile%\SecurityScans 目录中复制每个安全报告 （.mbsa 文件）。</span><span class="sxs-lookup"><span data-stu-id="7ee37-114">Copy each security report (.mbsa files) from the %userprofile%\SecurityScans directory.</span></span>  
  
### <a name="run-the-biztalk-server-best-practices-analyzer"></a><span data-ttu-id="7ee37-115">运行 BizTalk Server 最佳实践分析工具</span><span class="sxs-lookup"><span data-stu-id="7ee37-115">Run the BizTalk Server Best Practices Analyzer</span></span>  
 <span data-ttu-id="7ee37-116">请执行以下步骤来运行 BizTalk Server 最佳做法分析器：</span><span class="sxs-lookup"><span data-stu-id="7ee37-116">Follow these steps to run the BizTalk Server Best Practices Analyzer:</span></span>  
  
1.  <span data-ttu-id="7ee37-117">下载[BizTalk Server 的最佳做法分析器 v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-117">Download the [BizTalk Server Best Practices Analyzer v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317).</span></span>  
  
2.  <span data-ttu-id="7ee37-118">使用 BizTalk Server 管理员安全组的成员的用户帐户，登录到 BizTalk Server 节点。</span><span class="sxs-lookup"><span data-stu-id="7ee37-118">Using a user account that is part of the BizTalk Server Administrator security group, log on to a BizTalk Server node.</span></span>  
  
3.  <span data-ttu-id="7ee37-119">在当前计算机上安装 BizTalk Server Best Practices Analyzer。</span><span class="sxs-lookup"><span data-stu-id="7ee37-119">Install the BizTalk Server Best Practices Analyzer on the current computer.</span></span>  
  
4.  <span data-ttu-id="7ee37-120">运行该工具并保存报表。</span><span class="sxs-lookup"><span data-stu-id="7ee37-120">Run the tool and save the report.</span></span>  
  
### <a name="run-msinfo32-and-save-the-results"></a><span data-ttu-id="7ee37-121">运行 MSInfo32 并保存结果</span><span class="sxs-lookup"><span data-stu-id="7ee37-121">Run MSInfo32 and save the results</span></span>  
 <span data-ttu-id="7ee37-122">请按照以下步骤来运行 MSInfo32 操作：</span><span class="sxs-lookup"><span data-stu-id="7ee37-122">Follow these steps to run MSInfo32:</span></span>  
  
1.  <span data-ttu-id="7ee37-123">使用域或本地管理员帐户，登录到每个 BizTalk Server 和 SQL Server 计算机。</span><span class="sxs-lookup"><span data-stu-id="7ee37-123">Using a domain or a local administrator account, log on to each BizTalk Server and SQL Server computer.</span></span>  
  
2.  <span data-ttu-id="7ee37-124">启动命令提示符处，并将目录更改到的计算机的 %windir%\system32 目录。</span><span class="sxs-lookup"><span data-stu-id="7ee37-124">Launch a command prompt and change directories to the %windir%\system32 directory of the computer.</span></span>  
  
3.  <span data-ttu-id="7ee37-125">从命令提示符下运行 MSinfo32.exe。</span><span class="sxs-lookup"><span data-stu-id="7ee37-125">Run MSinfo32.exe from the command prompt.</span></span>  
  
4.  <span data-ttu-id="7ee37-126">单击**文件**菜单，然后选择**导出**菜单项以导出以保存计算机配置。</span><span class="sxs-lookup"><span data-stu-id="7ee37-126">Click the **File** menu and select the **Export** menu item to export to save the computer configuration.</span></span>  
  
### <a name="export-the-biztalk-server-and-sql-server-computer-tcpip-registry-setting-"></a><span data-ttu-id="7ee37-127">导出 BizTalk Server 和 SQL Server 计算机 TCP/IP 注册表设置-</span><span class="sxs-lookup"><span data-stu-id="7ee37-127">Export the BizTalk Server and SQL Server computer TCP/IP registry setting-</span></span>  
 <span data-ttu-id="7ee37-128">请按照下列步骤以保存 BizTalk Server 和 SQL Server TCP/IP 注册表设置：</span><span class="sxs-lookup"><span data-stu-id="7ee37-128">Follow these steps to save the BizTalk Server and SQL Server TCP/IP registry settings:</span></span>  
  
1.  <span data-ttu-id="7ee37-129">启动命令提示符处，并将目录更改到的计算机的 %windir%\system32 目录。</span><span class="sxs-lookup"><span data-stu-id="7ee37-129">Launch a command prompt and change directories to the %windir%\system32 directory of the computer.</span></span>  
  
2.  <span data-ttu-id="7ee37-130">在命令提示符下运行 Regedit.exe。</span><span class="sxs-lookup"><span data-stu-id="7ee37-130">Run Regedit.exe from the command prompt.</span></span>  
  
3.  <span data-ttu-id="7ee37-131">导航到注册表中的以下项：</span><span class="sxs-lookup"><span data-stu-id="7ee37-131">Navigate to the following key in the registry:</span></span>  
  
    ```  
    [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters] (network settings)  
    ```  
  
4.  <span data-ttu-id="7ee37-132">右键单击此项，然后选择**导出**将注册表项导出到文件。</span><span class="sxs-lookup"><span data-stu-id="7ee37-132">Right-click this key and select **Export** to export the registry key to a file.</span></span>  
  
### <a name="collect-the-biztalk-configuration-files"></a><span data-ttu-id="7ee37-133">收集 BizTalk 配置文件</span><span class="sxs-lookup"><span data-stu-id="7ee37-133">Collect the BizTalk configuration files</span></span>  
 <span data-ttu-id="7ee37-134">每个 BizTalk Server 在节点上，收集 BizTalk Server 配置文件中，BTSNTSvc.exe.config 文件 （或 BTSNTSvc64.exe.config 的 64 位主机），位于 BizTalk Server 安装文件夹 (例如 C:\Program Files\Microsoft BizTalk Server 2010)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-134">On each BizTalk Server node, collect the BizTalk Server configuration file, BTSNTSvc.exe.config file (or BTSNTSvc64.exe.config for 64-bit hosts), located in the BizTalk Server installation folder (e.g. C:\Program Files\Microsoft BizTalk Server 2010).</span></span>  
  
### <a name="collect-the-net-configuration-files"></a><span data-ttu-id="7ee37-135">收集.NET 配置文件</span><span class="sxs-lookup"><span data-stu-id="7ee37-135">Collect the .NET configuration files</span></span>  
 <span data-ttu-id="7ee37-136">每个 BizTalk Server 在节点上，收集在 machine.config 和 web.config 的.NET Framework 4.0 配置文件。</span><span class="sxs-lookup"><span data-stu-id="7ee37-136">On each BizTalk Server node, collect the machine.config and web.config .NET Framework 4.0 configuration files.</span></span> <span data-ttu-id="7ee37-137">您可以在以下位置找到配置文件：</span><span class="sxs-lookup"><span data-stu-id="7ee37-137">You can find the configuration files in the following location:</span></span>  
  
-   <span data-ttu-id="7ee37-138">适用于 32 位： %windir%\Microsoft.NET\Framework\v4.0.30319\CONFIG 文件夹</span><span class="sxs-lookup"><span data-stu-id="7ee37-138">For 32-bit: %windir%\Microsoft.NET\Framework\v4.0.30319\CONFIG folder</span></span>  
  
-   <span data-ttu-id="7ee37-139">对于 64 位： %windir%\Microsoft.NET\Framework64\v4.0.30319\CONFIG 文件夹</span><span class="sxs-lookup"><span data-stu-id="7ee37-139">For 64-bit: %windir%\Microsoft.NET\Framework64\v4.0.30319\CONFIG folder</span></span>  
  
### <a name="use-the-biztalk-msgboxviewer-tool-to-collect-information-about-the-messagebox-database"></a><span data-ttu-id="7ee37-140">使用 BizTalk MsgBoxViewer 工具收集有关 MessageBox 数据库的信息</span><span class="sxs-lookup"><span data-stu-id="7ee37-140">Use the BizTalk MsgBoxViewer tool to collect information about the MessageBox database</span></span>  
 <span data-ttu-id="7ee37-141">请按照下列步骤来收集有关使用 BizTalk MsgBoxViewer 工具在 MessageBox 数据库信息：</span><span class="sxs-lookup"><span data-stu-id="7ee37-141">Follow these steps to collect information about the MessageBox database using the BizTalk MsgBoxViewer tool:</span></span>  
  
1.  <span data-ttu-id="7ee37-142">下载[BizTalk MsgBoxViewer 工具](http://go.microsoft.com/fwlink/?LinkID=117289)(http://go.microsoft.com/fwlink/?LinkID=117289)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-142">Download the [BizTalk MsgBoxViewer tool](http://go.microsoft.com/fwlink/?LinkID=117289) (http://go.microsoft.com/fwlink/?LinkID=117289).</span></span>  
  
2.  <span data-ttu-id="7ee37-143">登录到 BizTalk Server 管理员安全组的成员的用户帐户与 BizTalk Server 计算机上。</span><span class="sxs-lookup"><span data-stu-id="7ee37-143">Log on to the BizTalk Server computer with a user account that is part of the BizTalk Server Administrator security group.</span></span>  
  
3.  <span data-ttu-id="7ee37-144">将 MsgBoxViewer.exe 复制到 BizTalk Server 计算机。</span><span class="sxs-lookup"><span data-stu-id="7ee37-144">Copy the MsgBoxViewer.exe to the BizTalk Server computer.</span></span>  
  
4.  <span data-ttu-id="7ee37-145">启动该工具。</span><span class="sxs-lookup"><span data-stu-id="7ee37-145">Launch the tool.</span></span>  
  
5.  <span data-ttu-id="7ee37-146">单击**要收集的可选信息**选项卡，然后依次**选择的所有信息**。</span><span class="sxs-lookup"><span data-stu-id="7ee37-146">Click the **Optional Info to Collect** tab, and then click **Select All Info**.</span></span>  
  
6.  <span data-ttu-id="7ee37-147">单击**开始收集**。</span><span class="sxs-lookup"><span data-stu-id="7ee37-147">Click **Start to Collect**.</span></span>  
  
7.  <span data-ttu-id="7ee37-148">状态标签将显示当**最终集合**消息，切换到包含 MsgBoxViewer.exe 可执行文件的文件夹和复制生成的报表 (.htm) 和日志文件。</span><span class="sxs-lookup"><span data-stu-id="7ee37-148">When the Status label shows the **End Collection** message, switch to the folder containing the MsgBoxViewer.exe executable and copy the resulting report (.htm) and log files.</span></span>  
  
### <a name="collect-and-store-the-source-code-for-all-components-used-in-the-solution"></a><span data-ttu-id="7ee37-149">收集和存储解决方案中使用的所有组件的源代码</span><span class="sxs-lookup"><span data-stu-id="7ee37-149">Collect and store the source code for all components used in the solution</span></span>  
 <span data-ttu-id="7ee37-150">在单独的文件共享上存储的所有组件 （例如业务流程、 自定义管道组件和帮助程序组件代码） 的源代码。</span><span class="sxs-lookup"><span data-stu-id="7ee37-150">Store the source code for all components (for example Orchestration, Custom Pipeline Component, and Helper components code) on a separate file share.</span></span>  
  
## <a name="initial-troubleshooting"></a><span data-ttu-id="7ee37-151">初始故障排除</span><span class="sxs-lookup"><span data-stu-id="7ee37-151">Initial troubleshooting</span></span>  
 <span data-ttu-id="7ee37-152">不存在的 BizTalk Server 解决方案，如果未启用，将导致性能问题，而不考虑总大小的某些组件或 BizTalk 解决方案的设计。</span><span class="sxs-lookup"><span data-stu-id="7ee37-152">There are certain components of a BizTalk Server solution which, if not enabled, will cause performance problems regardless of the overall size or design of the BizTalk solution.</span></span> <span data-ttu-id="7ee37-153">排除具有吸引力的 BizTalk 解决方案的详尽瓶颈分析之前的"常见原因"一些，应完成以下初步故障排除任务。</span><span class="sxs-lookup"><span data-stu-id="7ee37-153">The following preliminary troubleshooting tasks should be completed to rule out some of the “usual suspects” before engaging in an exhaustive bottleneck analysis of a BizTalk solution.</span></span>  
  
-   <span data-ttu-id="7ee37-154">**验证是否正在运行的跟踪主机实例-** 跟踪主机实例是负责将 BAM 和 HAT 数据从 MessageBox 数据库的 TrackingData 表移至 BizTalkDTADb 和/或 BAMPrimaryImport 数据库表。</span><span class="sxs-lookup"><span data-stu-id="7ee37-154">**Verify the Tracking host instance is running -** The Tracking host instance is responsible for moving both BAM and HAT data from the TrackingData table of the MessageBox database to the BizTalkDTADb and/or BAMPrimaryImport database tables.</span></span> <span data-ttu-id="7ee37-155">如果跟踪主机实例未运行，则跟踪数据将会在 MessageBox 数据库中累积并对 BizTalk Server 解决方案的性能产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="7ee37-155">If the tracking host instance is not running, then tracking data will accumulate in the MessageBox database and negatively impact performance of the BizTalk Server solution.</span></span>  
  
-   <span data-ttu-id="7ee37-156">**验证企业单一登录 (ENTSSO) 服务是否正在运行所有 BizTalk Server 计算机-上**BizTalk 主机实例将保留 ENTSSO 服务的本地运行实例上的依赖项。</span><span class="sxs-lookup"><span data-stu-id="7ee37-156">**Verify the Enterprise Single Sign-On (ENTSSO) service is running on all BizTalk Server computers -** BizTalk host instances maintain a dependency on a locally running instance of the ENTSSO service.</span></span> <span data-ttu-id="7ee37-157">如果 ENTSSO 服务未运行 BizTalk Server 上，在服务器上的主机实例将无法运行。</span><span class="sxs-lookup"><span data-stu-id="7ee37-157">If the ENTSSO service is not running on the BizTalk Server, then host instances on the server will not be able to run either.</span></span>  
  
-   <span data-ttu-id="7ee37-158">**验证 SQL Server 代理服务是否正在运行 SQL Server 的所有计算机的上**必须按顺序执行的 BizTalk SQL Server 代理作业运行 SQL Server 代理服务。</span><span class="sxs-lookup"><span data-stu-id="7ee37-158">**Verify the SQL Server Agent service is running on all SQL Server computers -** The SQL Server Agent service must be running in order for the BizTalk SQL Server Agent jobs to execute.</span></span> <span data-ttu-id="7ee37-159">这些作业执行重要功能，以使服务器正常操作和运行。</span><span class="sxs-lookup"><span data-stu-id="7ee37-159">These jobs perform important functions to keep your servers operational and healthy.</span></span>  
  
-   <span data-ttu-id="7ee37-160">**验证 BizTalk SQL Server 代理作业是否已启用并运行而没有异常-** 即使 SQL Server 代理服务正在运行，也是强制性的所有默认 BizTalk SQL Server 代理作业启用并正在运行成功。</span><span class="sxs-lookup"><span data-stu-id="7ee37-160">**Verify the BizTalk SQL Server Agent jobs are enabled and running without exceptions -** Even if the SQL Server Agent service is running, it is imperative that all of the default BizTalk SQL Server Agent jobs are enabled and running successfully.</span></span>  
  
-   <span data-ttu-id="7ee37-161">**检查 BizTalk Server 和 SQL Server 事件日志-** 对 BizTalk Server 或 SQL Server 事件日志的粗略检查可能会泄漏，否则可能需要大量的时间以诊断并解决问题。</span><span class="sxs-lookup"><span data-stu-id="7ee37-161">**Check the BizTalk Server and SQL Server event logs -** A cursory examination of the BizTalk Server or SQL Server event logs may reveal a problem that could otherwise take a significant amount of time to diagnose and resolve.</span></span>  
  
-   <span data-ttu-id="7ee37-162">**运行 BizTalk Server Best Practices Analyzer-** BizTalk Server Best Practices Analyzer 会检查 BizTalk Server 部署，并生成与最佳做法标准相关的问题的列表。</span><span class="sxs-lookup"><span data-stu-id="7ee37-162">**Run the BizTalk Server Best Practices Analyzer -** The BizTalk Server Best Practices Analyzer examines a BizTalk Server deployment and generates a list of issues pertaining to best practices standards.</span></span> <span data-ttu-id="7ee37-163">该工具通过不同的信息源，如 Windows Management Instrumentation (WMI) 类、 SQL Server 数据库和注册表项中的数据收集执行配置级别验证。</span><span class="sxs-lookup"><span data-stu-id="7ee37-163">The tool performs configuration-level verification by gathering data from different information sources, such as Windows Management Instrumentation (WMI) classes, SQL Server databases, and registry entries.</span></span> <span data-ttu-id="7ee37-164">数据然后用于评估部署配置。</span><span class="sxs-lookup"><span data-stu-id="7ee37-164">The data is then used to evaluate the deployment configuration.</span></span> <span data-ttu-id="7ee37-165">该工具读取和仅报告并不会修改任何系统设置，并不是一个自我调整工具。</span><span class="sxs-lookup"><span data-stu-id="7ee37-165">The tool reads and reports only and does not modify any system settings, and is not a self-tuning tool.</span></span> <span data-ttu-id="7ee37-166">下载 BizTalk Server 的最佳做法分析器从 v1.2 [BizTalk Server 的最佳做法分析器 v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-166">Download the BizTalk Server Best Practices Analyzer v1.2 from [BizTalk Server Best Practices Analyzer v1.2](http://go.microsoft.com/fwlink/?LinkID=83317) (http://go.microsoft.com/fwlink/?LinkID=83317).</span></span>  
  
## <a name="high-level-system-bottlenecks"></a><span data-ttu-id="7ee37-167">高级系统瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-167">High-level system bottlenecks</span></span>  
 <span data-ttu-id="7ee37-168">本部分介绍可能会出现在 BizTalk Server 解决方案和可能的缓解策略的系统级瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-168">This section describes system-level bottlenecks that may be present in a BizTalk Server solution and possible mitigation strategies.</span></span>  
  
### <a name="disk-io-bottlenecks"></a><span data-ttu-id="7ee37-169">磁盘 I/O 瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-169">Disk I/O bottlenecks</span></span>  
 <span data-ttu-id="7ee37-170">磁盘 I/O 是指读取和写入操作执行的物理磁盘上的应用程序或安装在服务器中的多个磁盘的数量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-170">Disk I/O refers to the number of read and write operations performed by your application on a physical disk or multiple disks installed in your server.</span></span> <span data-ttu-id="7ee37-171">可能会导致磁盘 I/O 和相关的瓶颈的常见活动包括长时间运行文件 I/O 操作、 数据加密和解密，从数据库表和足够的物理内存，这可能会产生了过度分页导致读取不必要的数据活动。</span><span class="sxs-lookup"><span data-stu-id="7ee37-171">Common activities that can cause disk I/O and related bottlenecks include long-running file I/O operations, data encryption and decryption, reading unnecessary data from database tables, and an insufficient physical memory, which can lead to excessive paging activity.</span></span> <span data-ttu-id="7ee37-172">磁盘速度是评估磁盘 I/O 瓶颈; 时要考虑的另一个因素更快速的磁盘提供更高的性能并帮助减少磁盘 I/O 瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-172">Disk speed is another factor to consider when evaluating disk I/O bottlenecks; faster disks provide increased performance and help reduce disk I/O bottlenecks.</span></span>  
  
 <span data-ttu-id="7ee37-173">下表提供了规划 BizTalk Server 解决方案的磁盘子系统时应考虑的因素。</span><span class="sxs-lookup"><span data-stu-id="7ee37-173">The table below provides factors that should be considered when planning the disk subsystem for a BizTalk Server solution.</span></span>  
  
|<span data-ttu-id="7ee37-174">磁盘子系统身份</span><span class="sxs-lookup"><span data-stu-id="7ee37-174">Disk subsystem factor</span></span>|<span data-ttu-id="7ee37-175">详细信息</span><span class="sxs-lookup"><span data-stu-id="7ee37-175">Details</span></span>|  
|---------------------------|-------------|  
|<span data-ttu-id="7ee37-176">磁盘内存缓存和可用物理内存</span><span class="sxs-lookup"><span data-stu-id="7ee37-176">Disk memory cache and available physical memory</span></span>|<span data-ttu-id="7ee37-177">由于内存缓存到磁盘的物理内存变得有限，因此请确保有足够的可用内存。</span><span class="sxs-lookup"><span data-stu-id="7ee37-177">Because memory is cached to disk as physical memory becomes limited, make sure that you have a sufficient amount of memory available.</span></span> <span data-ttu-id="7ee37-178">内存不足时，编写更多的页面到磁盘，从而导致增加的磁盘活动。</span><span class="sxs-lookup"><span data-stu-id="7ee37-178">When memory is scarce, more pages are written to disk, resulting in increased disk activity.</span></span> <span data-ttu-id="7ee37-179">此外，请确保将页面文件设置为适当的大小。</span><span class="sxs-lookup"><span data-stu-id="7ee37-179">Also, make sure to set the paging file to an appropriate size.</span></span> <span data-ttu-id="7ee37-180">更多的磁盘内存缓存可帮助在磁盘 I/O 请求中的偏移量的高峰。</span><span class="sxs-lookup"><span data-stu-id="7ee37-180">Additional disk memory cache will help offset peaks in disk I/O requests.</span></span> <span data-ttu-id="7ee37-181">但是，但应注意的大型磁盘内存缓存很少能解决问题没有足够的心轴，并具有足够的心轴可以不用为大规模的磁盘内存缓存。</span><span class="sxs-lookup"><span data-stu-id="7ee37-181">However, it should be noted that a large disk memory cache seldom solves the problem of not having enough spindles, and having enough spindles can negate the need for a large disk memory cache.</span></span> <span data-ttu-id="7ee37-182">有关配置 Windows 页面文件以获得最佳性能的信息，请参阅主题中的"配置 Windows 页面文件以获得最佳性能"一节[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-182">For information on configuring the Windows paging file for optimal performance, see the section “Configure the Windows PAGEFILE for optimal performance” in the topic [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>|  
|<span data-ttu-id="7ee37-183">存储控制器类型</span><span class="sxs-lookup"><span data-stu-id="7ee37-183">Storage controller type</span></span>|<span data-ttu-id="7ee37-184">如果你有电池供电的缓存，启用写入缓存以提高数据库卷和事务日志文件卷上的磁盘写入性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-184">If you have battery-backed cache, enable write caching to improve disk write performance on the transaction log file volumes and on the database volumes.</span></span> <span data-ttu-id="7ee37-185">写入缓存提供的响应时间是 2 毫秒的写入 I/O 请求，而不是 10 到 20 毫秒，而无需启用写入缓存的响应时间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-185">Write caching provides a response time of 2 ms for a write I/O request, as opposed to a response time of 10 to 20 ms without write caching enabled.</span></span> <span data-ttu-id="7ee37-186">启用写入缓存极大地提高了客户端写入请求的响应能力。</span><span class="sxs-lookup"><span data-stu-id="7ee37-186">Enabling write caching greatly improves the responsiveness for client write requests.</span></span> <span data-ttu-id="7ee37-187">读取缓存无法提高在 BizTalk Server 方案的性能，因为它才有用实现顺序磁盘读取，只发生在事务日志文件。</span><span class="sxs-lookup"><span data-stu-id="7ee37-187">Read caching does not improve performance in a BizTalk Server scenario because it is only useful for sequential disk reads, which occur only in transaction log files.</span></span><br /><br /> <span data-ttu-id="7ee37-188">仅当它们播放时从读取事务日志文件，此类后将数据库还原或的服务器时未正确关闭。</span><span class="sxs-lookup"><span data-stu-id="7ee37-188">Transaction log files are read from only when they are being played back, such as after a database restore or when a server is not properly shutdown.</span></span> <span data-ttu-id="7ee37-189">更大的缓存允许更多的数据进行缓冲，这意味着可以容纳的饱和度值更长时间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-189">Larger caches allow for more data to be buffered, meaning that longer periods of saturation can be accommodated.</span></span> <span data-ttu-id="7ee37-190">如果你的控制器允许你配置的缓存页大小，应将其设置为 4 KB。</span><span class="sxs-lookup"><span data-stu-id="7ee37-190">If your controller allows you to configure the cache page size, you should set it to 4 KB.</span></span> <span data-ttu-id="7ee37-191">更大的大小，例如 8 KB，会导致缓存浪费，因为 4 KB 的 I/O 请求将占用整个缓存页 8 kb，从而导致在可用缓存减少一半。</span><span class="sxs-lookup"><span data-stu-id="7ee37-191">A larger size, such as 8 KB, results in wasted cache because a 4 KB I/O request takes up the entire cache page of 8 KB, thereby cutting your usable cache in half.</span></span>|  
|<span data-ttu-id="7ee37-192">心轴</span><span class="sxs-lookup"><span data-stu-id="7ee37-192">Spindles</span></span>|<span data-ttu-id="7ee37-193">轴是比容量，更重要，如果轴支持大量的随机 I/O 请求的 BizTalk Server 性能得到改进。</span><span class="sxs-lookup"><span data-stu-id="7ee37-193">Spindles are more important than capacity, and BizTalk Server performance is improved if the spindles support a high number of random I/O requests.</span></span> <span data-ttu-id="7ee37-194">规划不超过 80%的总利用率，以确保足够的 I/O 可用，甚至在心轴出现故障的情况下。</span><span class="sxs-lookup"><span data-stu-id="7ee37-194">Plan for no more than 80 percent total utilization to ensure sufficient I/O is available, even in cases of a spindle failure.</span></span>|  
|<span data-ttu-id="7ee37-195">Raid</span><span class="sxs-lookup"><span data-stu-id="7ee37-195">Raid</span></span>|<span data-ttu-id="7ee37-196">所用的 RAID 解决方案应基于成本和性能之间做出取舍适用于你的环境。</span><span class="sxs-lookup"><span data-stu-id="7ee37-196">The RAID solution you use should be based on the cost and performance trade-offs that are appropriate for your environment.</span></span> <span data-ttu-id="7ee37-197">因此，可能会为特定的数据存储要求建议的 RAID 解决方案的多个类型。</span><span class="sxs-lookup"><span data-stu-id="7ee37-197">Therefore, more than one type of RAID solution may be recommended for a particular data storage requirement.</span></span> <span data-ttu-id="7ee37-198">一般建议是，如下所示：</span><span class="sxs-lookup"><span data-stu-id="7ee37-198">General recommendations are as follows:</span></span><br /><br /> <span data-ttu-id="7ee37-199">-使用 Raid-1 + 0 为 BizTalk Server 数据库 （镜像组中的带区集）。</span><span class="sxs-lookup"><span data-stu-id="7ee37-199">-   Use Raid-1+0 (striped sets in a mirrored set) for the BizTalk Server databases.</span></span><br /><span data-ttu-id="7ee37-200">-对于事务日志文件卷使用 Raid 1 （无奇偶校验的镜像集）。</span><span class="sxs-lookup"><span data-stu-id="7ee37-200">-   Use Raid-1 (mirrored set without parity) for the transaction log file volumes.</span></span><br /><span data-ttu-id="7ee37-201">-在一般情况下，不建议 Raid 5 （带分布式奇偶校验的带区集），如 Raid 5 不提供最佳的可靠性、 可用性和性能相比其他 Raid 配置。</span><span class="sxs-lookup"><span data-stu-id="7ee37-201">-   In general, Raid 5 (striped set with distributed parity) is not recommended as Raid 5 does not provide optimal reliability, availability and performance as compared to other Raid configurations.</span></span><br /><span data-ttu-id="7ee37-202">-由于向可能的数据永久丢失，永远不应在 BizTalk Server 生产环境中使用 Raid 0 （无奇偶校验的带区集） 配置。</span><span class="sxs-lookup"><span data-stu-id="7ee37-202">-   Due to the possibility of permanent data loss, a Raid-0 (striped set without parity) configuration should never be used in a BizTalk Server production environment.</span></span>|  
|<span data-ttu-id="7ee37-203">总线类型</span><span class="sxs-lookup"><span data-stu-id="7ee37-203">Bus type</span></span>|<span data-ttu-id="7ee37-204">更高的吞吐量提供了更好的性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-204">Higher throughput provides better performance.</span></span> <span data-ttu-id="7ee37-205">一般情况下，SCSI 总线提供了更好的吞吐量和可伸缩性，比 IDE 或 ATA 总线。</span><span class="sxs-lookup"><span data-stu-id="7ee37-205">In general, SCSI buses provide better throughput and scalability than IDE or ATA buses.</span></span> <span data-ttu-id="7ee37-206">下面的公式可用于确定理论上的吞吐量限制为你的总线类型：</span><span class="sxs-lookup"><span data-stu-id="7ee37-206">You can use the following equation to determine the theoretical throughput limit for your bus type:</span></span><br /><br /> <span data-ttu-id="7ee37-207">(总线速度 （以位为单位） / 8 位 / 字节)X 操作系统速度 （以 mhz 为单位） = 吞吐量 （以 MB/秒）</span><span class="sxs-lookup"><span data-stu-id="7ee37-207">(Bus speed (in bits) / 8 bits per byte) X Operating speed (in MHz) = Throughput (in MB/s)</span></span><br /><br /> <span data-ttu-id="7ee37-208">此外可以通过将多个驱动器放置在单独 I/O 总线上提高磁盘 I/O 性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-208">You can also improve disk I/O performance by placing multiple drives on separate I/O buses.</span></span>|  
  
#### <a name="performance-counters-for-measuring-disk-io-bottlenecks"></a><span data-ttu-id="7ee37-209">衡量磁盘 I/O 瓶颈的性能计数器</span><span class="sxs-lookup"><span data-stu-id="7ee37-209">Performance counters for measuring disk I/O bottlenecks</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7ee37-210">在尝试分析磁盘性能瓶颈时，应始终使用物理磁盘计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-210">When attempting to analyze disk performance bottlenecks, you should always use physical disk counters.</span></span> <span data-ttu-id="7ee37-211">但是，如果你使用软件 RAID，应使用逻辑磁盘计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-211">However, if you use software RAID, you should use logical disk counters.</span></span> <span data-ttu-id="7ee37-212">逻辑磁盘和物理磁盘计数器，在每个计数器对象提供了相同的计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-212">As for Logical Disk and Physical Disk Counters, the same counters are available in each of these counter objects.</span></span> <span data-ttu-id="7ee37-213">逻辑磁盘数据跟踪的卷管理器 （或经理） 和物理磁盘数据跟踪的分区管理器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-213">Logical disk data is tracked by the volume manager (or managers), and physical disk data is tracked by the partition manager.</span></span>  
  
 <span data-ttu-id="7ee37-214">应使用以下性能计数器以确定您的系统是否遇到磁盘 I/O 相关的瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-214">The following performance counters should be used to determine if your system is experiencing a disk I/O related bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-215">**PhysicalDisk\Avg.磁盘队列长度**</span><span class="sxs-lookup"><span data-stu-id="7ee37-215">**PhysicalDisk\Avg. Disk Queue Length**</span></span>  
  
    -   <span data-ttu-id="7ee37-216">阈值：不应大于心轴数加两个。</span><span class="sxs-lookup"><span data-stu-id="7ee37-216">Threshold: Should not be higher than the number of spindles plus two.</span></span>  
  
    -   <span data-ttu-id="7ee37-217">重要性：此计数器指示的这两个读取的平均数目，并将采样间隔期间为所选磁盘排队的请求。</span><span class="sxs-lookup"><span data-stu-id="7ee37-217">Significance: This counter indicates the average number of both read and writes requests that were queued for the selected disk during the sample interval.</span></span> <span data-ttu-id="7ee37-218">此计数器可用于收集并发数据，包括数据激增，峰值负载。</span><span class="sxs-lookup"><span data-stu-id="7ee37-218">This counter is useful for gathering concurrency data, including data bursts and peak loads.</span></span> <span data-ttu-id="7ee37-219">这些值表示正在进行下面执行统计信息的驱动程序的请求数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-219">These values represent the number of requests in flight below the driver taking the statistics.</span></span> <span data-ttu-id="7ee37-220">这意味着请求不一定排队，但实际上可能是在服务中或已完成并的方式将备份路径。</span><span class="sxs-lookup"><span data-stu-id="7ee37-220">This means the requests are not necessarily queued but could actually be in service or completed and on the way back up the path.</span></span> <span data-ttu-id="7ee37-221">可能正在进行的位置包括：</span><span class="sxs-lookup"><span data-stu-id="7ee37-221">Possible in-flight locations include the following:</span></span>  
  
        -   <span data-ttu-id="7ee37-222">SCSIport 或 Storport 队列</span><span class="sxs-lookup"><span data-stu-id="7ee37-222">SCSIport or Storport queue</span></span>  
  
        -   <span data-ttu-id="7ee37-223">OEM 驱动程序队列</span><span class="sxs-lookup"><span data-stu-id="7ee37-223">OEM driver queue</span></span>  
  
        -   <span data-ttu-id="7ee37-224">磁盘控制器队列</span><span class="sxs-lookup"><span data-stu-id="7ee37-224">Disk controller queue</span></span>  
  
        -   <span data-ttu-id="7ee37-225">硬盘队列</span><span class="sxs-lookup"><span data-stu-id="7ee37-225">Hard disk queue</span></span>  
  
        -   <span data-ttu-id="7ee37-226">主动接收从硬盘</span><span class="sxs-lookup"><span data-stu-id="7ee37-226">Actively receiving from a hard disk</span></span>  
  
-   <span data-ttu-id="7ee37-227">**PhysicalDisk\Avg.磁盘读取队列长度**</span><span class="sxs-lookup"><span data-stu-id="7ee37-227">**PhysicalDisk\Avg. Disk Read Queue Length**</span></span>  
  
    -   <span data-ttu-id="7ee37-228">阈值：应为不超过两个。</span><span class="sxs-lookup"><span data-stu-id="7ee37-228">Threshold: Should be less than two.</span></span>  
  
    -   <span data-ttu-id="7ee37-229">重要性：此计数器指示在采样间隔期间为所选磁盘排队的读取请求的平均数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-229">Significance: This counter indicates the average number of read requests that were queued for the selected disk during the sample interval.</span></span>  
  
-   <span data-ttu-id="7ee37-230">**PhysicalDisk\Avg.磁盘写入队列长度**</span><span class="sxs-lookup"><span data-stu-id="7ee37-230">**PhysicalDisk\Avg. Disk Write Queue Length**</span></span>  
  
    -   <span data-ttu-id="7ee37-231">阈值：应为不超过两个。</span><span class="sxs-lookup"><span data-stu-id="7ee37-231">Threshold: Should be less than two.</span></span>  
  
    -   <span data-ttu-id="7ee37-232">重要性：此计数器指示在采样间隔期间为所选磁盘排队的写入请求的平均数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-232">Significance: This counter indicates the average number of write requests that were queued for the selected disk during the sample interval.</span></span>  
  
-   <span data-ttu-id="7ee37-233">**PhysicalDisk\Avg.Disk sec/Read**</span><span class="sxs-lookup"><span data-stu-id="7ee37-233">**PhysicalDisk\Avg. Disk sec/Read**</span></span>  
  
    -   <span data-ttu-id="7ee37-234">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-234">Threshold: No specific value.</span></span>  
  
        -   <span data-ttu-id="7ee37-235">小于 10 毫秒 (ms) = 状态良好</span><span class="sxs-lookup"><span data-stu-id="7ee37-235">Less than 10 milliseconds (ms) = good</span></span>  
  
        -   <span data-ttu-id="7ee37-236">15 和 25 毫秒之间 = 公平</span><span class="sxs-lookup"><span data-stu-id="7ee37-236">Between 15 and 25 ms = fair</span></span>  
  
        -   <span data-ttu-id="7ee37-237">大于 25 毫秒 = 差</span><span class="sxs-lookup"><span data-stu-id="7ee37-237">Greater than 25 ms = poor</span></span>  
  
    -   <span data-ttu-id="7ee37-238">重要性：此计数器表示的平均时间，以秒为单位从磁盘读取操作的数据。</span><span class="sxs-lookup"><span data-stu-id="7ee37-238">Significance: This counter indicates the average time, in seconds, of a data read operation from the disk.</span></span> <span data-ttu-id="7ee37-239">如果数字大于 25 毫秒 (ms)，这意味着磁盘系统从磁盘读取时遇到延迟。</span><span class="sxs-lookup"><span data-stu-id="7ee37-239">If the number is larger than 25 milliseconds (ms), that means the disk system is experiencing latency when reading from the disk.</span></span> <span data-ttu-id="7ee37-240">对于关键任务服务器承载 BizTalk Server，可接受的阈值是低得多，大约 10 毫秒。</span><span class="sxs-lookup"><span data-stu-id="7ee37-240">For mission-critical servers hosting BizTalk Server, the acceptable threshold is much lower, approximately 10 ms.</span></span>  
  
-   <span data-ttu-id="7ee37-241">**PhysicalDisk\Avg.Disk sec/Write**</span><span class="sxs-lookup"><span data-stu-id="7ee37-241">**PhysicalDisk\Avg. Disk sec/Write**</span></span>  
  
    -   <span data-ttu-id="7ee37-242">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-242">Threshold: No specific value.</span></span>  
  
        -   <span data-ttu-id="7ee37-243">小于 10 毫秒 (ms) = 状态良好</span><span class="sxs-lookup"><span data-stu-id="7ee37-243">Less than 10 milliseconds (ms) = good</span></span>  
  
        -   <span data-ttu-id="7ee37-244">15 和 25 毫秒之间 = 公平</span><span class="sxs-lookup"><span data-stu-id="7ee37-244">Between 15 and 25 ms = fair</span></span>  
  
        -   <span data-ttu-id="7ee37-245">大于 25 毫秒 = 差</span><span class="sxs-lookup"><span data-stu-id="7ee37-245">Greater than 25 ms = poor</span></span>  
  
    -   <span data-ttu-id="7ee37-246">重要性：此计数器表示的平均时间，以秒为单位，数据的向磁盘写入操作。</span><span class="sxs-lookup"><span data-stu-id="7ee37-246">Significance: This counter indicates the average time, in seconds, of a data write operation to the disk.</span></span> <span data-ttu-id="7ee37-247">如果数字大于 25 ms，磁盘系统发生了延迟时写入的磁盘。</span><span class="sxs-lookup"><span data-stu-id="7ee37-247">If the number is larger than 25 ms, the disk system experiences latency when writing to the disk.</span></span> <span data-ttu-id="7ee37-248">对于关键任务服务器承载 BizTalk Server，可接受的阈值是低得多，大约 10 毫秒。</span><span class="sxs-lookup"><span data-stu-id="7ee37-248">For mission-critical servers hosting BizTalk Server, the acceptable threshold is much lower, approximately 10 ms.</span></span>  
  
-   <span data-ttu-id="7ee37-249">**PhysicalDisk\Avg.Disk sec/Transfer**</span><span class="sxs-lookup"><span data-stu-id="7ee37-249">**PhysicalDisk\Avg. Disk sec/Transfer**</span></span>  
  
    -   <span data-ttu-id="7ee37-250">阈值：不应超过 18 个毫秒为单位。</span><span class="sxs-lookup"><span data-stu-id="7ee37-250">Threshold: Should not be more than 18 milliseconds.</span></span>  
  
    -   <span data-ttu-id="7ee37-251">重要性：此计数器表示的时间，以秒为单位的平均磁盘传输的。</span><span class="sxs-lookup"><span data-stu-id="7ee37-251">Significance: This counter indicates the time, in seconds, of the average disk transfer.</span></span> <span data-ttu-id="7ee37-252">这可能指示大量的磁盘碎片、 慢速磁盘或磁盘故障。</span><span class="sxs-lookup"><span data-stu-id="7ee37-252">This may indicate a large amount of disk fragmentation, slow disks, or disk failures.</span></span> <span data-ttu-id="7ee37-253">将的值相乘**Physical disk\avg.Disk sec/Transfer**并**Memory\Pages/sec**计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-253">Multiply the values of the **Physical Disk\Avg. Disk sec/Transfer** and **Memory\Pages/sec** counters.</span></span> <span data-ttu-id="7ee37-254">如果这些计数器的乘积超过 0.1，表示分页占用了超过 10%的磁盘访问时间，因此您需要更多的物理内存可用。</span><span class="sxs-lookup"><span data-stu-id="7ee37-254">If the product of these counters exceeds 0.1, paging is taking more than 10 percent of disk access time, so you need more physical memory available.</span></span>  
  
-   <span data-ttu-id="7ee37-255">**PhysicalDisk\Disk Writes/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-255">**PhysicalDisk\Disk Writes/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-256">阈值：依赖于制造商的规范。</span><span class="sxs-lookup"><span data-stu-id="7ee37-256">Threshold: Depends on manufacturer’s specifications.</span></span>  
  
    -   <span data-ttu-id="7ee37-257">重要性：此计数器表示磁盘上的写入操作的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-257">Significance: This counter indicates the rate of write operations on the disk.</span></span>  
  
-   <span data-ttu-id="7ee37-258">**处理器\\%DPC Time、 %Interrupt Time 和 %Privileged Time-** 如果 Interrupt Time 和延迟过程调用 (DPC) 时间会有很大一部分 Privileged Time、 内核花费大量时间处理 I/O 请求。</span><span class="sxs-lookup"><span data-stu-id="7ee37-258">**Processor\\% DPC Time, % Interrupt Time and % Privileged Time -** If Interrupt Time and Deferred Procedure Call (DPC) time are a large portion of Privileged Time, the kernel is spending a significant amount of time processing I/O requests.</span></span> <span data-ttu-id="7ee37-259">在某些情况下，通过在多处理器系统上配置中断和 DPC 关联为很小的 Cpu 可以提高性能，这可以提高缓存区域。</span><span class="sxs-lookup"><span data-stu-id="7ee37-259">In some cases performance can be improved by configuring interrupts and DPC affinity to a small number of CPUs on a multiprocessor system, which improves cache locality.</span></span> <span data-ttu-id="7ee37-260">在其他情况下，它最适合分配中断和 Dpc 在多个 Cpu，以便防止中断和 DPC 活动成为性能瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-260">In other cases, it works best to distribute the interrupts and DPCs among many CPUs, so as to keep the interrupt and DPC activity from becoming a bottleneck.</span></span> <span data-ttu-id="7ee37-261">使用中断筛选器配置工具以将网络适配器中断绑定到多处理器计算机上的特定处理器的信息，请参阅"使用中断筛选器配置工具以将网络适配器中断绑定到特定的部分多处理器计算机上的"中处理器[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-261">For information on using the Interrupt Filter Configuration tool to bind network adapter interrupts to specific processors on multiprocessor computers, see the section “Use the Interrupt Filter Configuration tool to bind network adapter interrupts to specific processors on multiprocessor computers” in [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-262">**Processor\DPCs 排队数 / 秒-** 测量如何 Dpc 正在占用 CPU 时间和内核资源。</span><span class="sxs-lookup"><span data-stu-id="7ee37-262">**Processor\DPCs Queued / sec -** Measures how DPCs are consuming CPU time and kernel resources.</span></span>  
  
-   <span data-ttu-id="7ee37-263">**Processor\Interrupts 数 / 秒-** 另一个度量值的方式中断正在占用 CPU 时间和内核资源。</span><span class="sxs-lookup"><span data-stu-id="7ee37-263">**Processor\Interrupts / sec -** Another measurement of how interrupts are consuming CPU time and kernel resources.</span></span> <span data-ttu-id="7ee37-264">现代的磁盘控制器通常组合或 coalesce 中断，以便单个中断导致的多个 I/O 完成处理。</span><span class="sxs-lookup"><span data-stu-id="7ee37-264">Modern disk controllers often combine or coalesce interrupts so that a single interrupt results in the processing of multiple I/O completions.</span></span> <span data-ttu-id="7ee37-265">当然，没有延迟中断 （和完成项） 和 economizing CPU 处理时间之间进行权衡。</span><span class="sxs-lookup"><span data-stu-id="7ee37-265">Of course, there is a trade-off between delaying interrupts (and thus completions) and economizing CPU processing time.</span></span>  
  
#### <a name="disk-io-tuning-options"></a><span data-ttu-id="7ee37-266">磁盘 I/O 优化选项</span><span class="sxs-lookup"><span data-stu-id="7ee37-266">Disk I/O tuning options</span></span>  
 <span data-ttu-id="7ee37-267">如果你确定磁盘 I/O 是您的环境中的瓶颈，可能使用以下方法来缓解瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-267">If you determine that disk I/O is a bottleneck in your environment, the following techniques may be used to alleviate the bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-268">**对你的磁盘-进行碎片整理**使用在可用[PageDefrag 实用程序](http://go.microsoft.com/fwlink/?LinkId=108976)(http://go.microsoft.com/fwlink/?LinkId=108976)进行碎片整理 Windows 分页文件和预分配主文件表。</span><span class="sxs-lookup"><span data-stu-id="7ee37-268">**Defragment your disks -** Use the available at [PageDefrag utility](http://go.microsoft.com/fwlink/?LinkId=108976) (http://go.microsoft.com/fwlink/?LinkId=108976) to defragment the Windows paging file and pre-allocate the Master File Tables.</span></span>  
  
-   <span data-ttu-id="7ee37-269">**使用条带集的多个磁盘的同时处理 I/O 请求**使用镜像的卷提供容错并提高 I/O 性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-269">**Use stripe sets to process I/O requests concurrently over multiple disks -** Use mirrored volumes to provide fault tolerance and increase I/O performance.</span></span> <span data-ttu-id="7ee37-270">如果不需要容错能力，用于实现带区集快速读取和写入和改进的存储容量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-270">If you do not require fault tolerance, implement stripe sets for fast reading and writing and improved storage capacity.</span></span> <span data-ttu-id="7ee37-271">当使用带区集时，每个磁盘利用率被减少，因为工作分布在卷，并增加整体吞吐量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-271">When stripe sets are used, per disk utilization is reduced because work is distributed across the volumes, and overall throughput increases.</span></span> <span data-ttu-id="7ee37-272">如果您根据需要添加更多的磁盘的条带中设置您的系统可能会遇到瓶颈，因为由磁盘控制器的磁盘之间的争用则不会增加吞吐量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-272">If you adding additional disks in a stripe set does not increase throughput, then your system might be experiencing a bottleneck due to contention between disks by the disk controller.</span></span> <span data-ttu-id="7ee37-273">在这种情况下，将添加一个额外的磁盘控制器将有助于分散负载并提高性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-273">In this case, adding an additional disk controller will help distribute load and increase performance.</span></span>  
  
-   <span data-ttu-id="7ee37-274">**将分发在多个驱动器的工作负荷**Windows 群集和分布式文件系统提供的多个磁盘驱动器进行负载均衡解决方案。</span><span class="sxs-lookup"><span data-stu-id="7ee37-274">**Distribute workload among multiple drives -** Windows Clustering and Distributed File System provide solutions for load balancing on multiple disk drives.</span></span>  
  
-   <span data-ttu-id="7ee37-275">**限制使用文件压缩或加密-** 文件压缩和加密是 O 密集型操作。</span><span class="sxs-lookup"><span data-stu-id="7ee37-275">**Limit the use of file compression or encryption -** File compression and encryption are I/O-intensive operations.</span></span> <span data-ttu-id="7ee37-276">仅应使用它们在绝对必要时。</span><span class="sxs-lookup"><span data-stu-id="7ee37-276">You should only use them where absolutely necessary.</span></span>  
  
-   <span data-ttu-id="7ee37-277">**禁用的短名称-创建**如果你不支持 MS-DOS 的 Windows 3.x 客户端，则禁用短名称，以提高性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-277">**Disable creation of short names -** If you are not supporting MS-DOS for Windows 3.x clients, disable short names to improve performance.</span></span> <span data-ttu-id="7ee37-278">有关禁用的短名称创建的详细信息，请参阅"禁用短文件名 (8.3) 生成"一节中[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-278">For more information about disabling the creation of short names, see the section “Disable short-file-name (8.3) generation” in [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-279">**禁用最后一次访问更新-** 默认情况下，NTFS 更新目录的上次访问日期和时间戳，每当该代码遍历目录。</span><span class="sxs-lookup"><span data-stu-id="7ee37-279">**Disable last access update -** By default, NTFS updates the date and time stamp of the last access on directories whenever it traverses the directory.</span></span> <span data-ttu-id="7ee37-280">对于大型的 NTFS 卷，此更新过程可能会降低性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-280">For a large NTFS volume, this update process may hinder performance.</span></span> <span data-ttu-id="7ee37-281">有关禁用上次访问更新的详细信息，请参阅部分中的"禁用 NTFS 上次访问更新"[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-281">For more information about disabling last access updates, see the section “Disable NTFS last access updates” in [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="7ee37-282">某些应用程序，例如增量备份实用程序，依赖于 NTFS 更新信息并没有它将无法正常工作。</span><span class="sxs-lookup"><span data-stu-id="7ee37-282">Some applications, such as incremental backup utilities, rely on the NTFS update information and will not function correctly without it.</span></span>  
  
-   <span data-ttu-id="7ee37-283">**保留相应的主文件表中的空间**外**NtfsMftZoneReservation**具体通常存储在 NTFS 卷的文件数取决于注册表项。</span><span class="sxs-lookup"><span data-stu-id="7ee37-283">**Reserve appropriate space for the master file table -** Add the **NtfsMftZoneReservation** entry to the registry depending on the number of files that are typically stored on your NTFS volumes.</span></span> <span data-ttu-id="7ee37-284">时将此条目添加到注册表时，系统将保留主文件表的卷上的空间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-284">When you add this entry to the registry, the system reserves space on the volume for the master file table.</span></span> <span data-ttu-id="7ee37-285">保留空间以这种方式允许以最佳方式增长的主文件表。</span><span class="sxs-lookup"><span data-stu-id="7ee37-285">Reserving space in this manner allows the master file table to grow optimally.</span></span> <span data-ttu-id="7ee37-286">如果你的 NTFS 卷通常存储相对几个文件，将此注册表项的值设置为默认值为 1。</span><span class="sxs-lookup"><span data-stu-id="7ee37-286">If your NTFS volumes generally store relatively few files, set the value of this registry entry to the default value of 1.</span></span> <span data-ttu-id="7ee37-287">通常，如果 NTFS 卷存储适中数量的文件，并使用值为 4 （最大），如果 NTFS 卷往往包含相对较大文件数，您可以使用值为 2 或 3。</span><span class="sxs-lookup"><span data-stu-id="7ee37-287">Typically you can use a value of 2 or 3 if your NTFS volumes store a moderate numbers of files, and use a value of 4 (the maximum) if your NTFS volumes tend to contain a relatively large number of files.</span></span> <span data-ttu-id="7ee37-288">但是，请确保用于测试大于 2，任何设置，因为这些更高的值会导致系统保留更大一部分的主文件表的磁盘。</span><span class="sxs-lookup"><span data-stu-id="7ee37-288">However, make sure to test any settings greater than 2, because these greater values cause the system to reserve a much larger portion of the disk for the master file table.</span></span> <span data-ttu-id="7ee37-289">有关添加详细信息**NtfsMftZoneReservation**到注册表，请参阅部分"增加中的可用空间的主文件表"[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-289">For more information about adding the **NtfsMftZoneReservation** to the registry, see the section “Increase space available for the master file table” in [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-290">**使用可用的最有效的磁盘系统**除了使用的物理磁盘，请考虑将使用的磁盘控制器和电缆线路类型。</span><span class="sxs-lookup"><span data-stu-id="7ee37-290">**Use the most efficient disk systems available -** In addition to the physical disk that is used, consider the type of disk controller and cabling that will be used.</span></span> <span data-ttu-id="7ee37-291">有效的磁盘子系统还应提供支持中断裁决或中断避免来缓解引起的磁盘 I/O 处理器中断活动的驱动程序。</span><span class="sxs-lookup"><span data-stu-id="7ee37-291">An efficient disk subsystem should also provide drivers that support interrupt moderation or interrupt avoidance to mitigate processor interrupt activity caused by disk I/O.</span></span>  
  
-   <span data-ttu-id="7ee37-292">**确保使用适当的 RAID 配置-** 使用 RAID 10 （条带化和镜像） 的最佳性能和容错能力。</span><span class="sxs-lookup"><span data-stu-id="7ee37-292">**Ensure that you are using the appropriate RAID configuration -** Use RAID 10 (striping and mirroring) for optimal performance and fault tolerance.</span></span> <span data-ttu-id="7ee37-293">其不利的一面是，使用 RAID 10 是昂贵。</span><span class="sxs-lookup"><span data-stu-id="7ee37-293">The tradeoff is that using RAID 10 is expensive.</span></span> <span data-ttu-id="7ee37-294">避免使用 RAID 5 具有大量写入操作时。</span><span class="sxs-lookup"><span data-stu-id="7ee37-294">Avoid using RAID 5 when you have extensive write operations.</span></span> <span data-ttu-id="7ee37-295">有关在 BizTalk Server 环境中实现 RAID 的详细信息，请参阅"磁盘基础结构"一节中[BizTalk Server 数据库优化白皮书](http://go.microsoft.com/fwlink/?LinkID=101578)(http://go.microsoft.com/fwlink/?LinkID=101578)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-295">For more information about implementing RAID in a BizTalk Server environment, see the section “Disk Infrastructure” in the [BizTalk Server Database Optimization white paper](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578).</span></span>  
  
-   <span data-ttu-id="7ee37-296">**请考虑使用数据库分区-** 如果数据库瓶颈，请考虑使用数据库的分区，并将磁盘映射到特定的表和事务日志。</span><span class="sxs-lookup"><span data-stu-id="7ee37-296">**Consider using database partitions -** If you have a database bottleneck, consider using database partitions and mapping disks to specific tables and transaction logs.</span></span> <span data-ttu-id="7ee37-297">分区的主要目的是解决大型表的磁盘瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-297">The primary purpose of partitions is to overcome disk bottlenecks for large tables.</span></span> <span data-ttu-id="7ee37-298">如果具有大量的行的表，并且你确定它是瓶颈的根源，请考虑使用分区。</span><span class="sxs-lookup"><span data-stu-id="7ee37-298">If you have a table with large number of rows and you determine that it is the source of a bottleneck, consider using partitions.</span></span> <span data-ttu-id="7ee37-299">对于 SQL Server，可以使用文件组来提高 I/O 性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-299">For SQL Server, you can use file groups to improve I/O performance.</span></span> <span data-ttu-id="7ee37-300">可以将表与文件组相关联，然后将文件组具有特定硬盘相关联。</span><span class="sxs-lookup"><span data-stu-id="7ee37-300">You can associate tables with file groups, and then associate the file groups with a specific hard disk.</span></span> <span data-ttu-id="7ee37-301">有关使用 BizTalk Server 数据库的优化文件组的详细信息，请参阅[优化文件组的数据库](~/technical-guides/optimizing-filegroups-for-the-databases2.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-301">For more information about using optimizing filegroups for the BizTalk Server databases, see [Optimizing Filegroups for the Databases](~/technical-guides/optimizing-filegroups-for-the-databases2.md).</span></span>  
  
-   <span data-ttu-id="7ee37-302">**请考虑添加物理内存，如果有过多的页面错误-** 的较高值**内存：每秒页数**性能计数器表示这会增加磁盘过多分页我 / 0。</span><span class="sxs-lookup"><span data-stu-id="7ee37-302">**Consider adding physical memory, if you have excessive page faults -** A high value for the **Memory: Pages/sec** performance counter could indicate excessive paging which will increase disk I/0.</span></span> <span data-ttu-id="7ee37-303">如果发生这种情况，请考虑添加物理内存来减少磁盘 I/O 和提高性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-303">If this occurs, consider adding physical memory to reduce disk I/O and increase performance.</span></span>  
  
-   <span data-ttu-id="7ee37-304">**请考虑使用更高版本的 RPM 评估或使用存储区域网络 (SAN) 中使用的磁盘设备-** RPM 评级更高的磁盘提供改进的性能与较低的 RPM 分级对磁盘进行比较。</span><span class="sxs-lookup"><span data-stu-id="7ee37-304">**Consider using a disk with a higher RPM rating or using a Storage Area Network (SAN) device -** Disks with higher RPM ratings offer improved performance compared to disks with lower RPM ratings.</span></span> <span data-ttu-id="7ee37-305">SAN 设备通常提供顶层的性能，但在价格优惠。</span><span class="sxs-lookup"><span data-stu-id="7ee37-305">SAN devices typically offer top tier performance but at a price premium.</span></span>  
  
-   <span data-ttu-id="7ee37-306">请按照中的建议[优化数据库性能](~/technical-guides/optimizing-database-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-306">Follow the recommendations in [Optimizing Database Performance](~/technical-guides/optimizing-database-performance.md).</span></span> <span data-ttu-id="7ee37-307">本主题提供有关优化数据库性能之前和之后配置 BizTalk Server 的多个建议。</span><span class="sxs-lookup"><span data-stu-id="7ee37-307">This topic provides several recommendations for optimizing database performance both before and after configuring BizTalk Server.</span></span>  
  
### <a name="cpu-bottlenecks"></a><span data-ttu-id="7ee37-308">CPU 瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-308">CPU bottlenecks</span></span>  
 <span data-ttu-id="7ee37-309">在服务器运行每个应用程序获取 CPU 时间的切片。</span><span class="sxs-lookup"><span data-stu-id="7ee37-309">Each application that runs on a server gets a time slice of the CPU.</span></span> <span data-ttu-id="7ee37-310">CPU 可能能够有效地处理所有的计算机上，运行的进程或可能超载。</span><span class="sxs-lookup"><span data-stu-id="7ee37-310">The CPU might be able to efficiently handle all of the processes running on the computer, or it might be overloaded.</span></span> <span data-ttu-id="7ee37-311">通过检查处理器活动和活动的单独进程包括创建线程、 线程切换和上下文切换，您可以深入了解处理器工作负荷和性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-311">By examining processor activity and the activity of individual processes including thread creation, thread switching and context switching, you can gain insight into processor workload and performance.</span></span>  
  
#### <a name="you-may-have-a-cpu-bottleneck-if"></a><span data-ttu-id="7ee37-312">如果，可能出现了 CPU 瓶颈...</span><span class="sxs-lookup"><span data-stu-id="7ee37-312">You may have a CPU bottleneck if…</span></span>  
  
-   <span data-ttu-id="7ee37-313">值**处理器\\%Processor Time**性能计数器通常超过 75%。</span><span class="sxs-lookup"><span data-stu-id="7ee37-313">The value of the **Processor\\% Processor Time** performance counter often exceeds 75%.</span></span>  
  
-   <span data-ttu-id="7ee37-314">值**System\ Processor Queue Length**性能计数器为 2 或更多的时间段。</span><span class="sxs-lookup"><span data-stu-id="7ee37-314">The value of the **System\ Processor Queue Length** performance counter is 2 or more for a sustained period of time.</span></span>  
  
-   <span data-ttu-id="7ee37-315">值**处理器\\%特权时间**或**System\Context Switches/sec**都非常高的性能计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-315">The value of the **Processor\\% Privileged Time** or **System\Context Switches/sec** performance counters are unusually high.</span></span>  
  
     <span data-ttu-id="7ee37-316">如果的值**Processor\ %Processor Time**性能计数器值较高，则会出现队列，并在大多数情况下的值**System\ Processor Queue Length**也很高。</span><span class="sxs-lookup"><span data-stu-id="7ee37-316">If the value of **Processor\ % Processor Time** performance counter is high, then queuing occurs, and in most scenarios the value of **System\ Processor Queue Length** will also be high.</span></span>  
  
#### <a name="performance-counters-for-measuring-cpu-bottlenecks"></a><span data-ttu-id="7ee37-317">用于测量 CPU 瓶颈的性能计数器</span><span class="sxs-lookup"><span data-stu-id="7ee37-317">Performance counters for measuring CPU bottlenecks</span></span>  
 <span data-ttu-id="7ee37-318">应使用以下性能计数器以确定您的系统是否遇到 CPU 相关的瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-318">The following performance counters should be used to determine if your system is experiencing a CPU related bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-319">**处理器\\处理器时间百分比**</span><span class="sxs-lookup"><span data-stu-id="7ee37-319">**Processor\\% Processor Time**</span></span>  
  
    -   <span data-ttu-id="7ee37-320">阈值：应为小于 85%。</span><span class="sxs-lookup"><span data-stu-id="7ee37-320">Threshold: Should be less than 85%.</span></span>  
  
    -   <span data-ttu-id="7ee37-321">重要性：此计数器是处理器活动的主要指示器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-321">Significance: This counter is the primary indicator of processor activity.</span></span> <span data-ttu-id="7ee37-322">很多的较高值不一定是错误。</span><span class="sxs-lookup"><span data-stu-id="7ee37-322">High values many not necessarily be bad.</span></span> <span data-ttu-id="7ee37-323">但是，如果越来越多的其他与处理器相关的计数器以线性方式如下所述**处理器\\%特权时间**或**System\Processor Queue Length**，高 CPU 利用率可能值得调查。</span><span class="sxs-lookup"><span data-stu-id="7ee37-323">However, if the other processor-related counters are increasing linearly such as **Processor\\% Privileged Time** or **System\Processor Queue Length**, high CPU utilization may be worth investigating.</span></span>  
  
-   <span data-ttu-id="7ee37-324">**处理器\\%特权时间**</span><span class="sxs-lookup"><span data-stu-id="7ee37-324">**Processor\\% Privileged Time**</span></span>  
  
    -   <span data-ttu-id="7ee37-325">阈值：始终大于 75%图指示了瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-325">Threshold: A figure that is consistently over 75 percent indicates a bottleneck.</span></span>  
  
    -   <span data-ttu-id="7ee37-326">重要性：此计数器指示线程在特权模式下运行的时间的百分比。</span><span class="sxs-lookup"><span data-stu-id="7ee37-326">Significance: This counter indicates the percentage of time a thread runs in privileged mode.</span></span> <span data-ttu-id="7ee37-327">当你的应用程序调用时 （例如，可执行文件或网络 I/O 或分配内存） 的操作系统功能时，这些操作系统函数在特权模式下执行。</span><span class="sxs-lookup"><span data-stu-id="7ee37-327">When your application calls operating system functions (for example to perform file or network I/O or to allocate memory), these operating system functions are executed in privileged mode.</span></span>  
  
-   <span data-ttu-id="7ee37-328">**处理器\\中断时间百分比**</span><span class="sxs-lookup"><span data-stu-id="7ee37-328">**Processor\\% Interrupt Time**</span></span>  
  
    -   <span data-ttu-id="7ee37-329">阈值：取决于处理器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-329">Threshold: Depends on the processor.</span></span>  
  
    -   <span data-ttu-id="7ee37-330">重要性：此计数器表示处理器用于接收和服务硬件中断的时间百分比。</span><span class="sxs-lookup"><span data-stu-id="7ee37-330">Significance: This counter indicates the percentage of time the processor spends receiving and servicing hardware interrupts.</span></span> <span data-ttu-id="7ee37-331">此值是活动的生成中断，例如网络适配器的设备的间接指示器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-331">This value is an indirect indicator of the activity of devices that generate interrupts, such as network adapters.</span></span> <span data-ttu-id="7ee37-332">显著提高此计数器指示潜在硬件问题。</span><span class="sxs-lookup"><span data-stu-id="7ee37-332">A dramatic increase in this counter indicates potential hardware problems.</span></span>  
  
-   <span data-ttu-id="7ee37-333">**System\Processor Queue Length**</span><span class="sxs-lookup"><span data-stu-id="7ee37-333">**System\Processor Queue Length**</span></span>  
  
    -   <span data-ttu-id="7ee37-334">阈值：平均值始终高于 2 指示瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-334">Threshold: An average value consistently higher than 2 indicates a bottleneck.</span></span>  
  
    -   <span data-ttu-id="7ee37-335">重要性：如果有更多的任务准备好运行比处理器，线程排队等候。</span><span class="sxs-lookup"><span data-stu-id="7ee37-335">Significance: If there are more tasks ready to run than there are processors, threads queue up.</span></span> <span data-ttu-id="7ee37-336">处理器队列是准备就绪，但不能由处理器执行，因为另一个线程当前正在执行的线程的集合。</span><span class="sxs-lookup"><span data-stu-id="7ee37-336">The processor queue is the collection of threads that are ready but not able to be executed by the processor because another thread is currently executing.</span></span> <span data-ttu-id="7ee37-337">两个以上的线程的持续或重复发生队列是明确表示处理器瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-337">A sustained or recurring queue of more than two threads is a clear indication of a processor bottleneck.</span></span> <span data-ttu-id="7ee37-338">通过减少并行度，在这些情况下，可能会收到更大的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-338">You may get more throughput by reducing parallelism in those cases.</span></span>  
  
         <span data-ttu-id="7ee37-339">可以结合使用此计数器**处理器\\%Processor Time**计数器以确定你的应用程序可以受益更多的 Cpu。</span><span class="sxs-lookup"><span data-stu-id="7ee37-339">You can use this counter in conjunction with the **Processor\\% Processor Time** counter to determine if your application can benefit from more CPUs.</span></span> <span data-ttu-id="7ee37-340">没有单个队列的处理器时间，即使在多处理器计算机上。</span><span class="sxs-lookup"><span data-stu-id="7ee37-340">There is a single queue for processor time, even on multiprocessor computers.</span></span> <span data-ttu-id="7ee37-341">因此，在多处理器计算机中，除以处理器队列长度 (PQL) 值的处理工作负载的处理器数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-341">Therefore, in a multiprocessor computer, divide the Processor Queue Length (PQL) value by the number of processors servicing the workload.</span></span>  
  
         <span data-ttu-id="7ee37-342">如果 CPU 非常忙 （90%或更高的利用率） 且 PQL 平均值高于一致地为每个处理器的 2，可能存在处理器瓶颈，可受益于添加 Cpu。</span><span class="sxs-lookup"><span data-stu-id="7ee37-342">If the CPU is very busy (90 percent or higher utilization) and the PQL average is consistently higher than 2 per processor, you may have a processor bottleneck that could benefit from adding CPUs.</span></span> <span data-ttu-id="7ee37-343">或者，你可能会减少线程和队列应用程序级别的更多的数量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-343">Or, you could reduce the number of threads and queue more at the application level.</span></span> <span data-ttu-id="7ee37-344">这会减少上下文切换中，适用于减少 CPU 负载，从而减少上下文切换。</span><span class="sxs-lookup"><span data-stu-id="7ee37-344">This will cause less context switching, and less context switching is good for reducing CPU load.</span></span> <span data-ttu-id="7ee37-345">PQL 值为 2 或更高 CPU 使用率低下的常见原因是对处理器时间的请求到达随机和线程需要不定期大量处理器时间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-345">A common reason for a PQL value of 2 or higher with low CPU utilization is that requests for processor time arrive randomly and threads demand irregular amounts of time from the processor.</span></span> <span data-ttu-id="7ee37-346">这意味着处理器不是瓶颈，但应改进应用程序的线程逻辑。</span><span class="sxs-lookup"><span data-stu-id="7ee37-346">This means that the processor is not a bottleneck but that the application threading logic should be improved.</span></span>  
  
-   <span data-ttu-id="7ee37-347">**System\Context Switches/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-347">**System\Context Switches/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-348">阈值：作为一般规则，上下文切换速率小于每个处理器每秒 5,000 是不值得担心。</span><span class="sxs-lookup"><span data-stu-id="7ee37-348">Threshold: As a general rule, a context switching rate less than 5,000 per second per processor is not worth worrying about.</span></span> <span data-ttu-id="7ee37-349">如果上下文切换的速率超过 15,000 每个处理器每秒，然后上下文切换可能成为瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-349">If context switching rates exceed 15,000 per second per processor, then context switching can become a bottleneck.</span></span>  
  
    -   <span data-ttu-id="7ee37-350">重要性：较高优先级线程抢先于较低的优先级线程当前正在运行或较高优先级的线程时阻止其他线程时，会发生上下文切换。</span><span class="sxs-lookup"><span data-stu-id="7ee37-350">Significance: Context switching occurs when a higher priority thread preempts a lower priority thread that is currently running or when a high priority thread blocks other threads.</span></span> <span data-ttu-id="7ee37-351">当多个线程共享相同的优先级别，会发生上下文切换的高级别。</span><span class="sxs-lookup"><span data-stu-id="7ee37-351">High levels of context switching can occur when many threads share the same priority level.</span></span> <span data-ttu-id="7ee37-352">这通常表示有过多的线程在系统上处理器的竞争。</span><span class="sxs-lookup"><span data-stu-id="7ee37-352">This often indicates that there are too many threads competing for the processors on the system.</span></span> <span data-ttu-id="7ee37-353">如果处理器利用率和上下文切换级别较低，这通常是指示线程被阻止。</span><span class="sxs-lookup"><span data-stu-id="7ee37-353">If both processor utilization and context switching levels are low, this is often an indication that threads are blocked.</span></span>  
  
#### <a name="resolving-cpu-bottlenecks"></a><span data-ttu-id="7ee37-354">解决 CPU 瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-354">Resolving CPU bottlenecks</span></span>  
 <span data-ttu-id="7ee37-355">第一步是确定哪些进程正在消耗过多的处理器时间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-355">The first step is to identify which process is consuming excessive processor time.</span></span> <span data-ttu-id="7ee37-356">使用 Windows**任务管理器**若要确定哪个进程正在消耗大量 CPU 通过查看**CPU**上的列**进程**页。</span><span class="sxs-lookup"><span data-stu-id="7ee37-356">Use Windows **Task Manager** to identify which process is consuming high levels of CPU by looking at the **CPU** column on the **Processes** page.</span></span> <span data-ttu-id="7ee37-357">您还可以通过监视来确定这**进程\\%Processor Time**性能监视器并选择你想要监视的进程中。</span><span class="sxs-lookup"><span data-stu-id="7ee37-357">You can also determine this by monitoring **Process\\%Processor Time** in Performance Monitor and selecting the processes you want to monitor.</span></span>  
  
 <span data-ttu-id="7ee37-358">确定哪些进程正在消耗过多的 CPU 时间的另一种功能强大的工具是 Visual Studio Team System Profiler 提供使用 Visual Studio Team System (VSTS) 套件。</span><span class="sxs-lookup"><span data-stu-id="7ee37-358">Another powerful tool for determining which processes are consuming excessive CPU time is the Visual Studio Team System Profiler that is available with the Visual Studio Team System (VSTS) suite.</span></span> <span data-ttu-id="7ee37-359">有关使用 Visual Studio Team System Profiler 的详细信息，请参阅 Visual Studio Team System 文档。</span><span class="sxs-lookup"><span data-stu-id="7ee37-359">For more information about using the Visual Studio Team System Profiler, see the Visual Studio Team System documentation.</span></span>  
  
 <span data-ttu-id="7ee37-360">确定你的 CPU 是瓶颈后有多个选项，包括以下：</span><span class="sxs-lookup"><span data-stu-id="7ee37-360">After you determine that your CPU is a bottleneck you have several options, including the following:</span></span>  
  
-   <span data-ttu-id="7ee37-361">如果有多线程应用程序，添加多个处理器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-361">Add multiple processors if you have multi-threaded applications.</span></span> <span data-ttu-id="7ee37-362">请考虑升级到更强大的处理器，如果你的应用程序是单线程。</span><span class="sxs-lookup"><span data-stu-id="7ee37-362">Consider upgrading to a more powerful processor if your application is single-threaded.</span></span>  
  
-   <span data-ttu-id="7ee37-363">如果发现上下文切换的速率很高，请考虑增加的处理器数之前减少您的进程的线程计数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-363">If you observe a high rate of context switching, consider reducing the thread count for your process before increasing the number of processors.</span></span>  
  
-   <span data-ttu-id="7ee37-364">分析和优化会导致高 CPU 使用率的应用程序。</span><span class="sxs-lookup"><span data-stu-id="7ee37-364">Analyze and tune the application that is causing high CPU utilization.</span></span> <span data-ttu-id="7ee37-365">可以通过使用 ADPLUS 实用程序来转储正在运行的进程，并使用 Windbg 分析原因。</span><span class="sxs-lookup"><span data-stu-id="7ee37-365">You can dump the running process by using the ADPLUS utility and analyze the cause by using Windbg.</span></span> <span data-ttu-id="7ee37-366">这些实用程序是 Windows 调试工具包的一部分。</span><span class="sxs-lookup"><span data-stu-id="7ee37-366">These utilities are part of the Windows debugging toolkit.</span></span> <span data-ttu-id="7ee37-367">您可以下载这些工具从[有关 Windows 调试工具](http://go.microsoft.com/fwlink/?LinkID=106624)(http://go.microsoft.com/fwlink/?LinkID=106624)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-367">You can download these tools from [Debugging Tools for Windows](http://go.microsoft.com/fwlink/?LinkID=106624) (http://go.microsoft.com/fwlink/?LinkID=106624).</span></span>  
  
-   <span data-ttu-id="7ee37-368">分析检测日志生成的应用程序隔离正在执行的时间的最长的子系统。</span><span class="sxs-lookup"><span data-stu-id="7ee37-368">Analyze the instrumentation log generated by your application to isolate the subsystem that is taking the maximum amount of time for execution.</span></span> <span data-ttu-id="7ee37-369">确定是否可能更有利比只优化 BizTalk Server 环境的代码评审。</span><span class="sxs-lookup"><span data-stu-id="7ee37-369">Determine whether a code review would be more beneficial than just tuning the BizTalk Server environment.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7ee37-370">尽管您可以通过更改应用程序的进程优先级级别**任务管理器**或从命令提示符下，通常应避免这样做。</span><span class="sxs-lookup"><span data-stu-id="7ee37-370">Although you can change the process priority level of an application by using **Task Manager** or from a command prompt, you should generally avoid doing so.</span></span>  
  
### <a name="memory-bottlenecks"></a><span data-ttu-id="7ee37-371">内存瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-371">Memory bottlenecks</span></span>  
 <span data-ttu-id="7ee37-372">评估时与内存相关的瓶颈，请考虑不必要的分配、 清理、 效率低且不适合缓存和状态管理机制。</span><span class="sxs-lookup"><span data-stu-id="7ee37-372">When evaluating memory-related bottlenecks, consider unnecessary allocations, inefficient clean up, and inappropriate caching and state management mechanisms.</span></span> <span data-ttu-id="7ee37-373">若要解决与内存相关的瓶颈，优化您的代码以消除这些问题，然后调整分配给你的应用程序的内存量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-373">To resolve memory-related bottlenecks, optimize your code to eliminate these issues and then tune the amount of memory allocated to your application(s).</span></span> <span data-ttu-id="7ee37-374">如果你确定在优化期间发生内存争用和分页过多，可能需要向服务器添加额外的物理内存。</span><span class="sxs-lookup"><span data-stu-id="7ee37-374">If you determine during tuning that memory contention and excessive paging are occurring, you may need to add additional physical memory to the server.</span></span> <span data-ttu-id="7ee37-375">内存不足会导致增加对的应用程序的虚拟地址空间与磁盘进行分页。</span><span class="sxs-lookup"><span data-stu-id="7ee37-375">Low memory leads to increased paging of an application's virtual address space to and from disk.</span></span> <span data-ttu-id="7ee37-376">如果分页变得过多，磁盘 I/O 将增加，并对总体系统性能产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="7ee37-376">If paging becomes excessive, disk I/O will increase and negatively impact overall system performance.</span></span>  
  
#### <a name="you-might-have-a-memory-bottleneck-if"></a><span data-ttu-id="7ee37-377">如果，则可能存在内存瓶颈...</span><span class="sxs-lookup"><span data-stu-id="7ee37-377">You might have a memory bottleneck if…</span></span>  
  
-   <span data-ttu-id="7ee37-378">值**Memory\Available MBytes**性能计数器较低，是由于系统内存限制或没有释放内存的应用程序。</span><span class="sxs-lookup"><span data-stu-id="7ee37-378">The value of the **Memory\Available MBytes** performance counter is low, either due to system memory limitations or an application that is not releasing memory.</span></span> <span data-ttu-id="7ee37-379">监视的值**进程 \ 工作集**运行每个进程的性能计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-379">Monitor the value of the **Process\Working Set** performance counter for each process that is running.</span></span> <span data-ttu-id="7ee37-380">如果值为**进程 \ 工作集**高即使进程未处于活动状态，这可能表示该过程没有释放内存，它应该保持。</span><span class="sxs-lookup"><span data-stu-id="7ee37-380">If value of the **Process\Working Set** remains high even when the process is not active, this may be an indication that the process is not releasing memory as it should.</span></span>  
  
-   <span data-ttu-id="7ee37-381">值**Memory\Pages/sec**性能计数器值较高。</span><span class="sxs-lookup"><span data-stu-id="7ee37-381">The value of the **Memory\Pages/sec** performance counter is high.</span></span> <span data-ttu-id="7ee37-382">平均值**Memory\Pages Input/sec**除以的平均值**Memory\Page Reads/sec**提供的每磁盘读取的页数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-382">The average of **Memory\Pages Input/sec** divided by average of **Memory\Page Reads/sec** gives the number of pages per disk read.</span></span> <span data-ttu-id="7ee37-383">此值不应通常超过每秒 5 个页面。</span><span class="sxs-lookup"><span data-stu-id="7ee37-383">This value should not generally exceed five pages per second.</span></span> <span data-ttu-id="7ee37-384">大于每秒 5 个页面的值指示系统花费太多时间分页，并且需要更多的内存 （假设已优化应用程序）。</span><span class="sxs-lookup"><span data-stu-id="7ee37-384">A value greater than five pages per second indicates that the system is spending too much time paging and requires more memory (assuming that the application has been optimized).</span></span>  
  
#### <a name="performance-counters-for-measuring-memory-bottlenecks"></a><span data-ttu-id="7ee37-385">用于测量内存瓶颈的性能计数器</span><span class="sxs-lookup"><span data-stu-id="7ee37-385">Performance counters for measuring memory bottlenecks</span></span>  
 <span data-ttu-id="7ee37-386">应使用以下性能计数器以确定您的系统是否遇到内存相关的瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-386">The following performance counters should be used to determine if your system is experiencing a memory related bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-387">**Memory\Available Mbytes**</span><span class="sxs-lookup"><span data-stu-id="7ee37-387">**Memory\Available Mbytes**</span></span>  
  
    -   <span data-ttu-id="7ee37-388">阈值：小于 20 到 25%的已安装的 RAM 的一致的值是相对值的指示内存不足。</span><span class="sxs-lookup"><span data-stu-id="7ee37-388">Threshold: A consistent value of less than 20 to 25 percent of installed RAM is an indication of insufficient memory.</span></span>  
  
    -   <span data-ttu-id="7ee37-389">重要性：这表示可在计算机上运行的进程的物理内存量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-389">Significance: This indicates the amount of physical memory available to processes running on the computer.</span></span> <span data-ttu-id="7ee37-390">请注意，此计数器显示上次观测的值仅。</span><span class="sxs-lookup"><span data-stu-id="7ee37-390">Note that this counter displays the last observed value only.</span></span> <span data-ttu-id="7ee37-391">它不是平均值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-391">It is not an average.</span></span>  
  
-   <span data-ttu-id="7ee37-392">**Memory\Page Reads/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-392">**Memory\Page Reads/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-393">阈值：持续的五个值表示大量的读取请求的页面错误。</span><span class="sxs-lookup"><span data-stu-id="7ee37-393">Threshold: Sustained values of more than five indicate a large number of page faults for read requests.</span></span>  
  
    -   <span data-ttu-id="7ee37-394">重要性：此计数器指示进程的工作集太大，这会导致内存分页到磁盘的可用物理内存。</span><span class="sxs-lookup"><span data-stu-id="7ee37-394">Significance: This counter indicates that the working set of a process is too large for the available physical memory which is causing memory to page to disk.</span></span> <span data-ttu-id="7ee37-395">它显示读取操作，而不考虑在每个操作中检索到的页面数数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-395">It shows the number of read operations, without regard to the number of pages retrieved in each operation.</span></span> <span data-ttu-id="7ee37-396">较高的值指示内存瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-396">Higher values indicate a memory bottleneck.</span></span>  
  
         <span data-ttu-id="7ee37-397">较低的页读取操作率是否与高值**物理磁盘\\%Disk Time**和**Physical disk\avg.磁盘队列长度**，磁盘 I/O 瓶颈条件可能会存在。</span><span class="sxs-lookup"><span data-stu-id="7ee37-397">If a low rate of page-read operations coincides with high values for **Physical Disk\\% Disk Time** and **Physical Disk\Avg. Disk Queue Length**, a disk I/O bottleneck condition may exist.</span></span> <span data-ttu-id="7ee37-398">如果页面读取速率降低不附带的队列长度的增加，内存瓶颈存在物理内存不足。</span><span class="sxs-lookup"><span data-stu-id="7ee37-398">If an increase in queue length is not accompanied by a decrease in the pages-read rate, a memory bottleneck exists due to insufficient physical memory.</span></span>  
  
-   <span data-ttu-id="7ee37-399">**Memory\Pages/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-399">**Memory\Pages/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-400">阈值：持续超过五个值表示瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-400">Threshold: A sustained value of more than five indicates a bottleneck.</span></span>  
  
    -   <span data-ttu-id="7ee37-401">重要性：此计数器表示读取或写入磁盘为解决强制分页错误页的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-401">Significance: This counter indicates the rate at which pages are read from or written to disk to resolve hard page faults.</span></span> <span data-ttu-id="7ee37-402">将的值相乘**Physical disk\avg.Disk sec/Transfer**并**Memory\Pages/sec**性能计数器。</span><span class="sxs-lookup"><span data-stu-id="7ee37-402">Multiply the values of the **Physical Disk\Avg. Disk sec/Transfer** and **Memory\Pages/sec** performance counters.</span></span> <span data-ttu-id="7ee37-403">如果这些值的乘积超过**0.1**，分页利用多个磁盘访问时间，表示有足够的物理内存的 10%。</span><span class="sxs-lookup"><span data-stu-id="7ee37-403">If the product of these values exceeds **0.1**, paging is utilizing more than 10 percent of disk access time, which indicates that insufficient physical memory is available.</span></span>  
  
-   <span data-ttu-id="7ee37-404">**Memory\Pool Nonpaged 的 Bytes**</span><span class="sxs-lookup"><span data-stu-id="7ee37-404">**Memory\Pool Nonpaged Bytes**</span></span>  
  
    -   <span data-ttu-id="7ee37-405">阈值：观看的值**Memory\Pool Nonpaged Bytes**的 10%或更多在系统启动时其值的增加。</span><span class="sxs-lookup"><span data-stu-id="7ee37-405">Threshold: Watch the value of **Memory\Pool Nonpaged Bytes** for an increase of 10 percent or more from its value at system startup.</span></span>  
  
    -   <span data-ttu-id="7ee37-406">重要性：增加 10%或更多在启动时的值可能指示内存泄漏。</span><span class="sxs-lookup"><span data-stu-id="7ee37-406">Significance: An increase of 10 percent or more from the value at startup may be an indication of a memory leak.</span></span>  
  
-   <span data-ttu-id="7ee37-407">**Server\Pool Nonpaged 的失败**</span><span class="sxs-lookup"><span data-stu-id="7ee37-407">**Server\Pool Nonpaged Failures**</span></span>  
  
    -   <span data-ttu-id="7ee37-408">阈值：正则非零值指示的瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-408">Threshold: Regular nonzero values indicate a bottleneck.</span></span>  
  
    -   <span data-ttu-id="7ee37-409">重要性：此计数器表示从非分页池的分配失败次数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-409">Significance: This counter indicates the number of times allocations from the non-paged pool have failed.</span></span> <span data-ttu-id="7ee37-410">非分页池包含从进程的虚拟地址空间不会换出到磁盘，如处理内核对象表上的页面文件的页。</span><span class="sxs-lookup"><span data-stu-id="7ee37-410">The non-paged pool contains pages from a process's virtual address space that are not to be swapped out to the page file on disk, such as a process kernel object table.</span></span> <span data-ttu-id="7ee37-411">非分页池的可用性确定多少进程、 线程和其他可以创建此类对象。</span><span class="sxs-lookup"><span data-stu-id="7ee37-411">The availability of the non-paged pool determines how many processes, threads, and other such objects can be created.</span></span> <span data-ttu-id="7ee37-412">当从非分页池的分配失败时，这可能导致内存泄漏在进程中，尤其是当未相应地增加处理器使用情况。</span><span class="sxs-lookup"><span data-stu-id="7ee37-412">When allocations from the non-paged pool fail, this can be due to a memory leak in a process, particularly if processor usage has not increased accordingly.</span></span>  
  
-   <span data-ttu-id="7ee37-413">**Server\Pool 分页失败**</span><span class="sxs-lookup"><span data-stu-id="7ee37-413">**Server\Pool Paged Failures**</span></span>  
  
    -   <span data-ttu-id="7ee37-414">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-414">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-415">重要性：此计数器表示从页面缓冲池的分配失败次数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-415">Significance: This counter indicates the number of times allocations from the paged pool have failed.</span></span> <span data-ttu-id="7ee37-416">此计数器为正值这表明计算机具有足够的物理内存或 Windows 分页文件太小。</span><span class="sxs-lookup"><span data-stu-id="7ee37-416">A positive value for this counter is an indication that the computer has insufficient physical memory or that the Windows paging file is too small.</span></span>  
  
-   <span data-ttu-id="7ee37-417">**Server\Pool Nonpaged 的峰值**</span><span class="sxs-lookup"><span data-stu-id="7ee37-417">**Server\Pool Nonpaged Peak**</span></span>  
  
    -   <span data-ttu-id="7ee37-418">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-418">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-419">重要性：这是最大中服务器保留在任何点使用的非分页池字节数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-419">Significance: This is the maximum number of bytes in the non-paged pool that the server has reserved for use at any one point.</span></span> <span data-ttu-id="7ee37-420">它指示计算机应该具有的物理内存量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-420">It indicates how much physical memory the computer should have.</span></span> <span data-ttu-id="7ee37-421">因为非分页池必须是驻留在物理内存，因为必须有留下的其他操作，作为经验法则计算机部分内存应已安装物理内存，这是此计数器指示值的 4 倍。</span><span class="sxs-lookup"><span data-stu-id="7ee37-421">Because the non-paged pool must be resident in physical memory and because there has to be some memory left over for other operations, as a rule of thumb the computer should have installed physical memory that is 4 times the value indicated for this counter.</span></span>  
  
-   <span data-ttu-id="7ee37-422">**Memory\Cache Bytes**</span><span class="sxs-lookup"><span data-stu-id="7ee37-422">**Memory\Cache Bytes**</span></span>  
  
    -   <span data-ttu-id="7ee37-423">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-423">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-424">重要性：监视在不同的负载条件下的缓存的大小。</span><span class="sxs-lookup"><span data-stu-id="7ee37-424">Significance: Monitors the size of cache under different load conditions.</span></span> <span data-ttu-id="7ee37-425">此性能计数器的此值指示静态文件缓存的大小。</span><span class="sxs-lookup"><span data-stu-id="7ee37-425">This value of this performance counter indicates the size of the static files cache.</span></span> <span data-ttu-id="7ee37-426">默认情况下，此计数器使用大约 50%的可用内存，但减少，如果可用内存逐渐缩小，这会影响系统性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-426">By default, this counter uses approximately 50 percent of available memory, but decreases if available memory shrinks, which affects system performance.</span></span>  
  
-   <span data-ttu-id="7ee37-427">**Memory\Cache Faults/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-427">**Memory\Cache Faults/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-428">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-428">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-429">重要性：此计数器表示何种频率操作系统查找文件系统缓存中的数据，但无法找到它。</span><span class="sxs-lookup"><span data-stu-id="7ee37-429">Significance: This counter indicates how often the operating system looks for data in the file system cache but fails to find it.</span></span> <span data-ttu-id="7ee37-430">此值应尽可能低。</span><span class="sxs-lookup"><span data-stu-id="7ee37-430">This value should be as low as possible.</span></span>  
  
-   <span data-ttu-id="7ee37-431">**Cache\MDL 读取命中 %**</span><span class="sxs-lookup"><span data-stu-id="7ee37-431">**Cache\MDL Read Hits %**</span></span>  
  
    -   <span data-ttu-id="7ee37-432">阈值：较高这价值，文件系统缓存的性能就越好。</span><span class="sxs-lookup"><span data-stu-id="7ee37-432">Threshold: The higher this value, the better the performance of the file system cache.</span></span> <span data-ttu-id="7ee37-433">值应接近 100%尽可能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-433">Values should be as close to 100 percent as possible.</span></span>  
  
    -   <span data-ttu-id="7ee37-434">重要性：此计数器提供百分比的内存描述符列表 (MDL) 读取文件系统缓存，其中缓存返回的对象直接请求，而无需从硬盘读取。</span><span class="sxs-lookup"><span data-stu-id="7ee37-434">Significance: This counter provides the percentage of Memory Descriptor List (MDL) Read requests to the file system cache, where the cache returns the object directly rather than requiring a read from the hard disk.</span></span>  
  
-   <span data-ttu-id="7ee37-435">**Process\Working Set**</span><span class="sxs-lookup"><span data-stu-id="7ee37-435">**Process\Working Set**</span></span>  
  
    -   <span data-ttu-id="7ee37-436">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-436">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-437">重要性：工作集是当前加载到内存 （物理和虚拟） 中的内存页的集合。</span><span class="sxs-lookup"><span data-stu-id="7ee37-437">Significance: The working set is the set of memory pages currently loaded in memory (physical + virtual).</span></span> <span data-ttu-id="7ee37-438">如果系统有足够的内存，它可以维护足够的空间中的工作集，以便它不需要执行将内存分页到磁盘的磁盘操作。</span><span class="sxs-lookup"><span data-stu-id="7ee37-438">If the system has sufficient memory, it can maintain enough space in the working set so that it does not need to perform disk operations to page memory to disk.</span></span> <span data-ttu-id="7ee37-439">但是，如果没有足够的内存，系统会尝试减少工作集中的灵活度从进程的内存，这会导致页错误的增加。</span><span class="sxs-lookup"><span data-stu-id="7ee37-439">However, if there is insufficient memory, the system tries to reduce the working set by taking away the memory from the processes which results in an increase in page faults.</span></span> <span data-ttu-id="7ee37-440">当页面错误的速率增加时，系统会尝试增加进程工作集。</span><span class="sxs-lookup"><span data-stu-id="7ee37-440">When the rate of page faults rises, the system tries to increase the working set of the process.</span></span> <span data-ttu-id="7ee37-441">如果你观察宽波动的工作集，则可能指示内存不足。</span><span class="sxs-lookup"><span data-stu-id="7ee37-441">If you observe wide fluctuations in the working set, it might indicate a memory shortage.</span></span> <span data-ttu-id="7ee37-442">更高版本中的工作集值也可能是由于应用程序中的多个程序集。</span><span class="sxs-lookup"><span data-stu-id="7ee37-442">Higher values in the working set may also be due to multiple assemblies in an application.</span></span> <span data-ttu-id="7ee37-443">您可以提高工作集通过使用在全局程序集缓存中共享的程序集。</span><span class="sxs-lookup"><span data-stu-id="7ee37-443">You can improve the working set by using assemblies shared in the global assembly cache.</span></span>  
  
#### <a name="resolving-memory-bottlenecks"></a><span data-ttu-id="7ee37-444">解决内存瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-444">Resolving memory bottlenecks</span></span>  
 <span data-ttu-id="7ee37-445">如果确定该内存是在 BizTalk Server 环境中，使用一个或多个以下方法来解决瓶颈的瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-445">If you determine that memory is a bottleneck in your BizTalk Server environment, use one or more of the following methods to resolve the bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-446">优化分配如果您可以控制分配的内存量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-446">Tune the amount of memory allocated if you can control the allocation.</span></span> <span data-ttu-id="7ee37-447">例如，您可以调整此 BizTalk Server、 ASP.NET 和 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="7ee37-447">For example, you can tune this for BizTalk Server, ASP.NET and SQL Server.</span></span>  
  
-   <span data-ttu-id="7ee37-448">Windows 页面文件的大小增加，并按照中的"配置 Windows 页面文件以获得最佳性能"部分的步骤[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-448">Increase the size of the Windows paging file and follow the steps in the “Configure the Windows PAGEFILE for optimal performance” section of [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-449">关闭未使用的服务。</span><span class="sxs-lookup"><span data-stu-id="7ee37-449">Turn off services that are not used.</span></span> <span data-ttu-id="7ee37-450">停止不经常使用的服务节省内存并提高系统性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-450">Stopping services that you do not use regularly saves memory and improves system performance.</span></span> <span data-ttu-id="7ee37-451">有关详细信息，请参阅的"禁用不必要的服务"部分[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-451">For more information, see the “Disable non-essential services” section of [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-452">删除不必要的协议和驱动程序。</span><span class="sxs-lookup"><span data-stu-id="7ee37-452">Remove unnecessary protocols and drivers.</span></span> <span data-ttu-id="7ee37-453">甚至空闲协议使用中的分页和非分页内存池空间。</span><span class="sxs-lookup"><span data-stu-id="7ee37-453">Even idle protocols use space in the paged and non-paged memory pools.</span></span> <span data-ttu-id="7ee37-454">驱动程序还使用内存，因此应删除不必要的。</span><span class="sxs-lookup"><span data-stu-id="7ee37-454">Drivers also consume memory, so you should remove unnecessary ones.</span></span> <span data-ttu-id="7ee37-455">有关详细信息，请参阅的"删除不必要的网络协议"部分[优化操作系统性能](~/technical-guides/optimizing-operating-system-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-455">For more information, see the “Remove unnecessary network protocols” section of [Optimizing Operating System Performance](~/technical-guides/optimizing-operating-system-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-456">在 BizTalk Server 环境中的计算机上安装额外的物理内存。</span><span class="sxs-lookup"><span data-stu-id="7ee37-456">Install additional physical memory on the computers in the BizTalk Server environment.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="7ee37-457">在 32 位系统上，BizTalk 可使用的最大 2 gb 的内存，如果使用 /3GB 开关，则将限制增加到 3 GB，BizTalk Server 2010 和更高版本。</span><span class="sxs-lookup"><span data-stu-id="7ee37-457">On a 32-bit system, BizTalk can use a maximum of 2GB of memory, the limit increases to 3GB with BizTalk Server 2010 and later if the /3GB switch is used.</span></span> <span data-ttu-id="7ee37-458">有关内存使用情况的详细信息，请参阅[Windows 版本的内存限制](http://go.microsoft.com/fwlink/?LinkId=118349)(http://go.microsoft.com/fwlink/?LinkId=118349)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-458">For more information on memory usage, see [Memory Limits for Windows Releases](http://go.microsoft.com/fwlink/?LinkId=118349) (http://go.microsoft.com/fwlink/?LinkId=118349).</span></span>  
  
### <a name="network-io-bottlenecks"></a><span data-ttu-id="7ee37-459">网络 I/O 瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-459">Network I/O bottlenecks</span></span>  
  
#### <a name="you-might-have-a-network-io-bottleneck-if"></a><span data-ttu-id="7ee37-460">如果，则可能存在网络 I/O 瓶颈...</span><span class="sxs-lookup"><span data-stu-id="7ee37-460">You might have a network I/O bottleneck if…</span></span>  
  
-   <span data-ttu-id="7ee37-461">值**Network Interface\Bytes Total/sec**性能计数器超过 80%的可用网络带宽。</span><span class="sxs-lookup"><span data-stu-id="7ee37-461">The value of the **Network Interface\Bytes Total/sec** performance counter exceeds 80% of available network bandwidth.</span></span>  
  
-   <span data-ttu-id="7ee37-462">值**Server\Bytes Total/sec**性能计数器大于 50%的可用网络带宽。</span><span class="sxs-lookup"><span data-stu-id="7ee37-462">The value of the **Server\Bytes Total/sec** performance counter is greater than 50% of available network bandwidth.</span></span>  
  
#### <a name="performance-counters-for-measuring-network-io-bottlenecks"></a><span data-ttu-id="7ee37-463">用于测量网络 I/O 瓶颈的性能计数器</span><span class="sxs-lookup"><span data-stu-id="7ee37-463">Performance counters for measuring network I/O bottlenecks</span></span>  
 <span data-ttu-id="7ee37-464">应使用以下性能计数器来测量网络 I/O 和确定系统是否遇到了网络 I/O 相关的瓶颈：</span><span class="sxs-lookup"><span data-stu-id="7ee37-464">The following performance counters should be used to measure network I/O and determine if your system is experiencing a network I/O related bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-465">**Network Interface\Bytes Total/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-465">**Network Interface\Bytes Total/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-466">阈值：持续的 80%以上的网络容量值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-466">Threshold: Sustained value of more than 80 percent of network capacity.</span></span>  
  
    -   <span data-ttu-id="7ee37-467">重要性：此计数器表示发送和每个网络适配器上接收字节的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-467">Significance: This counter indicates the rate at which bytes are sent and received over each network adapter.</span></span> <span data-ttu-id="7ee37-468">此计数器可帮助确定网络适配器处于满负荷状态以及是否应将添加一个或多个网络适配器，以增加可用的网络带宽。</span><span class="sxs-lookup"><span data-stu-id="7ee37-468">This counter helps determine if a network adapter is saturated and whether you should add one or more network adapters to increase available network bandwidth.</span></span>  
  
-   <span data-ttu-id="7ee37-469">**Network Interface\Bytes Received/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-469">**Network Interface\Bytes Received/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-470">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-470">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-471">重要性：此计数器指示每个网络适配器上接收字节的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-471">Significance: This counter indicates the rate at which bytes are received over each network adapter.</span></span> <span data-ttu-id="7ee37-472">使用此计数器的值来计算总的可用带宽的百分比的传入数据的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-472">Use the value of this counter to calculate the rate of incoming data as a percentage of total available bandwidth.</span></span> <span data-ttu-id="7ee37-473">这将有助于确定是否在客户端将数据发送到 BizTalk Server 或如果应在 BizTalk Server 计算机本身上增加网络带宽，则应增加网络带宽。</span><span class="sxs-lookup"><span data-stu-id="7ee37-473">This will help determine if network bandwidth should be increased on the client sending data to BizTalk Server or if network bandwidth should be increased on the BizTalk Server computer itself.</span></span>  
  
-   <span data-ttu-id="7ee37-474">**Network Interface\Bytes Sent/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-474">**Network Interface\Bytes Sent/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-475">阈值：没有特定的值。</span><span class="sxs-lookup"><span data-stu-id="7ee37-475">Threshold: No specific value.</span></span>  
  
    -   <span data-ttu-id="7ee37-476">重要性：此计数器指示每个网络适配器上发送字节的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-476">Significance: This counter indicates the rate at which bytes are sent over each network adapter.</span></span> <span data-ttu-id="7ee37-477">使用此计数器的值来计算总的可用带宽的百分比的传出数据的速率。</span><span class="sxs-lookup"><span data-stu-id="7ee37-477">Use the value of this counter to calculate the rate of outgoing data as a percentage of total available bandwidth.</span></span> <span data-ttu-id="7ee37-478">这将有助于确定是否应在 BizTalk Server 将数据发送到客户端上提高网络带宽，或从 BizTalk Server 的客户端计算机接收数据，则应增加网络带宽。</span><span class="sxs-lookup"><span data-stu-id="7ee37-478">This will help determine if network bandwidth should be increased on the BizTalk Server sending data to a client or if network bandwidth should be increased on the client computer receiving data from BizTalk Server.</span></span>  
  
-   <span data-ttu-id="7ee37-479">**Server\Bytes Total/sec**</span><span class="sxs-lookup"><span data-stu-id="7ee37-479">**Server\Bytes Total/sec**</span></span>  
  
    -   <span data-ttu-id="7ee37-480">阈值：持续的数超过 50%的网络容量。</span><span class="sxs-lookup"><span data-stu-id="7ee37-480">Threshold: Sustained value of more than 50 percent of network capacity.</span></span>  
  
    -   <span data-ttu-id="7ee37-481">重要性：此计数器表示发送和通过网络接收的字节数。</span><span class="sxs-lookup"><span data-stu-id="7ee37-481">Significance: This counter indicates the number of bytes sent and received over the network.</span></span> <span data-ttu-id="7ee37-482">较高的值指示网络 I/O 瓶颈。</span><span class="sxs-lookup"><span data-stu-id="7ee37-482">Higher values indicate a network I/O bottleneck.</span></span> <span data-ttu-id="7ee37-483">如果总和**Bytes Total/sec**为与你的网络的最大传输速率大致相同的所有服务器，请考虑子网的网络，以提高性能。</span><span class="sxs-lookup"><span data-stu-id="7ee37-483">If the sum of **Bytes Total/sec** for all servers is roughly equal to the maximum transfer rate of your network, consider subnetting the network to improve performance.</span></span> <span data-ttu-id="7ee37-484">有关子网的网络，以提高性能的详细信息，请参阅**子网**一部分[BizTalk Server 数据库优化白皮书](http://go.microsoft.com/fwlink/?LinkID=101578)(http://go.microsoft.com/fwlink/?LinkID=101578)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-484">For more information about subnetting a network to improve performance, see the **Subnets** section of the [BizTalk Server Database Optimization white paper](http://go.microsoft.com/fwlink/?LinkID=101578) (http://go.microsoft.com/fwlink/?LinkID=101578).</span></span>  
  
#### <a name="resolving-network-io-bottlenecks"></a><span data-ttu-id="7ee37-485">解决网络 I/O 瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-485">Resolving network I/O bottlenecks</span></span>  
 <span data-ttu-id="7ee37-486">如果您确定网络 I/O 是您的环境中的瓶颈，请使用一个或多个以下方法来解决瓶颈问题：</span><span class="sxs-lookup"><span data-stu-id="7ee37-486">If you determine that network I/O is a bottleneck in your environment, use one or more of the following methods to resolve the bottleneck:</span></span>  
  
-   <span data-ttu-id="7ee37-487">请遵循中的"提高网络性能的常规指南"部分建议[优化网络性能](~/technical-guides/optimizing-network-performance.md)。</span><span class="sxs-lookup"><span data-stu-id="7ee37-487">Follow the recommendations in the “General guidelines for improving network performance” section of [Optimizing Network Performance](~/technical-guides/optimizing-network-performance.md).</span></span>  
  
-   <span data-ttu-id="7ee37-488">运行 Windows Powershell 网络优化脚本主题所述[优化网络性能](~/technical-guides/optimizing-network-performance.md)BizTalk Server 环境中的每台计算机上。</span><span class="sxs-lookup"><span data-stu-id="7ee37-488">Run the Windows Powershell network optimization script described in the topic [Optimizing Network Performance](~/technical-guides/optimizing-network-performance.md) on each computer in the BizTalk Server environment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7ee37-489">请参阅</span><span class="sxs-lookup"><span data-stu-id="7ee37-489">See Also</span></span>  
 [<span data-ttu-id="7ee37-490">查找并消除瓶颈</span><span class="sxs-lookup"><span data-stu-id="7ee37-490">Finding and Eliminating Bottlenecks</span></span>](~/technical-guides/finding-and-eliminating-bottlenecks.md)