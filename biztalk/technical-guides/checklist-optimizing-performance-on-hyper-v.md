---
title: 清单：优化 HYPER-V 上的性能 |Microsoft Docs
ms.custom: ''
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 942a61eb-0fdd-4c8b-b0ad-d32951f0f631
caps.latest.revision: 23
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2274266a62f427b9a47b51989ea80cd2e1373e4a
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65397091"
---
# <a name="checklist-optimizing-performance-on-hyper-v"></a><span data-ttu-id="94896-102">清单：Hyper V 上优化性能</span><span class="sxs-lookup"><span data-stu-id="94896-102">Checklist: Optimizing Performance on Hyper-V</span></span>
<span data-ttu-id="94896-103">以下注意事项适用时运行 BizTalk Server 和/或[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]的 HYPER-V 虚拟机具有 BizTalk Server 数据库的实例。</span><span class="sxs-lookup"><span data-stu-id="94896-103">The following considerations apply when running BizTalk Server and/or the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance(s) that have the BizTalk Server databases on Hyper-V virtual machines.</span></span>  

## <a name="allocate-110125-of-cpu-and-disk-resources-to-the-hyper-v-virtual-machines"></a><span data-ttu-id="94896-104">分配给 HYPER-V 虚拟机的 110%– 125%的 CPU 和磁盘资源</span><span class="sxs-lookup"><span data-stu-id="94896-104">Allocate 110%–125% of CPU and Disk Resources to the Hyper-V Virtual Machines</span></span>  
 <span data-ttu-id="94896-105">计划分配 110%到 125%的 CPU 资源和 105%-110%的解决方案所使用的 HYPER-V 虚拟机的物理硬件解决方案所需的磁盘资源。</span><span class="sxs-lookup"><span data-stu-id="94896-105">Plan to allocate 110% to 125% of the CPU resources and 105% - 110% of the disk resources required by a physical hardware solution to the Hyper-V virtual machines used for the solution.</span></span> <span data-ttu-id="94896-106">通过使用其他资源配置的 HYPER-V 虚拟机，您需要确保它可以提供与物理硬件相媲美的性能，同时容纳所需的 HYPER-V 虚拟化技术的任何开销。</span><span class="sxs-lookup"><span data-stu-id="94896-106">By configuring the Hyper-V virtual machine with additional resources, you will ensure that it can provide performance on par with physical hardware while accommodating any overhead required by Hyper-V virtualization technology.</span></span>  


|                                                                                      <span data-ttu-id="94896-107">步骤</span><span class="sxs-lookup"><span data-stu-id="94896-107">Step</span></span>                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span data-ttu-id="94896-108">参考</span><span class="sxs-lookup"><span data-stu-id="94896-108">Reference</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                      <span data-ttu-id="94896-109">作用域的硬件要求[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]解决方案。</span><span class="sxs-lookup"><span data-stu-id="94896-109">Scope the hardware requirements for the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution.</span></span>                       | <span data-ttu-id="94896-110">-按照的"Planning the 环境的 BizTalk Server"部分中的指导[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]操作指南，网址[ http://go.microsoft.com/fwlink/?LinkId=122399 ](http://go.microsoft.com/fwlink/?LinkId=122399)确定解决方案的硬件要求的范围。</span><span class="sxs-lookup"><span data-stu-id="94896-110">-   Follow the guidance in the “Planning the Environment for BizTalk Server” section of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Operations Guide at [http://go.microsoft.com/fwlink/?LinkId=122399](http://go.microsoft.com/fwlink/?LinkId=122399) to scope the hardware requirements for the solution.</span></span><br /><span data-ttu-id="94896-111">-到作用域的版本和所需的解决方案的 BizTalk 服务器数量查看 BizTalk Server 在规划注意事项"规划 BizTalk Server 层"中所述[ http://go.microsoft.com/fwlink/?LinkId=122401 ](http://go.microsoft.com/fwlink/?LinkId=122401)。</span><span class="sxs-lookup"><span data-stu-id="94896-111">-   To scope the edition and number of BizTalk Servers that will be required by the solution review BizTalk Server planning considerations documented in “Planning the BizTalk Server Tier” at [http://go.microsoft.com/fwlink/?LinkId=122401](http://go.microsoft.com/fwlink/?LinkId=122401).</span></span><br /><span data-ttu-id="94896-112">-若要确定范围的版本和数量[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]解决方案，将所需的计算机上查看的规划注意事项"规划数据库层"中所述的数据库[ http://go.microsoft.com/fwlink/?LinkId=122402 ](http://go.microsoft.com/fwlink/?LinkId=122402)和"性能在 HYPER-V 中运行 SQL Server 的系统开销"部分可在"运行 SQL Server 2008 in a HYPER-V 环境最佳实践和性能注意事项"白皮书[ http://go.microsoft.com/fwlink/?LinkId=144622 ](http://go.microsoft.com/fwlink/?LinkId=144622)。</span><span class="sxs-lookup"><span data-stu-id="94896-112">-   To scope the version and number of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] computers that will be required by the solution, review database planning considerations documented in “Planning the Database Tier” at [http://go.microsoft.com/fwlink/?LinkId=122402](http://go.microsoft.com/fwlink/?LinkId=122402) and the “Performance Overhead of Running SQL Server in Hyper-V” section of the “Running SQL Server 2008 in a Hyper-V Environment Best Practices and Performance Considerations” whitepaper available at [http://go.microsoft.com/fwlink/?LinkId=144622](http://go.microsoft.com/fwlink/?LinkId=144622).</span></span><br /><span data-ttu-id="94896-113">-若要完成规划开发、 测试、 过渡和生产环境查看"规划开发、 测试、 过渡和生产环境"网址[ http://go.microsoft.com/fwlink/?LinkId=122403 ](http://go.microsoft.com/fwlink/?LinkId=122403)。</span><span class="sxs-lookup"><span data-stu-id="94896-113">-   To complete planning for development, testing, staging, and production environments review “Planning the Development, Testing, Staging, and Production Environments” at [http://go.microsoft.com/fwlink/?LinkId=122403](http://go.microsoft.com/fwlink/?LinkId=122403).</span></span> |
| <span data-ttu-id="94896-114">作用域 BizTalk Server 解决方案的硬件要求之后, 计划配置的 HYPER-V 计算机**110 – 125%** 的 CPU 和磁盘资源在可能的情况。</span><span class="sxs-lookup"><span data-stu-id="94896-114">After scoping the hardware requirements of your BizTalk Server solution, plan to configure the Hyper-V machines with **110% – 125%** of the CPU and disk resources if possible.</span></span> |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span data-ttu-id="94896-115">例如，如果解决方案所使用的物理 BizTalk Server 计算机的硬件要求被确定为 2 GB RAM，双核 CPU 运行在 2 GHZ 和 2 x 500 GB 的物理磁盘，则理想情况下，该解决方案使用的 HYPER-V 虚拟机应配置具有 2 个或更多个虚拟处理器运行 > = 2.2 GHZ，并更快的物理磁盘 （通常通过增加主轴数，或使用更快的磁盘）。</span><span class="sxs-lookup"><span data-stu-id="94896-115">For example, if the hardware requirements for a physical BizTalk Server computer used by the solution is determined to be 2GB RAM, a dual core CPU running at 2GHZ, and 2x 500 GB physical disks, then ideally, the Hyper-V virtual machine used by the solution would be configured with 2 or more virtual processors running >= 2.2 GHZ, and faster physical disks (typically by adding spindles or using faster disks).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

## <a name="optimize-hyper-v-performance"></a><span data-ttu-id="94896-116">优化 HYPER-V 的性能</span><span class="sxs-lookup"><span data-stu-id="94896-116">Optimize Hyper-V Performance</span></span>  
 <span data-ttu-id="94896-117">使用以下常规准则配置 HYPER-V 以获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="94896-117">Use the following general guidelines to configure Hyper-V for optimal performance.</span></span>  

|<span data-ttu-id="94896-118">步骤</span><span class="sxs-lookup"><span data-stu-id="94896-118">Step</span></span>|<span data-ttu-id="94896-119">参考</span><span class="sxs-lookup"><span data-stu-id="94896-119">Reference</span></span>|  
|----------|---------------|  
|<span data-ttu-id="94896-120">应用的性能优化虚拟化服务器推荐的指导。</span><span class="sxs-lookup"><span data-stu-id="94896-120">Apply recommended guidance for performance tuning virtualization servers.</span></span> <span data-ttu-id="94896-121">**注意：** 有关测试方案中所述[测试 BizTalk Server 虚拟化性能](~/technical-guides/testing-biztalk-server-virtualization-performance.md)，"物理基础结构详细信息"和"虚拟化详细信息"中描述了已应用的配置选项部分[测试方案概述](~/technical-guides/test-scenario-overview.md)主题。</span><span class="sxs-lookup"><span data-stu-id="94896-121">**Note:**  For the test scenarios described in [Testing BizTalk Server Virtualization Performance](~/technical-guides/testing-biztalk-server-virtualization-performance.md), the configuration options that were applied are described in the “Physical Infrastructure Specifics” and the “Virtualization Specifics” sections of the [Test Scenario Overview](~/technical-guides/test-scenario-overview.md) topic.</span></span>|<span data-ttu-id="94896-122">在"性能优化准则的 Windows Server 2008 R2"文档"的虚拟化服务器的性能优化"部分[ http://go.microsoft.com/fwlink/?LinkID=202087 ](http://go.microsoft.com/fwlink/?LinkID=202087)。</span><span class="sxs-lookup"><span data-stu-id="94896-122">“Performance Tuning for Virtualization Servers” section of the “Performance Tuning Guidelines for Windows Server 2008 R2” document available at [http://go.microsoft.com/fwlink/?LinkID=202087](http://go.microsoft.com/fwlink/?LinkID=202087).</span></span>|  
|<span data-ttu-id="94896-123">关闭不会使用任何虚拟机连接窗口。</span><span class="sxs-lookup"><span data-stu-id="94896-123">Close any Virtual Machine Connection windows that aren’t being used.</span></span>|<span data-ttu-id="94896-124">当双击虚拟机名称中的 HYPER-V 管理器时显示的虚拟机连接窗口使用无法否则利用的资源。</span><span class="sxs-lookup"><span data-stu-id="94896-124">The Virtual Machine Connection window(s) displayed when double-clicking a virtual machine name in the Hyper-V manager consume resources that could be otherwise utilized.</span></span>|  
|<span data-ttu-id="94896-125">关闭或最小化的 HYPER-V 管理器。</span><span class="sxs-lookup"><span data-stu-id="94896-125">Close or minimize the Hyper-V manager.</span></span>|<span data-ttu-id="94896-126">HYPER-V 管理器会通过不断轮询每个运行的虚拟机的 CPU 使用率和正常运行时间占用资源。</span><span class="sxs-lookup"><span data-stu-id="94896-126">The Hyper-V manager consumes resources by continually polling each running virtual machine for CPU utilization and uptime.</span></span> <span data-ttu-id="94896-127">关闭或最小化的 HYPER-V 管理器将释放这些资源。</span><span class="sxs-lookup"><span data-stu-id="94896-127">Closing or minimizing the Hyper-V manager will free up these resources.</span></span>|  

## <a name="optimize-performance-of-disk-memory-network-and-processor-in-a-hyper-v-environment"></a><span data-ttu-id="94896-128">优化磁盘、 内存、 网络和处理器的 HYPER-V 环境中的性能</span><span class="sxs-lookup"><span data-stu-id="94896-128">Optimize Performance of Disk, Memory, Network, and Processor in a Hyper-V Environment</span></span>  
 <span data-ttu-id="94896-129">使用以下准则来优化磁盘、 内存、 网络和处理器的 HYPER-V 虚拟环境中的性能。</span><span class="sxs-lookup"><span data-stu-id="94896-129">Use the following guidelines to optimize performance of disk, memory, network, and processor in a Hyper-V virtual environment.</span></span>  

### <a name="optimize-processor-performance"></a><span data-ttu-id="94896-130">优化处理器性能</span><span class="sxs-lookup"><span data-stu-id="94896-130">Optimize Processor Performance</span></span>  
 <span data-ttu-id="94896-131">请遵循以下准则来优化来宾操作系统的 HYPER-V 虚拟环境中运行的处理器性能：</span><span class="sxs-lookup"><span data-stu-id="94896-131">Follow these guidelines to optimize processor performance of guest operating systems running in a Hyper-V virtual environment:</span></span>  

- <span data-ttu-id="94896-132">**配置虚拟处理器到为了获得最佳性能-可用逻辑处理器的 1 对 1 分配**运行时 CPU 密集型应用程序，最佳配置是 1 对 1 到来宾操作系统中的虚拟处理器比率逻辑处理器可供主机操作系统中。</span><span class="sxs-lookup"><span data-stu-id="94896-132">**Configure a 1-to-1 allocation of virtual processors to available logical processors for best performance -** When running a CPU intensive application, the best configuration is a 1-to-1 ratio of virtual processors in the guest operating system(s) to the logical processors available to the host operating system.</span></span> <span data-ttu-id="94896-133">任何其他配置如 2:1 或 1:2 会降低效率。</span><span class="sxs-lookup"><span data-stu-id="94896-133">Any other configuration such as 2:1 or 1:2 is less efficient.</span></span> <span data-ttu-id="94896-134">下图演示了到逻辑处理器可供主机操作系统的来宾操作系统中的虚拟处理器内核的 1 对 1 分配：</span><span class="sxs-lookup"><span data-stu-id="94896-134">The following graphic illustrates a 1-to-1 allocation of virtual processor cores in the guest operating system(s) to logical processors available to the host operating system:</span></span>  

   <span data-ttu-id="94896-135">![One to One Physical to Virtual Processor Ratio](../technical-guides/media/90f98f0d-a223-404c-b419-81369dc92970.gif "一对一物理到虚拟处理器比率")</span><span class="sxs-lookup"><span data-stu-id="94896-135">![One to One Physical to Virtual Processor Ratio](../technical-guides/media/90f98f0d-a223-404c-b419-81369dc92970.gif "One to One Physical to Virtual Processor Ratio")</span></span>  
  <span data-ttu-id="94896-136">虚拟与逻辑处理器比率</span><span class="sxs-lookup"><span data-stu-id="94896-136">Virtual to logical processor ratio</span></span>  

- <span data-ttu-id="94896-137">**请注意不同的来宾操作系统的虚拟处理器限制并进行相应的规划**可供 HYPER-V 虚拟机中运行的来宾操作系统的处理器内核数可能会影响整体承载的应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="94896-137">**Be aware of the virtual processor limit for different guest operating systems and plan accordingly -** The number of processor cores that are available to the guest operating system running in a Hyper-V virtual machine can impact the overall performance of the hosted application.</span></span> <span data-ttu-id="94896-138">因此，应考虑有关来宾操作系统将安装在 HYPER-V 虚拟机来托管 BizTalk Server 上和/或[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]承载 BizTalk Server 数据库的实例。</span><span class="sxs-lookup"><span data-stu-id="94896-138">Therefore, consideration should be made as to which guest operating system will be installed on the Hyper-V virtual machine to host the BizTalk Server and/or [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance(s) that host the BizTalk Server databases.</span></span> <span data-ttu-id="94896-139">HYPER-V 可容纳以下指定的来宾操作系统的虚拟处理器数：</span><span class="sxs-lookup"><span data-stu-id="94896-139">Hyper-V accommodates the following number of virtual processors for the specified guest operating system:</span></span>  

|                                                                      <span data-ttu-id="94896-140">操作系统</span><span class="sxs-lookup"><span data-stu-id="94896-140">Operating system</span></span>                                                                       | <span data-ttu-id="94896-141">虚拟处理器限制</span><span class="sxs-lookup"><span data-stu-id="94896-141">Virtual processor limit</span></span> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
| [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] <span data-ttu-id="94896-142">的用户。</span><span class="sxs-lookup"><span data-stu-id="94896-142">.</span></span> <span data-ttu-id="94896-143">所有版本的[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]只有 64 位。</span><span class="sxs-lookup"><span data-stu-id="94896-143">All editions of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] are 64-bit only.</span></span> |            <span data-ttu-id="94896-144">4</span><span class="sxs-lookup"><span data-stu-id="94896-144">4</span></span>            |
|                                               [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] <span data-ttu-id="94896-145">64 位</span><span class="sxs-lookup"><span data-stu-id="94896-145">64-bit</span></span>                                               |            <span data-ttu-id="94896-146">4</span><span class="sxs-lookup"><span data-stu-id="94896-146">4</span></span>            |
|                                               [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] <span data-ttu-id="94896-147">32 位</span><span class="sxs-lookup"><span data-stu-id="94896-147">32-bit</span></span>                                               |            <span data-ttu-id="94896-148">4</span><span class="sxs-lookup"><span data-stu-id="94896-148">4</span></span>            |
|                                                                      <span data-ttu-id="94896-149">Windows 7 64 位</span><span class="sxs-lookup"><span data-stu-id="94896-149">Windows 7 64-bit</span></span>                                                                       |            <span data-ttu-id="94896-150">4</span><span class="sxs-lookup"><span data-stu-id="94896-150">4</span></span>            |
|                                                                      <span data-ttu-id="94896-151">Windows 7 32 位</span><span class="sxs-lookup"><span data-stu-id="94896-151">Windows 7 32-bit</span></span>                                                                       |            <span data-ttu-id="94896-152">4</span><span class="sxs-lookup"><span data-stu-id="94896-152">4</span></span>            |
|                                                                    <span data-ttu-id="94896-153">Windows Vista 64 位</span><span class="sxs-lookup"><span data-stu-id="94896-153">Windows Vista 64-bit</span></span>                                                                     |            <span data-ttu-id="94896-154">2</span><span class="sxs-lookup"><span data-stu-id="94896-154">2</span></span>            |
|                                                                    <span data-ttu-id="94896-155">Windows Vista 32 位</span><span class="sxs-lookup"><span data-stu-id="94896-155">Windows Vista  32-bit</span></span>                                                                    |            <span data-ttu-id="94896-156">2</span><span class="sxs-lookup"><span data-stu-id="94896-156">2</span></span>            |

> [!NOTE]
>  <span data-ttu-id="94896-157">有关 HYPER-V 支持的来宾操作系统的详细信息，请参阅[ http://go.microsoft.com/fwlink/?LinkID=118347 ](http://go.microsoft.com/fwlink/?LinkID=118347)。</span><span class="sxs-lookup"><span data-stu-id="94896-157">For more information about the guest operating systems that are supported on Hyper-V, see [http://go.microsoft.com/fwlink/?LinkID=118347](http://go.microsoft.com/fwlink/?LinkID=118347).</span></span>  

### <a name="optimize-disk-performance"></a><span data-ttu-id="94896-158">优化磁盘性能</span><span class="sxs-lookup"><span data-stu-id="94896-158">Optimize Disk Performance</span></span>  
 <span data-ttu-id="94896-159">请遵循以下准则来优化磁盘性能的来宾操作系统的 HYPER-V 虚拟环境中运行：</span><span class="sxs-lookup"><span data-stu-id="94896-159">Follow these guidelines to optimize disk performance of guest operating systems running in a Hyper-V virtual environment:</span></span>  

|<span data-ttu-id="94896-160">步骤</span><span class="sxs-lookup"><span data-stu-id="94896-160">Step</span></span>|<span data-ttu-id="94896-161">参考</span><span class="sxs-lookup"><span data-stu-id="94896-161">Reference</span></span>|  
|----------|---------------|  
|<span data-ttu-id="94896-162">配置用于虚拟磁盘的 HYPER-V 虚拟机使用固定大小虚拟硬盘 (VHD) 选项。</span><span class="sxs-lookup"><span data-stu-id="94896-162">Configure virtual disks for use with the Hyper-V virtual machines using the fixed-size virtual hard disk (VHD) option.</span></span> <span data-ttu-id="94896-163">固定大小 VHD 可提供接近的功能，例如群集的支持和快照的磁盘支持的灵活性以及物理磁盘的性能。</span><span class="sxs-lookup"><span data-stu-id="94896-163">Fixed-size VHD offers performance approaching that of physical disks together with the flexibility of features such as clustering support and snapshot disk support.</span></span>|<span data-ttu-id="94896-164">通过虚拟 IDE 控制器或虚拟 SCSI 控制器可访问的 HYPER-V 环境中的磁盘存储。</span><span class="sxs-lookup"><span data-stu-id="94896-164">Disk storage in a Hyper-V environment is accessible through a virtual IDE controller or a virtual SCSI controller.</span></span> <span data-ttu-id="94896-165">与以前版本的 Microsoft 虚拟化技术，是访问虚拟硬盘时，使用虚拟 IDE 控制器或虚拟 SCSI 控制器之间没有性能差异。</span><span class="sxs-lookup"><span data-stu-id="94896-165">Unlike previous versions of Microsoft virtualization technology, there is no performance difference between using a virtual IDE controller or a virtual SCSI controller when accessing virtual hard disks.</span></span> <span data-ttu-id="94896-166">以下的磁盘存储选项是可用于在 HYPER-V 环境中使用：</span><span class="sxs-lookup"><span data-stu-id="94896-166">The following disk storage options are available for use in a Hyper-V environment:</span></span><br /><br /> <span data-ttu-id="94896-167">-   **固定大小磁盘-** 固定大小虚拟硬盘 (VHD) 是一个数据块是在创建时定义的最大磁盘大小的物理磁盘上预先分配。</span><span class="sxs-lookup"><span data-stu-id="94896-167">-   **Fixed size disks -** A fixed-size virtual hard disk (VHD) is one for which data blocks are pre-allocated on a physical disk based on the maximum disk size defined at the time of creation.</span></span> <span data-ttu-id="94896-168">例如，如果您创建的 100 GB 的固定大小 VHD，HYPER-V 将分配所有 100 GB 的数据块存储，除了创建新的 VHD 时所需的 VHD 页眉和页脚的开销。</span><span class="sxs-lookup"><span data-stu-id="94896-168">For example, if you create a 100 GB fixed-size VHD, Hyper-V will allocate all 100 GB of data block storage in addition to the overhead required for the VHD headers and footers when it creates the new VHD.</span></span><br /><span data-ttu-id="94896-169">-   **动态扩展磁盘-** 动态扩展 VHD 是一个为其初始虚拟硬盘包含任何数据块。</span><span class="sxs-lookup"><span data-stu-id="94896-169">-   **Dynamically expanding disks -** A dynamically expanding VHD is one for which the initial virtual hard disk contains no data blocks.</span></span> <span data-ttu-id="94896-170">而是动态分配空间，随着数据写入到 VHD，最多创建 VHD 时指定的最大大小。</span><span class="sxs-lookup"><span data-stu-id="94896-170">Instead space is dynamically allocated as data is written to the VHD, up to the maximum size specified when the VHD was created.</span></span> <span data-ttu-id="94896-171">例如，100 GB 动态扩展磁盘最初包含仅 VHD 标头，并且需要小于 2 MB 的物理存储空间。</span><span class="sxs-lookup"><span data-stu-id="94896-171">For example, a 100-GB dynamically expanding disk initially contains only VHD headers and requires less than 2 MB of physical storage space.</span></span> <span data-ttu-id="94896-172">虚拟机的情况下，新数据写入到动态扩展 VHD，会以 2 MB 到 VHD 文件，最多为 100 GB 的增量分配其他物理数据块。</span><span class="sxs-lookup"><span data-stu-id="94896-172">As new data is written by the virtual machine to the dynamically expanding VHD, additional physical data blocks are allocated in 2-MB increments to the VHD file, up to a maximum of 100 GB.</span></span><br /><span data-ttu-id="94896-173">-   **差异磁盘-** 差异磁盘是一种特殊类型的动态扩展的"父级"VHD 与关联的 VHD 文件。</span><span class="sxs-lookup"><span data-stu-id="94896-173">-   **Differencing Disks -** A differencing disk is a special type of dynamically expanding VHD file that is associated with a “parent” VHD.</span></span> <span data-ttu-id="94896-174">在此父/子存储拓扑中，父磁盘保持不变，"子"差异磁盘仅对所做的任何写入操作。</span><span class="sxs-lookup"><span data-stu-id="94896-174">In this parent/child storage topology, the parent disk remains unchanged and any write operations made to the “child” differencing disk only.</span></span> <span data-ttu-id="94896-175">任何读取的操作首先检查对差异磁盘，以查看更新的内容已写入到差异磁盘;如果内容不在差异磁盘，然后从父 VHD 读取内容。</span><span class="sxs-lookup"><span data-stu-id="94896-175">Any read operations are first checked against the differencing disk to see whether updated content was written to the differencing disk; if the content isn’t in the differencing disk, then the content is read from the parent VHD.</span></span> <span data-ttu-id="94896-176">差异磁盘可用于需要维护特定基准配置和想要轻松地测试和回滚然后更改到基线的方案。</span><span class="sxs-lookup"><span data-stu-id="94896-176">Differencing disks are useful for scenarios where you need to maintain a particular baseline configuration and would like to easily test and then rollback changes to the baseline.</span></span> <span data-ttu-id="94896-177">可用于测试的父/子存储拓扑通过差异磁盘提供灵活性时，这不是性能的最佳配置因为没有与维护父/子拓扑相关的开销使用差异磁盘时需要。</span><span class="sxs-lookup"><span data-stu-id="94896-177">While the flexibility of the parent/child storage topology provided through differencing disks is useful for testing, this is not the optimal configuration for performance because there is overhead associated with maintaining the parent/child topology required when using differencing disks.</span></span><br /><span data-ttu-id="94896-178">-   **传递磁盘，即**传递磁盘功能，来宾操作系统来绕过 HYPER-V 主机文件系统和直接访问磁盘。</span><span class="sxs-lookup"><span data-stu-id="94896-178">-   **Passthrough disks –** The passthrough disk feature allows the guest operating system to bypass the Hyper-V Host file system and access the disk directly.</span></span> <span data-ttu-id="94896-179">都提供给来宾操作系统可通过传递磁盘必须设置为"脱机"中的 HYPER-V 主机以确保，主机和来宾操作系统不要尝试同时访问该磁盘。</span><span class="sxs-lookup"><span data-stu-id="94896-179">Disks that are made available to guest operating systems via passthrough must be set to “offline” in the Hyper-V host to ensure that both the host and guest operating system do not attempt to access the disk simultaneously.</span></span> <span data-ttu-id="94896-180">传递磁盘存储选项确实提供了相比其他磁盘的边际性能优势，但不支持的虚拟磁盘，例如虚拟机快照和聚类分析支持特定功能。</span><span class="sxs-lookup"><span data-stu-id="94896-180">The passthrough disk does offer a marginal performance advantage over other disk storage options but does not support certain functionality of virtual disks, such as Virtual machine snapshots and clustering support.</span></span> <span data-ttu-id="94896-181">因此使用的传递磁盘功能建议不要在 BizTalk 或 SQL Server 环境中因为边际性能优势会超过偏移量为缺少的功能。</span><span class="sxs-lookup"><span data-stu-id="94896-181">Therefore use of the passthrough disk feature is not recommended in a BizTalk or SQL Server environment because the marginal performance benefits are more than offset by the missing functionality.</span></span><br /><br /> <span data-ttu-id="94896-182">有关磁盘存储选项中使用的 HYPER-V 提供的相对性能的详细信息，请参阅博客文章"HYPER-V 存储分析"，在[ http://go.microsoft.com/fwlink/?LinkID=132848 ](http://go.microsoft.com/fwlink/?LinkID=132848)。</span><span class="sxs-lookup"><span data-stu-id="94896-182">For more information about the relative performance of disk storage choices provided with Hyper-V, see the blog entry “Hyper-V Storage Analysis”, at [http://go.microsoft.com/fwlink/?LinkID=132848](http://go.microsoft.com/fwlink/?LinkID=132848).</span></span>|  
|<span data-ttu-id="94896-183">配置为使用 SCSI 控制器的数据卷的磁盘</span><span class="sxs-lookup"><span data-stu-id="94896-183">Configure disks for data volumes using the SCSI controller</span></span>|<span data-ttu-id="94896-184">此建议，因为如果安装 HYPER-V 集成服务，而无需安装 HYPER-V 集成服务中，模拟的 IDE 控制器可用，可以仅安装 SCSI 控制器。</span><span class="sxs-lookup"><span data-stu-id="94896-184">This is recommended because the SCSI controller can only be installed if Hyper-V integration services are installed whereas the emulated IDE controller is available without installing Hyper-V integration services.</span></span> <span data-ttu-id="94896-185">使用 integration services 提供的 IDE 筛选器驱动程序执行的磁盘 I/O 是明显优于磁盘 I/O 性能提供与仿真的 IDE 控制器。</span><span class="sxs-lookup"><span data-stu-id="94896-185">Disk I/O performed using the IDE filter driver provided with integration services is significantly better than disk I/O performance provided with the emulated IDE controller.</span></span> <span data-ttu-id="94896-186">因此，若要确保获得最佳磁盘 I/O 性能的 HYPER-V 虚拟化环境中的数据文件，主机和来宾操作系统上安装集成服务并将数据卷的磁盘合成 SCSI 控制器的配置。</span><span class="sxs-lookup"><span data-stu-id="94896-186">Therefore, to ensure optimal disk I/O performance for the data files in a Hyper-V virtualized environment, install integration services on both the host and guest operating system and configure disks for data volumes with the synthetic SCSI controller.</span></span> <span data-ttu-id="94896-187">对于跨多个数据驱动器的高密集型存储 I/O 工作负荷，每个 VHD 应附加到单独的合成 SCSI 控制器以提高整体性能。</span><span class="sxs-lookup"><span data-stu-id="94896-187">For highly intensive storage I/O workloads that span multiple data drives, each VHD should be attached to a separate synthetic SCSI controller for better overall performance.</span></span> <span data-ttu-id="94896-188">此外，每个 VHD 应存储在单独的物理磁盘上。</span><span class="sxs-lookup"><span data-stu-id="94896-188">In addition, each VHD should be stored on separate physical disks.</span></span> <span data-ttu-id="94896-189">**重要提示：** 不要将系统磁盘附加到 SCSI 控制器。</span><span class="sxs-lookup"><span data-stu-id="94896-189">**Important:**  Do not attach a system disk to a SCSI controller.</span></span> <span data-ttu-id="94896-190">包含一个操作系统虚拟硬盘必须附加到 IDE 控制器。</span><span class="sxs-lookup"><span data-stu-id="94896-190">A virtual hard disk that contains an operating system must be attached to an IDE controller.</span></span>|  

### <a name="optimize-memory-performance"></a><span data-ttu-id="94896-191">优化内存性能</span><span class="sxs-lookup"><span data-stu-id="94896-191">Optimize Memory Performance</span></span>  
 <span data-ttu-id="94896-192">请遵循以下准则来优化的 HYPER-V 虚拟环境中运行的来宾操作系统的内存性能：</span><span class="sxs-lookup"><span data-stu-id="94896-192">Follow these guidelines to optimize memory performance of guest operating systems running in a Hyper-V virtual environment:</span></span>  

|<span data-ttu-id="94896-193">步骤</span><span class="sxs-lookup"><span data-stu-id="94896-193">Step</span></span>|<span data-ttu-id="94896-194">参考</span><span class="sxs-lookup"><span data-stu-id="94896-194">Reference</span></span>|  
|----------|---------------|  
|<span data-ttu-id="94896-195">确保有足够的内存将托管的 HYPER-V 虚拟机的物理计算机上安装</span><span class="sxs-lookup"><span data-stu-id="94896-195">Ensure there is sufficient memory installed on the physical computer that hosts the Hyper-V virtual machines</span></span>|<span data-ttu-id="94896-196">可用物理内存通常是 HYPER-V 虚拟机上运行的 BizTalk Server 性能的最重要因素。</span><span class="sxs-lookup"><span data-stu-id="94896-196">-   Available physical memory is often the most significant performance factor for BizTalk Server running on a Hyper-V virtual machine.</span></span> <span data-ttu-id="94896-197">这是因为每个虚拟机必须驻留在非分页缓冲池内存中或不能分页到磁盘的内存。</span><span class="sxs-lookup"><span data-stu-id="94896-197">This is because each virtual machine must reside in non-paged-pool memory, or memory that cannot be paged to the disk.</span></span> <span data-ttu-id="94896-198">因为非页面缓冲池内存不能分页到磁盘，托管虚拟机的物理计算机应具有的内存总量的可用物理内存分配的每个虚拟机以及下列：</span><span class="sxs-lookup"><span data-stu-id="94896-198">Because non-paged-pool memory cannot be paged to disk, the physical computer that hosts the virtual machines should have available physical memory equal to the sum of the memory allocated for each virtual machine plus the following:</span></span><br />     <span data-ttu-id="94896-199">虚拟机监控程序的 300 MB 加上 32 MB 的第一个 GB 的 RAM 分配给每个虚拟机、 另一个 8 MB 的每个其他 GB 的 RAM 分配给每个虚拟机和主机的 512 MB根分区上运行的操作系统</span><span class="sxs-lookup"><span data-stu-id="94896-199">300 MB for the Hypervisor                         plus 32 MB for the first GB of RAM allocated to each virtual machine                         plus another 8 MB for every additional GB of RAM allocated to each virtual machine                         plus 512 MB for the host operating system running on the root partition</span></span><br />     <span data-ttu-id="94896-200">例如，如果 HYPER-V 虚拟机所分配到 2 GB 的内存中的 HYPER-V 管理器，当运行的 HYPER-V 虚拟机是大约 2388 MB 时使用的实际物理内存 (虚拟机分配的虚拟机监控程序 300 MB + 2 GB +32 MB + 8 MB = 2388 MB)。</span><span class="sxs-lookup"><span data-stu-id="94896-200">For example, if a Hyper-V virtual machine is allocated 2 GB of memory in the Hyper-V Manager, the actual physical memory used when running that Hyper-V virtual machine would be approximately 2388MB (300MB for the hypervisor +2GB allocated for the virtual machine + 32MB + 8MB = 2388MB).</span></span> <span data-ttu-id="94896-201">虚拟机监控程序只需一次进行加载，因为初始化的后续虚拟机不会产生与加载虚拟机监控程序相关的留出 300 MB 开销。</span><span class="sxs-lookup"><span data-stu-id="94896-201">Because the hypervisor only needs to be loaded once, initialization of subsequent virtual machines does not incur the 300 MB overhead associated with loading the hypervisor.</span></span> <span data-ttu-id="94896-202">因此，如果两个 HYPER-V 虚拟机是每个已分配的 2 GB 的内存中的 HYPER-V 管理器，使用这些 HYPER-V 虚拟机运行时的实际物理内存将为大约 4476 MB （虚拟机监控程序 300 MB + 4 GB 为分配的虚拟机 + 64 MB + 16 MB = 4476 MB)。</span><span class="sxs-lookup"><span data-stu-id="94896-202">Therefore, if two Hyper-V virtual machines are each allocated 2 GB of memory in the Hyper-V Manager, the actual physical memory used when running these Hyper-V virtual machines would be approximately 4476MB (300MB for the hypervisor +4GB allocated for the virtual machines + 64 MB + 16MB = 4476MB).</span></span> <span data-ttu-id="94896-203">**注意：**     作为常规经验，计划分配为根分区提供服务，例如 I/O 虚拟化、 快照文件支持和子分区管理至少 512 MB 内存。</span><span class="sxs-lookup"><span data-stu-id="94896-203">**Note:**      As a general rule of thumb, plan to allocate at least 512 MB memory for the root partition to provide services such as I/O virtualization, snapshot files support, and child partition management.</span></span><br /><span data-ttu-id="94896-204">-   **使用 64 位来宾操作系统时可能**– 请考虑使用为每个来宾操作系统的 64 位操作系统。</span><span class="sxs-lookup"><span data-stu-id="94896-204">-   **Use a 64-bit guest operating system when possible** – Consider using a 64-bit operating system for each guest operating system.</span></span> <span data-ttu-id="94896-205">这样应做因为默认情况下，32 位 Windows 操作系统仅可以解决最多 2 GB 的每个进程虚拟地址空间。</span><span class="sxs-lookup"><span data-stu-id="94896-205">This should be done because by default, 32-bit Windows operating systems can only address up to 2GB of virtual address space per process.</span></span> <span data-ttu-id="94896-206">64 位操作系统的安装允许应用程序充分利用托管的 HYPER-V 虚拟机的物理计算机上安装的内存。</span><span class="sxs-lookup"><span data-stu-id="94896-206">Installation of a 64-bit operating system allows applications to take full advantage of the memory installed on the physical computer that hosts the Hyper-V virtual machines.</span></span>|  

### <a name="optimize-network-performance"></a><span data-ttu-id="94896-207">优化网络性能</span><span class="sxs-lookup"><span data-stu-id="94896-207">Optimize Network Performance</span></span>  
 <span data-ttu-id="94896-208">HYPER-V 虚拟机中支持合成和模拟的网络适配器，但是合成设备提供显著提高性能并减少 CPU 开销。</span><span class="sxs-lookup"><span data-stu-id="94896-208">Hyper-V supports synthetic and emulated network adapters in virtual machines, but the synthetic devices offer significantly better performance and reduced CPU overhead.</span></span> <span data-ttu-id="94896-209">每个这些适配器连接到虚拟网络交换机，如果需要外部网络连接可以连接到物理网络适配器。</span><span class="sxs-lookup"><span data-stu-id="94896-209">Each of these adapters is connected to a virtual network switch, which can be connected to a physical network adapter if external network connectivity is needed.</span></span> <span data-ttu-id="94896-210">遵循本部分中的建议，以优化网络性能的来宾操作系统的 HYPER-V 虚拟环境中运行。</span><span class="sxs-lookup"><span data-stu-id="94896-210">Follow the recommendations in this section to optimize network performance of guest operating systems running in a Hyper-V virtual environment.</span></span>  

> [!NOTE]
>  <span data-ttu-id="94896-211">这些建议是从"性能优化准则的 Windows Server 2008 R2"白皮书可供下载的"性能优化的虚拟化服务器"部分[ http://go.microsoft.com/fwlink/?LinkID=202087 ](http://go.microsoft.com/fwlink/?LinkID=202087)。</span><span class="sxs-lookup"><span data-stu-id="94896-211">These recommendations are from the “Performance Tuning for Virtualization Servers” section of the “Performance Tuning Guidelines for Windows Server 2008 R2” whitepaper available for download at [http://go.microsoft.com/fwlink/?LinkID=202087](http://go.microsoft.com/fwlink/?LinkID=202087).</span></span> <span data-ttu-id="94896-212">有关如何优化在根分区中，包括中断裁决的网络适配器，请参阅本指南的"性能优化的网络子系统"部分。</span><span class="sxs-lookup"><span data-stu-id="94896-212">For how to tune the network adapter in the root partition, including interrupt moderation, refer to the “Performance Tuning for Networking Subsystem” section of this guide.</span></span> <span data-ttu-id="94896-213">应将应用在该部分中的 TCP tunings，如果需要，为子分区。</span><span class="sxs-lookup"><span data-stu-id="94896-213">The TCP tunings in that section should be applied, if required, to the child partitions.</span></span>  

|                                                                            <span data-ttu-id="94896-214">步骤</span><span class="sxs-lookup"><span data-stu-id="94896-214">Step</span></span>                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                 <span data-ttu-id="94896-215">参考</span><span class="sxs-lookup"><span data-stu-id="94896-215">Reference</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   <span data-ttu-id="94896-216">若要使用专用虚拟网络在同一的 HYPER-V 主机计算机运行的 HYPER-V 虚拟机配置</span><span class="sxs-lookup"><span data-stu-id="94896-216">Configure Hyper-V Virtual Machines that are Running on the same Hyper-V host computer to use a Private Virtual Network</span></span>                   |                                                                                                                                                                                                                                                                                                                                  <span data-ttu-id="94896-217">请遵循中的"配置的 HYPER-V 虚拟机相同的 HYPER-V 上运行的托管计算机以使用专用虚拟网络"部分建议[网络优化](~/technical-guides/network-optimizations.md)。</span><span class="sxs-lookup"><span data-stu-id="94896-217">Follow recommendations in the “Configure Hyper-V Virtual Machines that are Running on the same Hyper-V host computer to use a Private Virtual Network” section of [Network Optimizations](~/technical-guides/network-optimizations.md).</span></span>                                                                                                                                                                                                                                                                                                                                  |
|                                                <span data-ttu-id="94896-218">禁用 TCP 卸载虚拟机网卡</span><span class="sxs-lookup"><span data-stu-id="94896-218">Disable TCP Offloading for the Virtual Machine Network Cards</span></span>                                                |                                                                                                                                                                                                                                                                                                                                                               <span data-ttu-id="94896-219">请遵循中的"禁用 TCP 卸载的虚拟机网络卡"部分建议[网络优化](~/technical-guides/network-optimizations.md)。</span><span class="sxs-lookup"><span data-stu-id="94896-219">Follow recommendations in the “Disable TCP Offloading for the Virtual Machine Network Cards” section of [Network Optimizations](~/technical-guides/network-optimizations.md).</span></span>                                                                                                                                                                                                                                                                                                                                                               |
|                                      <span data-ttu-id="94896-220">配置来宾操作系统为使用 HYPER-V 合成网络适配器。</span><span class="sxs-lookup"><span data-stu-id="94896-220">Configure guest operating systems to use the Hyper-V synthetic network adapter.</span></span>                                       |                                                                                                                                                   <span data-ttu-id="94896-221">专为虚拟机以实现显著的合成网络适配器能减少 CPU 开销的 HYPER-V 功能相比到仿真的网络适配器，以模拟现有硬件的网络 I/O。</span><span class="sxs-lookup"><span data-stu-id="94896-221">Hyper-V features a synthetic network adapter that is designed specifically for VMs to achieve significantly reduced CPU overhead on network I/O when it is compared to the emulated network adapter that mimics existing hardware.</span></span> <span data-ttu-id="94896-222">合成网络适配器之间的效率更高的数据传输使用共享的内存其在 VMBus 上的子和根分区进行通信。</span><span class="sxs-lookup"><span data-stu-id="94896-222">The synthetic network adapter communicates between the child and root partitions over the VMBus by using shared memory for more efficient data transfer.</span></span> <br /><span data-ttu-id="94896-223">仿真的网络适配器应通过 VM 设置对话框中删除并替换为合成网络适配器。</span><span class="sxs-lookup"><span data-stu-id="94896-223">The emulated network adapter should be removed through the VM settings dialog box and replaced with a synthetic network adapter.</span></span> <span data-ttu-id="94896-224">来宾要求安装 VM 集成服务。</span><span class="sxs-lookup"><span data-stu-id="94896-224">The guest requires that the VM integration services be installed.</span></span>                                                                                                                                                    |
|                          <span data-ttu-id="94896-225">如果可用，则启用根分区中的物理网络适配器驱动程序的卸载功能。</span><span class="sxs-lookup"><span data-stu-id="94896-225">If available, enable offload capabilities for the physical network adapter driver in the root partition.</span></span>                          | <span data-ttu-id="94896-226">因为本机方案中，卸载与物理网络适配器中的功能减少 VM 方案中的网络 I/o 的 CPU 的使用率。</span><span class="sxs-lookup"><span data-stu-id="94896-226">As with the native scenario, offload capabilities in the physical network adapter reduce the CPU usage of network I/Os in VM scenarios.</span></span> <span data-ttu-id="94896-227">HYPER-V 当前使用 LSOv1 和 TCPv4 校验和卸载。</span><span class="sxs-lookup"><span data-stu-id="94896-227">Hyper-V currently uses LSOv1 and TCPv4 checksum offload.</span></span> <span data-ttu-id="94896-228">必须在根分区中的物理网络适配器的驱动程序中启用卸载功能。</span><span class="sxs-lookup"><span data-stu-id="94896-228">The offload capabilities must be enabled in the driver for the physical network adapter in the root partition.</span></span> <span data-ttu-id="94896-229">有关在网络适配器的卸载功能的详细信息，请参阅"性能优化准则的 Windows Server 2008 R2"白皮书可用于"性能优化的虚拟化服务器"部分的"选择网络适配器"部分在下载[ http://go.microsoft.com/fwlink/?LinkID=202087 ](http://go.microsoft.com/fwlink/?LinkID=202087)。</span><span class="sxs-lookup"><span data-stu-id="94896-229">For details on offload capabilities in network adapters, refer to the “Choosing a Network Adapter” section of the “Performance Tuning for Virtualization Servers” section of the “Performance Tuning Guidelines for Windows Server 2008 R2” whitepaper available for download at [http://go.microsoft.com/fwlink/?LinkID=202087](http://go.microsoft.com/fwlink/?LinkID=202087).</span></span><br /><span data-ttu-id="94896-230">驱动程序对于某些网络适配器禁用 LSOv1，但默认情况下启用 LSOv2。</span><span class="sxs-lookup"><span data-stu-id="94896-230">Drivers for certain network adapters disable LSOv1 but enable LSOv2 by default.</span></span> <span data-ttu-id="94896-231">使用驱动程序，系统管理员必须显式启用 LSOv1**属性**对话框的设备管理器中。</span><span class="sxs-lookup"><span data-stu-id="94896-231">System administrators must explicitly enable LSOv1 by using the driver **Properties** dialog box in Device Manager.</span></span> |
|                                        <span data-ttu-id="94896-232">配置网络交换机中的拓扑的多个网络适配器使用。</span><span class="sxs-lookup"><span data-stu-id="94896-232">Configure network switch topology to make use of multiple network adapters.</span></span>                                         |                                                                                                                                                                                                                                             <span data-ttu-id="94896-233">HYPER-V 支持创建多个虚拟网络交换机，其中每个可以附加到的物理网络适配器必要。</span><span class="sxs-lookup"><span data-stu-id="94896-233">Hyper-V supports creating multiple virtual network switches, each of which can be attached to a physical network adapter if needed.</span></span> <span data-ttu-id="94896-234">在 VM 中的每个网络适配器可以连接到虚拟网络交换机。</span><span class="sxs-lookup"><span data-stu-id="94896-234">Each network adapter in a VM can be connected to a virtual network switch.</span></span> <span data-ttu-id="94896-235">如果物理服务器具有多个网络适配器，网络密集型负载的 Vm 可受益于连接到不同的虚拟交换机，以更好地使用物理网络适配器。</span><span class="sxs-lookup"><span data-stu-id="94896-235">If the physical server has multiple network adapters, VMs with network-intensive loads can benefit from being connected to different virtual switches to better use the physical network adapters.</span></span>                                                                                                                                                                                                                                             |
| <span data-ttu-id="94896-236">如果在多个物理网络卡安装在 HYPER-V 主机计算机，为一个逻辑处理器到每个网络卡的绑定设备中断。</span><span class="sxs-lookup"><span data-stu-id="94896-236">If multiple physical network cards are installed on the Hyper-V host computer, bind device interrupts for each network card to a single logical processor.</span></span> |                                                                                                                                                                                            <span data-ttu-id="94896-237">在某些工作负荷，绑定到一个逻辑处理器的单个网络适配器设备中断可以提高性能的 HYPER-V。</span><span class="sxs-lookup"><span data-stu-id="94896-237">Under certain workloads, binding the device interrupts for a single network adapter to a single logical processor can improve performance for Hyper-V.</span></span> <span data-ttu-id="94896-238">我们建议此高级优化，仅用于解决特定问题中完全使用的网络带宽。</span><span class="sxs-lookup"><span data-stu-id="94896-238">We recommend this advanced tuning only to address specific problems in fully using network bandwidth.</span></span> <span data-ttu-id="94896-239">系统管理员可以使用 IntPolicy 工具以将设备中断绑定到特定的处理器。</span><span class="sxs-lookup"><span data-stu-id="94896-239">System administrators can use the IntPolicy tool to bind device interrupts to specific processors.</span></span> <span data-ttu-id="94896-240">有关 IntPolicy 工具的详细信息，请参阅[ http://go.microsoft.com/fwlink/?LinkID=129773 ](http://go.microsoft.com/fwlink/?LinkID=129773)。</span><span class="sxs-lookup"><span data-stu-id="94896-240">For more information about the IntPolicy tool, see [http://go.microsoft.com/fwlink/?LinkID=129773](http://go.microsoft.com/fwlink/?LinkID=129773).</span></span>                                                                                                                                                                                             |
|                                        <span data-ttu-id="94896-241">如果可能，请启用 VLAN 标记的 HYPER-V 合成网络适配器。</span><span class="sxs-lookup"><span data-stu-id="94896-241">If possible, enable VLAN tagging for the Hyper-V synthetic network adapter.</span></span>                                         |                                                                                                                                                                                                                                                 <span data-ttu-id="94896-242">HYPER-V 合成网络适配器支持 VLAN 标记。</span><span class="sxs-lookup"><span data-stu-id="94896-242">The Hyper-V synthetic network adapter supports VLAN tagging.</span></span> <span data-ttu-id="94896-243">如果物理网络适配器支持的 NDIS_ENCAPSULATION_IEEE_802_3_P_AND_Q_IN_OOB 封装为大量发送和校验和卸载，它提供了显著提高网络性能。</span><span class="sxs-lookup"><span data-stu-id="94896-243">It provides significantly better network performance if the physical network adapter supports NDIS_ENCAPSULATION_IEEE_802_3_P_AND_Q_IN_OOB encapsulation for both large send and checksum offload.</span></span> <span data-ttu-id="94896-244">如果没有此支持，HYPER-V 要求 VLAN 标记的数据包不能使用硬件卸载功能和可以减少网络性能。</span><span class="sxs-lookup"><span data-stu-id="94896-244">Without this support, Hyper-V cannot use hardware offload for packets that require VLAN tagging and network performance can be decreased.</span></span>                                                                                                                                                                                                                                                 |
|                           <span data-ttu-id="94896-245">高速网络适配器的 HYPER-V 主机计算机上为安装和配置最大性能。</span><span class="sxs-lookup"><span data-stu-id="94896-245">Install high speed network adapter on the Hyper-V host computer and configure for maximum performance.</span></span>                           |                                                                                                                                                                                                                                                                                   <span data-ttu-id="94896-246">-HYPER-V 主机计算机上安装 1 GB 网络适配器，请考虑使用和配置网络适配器而不是使用"自动协商"固定速度是非常重要的网络速度、 双工、 和流控制参数设置为相对应交换机上的设置对它们所连接到。</span><span class="sxs-lookup"><span data-stu-id="94896-246">Consider installing 1-GB network adapters on the Hyper-V host computer and configure the network adapters with a fixed speed as opposed to using “auto negotiate” - It is very important that the network speed, duplex, and flow control parameters are set to correspond to the settings on the switch to which they are connected.</span></span>                                                                                                                                                                                                                                                                                   |
|                                                 <span data-ttu-id="94896-247">遵循有关优化网络性能的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="94896-247">Follow best practices for optimizing network performance.</span></span>                                                  |                                                                                                                                                                <span data-ttu-id="94896-248">本主题[网络优化](~/technical-guides/network-optimizations.md)提供了有关优化网络性能的常规指南。</span><span class="sxs-lookup"><span data-stu-id="94896-248">The topic [Network Optimizations](~/technical-guides/network-optimizations.md) offers general guidance for optimizing network performance.</span></span> <span data-ttu-id="94896-249">虽然本主题不提供用于优化性能的特定建议[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]中的 HYPER-V 虚拟化环境的技术包括适用于任何[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]解决方案中，是否在物理硬件上或 HYPER-V 上运行虚拟化的环境。</span><span class="sxs-lookup"><span data-stu-id="94896-249">While this topic does not offer specific recommendations for optimizing performance of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] in a Hyper-V virtualized environment, the techniques are applicable to any [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution, whether running on physical hardware or on a Hyper-V virtualized environment.</span></span>                                                                                                                                                                 |

## <a name="optimize-sql-server-performance"></a><span data-ttu-id="94896-250">优化 SQL Server 性能</span><span class="sxs-lookup"><span data-stu-id="94896-250">Optimize SQL Server Performance</span></span>  
 <span data-ttu-id="94896-251">请按照本主题中的建议[SQL Server 优化](~/technical-guides/sql-server-optimizations.md)以优化 SQL Server 的 BizTalk Server 解决方案的性能。</span><span class="sxs-lookup"><span data-stu-id="94896-251">Follow the recommendations in the topic [SQL Server Optimizations](~/technical-guides/sql-server-optimizations.md) to optimize SQL Server performance for the BizTalk Server solution.</span></span> <span data-ttu-id="94896-252">虽然本主题不提供用于优化性能的特定建议[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]中的 HYPER-V 虚拟化环境的技术包括适用于任何[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]解决方案中，是否在物理硬件上或 HYPER-V 上运行虚拟化的环境。</span><span class="sxs-lookup"><span data-stu-id="94896-252">While this topic does not offer specific recommendations for optimizing performance of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] in a Hyper-V virtualized environment, the techniques are applicable to any [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution, whether running on physical hardware or on a Hyper-V virtualized environment.</span></span>  

## <a name="optimize-biztalk-server-solution"></a><span data-ttu-id="94896-253">优化 BizTalk Server 解决方案</span><span class="sxs-lookup"><span data-stu-id="94896-253">Optimize BizTalk Server Solution</span></span>  
 <span data-ttu-id="94896-254">请按照本主题中的建议[BizTalk Server 优化](~/technical-guides/biztalk-server-optimizations.md)优化 BizTalk Server 解决方案的性能。</span><span class="sxs-lookup"><span data-stu-id="94896-254">Follow the recommendations in the topic [BizTalk Server Optimizations](~/technical-guides/biztalk-server-optimizations.md) to optimize performance of the BizTalk Server solution.</span></span> <span data-ttu-id="94896-255">虽然本主题不提供用于优化性能的特定建议[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]中的 HYPER-V 虚拟化环境的技术包括适用于任何[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]解决方案中，是否在物理硬件上或 HYPER-V 上运行虚拟化的环境。</span><span class="sxs-lookup"><span data-stu-id="94896-255">While this topic does not offer specific recommendations for optimizing performance of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] in a Hyper-V virtualized environment, the techniques are applicable to any [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] solution, whether running on physical hardware or on a Hyper-V virtualized environment.</span></span>