---
title: 数据库的高可用性 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 63813d87-1ce4-4645-bb2a-d55e413fcace
caps.latest.revision: 3
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 841481946dd0eabd7707eb3923563741264129c5
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65277180"
---
# <a name="high-availability-for-databases"></a><span data-ttu-id="66884-102">数据库的高可用性</span><span class="sxs-lookup"><span data-stu-id="66884-102">High Availability for Databases</span></span>
<span data-ttu-id="66884-103">BizTalk Server 很大程度依赖 SQL Server 上为数据存储和数据暂留。</span><span class="sxs-lookup"><span data-stu-id="66884-103">BizTalk Server relies heavily on SQL Server for data store and data persistence.</span></span> <span data-ttu-id="66884-104">所有其他组件和 BizTalk Server 中的主机具有特定的角色过程中集成完全不同的业务应用程序 （例如，接收、 处理或路由消息），但在数据库计算机捕获此工作并将其保存到磁盘。</span><span class="sxs-lookup"><span data-stu-id="66884-104">All other components and hosts in BizTalk Server have specific roles in the process of integrating disparate business applications (for example, receiving, processing, or routing messages), but the database computer captures this work and persists it to disk.</span></span> <span data-ttu-id="66884-105">例如，在 BizTalk Server 接收的传入消息，接收主机其保存到 MessageBox 数据库之前的其他主机检索业务流程处理和发送的消息。</span><span class="sxs-lookup"><span data-stu-id="66884-105">For example, when BizTalk Server receives an incoming message, the receive host persists it to the MessageBox database before other hosts retrieve the message for orchestration processing and sending.</span></span> <span data-ttu-id="66884-106">如果您的 BizTalk 解决方案包含业务流程，BizTalk Server 会将消息路由到的主机执行业务程序 （处理主机），并在业务流程完成后，将消息保存到 MessageBox 数据库中。</span><span class="sxs-lookup"><span data-stu-id="66884-106">If your BizTalk solution involves orchestration, BizTalk Server routes the message to the host that executes the business process (processing host), and saves the message to the MessageBox database after the orchestration finishes.</span></span> <span data-ttu-id="66884-107">发送主机然后将其发送到相应的发送适配器通过外部应用程序之前从数据库检索消息。</span><span class="sxs-lookup"><span data-stu-id="66884-107">The sending host then retrieves the message from the database before sending it to the external application through the appropriate send adapter.</span></span>  
  
 <span data-ttu-id="66884-108">若要为 BizTalk Server 数据库提供高可用性，使用 Windows 群集来配置运行 SQL Server 创建服务器群集的两个或多个计算机。</span><span class="sxs-lookup"><span data-stu-id="66884-108">To provide high availability for the BizTalk Server databases, use Windows Clustering to configure two or more computers that are running SQL Server to create a server cluster.</span></span> <span data-ttu-id="66884-109">此服务器群集提供冗余和容错能力的 BizTalk Server 数据库。</span><span class="sxs-lookup"><span data-stu-id="66884-109">This server clustering provides redundancy and fault tolerance for the BizTalk Server databases.</span></span> <span data-ttu-id="66884-110">与负载平衡群集，不同的一组计算机共同作用以提高可用性和可伸缩性、 服务器群集通常涉及对数据库中的计算机的主动/被动配置，因此这一台计算机将提供备份对于其他资源。</span><span class="sxs-lookup"><span data-stu-id="66884-110">Unlike load-balanced clustering, where a group of computers functions together to increase availability and scalability, server clustering typically involves a pair of database computers in an active/passive configuration so that one computer provides backup resources for the other.</span></span>  
  
 <span data-ttu-id="66884-111">下图显示了通过主动/被动服务器群集的高可用性 BizTalk Server 数据库层。</span><span class="sxs-lookup"><span data-stu-id="66884-111">The following figure shows a BizTalk Server database tier with high availability through active/passive server clustering.</span></span>  
  
 <span data-ttu-id="66884-112">![BizTalk Server 数据库层](../core/media/tdi-highava-sqlcluster.gif "TDI_HighAva_SQLCluster")</span><span class="sxs-lookup"><span data-stu-id="66884-112">![BizTalk Server Database Tier](../core/media/tdi-highava-sqlcluster.gif "TDI_HighAva_SQLCluster")</span></span>  
  
 <span data-ttu-id="66884-113">如果主动数据库计算机遇到错误或失败，被动计算机将变为活动状态，并假定对数据库资源的控制，直到修复失败的计算机。</span><span class="sxs-lookup"><span data-stu-id="66884-113">If the active database computer encounters errors or fails, the passive computer becomes active and assumes control over the database resources until the failed computer is repaired.</span></span> <span data-ttu-id="66884-114">数据库服务故障转移和恢复到新的主动计算机的数据连接，并使 BizTalk 应用程序继续运行。</span><span class="sxs-lookup"><span data-stu-id="66884-114">The database service fails over and restores data connections to the new active computer and enables the BizTalk application to continue functioning.</span></span>  
  
## <a name="biztalk-server-databases"></a><span data-ttu-id="66884-115">BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-115">BizTalk Server Databases</span></span>  
 <span data-ttu-id="66884-116">Microsoft BizTalk Server 在 SQL Server 中安装多个数据库。</span><span class="sxs-lookup"><span data-stu-id="66884-116">Microsoft BizTalk Server installs several databases in SQL Server.</span></span> <span data-ttu-id="66884-117">下表显示了 BizTalk Server 数据库的典型使用特性。</span><span class="sxs-lookup"><span data-stu-id="66884-117">The following table shows typical usage characteristics for the BizTalk Server databases.</span></span>  
  
|<span data-ttu-id="66884-118">“数据库”</span><span class="sxs-lookup"><span data-stu-id="66884-118">Database</span></span>|<span data-ttu-id="66884-119">默认数据库名称</span><span class="sxs-lookup"><span data-stu-id="66884-119">Default database name</span></span>|<span data-ttu-id="66884-120">使用特性</span><span class="sxs-lookup"><span data-stu-id="66884-120">Usage characteristics</span></span>|  
|--------------|---------------------------|---------------------------|  
|<span data-ttu-id="66884-121">管理数据库</span><span class="sxs-lookup"><span data-stu-id="66884-121">Management database</span></span>|<span data-ttu-id="66884-122">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="66884-122">BizTalkMgmtDb</span></span>|<span data-ttu-id="66884-123">此数据库句柄使用率低的读取和写入操作。</span><span class="sxs-lookup"><span data-stu-id="66884-123">This database handles low-usage read and write operations.</span></span>|  
|<span data-ttu-id="66884-124">MessageBox 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-124">MessageBox database</span></span>|<span data-ttu-id="66884-125">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="66884-125">BizTalkMsgBoxDb</span></span>|<span data-ttu-id="66884-126">此数据库句柄高使用率读取和写入操作。</span><span class="sxs-lookup"><span data-stu-id="66884-126">This database handles high-usage read and write operations.</span></span>|  
|<span data-ttu-id="66884-127">跟踪数据库</span><span class="sxs-lookup"><span data-stu-id="66884-127">Tracking database</span></span>|<span data-ttu-id="66884-128">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="66884-128">BizTalkDTADb</span></span>|<span data-ttu-id="66884-129">此数据库处理可能的高使用率写入操作，具体取决于您配置要跟踪的数据量和使用率低的读取操作。</span><span class="sxs-lookup"><span data-stu-id="66884-129">This database handles potentially high-usage write operations depending on the amount of data that you configure to be tracked, and low-usage read operations.</span></span>|  
|<span data-ttu-id="66884-130">SSO 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-130">SSO database</span></span>|<span data-ttu-id="66884-131">SSODB</span><span class="sxs-lookup"><span data-stu-id="66884-131">SSODB</span></span>|<span data-ttu-id="66884-132">此数据库句柄使用率低的读取和写入操作。</span><span class="sxs-lookup"><span data-stu-id="66884-132">This database handles low-usage read and write operations.</span></span>|  
|<span data-ttu-id="66884-133">BAM 分析数据库</span><span class="sxs-lookup"><span data-stu-id="66884-133">BAM Analysis database</span></span>|<span data-ttu-id="66884-134">BAMAnalysis</span><span class="sxs-lookup"><span data-stu-id="66884-134">BAMAnalysis</span></span>|<span data-ttu-id="66884-135">此 SQL Server Analysis Services 数据库处理可能的高使用率读取和写入操作，具体取决于执行监视的级别。</span><span class="sxs-lookup"><span data-stu-id="66884-135">This SQL Server Analysis Services database handles potentially high-usage read and write operations, depending on the level of monitoring performed.</span></span>|  
|<span data-ttu-id="66884-136">BAM 星型架构数据库</span><span class="sxs-lookup"><span data-stu-id="66884-136">BAM Star Schema database</span></span>|<span data-ttu-id="66884-137">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="66884-137">BAMStarSchema</span></span>|<span data-ttu-id="66884-138">此 SQL Server Analysis Services 数据库处理可能的高使用率读取和写入操作，具体取决于执行监视的级别。</span><span class="sxs-lookup"><span data-stu-id="66884-138">This SQL Server Analysis Services database handles potentially high-usage read and write operations, depending on the level of monitoring performed.</span></span>|  
|<span data-ttu-id="66884-139">BAM 主导入数据库</span><span class="sxs-lookup"><span data-stu-id="66884-139">BAM Primary Import database</span></span>|<span data-ttu-id="66884-140">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="66884-140">BAMPrimaryImport</span></span>|<span data-ttu-id="66884-141">此 SQL Server Analysis Services 数据库处理可能的高使用率读取和写入操作，具体取决于执行监视的级别。</span><span class="sxs-lookup"><span data-stu-id="66884-141">This SQL Server Analysis Services database handles potentially high-usage read and write operations, depending on the level of monitoring performed.</span></span>|  
|<span data-ttu-id="66884-142">BAM 存档数据库</span><span class="sxs-lookup"><span data-stu-id="66884-142">BAM Archive database</span></span>|<span data-ttu-id="66884-143">BAMArchive</span><span class="sxs-lookup"><span data-stu-id="66884-143">BAMArchive</span></span>|<span data-ttu-id="66884-144">此 SQL Server Analysis Services 数据库处理可能的高使用率读取和写入操作，具体取决于执行监视的级别。</span><span class="sxs-lookup"><span data-stu-id="66884-144">This SQL Server Analysis Services database handles potentially high-usage read and write operations, depending on the level of monitoring performed.</span></span>|  
|<span data-ttu-id="66884-145">规则引擎数据库</span><span class="sxs-lookup"><span data-stu-id="66884-145">Rule Engine database</span></span>|<span data-ttu-id="66884-146">BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="66884-146">BizTalkRuleEngineDb</span></span>|<span data-ttu-id="66884-147">此数据库处理可能使用率低的读取和写入操作，除非更新的规则。</span><span class="sxs-lookup"><span data-stu-id="66884-147">This database handles potentially low-usage read and write operations, unless you update the rules.</span></span>|  
|<span data-ttu-id="66884-148">跟踪 Analysis Services 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-148">Tracking Analysis Services database</span></span>|<span data-ttu-id="66884-149">BizTalkAnalysisDb</span><span class="sxs-lookup"><span data-stu-id="66884-149">BizTalkAnalysisDb</span></span>|<span data-ttu-id="66884-150">此 SQL Server Analysis Services 数据库句柄高使用率读取和写入操作。</span><span class="sxs-lookup"><span data-stu-id="66884-150">This SQL Server Analysis Services database handles high-usage read and write operations.</span></span>|  
  
 <span data-ttu-id="66884-151">BizTalk Server 运行时操作通常使用前四个数据库 （管理数据库、 MessageBox 数据库、 跟踪数据库和 SSO 数据库）。</span><span class="sxs-lookup"><span data-stu-id="66884-151">BizTalk Server runtime operations typically use the first four databases (Management database, MessageBox databases, Tracking database, and SSO database).</span></span> <span data-ttu-id="66884-152">具体取决于这些数据库上的流量，可以将它们放在运行 SQL Server 的不同计算机上。</span><span class="sxs-lookup"><span data-stu-id="66884-152">Depending on the traffic on these databases, you can put them on separate computers that are running SQL Server.</span></span> <span data-ttu-id="66884-153">根据您使用的 BizTalk Server 功能，您可能部分或所有其他数据库表中。</span><span class="sxs-lookup"><span data-stu-id="66884-153">Depending on the BizTalk Server functionality that you use, you may have some or all of the other databases in the table.</span></span> <span data-ttu-id="66884-154">可以向外扩展，并根据需要群集这些数据库。</span><span class="sxs-lookup"><span data-stu-id="66884-154">You can scale out and cluster these databases as needed.</span></span>  
  
 <span data-ttu-id="66884-155">请确保遵循良好的 SQL Server 部署做法，例如，每个数据库使用不同的磁盘。</span><span class="sxs-lookup"><span data-stu-id="66884-155">Make sure that you follow good SQL Server deployment practices, such as using separate disks for each database.</span></span>  
  
 <span data-ttu-id="66884-156">对于 BizTalk Server 数据库中，我们建议您以下：</span><span class="sxs-lookup"><span data-stu-id="66884-156">For the BizTalk Server databases, we recommend that you do the following:</span></span>  
  
- <span data-ttu-id="66884-157">**设置故障转移群集**。</span><span class="sxs-lookup"><span data-stu-id="66884-157">**Set up failover clustering**.</span></span> <span data-ttu-id="66884-158">故障转移群集，SQL Server 可自动切换到工作服务器从发生故障的服务器的 SQL Server 实例的处理。</span><span class="sxs-lookup"><span data-stu-id="66884-158">Failover clustering enables SQL Server to automatically switch the processing for an instance of SQL Server from a failed server to a working server.</span></span>  
  
   <span data-ttu-id="66884-159">BAM 主导入数据库收集事件数据。</span><span class="sxs-lookup"><span data-stu-id="66884-159">The BAM Primary Import database collects event data.</span></span> <span data-ttu-id="66884-160">发生灾难时，自上次备份后写入 BAM 主导入数据库的数据将会丢失。</span><span class="sxs-lookup"><span data-stu-id="66884-160">In the event of a disaster, data that was written to the BAM Primary Import database since the last backup will be lost.</span></span> <span data-ttu-id="66884-161">因为没有方法来重新生成丢失的事件，它是启用故障转移群集在 BAM 主导入数据库上尤其重要。</span><span class="sxs-lookup"><span data-stu-id="66884-161">Because there is no way to regenerate lost events, it is especially important that you enable failover clustering on your BAM Primary Import database.</span></span>  
  
- <span data-ttu-id="66884-162">**使用 SQL Server RAID 1 + 0 （独立磁盘冗余阵列）**，尤其是对于 MessageBox 数据库和 BAM 主导入数据库。</span><span class="sxs-lookup"><span data-stu-id="66884-162">**Use SQL Server RAID 1+0 (redundant array of independent disks)**, especially for the MessageBox database and the BAM Primary Import database.</span></span>  
  
  <span data-ttu-id="66884-163">有关备份 BizTalk Server 数据库的信息，请参阅[灾难恢复最佳方案](../technical-guides/best-practices-for-disaster-recovery.md)。</span><span class="sxs-lookup"><span data-stu-id="66884-163">For information about backing up your BizTalk Server databases, see [Best Practices for Disaster Recovery](../technical-guides/best-practices-for-disaster-recovery.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="66884-164">Microsoft SQL Server 提供了一种软件解决方案，称为数据库镜像以用于增加数据库可用的可能性。</span><span class="sxs-lookup"><span data-stu-id="66884-164">Microsoft SQL Server provides a software solution known as database mirroring for increasing the probability that a database is available.</span></span> <span data-ttu-id="66884-165">使用 SQL Server 数据库镜像当前不支持为实现高可用性的 Microsoft BizTalk Server 数据库由于维护 BizTalk Server 数据库中的事务一致性可能存在问题的解决方案。</span><span class="sxs-lookup"><span data-stu-id="66884-165">The use of SQL Server database mirroring is not currently a supported solution for ensuring high availability of the Microsoft BizTalk Server databases because of potential problems maintaining transactional consistency in the BizTalk Server databases.</span></span>  
>   
>  <span data-ttu-id="66884-166">有关数据库镜像和 SQL Server 中的跨数据库事务的详细信息，请参阅[事务的可用性组和数据库镜像](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/transactions-always-on-availability-and-database-mirroring)。</span><span class="sxs-lookup"><span data-stu-id="66884-166">For more information about database mirroring and cross-database transactions in SQL Server, see [Transactions - availability groups and database mirroring](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/transactions-always-on-availability-and-database-mirroring).</span></span> <span data-ttu-id="66884-167">BizTalk Server 数据库应安装在 SQL Server 群集以确保高可用性，应为灾难恢复目的而利用日志传送。</span><span class="sxs-lookup"><span data-stu-id="66884-167">BizTalk Server databases should be installed on a SQL Server cluster to ensure high availability and log shipping should be utilized for purposes of disaster recovery.</span></span>  
>   
>  <span data-ttu-id="66884-168">有关日志传送的详细信息，请参阅[什么是 BizTalk Server 日志传送？](../technical-guides/what-is-biztalk-server-log-shipping.md)</span><span class="sxs-lookup"><span data-stu-id="66884-168">For more information about log shipping, see [What Is BizTalk Server Log Shipping?](../technical-guides/what-is-biztalk-server-log-shipping.md)</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="66884-169">本节内容</span><span class="sxs-lookup"><span data-stu-id="66884-169">In This Section</span></span>  
  
-   [<span data-ttu-id="66884-170">聚类分析 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-170">Clustering the BizTalk Server Databases</span></span>](../technical-guides/clustering-the-biztalk-server-databases2.md)  
  
-   [<span data-ttu-id="66884-171">横向扩展 BizTalk Server 数据库</span><span class="sxs-lookup"><span data-stu-id="66884-171">Scaling Out the BizTalk Server Databases</span></span>](../technical-guides/scaling-out-the-biztalk-server-databases.md)  
  
## <a name="see-also"></a><span data-ttu-id="66884-172">请参阅</span><span class="sxs-lookup"><span data-stu-id="66884-172">See Also</span></span>  
 <span data-ttu-id="66884-173">[规划高可用性](../technical-guides/planning-for-high-availability2.md) </span><span class="sxs-lookup"><span data-stu-id="66884-173">[Planning for High Availability](../technical-guides/planning-for-high-availability2.md) </span></span>  
 <span data-ttu-id="66884-174">[BizTalk 主机的的高可用性](../technical-guides/high-availability-for-biztalk-hosts.md) </span><span class="sxs-lookup"><span data-stu-id="66884-174">[High Availability for BizTalk Hosts](../technical-guides/high-availability-for-biztalk-hosts.md) </span></span>  
 <span data-ttu-id="66884-175">[主密钥服务器的高可用性](../technical-guides/high-availability-for-the-master-secret-server.md) </span><span class="sxs-lookup"><span data-stu-id="66884-175">[High Availability for the Master Secret Server](../technical-guides/high-availability-for-the-master-secret-server.md) </span></span>  
 [<span data-ttu-id="66884-176">灾难恢复</span><span class="sxs-lookup"><span data-stu-id="66884-176">Disaster Recovery</span></span>](../technical-guides/disaster-recovery.md)