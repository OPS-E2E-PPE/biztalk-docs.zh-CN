---
title: 规划跟踪 |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 8ffc8573-1b4a-47c7-96ab-0471f43facf5
caps.latest.revision: 3
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2ddfc3a9490bb85169d56526b706c1b159aef8d9
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65393460"
---
# <a name="planning-for-tracking"></a><span data-ttu-id="385b1-102">规划跟踪</span><span class="sxs-lookup"><span data-stu-id="385b1-102">Planning for Tracking</span></span>
<span data-ttu-id="385b1-103">跟踪的消息是所依据的部分消息实例，如消息正文、 消息属性和元数据存储在数据库中，通常出于存档目的的过程。</span><span class="sxs-lookup"><span data-stu-id="385b1-103">Message tracking is the process by which parts of a message instance, such as the message body, message properties, and metadata are stored in a database, typically for archival purposes.</span></span> <span data-ttu-id="385b1-104">随后可以通过从中的组中心页运行查询来查看所跟踪的消息实例部分[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]管理控制台。</span><span class="sxs-lookup"><span data-stu-id="385b1-104">Message instance parts that are tracked can subsequently be viewed by running queries from the Group Hub page in the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Administration console.</span></span> <span data-ttu-id="385b1-105">除了访问存档的数据，还可以查看实时数据，可以是用于识别和解决问题在开发或过渡环境的有用工具。</span><span class="sxs-lookup"><span data-stu-id="385b1-105">In addition to accessing archived data, you can also view live data, which can be a helpful tool for identifying and fixing problems in a development or staging environment.</span></span>  
  
 <span data-ttu-id="385b1-106">由于消息跟踪的过程可能会消耗大量的资源，因此创建你的计划之前应该查看本主题。</span><span class="sxs-lookup"><span data-stu-id="385b1-106">Since the process of message tracking can be very resource intensive, you should review this topic before creating your plan.</span></span>  
  
 <span data-ttu-id="385b1-107">有关跟踪的详细信息，请参阅[运行状况与活动跟踪](http://go.microsoft.com/fwlink/?LinkId=154187)(http://go.microsoft.com/fwlink/?LinkId=154187)。</span><span class="sxs-lookup"><span data-stu-id="385b1-107">For more information about tracking, see [Health and Activity Tracking](http://go.microsoft.com/fwlink/?LinkId=154187) (http://go.microsoft.com/fwlink/?LinkId=154187).</span></span>  
  
## <a name="configuring-and-enabling-the-dta-purge-and-archive-sql-agent-job"></a><span data-ttu-id="385b1-108">配置和启用 DTA 清除和存档 SQL 代理作业</span><span class="sxs-lookup"><span data-stu-id="385b1-108">Configuring and Enabling the DTA Purge and Archive SQL Agent Job</span></span>  
 <span data-ttu-id="385b1-109">此作业中存档和清除旧数据从 BizTalk 跟踪数据库，从而阻止变得太大。</span><span class="sxs-lookup"><span data-stu-id="385b1-109">This job archives and purges old data from the BizTalk Tracking database, thus keeping it from becoming too large.</span></span> <span data-ttu-id="385b1-110">这是必需的正常[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]系统。</span><span class="sxs-lookup"><span data-stu-id="385b1-110">This is essential for a healthy [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] system.</span></span> <span data-ttu-id="385b1-111">大型跟踪数据库将开始跟踪主机和任何其他进程的性能影响该查询跟踪数据库。</span><span class="sxs-lookup"><span data-stu-id="385b1-111">A large tracking database will begin to affect the performance of the tracking host and any other processes that query the tracking database.</span></span>  
  
-   <span data-ttu-id="385b1-112">**请确保该 DTA 清除和存档 SQL 代理作业已正确配置和启用，并且已成功完成。**</span><span class="sxs-lookup"><span data-stu-id="385b1-112">**Ensure that the DTA Purge and Archive SQL Agent job is properly configured, enabled, and successfully completing.**</span></span> <span data-ttu-id="385b1-113">默认情况下不启用此作业，因为必须先配置为包含在其中写入的存档文件的目录。</span><span class="sxs-lookup"><span data-stu-id="385b1-113">This job is not enabled by default because you must first configure it to include a directory where the archive files can be written.</span></span>  
  
-   <span data-ttu-id="385b1-114">**确保作业可以快速生成传入跟踪数据清除跟踪数据。**</span><span class="sxs-lookup"><span data-stu-id="385b1-114">**Ensure that the job is able to purge the tracking data as fast as the incoming tracking data is generated.**</span></span> <span data-ttu-id="385b1-115">可接受的作业以在负载高峰，全力支持，但它应始终能够保持同步。</span><span class="sxs-lookup"><span data-stu-id="385b1-115">It is acceptable for the job to get behind during peak load times, but it should always be able to catch up.</span></span> <span data-ttu-id="385b1-116">如果清除作业落后，并且永远不会为能够保持同步，BizTalk 跟踪数据库会继续增加，并最终将产生负面影响性能。</span><span class="sxs-lookup"><span data-stu-id="385b1-116">If the purge job gets behind and is never able to catch up, the BizTalk Tracking database will continue to grow, and performance will eventually be adversely affected.</span></span>  
  
-   <span data-ttu-id="385b1-117">**查看软清除和硬清除参数，以确保你一直在进行数据足够长的时间，但不是太长。**</span><span class="sxs-lookup"><span data-stu-id="385b1-117">**Review the soft purge and hard purge parameters to ensure you are keeping data long enough but not too long.**</span></span> <span data-ttu-id="385b1-118">有关这些参数的详细信息请参阅[存档和清除 BizTalk 跟踪数据库](http://go.microsoft.com/fwlink/?LinkID=153816)(http://go.microsoft.com/fwlink/?LinkID=153816)。</span><span class="sxs-lookup"><span data-stu-id="385b1-118">For more information about these parameters see [Archiving and Purging the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153816) (http://go.microsoft.com/fwlink/?LinkID=153816).</span></span>  
  
-   <span data-ttu-id="385b1-119">**如果您只需清除旧数据，则不需要将其存档在第一次，然后更改 SQL 代理作业来调用存储的过程"dtasp_PurgeTrackingDatabase"。**</span><span class="sxs-lookup"><span data-stu-id="385b1-119">**If you only need to purge the old data and do not need to archive it first, then change the SQL Agent job to call the stored procedure “dtasp_PurgeTrackingDatabase”.**</span></span> <span data-ttu-id="385b1-120">这跳过存档步骤中，并只是执行清除。</span><span class="sxs-lookup"><span data-stu-id="385b1-120">This skips the archive step, and just does the purge.</span></span> <span data-ttu-id="385b1-121">有关更多相关信息的存储的过程和更改 SQL 代理作业以使用它，请参阅[如何从 BizTalk 跟踪数据库中清除数据](http://go.microsoft.com/fwlink/?LinkID=153817)(http://go.microsoft.com/fwlink/?LinkID=153817)。</span><span class="sxs-lookup"><span data-stu-id="385b1-121">For more information about this stored procedure and changing the SQL Agent job to use it, see [How to Purge Data from the BizTalk Tracking Database](http://go.microsoft.com/fwlink/?LinkID=153817) (http://go.microsoft.com/fwlink/?LinkID=153817).</span></span>  
  
-   <span data-ttu-id="385b1-122">**如果你需要将 BizTalk 跟踪数据库保留在存档文件，请确保你有一个进程已成功还原和使用它们。**</span><span class="sxs-lookup"><span data-stu-id="385b1-122">**If you need to keep the BizTalk Tracking database archive files, ensure that you have a process in place to successfully restore and use them.**</span></span>  
  
-   <span data-ttu-id="385b1-123">**如果您遇到暂时解决通过清除 BizTalk 跟踪数据库的性能问题，并且你想要配置 BizTalk，不再收集跟踪信息，你可能想要考虑禁用全局跟踪。**</span><span class="sxs-lookup"><span data-stu-id="385b1-123">**If you are having performance issues that are momentarily addressed by purging the BizTalk tracking database, and you want to configure BizTalk to no longer collect tracking information, you may want to consider turning off global tracking.**</span></span> <span data-ttu-id="385b1-124">有关如何禁用全局跟踪的信息，请参阅主题[如何禁用全局跟踪](http://go.microsoft.com/fwlink/?LinkID=154193)(http://go.microsoft.com/fwlink/?LinkID=154193)。</span><span class="sxs-lookup"><span data-stu-id="385b1-124">For information about how to turn off global tracking, see the topic [How to Turn Off Global Tracking](http://go.microsoft.com/fwlink/?LinkID=154193) (http://go.microsoft.com/fwlink/?LinkID=154193).</span></span>  
  
## <a name="creating-a-dedicated-tracking-host"></a><span data-ttu-id="385b1-125">创建专用的跟踪主机</span><span class="sxs-lookup"><span data-stu-id="385b1-125">Creating a Dedicated Tracking Host</span></span>  
 <span data-ttu-id="385b1-126">当选项**允许主机跟踪**的主机在 BizTalk Server 管理控制台中，该主机的实例将运行跟踪数据解码服务 (TDDS) 移动跟踪的数据，从启用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]MessageBox数据库部署到 BizTalk 跟踪数据库。</span><span class="sxs-lookup"><span data-stu-id="385b1-126">When the option to **Allow Host Tracking** is enabled for a host in the BizTalk Server Administration console, instances of that host will run the Tracking Data Decode Service (TDDS) to move tracked data from the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] MessageBox database to the BizTalk Tracking database.</span></span> <span data-ttu-id="385b1-127">因为 TDDS 可能占用大量资源，请考虑创建的"专用"跟踪主机**允许主机跟踪**选项处于启用状态，这不会运行任何其他[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]进程 （例如适配器或业务流程）。</span><span class="sxs-lookup"><span data-stu-id="385b1-127">Since TDDS may be resource intensive, consider creating a "dedicated" tracking host for which the **Allow Host Tracking** option is enabled and which does not run any other [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] processes (such as adapters or orchestrations).</span></span> <span data-ttu-id="385b1-128">如果你的 BizTalk 组包含多个 BizTalk 服务器，它也被视为最佳做法为 TDDS 提供高可用性组中每个服务器上创建此主机的实例。</span><span class="sxs-lookup"><span data-stu-id="385b1-128">If your BizTalk group contains more than one BizTalk server, it is also considered a best practice to create an instance of this host on each server in the group to provide high availability for TDDS.</span></span>  
  
## <a name="testing-to-measure-maximum-sustainable-tracking-throughput"></a><span data-ttu-id="385b1-129">测试与度量值的最大可承受跟踪吞吐量</span><span class="sxs-lookup"><span data-stu-id="385b1-129">Testing to Measure Maximum Sustainable Tracking Throughput</span></span>  
 <span data-ttu-id="385b1-130">较详细跟踪的消息是大量的资源密集型活动，如果未得到正确管理可以产生的性能非常不利影响[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境。</span><span class="sxs-lookup"><span data-stu-id="385b1-130">Extensive message tracking is a very resource intensive activity and if not properly managed can have an extremely adverse effect on the performance of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="385b1-131">因此，应度量值的最大可承受跟踪吞吐量你[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]环境，以确保系统具有可持续性并以给定的消息流速率将无限期地运行。</span><span class="sxs-lookup"><span data-stu-id="385b1-131">Therefore, you should measure maximum sustainable tracking throughput for your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment to ensure that the system is sustainable and will run indefinitely at a given message flow rate.</span></span> <span data-ttu-id="385b1-132">测量最大可承受跟踪吞吐量的详细信息，请参阅[测量的最大可承受跟踪吞吐量](http://go.microsoft.com/fwlink/?LinkID=153815)(<http://go.microsoft.com/fwlink/?LinkID=153815>)。</span><span class="sxs-lookup"><span data-stu-id="385b1-132">For more information about measuring maximum sustainable tracking throughput, see [Measuring Maximum Sustainable Tracking Throughput](http://go.microsoft.com/fwlink/?LinkID=153815) (<http://go.microsoft.com/fwlink/?LinkID=153815>).</span></span>  
  
##  <a name="BKMK_TrackingBP"></a> <span data-ttu-id="385b1-133">跟踪的最佳做法</span><span class="sxs-lookup"><span data-stu-id="385b1-133">Best Practices for Tracking</span></span>  
  
- <span data-ttu-id="385b1-134">**确定您需要在规划期间跟踪的信息**:应在规划阶段确定需要跟踪，以便部署项目后你可以设置跟踪选项并限制为您提供所需的信息的跟踪数据量的信息。</span><span class="sxs-lookup"><span data-stu-id="385b1-134">**Determine the information you need to track during planning** : You should decide during the planning stages which information you need to track, so that after you deploy the project you can set the tracking options and limit the amount of tracked data to give you only the information you need.</span></span>  
  
- <span data-ttu-id="385b1-135">**不要跟踪所有消息**:我们建议不跟踪所有消息，因为每次访问消息时，[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]将生成另一个副本。</span><span class="sxs-lookup"><span data-stu-id="385b1-135">**Do not track all messages**: We recommend that you not track all messages, because each time a message is touched, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] makes another copy.</span></span> <span data-ttu-id="385b1-136">而是可以通过跟踪特定端口来缩小范围。</span><span class="sxs-lookup"><span data-stu-id="385b1-136">You can instead narrow the scope by tracking only a specific port.</span></span> <span data-ttu-id="385b1-137">这可以帮助您的系统性能最大化和保持数据库整洁。</span><span class="sxs-lookup"><span data-stu-id="385b1-137">This helps to maximize the performance of your system and to keep the databases uncluttered.</span></span>  
  
- <span data-ttu-id="385b1-138">**将发送端口上设置跟踪和接收端口而不是在管道上的**:如果设置管道的跟踪选项，则还将设置为使用的管道的每个端口全局跟踪选项。</span><span class="sxs-lookup"><span data-stu-id="385b1-138">**Set tracking on send ports and receive ports instead of on a pipeline**: If you set tracking options on pipelines, you will also set the tracking options globally for every port that uses the pipeline.</span></span> <span data-ttu-id="385b1-139">反过来，这可能会在导致被跟踪比你预期，这将降低系统性能的更多数据。</span><span class="sxs-lookup"><span data-stu-id="385b1-139">This in turn may result in far more data being tracked than you intend, which will slow system performance.</span></span> <span data-ttu-id="385b1-140">相反，您可以设置跟踪选项上的发送端口和接收端口。</span><span class="sxs-lookup"><span data-stu-id="385b1-140">Instead, you can set tracking options on send ports and receive ports.</span></span>  
  
- <span data-ttu-id="385b1-141">**请考虑各种因素时调整 BizTalk 跟踪数据库的大小**:</span><span class="sxs-lookup"><span data-stu-id="385b1-141">**Take into account various factors when you size the BizTalk Tracking database**:</span></span>  
  
  -   <span data-ttu-id="385b1-142">调整 BizTalk 跟踪数据库的大小时，可以通过将应变乘数添加到你的计算考虑 SQL Server 因素，例如，索引大小。</span><span class="sxs-lookup"><span data-stu-id="385b1-142">When sizing the BizTalk Tracking database, account for SQL Server factors, such as index size, by adding a contingency multiplier to your calculations.</span></span>  
  
  -   <span data-ttu-id="385b1-143">在确定 BizTalk 跟踪数据库中的消息的大小，消息上下文的平均大小为消息大小如果添加这一点非常重要的消息大小。</span><span class="sxs-lookup"><span data-stu-id="385b1-143">When determining the size of messages in the BizTalk Tracking database, add the average size of the message context to the message size if it is significant compared to the message size.</span></span>  
  
  -   <span data-ttu-id="385b1-144">将 BizTalk 跟踪数据库中的消息大小限制，限制提升的属性的数目。</span><span class="sxs-lookup"><span data-stu-id="385b1-144">To limit the size of messages in the BizTalk Tracking database, limit the number of properties that you promote.</span></span> <span data-ttu-id="385b1-145">如果需要用于路由目的应仅使用升级属性，否则使用可分辨的字段。</span><span class="sxs-lookup"><span data-stu-id="385b1-145">You should only use promoted properties if you need them for routing purposes, otherwise use distinguished fields.</span></span>  
  
  -   <span data-ttu-id="385b1-146">如果业务流程**形状开始和结束**选项处于启用状态，请考虑每个业务流程实例中的每个形状的开始和停止事件保存在 BizTalk 跟踪数据库中。</span><span class="sxs-lookup"><span data-stu-id="385b1-146">If the orchestration **Shape start and end** option is enabled, take into account that a start and stop event for each shape in each orchestration instance is saved in the BizTalk Tracking database.</span></span>