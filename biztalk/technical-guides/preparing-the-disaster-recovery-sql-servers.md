---
title: "准备灾难恢复 SQL Server |Microsoft 文档"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 44b77fe8-393d-4781-b0b0-5b7f6e50a67b
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 01e6021b7114b8b57c62dadfe742be1809df0bd8
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/20/2017
---
# <a name="preparing-the-disaster-recovery-sql-servers"></a><span data-ttu-id="420e3-102">准备灾难恢复 SQL 服务器</span><span class="sxs-lookup"><span data-stu-id="420e3-102">Preparing the Disaster Recovery SQL Servers</span></span>
<span data-ttu-id="420e3-103">可用来创建一组[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库灾难恢复站点中的实例。</span><span class="sxs-lookup"><span data-stu-id="420e3-103">Createa set of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances in the disaster recovery site.</span></span> <span data-ttu-id="420e3-104">若要确保灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例可以提供相同级别的性能与生产[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例、 灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]应具有类似配置数据库实例硬件和运行的物理计算机的数量[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="420e3-104">To ensure that the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances can provide the same level of performance as the production [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances, the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances should be configured with similar hardware and number of physical computers running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="420e3-105">在此方案中，[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]将为每个生产配置日志传送[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例，将应用于相应[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]在灾难恢复站点的数据库实例。</span><span class="sxs-lookup"><span data-stu-id="420e3-105">In this scenario, [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] log shipping will be configured for each production [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instance to apply to a corresponding [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instance at the disaster recovery site.</span></span>  
  
 <span data-ttu-id="420e3-106">密钥[!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]日志传送要求是在其中存储数据库文件的生产站点上的驱动器号与匹配在灾难恢复站点，其中还原数据库文件驱动器号。</span><span class="sxs-lookup"><span data-stu-id="420e3-106">A key [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] log shipping requirement is that the drive letter(s) on the production site where the database files are stored match the drive letter(s) at the disaster recovery site where the database files are restored.</span></span> <span data-ttu-id="420e3-107">因此，如果[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库文件组位于 G:\data 在生产环境中、 在目标 (DR) 服务器上，必须有一个 G:\data 目录或还原将失败。</span><span class="sxs-lookup"><span data-stu-id="420e3-107">So if the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database file group is located on G:\data in production, there must be a G:\data directory on the destination (DR) server, or the restore will fail.</span></span>  
  
 [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]<span data-ttu-id="420e3-108">日志传送不支持**RESTORE WITH MOVE** [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]命令。</span><span class="sxs-lookup"><span data-stu-id="420e3-108"> log shipping does not support the **RESTORE WITH MOVE** [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] command.</span></span> <span data-ttu-id="420e3-109">因此，我们建议在灾难恢复站点的数据库实例名称匹配在生产环境中的数据库实例名称 （默认情况下，实例名称为的文件路径的一部分）。</span><span class="sxs-lookup"><span data-stu-id="420e3-109">Because of this, we recommend that database instance names at the disaster recovery site match the database instance names in production (by default, the instance name is part of the file path).</span></span> <span data-ttu-id="420e3-110">另一个选项是仅在相应的驱动器号中运行的灾难恢复计算机上创建一个目录[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]以便**还原**操作可以创建该文件中的相同的目录结构中使用生产。</span><span class="sxs-lookup"><span data-stu-id="420e3-110">Another option is to simply create a directory on the corresponding drive letter in the disaster recovery computer running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] so that the **RESTORE** operation can create the file in the same directory structure as is used in production.</span></span>  
  
 <span data-ttu-id="420e3-111">创建[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]的灾难恢复站点的安全登录名对应到生产站点，因此，事件中，到灾难恢复站点的故障转移是必需的所有所需的安全登录名是目标系统上存在。</span><span class="sxs-lookup"><span data-stu-id="420e3-111">Create [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] security logins for the disaster recovery site that correspond to the production site so that in the event that a failover to the disaster recovery site is required, all required security logins are present on the destination system.</span></span>  
  
 <span data-ttu-id="420e3-112">一次安装灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例完成后，执行 master 和 msdb 数据库的完整备份，以便可以还原干净系统中,，切换到灾难恢复站点失败。</span><span class="sxs-lookup"><span data-stu-id="420e3-112">Once installation of the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances is completed, perform a full backup of master and msdb databases so that a clean system can be restored in the event that a switch to the disaster recovery site fails.</span></span>