---
title: 准备灾难恢复 SQL Server |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 44b77fe8-393d-4781-b0b0-5b7f6e50a67b
caps.latest.revision: 2
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 036f5ab2510744ad0f1dc30e36e6135ed5ac0d1c
ms.sourcegitcommit: 381e83d43796a345488d54b3f7413e11d56ad7be
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/07/2019
ms.locfileid: "65398524"
---
# <a name="preparing-the-disaster-recovery-sql-servers"></a><span data-ttu-id="d0cb3-102">准备灾难恢复 SQL Server</span><span class="sxs-lookup"><span data-stu-id="d0cb3-102">Preparing the Disaster Recovery SQL Servers</span></span>
<span data-ttu-id="d0cb3-103">设置来创建一个[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库灾难恢复站点中的实例。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-103">Createa set of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances in the disaster recovery site.</span></span> <span data-ttu-id="d0cb3-104">若要确保灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例可以提供相同级别的性能与生产[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库实例、 灾难恢复[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]应具有类似配置数据库实例硬件和物理计算机运行的数量[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-104">To ensure that the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances can provide the same level of performance as the production [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances, the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instances should be configured with similar hardware and number of physical computers running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="d0cb3-105">在此方案中，BizTalk Server 将为每个生产配置日志传送[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]要将应用于相应的数据库实例[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]在灾难恢复站点的数据库实例。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-105">In this scenario, BizTalk Server log shipping will be configured for each production [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instance to apply to a corresponding [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database instance at the disaster recovery site.</span></span>  
  
 <span data-ttu-id="d0cb3-106">BizTalk Server 日志传送要求的密钥是存储数据库文件的生产站点上的驱动器号，匹配在灾难恢复站点，其中还原数据库文件驱动器号。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-106">A key BizTalk Server log shipping requirement is that the drive letter(s) on the production site where the database files are stored match the drive letter(s) at the disaster recovery site where the database files are restored.</span></span> <span data-ttu-id="d0cb3-107">因此，如果[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库文件组位于 G:\data 在生产环境中，目标 (DR) 服务器上必须有一个 G:\data 目录或还原会失败。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-107">So if the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] database file group is located on G:\data in production, there must be a G:\data directory on the destination (DR) server, or the restore will fail.</span></span>  
  
 <span data-ttu-id="d0cb3-108">BizTalk Server 日志传送不支持**RESTORE WITH MOVE** [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]命令。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-108">BizTalk Server log shipping does not support the **RESTORE WITH MOVE** [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] command.</span></span> <span data-ttu-id="d0cb3-109">因此，我们建议在灾难恢复站点的数据库实例名称匹配在生产环境中的数据库实例名称 （默认情况下，实例名称是文件路径的一部分）。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-109">Because of this, we recommend that database instance names at the disaster recovery site match the database instance names in production (by default, the instance name is part of the file path).</span></span> <span data-ttu-id="d0cb3-110">另一个选项是只需上创建一个目录中运行的灾难恢复计算机的相应驱动器号[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]，以便**还原**操作可以创建该文件在相同的目录结构中使用生产环境。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-110">Another option is to simply create a directory on the corresponding drive letter in the disaster recovery computer running [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] so that the **RESTORE** operation can create the file in the same directory structure as is used in production.</span></span>  
  
 <span data-ttu-id="d0cb3-111">创建[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]的灾难恢复站点的安全登录名对应于生产站点，以便在的故障转移到灾难恢复站点是必需的所有必需的安全登录名均存在于目标系统。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-111">Create [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] security logins for the disaster recovery site that correspond to the production site so that in the event that a failover to the disaster recovery site is required, all required security logins are present on the destination system.</span></span>  
  
 <span data-ttu-id="d0cb3-112">一次的灾难恢复安装[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例已完成，请执行 master 和 msdb 数据库的完整备份，以便可以还原干净的系统，在切换到灾难恢复站点失败的事件。</span><span class="sxs-lookup"><span data-stu-id="d0cb3-112">Once installation of the disaster recovery [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instances is completed, perform a full backup of master and msdb databases so that a clean system can be restored in the event that a switch to the disaster recovery site fails.</span></span>