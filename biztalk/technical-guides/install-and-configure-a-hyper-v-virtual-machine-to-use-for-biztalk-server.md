---
title: 安装和配置的 HYPER-V 虚拟机以使用与 BizTalk Server |Microsoft Docs
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 86add392-3cde-432d-95d6-c81d68716537
caps.latest.revision: 18
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f350c34949d0cc4f5dd454119b68e488cd0924ba
ms.sourcegitcommit: 266308ec5c6a9d8d80ff298ee6051b4843c5d626
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/27/2018
ms.locfileid: "36977302"
---
# <a name="installing-and-configuring-a-hyper-v-virtual-machine-for-use-with-biztalk-server"></a><span data-ttu-id="f2e0d-102">安装和配置的 HYPER-V 虚拟机以使用与 BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="f2e0d-102">Installing and Configuring a Hyper-V Virtual Machine for use with BizTalk Server</span></span>
<span data-ttu-id="f2e0d-103">本主题提供有关安装和配置 BizTalk Server 中的 HYPER-V 环境，包括关于安装和配置的 HYPER-V 虚拟机的建议和建议在安装 BizTalk Server 的建议HYPER-V 虚拟机。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-103">This topic provides recommendations for installing and configuring BizTalk Server in a Hyper-V environment, including recommendations for installation and configuration of the Hyper-V virtual machine and recommendations for installing BizTalk Server on a Hyper-V virtual machine.</span></span>  

## <a name="installing-and-configuring-hyper-v"></a><span data-ttu-id="f2e0d-104">安装和配置的 HYPER-V</span><span class="sxs-lookup"><span data-stu-id="f2e0d-104">Installing and Configuring Hyper-V</span></span>  
 <span data-ttu-id="f2e0d-105">在安装之前的 HYPER-V，请参阅[What's New in Windows Server 2008 R2 中的 HYPER-V](http://go.microsoft.com/fwlink/?LinkID=202427)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-105">Before installing Hyper-V, see [What's New in Hyper-V in Windows Server 2008 R2](http://go.microsoft.com/fwlink/?LinkID=202427).</span></span> <span data-ttu-id="f2e0d-106">Microsoft HYPER-V Server 2008 R2 入门指南提供了有关如何安装和配置详细信息[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]的 HYPER-V。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-106">The “Microsoft Hyper-V Server 2008 R2 Getting Started” guide provides details about how to install and configure [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] Hyper-V.</span></span> <span data-ttu-id="f2e0d-107">本指南将位于[ http://go.microsoft.com/fwlink/?LinkID=202431 ](http://go.microsoft.com/fwlink/?LinkID=202431)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-107">The guide is available at [http://go.microsoft.com/fwlink/?LinkID=202431](http://go.microsoft.com/fwlink/?LinkID=202431).</span></span>  

 <span data-ttu-id="f2e0d-108">"适用于 Windows Server 2008 R2 性能优化准则"文档提供有关优化的详细信息[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]并包括专门侧重于 HYPER-V 的部分。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-108">“The Performance Tuning Guidelines for Windows Server 2008 R2” document provides details on tuning [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] and includes a section specifically focused on Hyper-V.</span></span> <span data-ttu-id="f2e0d-109">该文档位于[ http://go.microsoft.com/fwlink/?LinkID=202087 ](http://go.microsoft.com/fwlink/?LinkID=202087)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-109">The document is available at [http://go.microsoft.com/fwlink/?LinkID=202087](http://go.microsoft.com/fwlink/?LinkID=202087).</span></span>  

### <a name="hyper-v-platform-prerequisites"></a><span data-ttu-id="f2e0d-110">HYPER-V 平台必备组件</span><span class="sxs-lookup"><span data-stu-id="f2e0d-110">Hyper-V Platform Prerequisites</span></span>  
 <span data-ttu-id="f2e0d-111">HYPER-V 是一种服务器角色适用于 64 位和所有版本的[!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]只有 64 位。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-111">Hyper-V is a server role available for 64-bit and all editions of  [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] are 64-bit only.</span></span> <span data-ttu-id="f2e0d-112">此外，在物理硬件必须支持硬件辅助虚拟化。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-112">Additionally, the physical hardware must support hardware assisted virtualization.</span></span> <span data-ttu-id="f2e0d-113">这意味着必须是具有 Intel 虚拟化技术 (Intel VT) 或 AMD 虚拟化 (AMD-V) 技术兼容的处理器、 系统 BIOS 必须支持数据执行保护 (DEP) 和必须启用 DEP。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-113">This means the processor must be compatible with Intel Virtualization Technology (Intel VT) or AMD Virtualization (AMD-V) technology, the system BIOS must support Data Execution Prevention (DEP), and DEP must be enabled.</span></span> <span data-ttu-id="f2e0d-114">具体而言，必须启用 Intel XD 位 （执行禁用位） 或 AMD NX 位 （无执行位）。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-114">Specifically, you must enable the Intel XD bit (execute disable bit) or AMD NX bit (no execute bit).</span></span>  

> [!NOTE]  
>  <span data-ttu-id="f2e0d-115">启用系统 BIOS 中的这些选项后, 完全关闭计算机，然后重新启动计算机，以确保这些设置将应用。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-115">After enabling these options in the system BIOS, turn off the computer completely and then restart the computer to ensure that these settings are applied.</span></span>  

#### <a name="determining-hardware-requirements"></a><span data-ttu-id="f2e0d-116">确定硬件要求</span><span class="sxs-lookup"><span data-stu-id="f2e0d-116">Determining Hardware Requirements</span></span>  
 <span data-ttu-id="f2e0d-117">由于服务器合并的需求，而 HYPER-V 服务器往往会占用更多 CPU 和内存，并且需要更大的磁盘 I/O 带宽比可比较的计算负载的物理服务器。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-117">Due to the demands of server consolidation, Hyper-V servers tend to consume more CPU and memory, and require greater disk I/O bandwidth than physical servers with comparable computing loads.</span></span> <span data-ttu-id="f2e0d-118">若要部署的环境将达到预期要求，请考虑下面以确定你的服务器的确切的硬件要求的因素。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-118">In order to deploy an environment that will meet expectations, consider the factors below to determine the exact hardware requirements of your server.</span></span>  

##### <a name="storage-configuration-options"></a><span data-ttu-id="f2e0d-119">存储配置选项</span><span class="sxs-lookup"><span data-stu-id="f2e0d-119">Storage Configuration Options</span></span>  
 <span data-ttu-id="f2e0d-120">存储硬件应该提供足够的 I/O 带宽和存储容量，以满足你打算承载虚拟机的当前和未来需求。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-120">The storage hardware should provide sufficient I/O bandwidth and storage capacity to meet the current and future needs of the virtual machines that you plan to host.</span></span> <span data-ttu-id="f2e0d-121">选择容量使用情况和它可以提供性能之间的 HYPER-V 的存储配置时需要进行权衡。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-121">There is a trade-off when choosing the storage configuration for Hyper-V between capacity usage and the performance it can provide.</span></span>  

 <span data-ttu-id="f2e0d-122">在规划存储配置，请考虑要在预配的环境的要求。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-122">When planning storage configuration, consider the requirements of the environment you are provisioning.</span></span> <span data-ttu-id="f2e0d-123">显著的生产、 预生产和开发环境的要求可能不同。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-123">The requirements for production, pre-production, and development environments may differ considerably.</span></span>  

 <span data-ttu-id="f2e0d-124">如果要部署生产 HYPER-V 上的 BizTalk Server 环境，性能将是一项关键要求。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-124">If you are deploying a production BizTalk Server environment on Hyper-V, performance will be a key requirement.</span></span> <span data-ttu-id="f2e0d-125">若要避免磁盘在繁忙的生产系统上的 I/O 争用，主机和来宾操作系统上安装集成服务并将数据卷的磁盘合成 SCSI 控制器的配置。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-125">To avoid disk I/O contention on busy production systems, install integration services on both the host and guest operating system and configure disks for data volumes with the synthetic SCSI controller.</span></span> <span data-ttu-id="f2e0d-126">对于跨多个数据驱动器的高密集型存储 I/O 工作负荷，每个 VHD 应附加到单独的合成 SCSI 控制器以提高整体性能。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-126">For highly intensive storage I/O workloads that span multiple data drives, each VHD should be attached to a separate synthetic SCSI controller for better overall performance.</span></span> <span data-ttu-id="f2e0d-127">此外，每个 VHD 应存储在单独的物理磁盘上。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-127">In addition, each VHD should be stored on separate physical disks.</span></span> <span data-ttu-id="f2e0d-128">有关配置的数据磁盘详细信息与合成 SCSI 控制器的卷，请参阅本主题的"优化磁盘性能"部分[清单： 优化 HYPER-V 上的性能](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-128">For more information about configuring disks for data volumes with the synthetic SCSI controller see the “Optimize Disk Performance” section of the topic [Checklist: Optimizing Performance on Hyper-V](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md).</span></span>  

 <span data-ttu-id="f2e0d-129">通常情况下，开发环境并不具有严格的性能要求，因为最大化资源利用率往往是主要的优先级。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-129">Typically, development environments do not have stringent performance requirements since maximizing resource utilization tends to be the main priority.</span></span> <span data-ttu-id="f2e0d-130">适用于开发环境提供托管在单个物理驱动器上的多个 VHD 文件时的性能是通常可接受的。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-130">For development environments the performance provided when hosting multiple VHD files on a single physical drive is generally acceptable.</span></span>  

 <span data-ttu-id="f2e0d-131">HYPER-V 支持多种不同类型的存储磁盘选项。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-131">Hyper-V supports several different types of storage disk options.</span></span> <span data-ttu-id="f2e0d-132">到计算机，可以通过 IDE 或 SCSI 控制器附加每个存储选项。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-132">Each of the storage options can be attached via an IDE or SCSI controller to the machine.</span></span> <span data-ttu-id="f2e0d-133">通过 IDE 控制器使用 SCSI 控制器的潜在好处是，它将仅正常工作如果来宾虚拟机上安装了正确版本的操作系统集成组件。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-133">A potential benefit of using the SCSI controller over the IDE controller is that it will only work correctly if the correct versions of the operating system integration components have been installed on the guest virtual machine.</span></span> <span data-ttu-id="f2e0d-134">这是用于确保来宾操作系统上安装了正确的操作系统集成组件的简单方法。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-134">This is a straightforward method for ensuring that correct operating system integration components are installed on the guest operating system.</span></span>  

> [!NOTE]  
>  <span data-ttu-id="f2e0d-135">与以前版本的 Microsoft 虚拟化技术，是访问虚拟硬盘时，使用虚拟 IDE 控制器或虚拟 SCSI 控制器之间没有性能差异。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-135">Unlike previous versions of Microsoft virtualization technology, there is no performance difference between using a virtual IDE controller or a virtual SCSI controller when accessing virtual hard disks.</span></span>  

 <span data-ttu-id="f2e0d-136">对于密集型读写活动，如托管[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]数据库，传递磁盘选项提供增量性能优于固定虚拟硬盘 (VHD) 磁盘。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-136">For intensive read-write activities, such as hosting [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases, the passthrough disk option provides incremental performance advantages over fixed virtual hard drive (VHD) disks.</span></span> <span data-ttu-id="f2e0d-137">通过选项允许虚拟机能够直接访问物理磁盘和绕过 NTFS 文件系统根分区中的，但不支持的虚拟磁盘，例如虚拟机快照和聚类分析的特定功能支持。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-137">The passthrough option permits the virtual machine to have direct access to the physical disk and bypasses the NTFS file system in the root partition but does not support certain functionality of virtual disks, such as Virtual machine snapshots and clustering support.</span></span> <span data-ttu-id="f2e0d-138">因此使用的传递磁盘功能建议不要在 BizTalk 或 SQL Server 环境中因为边际性能优势会超过偏移量为缺少的功能。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-138">Therefore use of the passthrough disk feature is not recommended in a BizTalk or SQL Server environment because the marginal performance benefits are more than offset by the missing functionality.</span></span>  

 <span data-ttu-id="f2e0d-139">下表总结了可用的 HYPER-V 存储选项的优缺点:。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-139">The following table summarizes the advantages and disadvantages of available Hyper-V storage options:.</span></span>  


|    <span data-ttu-id="f2e0d-140">**HYPER-V 存储类型**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-140">**Hyper-V Storage Type**</span></span>     |                                                                                                                                                                                                      <span data-ttu-id="f2e0d-141">**专业人员**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-141">**Pros**</span></span>                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                              <span data-ttu-id="f2e0d-142">**缺点**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-142">**Cons**</span></span>                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                     <span data-ttu-id="f2e0d-143">**BizTalk Server 的注意事项**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-143">**Considerations for BizTalk Server**</span></span>                                                                                                                                                                                                                                                      |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      <span data-ttu-id="f2e0d-144">**固定的大小磁盘**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-144">**Fixed size disks**</span></span>       | <span data-ttu-id="f2e0d-145">因为物理硬盘上创建时，在其最大可能大小初始化的 VHD 文件的执行性能优于动态 VHD。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-145">Performs better than a dynamic VHD because the VHD file is initialized at its maximum possible size when it is created on the physical hard drive.</span></span><br /><br /> <span data-ttu-id="f2e0d-146">这个问题，碎片算可能和，因此，缓解了一个单一的 I/O 被分成多个 I/o 的方案。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-146">This makes fragmentation less likely and, therefore, mitigates scenarios where a single I/O is split into multiple I/Os.</span></span> <span data-ttu-id="f2e0d-147">这具有 VHD 类型的最小 CPU 开销，因为读取和写入不需要查找块的映射。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-147">This has the lowest CPU overhead of the VHD types because reads and writes do not need to look up the mapping of the block.</span></span> |                                                                                                                                                                                                                                                                                                                                                                   <span data-ttu-id="f2e0d-148">需要完整的前期的磁盘空间量的分配。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-148">Requires allocation of the full amount of disk space up-front.</span></span>                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                   <span data-ttu-id="f2e0d-149">操作系统卷上使用[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]和[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-149">Use for operating system volumes on [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span> <span data-ttu-id="f2e0d-150">**重要说明：** 启动磁盘的 HYPER-V 来宾分区必须附加到 IDE 控制器。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-150">**Important:**  The startup disk of a Hyper-V guest partition must be attached to an IDE contoller.</span></span>                                                                                                                   |
| <span data-ttu-id="f2e0d-151">**动态扩展磁盘**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-151">**Dynamically expanding disks**</span></span> |                                                                                                        <span data-ttu-id="f2e0d-152">VHD 文件的大小增加到更多的数据存储在虚拟机本身上创建磁盘时指定的大小。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-152">The size of the VHD file increases to the size specified when creating the disk, as more data is stored on the virtual machine itself.</span></span> <span data-ttu-id="f2e0d-153">这适合于可用的存储最有效地使用。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-153">This accommodates the most efficient use of available storage.</span></span>                                                                                                        | <span data-ttu-id="f2e0d-154">不执行以及固定大小的 VHD。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-154">Does not perform as well as a fixed size VHD.</span></span> <span data-ttu-id="f2e0d-155">这是因为在磁盘中的块清零块以启动但不是受任何 VHD 文件中的实际空间。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-155">This is because the blocks in the disk start as zeroed blocks but are not backed by any actual space in the VHD file.</span></span> <span data-ttu-id="f2e0d-156">返回此类块中读取零的块。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-156">Reads from such blocks return a block of zeros.</span></span> <span data-ttu-id="f2e0d-157">第一个块时写入到中，虚拟化堆栈必须将 VHD 文件中的空间分配的块，然后更新相应的元数据。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-157">When a block is first written to, the virtualization stack must allocate space within the VHD file for the block and then update the corresponding metadata.</span></span> <span data-ttu-id="f2e0d-158">除了这每次引用现有的块的块映射必须查找元数据中。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-158">In addition to this every time an existing block is referenced the block mapping must be looked up in the metadata.</span></span> <span data-ttu-id="f2e0d-159">这会增加读取和写入活动，从而导致增加 CPU 使用率。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-159">This increases the number of read and write activities which in turn causes increased CPU utilization.</span></span><br /><br /> <span data-ttu-id="f2e0d-160">动态增长，还需要服务器管理员监视磁盘容量，以确保有足够的磁盘存储作为存储需求的增长。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-160">The dynamic growth also requires that the server administrator monitor disk capacity to ensure that there is sufficient disk storage as the storage requirements increase.</span></span> |                                                                                                                               <span data-ttu-id="f2e0d-161">不执行以及固定大小的 VHD。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-161">Does not perform as well as a fixed size VHD.</span></span><br /><br /> <span data-ttu-id="f2e0d-162">如果性能不是一个问题，例如在开发环境中，这可能是操作系统的硬盘驱动器的合适选项。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-162">If performance is not a concern, for instance in a development environment, this may be a suitable option for the operating system hard drives.</span></span><br /><br /> <span data-ttu-id="f2e0d-163">导致块映射查找由于的额外 CPU 开销。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-163">Causes additional CPU overhead due to block mapping lookup.</span></span>                                                                                                                                |
|     <span data-ttu-id="f2e0d-164">**差异磁盘**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-164">**Differencing disks**</span></span>      |                                                                               <span data-ttu-id="f2e0d-165">此差异磁盘存储相对于基本 VHD 和基本虚拟硬盘的所有更改的位置的父-子配置保持不变。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-165">This a parent-child configuration where the differencing disk stores all changes relative to a base VHD and the base VHD remains static.</span></span> <span data-ttu-id="f2e0d-166">因此从父不同的块需要存储在差异 VHD 的子级。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-166">Therefore only the blocks which are different from the parent need to be stored in the child differencing VHD.</span></span>                                                                               |                                                                                                                                                                                                                                                                                                          <span data-ttu-id="f2e0d-167">因为需要访问固定/动态父 VHD，以及差异磁盘读/写，则可能会降低性能。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-167">Performance can degrade because read/writes need to access the fixed/dynamic parent VHD as well as the differencing disk.</span></span> <span data-ttu-id="f2e0d-168">这会增加 CPU 使用率和磁盘 I/O 开销。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-168">This increases CPU utilization and disk I/O overhead.</span></span>                                                                                                                                                                                                                                                                                                           |                                                                                                                     <span data-ttu-id="f2e0d-169">BizTalk Server 安装需要大量的计算机特定的配置，子 VHD 文件可以增长显著的可尽量减少使用此磁盘配置的好处。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-169">A large amount of machine specific configuration is required for BizTalk Server installations and child VHD files may grow substantially which would minimize the benefits of using this disk configuration.</span></span> <span data-ttu-id="f2e0d-170">读取从多个 VHD 的在此方案中会产生额外的 CPU 和磁盘 I/O 开销。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-170">Reading from multiple VHD’s in this scenario incurs additional CPU and disk I/O overhead.</span></span>                                                                                                                     |
|      <span data-ttu-id="f2e0d-171">**传递磁盘**</span><span class="sxs-lookup"><span data-stu-id="f2e0d-171">**Passthrough disks**</span></span>      |                                                                                                                               <span data-ttu-id="f2e0d-172">这些是物理磁盘设置为*脱机*在根分区和启用的 HYPER-V 和物理磁盘的独占读写访问。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-172">These are physical disks which are set to *offline* in the root partition and enable Hyper-V to have exclusive read-write access to the physical disk.</span></span>                                                                                                                                |                                                                                                                                                                                                                                                                                                        <span data-ttu-id="f2e0d-173">为了使它并将其分配到虚拟机需要完全专用的磁盘或 LUN。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-173">Requires a fully dedicated disk or LUN in order for it to be allocated to a virtual machine.</span></span><br /><br /> <span data-ttu-id="f2e0d-174">物理磁盘是比 VHD 文件在计算机之间移动的难度。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-174">A physical disk is more difficult to move between machines than VHD files.</span></span>                                                                                                                                                                                                                                                                                                         | <span data-ttu-id="f2e0d-175">如果你[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]实例正在运行的 HYPER-V 上，可能会通过用于 BizTalk Server 数据卷使用固定虚拟硬盘 (VHD) 使用传递磁盘获得增量性能改进。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-175">If your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] instance is running on a Hyper-V, you may obtain incremental performance improvements by using passthrough disks over using fixed virtual hard disks (VHD) for the BizTalk Server data volumes.</span></span><br /><br /> <span data-ttu-id="f2e0d-176">如果要在托管本地文件接收位置在 BizTalk Server 上的或流式处理大消息处理期间磁盘，则可能会获得通过使用固定虚拟硬盘 (VHD) 使用传递磁盘的增量性能改进。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-176">If you are hosting local file receive locations on BizTalk Server or streaming large messages to disk during processing, you may obtain incremental performance improvements using passthrough disks over using fixed virtual hard disks (VHD).</span></span> |

 <span data-ttu-id="f2e0d-177">有关实现磁盘和存储的 HYPER-V 的详细信息请参阅[实现磁盘和存储](http://go.microsoft.com/fwlink/?LinkID=142362)(http://go.microsoft.com/fwlink/?LinkID=142362)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-177">For more information about implementing disks and storage with Hyper-V see [Implementing Disks and Storage](http://go.microsoft.com/fwlink/?LinkID=142362) (http://go.microsoft.com/fwlink/?LinkID=142362).</span></span>  

##### <a name="networking"></a><span data-ttu-id="f2e0d-178">网络</span><span class="sxs-lookup"><span data-stu-id="f2e0d-178">Networking</span></span>  
 <span data-ttu-id="f2e0d-179">BizTalk Server 通常会表现出较高网络利用率。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-179">BizTalk Server tends to exhibit high network utilization.</span></span> <span data-ttu-id="f2e0d-180">因此，网络性能问题时，请考虑为每个虚拟机分配单独的物理网卡。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-180">Therefore, when network performance is an issue, consider allocating a separate physical network card for each virtual machine.</span></span>  

 <span data-ttu-id="f2e0d-181">在配置虚拟机，请确保使用网络适配器，而不是旧版网络适配器。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-181">When configuring a virtual machine, ensure that you use the Network Adapter instead of the Legacy Network Adapter.</span></span> <span data-ttu-id="f2e0d-182">旧版网络适配器适用于不支持集成组件的操作系统。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-182">The legacy network adapter is intended for operating systems that do not support integration components.</span></span>  

 <span data-ttu-id="f2e0d-183">若要测量网络性能，请使用 **"\Network 接口 \Bytes 总数/秒"** 和**\Network 接口 (\*) \Output 队列长度**主机操作系统上的性能监视器计数器要测量的网络卡的整体性能的系统。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-183">To measure network performance use the **“\Network Interface \Bytes Total/sec”** and the **\Network Interface(\*)\Output Queue Length** performance monitor counters on the host operating system to measure overall performance of the network card.</span></span> <span data-ttu-id="f2e0d-184">如果物理网络已被标识为处于忙碌，使用 **"\Hyper-V 虚拟网络适配器 (\*) \Bytes/sec"** 要识别哪些虚拟机网络适配器的主机操作系统上的计数器是正在生成高负载。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-184">If a physical network has been identified as being busy, use the **“\Hyper-V Virtual Network Adapter (\*)\Bytes/sec”** counter on the host operating system to identify which virtual machine network adapter(s) is/are generating high load.</span></span>  

 <span data-ttu-id="f2e0d-185">有关评估 HYPER-V 环境的网络性能的详细信息请参阅**测量网络性能**一部分[核对清单： 度量 HYPER-V 上的性能](../technical-guides/checklist-measuring-performance-on-hyper-v.md)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-185">For more information about evaluating network performance on a Hyper-V environment see the **Measuring Network Performance** section of [Checklist: Measuring Performance on Hyper-V](../technical-guides/checklist-measuring-performance-on-hyper-v.md).</span></span>  

##### <a name="cpu"></a><span data-ttu-id="f2e0d-186">CPU</span><span class="sxs-lookup"><span data-stu-id="f2e0d-186">CPU</span></span>  
 <span data-ttu-id="f2e0d-187">HYPER-V 支持不同数量的虚拟处理器的不同的来宾操作系统：下表中进行了总结。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-187">Hyper-V supports different numbers of virtual processors for different guest operating systems; as summarized in the table below.</span></span> <span data-ttu-id="f2e0d-188">若要为 BizTalk Server 中分配的最大 CPU 资源，请将其安装在[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]来宾操作系统，支持每个虚拟机的四个虚拟处理器。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-188">To allocate the maximum CPU resources for BizTalk Server, install it on a [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] guest operating system,  which supports four virtual processors per virtual machine.</span></span>  

 <span data-ttu-id="f2e0d-189">配置虚拟处理器的 1-1 分配到逻辑处理器可供主机操作系统，以防止过多的上下文切换的来宾操作系统中。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-189">Configure a 1-1 allocation of virtual processors in the guest operating system(s) to logical processors available to the host operating system to prevent excessive context switching.</span></span> <span data-ttu-id="f2e0d-190">过多的处理器之间进行切换的上下文将导致性能下降。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-190">Excessive context switching between processors will result in performance degradation.</span></span> <span data-ttu-id="f2e0d-191">有关分配虚拟处理器到逻辑处理器的详细信息，请参阅本主题的"优化处理器性能"部分[清单： 优化 HYPER-V 上的性能](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-191">For more information about allocating virtual processors to logical processors, see the “Optimize Processor Performance” section of the topic [Checklist: Optimizing Performance on Hyper-V](~/technical-guides/checklist-optimizing-performance-on-hyper-v.md).</span></span>  

 <span data-ttu-id="f2e0d-192">"虚拟机监控程序逻辑 processor （_total) \Hyper-V\\%总运行时间"性能监视器计数器测量的所有来宾计算机和虚拟机监控程序上的 HYPER-V 主机的整体资源利用率。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-192">The “\Hyper-V Hypervisor Logical Processor(_Total)\\% Total Run Time” Performance Monitor counter measures the overall resource utilization of all guest machines and the hypervisor on the Hyper-V host.</span></span> <span data-ttu-id="f2e0d-193">如果此值大于 90%，服务器正在运行以最大容量;在此方案中的虚拟机分配额外的虚拟处理器可能会降低整体系统性能，应当避免。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-193">If this value is above 90%, the server is running at maximum capacity; allocating additional virtual processors to virtual machines in this scenario can degrade overall system performance and should be avoided.</span></span> <span data-ttu-id="f2e0d-194">有关使用 HyperV 性能计数器的详细信息，请参阅[的 BizTalk Server 性能评估 HYPER-V](../technical-guides/evaluating-biztalk-server-performance-on-hyper-v.md)本指南的部分。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-194">For further details on using the HyperV performance counters, see the [Evaluating BizTalk Server Performance on Hyper-V](../technical-guides/evaluating-biztalk-server-performance-on-hyper-v.md) section of this guide.</span></span>  


|                                                                      <span data-ttu-id="f2e0d-195">操作系统</span><span class="sxs-lookup"><span data-stu-id="f2e0d-195">Operating system</span></span>                                                                       | <span data-ttu-id="f2e0d-196">虚拟处理器限制</span><span class="sxs-lookup"><span data-stu-id="f2e0d-196">Virtual processor limit</span></span> |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
| [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]<span data-ttu-id="f2e0d-197">的用户。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-197">.</span></span> <span data-ttu-id="f2e0d-198">所有版本的[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]只有 64 位。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-198">All editions of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] are 64-bit only.</span></span> |            <span data-ttu-id="f2e0d-199">4</span><span class="sxs-lookup"><span data-stu-id="f2e0d-199">4</span></span>            |
|                                               [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]<span data-ttu-id="f2e0d-200"> 64 位</span><span class="sxs-lookup"><span data-stu-id="f2e0d-200"> 64-bit</span></span>                                               |            <span data-ttu-id="f2e0d-201">4</span><span class="sxs-lookup"><span data-stu-id="f2e0d-201">4</span></span>            |
|                                               [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)]<span data-ttu-id="f2e0d-202"> 32 位</span><span class="sxs-lookup"><span data-stu-id="f2e0d-202"> 32-bit</span></span>                                               |            <span data-ttu-id="f2e0d-203">4</span><span class="sxs-lookup"><span data-stu-id="f2e0d-203">4</span></span>            |
|                                                                      <span data-ttu-id="f2e0d-204">Windows 7 64 位</span><span class="sxs-lookup"><span data-stu-id="f2e0d-204">Windows 7 64-bit</span></span>                                                                       |            <span data-ttu-id="f2e0d-205">4</span><span class="sxs-lookup"><span data-stu-id="f2e0d-205">4</span></span>            |
|                                                                      <span data-ttu-id="f2e0d-206">Windows 7 32 位</span><span class="sxs-lookup"><span data-stu-id="f2e0d-206">Windows 7 32-bit</span></span>                                                                       |            <span data-ttu-id="f2e0d-207">4</span><span class="sxs-lookup"><span data-stu-id="f2e0d-207">4</span></span>            |
|                                                                    <span data-ttu-id="f2e0d-208">64 位 Windows Vista</span><span class="sxs-lookup"><span data-stu-id="f2e0d-208">Windows Vista 64-bit</span></span>                                                                     |            <span data-ttu-id="f2e0d-209">2</span><span class="sxs-lookup"><span data-stu-id="f2e0d-209">2</span></span>            |
|                                                                    <span data-ttu-id="f2e0d-210">Windows Vista 32 位</span><span class="sxs-lookup"><span data-stu-id="f2e0d-210">Windows Vista  32-bit</span></span>                                                                    |            <span data-ttu-id="f2e0d-211">2</span><span class="sxs-lookup"><span data-stu-id="f2e0d-211">2</span></span>            |

> [!NOTE]  
>  <span data-ttu-id="f2e0d-212">有关 HYPER-V 支持的来宾操作系统的详细信息，请参阅[ http://go.microsoft.com/fwlink/?LinkID=118347 ](http://go.microsoft.com/fwlink/?LinkID=118347)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-212">For more information about the guest operating systems that are supported on Hyper-V, see [http://go.microsoft.com/fwlink/?LinkID=118347](http://go.microsoft.com/fwlink/?LinkID=118347).</span></span>  

##### <a name="memory"></a><span data-ttu-id="f2e0d-213">内存</span><span class="sxs-lookup"><span data-stu-id="f2e0d-213">Memory</span></span>  
 <span data-ttu-id="f2e0d-214">物理服务器需要足够的内存为根分区和在服务器上运行任何虚拟机。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-214">The physical server requires enough memory for the root partition and any virtual machines running on the server.</span></span> <span data-ttu-id="f2e0d-215">在测试期间，至少 2 GB 的内存已分配到根分区并**可用内存兆字节**性能监视器计数器进行监控，以确保没有内存压力，就会出现。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-215">During testing, a minimum of 2GB of memory was allocated to the root partition and the **Memory/Available Mbytes** performance monitor counter was monitored to ensure no memory pressure was experienced.</span></span>  

 <span data-ttu-id="f2e0d-216">应分配给 BizTalk Server 环境中每个虚拟机的内存量取决于工作负荷，并将执行的处理的类型。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-216">The amount of memory that should be allocated to each virtual machine in a BizTalk Server environment depends on the workload and type of processing that will be performed.</span></span> <span data-ttu-id="f2e0d-217">有许多因素会影响内存需求的 BizTalk Server 包括：</span><span class="sxs-lookup"><span data-stu-id="f2e0d-217">There are many factors that affect memory requirements of  BizTalk Server including:</span></span>  

- <span data-ttu-id="f2e0d-218">处理的消息的大小</span><span class="sxs-lookup"><span data-stu-id="f2e0d-218">Size of messages processed</span></span>  

- <span data-ttu-id="f2e0d-219">消息的吞吐量</span><span class="sxs-lookup"><span data-stu-id="f2e0d-219">Throughput of messages</span></span>  

- <span data-ttu-id="f2e0d-220">业务流程设计</span><span class="sxs-lookup"><span data-stu-id="f2e0d-220">Orchestration design</span></span>  

- <span data-ttu-id="f2e0d-221">管道处理</span><span class="sxs-lookup"><span data-stu-id="f2e0d-221">Pipeline processing</span></span>  

- <span data-ttu-id="f2e0d-222">你打算运行虚拟机中的 BizTalk 主机的数目</span><span class="sxs-lookup"><span data-stu-id="f2e0d-222">Number of BizTalk hosts that you plan to run within the virtual machine</span></span>  

  <span data-ttu-id="f2e0d-223">因素会影响内存的完整列表，请参阅"性能因素"部分中的 BizTalk Server 性能优化指南，网址[ http://go.microsoft.com/fwlink/?LinkId=122587 ](http://go.microsoft.com/fwlink/?LinkId=122587)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-223">For a comprehensive list of factors that affect memory, see “The Performance Factors” section of the BizTalk Server Performance Optimizations Guide at [http://go.microsoft.com/fwlink/?LinkId=122587](http://go.microsoft.com/fwlink/?LinkId=122587).</span></span>  

  <span data-ttu-id="f2e0d-224">主动监视**可用内存兆字节**计数器从每个虚拟机和根分区本身中。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-224">Proactively monitor the **Memory/Available Mbytes** counter from within each virtual machine and the root partition itself.</span></span> <span data-ttu-id="f2e0d-225">从以下指导原则[清单： 度量 HYPER-V 上的性能](../technical-guides/checklist-measuring-performance-on-hyper-v.md)应该用于确定是否有足够的可用物理内存的虚拟机并为根分区：</span><span class="sxs-lookup"><span data-stu-id="f2e0d-225">The following guidelines from [Checklist: Measuring Performance on Hyper-V](../technical-guides/checklist-measuring-performance-on-hyper-v.md) should be used to determine whether there is enough available physical memory for the virtual machine and for the root partition:</span></span>  

- <span data-ttu-id="f2e0d-226">内存可用的 50%或更多 = 正常</span><span class="sxs-lookup"><span data-stu-id="f2e0d-226">50% of free memory available or more = Healthy</span></span>  

- <span data-ttu-id="f2e0d-227">25%的内存可用 = 监视</span><span class="sxs-lookup"><span data-stu-id="f2e0d-227">25% of free memory available = Monitor</span></span>  

- <span data-ttu-id="f2e0d-228">10%的内存可用 = 警告</span><span class="sxs-lookup"><span data-stu-id="f2e0d-228">10% of free memory available = Warning</span></span>  

- <span data-ttu-id="f2e0d-229">小于 5%的内存可用 = 关键，性能将受到负面影响</span><span class="sxs-lookup"><span data-stu-id="f2e0d-229">Less than 5% of free memory available = Critical, performance will be adversely affected</span></span>  

#### <a name="choosing-root-operating-system-version"></a><span data-ttu-id="f2e0d-230">选择根操作系统版本</span><span class="sxs-lookup"><span data-stu-id="f2e0d-230">Choosing Root Operating System Version</span></span>  
 <span data-ttu-id="f2e0d-231">有关服务器核心，以及在完整安装的支持的 HYPER-V [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-231">Hyper-V is supported on a Server Core as well as a full installation of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)].</span></span> <span data-ttu-id="f2e0d-232">若要在根分区的开销降到最低，安装 HYPER-V 的服务器核心安装上[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-232">To minimize the overhead of the root partition, install Hyper-V on a Server Core installation of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)].</span></span> <span data-ttu-id="f2e0d-233">可以从不同的系统上的 HYPER-V 管理器远程管理的 HYPER-V 角色。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-233">The Hyper-V role can be managed remotely from the Hyper-V Manager on a different system.</span></span> <span data-ttu-id="f2e0d-234">服务器核心提供了一个较小磁盘和内存配置文件，因此，会让更多资源可用于虚拟机。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-234">Server Core provides a smaller disk and memory profile, therefore, leaving more resources available for virtual machines.</span></span> <span data-ttu-id="f2e0d-235">有关服务器核心安装选项可用于详细信息[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]，请参阅[ http://go.microsoft.com/fwlink/?LinkID=202439 ](http://go.microsoft.com/fwlink/?LinkID=202439)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-235">For more information about the Server Core installation option available for [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], see [http://go.microsoft.com/fwlink/?LinkID=202439](http://go.microsoft.com/fwlink/?LinkID=202439).</span></span>  

 <span data-ttu-id="f2e0d-236">如果您选择使用完整安装的[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]，请确保根分区专用于 HYPER-V 服务器角色。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-236">If you choose to use a full installation of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], ensure that the root partition is dedicated only to the Hyper-V server role.</span></span> <span data-ttu-id="f2e0d-237">运行其他服务器角色会占用内存、 磁盘、 处理器和网络资源，将会降低性能。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-237">Running additional server roles will consume memory, disk, processor, and network resources and will degrade performance.</span></span>  

#### <a name="creating-your-virtual-machines"></a><span data-ttu-id="f2e0d-238">创建虚拟机</span><span class="sxs-lookup"><span data-stu-id="f2e0d-238">Creating Your Virtual Machines</span></span>  
 <span data-ttu-id="f2e0d-239">已安装并配置 HYPER-V 服务器角色之后，您需要创建虚拟机。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-239">After you have installed and configured the Hyper-V server role, you need to create the virtual machines.</span></span> <span data-ttu-id="f2e0d-240">在此之前，最好回答以下问题：</span><span class="sxs-lookup"><span data-stu-id="f2e0d-240">Before doing this, it is useful to answer the following questions:</span></span>  

- <span data-ttu-id="f2e0d-241">将使用哪些存储配置？</span><span class="sxs-lookup"><span data-stu-id="f2e0d-241">What storage configuration will I use?</span></span>  

- <span data-ttu-id="f2e0d-242">来宾操作系统支持虚拟处理器数目？</span><span class="sxs-lookup"><span data-stu-id="f2e0d-242">How many virtual processors does the guest operating system support?</span></span>  

- <span data-ttu-id="f2e0d-243">将到虚拟机分配多少内存？</span><span class="sxs-lookup"><span data-stu-id="f2e0d-243">How much memory will be allocated to the virtual machine?</span></span>  

- <span data-ttu-id="f2e0d-244">在我的 HYPER-V 服务器上可以运行多少个虚拟机？</span><span class="sxs-lookup"><span data-stu-id="f2e0d-244">How many virtual machines can I run on my Hyper-V Server?</span></span>  

- <span data-ttu-id="f2e0d-245">如何将安装到计算机上的操作系统？</span><span class="sxs-lookup"><span data-stu-id="f2e0d-245">How will I install the operating system onto the machine?</span></span>  

  <span data-ttu-id="f2e0d-246">有关如何创建和配置虚拟机的详细信息，请参阅[创建虚拟机](http://go.microsoft.com/fwlink/?LinkID=202440)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-246">For more information about how to create and configure virtual machines, see [Create Virtual Machines](http://go.microsoft.com/fwlink/?LinkID=202440).</span></span>  

##### <a name="installing-the-base-operating-system"></a><span data-ttu-id="f2e0d-247">安装基本操作系统</span><span class="sxs-lookup"><span data-stu-id="f2e0d-247">Installing the Base Operating System</span></span>  
 <span data-ttu-id="f2e0d-248">可用于在物理服务器上安装的所有选项都都可用的 HYPER-V 中。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-248">All the options available for a physical server installation are available in Hyper-V.</span></span> <span data-ttu-id="f2e0d-249">可启动 CD/DVD-ROM 媒体或 ISO 映像可用于执行手动安装。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-249">A bootable CD/DVD-ROM media or an ISO image can be used to perform a manual installation.</span></span> <span data-ttu-id="f2e0d-250">如果已使用连接到承载的 ISO 映像的服务器所在的同一网络的网络适配器配置虚拟机，可以执行网络安装。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-250">A network installation can be performed if the virtual machine has been configured with a network adapter connected to the same network as a server that hosts the ISO images.</span></span>  

> [!IMPORTANT]  
>  <span data-ttu-id="f2e0d-251">无论安装哪种方法是选择，出于性能原因很重要的操作系统集成组件安装在 HYPER-V 下运行每个虚拟机。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-251">Whichever installation method is chosen, for performance reasons it is critical the operating system integration components be installed for each virtual machine running under Hyper-V.</span></span> <span data-ttu-id="f2e0d-252">集成组件提供驱动程序和服务，可让来宾机器使用合成设备执行的一的组。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-252">The integration components provide a set of drivers and services that enable the guest machine to perform by using synthetic devices.</span></span> <span data-ttu-id="f2e0d-253">合成设备避免需要模拟设备，不支持集成组件的操作系统使用。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-253">Synthetic devices avoid the need for emulated devices, which are used on operating systems that do not support integration components.</span></span> <span data-ttu-id="f2e0d-254">模拟的设备会产生更大的系统开销相比合成设备。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-254">Emulated devices incur greater system overhead compared to synthetic devices.</span></span>  

 <span data-ttu-id="f2e0d-255">若要安装和配置本实验室中使用的计算机，初始的基本映像已创建固定大小的 VHD。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-255">To install and configure the machines used in this lab, an initial base image was created on a fixed size VHD.</span></span> <span data-ttu-id="f2e0d-256">这涉及到手动安装[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-256">This involved a manual installation of [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)].</span></span> <span data-ttu-id="f2e0d-257">一旦已安装所有合适的更新基础虚拟机进行映像使用 sysprep 实用工具 %WINDIR%\system32\sysprep 目录中与 Windows Server 2008 一起安装。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-257">Once all appropriate updates had been installed the base virtual machine was imaged using sysprep utility that is installed with Windows Server 2008, in the %WINDIR%\system32\sysprep directory.</span></span>  

> [!NOTE]
>  <span data-ttu-id="f2e0d-258">运行 Sysprep 后已安装并在服务器上配置 BizTalk Server 可以通过使用 Sysprep 应答文件和 BizTalk Server 提供的脚本来完成。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-258">Running Sysprep after BizTalk Server has been installed and configured on the server can be accomplished through the use of a Sysprep answer file and scripts provided with BizTalk Server.</span></span> <span data-ttu-id="f2e0d-259">向 BizTalk Server 上安装这些示例脚本专供[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-259">These sample scripts are designed for use with BizTalk Server installed on [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)].</span></span> <span data-ttu-id="f2e0d-260">有关详细信息，请参阅 BizTalk Server 联机文档。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-260">For more information see the BizTalk Server online documentation.</span></span>  

## <a name="installing-and-configuring-biztalk-server"></a><span data-ttu-id="f2e0d-261">安装和配置 BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="f2e0d-261">Installing and Configuring BizTalk Server</span></span>  

- <span data-ttu-id="f2e0d-262">若要最小化安装虚拟机所需的时间，创建基本映像仅包含来宾操作系统和软件先决条件。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-262">To minimize the time required to install virtual machines, create a base image consisting only of the guest operating system and software prerequisites.</span></span> <span data-ttu-id="f2e0d-263">使用 SysPrep 来准备的 VHD 映像以供重复使用，，然后使此 VHD 上的所有虚拟机 (Vm)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-263">Use SysPrep to prepare the VHD image for reuse, and then base all your virtual machines (VMs) on this VHD.</span></span>  

  > [!NOTE]
  >  <span data-ttu-id="f2e0d-264">使用 BizTalk Server，则可以对基本映像运行 Sysprep*后*已安装并在服务器上配置 BizTalk Server。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-264">With BizTalk Server, it is possible to run Sysprep against a base image *after*BizTalk Server has been installed and configured on the server.</span></span> <span data-ttu-id="f2e0d-265">这可以通过使用 Sysprep 应答文件和脚本提供与 BizTalk Server 来实现。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-265">This can be accomplished through the use of a Sysprep answer file and scripts provided with BizTalk Server.</span></span> <span data-ttu-id="f2e0d-266">向 BizTalk Server 上安装这些示例脚本专供[!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-266">These sample scripts are designed for use with BizTalk Server installed on   [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)] .</span></span> <span data-ttu-id="f2e0d-267">有关详细信息，请参阅 BizTalk Server 联机文档。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-267">For more information see the BizTalk Server online documentation.</span></span>  
  > 
  >  <span data-ttu-id="f2e0d-268">无人参与 Windows 安装程序参考位于[ http://go.microsoft.com/fwlink/?LinkId=142364 ](http://go.microsoft.com/fwlink/?LinkId=142364)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-268">The Unattended Windows Setup Reference is available at [http://go.microsoft.com/fwlink/?LinkId=142364](http://go.microsoft.com/fwlink/?LinkId=142364).</span></span>  

- <span data-ttu-id="f2e0d-269">请按照"时安装和配置 BizTalk Server..."中的建议</span><span class="sxs-lookup"><span data-stu-id="f2e0d-269">Follow the recommendations in the “When Installing and Configuring BizTalk Server…”</span></span> <span data-ttu-id="f2e0d-270">主题的部分[清单： 安装和配置 HYPER-V 上的 BizTalk Server 的最佳实践](../technical-guides/checklist-best-practices-to-install-and-configure-biztalk-server-on-hyper-v.md)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-270">section of the topic [Checklist: Best Practices for Installing and Configuring BizTalk Server on Hyper-V](../technical-guides/checklist-best-practices-to-install-and-configure-biztalk-server-on-hyper-v.md).</span></span>  

- <span data-ttu-id="f2e0d-271">有关信息的可支持性[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]并[!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]在 HYPER-V 环境中，请参阅[附录 c: BizTalk Server 和 SQL Server 的 HYPER-V 可支持性](../technical-guides/appendix-c-biztalk-server-and-sql-server-hyper-v-supportability.md)。</span><span class="sxs-lookup"><span data-stu-id="f2e0d-271">For information on the supportability of [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] and [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] in a Hyper-V environment, see [Appendix C: BizTalk Server and SQL Server Hyper-V Supportability](../technical-guides/appendix-c-biztalk-server-and-sql-server-hyper-v-supportability.md).</span></span>
